(function(){"use strict";var e={16:function(e,a,t){t.d(a,{A:function(){return f}});var i=t(6768),s=t(5130),o=t(4232);const l={key:0,class:"popup-icon"},n=["innerHTML"],r={class:"popup-heading"},c={class:"popup-message"},d=["placeholder"],u={class:"popup-actions"},p=["onClick"];function v(e,a,t,v,m,k){return k.visible?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"popup-backdrop",onKeydown:a[2]||(a[2]=(0,s.jR)((...e)=>k.onClose&&k.onClose(...e),["esc"])),tabindex:"0","aria-modal":"true",role:"dialog"},[(0,i.Lk)("div",{class:(0,o.C4)(["popup-modal",k.type])},[k.icon?((0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("span",{innerHTML:k.icon},null,8,n)])):(0,i.Q3)("",!0),(0,i.Lk)("h2",r,(0,o.v_)(k.heading),1),(0,i.Lk)("p",c,(0,o.v_)(k.message),1),"comment"===k.type?(0,i.bo)(((0,i.uX)(),(0,i.CE)("textarea",{key:1,"onUpdate:modelValue":a[0]||(a[0]=e=>m.comment=e),class:"popup-input",placeholder:k.inputPlaceholder,onKeydown:a[1]||(a[1]=(0,s.jR)((0,s.D$)(()=>{},["stop"]),["enter"]))},null,40,d)),[[s.Jo,m.comment]]):(0,i.Q3)("",!0),(0,i.Lk)("div",u,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(k.buttons,(e,a)=>((0,i.uX)(),(0,i.CE)("button",{key:a,onClick:a=>v.onAction(e.action),class:(0,o.C4)(e.class)},(0,o.v_)(e.label),11,p))),128))])],2)],32)):(0,i.Q3)("",!0)}var m=t(2351);const k={success:"âœ“",error:"âœ—",warning:"âš ï¸",info:"â„¹ï¸",confirm:"â“",comment:"ðŸ’¬","access-denied":"ðŸš«"};var h={name:"PopupModal",setup(){const e=m.O.getState(),a=(e,a)=>{m.O.handleAction({action:e,comment:a})};return{popupState:e,onAction:a}},computed:{visible(){return this.popupState.visible},type(){return this.popupState.type},heading(){return this.popupState.heading},message(){return this.popupState.message},buttons(){return this.popupState.buttons},autoClose(){return this.popupState.autoClose},inputPlaceholder(){return this.popupState.inputPlaceholder},icon(){return k[this.type]||""}},watch:{visible(e){e&&this.autoClose>0&&setTimeout(()=>this.onAction("auto-close"),this.autoClose),e&&(this.comment="")}},data(){return{comment:""}},methods:{onClose(){this.onAction("close")}}},g=t(1241);const y=(0,g.A)(h,[["render",v],["__scopeId","data-v-0911b198"]]);var f=y},766:function(e,a,t){t.d(a,{r:function(){return s}});t(4114);var i=t(6604);const s={data(){return{userPermissions:{},userRole:null,userDepartment:null,userEntity:null,userId:null,userEmail:null,permissionsLoaded:!1,permissionsError:null,isAuthenticated:!1}},async created(){console.log("ðŸ” Permission Mixin: Checking authentication status..."),await this.checkAuthenticationStatus()},methods:{async checkAuthenticationStatus(){try{console.log("ðŸ” Permission Mixin: Checking authentication...");const e=await i.m8.checkAuthStatus();this.isAuthenticated=e.is_authenticated||!1,this.isAuthenticated?(console.log("ðŸ” Permission Mixin: User is authenticated, loading permissions..."),await this.loadUserPermissions()):(console.log("ðŸ” Permission Mixin: User not authenticated, using default permissions"),this.setDefaultPermissions())}catch(e){console.error("âŒ Permission Mixin: Error checking authentication:",e),this.isAuthenticated=!1,this.setDefaultPermissions()}},async loadUserPermissions(){try{console.log("ðŸ” Permission Mixin: Fetching permissions from API...");const e=await i.m8.getUserPermissions();if("User not authenticated"===e.message)return console.log("ðŸ” Permission Mixin: User not authenticated, using default permissions"),this.isAuthenticated=!1,void this.setDefaultPermissions();this.userPermissions=e.permissions||{},this.userRole=e.role,this.userDepartment=e.department,this.userEntity=e.entity,this.userId=e.user_id,this.userEmail=e.email,this.permissionsLoaded=!0,this.isAuthenticated=!0,this.permissionsError=null,console.log("ðŸ” Permission Mixin: Permissions loaded successfully"),console.log("   ðŸ‘¤ User ID:",this.userId),console.log("   ðŸ‘¤ User Role:",this.userRole),console.log("   ðŸ“§ Email:",this.userEmail),console.log("   ðŸ¢ Department:",this.userDepartment),console.log("   ðŸ­ Entity:",this.userEntity),console.log("   ðŸ”‘ Permissions:",this.userPermissions)}catch(e){console.error("âŒ Permission Mixin: Error loading permissions:",e),this.permissionsError=e.message||"Failed to load permissions",this.isAuthenticated=!1,this.setDefaultPermissions()}},setDefaultPermissions(){this.userPermissions={incident:{create:!1,edit:!1,view:!1,assign:!1,approve:!1,delete:!1},audit:{view:!1,conduct:!1,review:!1,assign:!1,analytics:!1}},this.userRole=null,this.userDepartment=null,this.userEntity=null,this.userId=null,this.userEmail=null,this.permissionsLoaded=!0,console.log("ðŸ” Permission Mixin: Default permissions set")},async reloadPermissions(){console.log("ðŸ” Permission Mixin: Manually reloading permissions..."),this.permissionsLoaded=!1,this.permissionsError=null,await this.checkAuthenticationStatus()},hasPermission(e,a){const t=this.userPermissions[e]?.[a]||!1;return console.log(`ðŸ” Permission Check: ${e}.${a} = ${t?"âœ… ALLOWED":"âŒ DENIED"}`),t},canCreateIncident(){return this.hasPermission("incident","create")},canEditIncident(){return this.hasPermission("incident","edit")},canViewIncident(){return this.hasPermission("incident","view")},canAssignIncident(){return this.hasPermission("incident","assign")},canEscalateIncident(){return this.hasPermission("incident","escalate")},canViewIncidentAnalytics(){return this.hasPermission("incident","analytics")},canViewAudit(){return this.hasPermission("audit","view")},canConductAudit(){return this.hasPermission("audit","conduct")},canReviewAudit(){return this.hasPermission("audit","review")},canAssignAudit(){return this.hasPermission("audit","assign")},canViewAuditAnalytics(){return this.hasPermission("audit","analytics")},canViewAnalytics(){return this.canViewIncidentAnalytics()||this.canViewAuditAnalytics()},logUserAction(e,a=null,t=null){console.log("ðŸŽ¯ User Action Logged:"),console.log("   ðŸ‘¤ User Role:",this.userRole),console.log("   ðŸ¢ Department:",this.userDepartment),console.log("   ðŸ­ Entity:",this.userEntity),console.log("   ðŸŽ¯ Action:",e),console.log("   ðŸ“Š Resource:",a,t),console.log("   â° Timestamp:",(new Date).toISOString())},hasAnyPermissions(){if(!this.permissionsLoaded)return!1;for(const e in this.userPermissions)for(const a in this.userPermissions[e])if(this.userPermissions[e][a])return!0;return!1},getAllowedActions(){const e=[];for(const a in this.userPermissions)for(const t in this.userPermissions[a])this.userPermissions[a][t]&&e.push(`${a}.${t}`);return console.log("ðŸ”‘ User Allowed Actions:",e),e}},computed:{permissionStatus(){return{loaded:this.permissionsLoaded,error:this.permissionsError,authenticated:this.isAuthenticated,hasPermissions:this.hasAnyPermissions(),userId:this.userId,email:this.userEmail,role:this.userRole,department:this.userDepartment,entity:this.userEntity}}}}},2018:function(e,a,t){t.d(a,{A:function(){return u}});var i=t(6768),s=t(5130);const o={class:"dynamic-search-bar"},l=["placeholder"];function n(e,a,t,n,r,c){return(0,i.uX)(),(0,i.CE)("div",o,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>r.inputValue=e),placeholder:t.placeholder,class:"dynamic-search-input",onInput:a[1]||(a[1]=(...e)=>c.onInput&&c.onInput(...e)),onKeyup:a[2]||(a[2]=(0,s.jR)((...e)=>c.onEnter&&c.onEnter(...e),["enter"]))},null,40,l),[[s.Jo,r.inputValue]]),r.inputValue?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"clear-btn",onClick:a[3]||(a[3]=(...e)=>c.clearInput&&c.clearInput(...e))},"âœ•")):(0,i.Q3)("",!0)])}var r={name:"DynamicSearchBar",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Search..."}},data(){return{inputValue:this.modelValue}},watch:{modelValue(e){this.inputValue=e}},methods:{onInput(){this.$emit("update:modelValue",this.inputValue),this.$emit("input",this.inputValue)},onEnter(){this.$emit("search",this.inputValue)},clearInput(){this.inputValue="",this.onInput()}}},c=t(1241);const d=(0,c.A)(r,[["render",n],["__scopeId","data-v-0f33b442"]]);var u=d},2351:function(e,a,t){t.d(a,{O:function(){return l}});var i=t(144);const s=(0,i.KR)({visible:!1,type:"info",heading:"",message:"",buttons:[],autoClose:0,inputPlaceholder:"Enter your comment..."}),o=(0,i.KR)(new Map),l={show(e){console.log("[POPUP_SERVICE] show() called with config:",e),console.log("[POPUP_SERVICE] Current popup state before update:",s.value),s.value={...s.value,...e,visible:!0},console.log("[POPUP_SERVICE] Popup state updated:",s.value),console.log("[POPUP_SERVICE] Popup should now be visible:",s.value.visible)},hide(){s.value.visible=!1},getState(){return s},handleAction({action:e,comment:a}){const t=o.value.get(e);t&&(t(a),o.value.delete(e)),this.hide()},onAction(e,a){o.value.set(e,a)},info(e,a="Information"){this.show({type:"info",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"info"}]})},success(e,a="Success"){this.show({type:"success",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"success"}]})},error(e,a="Error"){this.show({type:"error",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"error"}]})},warning(e,a="Warning"){this.show({type:"warning",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"warning"}]})},confirm(e,a="Confirm",t,i){this.show({type:"confirm",heading:a,message:e,buttons:[{label:"Yes",action:"yes",class:"success"},{label:"No",action:"no",class:"error"}]}),t&&this.onAction("yes",t),i&&this.onAction("no",i)},comment(e,a="Comment",t){this.show({type:"comment",heading:a,message:e,buttons:[{label:"Submit",action:"submit",class:"success"},{label:"Cancel",action:"cancel",class:"error"}]}),t&&this.onAction("submit",t)},accessDenied(e="You don't have permission to access this feature. Please contact your administrator to activate this feature.",a="Access Denied",t){console.log("[POPUP_SERVICE] accessDenied called with:",{message:e,heading:a,hasCallback:!!t});const i={type:"access-denied",heading:a,message:e,buttons:[{label:"Contact Admin",action:"contact-admin",class:"warning"},{label:"OK",action:"ok",class:"error"}]};console.log("[POPUP_SERVICE] Popup config created:",i);try{this.show(i),console.log("[POPUP_SERVICE] show() method called successfully"),console.log("[POPUP_SERVICE] Current popup state after show():",s.value),t&&(this.onAction("contact-admin",t),console.log("[POPUP_SERVICE] Contact admin callback registered"))}catch(o){console.error("[POPUP_SERVICE] Error in accessDenied method:",o)}}};a.A=l},2545:function(e,a,t){t.d(a,{A:function(){return f}});var i=t(6768),s=t(4232),o=t(5130);const l={class:"dropdown-container"},n={class:"text-content"},r={class:"dropdown-label"},c={class:"dropdown-value"},d={key:0,class:"dropdown-menu"},u=["onClick"],p={key:1,class:"dropdown-no-results"};function v(e,a,t,v,m,k){const h=(0,i.g2)("PhCalendar"),g=(0,i.g2)("PhCaretDown");return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("button",{class:"filter-btn",onClick:a[0]||(a[0]=(...e)=>k.toggleDropdown&&k.toggleDropdown(...e))},[k.showCalendarIcon?((0,i.uX)(),(0,i.Wv)(h,{key:0,size:16})):(0,i.Q3)("",!0),(0,i.Lk)("span",n,[(0,i.Lk)("span",r,(0,s.v_)(t.config.label||t.config.name)+": ",1),(0,i.Lk)("span",c,(0,s.v_)(k.selectedLabel),1)]),(0,i.bF)(g,{size:16})]),m.isOpen?((0,i.uX)(),(0,i.CE)("div",d,[t.showSearchBar?(0,i.bo)(((0,i.uX)(),(0,i.CE)("input",{key:0,"onUpdate:modelValue":a[1]||(a[1]=e=>m.searchQuery=e),type:"text",class:"dropdown-search",placeholder:"Search...",onClick:a[2]||(a[2]=(0,o.D$)(()=>{},["stop"]))},null,512)),[[o.Jo,m.searchQuery]]):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(k.filteredOptions,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.value,class:"dropdown-item",onClick:a=>k.selectOption(e)},(0,s.v_)(e.label),9,u))),128)),0===k.filteredOptions.length?((0,i.uX)(),(0,i.CE)("div",p," No results found ")):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0)])}t(8111),t(2489),t(116);var m=t(3425),k=t(4672),h={name:"CustomDropdown",components:{PhCalendar:m.A,PhCaretDown:k.A},props:{config:{type:Object,required:!0},modelValue:{type:String,default:""},showSearchBar:{type:Boolean,default:!0}},data(){return{isOpen:!1,searchQuery:""}},computed:{selectedLabel(){const e=this.config.values||this.config.options||[],a=e.find(e=>e.value===this.modelValue);return a?a.label:this.config.defaultValue||this.config.defaultLabel||"Select..."},showCalendarIcon(){return"Due Date"===(this.config.label||this.config.name)},filteredOptions(){const e=this.config.values||this.config.options||[];if(!this.searchQuery)return e;const a=this.searchQuery.toLowerCase();return e.filter(e=>e.label&&e.label.toLowerCase().includes(a))}},mounted(){document.addEventListener("click",this.closeDropdown)},beforeDestroy(){document.removeEventListener("click",this.closeDropdown)},methods:{toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&(this.searchQuery="")},selectOption(e){this.$emit("update:modelValue",e.value),this.$emit("change",e),this.isOpen=!1},closeDropdown(e){e.target.closest(".dropdown-container")||(this.isOpen=!1)}}},g=t(1241);const y=(0,g.A)(h,[["render",v],["__scopeId","data-v-dfffad08"]]);var f=y},2972:function(e,a,t){t.d(a,{OQ:function(){return i.O},Wo:function(){return i.A},wA:function(){return s.A}});var i=t(2351),s=t(16);const o={install(e){e.config.globalProperties.$popup=i.A}};a.Ay=o},3435:function(e,a,t){t.r(a),t.d(a,{default:function(){return he}});var i=t(6768),s=t(4232),o=t(5130);const l={class:"auditor-dashboard-container"},n={key:0,class:"loading-indicator"},r={key:1,class:"error-message"},c={class:"action-buttons"},d={key:3,class:"no-data-message"},u={key:4,class:"reports-modal-overlay"},p={class:"reports-modal"},v={class:"reports-modal-header"},m={key:0,class:"loading-message"},k={key:1,class:"error-message"},h={key:2,class:"no-reports-message"},g={key:3,class:"reports-table-container"},y={class:"reports-table"},f={class:"report-url"},b=["title"],C={class:"actions-cell"},L=["onClick"],w=["onClick"],E={key:5,class:"audit-popup-overlay"},R={class:"audit-popup-modal"},D={class:"popup-header"},I={class:"popup-title"},P={class:"popup-content"},_={class:"popup-policy"},S={class:"popup-policy-name"},A={key:0,class:"popup-subpolicy"},T={key:1,class:"popup-loading"},x={key:2,class:"popup-error"},F={key:3,class:"popup-compliance-list"},V={class:"compliance-header"},M={class:"compliance-id"},X={class:"compliance-description"},U={class:"compliance-controls"},N={class:"compliance-check"},$=["checked","onChange"],O={class:"compliance-evidence"},j=["onUpdate:modelValue","onInput"],B={class:"compliance-comments"},W=["onUpdate:modelValue","onInput"],Q={key:0,class:"compliance-major-minor"},q=["onUpdate:modelValue","onChange"],K={class:"popup-actions"},J={key:6,class:"versions-modal-overlay"},z={class:"versions-modal"},H={class:"versions-modal-header"},Y={key:0,class:"loading-message"},G={key:1,class:"error-message"},Z={key:2,class:"no-versions-message"},ee={key:3,class:"versions-table-container"},ae={class:"versions-table"},te={class:"icon-cell"},ie=["onClick"],se={class:"icon-cell"},oe={key:0,class:"fas fa-spinner fa-spin",title:"Downloading..."},le=["onClick"],ne={key:1,class:"disabled-icon",title:"Download not available for rejected reports"};function re(e,a,t,re,ce,de){const ue=(0,i.g2)("CustomButton"),pe=(0,i.g2)("DynamicTable");return(0,i.uX)(),(0,i.CE)("div",l,[a[27]||(a[27]=(0,i.Lk)("div",{class:"dashboard-header-title"}," Audit Dashboard ",-1)),ce.loading?((0,i.uX)(),(0,i.CE)("div",n,"Loading audits...")):(0,i.Q3)("",!0),ce.error?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.eW)((0,s.v_)(ce.error)+" ",1),(0,i.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>de.retryLoading&&de.retryLoading(...e)),class:"retry-btn"},"Retry")])):(0,i.Q3)("",!0),!ce.loading&&ce.audits.length>0?((0,i.uX)(),(0,i.Wv)(pe,{key:2,title:"Audits",data:ce.audits,columns:de.tableColumns,filters:de.tableFilters,actionButtons:de.tableActionButtons,showActions:!0,showPagination:!0,defaultPageSize:10,onButtonClick:de.handleButtonClick,onFilterChange:de.handleFilterChange},{"cell-status":(0,i.k6)(({row:e})=>[(0,i.bF)(ue,{config:de.getStatusButtonConfig(e),onClick:a=>de.onStatusButtonClick(e)},null,8,["config","onClick"])]),actions:(0,i.k6)(({row:e})=>[(0,i.Lk)("div",c,[(0,i.bF)(ue,{config:{name:"Reports",icon:"PhFileText",className:"report-btn"},onClick:a=>de.showReports(e)},null,8,["onClick"]),"Completed"===e.status?((0,i.uX)(),(0,i.Wv)(ue,{key:0,config:{name:"Versions",icon:"PhClock",className:"view-versions-btn"},onClick:a=>de.viewAuditVersions(e)},null,8,["onClick"])):(0,i.Q3)("",!0)])]),_:1},8,["data","columns","filters","actionButtons","onButtonClick","onFilterChange"])):ce.loading||0!==ce.audits.length?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",d," No audits found. You don't have any audits assigned to you. ")),ce.showReportsModal?((0,i.uX)(),(0,i.CE)("div",u,[(0,i.Lk)("div",p,[(0,i.Lk)("div",v,[a[7]||(a[7]=(0,i.Lk)("h2",null,"Reports",-1)),(0,i.Lk)("button",{class:"close-btn",onClick:a[1]||(a[1]=(...e)=>de.closeReportsModal&&de.closeReportsModal(...e))},"Ã—")]),ce.loadingReports?((0,i.uX)(),(0,i.CE)("div",m,a[8]||(a[8]=[(0,i.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,i.eW)(" Loading reports... ")]))):ce.reportsError?((0,i.uX)(),(0,i.CE)("div",k,[a[9]||(a[9]=(0,i.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,i.eW)(" "+(0,s.v_)(ce.reportsError),1)])):0===ce.processedReports.length?((0,i.uX)(),(0,i.CE)("div",h,a[10]||(a[10]=[(0,i.Lk)("i",{class:"fas fa-folder-open"},null,-1),(0,i.eW)(" No reports available ")]))):((0,i.uX)(),(0,i.CE)("div",g,[(0,i.Lk)("table",y,[a[13]||(a[13]=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"Report Number"),(0,i.Lk)("th",null,"Report ID"),(0,i.Lk)("th",null,"Audit ID"),(0,i.Lk)("th",null,"Policy ID"),(0,i.Lk)("th",null,"SubPolicy ID"),(0,i.Lk)("th",null,"Framework ID"),(0,i.Lk)("th",null,"Document"),(0,i.Lk)("th",null,"Actions")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ce.processedReports,(e,t)=>((0,i.uX)(),(0,i.CE)("tr",{key:t},[(0,i.Lk)("td",null,(0,s.v_)(e.reportNumber),1),(0,i.Lk)("td",null,(0,s.v_)(e.ReportId),1),(0,i.Lk)("td",null,(0,s.v_)(e.AuditId),1),(0,i.Lk)("td",null,(0,s.v_)(e.PolicyId||"N/A"),1),(0,i.Lk)("td",null,(0,s.v_)(e.SubPolicyId||"N/A"),1),(0,i.Lk)("td",null,(0,s.v_)(e.FrameworkId||"N/A"),1),(0,i.Lk)("td",f,[(0,i.Lk)("span",{class:"file-name",title:e.Report},(0,s.v_)(de.getFileName(e.Report)),9,b)]),(0,i.Lk)("td",C,[(0,i.Lk)("button",{class:"action-btn view",onClick:a=>de.viewReport(e),title:"View Report"},a[11]||(a[11]=[(0,i.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,L),(0,i.Lk)("button",{class:"action-btn download",onClick:a=>de.downloadReport(e),title:"Download Report"},a[12]||(a[12]=[(0,i.Lk)("i",{class:"fas fa-download"},null,-1)]),8,w)])]))),128))])])]))])])):(0,i.Q3)("",!0),ce.showPopup?((0,i.uX)(),(0,i.CE)("div",E,[(0,i.Lk)("div",R,[(0,i.Lk)("button",{class:"popup-close",onClick:a[2]||(a[2]=(...e)=>de.closePopup&&de.closePopup(...e))},"Ã—"),(0,i.Lk)("div",D,[(0,i.Lk)("h2",I,(0,s.v_)(ce.popupData.framework),1)]),(0,i.Lk)("div",P,[(0,i.Lk)("div",_,[(0,i.Lk)("h3",S,(0,s.v_)(ce.popupData.policy),1),ce.popupData.subpolicy?((0,i.uX)(),(0,i.CE)("div",A,[(0,i.Lk)("h4",null,"Subpolicy: "+(0,s.v_)(ce.popupData.subpolicy),1)])):(0,i.Q3)("",!0),ce.popupData.loadingCompliances?((0,i.uX)(),(0,i.CE)("div",T,a[14]||(a[14]=[(0,i.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,i.eW)(" Loading compliance data... ")]))):ce.popupData.complianceError?((0,i.uX)(),(0,i.CE)("div",x,[a[15]||(a[15]=(0,i.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,i.eW)(" "+(0,s.v_)(ce.popupData.complianceError)+" ",1),(0,i.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>de.retryLoadingCompliances&&de.retryLoadingCompliances(...e)),class:"retry-btn"},"Retry")])):((0,i.uX)(),(0,i.CE)("div",F,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ce.popupData.compliances,e=>((0,i.uX)(),(0,i.CE)("div",{key:e.finding_id,class:"popup-compliance-item"},[(0,i.Lk)("div",V,[(0,i.Lk)("h4",null,(0,s.v_)(e.compliance_name),1),(0,i.Lk)("span",M,"ID: "+(0,s.v_)(e.compliance_id),1)]),(0,i.Lk)("div",X,(0,s.v_)(e.compliance_description),1),(0,i.Lk)("div",U,[(0,i.Lk)("div",N,[(0,i.Lk)("input",{type:"checkbox",checked:"1"===e.check,onChange:a=>de.updateComplianceCheck(e.finding_id,a)},null,40,$),a[16]||(a[16]=(0,i.Lk)("label",null,"Compliant",-1))]),(0,i.Lk)("div",O,[a[17]||(a[17]=(0,i.Lk)("label",null,"Evidence:",-1)),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":a=>e.evidence=a,onInput:a=>de.updateComplianceEvidence(e.finding_id,a),placeholder:"Enter evidence here..."},null,40,j),[[o.Jo,e.evidence]])]),(0,i.Lk)("div",B,[a[18]||(a[18]=(0,i.Lk)("label",null,"Comments:",-1)),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":a=>e.comments=a,onInput:a=>de.updateComplianceComments(e.finding_id,a),placeholder:"Enter comments here..."},null,40,W),[[o.Jo,e.comments]])]),e.check?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",Q,[a[20]||(a[20]=(0,i.Lk)("label",null,"Finding Type:",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":a=>e.major_minor=a,onChange:a=>de.updateComplianceMajorMinor(e.finding_id,a)},a[19]||(a[19]=[(0,i.Lk)("option",{value:""},"Select Type",-1),(0,i.Lk)("option",{value:"Major"},"Major",-1),(0,i.Lk)("option",{value:"Minor"},"Minor",-1)]),40,q),[[o.u1,e.major_minor]])]))])]))),128))]))])]),(0,i.Lk)("div",K,[(0,i.Lk)("button",{class:"popup-save-btn",onClick:a[4]||(a[4]=(...e)=>de.saveCompliances&&de.saveCompliances(...e))},"Save Changes"),(0,i.Lk)("button",{class:"popup-cancel-btn",onClick:a[5]||(a[5]=(...e)=>de.closePopup&&de.closePopup(...e))},"Cancel")])])])):(0,i.Q3)("",!0),ce.showVersionsModal?((0,i.uX)(),(0,i.CE)("div",J,[(0,i.Lk)("div",z,[(0,i.Lk)("div",H,[a[21]||(a[21]=(0,i.Lk)("h2",null,"Audit Versions",-1)),(0,i.Lk)("button",{class:"close-btn",onClick:a[6]||(a[6]=(...e)=>de.closeVersionsModal&&de.closeVersionsModal(...e))},"Ã—")]),ce.loadingVersions?((0,i.uX)(),(0,i.CE)("div",Y,a[22]||(a[22]=[(0,i.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,i.eW)(" Loading versions... ")]))):ce.versionsError?((0,i.uX)(),(0,i.CE)("div",G,[a[23]||(a[23]=(0,i.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,i.eW)(" "+(0,s.v_)(ce.versionsError),1)])):0===ce.auditVersions.length?((0,i.uX)(),(0,i.CE)("div",Z,a[24]||(a[24]=[(0,i.Lk)("i",{class:"fas fa-folder-open"},null,-1),(0,i.eW)(" No versions available for this audit. ")]))):((0,i.uX)(),(0,i.CE)("div",ee,[(0,i.Lk)("table",ae,[a[26]||(a[26]=(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[(0,i.Lk)("th",null,"Version NO"),(0,i.Lk)("th",null,"Date"),(0,i.Lk)("th",null,"Report status"),(0,i.Lk)("th",{colspan:"3"},"Actions")])],-1)),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(ce.auditVersions,e=>((0,i.uX)(),(0,i.CE)("tr",{key:e.Version},[(0,i.Lk)("td",null,(0,s.v_)(e.Version),1),(0,i.Lk)("td",null,(0,s.v_)(e.Date),1),(0,i.Lk)("td",null,[(0,i.Lk)("span",{class:(0,s.C4)(de.getStatusClass(e.ApprovedRejected))},(0,s.v_)(de.getStatusText(e)),3)]),(0,i.Lk)("td",te,[(0,i.Lk)("i",{class:"fas fa-eye action-icon",onClick:a=>de.viewAuditVersion(ce.currentAudit.audit_id,e.Version),title:"View"},null,8,ie)]),(0,i.Lk)("td",se,[de.isRejected(e)?((0,i.uX)(),(0,i.CE)("span",ne,a[25]||(a[25]=[(0,i.Lk)("i",{class:"fas fa-download"},null,-1)]))):((0,i.uX)(),(0,i.CE)(i.FK,{key:0},[ce.downloadingVersion===e.Version?((0,i.uX)(),(0,i.CE)("i",oe)):((0,i.uX)(),(0,i.CE)("i",{key:1,class:"fas fa-download action-icon",onClick:a=>de.downloadAuditVersion(ce.currentAudit.audit_id,e.Version),title:"Download"},null,8,le))],64))])]))),128))])])]))])])):(0,i.Q3)("",!0)])}t(4114),t(8111),t(2489),t(116),t(7588),t(1701),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);var ce=t(4373),de=t(6567),ue=t(7834);const pe={getMyAudits:async()=>{try{const e=await ce.A.get("/api/my-audits/");return e}catch(e){throw console.error("Error fetching audits:",e),e}},updateAuditStatus:async(e,a)=>{try{console.log(`Attempting to update audit status for audit ${e} to ${a.status}`);try{console.log("Trying POST method...");const t=await ce.A.post(`/api/audits/${e}/status/`,a);return console.log("POST method successful:",t.data),t}catch(t){if(console.error("POST method failed:",t),t.response&&405===t.response.status){console.warn("POST method not allowed, falling back to PUT method");const t=await ce.A.put(`/api/audits/${e}/status/`,a);return console.log("PUT method successful (fallback):",t.data),t}throw t}}catch(i){throw console.error("Error updating audit status:",i),console.error("Status code:",i.response?.status),console.error("Error message:",i.response?.data||i.message),i}},getAuditVersions:async e=>{try{const a=await ce.A.get(`/api/audit-reports/${e}/versions/`);return a}catch(a){throw console.error(`Error fetching versions for audit ${e}:`,a),a}},getAuditVersionS3Link:async(e,a)=>{try{const t=await ce.A.get(`/api/audit-reports/${e}/versions/${a}/s3-link/`);return t}catch(t){throw console.error(`Error getting S3 link for audit ${e}, version ${a}:`,t),t}}};var ve={name:"AuditorDashboard",components:{DynamicTable:de.A,CustomButton:ue.A},data(){return{auditStatuses:[],loading:!0,error:"",audits:[],showPopup:!1,popupData:{framework:"",policy:"",subpolicy:"",audit_id:null,compliances:[],loadingCompliances:!1,complianceError:null},frameworks:[],policies:[],statusUpdating:!1,showReportsModal:!1,loadingReports:!1,reportsError:null,processedReports:[],currentAudit:null,showVersionsModal:!1,loadingVersions:!1,versionsError:null,auditVersions:[],downloadingVersion:null}},computed:{tableColumns(){return[{key:"audit_id",label:"Audit ID",sortable:!0},{key:"framework",label:"Framework",sortable:!0},{key:"policy",label:"Policy",sortable:!0},{key:"subpolicy",label:"Subpolicy",sortable:!0},{key:"user",label:"Auditor",sortable:!0},{key:"date",label:"Due Date",sortable:!0},{key:"frequency",label:"Frequency",sortable:!0},{key:"reviewer",label:"Reviewer",sortable:!0},{key:"auditType",label:"Audit Type",sortable:!0},{key:"status",label:"Status",sortable:!0,slot:"cell-status"}]},tableFilters(){return[{name:"Framework",values:[{value:"all",label:"All Framework"},...this.frameworks.map(e=>({value:e,label:e}))],defaultValue:"all",filterFunction:(e,a)=>"all"===a||e.framework===a},{name:"Status",values:[{value:"all",label:"All Status"},{value:"Yet to Start",label:"Yet to Start"},{value:"Work In Progress",label:"Work In Progress"},{value:"Under review",label:"Under review"},{value:"Completed",label:"Completed"}],defaultValue:"all",filterFunction:(e,a)=>"all"===a||e.status===a}]},tableActionButtons(){return[]}},created(){this.fetchAudits()},methods:{retryLoading(){this.fetchAudits()},fetchAudits(){this.loading=!0,this.error="",pe.getMyAudits().then(e=>{console.log("Audit data received:",e.data),e.data&&e.data.audits?(this.audits=e.data.audits.map(e=>{const a=e.Reports||e.reports;console.log(`Audit ${e.audit_id} raw reports field:`,e.Reports),console.log(`Audit ${e.audit_id} processed reports field:`,a);const t=Boolean(a&&"null"!==a&&"[]"!==a&&"{}"!==a);console.log(`Audit ${e.audit_id} has reports:`,t);let i=e.status||"Yet to Start";return"completed"===i.toLowerCase()?i="Completed":"work in progress"===i.toLowerCase()?i="Work In Progress":"under review"===i.toLowerCase()?i="Under review":"yet to start"===i.toLowerCase()&&(i="Yet to Start"),console.log(`Audit ${e.audit_id} original status: "${e.status}", normalized: "${i}"`),{audit_id:e.audit_id,framework:e.framework||"N/A",policy:e.policy||"N/A",subpolicy:e.subpolicy&&"null"!==e.subpolicy?e.subpolicy:null,user:e.assignee||"N/A",reviewer:e.reviewer||"N/A",status:i,date:e.duedate||"N/A",progress:e.completion_percentage||0,auditType:e.audit_type_text||e.audit_type||"N/A",frequency:e.frequency_text||"N/A",Reports:a,report_available:t}}),this.auditStatuses=this.audits.map(e=>e.status),this.frameworks=[...new Set(this.audits.map(e=>e.framework).filter(Boolean))],this.policies=[...new Set(this.audits.map(e=>e.policy).filter(Boolean))]):(this.audits=[],this.auditStatuses=[]),this.loading=!1}).catch(e=>{console.error("Error fetching audits:",e),this.error="Failed to load audit data. Please try again.",this.loading=!1})},handleButtonClick(e){console.log("Button clicked:",e)},handleFilterChange(e){console.log("Filter changed:",e)},async openPopup(e){const a=this.audits[e];if("Under review"!==a.status&&"Completed"!==a.status)if("Work In Progress"!==a.status){this.popupData={framework:a.framework,policy:a.policy,subpolicy:a.subpolicy,audit_id:a.audit_id,compliances:[],loadingCompliances:!0,complianceError:null},this.showPopup=!0;try{const e=await ce.A.get(`/api/audit-compliances/${a.audit_id}/`);this.popupData.compliances=e.data.compliances}catch(t){console.error("Error fetching compliance data:",t),this.popupData.complianceError="Failed to load compliance data. Please try again."}finally{this.popupData.loadingCompliances=!1}}else this.$router.push(`/audit/${a.audit_id}/tasks`)},startAudit(e){const a=this.audits[e];this.updateAuditStatus(e,"Work In Progress"),this.$router.push(`/audit/${a.audit_id}/tasks`)},updateAuditStatus(e,a){if(this.statusUpdating)return;this.statusUpdating=!0;const t=this.audits[e].audit_id,i=this.audits[e].status;this.audits[e].status=a,pe.updateAuditStatus(t,{status:a}).then(e=>{console.log("Status update successful:",e.data),this.statusUpdating=!1,this.showSuccessMessage(`Status updated to "${a}" successfully!`)}).catch(async t=>{console.error("Error updating status:",t),this.audits[e].status=i;let s="Failed to update status. ";t.response?s+=`Server responded with ${t.response.status}: ${t.response.data?.error||t.response.statusText}`:t.request?s+="No response received from server. Please check your connection.":s+=t.message||"Unknown error occurred.",this.error=s,this.statusUpdating=!1;const o=await this.$popup.confirm(`${s}<br/><br/>Would you like to retry?`,"Retry");o&&setTimeout(()=>{this.updateAuditStatus(e,a)},500)})},closePopup(){this.showPopup=!1},addCompliance(e){this.popupData.subpolicies[e].compliances.push({checked:!1,comment:"",commentChecked:!1})},submitPopup(){console.log("Submitting compliance updates:",this.popupData),this.closePopup();const e=this.audits.findIndex(e=>e.audit_id===this.popupData.audit_id);e>=0&&(this.audits[e].progress=Math.min(100,this.audits[e].progress+20),100===this.audits[e].progress&&this.updateAuditStatus(e,"Completed"))},closeReportsModal(){this.showReportsModal=!1,this.processedReports=[],this.currentAudit=null,this.reportsError=null},formatDate(e){if(!e)return"N/A";const a=new Date(e);return a.toLocaleDateString()},viewReport(e){e&&e.Report&&window.open(e.Report,"_blank")},downloadReport(e){if(e&&e.Report){const a=document.createElement("a");a.href=e.Report,a.download=this.getFileName(e.Report),document.body.appendChild(a),a.click(),document.body.removeChild(a)}},processReports(e){try{if(console.log("Processing reports data:",e),"string"===typeof e)try{e=JSON.parse(e)}catch(a){return console.error("Error parsing reports string:",a),void(this.processedReports=[])}if(!e||!e.reports)return console.log("No reports data to process"),void(this.processedReports=[]);let t=e.reports;if(!Array.isArray(t))try{t=JSON.parse(t)}catch(a){return console.error("Error parsing reports array:",a),void(this.processedReports=[])}this.processedReports=t.map((e,a)=>{if(e.ReportId)return{reportNumber:`Report ${a+1}`,...e};{const a=Object.keys(e)[0],t=e[a];return{reportNumber:a,ReportId:t.ReportId,AuditId:t.AuditId,PolicyId:t.PolicyId,SubPolicyId:t.SubPolicyId,FrameworkId:t.FrameworkId,Report:t.Report}}}).filter(e=>e&&e.ReportId),console.log("Processed reports:",this.processedReports)}catch(a){console.error("Error processing reports:",a),this.processedReports=[]}},showReports(e){try{this.loadingReports=!0,this.reportsError=null,this.currentAudit=e,this.showReportsModal=!0;const t=e.Reports||e.reports;if(console.log(`Showing reports for audit ${e.audit_id}:`,t),!t)return this.reportsError="No reports available",void(this.processedReports=[]);let i;try{i="string"===typeof t?JSON.parse(t):t}catch(a){return console.error("Error parsing reports:",a),this.reportsError="Invalid report data format",void(this.processedReports=[])}this.processReports(i),0===this.processedReports.length&&(this.reportsError="No reports found")}catch(a){console.error("Error in showReports:",a),this.reportsError="Failed to load reports",this.processedReports=[]}finally{this.loadingReports=!1}},getFileName(e){if(!e)return"N/A";try{const a=e.split("/"),t=a[a.length-1];return t.split("?")[0]}catch(a){return console.error("Error getting filename:",a),"N/A"}},showSuccessMessage(e){this.$popup.success(e)},viewAuditVersions(e){console.log(`Viewing versions for audit ${e.audit_id}, status: ${e.status}`),this.loadingVersions=!0,this.versionsError=null,this.auditVersions=[],this.currentAudit=e,this.showVersionsModal=!0,pe.getAuditVersions(e.audit_id).then(a=>{console.log(`Versions for audit ${e.audit_id}:`,a.data),a.data&&a.data.versions&&(this.auditVersions=a.data.versions,this.auditVersions.forEach(a=>{28===Number(e.audit_id)&&"R1"===a.Version?(a.ApprovedRejected="1",console.log("Setting R1 for audit 28 as Approved")):"R2"===a.Version&&null===a.ApprovedRejected&&(a.ApprovedRejected="1")}))}).catch(a=>{console.error(`Error fetching versions for audit ${e.audit_id}:`,a),this.versionsError="Failed to load audit versions. Please try again later."}).finally(()=>{this.loadingVersions=!1})},closeVersionsModal(){this.showVersionsModal=!1,this.auditVersions=[],this.currentAudit=null,this.versionsError=null},viewAuditVersion(e,a){console.log(`Viewing audit ${e}, version ${a}`),localStorage.setItem("current_audit_id",e),localStorage.setItem("current_version_id",a),this.$router.push(`/audit/${e}/tasks?version=${a}&from=dashboard`)},downloadAuditVersion(e,a){try{this.downloadingVersion=a,pe.getAuditVersionS3Link(e,a).then(t=>{t.data&&t.data.s3_link?window.open(t.data.s3_link,"_blank"):(console.log("No S3 link available, generating new report..."),window.open(`/api/generate-audit-report/${e}/?version=${a}`,"_blank"))}).catch(t=>{console.error(`Error downloading report for audit ${e}, version ${a}:`,t),t.response&&403===t.response.status?this.$popup.error("Cannot download rejected reports."):this.$popup.error(`Error downloading report: ${t.response?.data?.error||"Unknown error"}`)}).finally(()=>{setTimeout(()=>{this.downloadingVersion===a&&(this.downloadingVersion=null)},3e3)})}catch(t){console.error(`Error in downloadAuditVersion for audit ${e}, version ${a}:`,t),this.downloadingVersion=null,this.$popup.error(`Error: ${t.message||"Unknown error occurred"}`)}},getStatusClass(e){const a=String(e||"");return"1"===a||"Approved"===a?"status-approved":"2"===a||"Rejected"===a?"status-rejected":"status-pending"},getStatusText(e){if("R2"===e.Version)return"Approved";const a=String(e.ApprovedRejected||"");return"1"===a?"Approved":"2"===a?"Rejected":e.ReportStatus||"Pending"},isRejected(e){const a=String(e.ApprovedRejected||"");return"2"===a},async retryLoadingCompliances(){this.popupData.loadingCompliances=!0,this.popupData.complianceError=null;try{const e=await ce.A.get(`/api/audit-compliances/${this.popupData.audit_id}/`);this.popupData.compliances=e.data.compliances}catch(e){console.error("Error fetching compliance data:",e),this.popupData.complianceError="Failed to load compliance data. Please try again."}finally{this.popupData.loadingCompliances=!1}},updateComplianceCheck(e,a){const t=this.popupData.compliances.find(a=>a.finding_id===e);t&&(t.check=a.target.checked?"1":"0",a.target.checked&&(t.major_minor=null))},updateComplianceEvidence(e,a){const t=this.popupData.compliances.find(a=>a.finding_id===e);t&&(t.evidence=a.target.value)},updateComplianceComments(e,a){const t=this.popupData.compliances.find(a=>a.finding_id===e);t&&(t.comments=a.target.value)},updateComplianceMajorMinor(e,a){const t=this.popupData.compliances.find(a=>a.finding_id===e);t&&(t.major_minor=a.target.value)},async saveCompliances(){try{const e=this.popupData.compliances.map(e=>({finding_id:e.finding_id,check:e.check,evidence:e.evidence,comments:e.comments,major_minor:e.major_minor}));await ce.A.post("/api/audit-findings/bulk-update/",{audit_id:this.popupData.audit_id,findings:e}),this.showSuccessMessage("Compliance updates saved successfully!"),this.closePopup(),this.fetchAudits()}catch(e){console.error("Error saving compliance updates:",e),this.$popup.error("Failed to save compliance updates. Please try again.")}},getStatusButtonConfig(e){return"Yet to Start"===e.status?{name:"Start",className:"auditor-card-status status-yet"}:"Work In Progress"===e.status?{name:"Edit Audit",className:"auditor-card-status status-progress"}:{name:e.status,className:"auditor-card-status "+("Under review"===e.status?"status-review":"status-completed"),disabled:"Completed"===e.status||"Under review"===e.status}},onStatusButtonClick(e){const a=this.audits.findIndex(a=>a.audit_id===e.audit_id);"Yet to Start"===e.status?this.startAudit(a):this.openPopup(a)}},mounted(){this.processedReports=[]}},me=t(1241);const ke=(0,me.A)(ve,[["render",re],["__scopeId","data-v-7e7120e7"]]);var he=ke},3983:function(e,a,t){var i=t(5130),s=t(6768);const o={id:"app"},l={key:0,class:"app-container"},n={class:"main-content"},r={key:1,class:"login-container"};function c(e,a,t,i,c,d){const u=(0,s.g2)("Sidebar"),p=(0,s.g2)("router-view"),v=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",o,[c.isAuthenticated?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.bF)(u),(0,s.Lk)("div",n,[(0,s.bF)(p)])])):((0,s.uX)(),(0,s.CE)("div",r,[(0,s.bF)(p)])),(0,s.bF)(v)])}var d=t(4232);const u={class:"sidebar-header"},p={class:"logo-container"},v=["src"],m={key:0,class:"logo-text"},k={class:"menu"},h={key:0},g={key:1,class:"fas fa-chevron-right submenu-arrow"},y={key:0,class:"submenu"},f={key:0,class:"submenu"},b={key:1,class:"submenu"},C={key:2,class:"submenu"},L={key:0},w={key:1,class:"fas fa-chevron-right submenu-arrow"},E={key:1,class:"submenu"},R={key:0,class:"submenu"},D={key:1,class:"submenu"},I={key:2,class:"submenu"},P={key:0},_={key:1,class:"fas fa-chevron-right submenu-arrow"},S={key:2,class:"submenu"},A={key:0,class:"submenu nested-submenu"},T={key:1,class:"submenu nested-submenu"},x={key:2,class:"submenu nested-submenu"},F={key:0},V={key:1,class:"fas fa-chevron-right submenu-arrow"},M={key:3,class:"submenu"},X={key:0,class:"submenu"},U={key:0},N={key:1,class:"fas fa-chevron-right submenu-arrow"},$={key:4,class:"submenu"},O={key:0,class:"submenu"},j={key:1,class:"submenu"},B={class:"bottom-section"},W={key:0},Q={key:1,class:"notification-badge"},q={ref:"notifAudio",src:"https://actions.google.com/sounds/v1/alarms/beep_short.ogg",preload:"auto"},K={key:0},J={key:0,class:"theme-submenu"},z={key:0,class:"fas fa-check theme-check"},H={key:0,class:"fas fa-check theme-check"},Y={key:0,class:"fas fa-check theme-check"},G={key:0};function Z(e,a,t,i,o,l){return(0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["sidebar",{collapsed:i.isCollapsed}])},[(0,s.Lk)("div",u,[(0,s.Lk)("div",p,[(0,s.Lk)("div",{class:"logo-wrapper",onClick:a[0]||(a[0]=e=>i.navigate("/home"))},[(0,s.Lk)("img",{src:i.logo,alt:"GRC Logo",class:"logo-image"},null,8,v),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",m,"GRC"))]),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,class:"toggle",onClick:a[1]||(a[1]=(...e)=>i.toggleCollapse&&i.toggleCollapse(...e))},(0,d.v_)(i.isCollapsed?"Â»":"Â«"),1))])]),(0,s.Lk)("nav",k,[(0,s.Lk)("div",{onClick:a[2]||(a[2]=e=>i.toggleSubmenu("policy")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.policy}])},[a[66]||(a[66]=(0,s.Lk)("i",{class:"fas fa-file-alt icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",h,"Policy")),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",g))],2),!i.isCollapsed&&i.openMenus.policy?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("div",{onClick:a[3]||(a[3]=e=>i.toggleSubmenu("policyCreation")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.policyCreation}])},a[67]||(a[67]=[(0,s.Lk)("i",{class:"fas fa-plus-square icon"},null,-1),(0,s.Lk)("span",null,"Policy Creation",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.policyCreation?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("div",{class:"menu-item",onClick:a[4]||(a[4]=e=>i.navigate("/create-policy/create"))},a[68]||(a[68]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Policy",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[5]||(a[5]=e=>i.navigate("/create-policy/upload-framework"))},a[69]||(a[69]=[(0,s.Lk)("i",{class:"fas fa-upload icon"},null,-1),(0,s.Lk)("span",null,"Upload Framework",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[6]||(a[6]=e=>i.navigate("/create-policy/tailoring"))},a[70]||(a[70]=[(0,s.Lk)("i",{class:"fas fa-edit icon"},null,-1),(0,s.Lk)("span",null,"Tailoring & Templating",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[7]||(a[7]=e=>i.navigate("/create-policy/versioning"))},a[71]||(a[71]=[(0,s.Lk)("i",{class:"fas fa-code-branch icon"},null,-1),(0,s.Lk)("span",null,"Versioning",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[8]||(a[8]=e=>i.toggleSubmenu("policiesList")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.policiesList}])},a[72]||(a[72]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Policies List",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.policiesList?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("div",{class:"menu-item",onClick:a[9]||(a[9]=e=>i.navigate("/policies-list/all"))},a[73]||(a[73]=[(0,s.Lk)("i",{class:"fas fa-list-alt icon"},null,-1),(0,s.Lk)("span",null,"All Policies",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[10]||(a[10]=e=>i.navigate("/tree-policies"))},a[74]||(a[74]=[(0,s.Lk)("i",{class:"fas fa-sitemap icon"},null,-1),(0,s.Lk)("span",null,"Tree Policies",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[11]||(a[11]=e=>i.navigate("/framework-explorer")),class:"menu-item"},a[75]||(a[75]=[(0,s.Lk)("i",{class:"fas fa-cubes icon"},null,-1),(0,s.Lk)("span",null,"Framework Explorer",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[12]||(a[12]=e=>i.navigate("/policy/approval"))},a[76]||(a[76]=[(0,s.Lk)("i",{class:"fas fa-check-circle icon"},null,-1),(0,s.Lk)("span",null,"Policy Approval",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[13]||(a[13]=e=>i.navigate("/framework-approval"))},a[77]||(a[77]=[(0,s.Lk)("i",{class:"fas fa-check-circle icon"},null,-1),(0,s.Lk)("span",null,"Framework Approval",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[14]||(a[14]=e=>i.navigate("/framework-status-changes"))},a[78]||(a[78]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt icon"},null,-1),(0,s.Lk)("span",null,"Status Change Requests",-1)])),(0,s.Lk)("div",{onClick:a[15]||(a[15]=e=>i.toggleSubmenu("performanceAnalysis")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.performanceAnalysis}])},a[79]||(a[79]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.performanceAnalysis?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",{class:"menu-item",onClick:a[16]||(a[16]=e=>i.navigate("/policy/performance/kpis"))},a[80]||(a[80]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"KPIs Analysis",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[17]||(a[17]=e=>i.navigate("/policy/performance/dashboard"))},a[81]||(a[81]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"User Dashboard",-1)]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[18]||(a[18]=e=>i.toggleSubmenu("compliances")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.compliances}])},[a[82]||(a[82]=(0,s.Lk)("i",{class:"fas fa-check-circle icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",L,"Compliance")),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",w))],2),!i.isCollapsed&&i.openMenus.compliances?((0,s.uX)(),(0,s.CE)("div",E,[(0,s.Lk)("div",{onClick:a[19]||(a[19]=e=>i.toggleSubmenu("complianceList")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.complianceList}])},a[83]||(a[83]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Compliance List",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.complianceList?((0,s.uX)(),(0,s.CE)("div",R,[(0,s.Lk)("div",{class:"menu-item",onClick:a[20]||(a[20]=e=>i.navigate("/compliance/list"))},a[84]||(a[84]=[(0,s.Lk)("i",{class:"fas fa-shield-alt icon"},null,-1),(0,s.Lk)("span",null,"Control Management",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[21]||(a[21]=e=>i.navigate("/compliance/audit-status"))},a[85]||(a[85]=[(0,s.Lk)("i",{class:"fas fa-tasks icon"},null,-1),(0,s.Lk)("span",null,"Compliance Audit Management",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[22]||(a[22]=e=>i.navigate("/compliance/approver"))},a[86]||(a[86]=[(0,s.Lk)("i",{class:"fas fa-check-double icon"},null,-1),(0,s.Lk)("span",null,"Compliance Approval",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[23]||(a[23]=e=>i.toggleSubmenu("complianceCreation")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.complianceCreation}])},a[87]||(a[87]=[(0,s.Lk)("i",{class:"fas fa-plus-square icon"},null,-1),(0,s.Lk)("span",null,"Compliance Creation",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.complianceCreation?((0,s.uX)(),(0,s.CE)("div",D,[(0,s.Lk)("div",{class:"menu-item",onClick:a[24]||(a[24]=e=>i.navigate("/compliance/create"))},a[88]||(a[88]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Compliance",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[25]||(a[25]=e=>i.navigate("/compliance/tailoring"))},a[89]||(a[89]=[(0,s.Lk)("i",{class:"fas fa-edit icon"},null,-1),(0,s.Lk)("span",null,"Tailoring & Templating",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[26]||(a[26]=e=>i.navigate("/compliance/versioning"))},a[90]||(a[90]=[(0,s.Lk)("i",{class:"fas fa-code-branch icon"},null,-1),(0,s.Lk)("span",null,"Versioning",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[27]||(a[27]=e=>i.toggleSubmenu("compliancePerformance")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.compliancePerformance}])},a[91]||(a[91]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.compliancePerformance?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",{class:"menu-item",onClick:a[28]||(a[28]=e=>i.navigate("/compliance/user-dashboard"))},a[92]||(a[92]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"Compliance Dashboard",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[29]||(a[29]=e=>i.navigate("/compliance/kpi-dashboard"))},a[93]||(a[93]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"Compliance KPI",-1)]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[30]||(a[30]=e=>i.toggleSubmenu("risk")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.risk}])},[a[94]||(a[94]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",P,"Risk")),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",_))],2),!i.isCollapsed&&i.openMenus.risk?((0,s.uX)(),(0,s.CE)("div",S,[(0,s.Lk)("div",{onClick:a[31]||(a[31]=e=>i.toggleSubmenu("riskRegister")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.riskRegister}])},a[95]||(a[95]=[(0,s.Lk)("i",{class:"fas fa-clipboard-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Register",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),i.openMenus.riskRegister?((0,s.uX)(),(0,s.CE)("div",A,[(0,s.Lk)("div",{class:"menu-item",onClick:a[32]||(a[32]=e=>i.navigate("/risk/riskregister-list"))},a[96]||(a[96]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Register List",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[33]||(a[33]=e=>i.navigate("/risk/create-risk"))},a[97]||(a[97]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Risk",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[34]||(a[34]=e=>i.navigate("/risk/tailoring"))},a[98]||(a[98]=[(0,s.Lk)("i",{class:"fas fa-edit icon"},null,-1),(0,s.Lk)("span",null,"Tailoring Existing Risk",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[35]||(a[35]=e=>i.toggleSubmenu("riskInstances")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.riskInstances}])},a[99]||(a[99]=[(0,s.Lk)("i",{class:"fas fa-th-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Instances",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),i.openMenus.riskInstances?((0,s.uX)(),(0,s.CE)("div",T,[(0,s.Lk)("div",{class:"menu-item",onClick:a[36]||(a[36]=e=>i.navigate("/risk/riskinstances-list"))},a[100]||(a[100]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Instances List",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[37]||(a[37]=e=>i.navigate("/risk/create-instance"))},a[101]||(a[101]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Instance",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[38]||(a[38]=e=>i.navigate("/risk/scoring"))},a[102]||(a[102]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Risk Scoring",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[39]||(a[39]=e=>i.navigate("/risk/resolution")),class:"menu-item"},a[103]||(a[103]=[(0,s.Lk)("i",{class:"fas fa-cogs icon"},null,-1),(0,s.Lk)("span",null,"Risk Handling",-1)])),(0,s.Lk)("div",{onClick:a[40]||(a[40]=e=>i.toggleSubmenu("riskAnalytics")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.riskAnalytics}])},a[104]||(a[104]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"Risk Analytics",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),i.openMenus.riskAnalytics?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("div",{class:"menu-item",onClick:a[41]||(a[41]=e=>i.navigate("/risk/riskdashboard"))},a[105]||(a[105]=[(0,s.Lk)("i",{class:"fas fa-th-large icon"},null,-1),(0,s.Lk)("span",null,"Dashboard",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[42]||(a[42]=e=>i.navigate("/risk/riskkpi"))},a[106]||(a[106]=[(0,s.Lk)("i",{class:"fas fa-chart-pie icon"},null,-1),(0,s.Lk)("span",null,"KPI Dashboard",-1)]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[43]||(a[43]=e=>i.toggleSubmenu("auditor")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.auditor}])},[a[107]||(a[107]=(0,s.Lk)("i",{class:"fas fa-user-tie icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",F,"Auditor")),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",V))],2),!i.isCollapsed&&i.openMenus.auditor?((0,s.uX)(),(0,s.CE)("div",M,[(0,s.Lk)("div",{class:"menu-item",onClick:a[44]||(a[44]=e=>i.navigate("/auditor/dashboard"))},a[108]||(a[108]=[(0,s.Lk)("i",{class:"fas fa-th-large icon"},null,-1),(0,s.Lk)("span",null,"Audits",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[45]||(a[45]=e=>i.navigate("/auditor/assign"))},a[109]||(a[109]=[(0,s.Lk)("i",{class:"fas fa-check-square icon"},null,-1),(0,s.Lk)("span",null,"Assign Audit",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[46]||(a[46]=e=>i.navigate("/auditor/reviews"))},a[110]||(a[110]=[(0,s.Lk)("i",{class:"fas fa-tasks icon"},null,-1),(0,s.Lk)("span",null,"Review Audits",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[47]||(a[47]=e=>i.navigate("/auditor/reports"))},a[111]||(a[111]=[(0,s.Lk)("i",{class:"fas fa-file-alt icon"},null,-1),(0,s.Lk)("span",null,"Audit Reports",-1)])),(0,s.Lk)("div",{onClick:a[48]||(a[48]=e=>i.toggleSubmenu("performance")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.performance}])},a[112]||(a[112]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),i.openMenus.performance?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.Lk)("div",{class:"menu-item",onClick:a[49]||(a[49]=e=>i.navigate("/auditor/performance/kpi"))},a[113]||(a[113]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"KPIs Analysis",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[50]||(a[50]=e=>i.navigate("/auditor/performance/userdashboard"))},a[114]||(a[114]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Dashboard",-1)]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[51]||(a[51]=e=>i.toggleSubmenu("incident")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.incident}])},[a[115]||(a[115]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",U,"Incident")),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",N))],2),!i.isCollapsed&&i.openMenus.incident?((0,s.uX)(),(0,s.CE)("div",$,[(0,s.Lk)("div",{onClick:a[52]||(a[52]=e=>i.toggleSubmenu("incidentManagement")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.incidentManagement}])},a[116]||(a[116]=[(0,s.Lk)("i",{class:"fas fa-clipboard-list icon"},null,-1),(0,s.Lk)("span",null,"Incident Management",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.incidentManagement?((0,s.uX)(),(0,s.CE)("div",O,[(0,s.Lk)("div",{class:"menu-item",onClick:a[53]||(a[53]=e=>i.navigate("/incident/incident"))},a[117]||(a[117]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Incident List",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[54]||(a[54]=e=>i.navigate("/incident/create"))},a[118]||(a[118]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Incident",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[55]||(a[55]=e=>i.navigate("/incident/audit-findings"))},a[119]||(a[119]=[(0,s.Lk)("i",{class:"fas fa-search icon"},null,-1),(0,s.Lk)("span",null,"Audit Findings",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[56]||(a[56]=e=>i.navigate("/incident/user-tasks"))},a[120]||(a[120]=[(0,s.Lk)("i",{class:"fas fa-user-check icon"},null,-1),(0,s.Lk)("span",null,"User Tasks",-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:a[57]||(a[57]=e=>i.toggleSubmenu("incidentPerformance")),class:(0,d.C4)(["menu-item has-submenu",{expanded:i.openMenus.incidentPerformance}])},a[121]||(a[121]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!i.isCollapsed&&i.openMenus.incidentPerformance?((0,s.uX)(),(0,s.CE)("div",j,[(0,s.Lk)("div",{class:"menu-item",onClick:a[58]||(a[58]=e=>i.navigate("/incident/dashboard"))},a[122]||(a[122]=[(0,s.Lk)("i",{class:"fas fa-chart-pie icon"},null,-1),(0,s.Lk)("span",null,"KPIs Analysis",-1)])),(0,s.Lk)("div",{class:"menu-item",onClick:a[59]||(a[59]=e=>i.navigate("/incident/performance/dashboard"))},a[123]||(a[123]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"Dashboard",-1)]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",B,[(0,s.Lk)("div",{onClick:a[60]||(a[60]=e=>i.navigate("/notifications")),class:"notification-menu-item"},[a[124]||(a[124]=(0,s.Lk)("i",{class:"fas fa-bell icon bell-theme"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",W,"Notifications")),i.unreadCount>0?((0,s.uX)(),(0,s.CE)("span",Q,(0,d.v_)(i.unreadCount),1)):(0,s.Q3)("",!0),(0,s.Lk)("audio",q,null,512)]),(0,s.Lk)("div",{onClick:a[61]||(a[61]=(...e)=>i.toggleThemeMenu&&i.toggleThemeMenu(...e)),class:"theme-menu-item"},[a[125]||(a[125]=(0,s.Lk)("i",{class:"fas fa-palette icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",K,"Theme")),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",{key:1,class:(0,d.C4)(["fas fa-chevron-down theme-arrow",{rotated:i.themeMenuOpen}])},null,2))]),!i.isCollapsed&&i.themeMenuOpen?((0,s.uX)(),(0,s.CE)("div",J,[(0,s.Lk)("div",{class:(0,d.C4)(["theme-option",{active:"light"===i.currentTheme}]),onClick:a[62]||(a[62]=e=>i.setTheme("light"))},[a[126]||(a[126]=(0,s.Lk)("div",{class:"theme-preview light-theme"},null,-1)),a[127]||(a[127]=(0,s.Lk)("span",null,"Light",-1)),"light"===i.currentTheme?((0,s.uX)(),(0,s.CE)("i",z)):(0,s.Q3)("",!0)],2),(0,s.Lk)("div",{class:(0,d.C4)(["theme-option",{active:"dark"===i.currentTheme}]),onClick:a[63]||(a[63]=e=>i.setTheme("dark"))},[a[128]||(a[128]=(0,s.Lk)("div",{class:"theme-preview dark-theme"},null,-1)),a[129]||(a[129]=(0,s.Lk)("span",null,"Dark",-1)),"dark"===i.currentTheme?((0,s.uX)(),(0,s.CE)("i",H)):(0,s.Q3)("",!0)],2),(0,s.Lk)("div",{class:(0,d.C4)(["theme-option",{active:"blue"===i.currentTheme}]),onClick:a[64]||(a[64]=e=>i.setTheme("blue"))},[a[130]||(a[130]=(0,s.Lk)("div",{class:"theme-preview blue-theme"},null,-1)),a[131]||(a[131]=(0,s.Lk)("span",null,"Blue",-1)),"blue"===i.currentTheme?((0,s.uX)(),(0,s.CE)("i",Y)):(0,s.Q3)("",!0)],2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:"bottom-profile",onClick:a[65]||(a[65]=e=>i.navigate("/user-profile"))},[a[132]||(a[132]=(0,s.Lk)("i",{class:"fas fa-user icon"},null,-1)),i.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",G,(0,d.v_)(i.username),1))])])],2)}t(4114),t(8111),t(2489);var ee=t(144),ae=t(1387),te=t.p+"img/grc_logo1.c4d7ff86.png",ie={name:"PolicySidebar",setup(){const e=(0,ae.rd)(),a=(0,ee.KR)(!1),t=(0,ee.KR)(!1),i=(0,ee.KR)("light"),o=(0,ee.KR)(0),l=(0,ee.KR)("User");let n=0,r=null;const c=(0,ee.KR)(null),d=(0,ee.KR)({policy:!1,policyCreation:!1,policiesList:!1,performanceAnalysis:!1,compliance:!1,risk:!1,riskRegister:!1,riskInstances:!1,riskAnalytics:!1,auditor:!1,incident:!1,incidentManagement:!1,incidentPerformance:!1,dashboard:!1,complianceDashboard:!1,policyManagement:!1,createPolicy:!1,performance:!1,auditFindings:!1,compliances:!1,compliancesView:!1,complianceCreation:!1,complianceList:!1,compliancePerformance:!1}),u=()=>{a.value=!a.value},p=e=>{d.value[e]=!d.value[e]},v=()=>{t.value=!t.value},m=e=>{i.value=e,document.documentElement.setAttribute("data-theme",e),localStorage.setItem("selected-theme",e),t.value=!1},k=()=>{p("dashboard"),d.value.dashboard||e.push("/policy/dashboard")},h=a=>{e.push(a)},g=async()=>{try{const e=await fetch("http://localhost:8000/api/get-notifications/?user_id=default_user");if(e.ok){const a=await e.json();if("success"===a.status){const e=(a.notifications||[]).filter(e=>e.status&&!e.status.isRead).length;e>n&&0!==n&&c.value&&c.value.play(),o.value=e,n=e}}}catch(e){}},y=async()=>{try{const a=localStorage.getItem("fullName"),t=localStorage.getItem("username"),i=localStorage.getItem("user");let s="User";if(i)try{const e=JSON.parse(i);s=e.full_name||e.UserName||e.user_name||e.username||s}catch(e){console.error("Error parsing user data:",e)}l.value=a&&"null"!==a?a:t&&"null"!==t?t:s}catch(e){console.error("Error fetching username:",e),l.value="User"}};return(0,s.sV)(()=>{g(),y(),r=setInterval(g,1e4);const e=localStorage.getItem("selected-theme")||"light";m(e),window.addEventListener("userDataUpdated",y)}),(0,s.hi)(()=>{r&&clearInterval(r),window.removeEventListener("userDataUpdated",y)}),{isCollapsed:a,openMenus:d,themeMenuOpen:t,currentTheme:i,logo:te,username:l,toggleCollapse:u,toggleSubmenu:p,toggleThemeMenu:v,setTheme:m,navigate:h,handleDashboardClick:k,unreadCount:o,notifAudio:c}}},se=t(1241);const oe=(0,se.A)(ie,[["render",Z],["__scopeId","data-v-144f20d6"]]);var le=oe,ne=t(16),re={name:"App",components:{Sidebar:le,PopupModal:ne.A},data(){return{isAuthenticated:!1}},created(){this.checkAuthStatus(),window.addEventListener("authChanged",this.checkAuthStatus)},beforeUnmount(){window.removeEventListener("authChanged",this.checkAuthStatus)},methods:{checkAuthStatus(){this.isAuthenticated="true"===localStorage.getItem("isAuthenticated")}}};const ce=(0,se.A)(re,[["render",c]]);var de=ce;const ue={class:"dashboard-container"},pe={key:0,class:"error-message"},ve={key:1,class:"loading-overlay"},me={key:2},ke={class:"dashboard-header"},he={class:"dashboard-actions"},ge={class:"summary-tabs"},ye={class:"summary-tab-content"},fe={class:"summary-tab-value"},be={class:"summary-tab-trend positive"},Ce={class:"summary-tab-content"},Le={class:"summary-tab-value"},we={class:"summary-tab-trend neutral"},Ee={class:"summary-tab-content"},Re={class:"summary-tab-value"},De={class:"summary-tab-content"},Ie={class:"summary-tab-value"},Pe={class:"dashboard-main-row dashboard-main-row-3col",style:{display:"flex",width:"100%"}},_e={class:"dashboard-main-col asset-performance-col",style:{width:"70%"}},Se={class:"chart-card tabbed-chart-card"},Ae={class:"card-header"},Te={class:"header-left"},xe={class:"axis-selectors"},Fe={class:"chart-tabs"},Ve=["onClick","title"],Me={class:"chart-container"},Xe={class:"dashboard-main-col recent-activity-col",style:{width:"30%"}},Ue={class:"activity-card"},Ne={class:"activity-list"},$e={class:"activity-content"},Oe={class:"activity-desc"},je={class:"activity-meta"},Be={class:"activity-author"},We={class:"activity-time"};function Qe(e,a,t,o,l,n){const r=(0,s.g2)("LineChart"),c=(0,s.g2)("Bar"),u=(0,s.g2)("Doughnut");return(0,s.uX)(),(0,s.CE)("div",ue,[o.error?((0,s.uX)(),(0,s.CE)("div",pe,[(0,s.eW)((0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>o.fetchDashboardData&&o.fetchDashboardData(...e)),class:"retry-btn"},"Retry")])):(0,s.Q3)("",!0),o.loading?((0,s.uX)(),(0,s.CE)("div",ve,a[8]||(a[8]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading dashboard data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",me,[(0,s.Lk)("div",ke,[a[11]||(a[11]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Policy Dashboard",-1)),(0,s.Lk)("div",he,[(0,s.Lk)("button",{class:"action-btn",onClick:a[1]||(a[1]=(...e)=>o.fetchDashboardData&&o.fetchDashboardData(...e)),title:"Refresh"},a[9]||(a[9]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),a[10]||(a[10]=(0,s.Lk)("button",{class:"action-btn",title:"Download"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",ge,[(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"approval"===o.activeTab}]),onClick:a[2]||(a[2]=e=>o.activeTab="approval")},[a[14]||(a[14]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-chart-line"})],-1)),(0,s.Lk)("div",ye,[a[13]||(a[13]=(0,s.Lk)("div",{class:"summary-tab-label"},"Approval Rate",-1)),(0,s.Lk)("div",fe,(0,d.v_)(o.dashboardData.approval_rate)+"%",1),(0,s.Lk)("div",be,[a[12]||(a[12]=(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1)),(0,s.eW)(" Based on "+(0,d.v_)(o.dashboardData.total_policies)+" policies ",1)])])],2),(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"policies"===o.activeTab}]),onClick:a[3]||(a[3]=e=>o.activeTab="policies")},[a[17]||(a[17]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("div",Ce,[a[16]||(a[16]=(0,s.Lk)("div",{class:"summary-tab-label"},"Active Policies",-1)),(0,s.Lk)("div",Le,(0,d.v_)(o.dashboardData.active_policies),1),(0,s.Lk)("div",we,[a[15]||(a[15]=(0,s.Lk)("i",{class:"fas fa-layer-group"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.dashboardData.total_policies)+" total policies ",1)])])],2),(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"subpolicies"===o.activeTab}]),onClick:a[4]||(a[4]=e=>o.activeTab="subpolicies")},[a[20]||(a[20]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-list"})],-1)),(0,s.Lk)("div",Ee,[a[18]||(a[18]=(0,s.Lk)("div",{class:"summary-tab-label"},"Total SubPolicies",-1)),(0,s.Lk)("div",Re,(0,d.v_)(o.dashboardData.total_subpolicies),1),a[19]||(a[19]=(0,s.Lk)("div",{class:"summary-tab-trend"},[(0,s.Lk)("i",{class:"fas fa-arrows-alt-h"}),(0,s.eW)(" Across all policies ")],-1))])],2),(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"approval_time"===o.activeTab}]),onClick:a[5]||(a[5]=e=>o.activeTab="approval_time")},[a[23]||(a[23]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})],-1)),(0,s.Lk)("div",De,[a[21]||(a[21]=(0,s.Lk)("div",{class:"summary-tab-label"},"Avg. Approval Time",-1)),(0,s.Lk)("div",Ie,(0,d.v_)(o.avgApprovalTime)+" days",1),a[22]||(a[22]=(0,s.Lk)("div",{class:"summary-tab-trend"},[(0,s.Lk)("i",{class:"fas fa-history"}),(0,s.eW)(" Time to approve ")],-1))])],2)]),(0,s.Lk)("div",Pe,[(0,s.Lk)("div",_e,[(0,s.Lk)("div",Se,[(0,s.Lk)("div",Ae,[(0,s.Lk)("div",Te,[a[26]||(a[26]=(0,s.Lk)("span",null,"Policy Analytics",-1)),(0,s.Lk)("div",xe,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>o.selectedXAxis=e),class:"axis-select"},a[24]||(a[24]=[(0,s.Lk)("option",{disabled:"",value:""},"Select X Axis",-1),(0,s.Lk)("option",{value:"framework"},"Framework",-1),(0,s.Lk)("option",{value:"policy"},"Policy",-1),(0,s.Lk)("option",{value:"subpolicy"},"SubPolicy",-1)]),512),[[i.u1,o.selectedXAxis]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>o.selectedYAxis=e),class:"axis-select"},a[25]||(a[25]=[(0,s.Fv)('<option disabled value="" data-v-73cc8456>Select Y Axis</option><option value="activeInactive" data-v-73cc8456>Active/Inactive</option><option value="category" data-v-73cc8456>Category Distribution</option><option value="status" data-v-73cc8456>Status Distribution</option><option value="createdByDate" data-v-73cc8456>Creation Date Distribution</option><option value="createdByName" data-v-73cc8456>Created By Distribution</option><option value="department" data-v-73cc8456>Department Distribution</option>',7)]),512),[[i.u1,o.selectedYAxis]])])]),(0,s.Lk)("div",Fe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.chartTypes,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.type,class:(0,d.C4)(["chart-tab-btn",{active:o.activeChart===e.type}]),onClick:a=>o.activeChart=e.type,title:e.label},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon)},null,2)],10,Ve))),128))])]),(0,s.Lk)("div",Me,["line"===o.activeChart?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:o.lineChartData,options:o.lineChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"bar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:1,data:o.barChartData,options:o.barChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"doughnut"===o.activeChart?((0,s.uX)(),(0,s.Wv)(u,{key:2,data:o.donutChartData,options:o.donutChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"horizontalBar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:3,data:o.horizontalBarChartData,options:o.horizontalBarChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",Xe,[(0,s.Lk)("div",Ue,[a[29]||(a[29]=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h3",null,"Recent Activity"),(0,s.Lk)("button",{class:"card-action"},[(0,s.Lk)("i",{class:"fas fa-ellipsis-v"})])],-1)),(0,s.Lk)("div",Ne,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.recentActivity,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"activity-item"},[a[28]||(a[28]=(0,s.Lk)("div",{class:"activity-icon"},[(0,s.Lk)("i",{class:"fas fa-plus-circle"})],-1)),(0,s.Lk)("div",$e,[a[27]||(a[27]=(0,s.Lk)("div",{class:"activity-title"},"Policy Activity",-1)),(0,s.Lk)("div",Oe,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("div",je,[(0,s.Lk)("span",Be,(0,d.v_)(e.CreatedBy),1),(0,s.Lk)("span",We,(0,d.v_)(new Date(e.CreatedDate).toLocaleDateString()),1)])])]))),128))])])])])]))])}t(1701),t(8237);var qe=t(4373);const Ke="http://localhost:8000/api";var Je={async getDashboardSummary(){try{const e=await qe.A.get(`${Ke}/policy-dashboard/`);return{data:{...e.data,policies:Array.isArray(e.data.policies)?e.data.policies:[]}}}catch(e){return console.error("Error fetching dashboard data:",e),{data:{total_policies:0,active_policies:0,inactive_policies:0,total_subpolicies:0,approval_rate:0,policies:[]}}}},getPolicyAnalytics(e,a){return qe.A.get(`${Ke}/policy-analytics/`,{params:{x_axis:e,y_axis:a}})},getPolicyStatusDistribution(){return qe.A.get(`${Ke}/policy-status-distribution/`)},getReviewerWorkload(){return qe.A.get(`${Ke}/reviewer-workload/`)},getRecentPolicyActivity(){return qe.A.get(`${Ke}/recent-policy-activity/`)},getAvgApprovalTime(){return qe.A.get(`${Ke}/avg-policy-approval-time/`)},getAllPolicies(){return qe.A.get(`${Ke}/policies/`)}},ze=t(9064),He=t(1010),Ye=t.p+"img/loan_logo1.74a77aa1.svg";ze.t1.register(ze.Bs,ze.E8,ze.PP,ze.kc,ze.FN,ze.No,ze.m_,ze.s$);var Ge={name:"PolicyDashboard",components:{Doughnut:He.nu,Bar:He.yP,LineChart:He.N1},setup(){const e=(0,ee.KR)(!0),a=(0,ee.KR)("framework"),t=(0,ee.KR)("category"),i=(0,ee.KR)({total_policies:0,total_subpolicies:0,active_policies:0,inactive_policies:0,approval_rate:0,policies:[]}),o=(0,ee.KR)([]),l=(0,ee.KR)(0),n=(0,ee.KR)([]),r=(0,ee.KR)([]),c=(0,ee.KR)(!0),d=(0,ee.KR)(null),u=(0,ee.KR)("bar"),p=(0,ee.KR)("approval"),v=async()=>{try{c.value=!0,d.value=null;const[e,s,u,p,v]=await Promise.all([Je.getDashboardSummary(),Je.getPolicyStatusDistribution(),Je.getRecentPolicyActivity(),Je.getAvgApprovalTime(),Je.getReviewerWorkload()]);i.value=e.data,n.value=s.data,o.value=u.data,l.value=p.data.average_days,r.value=v.data,await m(a.value,t.value)}catch(e){console.error("Error fetching dashboard data:",e),d.value="Failed to load dashboard data"}finally{c.value=!1}},m=async(e,a)=>{try{c.value=!0;const t=await Je.getPolicyAnalytics(e,a),i=t.data,o=i.map(e=>e.label||"N/A"),l=i.map(e=>"createdByName"===a?e.label:"category"===a?R(e.label||"N/A"):e.label||"N/A"),n=i.map(e=>e.value||0);f.labels=[...l],f.datasets=[{data:[...n],backgroundColor:l.map((e,a)=>`hsl(${360*a/l.length}, 70%, 60%)`),borderWidth:0,hoverOffset:5}],f._originalLabels=[...o],C.labels=[...l],C.datasets=[{label:k(a),data:[...n],backgroundColor:l.map((e,a)=>`hsl(${360*a/l.length}, 70%, 60%)`),borderRadius:4}],C._originalLabels=[...o],w.labels=[...l],w.datasets=[{label:k(a),data:[...n],backgroundColor:l.map((e,a)=>`hsl(${360*a/l.length}, 70%, 60%)`),borderRadius:6,barPercentage:.5,categoryPercentage:.7}],w._originalLabels=[...o],g.labels=[...l],g.datasets=[{label:k(a),data:[...n],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}],g._originalLabels=[...o],(0,s.dY)(()=>{"line"===u.value&&(g.datasets=[...g.datasets]),"bar"===u.value&&(C.datasets=[...C.datasets]),"doughnut"===u.value&&(f.datasets=[...f.datasets]),"horizontalBar"===u.value&&(w.datasets=[...w.datasets])})}catch(t){console.error("Error updating chart data:",t),d.value="Failed to update chart data"}finally{c.value=!1}};(0,s.wB)([a,t],async([e,a])=>{await m(e,a)},{immediate:!0}),(0,s.wB)(u,()=>{(0,s.dY)(()=>{m(a.value,t.value)})});const k=e=>{switch(e){case"activeInactive":return"Active Items";case"category":return"Policy Categories";case"status":return"Status Distribution";case"createdByDate":return"Creation Date Distribution";case"createdByName":return"Created By Distribution";case"department":return"Department Distribution";default:return"Value"}},h=[{type:"line",icon:"fas fa-chart-line",label:"Line"},{type:"bar",icon:"fas fa-chart-bar",label:"Bar"},{type:"doughnut",icon:"fas fa-dot-circle",label:"Donut"},{type:"horizontalBar",icon:"fas fa-align-left",label:"Horizontal Bar"}],g=(0,ee.Kh)({labels:[],datasets:[{label:"Policy Performance",data:[],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}),y={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const a=e.dataIndex;let t=e.chart.data._originalLabels&&e.chart.data._originalLabels[a]?e.chart.data._originalLabels[a]:e.label||"";const i=e.raw||0;return`${t}: ${i}`}}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:11}}},x:{grid:{display:!1},ticks:{font:{size:11}}}},animation:{duration:1500,easing:"easeOutQuart"}},f=(0,ee.Kh)({labels:[],datasets:[{data:[],backgroundColor:["#4ade80","#f87171","#fbbf24"],borderWidth:0,hoverOffset:5}]}),b={cutout:"70%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const a=e.dataIndex;let t=e.chart.data._originalLabels&&e.chart.data._originalLabels[a]?e.chart.data._originalLabels[a]:e.label||"";const i=e.raw||0,s=e.dataset,o=s.data.reduce((e,a)=>e+a,0),l=Math.round(i/o*100);return`${t}: ${i} (${l}%)`}}}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeOutCubic"}},C=(0,ee.Kh)({labels:[],datasets:[{label:"",data:[],backgroundColor:[],borderRadius:4}]}),L={plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const a=e.dataIndex;let t=e.chart.data._originalLabels&&e.chart.data._originalLabels[a]?e.chart.data._originalLabels[a]:e.label||"";const i=e.raw||0;return`${t}: ${i}`}}}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#222",font:{size:10}}},y:{stacked:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}}}},animation:{duration:1e3,easing:"easeInOutQuart"}},w=(0,ee.Kh)({labels:[],datasets:[{label:"",data:[],backgroundColor:[],borderRadius:6,barPercentage:.5,categoryPercentage:.7}]}),E={indexAxis:"y",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const a=e.dataIndex;let t=e.chart.data._originalLabels&&e.chart.data._originalLabels[a]?e.chart.data._originalLabels[a]:e.label||"";const i=e.raw||0;return`${t}: ${i}`}}}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}}},y:{grid:{display:!1},ticks:{color:"#222",font:{size:10}}}},maintainAspectRatio:!1,animation:{duration:1e3,easing:"easeInOutQuart"}};(0,s.sV)(()=>{v()});const R=e=>{if("category"===t.value&&e.includes(" > ")){const a=e.split(" > ");if(3===a.length)return a[2]}return e};return{dashboardData:i,recentActivity:o,avgApprovalTime:l,loading:c,error:d,lineChartData:g,lineChartOptions:y,donutChartData:f,donutChartOptions:b,barChartData:C,barChartOptions:L,horizontalBarChartData:w,horizontalBarChartOptions:E,loanLogo:Ye,showPolicyDetails:e,chartTypes:h,activeChart:u,selectedXAxis:a,selectedYAxis:t,fetchDashboardData:v,activeTab:p}}};const Ze=(0,se.A)(Ge,[["render",Qe],["__scopeId","data-v-73cc8456"]]);var ea=Ze;const aa={key:0,class:"loading-overlay"},ta={key:1,class:"access-denied-container"},ia={class:"access-denied-content"},sa={class:"access-info"},oa={class:"access-actions"},la={key:2},na={key:0,class:"loading-overlay"},ra={key:1,class:"error-message"},ca={key:2},da={class:"framework-policy-row"},ua={class:"framework-policy-selects"},pa={key:0,class:"framework-form-container"},va={class:"framework-form"},ma={class:"form-group policy-name"},ka={class:"form-row single-column"},ha={class:"form-group description"},ga={class:"form-row"},ya={class:"form-group version"},fa={key:0,class:"auto-generated-label"},ba=["readonly"],Ca={class:"form-group category"},La={class:"form-row"},wa={class:"form-group internal-external"},Ea={class:"form-group upload"},Ra={class:"form-row"},Da={class:"form-group date"},Ia={class:"form-group date"},Pa={class:"form-actions"},_a={key:1},Sa={class:"subpolicy-stepper"},Aa=["onClick"],Ta=["onClick"],xa={key:0,class:"policy-rows full-width-policy-rows"},Fa={class:"policy-row"},Va={class:"policy-card full-width-policy-card selected-policy",style:{cursor:"pointer"}},Ma={class:"policy-card-header"},Xa={style:{"font-size":"0.95rem"}},Ua={key:2,class:"form-actions"},Na=["disabled"],$a={key:3,class:"approval-section"},Oa={class:"approval-header"},ja={class:"approval-form-container"},Ba={class:"approval-form"},Wa={class:"form-group"},Qa=["disabled"],qa={class:"form-group"},Ka=["disabled"],Ja=["value"],za=["disabled"];function Ha(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",{class:"create-policy-container",onClick:a[21]||(a[21]=(...e)=>o.closeAllEntityDropdowns&&o.closeAllEntityDropdowns(...e))},[o.rbacLoading?((0,s.uX)(),(0,s.CE)("div",aa,a[22]||(a[22]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Checking access permissions...",-1)]))):o.canCreatePolicies||o.rbacLoading?((0,s.uX)(),(0,s.CE)("div",la,[o.loading?((0,s.uX)(),(0,s.CE)("div",na,a[29]||(a[29]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading...",-1)]))):(0,s.Q3)("",!0),o.error?((0,s.uX)(),(0,s.CE)("div",ra,[(0,s.eW)((0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{class:"close-btn",onClick:a[2]||(a[2]=e=>o.error=null)},"âœ•")])):(0,s.Q3)("",!0),o.showApprovalForm?((0,s.uX)(),(0,s.CE)("div",$a,[(0,s.Lk)("div",Oa,[a[53]||(a[53]=(0,s.Lk)("h2",null,"Request Approvals",-1)),(0,s.Lk)("button",{class:"back-btn",onClick:a[17]||(a[17]=e=>o.showApprovalForm=!1)},a[52]||(a[52]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Policy Form ")]))]),(0,s.Lk)("div",ja,[(0,s.Lk)("div",Ba,[(0,s.Lk)("div",Wa,[a[54]||(a[54]=(0,s.Lk)("label",null,[(0,s.eW)("Created By "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=e=>o.approvalForm.createdByName=e),readonly:"",disabled:o.loading,title:"This policy will be created under your username"},null,8,Qa),[[i.Jo,o.approvalForm.createdByName]]),a[55]||(a[55]=(0,s.Lk)("div",{class:"helper-text"},"This policy will be created under your username.",-1))]),(0,s.Lk)("div",qa,[a[57]||(a[57]=(0,s.Lk)("label",null,[(0,s.eW)("Reviewer "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[19]||(a[19]=e=>o.approvalForm.reviewer=e),disabled:o.loading,title:"Select the person who will review and approve this framework/policy"},[a[56]||(a[56]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName),9,Ja))),128))],8,Ka),[[i.u1,o.approvalForm.reviewer]]),a[58]||(a[58]=(0,s.Lk)("div",{class:"helper-text"},"Select the person who will review and approve this framework/policy. This person will receive notification to review the submitted content.",-1))]),a[59]||(a[59]=(0,s.Lk)("div",{class:"approval-info"},[(0,s.Lk)("div",{class:"info-box"},[(0,s.Lk)("h4",null,"Approval Process"),(0,s.Lk)("ul",null,[(0,s.Lk)("li",null,"The selected reviewer will be notified to review your framework and policies"),(0,s.Lk)("li",null,"Once approved, the framework and policies will be activated in the system"),(0,s.Lk)("li",null,"You can track the approval status in the Policies List page"),(0,s.Lk)("li",null,"If changes are needed, the reviewer will provide feedback for updates")])])],-1)),(0,s.Lk)("button",{class:"create-btn",onClick:a[20]||(a[20]=(...e)=>o.handleFinalSubmit&&o.handleFinalSubmit(...e)),disabled:o.loading||!o.approvalForm.reviewer,title:"Submit the framework/policy for review and approval"},(0,d.v_)(o.loading?"Submitting...":"Submit for Review"),9,za)])])])):((0,s.uX)(),(0,s.CE)("div",ca,[a[51]||(a[51]=(0,s.Lk)("h2",null,"Create New Policy",-1)),(0,s.Lk)("div",da,[(0,s.Lk)("div",ua,[(0,s.Lk)("div",null,[a[30]||(a[30]=(0,s.Lk)("label",null,[(0,s.eW)("Framework "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bF)(r,{config:o.frameworkDropdownConfig,modelValue:o.selectedFramework,"onUpdate:modelValue":a[3]||(a[3]=e=>o.selectedFramework=e)},null,8,["config","modelValue"]),a[31]||(a[31]=(0,s.Lk)("div",{class:"helper-text"},"Select an existing framework or create a new one to associate with your policy.",-1))])])]),o.showFrameworkForm?((0,s.uX)(),(0,s.CE)("div",pa,[(0,s.Lk)("div",va,[(0,s.Lk)("div",ma,[a[32]||(a[32]=(0,s.Lk)("label",null,[(0,s.eW)("Framework Name "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter Framework name","onUpdate:modelValue":a[4]||(a[4]=e=>o.newFramework.FrameworkName=e),title:"Enter a descriptive name for your framework"},null,512),[[i.Jo,o.newFramework.FrameworkName]]),a[33]||(a[33]=(0,s.Lk)("div",{class:"helper-text"},"Enter a descriptive name for your framework",-1))]),(0,s.Lk)("div",ka,[(0,s.Lk)("div",ha,[a[34]||(a[34]=(0,s.Lk)("label",null,[(0,s.eW)("Description "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("textarea",{placeholder:"Enter framework description","onUpdate:modelValue":a[5]||(a[5]=e=>o.newFramework.FrameworkDescription=e),rows:"3",title:"Describe the purpose, scope, and objectives of this framework"},null,512),[[i.Jo,o.newFramework.FrameworkDescription]]),a[35]||(a[35]=(0,s.Lk)("div",{class:"helper-text"},"Describe the purpose, scope, and objectives of this framework",-1))])]),(0,s.Lk)("div",ga,[(0,s.Lk)("div",ya,[(0,s.Lk)("label",null,[a[36]||(a[36]=(0,s.eW)("Identifier ")),a[37]||(a[37]=(0,s.Lk)("span",{class:"required-star"},"*",-1)),"Internal"===o.newFramework.InternalExternal?((0,s.uX)(),(0,s.CE)("span",fa," (Auto-generated) ")):(0,s.Q3)("",!0)]),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter Identifier","onUpdate:modelValue":a[6]||(a[6]=e=>o.newFramework.Identifier=e),readonly:"Internal"===o.newFramework.InternalExternal,title:"Use a unique code like 'FW-001' or 'ISO-27001'"},null,8,ba),[[i.Jo,o.newFramework.Identifier]]),a[38]||(a[38]=(0,s.Lk)("div",{class:"helper-text"},"Use a unique code like 'FW-001' or 'ISO-27001'",-1))]),(0,s.Lk)("div",Ca,[a[39]||(a[39]=(0,s.Lk)("label",null,[(0,s.eW)("Category "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter category","onUpdate:modelValue":a[7]||(a[7]=e=>o.newFramework.Category=e),title:"e.g., Security, Compliance, Risk Management, etc."},null,512),[[i.Jo,o.newFramework.Category]]),a[40]||(a[40]=(0,s.Lk)("div",{class:"helper-text"},"e.g., Security, Compliance, Risk Management, etc.",-1))])]),(0,s.Lk)("div",La,[(0,s.Lk)("div",wa,[a[42]||(a[42]=(0,s.Lk)("label",null,[(0,s.eW)("Internal/External "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>o.newFramework.InternalExternal=e),title:"Select whether this framework is for internal or external use"},a[41]||(a[41]=[(0,s.Lk)("option",{value:""},"Select Type",-1),(0,s.Lk)("option",{value:"Internal"},"Internal",-1),(0,s.Lk)("option",{value:"External"},"External",-1)]),512),[[i.u1,o.newFramework.InternalExternal]]),a[43]||(a[43]=(0,s.Lk)("div",{class:"helper-text"},"Select whether this framework is for internal or external use",-1))]),(0,s.Lk)("div",Ea,[a[44]||(a[44]=(0,s.Lk)("label",null,"Upload Document",-1)),(0,s.Lk)("span",null,(0,d.v_)(o.newFramework.DocURL?o.newFramework.DocURL.name:"Choose File"),1),(0,s.Lk)("button",{class:"browse-btn",type:"button",onClick:a[9]||(a[9]=()=>e.$refs.frameworkFileInput.click()),title:"Browse and select a document file"},"Browse"),(0,s.Lk)("input",{type:"file",ref:"frameworkFileInput",style:{display:"none"},onChange:a[10]||(a[10]=(...e)=>o.onFrameworkFileChange&&o.onFrameworkFileChange(...e))},null,544),a[45]||(a[45]=(0,s.Lk)("div",{class:"helper-text"},"Upload a supporting document for this framework (optional)",-1))])]),(0,s.Lk)("div",Ra,[(0,s.Lk)("div",Da,[a[46]||(a[46]=(0,s.Lk)("label",null,[(0,s.eW)("Effective Start Date "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[11]||(a[11]=e=>o.newFramework.StartDate=e),title:"Date when the framework implementation begins"},null,512),[[i.Jo,o.newFramework.StartDate]]),a[47]||(a[47]=(0,s.Lk)("div",{class:"helper-text"},"Date when the framework implementation begins",-1))]),(0,s.Lk)("div",Ia,[a[48]||(a[48]=(0,s.Lk)("label",null,"Effective End Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[12]||(a[12]=e=>o.newFramework.EndDate=e),title:"Date when the framework expires or requires review"},null,512),[[i.Jo,o.newFramework.EndDate]]),a[49]||(a[49]=(0,s.Lk)("div",{class:"helper-text"},"Date when the framework expires or requires review",-1))])]),(0,s.Lk)("div",Pa,[(0,s.Lk)("button",{class:"submitt-btn",onClick:a[13]||(a[13]=(...e)=>o.handleCreateFramework&&o.handleCreateFramework(...e))},"Submit")])])])):(0,s.Q3)("",!0),o.selectedFramework&&!o.showFrameworkForm?((0,s.uX)(),(0,s.CE)("div",_a,[a[50]||(a[50]=(0,s.Lk)("h3",{style:{margin:"0"}},"Policy Creation",-1)),(0,s.Lk)("div",Sa,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policiesForm,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["subpolicy-step",{active:o.selectedPolicyIdx===a}]),onClick:e=>o.selectedPolicyIdx=a},[(0,s.eW)((0,d.v_)(e.PolicyName||`Policy ${a+1}`)+" ",1),(0,s.Lk)("button",{class:"remove-btn",onClick:(0,i.D$)(e=>o.handleRemovePolicy(a),["stop"]),title:"Remove Policy"},"âœ•",8,Ta)],10,Aa))),128)),(0,s.Lk)("button",{class:"add-subpolicy-step-btn",onClick:a[14]||(a[14]=(...e)=>o.handleAddPolicy&&o.handleAddPolicy(...e))}," + Add Policy ")]),null!==o.selectedPolicyIdx&&o.policiesForm[o.selectedPolicyIdx]?((0,s.uX)(),(0,s.CE)("div",xa,[(0,s.Lk)("div",Fa,[(0,s.Lk)("div",Va,[(0,s.Lk)("div",Ma,[(0,s.Lk)("b",Xa,(0,d.v_)(o.policiesForm[o.selectedPolicyIdx].PolicyName||`Policy ${o.selectedPolicyIdx+1}`),1),(0,s.Lk)("button",{class:"remove-btn",onClick:a[15]||(a[15]=(0,i.D$)(e=>o.handleRemovePolicy(o.selectedPolicyIdx),["stop"])),title:"Remove Policy"},"âœ•")])])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),o.policiesForm.length>0?((0,s.uX)(),(0,s.CE)("div",Ua,[(0,s.Lk)("button",{class:"create-btn",onClick:a[16]||(a[16]=(...e)=>o.handleSubmitPolicy&&o.handleSubmitPolicy(...e)),disabled:o.loading,style:{"font-size":"1rem","margin-top":"24px"}},(0,d.v_)(o.loading?"Submitting...":"Submit"),9,Na)])):(0,s.Q3)("",!0)])),(0,s.bF)(c)])):((0,s.uX)(),(0,s.CE)("div",ta,[(0,s.Lk)("div",ia,[a[26]||(a[26]=(0,s.Lk)("i",{class:"fas fa-shield-alt access-denied-icon"},null,-1)),a[27]||(a[27]=(0,s.Lk)("h2",null,"Access Denied",-1)),a[28]||(a[28]=(0,s.Lk)("p",null,"You don't have permission to create policies. Please contact your administrator.",-1)),(0,s.Lk)("div",sa,[a[23]||(a[23]=(0,s.Lk)("strong",null,"Your Role:",-1)),(0,s.eW)(" "+(0,d.v_)(o.userRole),1)]),(0,s.Lk)("div",oa,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=e=>o.showAccessDenied("create")),class:"btn btn-warning"},a[24]||(a[24]=[(0,s.Lk)("i",{class:"fas fa-envelope"},null,-1),(0,s.eW)(" Contact Admin ")])),(0,s.Lk)("button",{onClick:a[1]||(a[1]=a=>e.$router.push("/policy")),class:"btn btn-secondary"},a[25]||(a[25]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Policies ")]))])])]))])}t(116),t(7588),t(3579),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);const Ya=(0,ee.KR)({visible:!1,type:"info",heading:"",message:"",buttons:[],autoClose:0,inputPlaceholder:"Enter your comment...",selectOptions:[],selectedValue:""}),Ga=(0,ee.KR)(new Map),Za={show(e){console.log("[POPUP_SERVICE] show() called with config:",e),console.log("[POPUP_SERVICE] Current popup state before update:",Ya.value),Ya.value={...Ya.value,...e,visible:!0},console.log("[POPUP_SERVICE] Popup state updated:",Ya.value),console.log("[POPUP_SERVICE] Popup should now be visible:",Ya.value.visible)},hide(){Ya.value.visible=!1},getState(){return Ya},handleAction({action:e,comment:a}){console.log("DEBUG PopupService: handleAction called with:",{action:e,comment:a});const t=Ga.value.get(e);console.log("DEBUG PopupService: Found callback for action:",e,t?"YES":"NO"),t?(console.log("DEBUG PopupService: Executing callback with comment:",a),this.hide(),console.log("DEBUG PopupService: Popup hidden"),setTimeout(()=>{t(a),console.log("DEBUG PopupService: Callback executed")},100),Ga.value.delete(e),console.log("DEBUG PopupService: Callback deleted")):(this.hide(),console.log("DEBUG PopupService: Popup hidden (no callback)"))},onAction(e,a){Ga.value.set(e,a)},success(e,a="Success"){this.show({type:"success",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"success"}]})},error(e,a="Error"){this.show({type:"error",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"error"}]})},warning(e,a="Warning"){this.show({type:"warning",heading:a,message:e,buttons:[{label:"OK",action:"ok",class:"warning"}]})},confirm(e,a="Confirm",t,i){this.show({type:"confirm",heading:a,message:e,buttons:[{label:"Yes",action:"yes",class:"success"},{label:"No",action:"no",class:"error"}]}),t&&this.onAction("yes",t),i&&this.onAction("no",i)},comment(e,a="Comment",t){this.show({type:"comment",heading:a,message:e,buttons:[{label:"Submit",action:"submit",class:"success"},{label:"Cancel",action:"cancel",class:"error"}]}),t&&this.onAction("submit",t)},select(e,a="Select",t,i){this.show({type:"select",heading:a,message:e,selectOptions:t,selectedValue:t.length>0?t[0].value:"",buttons:[{label:"Submit",action:"submit",class:"success"},{label:"Cancel",action:"cancel",class:"error"}]}),i&&this.onAction("submit",i)},accessDenied(e="You don't have permission to access this feature. Please contact your administrator to activate this feature.",a="Access Denied",t){console.log("[POPUP_SERVICE] accessDenied called with:",{message:e,heading:a,hasCallback:!!t});const i={type:"access-denied",heading:a,message:e,buttons:[{label:"Contact Admin",action:"contact-admin",class:"warning"},{label:"OK",action:"ok",class:"error"}]};console.log("[POPUP_SERVICE] Popup config created:",i);try{this.show(i),console.log("[POPUP_SERVICE] show() method called successfully"),console.log("[POPUP_SERVICE] Current popup state after show():",Ya.value),t&&(this.onAction("contact-admin",t),console.log("[POPUP_SERVICE] Contact admin callback registered"))}catch(s){console.error("[POPUP_SERVICE] Error in accessDenied method:",s)}}};var et=Za;const at={key:0,class:"popup-icon"},tt=["innerHTML"],it={class:"popup-heading"},st={class:"popup-message"},ot=["placeholder"],lt=["value"],nt={class:"popup-actions"},rt=["onClick"];function ct(e,a,t,o,l,n){return n.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"popup-backdrop",onKeydown:a[3]||(a[3]=(0,i.jR)((...e)=>n.onClose&&n.onClose(...e),["esc"])),tabindex:"0","aria-modal":"true",role:"dialog"},[(0,s.Lk)("div",{class:(0,d.C4)(["popup-modal",n.type])},[n.icon?((0,s.uX)(),(0,s.CE)("div",at,[(0,s.Lk)("span",{innerHTML:n.icon},null,8,tt)])):(0,s.Q3)("",!0),(0,s.Lk)("h2",it,(0,d.v_)(n.heading),1),(0,s.Lk)("p",st,(0,d.v_)(n.message),1),"comment"===n.type?(0,s.bo)(((0,s.uX)(),(0,s.CE)("textarea",{key:1,"onUpdate:modelValue":a[0]||(a[0]=e=>l.comment=e),class:"popup-input",placeholder:n.inputPlaceholder,onKeydown:a[1]||(a[1]=(0,i.jR)((0,i.D$)(()=>{},["stop"]),["enter"]))},null,40,ot)),[[i.Jo,l.comment]]):(0,s.Q3)("",!0),"select"===n.type?(0,s.bo)(((0,s.uX)(),(0,s.CE)("select",{key:2,"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedValue=e),class:"popup-select"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,lt))),128))],512)),[[i.u1,l.selectedValue]]):(0,s.Q3)("",!0),(0,s.Lk)("div",nt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.buttons,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:a,onClick:a=>n.onAction(e.action),class:(0,d.C4)(e.class)},(0,d.v_)(e.label),11,rt))),128))])],2)],32)):(0,s.Q3)("",!0)}const dt={success:"âœ“",error:"âœ—",warning:"âš ï¸",info:"â„¹ï¸",confirm:"â“",comment:"ðŸ’¬",select:"ðŸ“‹","access-denied":"ðŸš«"};var ut={name:"PopupModal",setup(){const e=Za.getState();return{popupState:e}},computed:{visible(){return this.popupState.visible},type(){return this.popupState.type},heading(){return this.popupState.heading},message(){return this.popupState.message},buttons(){return this.popupState.buttons},autoClose(){return this.popupState.autoClose},icon(){return dt[this.type]||""},selectOptions(){return this.popupState.selectOptions||[]},inputPlaceholder(){return this.popupState.inputPlaceholder}},watch:{visible(e){e&&this.autoClose>0&&setTimeout(()=>this.onAction("auto-close"),this.autoClose),e&&(this.comment="",this.selectedValue=this.popupState.selectedValue||"")}},data(){return{comment:"",selectedValue:""}},methods:{onClose(){this.onAction("close")},onAction(e){"comment"===this.type?Za.handleAction({action:e,comment:this.comment}):"select"===this.type?Za.handleAction({action:e,comment:this.selectedValue}):Za.handleAction({action:e})}}};const pt=(0,se.A)(ut,[["render",ct],["__scopeId","data-v-f6ef7506"]]);var vt=pt,mt=t(2545),kt=(t(1148),t(2351)),ht=t(9254);let gt={permissions:null,userRole:null,isLoaded:!1,isLoading:!1,lastFetch:null,error:null};const yt=3e5,ft={async init(){if(console.log("[POLICY_RBAC] Initializing RBAC system..."),gt.isLoaded&&gt.lastFetch&&Date.now()-gt.lastFetch<yt)return console.log("[POLICY_RBAC] Using cached permissions"),gt;if(gt.isLoading)return console.log("[POLICY_RBAC] Already loading, waiting..."),await this.waitForLoad();gt.isLoading=!0,gt.error=null;try{if(!ht.G4.isLoggedIn())throw new Error("User not logged in");const[e,a]=await Promise.all([this.fetchUserPermissions(),this.fetchUserRole()]);return gt.permissions=e,gt.userRole=a,gt.isLoaded=!0,gt.lastFetch=Date.now(),console.log("[POLICY_RBAC] RBAC initialized successfully:",gt),gt}catch(e){throw console.error("[POLICY_RBAC] Failed to initialize RBAC:",e),gt.error=e.message,e}finally{gt.isLoading=!1}},async waitForLoad(){return new Promise(e=>{const a=()=>{gt.isLoading?setTimeout(a,100):e(gt)};a()})},async fetchUserPermissions(){try{const e=await qe.A.get("/api/user-permissions/",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("[POLICY_RBAC] Permissions fetched:",e.data),e.data}catch(e){throw console.error("[POLICY_RBAC] Failed to fetch permissions:",e),new Error("Failed to fetch user permissions")}},async fetchUserRole(){try{const e=await qe.A.get("/api/user-role/",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("[POLICY_RBAC] Role fetched:",e.data),e.data}catch(e){throw console.error("[POLICY_RBAC] Failed to fetch role:",e),new Error("Failed to fetch user role")}},hasPermission(e){if(!gt.isLoaded||!gt.permissions)return console.warn("[POLICY_RBAC] RBAC not loaded, denying permission:",e),!1;const a=gt.permissions.permissions?.includes(e)||!1;return console.log(`[POLICY_RBAC] Permission check: ${e} = ${a}`),a},hasAnyPermission(e){return e.some(e=>this.hasPermission(e))},hasAllPermissions(e){return e.every(e=>this.hasPermission(e))},getUserRole(){return gt.userRole},getUserPermissions(){return gt.permissions},isAdmin(){return"admin"===gt.userRole?.role||!0===gt.userRole?.is_superuser},canViewPolicies(){return this.hasAnyPermission(["policy.view","policy.view_all","policy.list"])},canCreatePolicies(){return this.hasPermission("policy.create")},canEditPolicies(){return this.hasPermission("policy.edit")},canDeletePolicies(){return this.hasPermission("policy.delete")},canApprovePolicies(){return this.hasPermission("policy.approve")},canViewFrameworks(){return this.hasAnyPermission(["policy.view_framework","policy.view"])},canCreateFrameworks(){return this.hasPermission("policy.create_framework")},canUploadFrameworks(){return this.hasPermission("policy.upload_framework")},canViewAnalytics(){return this.hasPermission("policy.analytics")},canViewKPIs(){return this.hasPermission("policy.kpi")},canViewDashboard(){return this.hasPermission("policy.dashboard")},canExportData(){return this.hasPermission("policy.export")},canManageVersions(){return this.hasPermission("policy.versioning")},canTailorPolicies(){return this.hasPermission("policy.tailoring")},canManageApprovalWorkflow(){return this.hasPermission("policy.approval_workflow")},getPolicyComponentAccess(){return gt.isLoaded?{canViewAllPolicies:this.canViewPolicies(),canCreatePolicy:this.canCreatePolicies(),canEditPolicy:this.canEditPolicies(),canDeletePolicy:this.canDeletePolicies(),canApprovePolicy:this.canApprovePolicies(),canViewFrameworks:this.canViewFrameworks(),canCreateFramework:this.canCreateFrameworks(),canUploadFramework:this.canUploadFrameworks(),canViewAnalytics:this.canViewAnalytics(),canViewKPIs:this.canViewKPIs(),canViewDashboard:this.canViewDashboard(),canExportData:this.canExportData(),canManageVersions:this.canManageVersions(),canTailorPolicies:this.canTailorPolicies(),canManageApprovalWorkflow:this.canManageApprovalWorkflow(),isAdmin:this.isAdmin()}:(console.warn("[POLICY_RBAC] RBAC not loaded, denying all access"),{canViewAllPolicies:!1,canCreatePolicy:!1,canEditPolicy:!1,canDeletePolicy:!1,canApprovePolicy:!1,canViewFrameworks:!1,canCreateFramework:!1,canUploadFramework:!1,canViewAnalytics:!1,canViewKPIs:!1,canViewDashboard:!1,canExportData:!1,canManageVersions:!1,canTailorPolicies:!1,canManageApprovalWorkflow:!1,isAdmin:!1})},canAccessRoute(e){const a={AllPolicies:["policy.view","policy.list"],CreatePolicy:["policy.create"],EditPolicy:["policy.edit"],PolicyApprover:["policy.approve"],PolicyDashboard:["policy.dashboard"],UploadFramework:["policy.upload_framework"],FrameworkExplorer:["policy.view_framework"],FrameworkPolicies:["policy.view_framework"],KPIDashboard:["policy.kpi"],PerformancePage:["policy.analytics"],StatusChangeRequests:["policy.approval_workflow"],TT:["policy.tailoring"],VV:["policy.versioning"]},t=a[e];return t?this.hasAnyPermission(t):(console.warn(`[POLICY_RBAC] No permissions defined for route: ${e}`),!0)},getButtonPermissions(){return{canShowCreateButton:this.canCreatePolicies(),canShowEditButton:this.canEditPolicies(),canShowDeleteButton:this.canDeletePolicies(),canShowApproveButton:this.canApprovePolicies(),canShowExportButton:this.canExportData(),canShowUploadButton:this.canUploadFrameworks(),canShowVersioningButton:this.canManageVersions(),canShowTailoringButton:this.canTailorPolicies(),canShowAnalyticsButton:this.canViewAnalytics(),canShowKPIButton:this.canViewKPIs(),canShowDashboardButton:this.canViewDashboard()}},showPolicyAccessDenied(e="access",a=null){const t={access:"access the policy module",view:"view policies",create:"create policies",edit:"edit policies",delete:"delete policies",approve:"approve policies",framework:"access frameworks",upload:"upload frameworks",analytics:"view policy analytics",kpi:"view policy KPIs",dashboard:"access policy dashboard",export:"export policy data",versioning:"manage policy versions",tailoring:"tailor policies",approval_workflow:"manage approval workflows"},i=t[e]||e,s=gt.userRole?.role||"Not assigned",o=`You don't have permission to ${i}. \n    \nYour current role: ${s}\n\nPlease contact your administrator to request the necessary permissions for policy management.`;console.log("[POLICY_RBAC] Showing access denied popup:",{operation:e,userRole:s}),kt.O.accessDenied(o,"Policy Access Denied",a||this.defaultContactAdmin)},showViewPolicyDenied(e=null){this.showPolicyAccessDenied("view",e)},showCreatePolicyDenied(e=null){this.showPolicyAccessDenied("create",e)},showEditPolicyDenied(e=null){this.showPolicyAccessDenied("edit",e)},showDeletePolicyDenied(e=null){this.showPolicyAccessDenied("delete",e)},showApprovePolicyDenied(e=null){this.showPolicyAccessDenied("approve",e)},showFrameworkAccessDenied(e=null){this.showPolicyAccessDenied("framework",e)},showUploadFrameworkDenied(e=null){this.showPolicyAccessDenied("upload",e)},showAnalyticsDenied(e=null){this.showPolicyAccessDenied("analytics",e)},showKPIDenied(e=null){this.showPolicyAccessDenied("kpi",e)},showDashboardDenied(e=null){this.showPolicyAccessDenied("dashboard",e)},showExportDenied(e=null){this.showPolicyAccessDenied("export",e)},showVersioningDenied(e=null){this.showPolicyAccessDenied("versioning",e)},showTailoringDenied(e=null){this.showPolicyAccessDenied("tailoring",e)},showApprovalWorkflowDenied(e=null){this.showPolicyAccessDenied("approval_workflow",e)},defaultContactAdmin(){console.log("[POLICY_RBAC] Contact admin requested"),kt.O.info("Please contact your system administrator to request access to policy management features.","Contact Administrator")},checkAccessAndExecute(e,a,t="access"){return("function"===typeof e?e():e)?(a&&a(),!0):(this.showPolicyAccessDenied(t),!1)},clearCache(){console.log("[POLICY_RBAC] Clearing RBAC cache"),gt={permissions:null,userRole:null,isLoaded:!1,isLoading:!1,lastFetch:null,error:null}},getState(){return{...gt}},isLoaded(){return gt.isLoaded},isLoading(){return gt.isLoading},getError(){return gt.error}};var bt=t(4300);const Ct="http://localhost:8000/api";var Lt={name:"CreatePolicy",components:{PopupModal:vt,CustomDropdown:mt.A},setup(){const e=(0,ee.KR)([]),a=(0,ae.rd)(),t=(0,ee.KR)(!0),i=(0,ee.KR)(null),o=(0,ee.KR)(null),l=(0,ee.KR)(!1),n=(0,ee.KR)(!1),r=(0,ee.KR)("Not assigned"),c=async()=>{try{t.value=!0,i.value=null,await ft.init(),o.value=ft.getPolicyComponentAccess(),l.value=o.value?.canCreatePolicy||!1,n.value=o.value?.canCreateFramework||!1,r.value=ft.getUserRole()?.role||"Not assigned",console.log("[CreatePolicy] RBAC initialized:",o.value)}catch(f){console.error("[CreatePolicy] Failed to initialize RBAC:",f),i.value=f.message,l.value=!1,n.value=!1}finally{t.value=!1}},d=(e="create")=>{ft.showPolicyAccessDenied(e)},u=(0,ee.KR)(""),p=(0,ee.KR)([]),v=(0,ee.KR)(null),m=(0,ee.KR)(!1),k=(0,ee.KR)(!1),h=(0,ee.KR)({createdBy:"",createdByName:localStorage.getItem("username")||"",reviewer:""}),g=(0,ee.KR)([]),y=(0,ee.KR)(!1),f=(0,ee.KR)(null),b=(0,ee.KR)([]),C=(0,ee.KR)(null),L=(0,ee.KR)([]),w=(0,ee.KR)([]),E=(0,ee.KR)([]),R=(0,ee.KR)([]),D=(0,ee.KR)({FrameworkName:"",Identifier:"",FrameworkDescription:"",Category:"",StartDate:"",EndDate:"",DocURL:"",InternalExternal:""}),I=async e=>{if(!e||e.length<4)return"";const a=e.substring(0,4).toUpperCase();let t=1,i=`${a}${t}`;while(R.value.includes(i))t++,i=`${a}${t}`;return i},P=e=>{if(!e)return"";const a=e.split(" ").filter(e=>e.length>0);return a.map(e=>e.charAt(0).toUpperCase()).join("")},_=(e,a)=>e?`${e}-${a+1}`:"",S=async()=>{try{const e=await qe.A.get(`${Ct}/frameworks/`,{params:{include_all_for_identifiers:"true"}});R.value=e.data.map(e=>e.Identifier).filter(e=>e),console.log("Fetched existing framework identifiers:",R.value)}catch(e){console.error("Error fetching existing framework identifiers:",e)}},A=async()=>{if("Internal"===D.value.InternalExternal&&D.value.FrameworkName){const e=await I(D.value.FrameworkName);D.value.Identifier=e}},T=e=>{const a=p.value[e];if(!a)return;const t="__new__"===u.value&&"Internal"===C.value?.InternalExternal||"__new__"!==u.value&&""!==u.value&&"Internal"===g.value.find(e=>e.id===u.value)?.InternalExternal;if(t&&a.PolicyName){const e=P(a.PolicyName);a.Identifier=e,a.subpolicies.forEach((a,t)=>{a.SubPolicyName&&(a.Identifier=_(e,t))})}},x=(e,a)=>{const t=p.value[e],i=t?.subpolicies[a];if(!t||!i)return;const s="__new__"===u.value&&"Internal"===C.value?.InternalExternal||"__new__"!==u.value&&""!==u.value&&"Internal"===g.value.find(e=>e.id===u.value)?.InternalExternal;s&&i.SubPolicyName&&t.Identifier&&(i.Identifier=_(t.Identifier,a))},F=()=>"__new__"===u.value&&"Internal"===C.value?.InternalExternal||"__new__"!==u.value&&""!==u.value&&"Internal"===g.value.find(e=>e.id===u.value)?.InternalExternal;async function V(){try{y.value=!0;const e=await qe.A.get(`${Ct}/frameworks/`);g.value=e.data.map(e=>({id:e.FrameworkId,name:e.FrameworkName,InternalExternal:e.InternalExternal}))}catch(e){console.error("Error fetching frameworks:",e),et.error("Failed to fetch frameworks","Loading Error")}finally{y.value=!1}}(0,s.wB)(()=>D.value.FrameworkName,A),(0,s.wB)(()=>D.value.InternalExternal,A),(0,s.wB)(u,e=>{"create"===e?(k.value=!0,u.value=""):e&&!k.value&&0===p.value.length&&(X(),v.value=0)});const M=async()=>{f.value=null,C.value={...D.value},k.value=!1,X(),u.value="__new__",D.value={FrameworkName:"",Identifier:"",FrameworkDescription:"",Category:"",StartDate:"",EndDate:"",DocURL:"",InternalExternal:""},S()},X=()=>{const a={PolicyName:"",Identifier:"",PolicyDescription:"",Scope:"",Objective:"",Department:"",Applicability:"",StartDate:"",EndDate:"",CreatedByName:"",DocURL:"",PolicyType:"",PolicyCategory:"",PolicySubCategory:"",Entities:[],subpolicies:[]};p.value.push(a),v.value=p.value.length-1,e.value.push(null),F()&&setTimeout(()=>{T(p.value.length-1)},100)},U=a=>{p.value=p.value.filter((e,t)=>t!==a),e.value=e.value.filter((e,t)=>t!==a),p.value.length>0?v.value>a?v.value=v.value-1:v.value===a&&(v.value=Math.max(0,a-1)):v.value=null},N=(e,a,t)=>{p.value[e][a]=t,"PolicyName"===a&&T(e)},$=a=>{p.value[a].subpolicies.push({SubPolicyName:"",Identifier:"",Control:"",Description:"",CreatedByName:"",PermanentTemporary:""});const t=p.value[a].subpolicies.length-1;x(a,t),e.value[a]=t},O=(a,t)=>{p.value[a].subpolicies=p.value[a].subpolicies.filter((e,a)=>a!==t),e.value[a]===t?e.value[a]=Math.max(0,t-1):e.value[a]>t&&e.value[a]--},j=(e,a,t,i)=>{p.value[e].subpolicies[a][t]=i,"SubPolicyName"===t&&x(e,a)},B=()=>{m.value=!0};async function W(){try{y.value=!0;const e=await qe.A.get(`${Ct}/policy-users/`);b.value=e.data}catch(e){console.error("Error fetching users:",e),et.error("Failed to fetch users","Loading Error")}finally{y.value=!1}}async function Q(){try{y.value=!0;const e=await qe.A.get(`${Ct}/policy-categories/`);L.value=e.data,w.value=[...new Set(L.value.map(e=>e.PolicyType).filter(Boolean))]}catch(e){console.error("Error fetching policy categories:",e),et.error("Failed to fetch policy categories","Loading Error")}finally{y.value=!1}}async function q(){try{const e=await qe.A.get(`${Ct}/entities/`);E.value=e.data.entities||[]}catch(e){console.error("Error fetching entities:",e),et.error("Failed to fetch entities","Loading Error")}}const K=e=>e?[...new Set(L.value.filter(a=>a.PolicyType===e).map(e=>e.PolicyCategory).filter(Boolean))]:[],J=(e,a)=>e&&a?[...new Set(L.value.filter(t=>t.PolicyType===e&&t.PolicyCategory===a).map(e=>e.PolicySubCategory).filter(Boolean))]:[],z=async(e,a)=>{p.value[e].PolicyType=a,p.value[e].PolicyCategory="",p.value[e].PolicySubCategory="",await(0,s.dY)()},H=async(e,a)=>{p.value[e].PolicyCategory=a,p.value[e].PolicySubCategory=""},Y=(e,a)=>{p.value[e].PolicySubCategory=a},G=(e,a)=>{a.includes("all")?p.value[e].Entities="all":p.value[e].Entities=a.filter(e=>"all"!==e)},Z=e=>"all"===p.value[e].Entities,te=e=>{const a=p.value[e].Entities;return"all"===a?["all"]:Array.isArray(a)?a.filter(e=>"all"!==e):[]},ie=e=>{const a=p.value[e].Entities;return"all"===a?0:Array.isArray(a)?a.filter(e=>"all"!==e).length:0},se=e=>{p.value.forEach((a,t)=>{t!==e&&(a.showEntitiesDropdown=!1)}),void 0===p.value[e].showEntitiesDropdown&&(p.value[e].showEntitiesDropdown=!1),p.value[e].showEntitiesDropdown=!p.value[e].showEntitiesDropdown},oe=()=>{p.value.forEach(e=>{e.showEntitiesDropdown=!1})},le=(e,a,t)=>{console.log("handleEntitySelection called:",{idx:e,entityId:a,isChecked:t});let i=te(e);console.log("Current selected entities:",i),"all"===a?t?(p.value[e].Entities="all",console.log('Set entities to "all"')):(p.value[e].Entities=[],console.log("Cleared entities")):(t?(i.includes("all")&&(i=[]),i.includes(a)||i.push(a)):i=i.filter(e=>e!==a&&"all"!==e),p.value[e].Entities=i,console.log("Updated entities to:",i)),console.log("Final policy entities:",p.value[e].Entities)},ne=(e,a)=>{const t=p.value[e].Entities;let i=!1;i="all"===a?"all"===t:Array.isArray(t)&&t.includes(a),le(e,a,!i)},re=async()=>{try{console.log("Checking for new policy categories to save...");const e=[];for(const a of p.value){const t=a.PolicyType?.trim(),i=a.PolicyCategory?.trim(),s=a.PolicySubCategory?.trim();if(!t||!i||!s)continue;const o=L.value.some(e=>e.PolicyType===t&&e.PolicyCategory===i&&e.PolicySubCategory===s);o||(console.log(`Found new combination: ${t} > ${i} > ${s}`),e.push({PolicyType:t,PolicyCategory:i,PolicySubCategory:s}))}if(e.length>0){console.log(`Saving ${e.length} new policy category combinations...`);for(const a of e)await qe.A.post(`${Ct}/policy-categories/save/`,a);await Q(),console.log("Policy categories refreshed")}else console.log("No new policy category combinations to save")}catch(e){console.error("Error saving policy categories:",e)}},ce=async()=>{try{y.value=!0,f.value=null,await re();const i="__new__"===u.value;if(i&&(!C.value||!C.value.FrameworkName))return et.error("Please fill in all required framework fields.","Validation Error"),void(y.value=!1);const s=b.value.find(e=>e.UserName===h.value.createdByName),o=b.value.find(e=>e.UserId===h.value.reviewer);if(!h.value.createdByName)return et.error("Creator name not found. Please try logging in again.","Validation Error"),void(y.value=!1);for(const e of p.value){if(!e.PolicyName||!e.Identifier||!e.StartDate)return et.error("Please fill in all required fields (Policy Name, Identifier, and Start Date) for all policies","Validation Error"),void(y.value=!1);if(!e.subpolicies||0===e.subpolicies.length)return et.error("Each policy must have at least one subpolicy.","Validation Error"),void(y.value=!1);e.Status=e.Status||"Under Review",e.ActiveInactive=e.ActiveInactive||"Inactive",e.CreatedByName=s.UserName,e.Reviewer=o?o.UserName:null;for(const a of e.subpolicies){if(!a.SubPolicyName||!a.Identifier)return et.error("Please fill in all required fields (Name and Identifier) for all subpolicies","Validation Error"),void(y.value=!1);a.Status=a.Status||"Under Review",a.CreatedByName=s.UserName}}if(console.log("DEBUG: Policies after validation:",p.value.map(e=>({PolicyName:e.PolicyName,Entities:e.Entities}))),i){if(C.value.DocURL&&C.value.DocURL instanceof File)try{const e=await bt.ud.uploadPolicyDocument(C.value.DocURL,s.UserId,C.value.FrameworkName,"framework");if(!e.data.success)throw new Error(e.data.error||"Upload failed");C.value.DocURL=e.data.file.url}catch(e){return console.error("Error uploading framework document:",e),et.error("Failed to upload framework document: "+(e.response?.data?.error||e.message),"Upload Error"),void(y.value=!1)}for(const i of p.value)if(i.DocURL&&i.DocURL instanceof File)try{const e=await bt.ud.uploadPolicyDocument(i.DocURL,s.UserId,i.PolicyName,"policy");if(!e.data.success)throw new Error(e.data.error||"Upload failed");i.DocURL=e.data.file.url}catch(e){return console.error("Error uploading policy document:",e),et.error("Failed to upload policy document: "+(e.response?.data?.error||e.message),"Upload Error"),void(y.value=!1)}console.log("Policies form data before payload creation:",JSON.stringify(p.value,null,2));const a={...C.value,CreatedByName:s.UserName,CreatedById:s.UserId,Reviewer:o?o.UserId:null,policies:p.value.map((e,a)=>{console.log(`DEBUG: Processing policy ${a}, Entities before mapping:`,e.Entities);const t={...e,CoverageRate:""!==e.CoverageRate&&null!==e.CoverageRate&&void 0!==e.CoverageRate?Number(e.CoverageRate):null,CreatedByName:s.UserName,CreatedById:s.UserId,Reviewer:o?o.UserId:null,Entities:e.Entities,subpolicies:e.subpolicies.map(e=>({...e,CreatedByName:s.UserName,CreatedByDate:(new Date).toISOString().split("T")[0],Status:"Under Review",PermanentTemporary:""}))};return console.log(`DEBUG: Policy ${a} after mapping, Entities:`,t.Entities),t})};console.log("Final payload being sent:",JSON.stringify(a,null,2));const t=await qe.A.post(`${Ct}/frameworks/`,a);if(t.data.error)throw new Error(t.data.error);et.success("Successfully created new framework and policies! Redirecting to All Policies page...","Framework Created")}else{const a=u.value;for(const t of p.value)if(t.DocURL&&t.DocURL instanceof File)try{const e=await bt.ud.uploadPolicyDocument(t.DocURL,s.UserId,t.PolicyName,"policy");if(!e.data.success)throw new Error(e.data.error||"Upload failed");t.DocURL=e.data.file.url}catch(e){return console.error("Error uploading policy document:",e),et.error("Failed to upload policy document: "+(e.response?.data?.error||e.message),"Upload Error"),void(y.value=!1)}const i=p.value.map(e=>({...e,CoverageRate:""!==e.CoverageRate&&null!==e.CoverageRate&&void 0!==e.CoverageRate?Number(e.CoverageRate):null,CreatedByName:s.UserName,CreatedById:s.UserId,Reviewer:o?o.UserId:null,subpolicies:e.subpolicies.map(e=>({...e,CreatedByName:s.UserName,CreatedByDate:(new Date).toISOString().split("T")[0],Status:"Under Review",PermanentTemporary:""}))}));try{const e=await qe.A.post(`${Ct}/frameworks/${a}/policies/`,{policies:i});if(e.data.error)throw new Error(e.data.error);et.success("Successfully added policies! Redirecting to All Policies page...","Policies Added")}catch(t){console.error("Error submitting policies:",t);const e=t.response?.data?.details||t.response?.data?.error||"Failed to submit policies";return et.error("object"===typeof e?JSON.stringify(e):e,"Submission Error"),void(y.value=!1)}}p.value=[],h.value={createdBy:"",reviewer:""},u.value="",m.value=!1,C.value=null,setTimeout(()=>{a.push("/policies-list/all")},1500)}catch(t){console.error("Error submitting policies:",t);const e=t.response?.data?.details||t.response?.data?.error||"Failed to submit policies";et.error("object"===typeof e?JSON.stringify(e):e,"Submission Error")}finally{y.value=!1}},de=()=>{const e=g.value.find(e=>e.id===u.value);return e?e.name:""},ue=()=>{u.value="",p.value=[]},pe=(0,ee.KR)(null),ve=e=>{const a=e.target.files[0];a&&(D.value.DocURL=a)},me=(e,a)=>{const t=e.target.files[0];t&&(p.value[a].DocURL=t)};(0,s.sV)(async()=>{await c(),l.value?(V(),W(),Q(),S(),q(),e.value=p.value.map(()=>null)):console.log("[CreatePolicy] User does not have permission to create policies")});const ke=(0,ee.KR)(!1),he=(0,ee.KR)({SubPolicyName:"",Identifier:"",Control:"",Description:""}),ge=()=>{he.value.SubPolicyName&&(p.value[v.value].subpolicies.push({...he.value}),he.value={SubPolicyName:"",Identifier:"",Control:"",Description:""},ke.value=!1)},ye=(0,s.EW)(()=>({label:"Framework",options:[{label:"Select",value:""},{label:"+ Create New Framework",value:"create"},...g.value.map(e=>({label:e.name,value:e.id}))]}));return{selectedFramework:u,policiesForm:p,selectedPolicyIdx:v,frameworks:g,showApprovalForm:m,showFrameworkForm:k,approvalForm:h,newFramework:D,loading:y,error:f,users:b,policyCategories:L,policyTypes:w,entities:E,rbacLoading:t,rbacError:i,userAccess:o,canCreatePolicies:l,canCreateFrameworks:n,userRole:r,showAccessDenied:d,handleAddPolicy:X,handleRemovePolicy:U,handlePolicyChange:N,handleAddSubPolicy:$,handleRemoveSubPolicy:O,handleSubPolicyChange:j,handleSubmitPolicy:B,handleFinalSubmit:ce,handleCreateFramework:M,getSelectedFrameworkName:de,handleChangeFramework:ue,frameworkFormData:C,frameworkFileInput:pe,onFrameworkFileChange:ve,onPolicyFileChange:me,getCategoriesForType:K,getSubCategoriesForCategory:J,handlePolicyTypeChange:z,handlePolicyCategoryChange:H,handlePolicySubCategoryChange:Y,handleEntityChange:G,isAllEntitiesSelected:Z,getSelectedEntityIds:te,getSelectedEntitiesCount:ie,toggleEntitiesDropdown:se,closeAllEntityDropdowns:oe,handleEntitySelection:le,selectEntity:ne,generateFrameworkIdentifier:I,generatePolicyIdentifier:P,generateSubPolicyIdentifier:_,autoGenerateFrameworkIdentifier:A,autoGeneratePolicyIdentifiers:T,autoGenerateSubPolicyIdentifier:x,isInternalFramework:F,showAddSubPolicyForm:ke,newSubPolicy:he,addNewSubPolicy:ge,selectedSubPolicyIdx:e,frameworkDropdownConfig:ye}}};const wt=(0,se.A)(Lt,[["render",Ha],["__scopeId","data-v-596a8119"]]);var Et=wt;const Rt={class:"performance-page"},Dt={key:0,class:"access-denied-message"},It={key:1,class:"loading-message"},Pt={key:2,class:"error-message"},_t={class:"error-card"},St={key:3},At={class:"search-bar"},Tt={class:"search-container"},xt={key:0,class:"kpi-summary"},Ft={class:"kpi-card"},Vt={class:"kpi-value"},Mt={class:"kpi-card"},Xt={class:"kpi-value"},Ut={class:"kpi-card"},Nt={class:"kpi-value"},$t={class:"kpi-card"},Ot={class:"kpi-value"},jt={class:"policy-cards-grid"},Bt={class:"policy-card-header"},Wt={class:"policy-card-icon"},Qt={class:"policy-card-title"},qt={class:"policy-card-progressbar"},Kt={class:"progress-bar-main"},Jt={class:"policy-card-progress-label"},zt={class:"policy-card-list"},Ht={class:"policy-card-list-label"},Yt={class:"policy-card-list-progress"},Gt={class:"progress-bar-sub"};function Zt(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Rt,[a[14]||(a[14]=(0,s.Lk)("h2",null,"Performance Dashboard",-1)),o.accessDenied?((0,s.uX)(),(0,s.CE)("div",Dt,a[2]||(a[2]=[(0,s.Lk)("div",{class:"access-denied-card"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.Lk)("h3",null,"Access Denied"),(0,s.Lk)("p",null,"You don't have permission to view Policy KPIs and Performance Data."),(0,s.Lk)("p",null,[(0,s.eW)("Required permission: "),(0,s.Lk)("strong",null,"policy_view")]),(0,s.Lk)("p",null,"Contact your administrator to request access.")],-1)]))):(0,s.Q3)("",!0),o.loading&&!o.accessDenied?((0,s.uX)(),(0,s.CE)("div",It,a[3]||(a[3]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading Performance Data...",-1)]))):(0,s.Q3)("",!0),o.error&&!o.accessDenied?((0,s.uX)(),(0,s.CE)("div",Pt,[(0,s.Lk)("div",_t,[a[4]||(a[4]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),a[5]||(a[5]=(0,s.Lk)("h3",null,"Error Loading Data",-1)),(0,s.Lk)("p",null,(0,d.v_)(o.error),1),(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>o.loadPolicyKPIs&&o.loadPolicyKPIs(...e)),class:"retry-button"},"Retry")])])):(0,s.Q3)("",!0),o.accessDenied||o.loading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",St,[(0,s.Lk)("div",At,[(0,s.Lk)("div",Tt,[a[6]||(a[6]=(0,s.Lk)("i",{class:"fas fa-search search-icon"},null,-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>o.searchQuery=e),placeholder:"Search Policies..."},null,512),[[i.Jo,o.searchQuery]])])]),o.kpiData?((0,s.uX)(),(0,s.CE)("div",xt,[(0,s.Lk)("div",Ft,[(0,s.Lk)("div",Vt,(0,d.v_)(o.kpiData.total_policies||0),1),a[7]||(a[7]=(0,s.Lk)("div",{class:"kpi-label"},"Total Policies",-1))]),(0,s.Lk)("div",Mt,[(0,s.Lk)("div",Xt,(0,d.v_)(o.kpiData.active_policies||0),1),a[8]||(a[8]=(0,s.Lk)("div",{class:"kpi-label"},"Active Policies",-1))]),(0,s.Lk)("div",Ut,[(0,s.Lk)("div",Nt,(0,d.v_)(o.kpiData.revision_rate||0)+"%",1),a[9]||(a[9]=(0,s.Lk)("div",{class:"kpi-label"},"Revision Rate",-1))]),(0,s.Lk)("div",$t,[(0,s.Lk)("div",Ot,(0,d.v_)(o.kpiData.coverage_metrics?.overall_coverage_rate||0)+"%",1),a[10]||(a[10]=(0,s.Lk)("div",{class:"kpi-label"},"Coverage Rate",-1))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",jt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredPolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"policy-card"},[(0,s.Lk)("div",Bt,[(0,s.Lk)("div",Wt,(0,d.v_)(e.category.charAt(0)),1),(0,s.Lk)("div",Qt,(0,d.v_)(e.name),1),a[11]||(a[11]=(0,s.Lk)("div",{class:"policy-card-upload"},[(0,s.Lk)("i",{class:"fas fa-upload"})],-1))]),(0,s.Lk)("div",qt,[(0,s.Lk)("div",Kt,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:e.progress})},null,4)]),(0,s.Lk)("span",Jt,(0,d.v_)(e.progress)+" Latest results",1)]),a[13]||(a[13]=(0,s.Lk)("div",{class:"policy-card-analytics"},[(0,s.Lk)("span",null,"Analytics"),(0,s.Lk)("span",{class:"policy-card-analytics-arrow"},"â–¼")],-1)),(0,s.Lk)("div",zt,[a[12]||(a[12]=(0,s.Lk)("div",{class:"policy-card-list-header"},[(0,s.Lk)("span",null,"Performance")],-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"policy-card-list-row"},[(0,s.Lk)("span",Ht,(0,d.v_)(e.name),1),(0,s.Lk)("div",Yt,[(0,s.Lk)("div",Gt,[(0,s.Lk)("div",{class:"progress-bar-fill-sub",style:(0,d.Tr)({width:`${e.percent}%`})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["policy-card-list-status","Completed"===e.status?"completed":"inprogress"])},(0,d.v_)(e.status),3)])]))),128))])]))),128))])]))])}var ei={name:"PerformancePage",setup(){const e=(0,ee.KR)(""),a=(0,ee.KR)(!1),t=(0,ee.KR)(""),i=(0,ee.KR)(!1),o=(0,ee.KR)(null),l=(0,ee.KR)([{id:"1.1",name:"Financial Policy",category:"Financial",progress:"40%",subpolicies:[{name:"Budget Management",status:"Completed",percent:95},{name:"Expense Tracking",status:"Completed",percent:88},{name:"Financial Reporting",status:"In Progress",percent:65},{name:"Audit Compliance",status:"In Progress",percent:70},{name:"Risk Assessment",status:"In Progress",percent:45}]},{id:"1.2",name:"Service Policy",category:"Service",progress:"50%",subpolicies:[{name:"Customer Support",status:"Completed",percent:92},{name:"Service Delivery",status:"In Progress",percent:75}]},{id:"2.1",name:"Loan Policy",category:"Loan",progress:"80%",subpolicies:[{name:"Loan Processing",status:"Completed",percent:90},{name:"Credit Assessment",status:"Completed",percent:85},{name:"Risk Evaluation",status:"Completed",percent:88},{name:"Documentation",status:"Completed",percent:92},{name:"Compliance Check",status:"In Progress",percent:60}]}]),n=async()=>{a.value=!0,t.value="",i.value=!1;try{console.log("[RBAC DEBUG] Attempting to load Policy KPIs...");const e=await qe.A.get("/policy-kpis/");console.log("[RBAC DEBUG] Policy KPIs loaded successfully:",e.data),o.value=e.data}catch(e){if(console.error("[RBAC DEBUG] Error loading Policy KPIs:",e),e.response){const a=e.response.status;console.log("[RBAC DEBUG] Response status:",a),console.log("[RBAC DEBUG] Response data:",e.response.data),403===a?(i.value=!0,t.value="Access denied: You do not have permission to view Policy KPIs",console.log("[RBAC DEBUG] Access denied - user lacks policy_view permission")):401===a?(i.value=!0,t.value="Authentication required: Please log in to access this page",console.log("[RBAC DEBUG] Authentication required")):t.value=`Server error (${a}): ${e.response.data?.error||"Unknown error"}`}else e.request?t.value="Network error: Unable to connect to the server":t.value=`Request error: ${e.message}`}finally{a.value=!1}},r=(0,s.EW)(()=>l.value.filter(a=>a.name.toLowerCase().includes(e.value.toLowerCase())));return(0,s.sV)(()=>{console.log("[RBAC DEBUG] PerformancePage component mounted, loading Policy KPIs..."),n()}),{searchQuery:e,loading:a,error:t,accessDenied:i,kpiData:o,filteredPolicies:r,loadPolicyKPIs:n}}};const ai=(0,se.A)(ei,[["render",Zt],["__scopeId","data-v-91431756"]]);var ti=ai;const ii={class:"dashboard-container"},si={key:0,class:"loading-container"},oi={key:1,class:"access-denied-container"},li={class:"access-denied-content"},ni={class:"access-info"},ri={class:"access-actions"},ci={class:"dashboard-header"},di={class:"dashboard-actions"},ui={class:"performance-summary"},pi={key:0,class:"loading-message"},vi={key:1,class:"error-message"},mi={class:"summary-card growth"},ki={class:"summary-content"},hi={class:"summary-value"},gi={class:"summary-card"},yi={class:"summary-content"},fi={class:"summary-value"},bi={class:"summary-card"},Ci={class:"summary-content"},Li={class:"summary-value"},wi={class:"approvals-list"},Ei={class:"approval-tables-container"},Ri={key:0,class:"approval-section"},Di={key:1,class:"approval-section"},Ii={key:2,class:"approval-section"},Pi={key:3,class:"no-approvals-message"},_i={class:"policy-details-content policy-details-popup"},Si={class:"details-header"},Ai={class:"detail-type-indicator"},Ti={class:"version-pill"},xi={key:0,class:"approved-only-badge"},Fi={key:0,class:"version-history"},Vi={class:"version-info"},Mi={class:"version-value"},Xi={key:0,class:"subpolicies-versions"},Ui={class:"version-list"},Ni={class:"subpolicy-name"},$i={class:"version-tag"},Oi={key:0,class:"resubmitted-tag"},ji={class:"policy-approval-section"},Bi={class:"policy-status-indicator"},Wi={class:"policy-actions"},Qi={key:0,class:"policy-approval-status"},qi={class:"status-container"},Ki={key:0,class:"policy-approved-date"},Ji={class:"date-value"},zi={key:1,class:"policy-rejection-remarks"},Hi={class:"remarks-value"},Yi={key:1},Gi={key:0,class:"compliance-details"},Zi={class:"compliance-detail-row"},es={class:"compliance-detail-row"},as={class:"compliance-detail-row"},ts={class:"compliance-detail-row"},is={class:"compliance-detail-row"},ss={class:"policy-actions"},os={key:0},ls={class:"subpolicy-id"},ns={class:"subpolicy-name"},rs={key:0},cs={class:"subpolicy-actions"},ds=["onClick"],us=["onClick"],ps=["onClick"],vs={key:2,class:"policy-detail-row"},ms={key:1,class:"rejected-approvals-list"},ks=["onClick"],hs={key:2,class:"edit-policy-modal"},gs={class:"edit-policy-content"},ys={class:"rejection-reason"},fs={key:3,class:"edit-policy-modal"},bs={class:"edit-policy-content"},Cs=["value"],Ls=["value"],ws=["value"],Es={key:0,class:"edit-subpolicy-section"},Rs={class:"subpolicy-edit-header"},Ds={class:"subpolicy-edit-field"},Is=["onUpdate:modelValue"],Ps={class:"subpolicy-edit-field"},_s=["onUpdate:modelValue"],Ss={class:"subpolicy-edit-field"},As=["onUpdate:modelValue"],Ts={class:"subpolicy-edit-field"},xs={class:"rejection-reason"},Fs={key:4,class:"modal"},Vs={class:"modal-content edit-modal"},Ms={key:0,class:"version-tag reviewer-version"},Xs={key:0},Us={class:"form-group"},Ns={class:"form-group"},$s={key:0,class:"rejection-reason-container"},Os={class:"rejection-reason-content"},js={class:"form-group"},Bs={class:"form-group"},Ws={key:1,class:"changes-summary"},Qs={class:"changes-content"},qs={key:0,class:"change-item"},Ks={key:1,class:"change-item"},Js={class:"form-actions"},zs=["disabled"],Hs={key:5,class:"subpolicies-modal"},Ys={class:"subpolicies-modal-content"},Gs={key:0},Zs={key:1},eo={key:2,class:"version-pill reviewer-version"},ao={key:3,class:"version-pill"},to={class:"subpolicy-header"},io={class:"subpolicy-id"},so={class:"subpolicy-name"},oo={key:0,class:"version-tag reviewer-version"},lo={key:1,class:"version-tag"},no={class:"subpolicy-content"},ro={key:0},co={key:1,class:"edit-history"},uo={class:"edit-history-content"},po={class:"edit-field"},vo={key:0},mo={class:"field-previous"},ko={class:"field-current"},ho={class:"field-value"},go={class:"edit-field"},yo={key:0},fo={class:"field-previous"},bo={class:"field-current"},Co={class:"field-value"},Lo={key:0,class:"subpolicy-actions"},wo=["onClick"],Eo=["onClick"],Ro={key:1},Do={key:0},Io={class:"subpolicy-inline-edit"},Po={class:"version-tag reviewer-version"},_o=["onUpdate:modelValue"],So=["onUpdate:modelValue"],Ao=["onUpdate:modelValue"],To={class:"rejection-reason"},xo={class:"subpolicy-edit-actions"},Fo=["onClick"],Vo=["onClick"],Mo=["onClick"],Xo={key:6,class:"reject-modal"},Uo={class:"reject-modal-content"},No={class:"reject-modal-actions"};function $o(e,a,t,o,l,n){const r=(0,s.g2)("CollapsibleTable"),c=(0,s.g2)("DynamicTable"),u=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",ii,[l.rbacLoading?((0,s.uX)(),(0,s.CE)("div",si,a[38]||(a[38]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Checking access permissions...",-1)]))):l.canApprovePolicies||l.canViewPolicies||l.rbacLoading?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",ci,[a[47]||(a[47]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Policy Approver",-1)),(0,s.Lk)("div",di,[(0,s.Lk)("button",{class:"action-btn",onClick:a[2]||(a[2]=(...e)=>n.refreshData&&n.refreshData(...e))},a[45]||(a[45]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),a[46]||(a[46]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",ui,[l.isLoading?((0,s.uX)(),(0,s.CE)("div",pi,a[48]||(a[48]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading approval data...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",vi,[a[49]||(a[49]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(l.error),1),(0,s.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>n.refreshData&&n.refreshData(...e)),class:"retry-btn"},"Retry")])):((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",mi,[a[51]||(a[51]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",ki,[a[50]||(a[50]=(0,s.Lk)("div",{class:"summary-label"},"Pending Approvals",-1)),(0,s.Lk)("div",hi,(0,d.v_)(n.pendingApprovalsCount),1)])]),(0,s.Lk)("div",gi,[a[53]||(a[53]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",yi,[a[52]||(a[52]=(0,s.Lk)("div",{class:"summary-label"},"Approved",-1)),(0,s.Lk)("div",fi,(0,d.v_)(n.approvedApprovalsCount),1)])]),(0,s.Lk)("div",bi,[a[55]||(a[55]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",Ci,[a[54]||(a[54]=(0,s.Lk)("div",{class:"summary-label"},"Rejected",-1)),(0,s.Lk)("div",Li,(0,d.v_)(n.rejectedApprovalsCount),1)])])],64))]),(0,s.Lk)("div",wi,[a[57]||(a[57]=(0,s.Lk)("h3",null,"My Approval Tasks",-1)),(0,s.Lk)("div",Ei,[l.actualPolicyCounts.pending>0?((0,s.uX)(),(0,s.CE)("div",Ri,[(0,s.bF)(r,{"section-config":n.pendingSectionConfig,"table-headers":n.tableHeaders,"is-expanded":l.pendingExpanded,pagination:l.pagination.pending,onNextPage:()=>n.nextPage("pending"),onPrevPage:()=>n.prevPage("pending"),onTaskClick:n.handleTaskClick,onToggle:n.togglePendingSection},null,8,["section-config","table-headers","is-expanded","pagination","onNextPage","onPrevPage","onTaskClick","onToggle"])])):(0,s.Q3)("",!0),l.actualPolicyCounts.approved>0?((0,s.uX)(),(0,s.CE)("div",Di,[(0,s.bF)(r,{"section-config":n.approvedSectionConfig,"table-headers":n.tableHeaders,"is-expanded":l.approvedExpanded,pagination:l.pagination.approved,onNextPage:()=>n.nextPage("approved"),onPrevPage:()=>n.prevPage("approved"),onTaskClick:n.handleTaskClick,onToggle:n.toggleApprovedSection},null,8,["section-config","table-headers","is-expanded","pagination","onNextPage","onPrevPage","onTaskClick","onToggle"])])):(0,s.Q3)("",!0),l.actualPolicyCounts.rejected>0?((0,s.uX)(),(0,s.CE)("div",Ii,[(0,s.bF)(r,{"section-config":n.rejectedSectionConfig,"table-headers":n.tableHeaders,"is-expanded":l.rejectedExpanded,pagination:l.pagination.rejected,onNextPage:()=>n.nextPage("rejected"),onPrevPage:()=>n.prevPage("rejected"),onTaskClick:n.handleTaskClick,onToggle:n.toggleRejectedSection},null,8,["section-config","table-headers","is-expanded","pagination","onNextPage","onPrevPage","onTaskClick","onToggle"])])):(0,s.Q3)("",!0),0===l.actualPolicyCounts.pending&&0===l.actualPolicyCounts.approved&&0===l.actualPolicyCounts.rejected?((0,s.uX)(),(0,s.CE)("div",Pi,a[56]||(a[56]=[(0,s.Lk)("div",{class:"no-approvals-content"},[(0,s.Lk)("i",{class:"fas fa-inbox"}),(0,s.Lk)("h4",null,"No Policies Found"),(0,s.Lk)("p",null,"There are no policies in the system at the moment.")],-1)]))):(0,s.Q3)("",!0)])]),l.showDetails&&l.selectedApproval?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:a[8]||(a[8]=(0,i.D$)((...e)=>n.closeApprovalDetails&&n.closeApprovalDetails(...e),["self"]))},[(0,s.Lk)("div",_i,[(0,s.Lk)("span",{class:"close-x",onClick:a[4]||(a[4]=(...e)=>n.closeApprovalDetails&&n.closeApprovalDetails(...e)),title:"Close"},"Ã—"),(0,s.Lk)("div",Si,[(0,s.Lk)("h3",null,[(0,s.Lk)("span",Ai,(0,d.v_)(n.isComplianceApproval?"Compliance":"Policy"),1),(0,s.eW)(" Details: "+(0,d.v_)(n.getPolicyId(l.selectedApproval))+" ",1),(0,s.Lk)("span",Ti,"Version: "+(0,d.v_)(l.selectedApproval.version||"u1"),1),l.selectedApproval.showingApprovedOnly?((0,s.uX)(),(0,s.CE)("span",xi," Showing Approved Only ")):(0,s.Q3)("",!0)])]),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",Fi,[(0,s.Lk)("div",Vi,[a[58]||(a[58]=(0,s.Lk)("div",{class:"version-label"},"Current Version:",-1)),(0,s.Lk)("div",Mi,(0,d.v_)(l.selectedApproval.version||"u1"),1)]),l.selectedApproval.ExtractedData.subpolicies&&l.selectedApproval.ExtractedData.subpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",Xi,[a[59]||(a[59]=(0,s.Lk)("h4",null,"Subpolicies Versions:",-1)),(0,s.Lk)("ul",Ui,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.ExtractedData.subpolicies,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.SubPolicyId},[(0,s.Lk)("span",Ni,(0,d.v_)(e.SubPolicyName),1),(0,s.Lk)("span",$i,"v"+(0,d.v_)(e.version||"u1"),1),e.resubmitted?((0,s.uX)(),(0,s.CE)("span",Oi,"Resubmitted")):(0,s.Q3)("",!0)]))),128))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",ji,[(0,s.Lk)("h4",null,(0,d.v_)(n.isComplianceApproval?"Compliance":"Policy")+" Approval",1),(0,s.Lk)("div",Bi,[a[60]||(a[60]=(0,s.Lk)("span",{class:"status-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",{"status-approved":"Approved"===l.selectedApproval.dbStatus||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status,"status-rejected":"Rejected"===l.selectedApproval.dbStatus||!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status,"status-pending":!["Approved","Rejected"].includes(l.selectedApproval.dbStatus)&&null===l.selectedApproval.ApprovedNot&&!["Approved","Rejected"].includes(l.selectedApproval.ExtractedData?.Status)}])},(0,d.v_)("Approved"===l.selectedApproval.dbStatus||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status?"Approved":"Rejected"===l.selectedApproval.dbStatus||!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status?"Rejected":"Under Review"),3)]),(0,s.Lk)("div",Wi,[(0,s.Lk)("button",{class:"submit-btn",onClick:a[5]||(a[5]=e=>n.submitReview()),"data-action":"submit-policy-review"},a[61]||(a[61]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.eW)(" Submit Review ")]))]),n.approvalStatus&&!0!==l.selectedApproval.ApprovedNot&&"Approved"!==l.selectedApproval.ExtractedData?.Status&&!1!==l.selectedApproval.ApprovedNot&&"Rejected"!==l.selectedApproval.ExtractedData?.Status?((0,s.uX)(),(0,s.CE)("div",Qi,[(0,s.Lk)("div",qi,[a[62]||(a[62]=(0,s.Lk)("div",{class:"status-label"},"Status:",-1)),(0,s.Lk)("div",{class:(0,d.C4)(["status-value",{approved:!0===n.approvalStatus.approved,rejected:!1===n.approvalStatus.approved,pending:null===n.approvalStatus.approved}])},(0,d.v_)(!0===n.approvalStatus.approved?"Approved":!1===n.approvalStatus.approved?"Rejected":"Pending"),3)]),!0===n.approvalStatus.approved&&l.selectedApproval.ApprovedDate?((0,s.uX)(),(0,s.CE)("div",Ki,[a[63]||(a[63]=(0,s.Lk)("div",{class:"date-label"},"Approved Date:",-1)),(0,s.Lk)("div",Ji,(0,d.v_)(n.formatDate(l.selectedApproval.ApprovedDate)),1)])):(0,s.Q3)("",!0),!1===n.approvalStatus.approved&&n.approvalStatus.remarks?((0,s.uX)(),(0,s.CE)("div",zi,[a[64]||(a[64]=(0,s.Lk)("div",{class:"remarks-label"},"Rejection Reason:",-1)),(0,s.Lk)("div",Hi,(0,d.v_)(n.approvalStatus.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",Yi,[n.isComplianceApproval?((0,s.uX)(),(0,s.CE)("div",Gi,[(0,s.Lk)("div",Zi,[a[65]||(a[65]=(0,s.Lk)("strong",null,"Description:",-1)),a[66]||(a[66]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.ComplianceItemDescription),1)]),(0,s.Lk)("div",es,[a[67]||(a[67]=(0,s.Lk)("strong",null,"Criticality:",-1)),a[68]||(a[68]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.Criticality),1)]),(0,s.Lk)("div",as,[a[69]||(a[69]=(0,s.Lk)("strong",null,"Impact:",-1)),a[70]||(a[70]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.Impact),1)]),(0,s.Lk)("div",ts,[a[71]||(a[71]=(0,s.Lk)("strong",null,"Probability:",-1)),a[72]||(a[72]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.Probability),1)]),(0,s.Lk)("div",is,[a[73]||(a[73]=(0,s.Lk)("strong",null,"Mitigation:",-1)),a[74]||(a[74]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.mitigation),1)]),(0,s.Lk)("div",ss,[(0,s.Lk)("button",{class:"approve-btn",onClick:a[6]||(a[6]=e=>n.approveCompliance())},"Approve"),(0,s.Lk)("button",{class:"reject-btn",onClick:a[7]||(a[7]=e=>n.rejectCompliance())},"Reject")])])):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.selectedApproval.ExtractedData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"policy-detail-row"},["subpolicies"!==t&&"policy_approval"!==t?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("strong",null,(0,d.v_)(t)+":",1),a[75]||(a[75]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(e),1)],64)):(0,s.Q3)("",!0),"subpolicies"===t&&Array.isArray(e)?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[a[81]||(a[81]=(0,s.Lk)("h4",null,"Subpolicies",-1)),e&&e.length?((0,s.uX)(),(0,s.CE)("ul",os,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.Identifier,class:"subpolicy-status"},[(0,s.Lk)("div",null,[(0,s.Lk)("span",ls,(0,d.v_)(e.Identifier),1),a[76]||(a[76]=(0,s.eW)(" : ")),(0,s.Lk)("span",ns,(0,d.v_)(e.SubPolicyName),1),a[77]||(a[77]=(0,s.Lk)("span",{class:"item-type-badge subpolicy-badge"},"Subpolicy",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["badge",{approved:!0===e.approval?.approved||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status,rejected:!1===e.approval?.approved&&!(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status),pending:null===e.approval?.approved&&!e.resubmitted&&!(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status),resubmitted:null===e.approval?.approved&&e.resubmitted&&!(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status)}])},(0,d.v_)(!0===e.approval?.approved||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status?"Approved":!1===e.approval?.approved?"Rejected":e.resubmitted?"Resubmitted":"Pending"),3)]),(0,s.Lk)("div",null,[a[78]||(a[78]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)]),(0,s.Lk)("div",null,[a[79]||(a[79]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Control),1)]),!1===e.approval?.approved?((0,s.uX)(),(0,s.CE)("div",rs,[a[80]||(a[80]=(0,s.Lk)("strong",null,"Reason:",-1)),(0,s.eW)(" "+(0,d.v_)(e.approval?.remarks),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",cs,[l.isReviewer?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},["Under Review"!==e.Status&&e.Status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a=>n.approveSubpolicy(e),class:"approve-button"}," Approve ",8,ds)),"Under Review"!==e.Status&&e.Status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:a=>n.rejectSubpolicy(e),class:"reject-button"}," Reject ",8,us))],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},["Rejected"===e.Status?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a=>n.openEditSubpolicyModal(e),class:"edit-button"}," Edit & Resubmit ",8,ps)):(0,s.Q3)("",!0)],64))])]))),128))])):(0,s.Q3)("",!0)],64)):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),l.selectedApproval&&l.selectedApproval.PolicyId?((0,s.uX)(),(0,s.CE)("div",vs,[a[82]||(a[82]=(0,s.Lk)("strong",null,"Policy ID:",-1)),a[83]||(a[83]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(n.getPolicyId(l.selectedApproval)),1)])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),l.rejectedPolicies.length?((0,s.uX)(),(0,s.CE)("div",ms,[a[85]||(a[85]=(0,s.Lk)("h3",null,"Rejected Policies & Compliances (Edit & Resubmit)",-1)),(0,s.bF)(c,{data:n.rejectedPoliciesTableData,columns:n.rejectedPoliciesColumns,"show-actions":!0,"show-pagination":!0,"default-page-size":10,"unique-key":"ApprovalId",onRowAction:n.handleRejectedItemAction},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"view-details-btn",onClick:a=>n.openRejectedItem(e.originalPolicy),title:"View Details"},a[84]||(a[84]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,ks)]),_:1},8,["data","columns","onRowAction"])])):(0,s.Q3)("",!0),l.showEditComplianceModal&&l.editingCompliance?((0,s.uX)(),(0,s.CE)("div",hs,[(0,s.Lk)("div",gs,[(0,s.Lk)("h3",null,"Edit & Resubmit Compliance: "+(0,d.v_)(n.getPolicyId(l.editingCompliance)),1),(0,s.Lk)("button",{class:"close-btn",onClick:a[9]||(a[9]=(...e)=>n.closeEditComplianceModal&&n.closeEditComplianceModal(...e))},"Close"),(0,s.Lk)("div",null,[a[86]||(a[86]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[10]||(a[10]=e=>l.editingCompliance.ExtractedData.ComplianceItemDescription=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.ComplianceItemDescription]])]),(0,s.Lk)("div",null,[a[88]||(a[88]=(0,s.Lk)("label",null,"Criticality:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[11]||(a[11]=e=>l.editingCompliance.ExtractedData.Criticality=e)},a[87]||(a[87]=[(0,s.Lk)("option",null,"High",-1),(0,s.Lk)("option",null,"Medium",-1),(0,s.Lk)("option",null,"Low",-1)]),512),[[i.u1,l.editingCompliance.ExtractedData.Criticality]])]),(0,s.Lk)("div",null,[a[89]||(a[89]=(0,s.Lk)("label",null,"Impact:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[12]||(a[12]=e=>l.editingCompliance.ExtractedData.Impact=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.Impact]])]),(0,s.Lk)("div",null,[a[90]||(a[90]=(0,s.Lk)("label",null,"Probability:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[13]||(a[13]=e=>l.editingCompliance.ExtractedData.Probability=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.Probability]])]),(0,s.Lk)("div",null,[a[91]||(a[91]=(0,s.Lk)("label",null,"Mitigation:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[14]||(a[14]=e=>l.editingCompliance.ExtractedData.mitigation=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.mitigation]])]),(0,s.Lk)("div",null,[a[92]||(a[92]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",ys,(0,d.v_)(l.editingCompliance.ExtractedData.compliance_approval?.remarks),1)]),(0,s.Lk)("button",{class:"resubmit-btn",onClick:a[15]||(a[15]=e=>n.resubmitCompliance(l.editingCompliance))},"Resubmit for Review")])])):(0,s.Q3)("",!0),e.showEditModal&&l.editingPolicy?((0,s.uX)(),(0,s.CE)("div",fs,[(0,s.Lk)("div",bs,[(0,s.Lk)("h3",null,"Edit & Resubmit Policy: "+(0,d.v_)(n.getPolicyId(l.editingPolicy)),1),(0,s.Lk)("button",{class:"close-btn",onClick:a[16]||(a[16]=(...a)=>e.closeEditModal&&e.closeEditModal(...a))},"Close"),(0,s.Lk)("div",null,[a[93]||(a[93]=(0,s.Lk)("label",null,"Scope:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[17]||(a[17]=e=>l.editingPolicy.ExtractedData.Scope=e)},null,512),[[i.Jo,l.editingPolicy.ExtractedData.Scope]])]),(0,s.Lk)("div",null,[a[94]||(a[94]=(0,s.Lk)("label",null,"Objective:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[18]||(a[18]=e=>l.editingPolicy.ExtractedData.Objective=e)},null,512),[[i.Jo,l.editingPolicy.ExtractedData.Objective]])]),(0,s.Lk)("div",null,[a[96]||(a[96]=(0,s.Lk)("label",null,"Policy Type:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[19]||(a[19]=e=>l.editingPolicy.ExtractedData.PolicyType=e),class:"form-control",onChange:a[20]||(a[20]=e=>n.handlePolicyTypeChange(l.editingPolicy))},[a[95]||(a[95]=(0,s.Lk)("option",{value:""},"Select Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.policyTypeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Cs))),128))],544),[[i.u1,l.editingPolicy.ExtractedData.PolicyType]])]),(0,s.Lk)("div",null,[a[98]||(a[98]=(0,s.Lk)("label",null,"Policy Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[21]||(a[21]=e=>l.editingPolicy.ExtractedData.PolicyCategory=e),class:"form-control",onChange:a[22]||(a[22]=e=>n.handlePolicyCategoryChange(l.editingPolicy))},[a[97]||(a[97]=(0,s.Lk)("option",{value:""},"Select Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicyCategories(l.editingPolicy.ExtractedData.PolicyType),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Ls))),128))],544),[[i.u1,l.editingPolicy.ExtractedData.PolicyCategory]])]),(0,s.Lk)("div",null,[a[100]||(a[100]=(0,s.Lk)("label",null,"Policy Sub Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[23]||(a[23]=e=>l.editingPolicy.ExtractedData.PolicySubCategory=e),class:"form-control"},[a[99]||(a[99]=(0,s.Lk)("option",{value:""},"Select Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicySubCategories(l.editingPolicy.ExtractedData.PolicyType,l.editingPolicy.ExtractedData.PolicyCategory),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ws))),128))],512),[[i.u1,l.editingPolicy.ExtractedData.PolicySubCategory]])]),n.hasRejectedSubpolicies?((0,s.uX)(),(0,s.CE)("div",Es,[a[106]||(a[106]=(0,s.Lk)("h4",null,"Rejected Subpolicies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.rejectedSubpoliciesInPolicy,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.Identifier,class:"subpolicy-edit-item"},[(0,s.Lk)("div",Rs,[(0,s.Lk)("span",null,(0,d.v_)(e.Identifier)+": "+(0,d.v_)(e.SubPolicyName),1),a[101]||(a[101]=(0,s.Lk)("span",{class:"subpolicy-badge"},"Rejected",-1))]),(0,s.Lk)("div",Ds,[a[102]||(a[102]=(0,s.Lk)("label",null,"Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.SubPolicyName=a},null,8,Is),[[i.Jo,e.SubPolicyName]])]),(0,s.Lk)("div",Ps,[a[103]||(a[103]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Description=a},null,8,_s),[[i.Jo,e.Description]])]),(0,s.Lk)("div",Ss,[a[104]||(a[104]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Control=a},null,8,As),[[i.Jo,e.Control]])]),(0,s.Lk)("div",Ts,[a[105]||(a[105]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",xs,(0,d.v_)(e.approval?.remarks),1)])]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"resubmit-btn",onClick:a[24]||(a[24]=e=>n.resubmitPolicy(l.editingPolicy))},"Resubmit for Review")])])):(0,s.Q3)("",!0),e.showEditSubpolicyModal?((0,s.uX)(),(0,s.CE)("div",Fs,[(0,s.Lk)("div",Vs,[(0,s.Lk)("span",{class:"close",onClick:a[25]||(a[25]=(...e)=>n.closeEditSubpolicyModal&&n.closeEditSubpolicyModal(...e))},"Ã—"),(0,s.Lk)("h2",null,[a[107]||(a[107]=(0,s.eW)("Edit Rejected Subpolicy ")),!l.editingSubpolicy||"Rejected"!==l.editingSubpolicy.Status&&!1!==l.editingSubpolicy.approval?.approved?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",Ms," Version: "+(0,d.v_)(l.editingSubpolicy.reviewerVersion||"R1"),1))]),l.editingSubpolicy?((0,s.uX)(),(0,s.CE)("div",Xs,[(0,s.Lk)("div",Us,[a[108]||(a[108]=(0,s.Lk)("label",null,"Subpolicy Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[26]||(a[26]=e=>l.editingSubpolicy.SubPolicyName=e),disabled:""},null,512),[[i.Jo,l.editingSubpolicy.SubPolicyName]])]),(0,s.Lk)("div",Ns,[a[109]||(a[109]=(0,s.Lk)("label",null,"Identifier:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[27]||(a[27]=e=>l.editingSubpolicy.Identifier=e),disabled:""},null,512),[[i.Jo,l.editingSubpolicy.Identifier]])]),l.editingSubpolicy.approval&&l.editingSubpolicy.approval.remarks?((0,s.uX)(),(0,s.CE)("div",$s,[a[110]||(a[110]=(0,s.Lk)("div",{class:"rejection-reason-header"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Rejection Reason ")],-1)),(0,s.Lk)("div",Os,(0,d.v_)(l.editingSubpolicy.approval.remarks),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",js,[a[111]||(a[111]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[28]||(a[28]=e=>l.editingSubpolicy.Description=e),onInput:a[29]||(a[29]=(...e)=>n.trackChanges&&n.trackChanges(...e))},null,544),[[i.Jo,l.editingSubpolicy.Description]])]),(0,s.Lk)("div",Bs,[a[112]||(a[112]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[30]||(a[30]=e=>l.editingSubpolicy.Control=e),onInput:a[31]||(a[31]=(...e)=>n.trackChanges&&n.trackChanges(...e))},null,544),[[i.Jo,l.editingSubpolicy.Control]])]),n.hasChanges?((0,s.uX)(),(0,s.CE)("div",Ws,[a[113]||(a[113]=(0,s.Lk)("div",{class:"changes-header"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Changes detected ")],-1)),(0,s.Lk)("div",Qs,[l.editingSubpolicy.Description!==l.editingSubpolicy.originalDescription?((0,s.uX)(),(0,s.CE)("div",qs," Description has been modified ")):(0,s.Q3)("",!0),l.editingSubpolicy.Control!==l.editingSubpolicy.originalControl?((0,s.uX)(),(0,s.CE)("div",Ks," Control has been modified ")):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Js,[(0,s.Lk)("button",{class:"resubmit-btn",onClick:a[32]||(a[32]=e=>n.resubmitSubpolicy()),disabled:!n.hasChanges},(0,d.v_)(n.hasChanges?"Resubmit with Changes":"Make changes to resubmit"),9,zs),(0,s.Lk)("button",{class:"cancel-btn",onClick:a[33]||(a[33]=(...e)=>n.closeEditSubpolicyModal&&n.closeEditSubpolicyModal(...e))},"Cancel")])])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),l.showSubpoliciesModal&&l.selectedPolicyForSubpolicies?((0,s.uX)(),(0,s.CE)("div",Hs,[(0,s.Lk)("div",Ys,[(0,s.Lk)("h3",null,[l.isReviewer?((0,s.uX)(),(0,s.CE)("span",Gs,"Subpolicies for "+(0,d.v_)(n.getPolicyId(l.selectedPolicyForSubpolicies)),1)):((0,s.uX)(),(0,s.CE)("span",Zs,"Edit Rejected Subpolicies for "+(0,d.v_)(n.getPolicyId(l.selectedPolicyForSubpolicies)),1)),!1===l.selectedPolicyForSubpolicies.ApprovedNot||"Rejected"===l.selectedPolicyForSubpolicies.ExtractedData?.Status?((0,s.uX)(),(0,s.CE)("span",eo," Version: "+(0,d.v_)(l.selectedPolicyForSubpolicies.reviewerVersion||"R1"),1)):((0,s.uX)(),(0,s.CE)("span",ao," Version: "+(0,d.v_)(l.selectedPolicyForSubpolicies.version||"u1"),1))]),(0,s.Lk)("button",{class:"close-btn",onClick:a[34]||(a[34]=(...e)=>n.closeSubpoliciesModal&&n.closeSubpoliciesModal(...e))},"Close"),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredSubpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.Identifier,class:(0,d.C4)(["subpolicy-status",{"resubmitted-item":e.resubmitted}])},[(0,s.Lk)("div",to,[(0,s.Lk)("span",io,(0,d.v_)(e.Identifier),1),(0,s.Lk)("span",so,(0,d.v_)(e.SubPolicyName),1),"Rejected"===e.Status||e.approval&&!1===e.approval.approved?((0,s.uX)(),(0,s.CE)("span",oo," Version: "+(0,d.v_)(e.reviewerVersion||"R1"),1)):((0,s.uX)(),(0,s.CE)("span",lo," Version: "+(0,d.v_)(e.version||"u1"),1))]),(0,s.Lk)("div",no,[(0,s.Lk)("div",null,[a[114]||(a[114]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)]),(0,s.Lk)("div",null,[a[115]||(a[115]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Control),1)]),!1===e.approval?.approved?((0,s.uX)(),(0,s.CE)("div",ro,[a[116]||(a[116]=(0,s.Lk)("strong",null,"Rejection Reason:",-1)),(0,s.eW)(" "+(0,d.v_)(e.approval?.remarks),1)])):(0,s.Q3)("",!0),e.resubmitted&&l.isReviewer?((0,s.uX)(),(0,s.CE)("div",co,[a[121]||(a[121]=(0,s.Lk)("div",{class:"edit-history-header"},[(0,s.Lk)("i",{class:"fas fa-history"}),(0,s.eW)(" Resubmitted with Changes ")],-1)),(0,s.Lk)("div",uo,[(0,s.Lk)("div",po,[e.previousVersion?((0,s.uX)(),(0,s.CE)("div",vo,[a[117]||(a[117]=(0,s.Lk)("div",{class:"field-label"},"Original Description:",-1)),(0,s.Lk)("div",mo,(0,d.v_)(e.previousVersion.Description||"Not available"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",ko,[a[118]||(a[118]=(0,s.Lk)("div",{class:"field-label"},"Updated Description:",-1)),(0,s.Lk)("div",ho,(0,d.v_)(e.Description),1)])]),(0,s.Lk)("div",go,[e.previousVersion?((0,s.uX)(),(0,s.CE)("div",yo,[a[119]||(a[119]=(0,s.Lk)("div",{class:"field-label"},"Original Control:",-1)),(0,s.Lk)("div",fo,(0,d.v_)(e.previousVersion.Control||"Not available"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",bo,[a[120]||(a[120]=(0,s.Lk)("div",{class:"field-label"},"Updated Control:",-1)),(0,s.Lk)("div",Co,(0,d.v_)(e.Control),1)])])])])):(0,s.Q3)("",!0)]),!l.isReviewer||null!==e.approval?.approved&&void 0!==e.approval?.approved?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Lo,[(0,s.Lk)("button",{class:"approve-btn",onClick:a=>n.approveSubpolicyFromModal(e)},"Approve",8,wo),(0,s.Lk)("button",{class:"reject-btn",onClick:a=>n.rejectSubpolicyFromModal(e)},"Reject",8,Eo)])),!1===e.approval?.approved||"Rejected"===e.Status?((0,s.uX)(),(0,s.CE)("div",Ro,[e.showEditForm?((0,s.uX)(),(0,s.CE)("div",Do,[(0,s.Lk)("div",Io,[(0,s.Lk)("h4",null,[a[122]||(a[122]=(0,s.eW)("Edit Rejected Subpolicy ")),(0,s.Lk)("span",Po,"Version: "+(0,d.v_)(e.reviewerVersion||"R1"),1)]),(0,s.Lk)("div",null,[a[123]||(a[123]=(0,s.Lk)("label",null,"Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.SubPolicyName=a,disabled:""},null,8,_o),[[i.Jo,e.SubPolicyName]])]),(0,s.Lk)("div",null,[a[124]||(a[124]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Description=a},null,8,So),[[i.Jo,e.Description]])]),(0,s.Lk)("div",null,[a[125]||(a[125]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Control=a},null,8,Ao),[[i.Jo,e.Control]])]),(0,s.Lk)("div",null,[a[126]||(a[126]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",To,(0,d.v_)(e.approval&&e.approval.remarks?e.approval.remarks:"No rejection reason provided"),1)]),(0,s.Lk)("div",xo,[(0,s.Lk)("button",{class:"resubmit-btn",onClick:a=>n.resubmitSubpolicyDirect(e)},"Resubmit for Review",8,Fo),l.isReviewer?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"cancel-btn",onClick:a=>n.hideEditFormInline(e)},"Cancel",8,Vo)):(0,s.Q3)("",!0)])])])):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"edit-btn",onClick:a=>n.showEditFormInline(e)},"Edit & Resubmit",8,Mo))])):(0,s.Q3)("",!0)],2))),128))])])):(0,s.Q3)("",!0),(0,s.bF)(u),e.showRejectModal?((0,s.uX)(),(0,s.CE)("div",Xo,[(0,s.Lk)("div",Uo,[a[127]||(a[127]=(0,s.Lk)("h4",null,"Rejection Reason",-1)),(0,s.Lk)("p",null,"Please provide a reason for rejecting "+(0,d.v_)("policy"===e.rejectingType?"the policy":"subpolicy "+e.rejectingSubpolicy?.Identifier),1),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[35]||(a[35]=a=>e.rejectionComment=a),class:"rejection-comment",placeholder:"Enter your comments here..."},null,512),[[i.Jo,e.rejectionComment]]),(0,s.Lk)("div",No,[(0,s.Lk)("button",{class:"cancel-btn",onClick:a[36]||(a[36]=(...e)=>n.cancelRejection&&n.cancelRejection(...e))},"Cancel"),(0,s.Lk)("button",{class:"confirm-btn",onClick:a[37]||(a[37]=(...e)=>n.confirmRejection&&n.confirmRejection(...e))},"Confirm Rejection")])])])):(0,s.Q3)("",!0)],64)):((0,s.uX)(),(0,s.CE)("div",oi,[(0,s.Lk)("div",li,[a[42]||(a[42]=(0,s.Lk)("i",{class:"fas fa-shield-alt access-denied-icon"},null,-1)),a[43]||(a[43]=(0,s.Lk)("h2",null,"Access Denied",-1)),a[44]||(a[44]=(0,s.Lk)("p",null,"You don't have permission to approve policies. Please contact your administrator.",-1)),(0,s.Lk)("div",ni,[a[39]||(a[39]=(0,s.Lk)("strong",null,"Your Role:",-1)),(0,s.eW)(" "+(0,d.v_)(l.userRole),1)]),(0,s.Lk)("div",ri,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=e=>n.showAccessDenied("approve")),class:"btn btn-warning"},a[40]||(a[40]=[(0,s.Lk)("i",{class:"fas fa-envelope"},null,-1),(0,s.eW)(" Contact Admin ")])),(0,s.Lk)("button",{onClick:a[1]||(a[1]=a=>e.$router.push("/policy")),class:"btn btn-secondary"},a[41]||(a[41]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Policies ")]))])])]))])}const Oo={class:"pagination-bar"},jo={class:"results-info"},Bo={class:"page-size-selector"},Wo=["value"],Qo={class:"pagination-controls"},qo=["disabled"],Ko=["onClick"],Jo={key:1,class:"ellipsis"},zo=["disabled"];function Ho(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Oo,[(0,s.Lk)("div",jo," Results: "+(0,d.v_)(o.startResult)+" - "+(0,d.v_)(o.endResult)+" of "+(0,d.v_)(t.totalItems),1),(0,s.Lk)("div",Bo,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.localPageSize=e),onChange:a[1]||(a[1]=(...e)=>o.onPageSizeChange&&o.onPageSizeChange(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.pageSizeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Wo))),128))],544),[[i.u1,o.localPageSize,void 0,{number:!0}]])]),(0,s.Lk)("div",Qo,[(0,s.Lk)("button",{disabled:1===t.currentPage,onClick:a[2]||(a[2]=a=>e.$emit("update:page",t.currentPage-1))},"<",8,qo),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.paginationNumbers,a=>((0,s.uX)(),(0,s.CE)(s.FK,{key:a},["number"===typeof a?((0,s.uX)(),(0,s.CE)("button",{key:0,class:(0,d.C4)({active:a===t.currentPage}),onClick:t=>e.$emit("update:page",a)},(0,d.v_)(a),11,Ko)):((0,s.uX)(),(0,s.CE)("span",Jo,"..."))],64))),128)),(0,s.Lk)("button",{disabled:t.currentPage===t.totalPages,onClick:a[3]||(a[3]=a=>e.$emit("update:page",t.currentPage+1))},">",8,zo)])])}var Yo={name:"PaginationComponent",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},pageSize:{type:Number,required:!0},totalItems:{type:Number,required:!0},pageSizeOptions:{type:Array,default:()=>[6,15,30,50]}},emits:["update:page","update:pageSize"],setup(e,{emit:a}){console.log("Pagination component props:",e);const t=(0,ee.KR)(e.pageSize);(0,s.wB)(()=>e.pageSize,e=>{t.value=e});const i=(0,s.EW)(()=>0===e.totalItems?0:(e.currentPage-1)*e.pageSize+1),o=(0,s.EW)(()=>Math.min(e.currentPage*e.pageSize,e.totalItems)),l=(0,s.EW)(()=>{const a=[],t=e.totalPages,i=e.currentPage;if(t<=7)for(let e=1;e<=t;e++)a.push(e);else{a.push(1),i>3&&a.push("...");let e=Math.max(2,i-1),s=Math.min(t-1,i+1);i<=2&&(e=2,s=3),i>=t-1&&(e=t-2,s=t-1);for(let t=e;t<=s;t++)a.push(t);i<t-2&&a.push("..."),a.push(t)}return a.filter((e,a,t)=>t.indexOf(e)===a)});function n(){a("update:pageSize",t.value)}return{localPageSize:t,startResult:i,endResult:o,paginationNumbers:l,onPageSizeChange:n}}};const Go=(0,se.A)(Yo,[["render",Ho],["__scopeId","data-v-e0861b9a"]]);var Zo=Go,el=t(1315),al=t(3631),tl=t(9137),il=t(4672),sl=t(7294),ol=t(5505);const ll={class:"header-left"},nl={class:"header-right"},rl={key:0},cl={class:"task-table"},dl={class:"column-header",style:{position:"relative"}},ul={key:0,class:"filter-arrows"},pl=["onClick","aria-label"],vl=["onClick","aria-label"],ml=["onClick","aria-label"],kl=["onMousedown","onTouchstart"],hl=["onClick"],gl=["innerHTML"],yl=["title"];var fl={__name:"CollapsibleTable",props:{sectionConfig:{type:Object,required:!0},tableHeaders:{type:Array,required:!0},isExpanded:{type:Boolean,default:!0},pagination:{type:Object,default:null},onNextPage:{type:Function,default:null},onPrevPage:{type:Function,default:null}},emits:["toggle","addTask","taskClick"],setup(e,{emit:a}){const t=e;console.log("CollapsibleTable props:",{sectionName:t.sectionConfig?.name,pagination:t.pagination,isExpanded:t.isExpanded,tasksCount:t.sectionConfig?.tasks?.length});const o=a,l=()=>{o("toggle")},n=(0,s.EW)(()=>{switch(t.sectionConfig.name){case"Pending":case"Open":case"Assigned":return el.A;case"In Progress":case"Under Review":case"Pending Review":case"Scheduled":return al.A;case"Completed":case"Closed":case"Approved":return tl.A;case"Rejected":return el.A;case"Not Assigned":case"Unknown":return el.A;default:return el.A}}),r=(0,s.EW)(()=>{const e=t.sectionConfig.name;return"Pending"===e||"Open"===e||"Rejected"===e||"Assigned"===e||"Not Assigned"===e||"Unknown"===e?"light":"fill"}),c=e=>!(!e||"string"!==typeof e)&&e.length>50,u=(0,ee.KR)(""),p=(0,ee.KR)("asc"),v=e=>{u.value=e,p.value="asc"},m=e=>{u.value=e,p.value="desc"},k=(0,s.EW)(()=>u.value?[...t.sectionConfig.tasks].sort((e,a)=>{const t=e[u.value],i=a[u.value];return null==t?1:null==i?-1:t<i?"asc"===p.value?-1:1:t>i?"asc"===p.value?1:-1:0}):t.sectionConfig.tasks),h=(0,ee.KR)({}),g=(0,ee.KR)({active:!1,columnKey:null,startX:0,startWidth:0}),y=(e,a)=>{e.preventDefault(),g.value.active=!0,g.value.columnKey=a,g.value.startX=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,g.value.startWidth=h.value[a]||150},f=e=>{if(!g.value.active)return;const a=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,t=a-g.value.startX;let i=g.value.startWidth+t;i<50&&(i=50),h.value={...h.value,[g.value.columnKey]:i}},b=()=>{g.value.active&&(g.value.active=!1,g.value.columnKey=null)};return(0,s.sV)(()=>{window.addEventListener("mousemove",f),window.addEventListener("mouseup",b),window.addEventListener("touchmove",f),window.addEventListener("touchend",b)}),(0,s.xo)(()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",b),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",b)}),(a,t)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["task-section",e.sectionConfig.statusClass])},[(0,s.Lk)("div",{class:"task-section-header",onClick:l},[(0,s.Lk)("div",ll,[((0,s.uX)(),(0,s.Wv)((0,s.$y)(e.isExpanded?(0,ee.R1)(il.A):(0,ee.R1)(sl.A)),{size:16})),(0,s.Lk)("div",{class:(0,d.C4)(["status-chip",e.sectionConfig.statusClass])},[((0,s.uX)(),(0,s.Wv)((0,s.$y)(n.value),{size:14,weight:r.value},null,8,["weight"])),(0,s.Lk)("span",null,(0,d.v_)(e.sectionConfig.name),1)],2)]),(0,s.Lk)("div",nl,[(0,s.bF)((0,ee.R1)(ol.A),{size:20})])]),e.isExpanded?((0,s.uX)(),(0,s.CE)("div",rl,[(0,s.Lk)("table",cl,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.tableHeaders,e=>((0,s.uX)(),(0,s.CE)("th",{key:e.key,class:(0,d.C4)(e.className),style:(0,d.Tr)({width:h.value[e.key]?h.value[e.key]+"px":e.width?e.width:"auto"})},[(0,s.Lk)("div",dl,[(0,s.eW)((0,d.v_)(e.label)+" ",1),e.sortable?((0,s.uX)(),(0,s.CE)("span",ul,[u.value===e.key&&"asc"===p.value?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"sort-btn",onClick:(0,i.D$)(a=>m(e.key),["stop"]),"aria-label":"Sort "+e.label+" descending"}," â–² ",8,pl)):(0,s.Q3)("",!0),u.value!==e.key||"desc"===p.value?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"sort-btn",onClick:(0,i.D$)(a=>m(e.key),["stop"]),"aria-label":"Sort "+e.label+" descending"}," â–¼ ",8,vl)):(0,s.Q3)("",!0),u.value===e.key&&"desc"===p.value?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"sort-btn",onClick:(0,i.D$)(a=>v(e.key),["stop"]),"aria-label":"Sort "+e.label+" ascending"}," â–¼ ",8,ml)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:"resize-handle",onMousedown:a=>y(a,e.key),onTouchstart:a=>y(a,e.key)},null,40,kl)])],6))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(k.value,i=>((0,s.uX)(),(0,s.CE)("tr",{key:i.incidentId},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.tableHeaders,e=>((0,s.uX)(),(0,s.CE)("td",{key:e.key,class:(0,d.C4)(e.className),style:(0,d.Tr)({width:h.value[e.key]?h.value[e.key]+"px":e.width?e.width:"auto"})},["actions"===e.key?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"view-details-btn",onClick:e=>a.$emit("taskClick",i)},t[2]||(t[2]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" VIEW DETAILS ")]),8,hl)):["criticality","priority","status"].includes(e.key)?((0,s.uX)(),(0,s.CE)("span",{key:1,innerHTML:i[e.key]},null,8,gl)):((0,s.uX)(),(0,s.CE)("div",{key:2,class:(0,d.C4)(["cell-content",{truncated:c(i[e.key])}]),title:c(i[e.key])?i[e.key]:""},(0,d.v_)(i[e.key]),11,yl))],6))),128))]))),128))])]),e.pagination?((0,s.uX)(),(0,s.Wv)(Zo,{key:0,"current-page":e.pagination.currentPage,"total-pages":e.pagination.totalPages,"page-size":e.pagination.pageSize,"total-items":e.pagination.totalCount,"page-size-options":e.pagination.pageSizeOptions||[6,15,30,50],"onUpdate:page":t[0]||(t[0]=a=>{a>e.pagination.currentPage?e.onNextPage&&e.onNextPage():a<e.pagination.currentPage&&e.onPrevPage&&e.onPrevPage()}),"onUpdate:pageSize":t[1]||(t[1]=a=>e.pagination.onPageSizeChange&&e.pagination.onPageSizeChange(a))},null,8,["current-page","total-pages","page-size","total-items","page-size-options"])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)],2))}};const bl=(0,se.A)(fl,[["__scopeId","data-v-3c5046da"]]);var Cl=bl,Ll=t(6567),wl={name:"PolicyApprover",components:{PopupModal:vt,CollapsibleTable:Cl,DynamicTable:Ll.A},data(){return{rbacLoading:!0,rbacError:null,canApprovePolicies:!1,canViewPolicies:!1,userRole:"Not assigned",approvals:[],rejectedPolicies:[],rejectedSubpolicies:[],showDetails:!1,selectedApproval:null,selectedPolicyForSubpolicies:null,rejectedPolicyToEdit:null,editingSubpolicy:null,editingPolicy:null,editingSubpolicyParent:null,userId:2,showSubpoliciesModal:!1,showEditComplianceModal:!1,editingCompliance:null,isReviewer:!0,activeTab:"pending",policyCategories:[],policyCategoriesMap:{},pendingExpanded:!0,approvedExpanded:!1,rejectedExpanded:!1,isLoading:!1,error:null,actualPolicyCounts:{pending:0,approved:0,rejected:0},actualPolicies:{pending:[],approved:[],rejected:[]},pagination:{pending:{currentPage:1,pageSize:6,totalPages:1,totalCount:0},approved:{currentPage:1,pageSize:6,totalPages:1,totalCount:0},rejected:{currentPage:1,pageSize:6,totalPages:1,totalCount:0}}}},async mounted(){console.log("PolicyApprover component mounted");try{await this.initializeRBAC()}catch(e){return console.error("RBAC initialization failed:",e),this.rbacError=e.message,void(this.rbacLoading=!1)}if(!this.canApprovePolicies&&!this.canViewPolicies)return console.log("User does not have permission to approve or view policies"),void(this.rbacLoading=!1);this.isLoading=!0,Promise.all([this.fetchPolicyTypes(),this.fetchPolicyCounts()]).then(()=>this.fetchAllPoliciesByStatus()).then(()=>{console.log("All initial data loaded"),this.isLoading=!1,setTimeout(()=>{this.debugDataState()},1e3)}).catch(e=>{console.error("Error loading initial data:",e),this.error="Failed to load data",this.isLoading=!1}),this.isReviewer||this.fetchRejectedSubpolicies()},watch:{isReviewer(e){e?(this.fetchPolicies(),this.fetchRejectedPolicies()):this.fetchRejectedSubpolicies()}},methods:{async initializeRBAC(){try{this.rbacLoading=!0,this.rbacError=null,await ft.init();const e=ft.getPolicyComponentAccess();this.canApprovePolicies=e?.canApprovePolicy||!1,this.canViewPolicies=e?.canViewAllPolicies||!1,this.userRole=ft.getUserRole()?.role||"Not assigned",console.log("[PolicyApprover] RBAC initialized:",e)}catch(e){console.error("[PolicyApprover] Failed to initialize RBAC:",e),this.rbacError=e.message,this.canApprovePolicies=!1,this.canViewPolicies=!1}finally{this.rbacLoading=!1}},showAccessDenied(e="approve"){ft.showPolicyAccessDenied(e)},fetchPolicies(){return console.log("Fetching policy approvals for reviewer..."),qe.A.get("http://localhost:8000/api/policy-approvals/reviewer/").then(e=>{let a;if(console.log("Policy approvals response:",e.data),e.data.success&&e.data.data)a=e.data.data;else{if(!Array.isArray(e.data))return console.error("Unexpected response format:",e.data),void(this.approvals=[]);a=e.data}if(console.log("Processing approvals data:",a.length,"items"),!Array.isArray(a)||0===a.length)return console.log("No policy approvals found"),void(this.approvals=[]);const t=a.map(e=>(console.log("Processing approval:",e.ApprovalId,"PolicyId:",e.PolicyId,"ApprovedNot:",e.ApprovedNot),{ApprovalId:e.ApprovalId,PolicyId:e.PolicyId,ExtractedData:e.ExtractedData||{},ApprovedNot:e.ApprovedNot,ApprovedDate:e.ApprovedDate,version:e.Version||"u1",UserId:e.UserId,ReviewerId:e.ReviewerId,dbStatus:null,Identifier:e.Identifier}));console.log("Created approvals array:",t.length,"items");const i=t.filter(e=>e.PolicyId&&null!==e.PolicyId).map(e=>e.PolicyId);if(console.log("Policy IDs to fetch status for:",i),i.length>0){const e=i.map(e=>qe.A.get(`http://localhost:8000/api/policies/${e}/`).then(a=>(console.log(`Policy ${e} status:`,a.data.Status),{policyId:e,status:a.data.Status})).catch(a=>(console.error(`Error fetching policy ${e}:`,a),{policyId:e,status:"Under Review"})));return Promise.all(e).then(e=>{console.log("Fetched policy statuses:",e),e.forEach(e=>{const a=t.find(a=>a.PolicyId===e.policyId);a&&(a.dbStatus=e.status,a.ExtractedData&&(a.ExtractedData.Status=e.status),console.log(`Updated approval ${a.ApprovalId} with status: ${e.status}`))}),this.approvals=t,console.log("Final approvals with database status:",this.approvals),console.log("Pending:",this.pendingApprovalsCount),console.log("Approved:",this.approvedApprovalsCount),console.log("Rejected:",this.rejectedApprovalsCount)}).catch(e=>{console.error("Error updating policy statuses:",e),this.approvals=t})}console.log("No valid policy IDs found"),this.approvals=t}).catch(e=>{throw console.error("Error fetching policy approvals:",e),this.approvals=[],e})},openApprovalDetails(e){const a=this.getPolicyId(e);qe.A.get(`http://localhost:8000/api/policies/${a}/version/`).then(t=>{const i=t.data.version||"u1";console.log(`Latest policy version: ${i}`),qe.A.get(`http://localhost:8000/api/policies/${a}/`).then(t=>{const s=t.data.Status;console.log(`Policy database status: ${s}`),qe.A.get(`http://localhost:8000/api/policy-approvals/latest/${a}/`).then(a=>{if(console.log("Latest policy approval:",a.data),a.data&&a.data.ExtractedData){const t=a.data,o={...e,...t,dbStatus:s,version:i,ExtractedData:t.ExtractedData};if(o.ExtractedData&&s&&(o.ExtractedData.Status=s),o.ExtractedData&&o.ExtractedData.subpolicies&&o.ExtractedData.subpolicies.length>0){console.log("Fetching versions for",o.ExtractedData.subpolicies.length,"subpolicies");const e=o.ExtractedData.subpolicies.map(e=>e.SubPolicyId?qe.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/version/`).then(a=>(console.log(`Subpolicy ${e.SubPolicyId} version:`,a.data.version),e.version=a.data.version||"u1",e)).catch(a=>(console.error(`Error fetching version for subpolicy ${e.SubPolicyId}:`,a),e.version="u1",e)):(e.version="u1",Promise.resolve(e)));Promise.all(e).then(e=>{o.ExtractedData.subpolicies=e,this.completeApprovalSelection(o)}).catch(e=>{console.error("Error updating subpolicy versions:",e),this.completeApprovalSelection(o)})}else this.completeApprovalSelection(o)}else{const a=JSON.parse(JSON.stringify(e));a.version=i,a.dbStatus=s,a.ExtractedData&&s&&(a.ExtractedData.Status=s),this.processSubpolicyVersions(a)}}).catch(a=>{console.error("Error fetching latest approval:",a);const t=JSON.parse(JSON.stringify(e));t.version=i,t.dbStatus=s,t.ExtractedData&&s&&(t.ExtractedData.Status=s),this.processSubpolicyVersions(t)})}).catch(a=>{console.error("Error fetching policy status:",a);const t=JSON.parse(JSON.stringify(e));t.version=i,this.processSubpolicyVersions(t)})}).catch(a=>{console.error("Error fetching policy version:",a),this.completeApprovalSelection(e)})},processSubpolicyVersions(e){if(e.ExtractedData&&e.ExtractedData.subpolicies&&e.ExtractedData.subpolicies.length>0){console.log("Fetching versions for",e.ExtractedData.subpolicies.length,"subpolicies");const a=e.ExtractedData.subpolicies.map(e=>e.SubPolicyId?qe.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/version/`).then(a=>(console.log(`Subpolicy ${e.SubPolicyId} version:`,a.data.version),e.version=a.data.version||"u1",qe.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`).then(a=>(a.data&&a.data.Status&&(e.Status=a.data.Status),e)).catch(a=>(console.error(`Error fetching subpolicy status for ${e.SubPolicyId}:`,a),e)))).catch(a=>(console.error(`Error fetching version for subpolicy ${e.SubPolicyId}:`,a),e.version="u1",e)):(e.version="u1",Promise.resolve(e)));Promise.all(a).then(a=>{e.ExtractedData.subpolicies=a,this.completeApprovalSelection(e)}).catch(a=>{console.error("Error updating subpolicy versions:",a),this.completeApprovalSelection(e)})}else this.completeApprovalSelection(e)},completeApprovalSelection(e){this.selectedApproval=e,this.selectedApproval.ExtractedData&&(!0===this.selectedApproval.ApprovedNot||"Approved"===this.selectedApproval.ExtractedData.Status)&&this.selectedApproval.ExtractedData.subpolicies&&(this.selectedApproval.ExtractedData.subpolicies=this.selectedApproval.ExtractedData.subpolicies.map(e=>(e.approval||(e.approval={}),e.approval.approved=!0,e.Status="Approved",e)),this.selectedApproval.showingApprovedOnly=!0),this.showDetails=!0},refreshData(){console.log("Refreshing Policy Approver data..."),this.actualPolicies={pending:[],approved:[],rejected:[]},this.pagination.pending.currentPage=1,this.pagination.approved.currentPage=1,this.pagination.rejected.currentPage=1,this.isLoading=!0,this.error=null,Promise.all([this.fetchPolicyTypes(),this.fetchPolicyCounts()]).then(()=>this.fetchAllPoliciesByStatus()).then(()=>{console.log("All data refreshed successfully"),this.isLoading=!1}).catch(e=>{console.error("Error refreshing data:",e),this.error="Failed to refresh data",this.isLoading=!1})},refreshApprovals(){this.fetchPolicies()},fetchRejectedPolicies(){return console.log("Fetching rejected policies..."),qe.A.get("http://localhost:8000/api/policies/?status=Rejected").then(e=>{let a;if(console.log("Rejected policies response:",e.data),e.data.success&&e.data.data)a=e.data.data;else{if(!Array.isArray(e.data))return void console.error("Unexpected response format:",e.data);a=e.data}if(!(Array.isArray(a)&&a.length>0))return console.log("No rejected policies found from API"),this.fetchPoliciesWithRejectedSubpolicies();this.rejectedPolicies=a.map(e=>({PolicyId:e.PolicyId,ExtractedData:{type:"policy",PolicyName:e.PolicyName,CreatedByName:e.CreatedByName,CreatedByDate:e.CreatedByDate,Scope:e.Scope,Status:e.Status,Objective:e.Objective,subpolicies:e.subpolicies||[]},ApprovedNot:!1,main_policy_rejected:!0})),console.log("Processed rejected policies:",this.rejectedPolicies.length)}).catch(e=>{throw console.error("Error fetching rejected policies:",e),e})},fetchPoliciesWithRejectedSubpolicies(){console.log("Fetching policies with rejected subpolicies..."),qe.A.get("http://localhost:8000/api/policies/").then(e=>{let a;if(console.log("All policies response:",e.data),e.data.success&&e.data.data)a=e.data.data;else{if(!Array.isArray(e.data))return void console.error("Unexpected response format:",e.data);a=e.data}if(console.log("Policies data length:",a.length),Array.isArray(a)){const e=a.filter(e=>e.subpolicies&&e.subpolicies.some(e=>"Rejected"===e.Status));console.log("Found policies with rejected subpolicies:",e.length),e.length>0&&(this.rejectedPolicies=e.map(e=>({PolicyId:e.PolicyId,ExtractedData:{type:"policy",PolicyName:e.PolicyName,CreatedByName:e.CreatedByName,CreatedByDate:e.CreatedByDate,Scope:e.Scope,Status:e.Status,Objective:e.Objective,subpolicies:e.subpolicies||[]},ApprovedNot:"Rejected"!==e.Status&&null,main_policy_rejected:"Rejected"===e.Status})))}}).catch(e=>{console.error("Error fetching policies with rejected subpolicies:",e)})},submitReview(){if(!this.isComplianceApproval){const e=this.selectedApproval.PolicyId,a={ExtractedData:JSON.parse(JSON.stringify(this.selectedApproval.ExtractedData)),ApprovedNot:this.selectedApproval.ApprovedNot,UserId:this.userId,ReviewerId:this.userId};return void qe.A.get(`http://localhost:8000/api/policies/${e}/version/`).then(t=>{const i=t.data.version;console.log("Current version before submission:",i);const s=this.selectedApproval.ExtractedData.subpolicies&&this.selectedApproval.ExtractedData.subpolicies.some(e=>"Rejected"===e.Status);"approve"===this.reviewDecision&&s?this.$swal({title:"Warning",text:"One or more subpolicies are rejected. The policy will still be marked as rejected regardless of approval.",icon:"warning",confirmButtonText:"Continue"}).then(()=>{this.submitPolicyReview(e,a,i)}):this.submitPolicyReview(e,a,i)}).catch(e=>{console.error("Error getting policy version:",e),Za.error("Error getting policy version: "+(e.response?.data?.error||e.message),"Policy Version Error")})}const e={ExtractedData:JSON.parse(JSON.stringify(this.selectedApproval.ExtractedData)),ApprovedNot:this.selectedApproval.ApprovedNot};qe.A.put(`http://localhost:8000/api/compliance-approvals/${this.selectedApproval.ApprovalId}/review/`,e).then(e=>{console.log("Response:",e.data),e.data.ApprovalId&&(this.selectedApproval.ApprovalId=e.data.ApprovalId,this.selectedApproval.Version=e.data.Version,e.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=e.data.ApprovedDate),Za.success("Compliance review submitted successfully!","Review Submitted"),this.closeApprovalDetails(),this.refreshApprovals())}).catch(e=>{console.error("Error submitting compliance review:",e),Za.error("Error submitting review: "+(e.response?.data?.error||e.message),"Review Error")})},submitPolicyReview(e,a,t){qe.A.post(`http://localhost:8000/api/policies/${e}/submit-review/`,{...a,currentVersion:t,approved:"approve"===this.reviewDecision}).then(e=>{console.log("Policy review submitted successfully:",e.data),this.selectedApproval.Version=e.data.Version,e.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=e.data.ApprovedDate),Za.success(`Policy review submitted successfully! New version: ${e.data.Version}`,"Review Submitted"),this.closeApprovalDetails(),this.refreshApprovals()}).catch(e=>{console.error("Error submitting review:",e),Za.error("Error submitting review: "+(e.response?.data?.error||e.message),"Submission Error")})},resubmitPolicy(e){const a=this.getPolicyId(e);console.log("Resubmitting policy with ID:",a),console.log("Policy data before preparing:",e);const t=this.validatePolicyData(e);if(t.length>0)return void Za.warning(`Please fix the following errors before resubmitting:\n${t.join("\n")}`,"Validation Errors");e.ExtractedData.subpolicies&&e.ExtractedData.subpolicies.length>0?e.ExtractedData.subpolicies.forEach((e,a)=>{console.log(`Checking subpolicy ${a} with ID: ${e.SubPolicyId}`),e.SubPolicyName||console.warn(`SubPolicyName is missing for subpolicy ${a}`),e.Description||console.warn(`Description is missing for subpolicy ${a}`)}):console.warn("No subpolicies found in policy data or subpolicies array is not properly structured");const i={PolicyName:e.ExtractedData.PolicyName,PolicyDescription:e.ExtractedData.PolicyDescription,Scope:e.ExtractedData.Scope,Objective:e.ExtractedData.Objective,Department:e.ExtractedData.Department,Applicability:e.ExtractedData.Applicability,subpolicies:e.ExtractedData.subpolicies||[]};console.log("Prepared resubmission data:",i),console.log("Subpolicies in resubmission data:",i.subpolicies),console.log("Number of subpolicies:",i.subpolicies.length),qe.A.put(`http://localhost:8000/api/policies/${a}/resubmit-approval/`,i).then(e=>{console.log("Policy resubmitted successfully:",e.data),Za.success(`Policy resubmitted for review! New version: ${e.data.Version}`,"Policy Resubmitted"),this.closeEditModal(),this.fetchRejectedPolicies(),this.fetchPolicies()}).catch(e=>{console.error("Error data:",e.response?e.response.data:"No response data"),this.handleError(e,"resubmitting policy")})},validatePolicyData(e){const a=[];return e.ExtractedData.PolicyName||a.push("Policy Name is required"),e.ExtractedData.PolicyDescription||a.push("Policy Description is required"),e.ExtractedData.subpolicies&&e.ExtractedData.subpolicies.length>0&&e.ExtractedData.subpolicies.forEach((e,t)=>{e.SubPolicyName||a.push(`Subpolicy #${t+1} is missing a name`),e.Description||a.push(`Subpolicy #${t+1} is missing a description`)}),a},handleError(e,a){console.error(`Error ${a}:`,e);let t="An unexpected error occurred";return t=e.response?e.response.data&&e.response.data.error?e.response.data.error:e.response.data&&"string"===typeof e.response.data?e.response.data:`Server error: ${e.response.status}`:e.request?"No response from server. Please check your connection.":e.message||t,Za.error(`Error ${a}: ${t}`,"Error"),t},approveSubpolicy(e){e.approval||(e.approval={}),e.approval.approved=!0,e.approval.remarks="",qe.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`,{Status:"Approved"}).then(a=>(console.log("Subpolicy status updated successfully:",a.data),qe.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/review/`,{Status:"Approved"}))).then(e=>{console.log("Subpolicy approval created successfully:",e.data),e.data.PolicyUpdated&&(console.log(`Policy status updated to: ${e.data.PolicyStatus}`),this.fetchPolicies(),this.selectedApproval&&this.selectedApproval.ExtractedData&&(this.selectedApproval.ExtractedData.Status=e.data.PolicyStatus)),this.checkAllSubpoliciesApproved()}).catch(e=>{console.error("Error approving subpolicy:",e),Za.error("Error approving subpolicy. Please try again.","Approval Error")})},checkAllSubpoliciesApproved(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData||!this.selectedApproval.ExtractedData.subpolicies||0===this.selectedApproval.ExtractedData.subpolicies.length)return;const e=this.selectedApproval.ExtractedData.subpolicies,a=e.every(e=>!0===e.approval?.approved);a&&(console.log("All subpolicies are approved! The policy should be automatically approved"),this.selectedApproval.ExtractedData.policy_approval||(this.selectedApproval.ExtractedData.policy_approval={}),this.selectedApproval.ExtractedData.policy_approval.approved=!0,this.selectedApproval.ApprovedNot=!0,Za.success("All subpolicies are approved! The policy has been automatically approved.","Auto-Approval"))},rejectSubpolicy(e){this.rejectingType="subpolicy",this.rejectingSubpolicy=e,this.showRejectModal=!0},cancelRejection(){this.showRejectModal=!1,this.rejectingSubpolicy=null,this.rejectingType="",this.rejectionComment=""},confirmRejection(){if("policy"===this.rejectingType&&this.rejectingPolicy){const e="object"===typeof this.rejectingPolicy.PolicyId?this.rejectingPolicy.PolicyId.PolicyId:this.rejectingPolicy.PolicyId;console.log("Rejecting policy with ID:",e),qe.A.put(`http://localhost:8000/api/policies/${e}/`,{Status:"Rejected"}).then(()=>{this.rejectingPolicy.ExtractedData.Status="Rejected",this.rejectingPolicy.policy_approval={approved:!1,remarks:this.rejectionComment},this.showRejectModal=!1,this.rejectingPolicy=null,this.rejectingType="",this.rejectionComment=""}).catch(e=>{console.error("Error rejecting policy:",e),Za.error("Error rejecting policy: "+(e.response?.data?.error||e.message),"Rejection Error")})}else if("subpolicy"===this.rejectingType&&this.rejectingSubpolicy){if(!this.rejectingSubpolicy.SubPolicyId)return console.error("Missing SubPolicyId, cannot reject subpolicy",this.rejectingSubpolicy),Za.error("Error: Cannot reject subpolicy - missing SubPolicyId","Missing ID Error"),this.showRejectModal=!1,this.rejectingSubpolicy=null,this.rejectingType="",void(this.rejectionComment="");console.log("Rejecting subpolicy with ID:",this.rejectingSubpolicy.SubPolicyId);const e="Rejected";console.log("Sending data:",{Status:e}),qe.A.put(`http://localhost:8000/api/subpolicies/${this.rejectingSubpolicy.SubPolicyId}/`,{Status:e}).then(a=>(console.log("Subpolicy status updated successfully:",a.data),qe.A.put(`http://localhost:8000/api/subpolicies/${this.rejectingSubpolicy.SubPolicyId}/review/`,{Status:e,remarks:this.rejectionComment}))).then(e=>{console.log("Policy approval created successfully:",e.data),this.rejectingSubpolicy.approval||(this.rejectingSubpolicy.approval={}),this.rejectingSubpolicy.Status="Rejected",this.rejectingSubpolicy.approval.approved=!1,this.rejectingSubpolicy.approval.remarks=this.rejectionComment,this.showRejectModal=!1,this.rejectingSubpolicy=null,this.rejectingType="",this.rejectionComment="",this.isReviewer||this.fetchRejectedSubpolicies()}).catch(e=>{console.error("Error rejecting subpolicy:",e),Za.error("Error rejecting subpolicy. Please try again.","Rejection Error")})}},getPolicyId(e){return e.PolicyId?"object"===typeof e.PolicyId?e.PolicyId.PolicyId:e.PolicyId:e.ApprovalId},closeApprovalDetails(){this.selectedApproval=null,this.showDetails=!1},approveCompliance(){this.selectedApproval.ExtractedData.compliance_approval||(this.selectedApproval.ExtractedData.compliance_approval={}),this.selectedApproval.ExtractedData.compliance_approval.approved=!0,this.selectedApproval.ExtractedData.compliance_approval.remarks="",this.selectedApproval.ApprovedNot=!0},rejectCompliance(){this.rejectingType="compliance",this.showRejectModal=!0},openRejectedItem(e){this.selectedApproval=e,this.showDetails=!0,this.showEditComplianceModal=!1,this.showEditModal=!1,this.showSubpoliciesModal=!1},closeEditComplianceModal(){this.showEditComplianceModal=!1,this.editingCompliance=null},resubmitCompliance(e){e.ExtractedData.compliance_approval&&(e.ExtractedData.compliance_approval.approved=null,e.ExtractedData.compliance_approval.remarks=""),qe.A.put(`http://localhost:8000/api/compliance-approvals/resubmit/${e.ApprovalId}/`,{ExtractedData:e.ExtractedData}).then(()=>{Za.success("Compliance resubmitted for review!","Compliance Resubmitted"),this.showEditComplianceModal=!1,this.fetchRejectedPolicies(),setTimeout(()=>{window.location.reload()},500)}).catch(e=>{Za.error("Error resubmitting compliance","Resubmission Error"),console.error(e)})},showEditFormInline(e){console.log("Opening inline edit form for subpolicy:",e.SubPolicyId),e.originalDescription=e.Description,e.originalControl=e.Control,e.approval||(e.approval={remarks:"",approved:!1}),("Rejected"===e.Status||e.approval&&!1===e.approval.approved)&&qe.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`).then(a=>{const t=a.data.version||"R1";if(console.log(`Using reviewer version ${t} for rejected subpolicy ${e.SubPolicyId}`),e.reviewerVersion=t,a.data.approval_data&&a.data.approval_data.ExtractedData&&a.data.approval_data.ExtractedData.subpolicies){const t=a.data.approval_data,i=t.ExtractedData.subpolicies.find(a=>a.SubPolicyId===e.SubPolicyId);if(i){const a=e.originalDescription,t=e.originalControl;Object.assign(e,i),e.originalDescription=a,e.originalControl=t,e.approval||(e.approval={remarks:"",approved:!1}),console.log(`Updated subpolicy ${e.SubPolicyId} with R version data for inline edit`)}}}).catch(a=>{console.error("Error fetching reviewer version:",a),e.reviewerVersion="R1"}),e.showEditForm=!0},hideEditFormInline(e){e.showEditForm=!1},resubmitSubpolicy(){if(!this.editingSubpolicy||!this.editingSubpolicy.SubPolicyId)return console.error("Missing SubPolicyId, cannot resubmit subpolicy",this.editingSubpolicy),void Za.error("Error: Cannot resubmit subpolicy - missing SubPolicyId","Missing ID Error");if(!this.hasChanges)return void Za.warning("No changes detected. Please modify the subpolicy before resubmitting.","No Changes");const e={Control:this.editingSubpolicy.Control,Description:this.editingSubpolicy.Description,SubPolicyId:this.editingSubpolicy.SubPolicyId};qe.A.put(`http://localhost:8000/api/subpolicies/${this.editingSubpolicy.SubPolicyId}/resubmit/`,e).then(e=>{console.log("Subpolicy resubmitted successfully:",e.data);const a=e.data.version;this.editingSubpolicy.Status="Under Review",this.editingSubpolicy.version=a,this.editingSubpolicy.approval||(this.editingSubpolicy.approval={}),this.editingSubpolicy.approval.approved=null,this.editingSubpolicy.resubmitted=!0,Za.success(`Subpolicy "${this.editingSubpolicy.SubPolicyName}" resubmitted successfully with version ${a}!`,"Subpolicy Resubmitted"),this.closeEditSubpolicyModal(),this.fetchRejectedSubpolicies(),this.refreshData()}).catch(e=>{console.error("Error resubmitting subpolicy:",e.response||e),Za.error(`Error resubmitting subpolicy: ${e.response?.data?.error||e.message}`,"Resubmission Error")})},updateSubpolicyReferences(e,a){if(this.selectedApproval?.ExtractedData?.subpolicies){const t=this.selectedApproval.ExtractedData.subpolicies.find(a=>a.SubPolicyId===e);t&&Object.assign(t,a)}if(this.selectedPolicyForSubpolicies?.ExtractedData?.subpolicies){const t=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.find(a=>a.SubPolicyId===e);t&&Object.assign(t,a)}const t=this.rejectedSubpolicies.find(a=>a.SubPolicyId===e);t&&Object.assign(t,a)},resubmitSubpolicyDirect(e){if(!e.SubPolicyId)return console.error("Missing SubPolicyId, cannot resubmit subpolicy",e),void Za.error("Error: Cannot resubmit subpolicy - missing SubPolicyId","Missing ID Error");const a=e.Description!==e.originalDescription||e.Control!==e.originalControl;if(!a)return void Za.warning("No changes detected. Please modify the subpolicy before resubmitting.","No Changes");console.log("Resubmitting subpolicy with ID:",e.SubPolicyId),console.log("Changes detected in inline edit form");const t={Description:e.originalDescription,Control:e.originalControl};e.resubmitted=!0;const i={Control:e.Control,Description:e.Description,previousVersion:t,SubPolicyId:e.SubPolicyId};qe.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/resubmit/`,i).then(a=>{console.log("Subpolicy resubmitted successfully:",a.data),e.Status="Under Review",e.approval||(e.approval={}),e.approval.approved=null,e.previousVersion=t,a.data.Version&&(e.version=a.data.Version),Za.success(`Subpolicy "${e.SubPolicyName}" resubmitted successfully with version ${a.data.Version||"u1"}!`,"Subpolicy Resubmitted"),this.hideEditFormInline(e),this.closeSubpoliciesModal(),this.fetchRejectedSubpolicies(),this.fetchPolicies()}).catch(e=>{console.error("Error resubmitting subpolicy:",e.response||e),Za.error(`Error resubmitting subpolicy: ${e.response?.data?.error||e.message}`,"Resubmission Error")})},getSubpolicyVersion(e){return e.version?e.version:e.approval&&e.approval.version?e.approval.version:"u1"},openSubpoliciesModal(e){if(this.selectedPolicyForSubpolicies=e,e.ExtractedData&&(!0===e.ApprovedNot||"Approved"===e.ExtractedData.Status)&&e.ExtractedData.subpolicies)this.selectedPolicyForSubpolicies=JSON.parse(JSON.stringify(e)),this.selectedPolicyForSubpolicies.ExtractedData.subpolicies=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.map(e=>(e.approval||(e.approval={}),e.approval.approved=!0,e.Status="Approved",e));else if(e.ExtractedData&&(!1===e.ApprovedNot||"Rejected"===e.ExtractedData.Status)&&e.ExtractedData.subpolicies){this.selectedPolicyForSubpolicies=JSON.parse(JSON.stringify(e));const a=this.getPolicyId(e);qe.A.get(`http://localhost:8000/api/policies/${a}/reviewer-version/`).then(e=>{const t=e.data.version||"R1";if(console.log(`Using reviewer version: ${t} for policy ${a}`),e.data.approval_data){const a=e.data.approval_data;if(console.log("Found R version approval data:",a),a.ExtractedData){const e=this.selectedPolicyForSubpolicies;this.selectedPolicyForSubpolicies={...e,ExtractedData:a.ExtractedData,reviewerVersion:t,ApprovalId:a.ApprovalId,Version:a.Version},console.log("Updated policy data with R version data:",this.selectedPolicyForSubpolicies)}}else this.selectedPolicyForSubpolicies.reviewerVersion=t,this.fetchSubpolicyVersions()}).catch(e=>{console.error("Error fetching policy reviewer version:",e),this.fetchSubpolicyVersions()})}this.showSubpoliciesModal=!0,this.isReviewer||setTimeout(()=>{this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.forEach(e=>{("Rejected"===e.Status||e.approval&&!1===e.approval.approved)&&(e.showEditForm=!0)})},100)},fetchSubpolicyVersions(){if(this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies){const e=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.map(e=>e.SubPolicyId?qe.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`).then(a=>{const t=a.data.version||"R1";if(console.log(`Subpolicy ${e.SubPolicyId} reviewer version: ${t}`),e.reviewerVersion=t,a.data.approval_data&&a.data.approval_data.ExtractedData&&a.data.approval_data.ExtractedData.subpolicies){const t=a.data.approval_data,i=t.ExtractedData.subpolicies.find(a=>a.SubPolicyId===e.SubPolicyId);i&&(Object.assign(e,i),console.log(`Updated subpolicy ${e.SubPolicyId} with R version data`))}return e}).catch(a=>(console.error(`Error fetching reviewer version for subpolicy ${e.SubPolicyId}:`,a),e.reviewerVersion="R1",e)):(e.reviewerVersion="R1",Promise.resolve(e)));Promise.all(e).then(()=>{console.log("All reviewer versions fetched for subpolicies")})}},closeSubpoliciesModal(){this.selectedPolicyForSubpolicies=null,this.showSubpoliciesModal=!1},approveSubpolicyFromModal(e){e.approval||(e.approval={}),e.approval.approved=!0,e.approval.remarks="",qe.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`,{Status:"Approved"}).then(a=>(console.log("Subpolicy status updated successfully:",a.data),qe.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/review/`,{Status:"Approved"}))).then(e=>{console.log("Subpolicy approval created successfully:",e.data),e.data.PolicyUpdated&&(console.log(`Policy status updated to: ${e.data.PolicyStatus}`),this.fetchPolicies(),this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&(this.selectedPolicyForSubpolicies.ExtractedData.Status=e.data.PolicyStatus)),this.checkAllModalSubpoliciesApproved()}).catch(e=>{console.error("Error approving subpolicy:",e),Za.error("Error approving subpolicy. Please try again.","Approval Error")})},checkAllModalSubpoliciesApproved(){if(!this.selectedPolicyForSubpolicies||!this.selectedPolicyForSubpolicies.ExtractedData||!this.selectedPolicyForSubpolicies.ExtractedData.subpolicies||0===this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.length)return;const e=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies,a=e.every(e=>!0===e.approval?.approved);a&&(console.log("All subpolicies in the modal are approved! The policy should be automatically approved"),this.selectedPolicyForSubpolicies.ExtractedData.policy_approval||(this.selectedPolicyForSubpolicies.ExtractedData.policy_approval={}),this.selectedPolicyForSubpolicies.ExtractedData.policy_approval.approved=!0,this.selectedPolicyForSubpolicies.ApprovedNot=!0,Za.success("All subpolicies are approved! The policy has been automatically approved.","Auto-Approval"))},rejectSubpolicyFromModal(e){this.rejectingType="subpolicy",this.rejectingSubpolicy=e,this.showRejectModal=!0},formatDate(e){if(!e)return"";const a=new Date(e);return isNaN(a.getTime())?"":a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},isNewPolicy(e){const a=e.ExtractedData?.CreatedByDate||e.created_at;if(!a)return!1;const t=new Date(a);if(isNaN(t.getTime()))return!1;const i=new Date;return i.setDate(i.getDate()-3),t>i},openEditSubpolicyModal(e){this.editingSubpolicy=JSON.parse(JSON.stringify(e)),this.editingSubpolicy.originalDescription=e.Description,this.editingSubpolicy.originalControl=e.Control,e.SubPolicyId&&qe.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`).then(a=>{const t=a.data.version||"R1";if(console.log(`Fetched reviewer version for edit modal: ${t}`),this.editingSubpolicy.reviewerVersion=t,a.data.approval_data&&a.data.approval_data.ExtractedData&&a.data.approval_data.ExtractedData.subpolicies){const t=a.data.approval_data,i=t.ExtractedData.subpolicies.find(a=>a.SubPolicyId===e.SubPolicyId);if(i){const a=this.editingSubpolicy.originalDescription,t=this.editingSubpolicy.originalControl;Object.assign(this.editingSubpolicy,i),this.editingSubpolicy.originalDescription=a,this.editingSubpolicy.originalControl=t,console.log(`Updated subpolicy ${e.SubPolicyId} with R version data for edit modal`)}}}).catch(e=>{console.error("Error fetching reviewer version:",e),this.editingSubpolicy.reviewerVersion="R1"}),this.showEditSubpolicyModal=!0,console.log("Edit modal opened with subpolicy:",this.editingSubpolicy)},closeEditSubpolicyModal(){this.showEditSubpolicyModal=!1,this.editingSubpolicy=null},findSubpolicyById(e){return this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies?this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.find(a=>a.SubPolicyId===e):null},fetchRejectedSubpolicies(){console.log("Fetching rejected subpolicies..."),qe.A.get("http://localhost:8000/api/policies/").then(e=>{console.log("Received policies for subpolicy check:",e.data.length);const a=e.data;let t=[];a.forEach(e=>{if(e.subpolicies&&e.subpolicies.length>0){console.log(`Policy ${e.PolicyId} has ${e.subpolicies.length} subpolicies`);const a=e.subpolicies.filter(e=>"Rejected"===e.Status);console.log(`Policy ${e.PolicyId} has ${a.length} rejected subpolicies`),a.forEach(a=>{a.PolicyName=e.PolicyName,a.PolicyId=e.PolicyId}),t=[...t,...a]}}),console.log("Total rejected subpolicies found:",t.length),this.rejectedSubpolicies=t,!this.isReviewer&&t.length>0&&this.updateRejectedSubpoliciesView()}).catch(e=>{console.error("Error fetching rejected subpolicies:",e)})},updateRejectedSubpoliciesView(){this.rejectedSubpolicies.length>0&&(this.activeTab="rejected")},trackChanges(){console.log("Changes detected in form")},incrementVersion(e){if(!e)return"u1";const a=e.match(/u(\d+)/);if(!a)return"u1";const t=parseInt(a[1])+1;return`u${t}`},getSubpolicyRemarks(e){return e&&e.approval&&e.approval.remarks?e.approval.remarks:"No reason provided"},fetchPolicyCategories(){qe.A.get("http://localhost:8000/api/policy-categories/").then(e=>{e.data.success&&e.data.data?this.policyCategories=e.data.data:Array.isArray(e.data)?this.policyCategories=e.data:console.error("Unexpected response format:",e.data)}).catch(e=>{console.error("Error fetching policy categories:",e)})},fetchPolicyTypes(){return console.log("Fetching policy categories..."),qe.A.get("http://localhost:8000/api/policy-categories/").then(e=>{let a;if(console.log("Policy categories response:",e.data),e.data.success&&e.data.data)a=e.data.data;else{if(!Array.isArray(e.data))return void console.error("Unexpected response format:",e.data);a=e.data}this.policyCategories=a;const t={};a.forEach(e=>{t[e.PolicyType]||(t[e.PolicyType]={categories:{}}),t[e.PolicyType].categories[e.PolicyCategory]||(t[e.PolicyType].categories[e.PolicyCategory]={subCategories:[]}),t[e.PolicyType].categories[e.PolicyCategory].subCategories.push(e.PolicySubCategory)}),this.policyCategoriesMap=t,console.log("Processed policy categories map:",this.policyCategoriesMap)}).catch(e=>{throw console.error("Error fetching policy categories:",e),e})},initializePolicyCategoryFields(e){return console.log(`Initializing policy category fields for policy: ${e.PolicyId||"New Policy"}`),e.ExtractedData.PolicyType||(e.ExtractedData.PolicyType=""),e.ExtractedData.PolicyCategory||(e.ExtractedData.PolicyCategory=""),e.ExtractedData.PolicySubCategory||(e.ExtractedData.PolicySubCategory=""),console.log("Current policy category fields:",{PolicyType:e.ExtractedData.PolicyType,PolicyCategory:e.ExtractedData.PolicyCategory,PolicySubCategory:e.ExtractedData.PolicySubCategory}),e},openRejectedPolicy(e){console.log("Opening rejected policy for editing:",e),this.editingPolicy=JSON.parse(JSON.stringify(e)),this.initializePolicyCategoryFields(this.editingPolicy),this.showEditModal=!0},handlePolicyTypeChange(e){console.log(`Policy type changed to: ${e.ExtractedData.PolicyType}`),e.ExtractedData.PolicyCategory="",e.ExtractedData.PolicySubCategory=""},handlePolicyCategoryChange(e){console.log(`Policy category changed to: ${e.ExtractedData.PolicyCategory}`),e.ExtractedData.PolicySubCategory=""},handleTaskClick(e){let a=null;const t=[...this.actualPolicies.pending,...this.actualPolicies.approved,...this.actualPolicies.rejected];a=t.find(a=>a.PolicyId===e.policyId||a.PolicyId===e.approvalId),a?this.openApprovalDetails(a):console.error("Policy not found for task:",e)},formatPolicyForTable(e){const a=e.PolicyId||"N/A",t=e.ExtractedData?.PolicyName||"No Name",i=e.ExtractedData?.Scope||"No Scope",s=e.ExtractedData?.CreatedByName||"System",o=this.formatDate(e.ExtractedData?.CreatedByDate||e.created_at),l=e.version||"v1.0";let n=e.dbStatus||e.ExtractedData?.Status||"Unknown",r="pending";return"Approved"===n?r="approved":"Rejected"===n?r="rejected":"Under Review"===n&&(n="Pending",r="pending"),{incidentId:a,approvalId:e.ApprovalId||a,policyId:a,policyName:t,scope:i,createdBy:s,createdDate:o,version:l,status:`<span class="status-badge ${r}">${n}</span>`,originalPolicy:e}},togglePendingSection(){this.pendingExpanded=!this.pendingExpanded},toggleApprovedSection(){this.approvedExpanded=!this.approvedExpanded},toggleRejectedSection(){this.rejectedExpanded=!this.rejectedExpanded},handleRejectedItemAction(e,a){console.log("Rejected item action:",e,a),"view"===e&&this.openRejectedItem(a.originalPolicy)},debugDataState(){console.log("=== Policy Approver Debug Info ==="),console.log("Total approvals:",this.approvals.length),console.log("Pending count:",this.pendingApprovalsCount),console.log("Approved count:",this.approvedApprovalsCount),console.log("Rejected count:",this.rejectedApprovalsCount),console.log("Pending approvals:",this.pendingApprovals),console.log("Approved approvals:",this.approvedApprovals),console.log("Rejected approvals:",this.rejectedApprovals),console.log("Raw approvals data:",this.approvals),console.log("=== End Debug Info ===")},fetchPolicyCounts(){return console.log("Fetching actual policy counts from database..."),qe.A.get("http://localhost:8000/api/policy-counts/").then(e=>{console.log("Policy counts response:",e.data),this.actualPolicyCounts={pending:e.data.pending||0,approved:e.data.approved||0,rejected:e.data.rejected||0},this.pagination.pending.totalPages=Math.max(1,Math.ceil(this.actualPolicyCounts.pending/this.pagination.pending.pageSize)),this.pagination.pending.totalCount=this.actualPolicyCounts.pending||0,this.pagination.approved.totalPages=Math.max(1,Math.ceil(this.actualPolicyCounts.approved/this.pagination.approved.pageSize)),this.pagination.approved.totalCount=this.actualPolicyCounts.approved||0,this.pagination.rejected.totalPages=Math.max(1,Math.ceil(this.actualPolicyCounts.rejected/this.pagination.rejected.pageSize)),this.pagination.rejected.totalCount=this.actualPolicyCounts.rejected||0,console.log("Actual policy counts from database:",this.actualPolicyCounts),console.log("Pagination info:",this.pagination)}).catch(e=>(console.error("Error fetching policy counts:",e),console.log("Falling back to individual API calls..."),Promise.all([qe.A.get("http://localhost:8000/api/policies/?status=Under Review"),qe.A.get("http://localhost:8000/api/policies/?status=Approved"),qe.A.get("http://localhost:8000/api/policies/?status=Rejected")]).then(([e,a,t])=>{const i=Array.isArray(e.data)?e.data:e.data.data||[],s=Array.isArray(a.data)?a.data:a.data.data||[],o=Array.isArray(t.data)?t.data:t.data.data||[];this.actualPolicyCounts={pending:i.length,approved:s.length,rejected:o.length},this.pagination.pending.totalPages=Math.max(1,Math.ceil(this.actualPolicyCounts.pending/this.pagination.pending.pageSize)),this.pagination.pending.totalCount=this.actualPolicyCounts.pending||0,this.pagination.approved.totalPages=Math.max(1,Math.ceil(this.actualPolicyCounts.approved/this.pagination.approved.pageSize)),this.pagination.approved.totalCount=this.actualPolicyCounts.approved||0,this.pagination.rejected.totalPages=Math.max(1,Math.ceil(this.actualPolicyCounts.rejected/this.pagination.rejected.pageSize)),this.pagination.rejected.totalCount=this.actualPolicyCounts.rejected||0,console.log("Actual policy counts from fallback method:",this.actualPolicyCounts)}).catch(e=>{console.error("Fallback method also failed:",e),this.actualPolicyCounts={pending:0,approved:0,rejected:0}})))},fetchPoliciesByStatus(e,a=1){console.log(`Fetching ${e} policies for page ${a}...`);const t={pending:"Under Review",approved:"Approved",rejected:"Rejected"},i=t[e]||e,s=this.pagination[e].pageSize,o=(a-1)*s;return qe.A.get("http://localhost:8000/api/policies-paginated/",{params:{status:i,limit:s,offset:o}}).then(t=>{if(console.log(`${e} policies response:`,t.data),t.data.success&&t.data.data){const i=t.data.data,s=t.data.pagination;this.pagination[e].totalPages=Math.max(1,s.total_pages||1),this.pagination[e].currentPage=s.current_page||1,this.pagination[e].pageSize=s.page_size||this.pagination[e].pageSize||10,this.pagination[e].totalCount=s.total_count||this.pagination[e].totalCount||0,this.actualPolicies[e]=i.map(e=>({PolicyId:e.PolicyId,ExtractedData:{PolicyName:e.PolicyName||"No Name",CreatedByName:e.CreatedByName||"System",CreatedByDate:e.CreatedByDate||e.created_at,Scope:e.Scope||"No Scope",Status:e.Status,Objective:e.Objective||"No Objective",Department:e.Department||"No Department",subpolicies:e.subpolicies||[]},ApprovedNot:"Approved"===e.Status||"Rejected"!==e.Status&&null,ApprovedDate:e.ApprovedDate,version:e.Version||"v1.0",dbStatus:e.Status})),console.log(`Stored ${this.actualPolicies[e].length} ${e} policies for page ${a}`),console.log(`Updated pagination: ${this.pagination[e].currentPage}/${this.pagination[e].totalPages}`)}else console.error("Unexpected response format from paginated endpoint:",t.data),this.actualPolicies[e]=[]}).catch(a=>{throw console.error(`Error fetching ${e} policies:`,a),this.actualPolicies[e]=[],a})},fetchAllPoliciesByStatus(){return console.log("Fetching all policies by status with pagination..."),Promise.all([this.fetchPoliciesByStatus("pending",this.pagination.pending.currentPage),this.fetchPoliciesByStatus("approved",this.pagination.approved.currentPage),this.fetchPoliciesByStatus("rejected",this.pagination.rejected.currentPage)])},changePage(e,a){console.log(`Changing to page ${a} for ${e} policies`),this.pagination[e].currentPage=a,this.fetchPoliciesByStatus(e,a)},nextPage(e){this.pagination[e].currentPage<this.pagination[e].totalPages&&this.changePage(e,this.pagination[e].currentPage+1)},prevPage(e){this.pagination[e].currentPage>1&&this.changePage(e,this.pagination[e].currentPage-1)}},computed:{policyApprovals(){return this.approvals},pendingApprovalsCount(){return this.actualPolicyCounts.pending},approvedApprovalsCount(){return this.actualPolicyCounts.approved},rejectedApprovalsCount(){return this.actualPolicyCounts.rejected},sortedPolicies(){return[...this.approvals].sort((e,a)=>{const t=new Date(e.ExtractedData?.CreatedByDate||0),i=new Date(a.ExtractedData?.CreatedByDate||0);return i-t})},policyTypeOptions(){return Object.keys(this.policyCategoriesMap)},filteredPolicyCategories(){return e=>e&&this.policyCategoriesMap[e]?Object.keys(this.policyCategoriesMap[e].categories):[]},filteredPolicySubCategories(){return(e,a)=>e&&a&&this.policyCategoriesMap[e]&&this.policyCategoriesMap[e].categories[a]?this.policyCategoriesMap[e].categories[a].subCategories:[]},hasUnreviewedSubpolicies(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData||!this.selectedApproval.ExtractedData.subpolicies)return!0;const e=this.selectedApproval.ExtractedData.subpolicies;return e.some(e=>null===e.approval?.approved||void 0===e.approval?.approved)},hasRejectedSubpolicies(){return this.rejectedSubpolicies&&this.rejectedSubpolicies.length>0},hasChanges(){if(!this.editingSubpolicy)return!1;const e=this.editingSubpolicy.Description!==this.editingSubpolicy.originalDescription,a=this.editingSubpolicy.Control!==this.editingSubpolicy.originalControl;return e||a},rejectedSubpoliciesInPolicy(){return this.editingPolicy&&this.editingPolicy.ExtractedData&&this.editingPolicy.ExtractedData.subpolicies?this.editingPolicy.ExtractedData.subpolicies.filter(e=>!1===e.approval?.approved):[]},isComplianceApproval(){return"compliance"===this.selectedApproval?.ExtractedData?.type},approvalStatus(){return this.selectedApproval&&this.selectedApproval.ExtractedData?this.isComplianceApproval?this.selectedApproval.ExtractedData.compliance_approval||{approved:null,remarks:""}:this.selectedApproval.ExtractedData.policy_approval||{approved:null,remarks:""}:null},allSubpoliciesApproved(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData||!this.selectedApproval.ExtractedData.subpolicies||0===this.selectedApproval.ExtractedData.subpolicies.length)return!1;const e=this.selectedApproval.ExtractedData.subpolicies;return e.every(e=>!0===e.approval?.approved)},filteredSubpolicies(){return this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies?this.isReviewer?this.selectedPolicyForSubpolicies.ExtractedData.subpolicies:this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.filter(e=>"Rejected"===e.Status||e.approval&&!1===e.approval.approved):[]},pendingApprovals(){return this.actualPolicies.pending.map(e=>({...e,version:e.version||"v1.0",created_at:e.ExtractedData?.CreatedByDate}))},approvedApprovals(){return this.actualPolicies.approved.map(e=>({...e,version:e.version||"v1.0",created_at:e.ExtractedData?.CreatedByDate}))},rejectedApprovals(){return this.actualPolicies.rejected.map(e=>({...e,version:e.version||"v1.0",created_at:e.ExtractedData?.CreatedByDate}))},tableHeaders(){return[{key:"approvalId",label:"Approval ID",width:"120px",className:"approval-id"},{key:"policyId",label:"Policy ID",width:"120px",className:"policy-id"},{key:"policyName",label:"Policy Name",width:"200px",className:"policy-name"},{key:"scope",label:"Scope",width:"150px",className:"policy-scope"},{key:"createdBy",label:"Created By",width:"120px",className:"created-by"},{key:"createdDate",label:"Created Date",width:"120px",className:"created-date"},{key:"version",label:"Version",width:"80px",className:"version"},{key:"status",label:"Status",width:"100px",className:"status"},{key:"actions",label:"Actions",width:"150px",className:"actions"}]},pendingSectionConfig(){return{name:"Pending",statusClass:"pending",tasks:this.pendingApprovals.map(e=>this.formatPolicyForTable(e)),pagination:this.pagination.pending,totalCount:this.actualPolicyCounts.pending}},approvedSectionConfig(){return{name:"Approved",statusClass:"completed",tasks:this.approvedApprovals.map(e=>this.formatPolicyForTable(e)),pagination:this.pagination.approved,totalCount:this.actualPolicyCounts.approved}},rejectedSectionConfig(){return{name:"Rejected",statusClass:"rejected",tasks:this.rejectedApprovals.map(e=>this.formatPolicyForTable(e)),pagination:this.pagination.rejected,totalCount:this.actualPolicyCounts.rejected}},rejectedPoliciesTableData(){return this.rejectedPolicies.map(e=>({ApprovalId:e.ApprovalId||e.PolicyId,PolicyId:this.getPolicyId(e),ItemType:e.is_compliance?"Compliance":e.main_policy_rejected?"Policy":"Subpolicy",ItemName:e.ExtractedData?.PolicyName||e.ExtractedData?.ComplianceItemDescription||"No Name",Description:e.is_compliance?e.ExtractedData?.ComplianceItemDescription||"No Description":e.ExtractedData?.Scope||"No Scope",CreatedBy:e.ExtractedData?.CreatedByName||"System",CreatedDate:this.formatDate(e.ExtractedData?.CreatedByDate||e.created_at),RejectionReason:e.ExtractedData?.policy_approval?.remarks||e.ExtractedData?.compliance_approval?.remarks||e.rejection_reason||"No reason provided",Status:"Rejected",originalPolicy:e}))},rejectedPoliciesColumns(){return[{key:"PolicyId",label:"Item ID",sortable:!0,headerClass:"policy-id-header",cellClass:"policy-id-cell"},{key:"ItemType",label:"Type",sortable:!0,type:"status",headerClass:"item-type-header",cellClass:"item-type-cell"},{key:"ItemName",label:"Name",sortable:!0,headerClass:"item-name-header",cellClass:"item-name-cell"},{key:"Description",label:"Description",sortable:!1,headerClass:"description-header",cellClass:"description-cell"},{key:"CreatedBy",label:"Created By",sortable:!0,headerClass:"created-by-header",cellClass:"created-by-cell"},{key:"CreatedDate",label:"Created Date",sortable:!0,headerClass:"created-date-header",cellClass:"created-date-cell"},{key:"RejectionReason",label:"Rejection Reason",sortable:!1,headerClass:"rejection-reason-header",cellClass:"rejection-reason-cell"}]}}};const El=(0,se.A)(wl,[["render",$o],["__scopeId","data-v-63f7c0e0"]]);var Rl=El;const Dl=()=>{const e=(0,ee.KR)(!0),a=(0,ee.KR)(null),t=(0,ee.KR)(null),i=(0,s.EW)(()=>t.value?.canViewAllPolicies||!1),o=(0,s.EW)(()=>t.value?.canCreatePolicy||!1),l=(0,s.EW)(()=>t.value?.canEditPolicy||!1),n=(0,s.EW)(()=>t.value?.canDeletePolicy||!1),r=(0,s.EW)(()=>t.value?.canApprovePolicy||!1),c=(0,s.EW)(()=>t.value?.canViewFrameworks||!1),d=(0,s.EW)(()=>t.value?.canCreateFramework||!1),u=(0,s.EW)(()=>t.value?.canUploadFramework||!1),p=(0,s.EW)(()=>t.value?.canViewAnalytics||!1),v=(0,s.EW)(()=>t.value?.canViewKPIs||!1),m=(0,s.EW)(()=>t.value?.canViewDashboard||!1),k=(0,s.EW)(()=>t.value?.canExportData||!1),h=(0,s.EW)(()=>t.value?.canManageVersions||!1),g=(0,s.EW)(()=>t.value?.canTailorPolicies||!1),y=(0,s.EW)(()=>t.value?.canManageApprovalWorkflow||!1),f=(0,s.EW)(()=>t.value?.isAdmin||!1),b=(0,s.EW)(()=>ft.getUserRole()?.role||"Not assigned"),C=async()=>{try{e.value=!0,a.value=null,await ft.init(),t.value=ft.getPolicyComponentAccess(),console.log("[POLICY_RBAC_COMPOSABLE] RBAC initialized:",t.value)}catch(i){console.error("[POLICY_RBAC_COMPOSABLE] Failed to initialize RBAC:",i),a.value=i.message,t.value={canViewAllPolicies:!1,canCreatePolicy:!1,canEditPolicy:!1,canDeletePolicy:!1,canApprovePolicy:!1,canViewFrameworks:!1,canCreateFramework:!1,canUploadFramework:!1,canViewAnalytics:!1,canViewKPIs:!1,canViewDashboard:!1,canExportData:!1,canManageVersions:!1,canTailorPolicies:!1,canManageApprovalWorkflow:!1,isAdmin:!1}}finally{e.value=!1}},L=(e,a,t="access")=>ft.checkAccessAndExecute(e,a,t),w=(e,a,t=null)=>{ft.canAccessRoute(e)?t?t():a&&a.push({name:e}):ft.showPolicyAccessDenied("access")},E=(e="access")=>{ft.showPolicyAccessDenied(e)},R=(e,a="access")=>{console.error("[POLICY_RBAC_COMPOSABLE] Unauthorized access:",e),403===e.response?.status&&ft.showPolicyAccessDenied(a)};return(0,s.sV)(()=>{C()}),{rbacLoading:e,rbacError:a,rbacState:t,canViewPolicies:i,canCreatePolicies:o,canEditPolicies:l,canDeletePolicies:n,canApprovePolicies:r,canViewFrameworks:c,canCreateFrameworks:d,canUploadFrameworks:u,canViewAnalytics:p,canViewKPIs:v,canViewDashboard:m,canExportData:k,canManageVersions:h,canTailorPolicies:g,canManageApprovalWorkflow:y,isAdmin:f,userRole:b,initializeRBAC:C,checkAndExecute:L,navigateWithPermissionCheck:w,showAccessDenied:E,handleUnauthorizedAccess:R}};const Il={class:"policy-tabs-container single-container"},Pl={key:0,class:"loading-overlay"},_l={key:1,class:"access-denied-container"},Sl={class:"access-denied-content"},Al={class:"access-info"},Tl={class:"access-actions"},xl={key:0,class:"loading-overlay"},Fl={key:1,class:"error-message"},Vl={key:2,class:"pill-tabs-bar"},Ml={key:0,class:"pill-dot"},Xl={key:0,class:"pill-dot"},Ul={key:0,class:"pill-dot"},Nl={key:3,class:"breadcrumbs"},$l=["onClick"],Ol={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center","max-width":"260px",margin:"0 auto 8px auto"}},jl={class:"card-grid",style:{"margin-top":"8px"}},Bl=["onClick"],Wl={class:"card-header"},Ql={class:"card-icon"},ql={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Kl=["onClick"],Jl={class:"card-content"},zl={class:"card-title"},Hl={class:"card-category"},Yl={class:"card-desc"},Gl={class:"framework-select-container"},Zl={class:"framework-select-wrapper"},en={class:"view-toggle"},an={key:0,class:"loading-message"},tn={key:1,class:"card-grid"},sn={class:"card-header"},on={class:"card-icon"},ln={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},nn=["onClick"],rn={class:"card-content"},cn={class:"card-title"},dn={class:"card-category"},un={class:"card-count"},pn={key:0},vn={key:1},mn={key:2,class:"loading-versions"},kn={key:3},hn={class:"card-desc"},gn={key:2,class:"table-view"},yn={class:"table-version-tags"},fn={class:"framework-select-container"},bn={class:"framework-select-wrapper"},Cn={class:"view-toggle"},Ln={key:0,class:"loading-message"},wn={key:1,class:"card-grid"},En={class:"card-header"},Rn={class:"card-icon"},Dn={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},In=["onClick"],Pn={class:"card-content"},_n={class:"card-title"},Sn={class:"card-category"},An={class:"card-desc"},Tn={key:2,class:"table-view"},xn={class:"card-grid"},Fn=["onClick"],Vn={class:"card-header"},Mn={class:"card-icon"},Xn={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Un=["onClick"],Nn={class:"card-content"},$n={class:"card-title"},On={class:"card-category"},jn={class:"card-count"},Bn={class:"policies-count"},Wn={key:0,class:"card-version-info"},Qn={class:"card-desc"},qn={class:"card-grid"},Kn=["onClick"],Jn={class:"card-header"},zn={class:"card-icon"},Hn={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Yn=["onClick"],Gn={class:"card-content"},Zn={class:"card-title"},er={class:"card-category"},ar={class:"card-count"},tr={class:"card-desc"},ir={class:"card-grid"},sr=["onClick"],or={class:"card-header"},lr={class:"card-icon"},nr={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},rr=["onClick"],cr={class:"card-content"},dr={class:"card-title"},ur={class:"card-category"},pr={class:"card-count"},vr={class:"policies-count"},mr={key:0,class:"card-version-info"},kr={class:"card-desc"},hr={class:"card-grid"},gr={class:"card-header"},yr={class:"card-icon"},fr={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},br=["onClick"],Cr={class:"card-content"},Lr={class:"card-title"},wr={class:"card-category"},Er={class:"card-desc"},Rr={class:"modal-headerr"},Dr={class:"modal-contentt"},Ir={class:"modal-section"},Pr={key:0,class:"modal-section"},_r={class:"version-info-container"},Sr={class:"version-info-item"},Ar={class:"version-info-value"},Tr={class:"version-info-item"},xr={class:"version-info-value"},Fr={class:"version-info-item"},Vr={class:"version-info-value"},Mr={class:"version-info-item"},Xr={class:"version-info-value"},Ur={key:1,class:"modal-section"},Nr={class:"version-list"},$r={class:"version-name"},Or={key:2,class:"modal-section"},jr={class:"subpolicy-list"},Br="http://localhost:8000/api";var Wr={__name:"AllPolicies",setup(e){const{canViewPolicies:a,userRole:t,initializeRBAC:o}=Dl(),l=(0,ee.KR)("framework"),n=(0,ee.KR)(null),r=(0,ee.KR)(null),c=(0,ee.KR)(null),u=(0,ee.KR)(null),p=(0,ee.KR)(""),v=(0,ee.KR)("card"),m=(0,ee.KR)("card"),k=(0,ee.KR)(""),h=(0,ee.KR)(""),g=(0,ee.KR)(!1),y=(0,ee.KR)(null),f=(0,ee.KR)(!1),b=(0,ee.KR)(!1),C=(0,ee.KR)(null),L=(0,ee.KR)({lastFetched:null,data:null,frameworkFilter:null}),w=(0,ee.KR)(!1),E=(0,ee.KR)([]),R=(0,ee.KR)([]),D=(0,ee.KR)([]),I=(0,ee.KR)({lastFetched:null,data:null,frameworkFilter:null}),P=async()=>{f.value=!0,C.value=null;try{const e=await qe.A.get(`${Br}/all-policies/frameworks/`);E.value=e.data,f.value=!1}catch(e){console.error("Error fetching frameworks:",e),C.value="Failed to fetch frameworks",f.value=!1}},_=async e=>{f.value=!0,C.value=null;try{console.log(`Fetching framework versions for framework ID: ${e}`);const a=await qe.A.get(`${Br}/all-policies/frameworks/${e}/versions/`);console.log("Framework versions response:",a.data),n.value.versions||(n.value.versions=[]),n.value.versions=a.data,f.value=!1}catch(a){console.error("Error fetching framework versions:",a),a.response?(console.error("Response status:",a.response.status),console.error("Response data:",a.response.data),C.value=`Failed to fetch framework versions: ${a.response.data.error||"Server error"}`):a.request?(console.error("No response received:",a.request),C.value="Failed to fetch framework versions: No response from server"):(console.error("Error details:",a.message),C.value=`Failed to fetch framework versions: ${a.message}`),n.value&&(n.value.versions=[]),f.value=!1}},S=async e=>{f.value=!0,C.value=null;try{const a=await qe.A.get(`${Br}/all-policies/framework-versions/${e}/policies/`);r.value&&(r.value.policies=a.data),f.value=!1}catch(a){console.error("Error fetching framework version policies:",a),C.value="Failed to fetch policies",f.value=!1}},A=async()=>{b.value=!0,C.value=null;const e=k.value,a=Date.now(),t=I.value.lastFetched?a-I.value.lastFetched:null,i=I.value.data&&t&&t<6e4&&I.value.frameworkFilter===e;if(i)return console.log("Using cached policies data"),R.value=I.value.data,void(b.value=!1);console.log("Cache invalid, fetching fresh policy data");let s=`${Br}/all-policies/policies/`;e&&(s+=`?framework_id=${e}`);try{console.log("Fetching all policies...");const t=await qe.A.get(s),i=t.data;R.value=i.map(e=>({...e,version_count:e.version_count}));const o=i.length>0&&(void 0!==i[0].version_count||i[0].versions&&Array.isArray(i[0].versions));if(o){console.log("Backend already provides version info, using it directly");const t=i.map(e=>({...e,version_count:e.version_count||(e.versions?e.versions.length:0)}));return R.value=t,I.value={lastFetched:a,data:t,frameworkFilter:e},void(b.value=!1)}console.log("Fetching version info for policies in parallel");const l=i.map(e=>qe.A.get(`${Br}/all-policies/policies/${e.id}/versions/`).then(a=>a.data&&Array.isArray(a.data)?{...e,versions:a.data,version_count:a.data.length}:e).catch(a=>(console.error(`Error fetching versions for policy ${e.id}:`,a),e))),n=await Promise.all(l);R.value=n,I.value={lastFetched:a,data:n,frameworkFilter:e},console.log(`Loaded ${n.length} policies with complete version data`)}catch(o){console.error("Error fetching policies:",o),C.value="Failed to fetch policies"}finally{b.value=!1}},T=async e=>{f.value=!0,C.value=null;try{console.log(`Fetching policy versions for policy ID: ${e}`);const a=await qe.A.get(`${Br}/all-policies/policies/${e}/versions/`);console.log("Policy versions response:",a.data),c.value.versions||(c.value.versions=[]),c.value.versions=a.data,c.value&&a.data.length>0&&(c.value.version_count=a.data.length),f.value=!1}catch(a){console.error("Error fetching policy versions:",a),a.response?(console.error("Response status:",a.response.status),console.error("Response data:",a.response.data),C.value=`Failed to fetch policy versions: ${a.response.data.error||"Server error"}`):a.request?(console.error("No response received:",a.request),C.value="Failed to fetch policy versions: No response from server"):(console.error("Error details:",a.message),C.value=`Failed to fetch policy versions: ${a.message}`),c.value&&(c.value.versions=[]),f.value=!1}},x=async()=>{w.value=!0,C.value=null;const e=h.value,a=Date.now(),t=L.value.lastFetched?a-L.value.lastFetched:null,i=L.value.data&&t&&t<6e4&&L.value.frameworkFilter===e;if(i)return console.log("Using cached subpolicies data"),D.value=L.value.data,void(w.value=!1);console.log("Cache invalid, fetching fresh subpolicies data");let s=`${Br}/all-policies/subpolicies/`;e&&(s+=`?framework_id=${e}`);try{console.log(`Fetching subpolicies from: ${s}`);const t=await qe.A.get(s);console.log(`Received ${t.data.length} subpolicies`),t.data.length>0&&console.log("Sample subpolicy:",t.data[0]);const i=t.data;D.value=i,L.value={lastFetched:a,data:i,frameworkFilter:e},console.log(`Successfully loaded ${i.length} subpolicies`)}catch(o){console.error("Error fetching subpolicies:",o),o.response?(console.error("Response status:",o.response.status),console.error("Response data:",o.response.data),C.value=`Failed to fetch subpolicies: ${o.response.data.error||"Server error"}`):o.request?(console.error("No response received:",o.request),C.value="Failed to fetch subpolicies: No response from server"):(console.error("Error details:",o.message),C.value=`Failed to fetch subpolicies: ${o.message}`),D.value=[]}finally{w.value=!1}},F=async e=>{f.value=!0,C.value=null;try{console.log(`Fetching subpolicies for policy version ID: ${e}`);const a=await qe.A.get(`${Br}/all-policies/policy-versions/${e}/subpolicies/`);console.log("Subpolicies response:",a.data),u.value.subpolicies||(u.value.subpolicies=[]),u.value.subpolicies=a.data,f.value=!1}catch(a){console.error("Error fetching policy version subpolicies:",a),a.response?(console.error("Response status:",a.response.status),console.error("Response data:",a.response.data),C.value=`Failed to fetch subpolicies: ${a.response.data.error||"Server error"}`):a.request?(console.error("No response received:",a.request),C.value="Failed to fetch subpolicies: No response from server"):(console.error("Error details:",a.message),C.value=`Failed to fetch subpolicies: ${a.message}`),u.value&&(u.value.subpolicies=[]),f.value=!1}},V=e=>{n.value=e,r.value=null,c.value=null,u.value=null,e&&e.id&&(p.value=e.id.toString()),_(e.id)},M=e=>{r.value=e,c.value=null,u.value=null,S(e.id)},X=e=>{c.value=e,u.value=null,T(e.id)},U=e=>{u.value=e,F(e.id)},N=()=>{C.value=null,"policies"===l.value?(console.log("Switching to Policies tab, fetching all policies..."),A()):"subpolicies"===l.value?(console.log("Switching to Subpolicies tab, fetching all subpolicies..."),x()):"framework"===l.value&&console.log("Switching to Frameworks tab")},$=()=>{A()},O=()=>{x()},j=async()=>{try{if(!p.value)return n.value=null,r.value=null,c.value=null,void(u.value=null);const e=String(p.value);console.log(`Selecting framework ID: ${e}`);const a=E.value.find(a=>String(a.id)===e);a?(console.log(`Found framework: ${a.name}`),await(0,s.dY)(),n.value={...a},r.value=null,c.value=null,u.value=null,_(a.id)):console.error(`No framework found with ID: ${e}`)}catch(e){console.error("Error in framework selection:",e),C.value="Error selecting framework"}},B=async e=>{f.value=!0,C.value=null;try{if(console.log("Showing details for item:",e),e&&e.id)if(e.category){console.log("Detected framework, fetching all versions for framework:",e.id);try{const a=await qe.A.get(`${Br}/all-policies/framework-versions/${e.id}/`);a.data&&Array.isArray(a.data)?(console.log("Fetched complete framework versions:",a.data.length),e.versions=a.data,W(e.id,{versions:a.data,version_count:a.data.length})):console.log("No framework versions returned")}catch(a){console.error("Error fetching framework versions:",a);try{console.log("Trying fallback endpoint for framework versions");const a=await qe.A.get(`${Br}/all-policies/frameworks/${e.id}/versions/`);e.versions=a.data,W(e.id,{versions:a.data,version_count:a.data.length})}catch(t){console.error("Error in fallback endpoint:",t),e.versions||(e.versions=[])}}}else if(e.previous_version_id||e.parent_policy_id){if(e.previous_version_id&&!e.subpolicies){console.log("Detected policy version, fetching subpolicies:",e.id);try{const a=await qe.A.get(`${Br}/all-policies/policy-versions/${e.id}/subpolicies/`);e.subpolicies=a.data}catch(a){console.error("Error fetching subpolicies:",a),e.subpolicies=[]}}else if(u.value){console.log("Detected subpolicy click, checking for complete details:",e.id);try{if(!e.full_details_loaded){console.log("Fetching complete subpolicy details");const a=await qe.A.get(`${Br}/all-policies/subpolicies/${e.id}/`);Object.assign(e,a.data),e.full_details_loaded=!0}}catch(a){console.error("Error fetching subpolicy details:",a)}}}else{console.log("Detected policy, fetching complete versions for policy:",e.id);try{const a=await qe.A.get(`${Br}/all-policies/policies/${e.id}/versions/`);if(a.data&&Array.isArray(a.data)){const t=a.data.length;console.log(`Fetched ${t} policy versions`),e.versions=a.data,e.version_count=t,W(e.id,{versions:a.data,version_count:t})}}catch(a){console.error("Error fetching policy versions:",a),e.versions||(e.versions=[])}}y.value=e,g.value=!0}catch(a){console.error("Error in showDetails:",a),C.value="Failed to load complete details"}finally{f.value=!1}},W=(e,a)=>{const t=R.value.findIndex(a=>a.id===e);-1!==t&&(R.value[t]={...R.value[t],...a}),c.value&&c.value.id===e&&(c.value={...c.value,...a})},Q=()=>{g.value=!1,y.value=null},q=e=>{switch(e){case 0:n.value=null,r.value=null,c.value=null,u.value=null,p.value="",l.value="framework";break;case 1:r.value=null,c.value=null,u.value=null;break;case 2:c.value=null,u.value=null;break;case 3:u.value=null;break;default:n.value=null,r.value=null,c.value=null,u.value=null,p.value="",l.value="framework";break}},K=e=>{if(!e)return"";const a=e.toLowerCase();return a.includes("inactive")?"inactive":a.includes("active")?"active":a.includes("pending")?"pending":""},J=e=>{if(!e)return"N/A";try{const a=new Date(e);return a.toLocaleDateString()}catch(a){return e}},z=e=>{switch((e||"").toLowerCase()){case"governance":return"fas fa-shield-alt";case"access control":return"fas fa-user-shield";case"asset management":return"fas fa-boxes";case"cryptography":return"fas fa-key";case"data management":return"fas fa-database";case"device management":return"fas fa-mobile-alt";case"risk management":return"fas fa-exclamation-triangle";case"supplier management":return"fas fa-handshake";case"business continuity":return"fas fa-business-time";case"privacy":return"fas fa-user-secret";case"system protection":return"fas fa-shield-virus";case"incident response":return"fas fa-ambulance"}},H=(0,s.EW)(()=>{if(!E.value||0===E.value.length)return[];if(!p.value)return E.value;const e=String(p.value),a=E.value.filter(a=>String(a.id)===e);return console.log(`Framework filtering: looking for ID ${e}, found ${a.length} matches`),a.length>0?a:E.value}),Y=(0,s.EW)(()=>R.value),G=(0,s.EW)(()=>D.value),Z=(0,s.EW)(()=>{const e=[];return n.value&&e.push({id:"fw-"+n.value.id,name:n.value.name}),r.value&&e.push({id:"fwv-"+r.value.id,name:r.value.name}),c.value&&e.push({id:"policy-"+c.value.id,name:c.value.name}),u.value&&e.push({id:"policyv-"+u.value.id,name:u.value.name}),e}),ae=()=>{I.value.data||(console.log("Preloading policies data in the background..."),setTimeout(()=>{A()},1e3)),L.value.data||(console.log("Preloading subpolicies data in the background..."),setTimeout(()=>{x()},2e3))};return(0,s.sV)(async()=>{await o(),a.value?(P(),"policies"===l.value?A():"subpolicies"===l.value?x():ae()):console.log("[AllPolicies] User does not have permission to view policies")}),(0,s.wB)(l,N),(0,s.wB)(k,$),(0,s.wB)(h,O),(e,o)=>((0,s.uX)(),(0,s.CE)("div",Il,[e.rbacLoading?((0,s.uX)(),(0,s.CE)("div",Pl,o[11]||(o[11]=[(0,s.Lk)("div",{class:"loading-spinner"},[(0,s.Lk)("i",{class:"fas fa-shield-alt fa-spin"}),(0,s.Lk)("span",null,"Checking access permissions...")],-1)]))):(0,ee.R1)(a)||e.rbacLoading?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[f.value?((0,s.uX)(),(0,s.CE)("div",xl,o[18]||(o[18]=[(0,s.Lk)("div",{class:"loading-spinner"},[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"}),(0,s.Lk)("span",null,"Loading...")],-1)]))):(0,s.Q3)("",!0),C.value?((0,s.uX)(),(0,s.CE)("div",Fl,[o[19]||(o[19]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(C.value),1)])):(0,s.Q3)("",!0),n.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Vl,[(0,s.Lk)("button",{class:(0,d.C4)(["pill-tab",{active:"framework"===l.value}]),onClick:o[2]||(o[2]=e=>l.value="framework")},["framework"===l.value?((0,s.uX)(),(0,s.CE)("span",Ml)):(0,s.Q3)("",!0),o[20]||(o[20]=(0,s.eW)(" Compliance Frameworks "))],2),(0,s.Lk)("button",{class:(0,d.C4)(["pill-tab",{active:"policies"===l.value}]),onClick:o[3]||(o[3]=e=>l.value="policies")},["policies"===l.value?((0,s.uX)(),(0,s.CE)("span",Xl)):(0,s.Q3)("",!0),o[21]||(o[21]=(0,s.eW)(" Policies "))],2),(0,s.Lk)("button",{class:(0,d.C4)(["pill-tab",{active:"subpolicies"===l.value}]),onClick:o[4]||(o[4]=e=>l.value="subpolicies")},["subpolicies"===l.value?((0,s.uX)(),(0,s.CE)("span",Ul)):(0,s.Q3)("",!0),o[22]||(o[22]=(0,s.eW)(" Subpolicies "))],2)])),Z.value.length?((0,s.uX)(),(0,s.CE)("div",Nl,[(0,s.bF)(i.F,{name:"breadcrumb"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Z.value,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:e.id,class:"breadcrumb-chip"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",{class:"breadcrumb-close",onClick:(0,i.D$)(e=>q(a),["stop"])},"Ã—",8,$l)]))),128))]),_:1})])):(0,s.Q3)("",!0),n.value?n.value&&!r.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:5},[o[38]||(o[38]=(0,s.Lk)("div",{class:"section-header"},"Versions",-1)),(0,s.Lk)("div",xn,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.value.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:a=>M(e)},[(0,s.Lk)("div",Vn,[(0,s.Lk)("div",Mn,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",Xn,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[36]||(o[36]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,Un)])]),(0,s.Lk)("div",Nn,[(0,s.Lk)("div",$n,(0,d.v_)(e.name),1),(0,s.Lk)("div",On,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",jn,[(0,s.Lk)("span",Bn,[o[37]||(o[37]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.eW)(" Policies: "+(0,d.v_)(e.policy_count||0),1)])]),e.previous_version_id?((0,s.uX)(),(0,s.CE)("div",Wn,[(0,s.Lk)("span",null,"Previous version: "+(0,d.v_)(e.previous_version_name),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",Qn,(0,d.v_)(e.description),1)])],8,Fn))),128))])],64)):n.value&&r.value&&!c.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:6},[o[40]||(o[40]=(0,s.Lk)("div",{class:"section-header"},"Policies",-1)),(0,s.Lk)("div",qn,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.value.policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:a=>X(e)},[(0,s.Lk)("div",Jn,[(0,s.Lk)("div",zn,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",Hn,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[39]||(o[39]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,Yn)])]),(0,s.Lk)("div",Gn,[(0,s.Lk)("div",Zn,(0,d.v_)(e.name),1),(0,s.Lk)("div",er,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",ar,"Versions: "+(0,d.v_)(e.version_count||(e.versions?e.versions.length:0)),1),(0,s.Lk)("div",tr,(0,d.v_)(e.description),1)])],8,Kn))),128))])],64)):n.value&&r.value&&c.value&&!u.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:7},[o[43]||(o[43]=(0,s.Lk)("div",{class:"section-header"},"Policy Versions",-1)),(0,s.Lk)("div",ir,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:a=>U(e)},[(0,s.Lk)("div",or,[(0,s.Lk)("div",lr,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",nr,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[41]||(o[41]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,rr)])]),(0,s.Lk)("div",cr,[(0,s.Lk)("div",dr,(0,d.v_)(e.name),1),(0,s.Lk)("div",ur,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",pr,[(0,s.Lk)("span",vr,[o[42]||(o[42]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.eW)(" Subpolicies: "+(0,d.v_)(e.subpolicy_count||0),1)])]),e.previous_version_id?((0,s.uX)(),(0,s.CE)("div",mr,[(0,s.Lk)("span",null,"Previous version: "+(0,d.v_)(e.previous_version_name),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",kr,(0,d.v_)(e.description),1)])],8,sr))),128))])],64)):n.value&&r.value&&c.value&&u.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:8},[o[45]||(o[45]=(0,s.Lk)("div",{class:"section-header"},"Subpolicies",-1)),(0,s.Lk)("div",hr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(u.value.subpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card"},[(0,s.Lk)("div",gr,[(0,s.Lk)("div",yr,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",fr,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[44]||(o[44]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,br)])]),(0,s.Lk)("div",Cr,[(0,s.Lk)("div",Lr,(0,d.v_)(e.name),1),(0,s.Lk)("div",wr,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",Er,(0,d.v_)(e.description),1)])]))),128))])],64)):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)(s.FK,{key:4},["framework"===l.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[o[25]||(o[25]=(0,s.Lk)("div",{class:"framework-page-desc"},null,-1)),(0,s.Lk)("div",Ol,[(0,s.bF)(mt.A,{modelValue:p.value,"onUpdate:modelValue":o[5]||(o[5]=e=>p.value=e),config:{label:"Framework",options:E.value.map(e=>({label:e.name,value:e.id}))},showSearchBar:!0,onChange:j},null,8,["modelValue","config"]),o[23]||(o[23]=(0,s.Lk)("div",{class:"dropdown-helper-text"},"Select a framework to view its policies and subpolicies.",-1))]),o[26]||(o[26]=(0,s.Lk)("div",{class:"section-header",style:{"margin-bottom":"8px"}},"Frameworks",-1)),(0,s.Lk)("div",jl,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(H.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:a=>V(e)},[(0,s.Lk)("div",Wl,[(0,s.Lk)("div",Ql,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",ql,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[24]||(o[24]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,Kl)])]),(0,s.Lk)("div",Jl,[(0,s.Lk)("div",zl,(0,d.v_)(e.name),1),(0,s.Lk)("div",Hl,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",Yl,(0,d.v_)(e.description),1)])],8,Bl))),128))])],64)):"policies"===l.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",Gl,[(0,s.Lk)("div",Zl,[(0,s.bF)(mt.A,{modelValue:k.value,"onUpdate:modelValue":o[6]||(o[6]=e=>k.value=e),config:{label:"Framework",options:E.value.map(e=>({label:e.name,value:e.id}))},showSearchBar:!0},null,8,["modelValue","config"])]),(0,s.Lk)("div",en,[(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-btn",{active:"table"===v.value}]),onClick:o[7]||(o[7]=e=>v.value="card"===v.value?"table":"card")},o[27]||(o[27]=[(0,s.Lk)("i",{class:"fas fa-table"},null,-1)]),2)])]),b.value&&!R.value.length?((0,s.uX)(),(0,s.CE)("div",an,o[28]||(o[28]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.eW)(" Loading policies... ")]))):(0,s.Q3)("",!0),"card"===v.value?((0,s.uX)(),(0,s.CE)("div",tn,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Y.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card"},[(0,s.Lk)("div",sn,[(0,s.Lk)("div",on,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",ln,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[29]||(o[29]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,nn)])]),(0,s.Lk)("div",rn,[(0,s.Lk)("div",cn,(0,d.v_)(e.name),1),(0,s.Lk)("div",dn,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",un,[void 0!==e.version_count?((0,s.uX)(),(0,s.CE)("span",pn," Versions: "+(0,d.v_)(e.version_count),1)):e.versions?((0,s.uX)(),(0,s.CE)("span",vn," Versions: "+(0,d.v_)(e.versions.length),1)):b.value?((0,s.uX)(),(0,s.CE)("span",mn,o[30]||(o[30]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin fa-sm"},null,-1)]))):((0,s.uX)(),(0,s.CE)("span",kn," Versions: 0 "))]),(0,s.Lk)("div",hn,(0,d.v_)(e.description),1)])]))),128))])):((0,s.uX)(),(0,s.CE)("table",gn,[o[31]||(o[31]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Name"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Versions"),(0,s.Lk)("th",null,"Description")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Y.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,d.v_)(e.name),1),(0,s.Lk)("td",null,(0,d.v_)(e.category),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["table-status-badge",K(e.status)])},(0,d.v_)(e.status),3)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",yn,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.versions,e=>((0,s.uX)(),(0,s.CE)("span",{key:e.id,class:"table-version-tag"},(0,d.v_)(e.name),1))),128))])]),(0,s.Lk)("td",null,(0,d.v_)(e.description),1)]))),128))])]))],64)):"subpolicies"===l.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",fn,[(0,s.Lk)("div",bn,[(0,s.bF)(mt.A,{modelValue:h.value,"onUpdate:modelValue":o[8]||(o[8]=e=>h.value=e),config:{label:"Framework",options:E.value.map(e=>({label:e.name,value:e.id}))},showSearchBar:!0},null,8,["modelValue","config"])]),(0,s.Lk)("div",Cn,[(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-btn",{active:"table"===m.value}]),onClick:o[9]||(o[9]=e=>m.value="card"===m.value?"table":"card")},o[32]||(o[32]=[(0,s.Lk)("i",{class:"fas fa-table"},null,-1)]),2)])]),w.value&&!D.value.length?((0,s.uX)(),(0,s.CE)("div",Ln,o[33]||(o[33]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.eW)(" Loading subpolicies... ")]))):(0,s.Q3)("",!0),"card"===m.value?((0,s.uX)(),(0,s.CE)("div",wn,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(G.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card"},[(0,s.Lk)("div",En,[(0,s.Lk)("div",Rn,[(0,s.Lk)("i",{class:(0,d.C4)(z(e.category))},null,2)]),(0,s.Lk)("div",Dn,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",K(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,i.D$)(a=>B(e),["stop"])},o[34]||(o[34]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,In)])]),(0,s.Lk)("div",Pn,[(0,s.Lk)("div",_n,(0,d.v_)(e.name),1),(0,s.Lk)("div",Sn,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",An,(0,d.v_)(e.description),1)])]))),128))])):((0,s.uX)(),(0,s.CE)("table",Tn,[o[35]||(o[35]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Name"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Description")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(G.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,d.v_)(e.name),1),(0,s.Lk)("td",null,(0,d.v_)(e.category),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["table-status-badge",K(e.status)])},(0,d.v_)(e.status),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.description),1)]))),128))])]))],64)):(0,s.Q3)("",!0)],64)),g.value?((0,s.uX)(),(0,s.CE)("div",{key:9,class:"details-modal-overlay",onClick:Q},[(0,s.Lk)("div",{class:"details-modal",onClick:o[10]||(o[10]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Rr,[(0,s.Lk)("h2",null,(0,d.v_)(y.value.name),1),(0,s.Lk)("button",{class:"modal-close",onClick:Q},"Ã—")]),(0,s.Lk)("div",Dr,[(0,s.Lk)("div",Ir,[o[46]||(o[46]=(0,s.Lk)("h3",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(y.value.description),1)]),y.value.previous_version_id?((0,s.uX)(),(0,s.CE)("div",Pr,[o[51]||(o[51]=(0,s.Lk)("h3",null,"Version Information",-1)),(0,s.Lk)("div",_r,[(0,s.Lk)("div",Sr,[o[47]||(o[47]=(0,s.Lk)("span",{class:"version-info-label"},"Version Number:",-1)),(0,s.Lk)("span",Ar,(0,d.v_)(y.value.version),1)]),(0,s.Lk)("div",Tr,[o[48]||(o[48]=(0,s.Lk)("span",{class:"version-info-label"},"Previous Version:",-1)),(0,s.Lk)("span",xr,(0,d.v_)(y.value.previous_version_name),1)]),(0,s.Lk)("div",Fr,[o[49]||(o[49]=(0,s.Lk)("span",{class:"version-info-label"},"Created By:",-1)),(0,s.Lk)("span",Vr,(0,d.v_)(y.value.created_by),1)]),(0,s.Lk)("div",Mr,[o[50]||(o[50]=(0,s.Lk)("span",{class:"version-info-label"},"Created Date:",-1)),(0,s.Lk)("span",Xr,(0,d.v_)(J(y.value.created_date)),1)])])])):(0,s.Q3)("",!0),y.value.versions?((0,s.uX)(),(0,s.CE)("div",Ur,[(0,s.Lk)("div",Nr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.value.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"version-item"},[(0,s.Lk)("span",$r,(0,d.v_)(e.name),1),(0,s.Lk)("span",{class:(0,d.C4)(["version-status",K(e.status)])},(0,d.v_)(e.status),3)]))),128))])])):(0,s.Q3)("",!0),y.value.subpolicies?((0,s.uX)(),(0,s.CE)("div",Or,[(0,s.Lk)("div",jr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.value.subpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"subpolicy-item"},[(0,s.Lk)("h4",null,(0,d.v_)(e.name),1),(0,s.Lk)("p",null,(0,d.v_)(e.description),1),(0,s.Lk)("span",{class:(0,d.C4)(["subpolicy-status",K(e.status)])},(0,d.v_)(e.status),3)]))),128))])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0)],64)):((0,s.uX)(),(0,s.CE)("div",_l,[(0,s.Lk)("div",Sl,[o[15]||(o[15]=(0,s.Lk)("i",{class:"fas fa-shield-alt access-denied-icon"},null,-1)),o[16]||(o[16]=(0,s.Lk)("h2",null,"Access Denied",-1)),o[17]||(o[17]=(0,s.Lk)("p",null,"You don't have permission to view policies. Please contact your administrator.",-1)),(0,s.Lk)("div",Al,[o[12]||(o[12]=(0,s.Lk)("strong",null,"Your Role:",-1)),(0,s.eW)(" "+(0,d.v_)((0,ee.R1)(t)),1)]),(0,s.Lk)("div",Tl,[(0,s.Lk)("button",{onClick:o[0]||(o[0]=a=>e.showAccessDenied("view")),class:"btn btn-warning"},o[13]||(o[13]=[(0,s.Lk)("i",{class:"fas fa-envelope"},null,-1),(0,s.eW)(" Contact Admin ")])),(0,s.Lk)("button",{onClick:o[1]||(o[1]=a=>e.$router.push("/")),class:"btn btn-secondary"},o[14]||(o[14]=[(0,s.Lk)("i",{class:"fas fa-home"},null,-1),(0,s.eW)(" Go to Dashboard ")]))])])]))]))}};const Qr=(0,se.A)(Wr,[["__scopeId","data-v-3114966c"]]);var qr=Qr;const Kr={class:"active-policies-container"},Jr={class:"header-container"},zr={class:"framework-dropdown"},Hr={class:"policies-table-container"},Yr={class:"policies-table"},Gr=["onClick"],Zr=["onClick"],ec={key:0},ac={colspan:"7"},tc={class:"policy-document expanded"},ic={class:"policy-document-section"},sc={class:"policy-document-section"},oc={class:"policy-document-section"},lc=["onClick"],nc={key:0},rc={colspan:"7"},cc={class:"policy-document expanded"},dc={class:"policy-document-section"},uc={class:"policy-document-section"},pc={class:"policy-document-section"},vc={key:0,class:"empty-state"};function mc(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Kr,[(0,s.Lk)("div",Jr,[a[2]||(a[2]=(0,s.Lk)("h2",null,"Active Policies",-1)),(0,s.Lk)("div",zr,[(0,s.bo)((0,s.Lk)("select",{id:"framework","onUpdate:modelValue":a[0]||(a[0]=e=>o.selectedFramework=e)},a[1]||(a[1]=[(0,s.Fv)('<option value="" disabled selected hidden>Select Framework</option><option value="ISO 27001">ISO 27001</option><option value="NIST">NIST</option><option value="SOC 2">SOC 2</option><option value="GDPR">GDPR</option>',5)]),512),[[i.u1,o.selectedFramework]])])]),(0,s.Lk)("div",Hr,[(0,s.Lk)("table",Yr,[a[11]||(a[11]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Policy Name"),(0,s.Lk)("th",null,"Version"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Framework"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Created By"),(0,s.Lk)("th",null,"Created On")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredPolicies,e=>((0,s.uX)(),(0,s.CE)(s.FK,{key:e.id},[(0,s.Lk)("tr",null,[(0,s.Lk)("td",{onClick:a=>o.togglePolicyDocument(e.id),class:"policy-name"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),e.subpolicies&&e.subpolicies.length?((0,s.uX)(),(0,s.CE)("i",{key:0,class:(0,d.C4)(["fas fa-chevron-right expand-icon",{rotated:o.expandedPolicies.includes(e.id)}]),onClick:(0,i.D$)(a=>o.toggleSubpolicies(e.id),["stop"])},null,10,Zr)):(0,s.Q3)("",!0)],8,Gr),(0,s.Lk)("td",null,(0,d.v_)(e.version),1),(0,s.Lk)("td",null,(0,d.v_)(e.category),1),(0,s.Lk)("td",null,(0,d.v_)(e.framework),1),a[3]||(a[3]=(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:"status-badge active"}," Active ")],-1)),(0,s.Lk)("td",null,(0,d.v_)(e.createdBy),1),(0,s.Lk)("td",null,(0,d.v_)(e.createdOn),1)]),o.expandedDocuments.includes(e.id)?((0,s.uX)(),(0,s.CE)("tr",ec,[(0,s.Lk)("td",ac,[(0,s.Lk)("div",tc,[(0,s.Lk)("div",ic,[a[4]||(a[4]=(0,s.Lk)("h4",null,"Project Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.description||"This policy establishes guidelines and requirements for "+e.name.toLowerCase()+" within the organization to ensure compliance with relevant regulations and standards."),1)]),(0,s.Lk)("div",sc,[a[5]||(a[5]=(0,s.Lk)("h4",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.scope||"This policy applies to all employees, contractors, and third-party entities that interact with organizational assets and systems."),1)]),(0,s.Lk)("div",oc,[a[6]||(a[6]=(0,s.Lk)("h4",null,"Objectives",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.objectives||"To define roles and responsibilities, establish controls, and provide guidance for maintaining compliance with "+e.framework+" standards."),1)])])])])):(0,s.Q3)("",!0),e.subpolicies&&e.subpolicies.length?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(o.getActiveSubpolicies(e),(t,i)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:`${e.id}-sub-${i}`},[(0,s.Lk)("tr",{class:(0,d.C4)(["subpolicy-row",{expanded:o.expandedPolicies.includes(e.id)}])},[(0,s.Lk)("td",{onClick:a=>o.toggleSubpolicyDocument(`${e.id}-sub-${i}`)},(0,d.v_)(t.name),9,lc),(0,s.Lk)("td",null,(0,d.v_)(t.version||e.version),1),(0,s.Lk)("td",null,(0,d.v_)(t.category||e.category),1),(0,s.Lk)("td",null,(0,d.v_)(t.framework||e.framework),1),a[7]||(a[7]=(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:"status-badge active"}," Active ")],-1)),(0,s.Lk)("td",null,(0,d.v_)(t.createdBy||e.createdBy),1),(0,s.Lk)("td",null,(0,d.v_)(t.createdOn||e.createdOn),1)],2),o.expandedDocuments.includes(`${e.id}-sub-${i}`)?((0,s.uX)(),(0,s.CE)("tr",nc,[(0,s.Lk)("td",rc,[(0,s.Lk)("div",cc,[(0,s.Lk)("div",dc,[a[8]||(a[8]=(0,s.Lk)("h4",null,"Project Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(t.description||"This is a sub-policy of "+e.name+" that focuses specifically on "+t.name.toLowerCase()+"."),1)]),(0,s.Lk)("div",uc,[a[9]||(a[9]=(0,s.Lk)("h4",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(t.scope||"This sub-policy applies to all aspects of "+t.name.toLowerCase()+" within the organization."),1)]),(0,s.Lk)("div",pc,[a[10]||(a[10]=(0,s.Lk)("h4",null,"Objectives",-1)),(0,s.Lk)("p",null,(0,d.v_)(t.objectives||"To ensure consistent implementation and management of "+t.name+" controls in alignment with "+e.framework+"."),1)])])])])):(0,s.Q3)("",!0)],64))),128)):(0,s.Q3)("",!0)],64))),128))])]),0===o.filteredPolicies.length?((0,s.uX)(),(0,s.CE)("div",vc,a[12]||(a[12]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1),(0,s.Lk)("p",null,"No active policies found for the selected framework",-1)]))):(0,s.Q3)("",!0)])])}var kc={name:"ActivePolicies",setup(){const e=(0,ee.KR)(""),a=(0,ee.KR)([]),t=(0,ee.KR)([]),i=[{id:"POL-001",name:"Information Security Policy",version:"1.2",category:"Security",framework:"ISO 27001",status:"Approved",createdBy:"John Smith",createdOn:"2023-10-15",description:"This policy outlines the organization's approach to information security management.",scope:"All information assets owned, controlled, or processed by the organization.",objectives:"To establish a framework for protecting the confidentiality, integrity, and availability of information.",subpolicies:[{name:"Data Classification Policy",version:"1.1",status:"Approved",description:"Guidelines for classifying organizational data based on sensitivity and criticality."},{name:"Access Control Policy",version:"1.0",status:"Approved",description:"Rules and guidelines for controlling access to information systems and data."}]},{id:"POL-002",name:"Data Protection Policy",version:"2.0",category:"Privacy",framework:"GDPR",status:"Under Review",createdBy:"Sarah Johnson",createdOn:"2023-11-03",subpolicies:[{name:"Data Subject Rights Procedure",version:"1.2",status:"Under Review",description:"Procedures for handling data subject access requests and other rights."}]},{id:"POL-005",name:"Risk Management Policy",version:"1.3",category:"Governance",framework:"SOC 2",status:"Under Review",createdBy:"David Wilson",createdOn:"2023-11-18"},{id:"POL-006",name:"Business Continuity Policy",version:"2.1",category:"Operations",framework:"ISO 27001",status:"Approved",createdBy:"Jennifer Lee",createdOn:"2023-10-30"}],o=e=>"Approved"===e||"Under Review"===e,l=(0,s.EW)(()=>i.filter(a=>{const t=""===e.value||a.framework===e.value;return o(a.status)&&t})),n=e=>e.subpolicies?e.subpolicies.filter(e=>o(e.status)):[],r=e=>{a.value.includes(e)?a.value=a.value.filter(a=>a!==e):a.value.push(e)},c=e=>{t.value.includes(e)?t.value=t.value.filter(a=>a!==e):t.value.push(e)},d=e=>{t.value.includes(e)?t.value=t.value.filter(a=>a!==e):t.value.push(e)};return{selectedFramework:e,policies:i,filteredPolicies:l,expandedPolicies:a,expandedDocuments:t,toggleSubpolicies:r,togglePolicyDocument:c,toggleSubpolicyDocument:d,getActiveSubpolicies:n}}};const hc=(0,se.A)(kc,[["render",mc]]);var gc=hc;function yc(e,a,t,i,o,l){const n=(0,s.g2)("CreateFramework");return(0,s.uX)(),(0,s.Wv)(n)}const fc={class:"create-framework-container"},bc={key:0,class:"framework-form-container"},Cc={class:"form-row"},Lc={class:"form-group"},wc={class:"input-wrapper"},Ec={class:"form-group"},Rc={class:"input-wrapper"},Dc={class:"form-row"},Ic={class:"form-group"},Pc={class:"input-wrapper"},_c={class:"form-group"},Sc={class:"upload-input-container"},Ac={class:"form-row"},Tc={class:"form-group"},xc={class:"input-wrapper"},Fc={class:"form-group"},Vc={class:"input-wrapper"},Mc={class:"form-group"},Xc={class:"input-wrapper"},Uc={key:1,class:"extraction-inline-container"},Nc={class:"extraction-content"},$c={class:"extraction-header"},Oc={class:"extraction-stepper"},jc=["onClick"],Bc={class:"extraction-body"},Wc={key:0},Qc=["value"],qc=["value"],Kc={key:1},Jc={class:"policy-main"},zc=["value"],Hc=["value"],Yc={key:0},Gc=["value"],Zc={key:2},ed=["value"],ad={key:0,class:"subpolicies-group"},td=["value"],id=["value"],sd={key:2},od=["value"],ld=["value"],nd=["value"],rd=["value"],cd=["value"],dd=["value"],ud={style:{"text-align":"right","margin-top":"24px"}};function pd(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",fc,[a[33]||(a[33]=(0,s.Lk)("h2",null,"Create Framework",-1)),o.showExtractionScreens?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",bc,[(0,s.Lk)("form",{class:"form-section",onSubmit:a[7]||(a[7]=(0,i.D$)((...e)=>o.handleFrameworkFormSubmit&&o.handleFrameworkFormSubmit(...e),["prevent"]))},[(0,s.Lk)("div",Cc,[(0,s.Lk)("div",Lc,[a[11]||(a[11]=(0,s.Lk)("label",null,"Framework ID",-1)),(0,s.Lk)("div",wc,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.frameworkId=e),placeholder:"Enter framework id"},null,512),[[i.Jo,o.formData.frameworkId]])])]),(0,s.Lk)("div",Ec,[a[12]||(a[12]=(0,s.Lk)("label",null,"Framework Name",-1)),(0,s.Lk)("div",Rc,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.frameworkName=e),placeholder:"Enter framework name"},null,512),[[i.Jo,o.formData.frameworkName]])])])]),(0,s.Lk)("div",Dc,[(0,s.Lk)("div",Ic,[a[13]||(a[13]=(0,s.Lk)("label",null,"Version",-1)),(0,s.Lk)("div",Pc,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.version=e),placeholder:"Enter version"},null,512),[[i.Jo,o.formData.version]])])]),(0,s.Lk)("div",_c,[a[15]||(a[15]=(0,s.Lk)("label",null,"Upload Document",-1)),(0,s.Lk)("div",Sc,[(0,s.Lk)("input",{type:"file",id:"framework-doc",class:"file-input",onChange:a[3]||(a[3]=(...e)=>o.handleFileUpload&&o.handleFileUpload(...e))},null,32),a[14]||(a[14]=(0,s.Lk)("label",{for:"framework-doc",class:"upload-label"},[(0,s.Lk)("span",{class:"upload-text"},"Choose File")],-1))])])]),(0,s.Lk)("div",Ac,[(0,s.Lk)("div",Tc,[a[16]||(a[16]=(0,s.Lk)("label",null,"Effective Start Date",-1)),(0,s.Lk)("div",xc,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.effectiveStartDate=e)},null,512),[[i.Jo,o.formData.effectiveStartDate]])])]),(0,s.Lk)("div",Fc,[a[17]||(a[17]=(0,s.Lk)("label",null,"Effective End Date",-1)),(0,s.Lk)("div",Vc,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[5]||(a[5]=e=>o.formData.effectiveEndDate=e)},null,512),[[i.Jo,o.formData.effectiveEndDate]])])])]),(0,s.Lk)("div",Mc,[a[18]||(a[18]=(0,s.Lk)("label",null,"Created By",-1)),(0,s.Lk)("div",Xc,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=e=>o.formData.createdBy=e),placeholder:"Enter creator name"},null,512),[[i.Jo,o.formData.createdBy]])])]),a[19]||(a[19]=(0,s.Lk)("button",{class:"create-btn",type:"submit"},"Submit",-1))],32)])),o.showExtractionScreens&&o.extractionSlides.length>0?((0,s.uX)(),(0,s.CE)("div",Uc,[(0,s.Lk)("div",Nc,[(0,s.Lk)("div",$c,[(0,s.Lk)("div",Oc,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.extractionSlides,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["extraction-step",{active:o.extractionStep===t}]),onClick:e=>o.extractionStep=t,style:(0,d.Tr)({cursor:o.extractionStep!==t?"pointer":"default"})},[(0,s.eW)((0,d.v_)("framework"===e.type?"Framework":"policy"===e.type?`Policy ${void 0!==e.index?e.index+1:""}`:"Authorizer")+" ",1),o.extractionStep===t?((0,s.uX)(),(0,s.CE)("span",{key:0,class:"tab-close",onClick:a[8]||(a[8]=(0,i.D$)(e=>o.showExtractionScreens=!1,["stop"]))}," X ")):(0,s.Q3)("",!0)],14,jc))),128))])]),(0,s.Lk)("div",Bc,["framework"===o.extractionSlides[o.extractionStep].type?((0,s.uX)(),(0,s.CE)("div",Wc,[a[20]||(a[20]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.title,readonly:""},null,8,Qc),a[21]||(a[21]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:o.extractionSlides[o.extractionStep].data.description,readonly:""},null,8,qc)])):"policy"===o.extractionSlides[o.extractionStep].type?((0,s.uX)(),(0,s.CE)("div",Kc,[(0,s.Lk)("div",Jc,[a[22]||(a[22]=(0,s.Lk)("b",null,"Policy",-1)),a[23]||(a[23]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.title,readonly:""},null,8,zc),a[24]||(a[24]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:o.extractionSlides[o.extractionStep].data.description,readonly:""},null,8,Hc),o.extractionSlides[o.extractionStep].data.objective?((0,s.uX)(),(0,s.CE)("label",Yc,"Objective:")):(0,s.Q3)("",!0),o.extractionSlides[o.extractionStep].data.objective?((0,s.uX)(),(0,s.CE)("textarea",{key:1,value:o.extractionSlides[o.extractionStep].data.objective,readonly:""},null,8,Gc)):(0,s.Q3)("",!0),o.extractionSlides[o.extractionStep].data.scope?((0,s.uX)(),(0,s.CE)("label",Zc,"Scope:")):(0,s.Q3)("",!0),o.extractionSlides[o.extractionStep].data.scope?((0,s.uX)(),(0,s.CE)("textarea",{key:3,value:o.extractionSlides[o.extractionStep].data.scope,readonly:""},null,8,ed)):(0,s.Q3)("",!0)]),o.extractionSlides[o.extractionStep].data.subPolicies&&o.extractionSlides[o.extractionStep].data.subPolicies.length?((0,s.uX)(),(0,s.CE)("div",ad,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.extractionSlides[o.extractionStep].data.subPolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"subpolicy-card extraction-subpolicy"},[(0,s.Lk)("b",null,"Sub Policy "+(0,d.v_)(t+1),1),a[25]||(a[25]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:e.title,readonly:""},null,8,td),a[26]||(a[26]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:e.description,readonly:""},null,8,id)]))),128))])):(0,s.Q3)("",!0)])):"authorizer"===o.extractionSlides[o.extractionStep].type?((0,s.uX)(),(0,s.CE)("div",sd,[a[27]||(a[27]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.title,readonly:""},null,8,od),a[28]||(a[28]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:o.extractionSlides[o.extractionStep].data.description,readonly:""},null,8,ld),a[29]||(a[29]=(0,s.Lk)("label",null,"Created By:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.createdBy,readonly:""},null,8,nd),a[30]||(a[30]=(0,s.Lk)("label",null,"Created date:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.createdDate,readonly:""},null,8,rd),a[31]||(a[31]=(0,s.Lk)("label",null,"Authorized By:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.authorizedBy,readonly:""},null,8,cd),a[32]||(a[32]=(0,s.Lk)("label",null,"Assign task for authorization:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.assignTask,readonly:""},null,8,dd)])):(0,s.Q3)("",!0),(0,s.Lk)("div",ud,[o.extractionStep<o.extractionSlides.length-1?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"create-btn",style:{"min-width":"100px"},onClick:a[9]||(a[9]=e=>o.extractionStep=o.extractionStep+1)}," Next > ")):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"create-btn",style:{"min-width":"100px"},onClick:a[10]||(a[10]=e=>o.showExtractionScreens=!1)}," Done "))])])])])):(0,s.Q3)("",!0)])}var vd=JSON.parse('{"d9":{"title":"Sample Framework","description":"This is a sample framework description."},"R3":[{"title":"Policy 1","description":"Description for Policy 1","objective":"Objective for Policy 1","scope":"Scope for Policy 1","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 2","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 3","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 4","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 5","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]}],"Kn":{"title":"Authorization Title","description":"Authorization Description","createdBy":"User Name","createdDate":"2024-06-01","authorizedBy":"Authorizer Name","assignTask":"Task Name"}}'),md={name:"CreateFramework",setup(){const e=(0,ee.KR)(!1),a=(0,ee.KR)(0),t=(0,ee.KR)([]),i=(0,ee.KR)({frameworkId:"",frameworkName:"",version:"",document:null,effectiveStartDate:"",effectiveEndDate:"",createdBy:""}),s=e=>{i.value.document=e.target.files[0]},o=()=>{const i=[];vd.d9&&i.push({type:"framework",data:vd.d9}),vd.R3&&Array.isArray(vd.R3)&&vd.R3.forEach((e,a)=>{i.push({type:"policy",data:e,index:a})}),vd.Kn&&i.push({type:"authorizer",data:vd.Kn}),t.value=i,e.value=!0,a.value=0};return{showExtractionScreens:e,extractionStep:a,extractionSlides:t,formData:i,handleFileUpload:s,handleFrameworkFormSubmit:o}}};const kd=(0,se.A)(md,[["render",pd]]);var hd=kd,gd={name:"FrameworkWrapper",components:{CreateFramework:hd}};const yd=(0,se.A)(gd,[["render",yc]]);var fd=yd;const bd={class:"VV-page-wrapper"},Cd={class:"VV-toggle-group"},Ld={key:0,class:"VV-top-dropdowns"},wd={key:1,class:"VV-top-dropdowns"},Ed={key:2},Rd={class:"VV-container"},Dd={class:"VV-form-group"},Id={class:"VV-form-group"},Pd={class:"VV-row"},_d={class:"VV-form-group VV-half"},Sd={class:"VV-form-group VV-half"},Ad={class:"VV-row"},Td={class:"VV-form-group VV-half"},xd={class:"VV-form-group VV-half"},Fd={class:"VV-row"},Vd={class:"VV-form-group VV-half"},Md={class:"VV-form-group VV-half"},Xd={class:"VV-row"},Ud={class:"VV-form-group VV-half"},Nd=["value"],$d={class:"VV-form-group VV-half"},Od=["value"],jd={class:"VV-policy-tabs-container"},Bd={class:"VV-policy-tabs-row"},Wd={class:"VV-policy-tabs"},Qd=["onClick"],qd={key:0,class:"VV-policy-form-container"},Kd={key:0,class:"TT-excluded-message"},Jd={class:"VV-row"},zd={class:"VV-form-group VV-half"},Hd={class:"VV-form-group VV-half"},Yd={class:"VV-form-group"},Gd={class:"VV-row"},Zd={class:"VV-form-group VV-half"},eu={class:"VV-form-group VV-half"},au={class:"VV-form-group"},tu={class:"VV-row"},iu={class:"VV-form-group VV-half"},su={class:"VV-form-group VV-half"},ou={class:"VV-row"},lu={class:"VV-form-group VV-half"},nu=["disabled"],ru=["value"],cu={class:"VV-form-group VV-half"},du=["disabled"],uu=["value"],pu={class:"VV-row"},vu={class:"VV-form-group VV-half"},mu=["disabled"],ku=["value"],hu={class:"VV-form-group VV-half"},gu={class:"form-row"},yu={class:"form-group entities-group"},fu={class:"entities-dropdown"},bu={class:"entity-content"},Cu={key:0,class:"loading-text"},Lu={key:1,class:"entity-tag all-tag"},wu={key:2,class:"placeholder"},Eu={key:3,class:"entity-count"},Ru={key:0,class:"entities-options"},Du={key:0,class:"entities-loading"},Iu={key:1,class:"entities-error"},Pu=["onClick"],_u=["checked","onChange"],Su={class:"entity-label"},Au={class:"VV-row"},Tu={class:"VV-form-group VV-half"},xu={class:"VV-form-group VV-half"},Fu={key:0,class:"VV-row"},Vu={class:"VV-form-group VV-half"},Mu=["value"],Xu={class:"VV-form-group VV-half"},Uu=["value"],Nu={class:"VV-form-group"},$u={key:0,class:"VV-subpolicy-tabs-container"},Ou={class:"VV-subpolicy-tabs-row"},ju={class:"VV-subpolicy-tabs"},Bu=["onClick"],Wu={key:0,class:"VV-subpolicy-form-container"},Qu={key:0,class:"TT-excluded-message"},qu={key:1},Ku={class:"VV-form-group"},Ju={class:"VV-form-group"},zu={class:"VV-form-group"},Hu={class:"VV-form-group"},Yu={key:3},Gu={key:4,class:"VV-universal-submit-wrapper"},Zu={class:"version-type-options"},ep={class:"version-type-option"},ap={class:"version-type-option"},tp={class:"version-modal-actions"},ip={key:6},sp={class:"VV-policy-tabs-container"},op={class:"VV-policy-tabs-row"},lp={class:"VV-policy-tabs"},np=["onClick"],rp={key:0,class:"VV-policy-form-container"},cp={class:"VV-row"},dp={class:"VV-form-group VV-half"},up={class:"VV-form-group VV-half"},pp={class:"VV-form-group"},vp={class:"VV-row"},mp={class:"VV-form-group VV-half"},kp={class:"VV-form-group VV-half"},hp={class:"VV-form-group"},gp={class:"VV-row"},yp={class:"VV-form-group VV-half"},fp={class:"VV-form-group VV-half"},bp={class:"VV-row"},Cp={class:"VV-form-group VV-half"},Lp=["value"],wp={class:"VV-form-group VV-half"},Ep=["disabled"],Rp=["value"],Dp={class:"VV-row"},Ip={class:"VV-form-group VV-half"},Pp=["disabled"],_p=["value"],Sp={class:"VV-form-group VV-half"},Ap={class:"form-row"},Tp={class:"form-group entities-group"},xp={class:"entities-dropdown"},Fp={class:"entity-content"},Vp={key:0,class:"loading-text"},Mp={key:1,class:"entity-tag all-tag"},Xp={key:2,class:"placeholder"},Up={key:3,class:"entity-count"},Np={key:0,class:"entities-options"},$p={key:0,class:"entities-loading"},Op={key:1,class:"entities-error"},jp=["onClick"],Bp=["checked","onChange"],Wp={class:"entity-label"},Qp={class:"VV-row"},qp={class:"VV-form-group VV-half"},Kp={class:"VV-form-group VV-half"},Jp={class:"VV-row"},zp={class:"VV-form-group VV-half"},Hp=["value"],Yp={class:"VV-form-group VV-half"},Gp=["value"],Zp={class:"VV-form-group"},ev={key:0,class:"VV-subpolicy-tabs-container"},av={class:"VV-subpolicy-tabs-row"},tv={class:"VV-subpolicy-tabs"},iv=["onClick"],sv={key:0,class:"VV-subpolicy-form-container"},ov={key:0,class:"TT-excluded-message"},lv={class:"VV-form-group"},nv={class:"VV-form-group"},rv={class:"VV-form-group"},cv={class:"VV-form-group"},dv={key:0,class:"VV-universal-submit-wrapper"};function uv(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",bd,[a[209]||(a[209]=(0,s.Lk)("div",{class:"VV-page-header"},[(0,s.Lk)("h2",null,"Policy Versioning")],-1)),(0,s.Lk)("div",Cd,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-toggle",{"VV-active":"framework"===l.selectedTab}]),onClick:a[0]||(a[0]=e=>n.selectTab("framework"))},"Framework",2),(0,s.Lk)("button",{class:(0,d.C4)(["VV-toggle",{"VV-active":"policy"===l.selectedTab}]),onClick:a[1]||(a[1]=e=>n.selectTab("policy"))},"Policy",2)]),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",Ld,[(0,s.bF)(r,{modelValue:l.selectedFramework,"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:e.name})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"340px"}},null,8,["modelValue","config"])])):((0,s.uX)(),(0,s.CE)("div",wd,[(0,s.bF)(r,{modelValue:l.selectedFramework,"onUpdate:modelValue":a[3]||(a[3]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:e.name})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"]),(0,s.bF)(r,{modelValue:l.selectedPolicy,"onUpdate:modelValue":a[4]||(a[4]=e=>l.selectedPolicy=e),config:{label:"Policy",values:l.policies.map(e=>({value:e.id,label:e.name})),defaultLabel:"Select Policy"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"])])),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",Ed,[(0,s.Lk)("div",Rd,[(0,s.Lk)("form",{onSubmit:a[15]||(a[15]=(0,i.D$)((...a)=>e.submitFramework&&e.submitFramework(...a),["prevent"]))},[(0,s.Lk)("div",Dd,[a[85]||(a[85]=(0,s.Lk)("label",{class:"VV-label"},"FRAMEWORK NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[5]||(a[5]=e=>l.frameworkForm.name=e),type:"text",required:"",placeholder:"Enter Framework name"},null,512),[[i.Jo,l.frameworkForm.name]]),a[86]||(a[86]=(0,s.Lk)("small",{class:"VV-desc"},"Enter a descriptive name for your framework",-1))]),(0,s.Lk)("div",Id,[a[87]||(a[87]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[6]||(a[6]=e=>l.frameworkForm.description=e),rows:"3",required:"",placeholder:"Enter framework description"},null,512),[[i.Jo,l.frameworkForm.description]]),a[88]||(a[88]=(0,s.Lk)("small",{class:"VV-desc"},"Describe the purpose, scope, and objectives of this framework",-1))]),(0,s.Lk)("div",Pd,[(0,s.Lk)("div",_d,[a[89]||(a[89]=(0,s.Lk)("label",{class:"VV-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[7]||(a[7]=e=>l.frameworkForm.identifier=e),type:"text",required:"",placeholder:"Enter Identifier"},null,512),[[i.Jo,l.frameworkForm.identifier]]),a[90]||(a[90]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'FW-001' or 'ISO-27001'",-1))]),(0,s.Lk)("div",Sd,[a[91]||(a[91]=(0,s.Lk)("label",{class:"VV-label"},"CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[8]||(a[8]=e=>l.frameworkForm.category=e),type:"text",required:"",placeholder:"Enter category"},null,512),[[i.Jo,l.frameworkForm.category]]),a[92]||(a[92]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., Security, Compliance, Risk Management, etc.",-1))])]),(0,s.Lk)("div",Ad,[(0,s.Lk)("div",Td,[a[94]||(a[94]=(0,s.Lk)("label",{class:"VV-label"},"INTERNAL/EXTERNAL *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[9]||(a[9]=e=>l.frameworkForm.internalExternal=e),required:""},a[93]||(a[93]=[(0,s.Lk)("option",{value:"",disabled:""},"Select Type",-1),(0,s.Lk)("option",{value:"Internal"},"Internal",-1),(0,s.Lk)("option",{value:"External"},"External",-1)]),512),[[i.u1,l.frameworkForm.internalExternal]]),a[95]||(a[95]=(0,s.Lk)("small",{class:"VV-desc"},"Select whether this framework is for internal or external use",-1))]),(0,s.Lk)("div",xd,[a[96]||(a[96]=(0,s.Lk)("label",{class:"VV-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"VV-input",type:"file",onChange:a[10]||(a[10]=(...e)=>n.handleFileUpload&&n.handleFileUpload(...e))},null,32),a[97]||(a[97]=(0,s.Lk)("small",{class:"VV-desc"},"Upload a supporting document for this framework (optional)",-1))])]),(0,s.Lk)("div",Fd,[(0,s.Lk)("div",Vd,[a[98]||(a[98]=(0,s.Lk)("label",{class:"VV-label"},"EFFECTIVE START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[11]||(a[11]=e=>l.frameworkForm.startDate=e),type:"date",required:""},null,512),[[i.Jo,l.frameworkForm.startDate]]),a[99]||(a[99]=(0,s.Lk)("small",{class:"VV-desc"},"Date when the framework implementation begins",-1))]),(0,s.Lk)("div",Md,[a[100]||(a[100]=(0,s.Lk)("label",{class:"VV-label"},"EFFECTIVE END DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[12]||(a[12]=e=>l.frameworkForm.endDate=e),type:"date",required:""},null,512),[[i.Jo,l.frameworkForm.endDate]]),a[101]||(a[101]=(0,s.Lk)("small",{class:"VV-desc"},"Date when the framework expires or requires review",-1))])]),(0,s.Lk)("div",Xd,[(0,s.Lk)("div",Ud,[a[103]||(a[103]=(0,s.Lk)("label",{class:"VV-label"},"CREATED BY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[13]||(a[13]=e=>l.frameworkForm.createdByName=e),required:""},[a[102]||(a[102]=(0,s.Lk)("option",{value:""},"Select Creator",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Nd))),128))],512),[[i.u1,l.frameworkForm.createdByName]]),a[104]||(a[104]=(0,s.Lk)("small",{class:"VV-desc"},"Select who created this framework",-1))]),(0,s.Lk)("div",$d,[a[106]||(a[106]=(0,s.Lk)("label",{class:"VV-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[14]||(a[14]=e=>l.frameworkForm.reviewer=e),required:""},[a[105]||(a[105]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Od))),128))],512),[[i.u1,l.frameworkForm.reviewer]]),a[107]||(a[107]=(0,s.Lk)("small",{class:"VV-desc"},"Select who will review this framework",-1))])])],32)]),(0,s.Lk)("div",jd,[(0,s.Lk)("div",Bd,[(0,s.Lk)("div",Wd,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-policy-tab",{"VV-policy-tab-active":a===l.activePolicyTab,excluded:e.exclude}]),onClick:e=>l.activePolicyTab=a}," Policy "+(0,d.v_)(a+1),11,Qd))),128)),(0,s.Lk)("button",{class:"VV-add-policy-tab",onClick:a[16]||(a[16]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",qd,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-exclude-policy-btn",{excluded:l.policyTabs[l.activePolicyTab].exclude}]),onClick:a[17]||(a[17]=e=>n.excludePolicyTab(l.activePolicyTab))},(0,d.v_)(l.policyTabs[l.activePolicyTab].exclude?"Include":"Exclude"),3),l.policyTabs[l.activePolicyTab].exclude?((0,s.uX)(),(0,s.CE)("div",Kd," This policy has been excluded and will not be included in the submission. ")):((0,s.uX)(),(0,s.CE)("form",{onSubmit:a[40]||(a[40]=(0,i.D$)(a=>e.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",Jd,[(0,s.Lk)("div",zd,[a[108]||(a[108]=(0,s.Lk)("label",{class:"VV-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[18]||(a[18]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].name]]),a[109]||(a[109]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",Hd,[a[110]||(a[110]=(0,s.Lk)("label",{class:"VV-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[19]||(a[19]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].identifier]]),a[111]||(a[111]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",Yd,[a[112]||(a[112]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[20]||(a[20]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].description]]),a[113]||(a[113]=(0,s.Lk)("small",{class:"VV-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",Gd,[(0,s.Lk)("div",Zd,[a[114]||(a[114]=(0,s.Lk)("label",{class:"VV-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[21]||(a[21]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].scope]]),a[115]||(a[115]=(0,s.Lk)("small",{class:"VV-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",eu,[a[116]||(a[116]=(0,s.Lk)("label",{class:"VV-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[22]||(a[22]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].department]]),a[117]||(a[117]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",au,[a[118]||(a[118]=(0,s.Lk)("label",{class:"VV-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[23]||(a[23]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].objective]]),a[119]||(a[119]=(0,s.Lk)("small",{class:"VV-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",tu,[(0,s.Lk)("div",iu,[a[120]||(a[120]=(0,s.Lk)("label",{class:"VV-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[24]||(a[24]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),a[121]||(a[121]=(0,s.Lk)("small",{class:"VV-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",su,[a[122]||(a[122]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[25]||(a[25]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].applicability]]),a[123]||(a[123]=(0,s.Lk)("small",{class:"VV-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",ou,[(0,s.Lk)("div",lu,[a[125]||(a[125]=(0,s.Lk)("label",{class:"VV-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[26]||(a[26]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:a[27]||(a[27]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),disabled:l.policyTabs[l.activePolicyTab].exclude,required:""},[a[124]||(a[124]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ru))),128))],40,nu),[[i.u1,l.policyTabs[l.activePolicyTab].type]]),a[126]||(a[126]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., Security Policy, HR Policy",-1))]),(0,s.Lk)("div",cu,[a[128]||(a[128]=(0,s.Lk)("label",{class:"VV-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[28]||(a[28]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:a[29]||(a[29]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type||l.policyTabs[l.activePolicyTab].exclude,required:""},[a[127]||(a[127]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,uu))),128))],40,du),[[i.u1,l.policyTabs[l.activePolicyTab].category]]),a[129]||(a[129]=(0,s.Lk)("small",{class:"VV-desc"},"Choose a category that best describes this policy's focus area",-1))])]),(0,s.Lk)("div",pu,[(0,s.Lk)("div",vu,[a[131]||(a[131]=(0,s.Lk)("label",{class:"VV-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[30]||(a[30]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),onChange:a[31]||(a[31]=e=>n.handlePolicySubCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].category||l.policyTabs[l.activePolicyTab].exclude,required:""},[a[130]||(a[130]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policySubCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ku))),128))],40,mu),[[i.u1,l.policyTabs[l.activePolicyTab].subCategory]]),a[132]||(a[132]=(0,s.Lk)("small",{class:"VV-desc"},"Provide more specific classification",-1))]),(0,s.Lk)("div",hu,[a[134]||(a[134]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",gu,[(0,s.Lk)("div",yu,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:a[34]||(a[34]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",fu,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:a[32]||(a[32]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",bu,[l.loading?((0,s.uX)(),(0,s.CE)("span",Cu," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",Lu," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",wu," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",Eu,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),a[133]||(a[133]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",Ru,[l.loading?((0,s.uX)(),(0,s.CE)("div",Du," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",Iu,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:a=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:a=>n.handleEntitySelection(l.activePolicyTab,e.id,a.target.checked),onClick:a[33]||(a[33]=(0,i.D$)(()=>{},["stop"]))},null,40,_u),(0,s.Lk)("span",Su,(0,d.v_)(e.label),1)],10,Pu))),128))])):(0,s.Q3)("",!0)])])])]),a[135]||(a[135]=(0,s.Lk)("small",{class:"VV-desc"},"Select the locations/entities this policy applies to",-1))])]),(0,s.Lk)("div",Au,[(0,s.Lk)("div",Tu,[a[136]||(a[136]=(0,s.Lk)("label",{class:"VV-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[35]||(a[35]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].startDate]]),a[137]||(a[137]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",xu,[a[138]||(a[138]=(0,s.Lk)("label",{class:"VV-label"},"END DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[36]||(a[36]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date",required:""},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].endDate]]),a[139]||(a[139]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy expires or requires review/renewal",-1))])]),"policy"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",Fu,[(0,s.Lk)("div",Vu,[a[141]||(a[141]=(0,s.Lk)("label",{class:"VV-label"},"CREATED BY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[37]||(a[37]=e=>l.policyTabs[l.activePolicyTab].createdByName=e),required:""},[a[140]||(a[140]=(0,s.Lk)("option",{value:""},"Select Creator",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Mu))),128))],512),[[i.u1,l.policyTabs[l.activePolicyTab].createdByName]]),a[142]||(a[142]=(0,s.Lk)("small",{class:"VV-desc"},"Select who created this policy",-1))]),(0,s.Lk)("div",Xu,[a[144]||(a[144]=(0,s.Lk)("label",{class:"VV-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[38]||(a[38]=e=>l.policyTabs[l.activePolicyTab].reviewer=e),required:""},[a[143]||(a[143]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Uu))),128))],512),[[i.u1,l.policyTabs[l.activePolicyTab].reviewer]]),a[145]||(a[145]=(0,s.Lk)("small",{class:"VV-desc"},"Select who will review this policy",-1))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Nu,[a[146]||(a[146]=(0,s.Lk)("label",{class:"VV-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"VV-input",type:"file",onChange:a[39]||(a[39]=e=>n.handlePolicyFileUpload(e,l.activePolicyTab))},null,32),a[147]||(a[147]=(0,s.Lk)("small",{class:"VV-desc"},"Upload supporting documentation (optional)",-1))])],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",$u,[(0,s.Lk)("div",Ou,[(0,s.Lk)("div",ju,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-subpolicy-tab",{"VV-subpolicy-tab-active":a===l.policyTabs[l.activePolicyTab].activeSubPolicyTab,excluded:e.exclude}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=a}," Subpolicy "+(0,d.v_)(a+1),11,Bu))),128)),(0,s.Lk)("button",{class:"VV-add-subpolicy-tab",onClick:a[41]||(a[41]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",Wu,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-exclude-subpolicy-btn",{excluded:l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude}]),onClick:a[42]||(a[42]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},(0,d.v_)(l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?"Include":"Exclude"),3),l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?((0,s.uX)(),(0,s.CE)("div",Qu," This subpolicy has been excluded and will not be included in the submission. ")):((0,s.uX)(),(0,s.CE)("form",qu,[(0,s.Lk)("div",Ku,[a[148]||(a[148]=(0,s.Lk)("label",{class:"VV-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[43]||(a[43]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),a[149]||(a[149]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",Ju,[a[150]||(a[150]=(0,s.Lk)("label",{class:"VV-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[44]||(a[44]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),a[151]||(a[151]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",zu,[a[152]||(a[152]=(0,s.Lk)("label",{class:"VV-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[45]||(a[45]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),a[153]||(a[153]=(0,s.Lk)("small",{class:"VV-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",Hu,[a[154]||(a[154]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[46]||(a[46]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),a[155]||(a[155]=(0,s.Lk)("small",{class:"VV-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):"framework"!==l.selectedTab||l.selectedFramework?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Yu)),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",Gu,[(0,s.Lk)("button",{class:"VV-universal-submit-btn",onClick:a[47]||(a[47]=(0,i.D$)(e=>l.showVersionModal=!0,["prevent"]))},"Submit")])):(0,s.Q3)("",!0),l.showVersionModal?((0,s.uX)(),(0,s.CE)("div",{key:5,class:"version-modal-overlay",onClick:a[53]||(a[53]=e=>l.showVersionModal=!1)},[(0,s.Lk)("div",{class:"version-modal",onClick:a[52]||(a[52]=(0,i.D$)(()=>{},["stop"]))},[a[160]||(a[160]=(0,s.Lk)("h2",null,"Version Type",-1)),(0,s.Lk)("div",Zu,[(0,s.Lk)("label",ep,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:"minor","onUpdate:modelValue":a[48]||(a[48]=e=>l.selectedVersionType=e)},null,512),[[i.XL,l.selectedVersionType]]),(0,s.Lk)("span",{class:(0,d.C4)(["radio-custom",{checked:"minor"===l.selectedVersionType}])},null,2),a[156]||(a[156]=(0,s.Lk)("span",{class:"version-type-title"},"Minor Version",-1)),a[157]||(a[157]=(0,s.Lk)("span",{class:"version-type-desc"},[(0,s.eW)("Incremental changes and improvements"),(0,s.Lk)("br"),(0,s.Lk)("span",{class:"version-type-example"},"Example: 1.0 â†’ 1.1")],-1))]),(0,s.Lk)("label",ap,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:"major","onUpdate:modelValue":a[49]||(a[49]=e=>l.selectedVersionType=e)},null,512),[[i.XL,l.selectedVersionType]]),(0,s.Lk)("span",{class:(0,d.C4)(["radio-custom",{checked:"major"===l.selectedVersionType}])},null,2),a[158]||(a[158]=(0,s.Lk)("span",{class:"version-type-title"},"Major Version",-1)),a[159]||(a[159]=(0,s.Lk)("span",{class:"version-type-desc"},[(0,s.eW)("Significant changes or overhauls"),(0,s.Lk)("br"),(0,s.Lk)("span",{class:"version-type-example"},"Example: 1.5 â†’ 2.0")],-1))])]),(0,s.Lk)("div",tp,[(0,s.Lk)("button",{class:"btn-primary",onClick:a[50]||(a[50]=(0,i.D$)((...e)=>n.confirmVersionType&&n.confirmVersionType(...e),["prevent"]))},"OK"),(0,s.Lk)("button",{class:"btn-secondary",onClick:a[51]||(a[51]=(0,i.D$)(e=>l.showVersionModal=!1,["prevent"]))},"Cancel")])])])):(0,s.Q3)("",!0),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",ip,[(0,s.Lk)("div",sp,[(0,s.Lk)("div",op,[(0,s.Lk)("div",lp,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-policy-tab",{"VV-policy-tab-active":a===l.activePolicyTab,excluded:e.exclude}]),onClick:e=>l.activePolicyTab=a}," Policy "+(0,d.v_)(a+1),11,np))),128)),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"VV-add-policy-tab",onClick:a[54]||(a[54]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")):(0,s.Q3)("",!0)])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",rp,["framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"VV-exclude-policy-btn",onClick:a[55]||(a[55]=e=>n.excludePolicyTab(l.activePolicyTab))},"Exclude")):(0,s.Q3)("",!0),((0,s.uX)(),(0,s.CE)("form",{onSubmit:a[77]||(a[77]=(0,i.D$)(a=>e.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",cp,[(0,s.Lk)("div",dp,[a[161]||(a[161]=(0,s.Lk)("label",{class:"VV-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[56]||(a[56]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].name]]),a[162]||(a[162]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",up,[a[163]||(a[163]=(0,s.Lk)("label",{class:"VV-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[57]||(a[57]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].identifier]]),a[164]||(a[164]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",pp,[a[165]||(a[165]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[58]||(a[58]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].description]]),a[166]||(a[166]=(0,s.Lk)("small",{class:"VV-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",vp,[(0,s.Lk)("div",mp,[a[167]||(a[167]=(0,s.Lk)("label",{class:"VV-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[59]||(a[59]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].scope]]),a[168]||(a[168]=(0,s.Lk)("small",{class:"VV-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",kp,[a[169]||(a[169]=(0,s.Lk)("label",{class:"VV-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[60]||(a[60]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].department]]),a[170]||(a[170]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",hp,[a[171]||(a[171]=(0,s.Lk)("label",{class:"VV-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[61]||(a[61]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].objective]]),a[172]||(a[172]=(0,s.Lk)("small",{class:"VV-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",gp,[(0,s.Lk)("div",yp,[a[173]||(a[173]=(0,s.Lk)("label",{class:"VV-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[62]||(a[62]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),a[174]||(a[174]=(0,s.Lk)("small",{class:"VV-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",fp,[a[175]||(a[175]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[63]||(a[63]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].applicability]]),a[176]||(a[176]=(0,s.Lk)("small",{class:"VV-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",bp,[(0,s.Lk)("div",Cp,[a[178]||(a[178]=(0,s.Lk)("label",{class:"VV-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[64]||(a[64]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:a[65]||(a[65]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),required:""},[a[177]||(a[177]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Lp))),128))],544),[[i.u1,l.policyTabs[l.activePolicyTab].type]]),a[179]||(a[179]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., Security Policy, HR Policy",-1))]),(0,s.Lk)("div",wp,[a[181]||(a[181]=(0,s.Lk)("label",{class:"VV-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[66]||(a[66]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:a[67]||(a[67]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type,required:""},[a[180]||(a[180]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Rp))),128))],40,Ep),[[i.u1,l.policyTabs[l.activePolicyTab].category]]),a[182]||(a[182]=(0,s.Lk)("small",{class:"VV-desc"},"Choose a category that best describes this policy's focus area",-1))])]),(0,s.Lk)("div",Dp,[(0,s.Lk)("div",Ip,[a[184]||(a[184]=(0,s.Lk)("label",{class:"VV-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[68]||(a[68]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),disabled:!l.policyTabs[l.activePolicyTab].category,required:""},[a[183]||(a[183]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policySubCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,_p))),128))],8,Pp),[[i.u1,l.policyTabs[l.activePolicyTab].subCategory]]),a[185]||(a[185]=(0,s.Lk)("small",{class:"VV-desc"},"Provide more specific classification",-1))]),(0,s.Lk)("div",Sp,[a[187]||(a[187]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",Ap,[(0,s.Lk)("div",Tp,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:a[71]||(a[71]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",xp,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:a[69]||(a[69]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",Fp,[l.loading?((0,s.uX)(),(0,s.CE)("span",Vp," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",Mp," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",Xp," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",Up,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),a[186]||(a[186]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",Np,[l.loading?((0,s.uX)(),(0,s.CE)("div",$p," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",Op,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:a=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:a=>n.handleEntitySelection(l.activePolicyTab,e.id,a.target.checked),onClick:a[70]||(a[70]=(0,i.D$)(()=>{},["stop"]))},null,40,Bp),(0,s.Lk)("span",Wp,(0,d.v_)(e.label),1)],10,jp))),128))])):(0,s.Q3)("",!0)])])])]),a[188]||(a[188]=(0,s.Lk)("small",{class:"VV-desc"},"Select the locations/entities this policy applies to",-1))])]),(0,s.Lk)("div",Qp,[(0,s.Lk)("div",qp,[a[189]||(a[189]=(0,s.Lk)("label",{class:"VV-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[72]||(a[72]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].startDate]]),a[190]||(a[190]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",Kp,[a[191]||(a[191]=(0,s.Lk)("label",{class:"VV-label"},"END DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[73]||(a[73]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date",required:""},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].endDate]]),a[192]||(a[192]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("div",Jp,[(0,s.Lk)("div",zp,[a[194]||(a[194]=(0,s.Lk)("label",{class:"VV-label"},"CREATED BY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[74]||(a[74]=e=>l.policyTabs[l.activePolicyTab].createdByName=e),required:""},[a[193]||(a[193]=(0,s.Lk)("option",{value:""},"Select Creator",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Hp))),128))],512),[[i.u1,l.policyTabs[l.activePolicyTab].createdByName]]),a[195]||(a[195]=(0,s.Lk)("small",{class:"VV-desc"},"Select who created this policy",-1))]),(0,s.Lk)("div",Yp,[a[197]||(a[197]=(0,s.Lk)("label",{class:"VV-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":a[75]||(a[75]=e=>l.policyTabs[l.activePolicyTab].reviewer=e),required:""},[a[196]||(a[196]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Gp))),128))],512),[[i.u1,l.policyTabs[l.activePolicyTab].reviewer]]),a[198]||(a[198]=(0,s.Lk)("small",{class:"VV-desc"},"Select who will review this policy",-1))])]),(0,s.Lk)("div",Zp,[a[199]||(a[199]=(0,s.Lk)("label",{class:"VV-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"VV-input",type:"file",onChange:a[76]||(a[76]=e=>n.handlePolicyFileUpload(e,l.activePolicyTab))},null,32),a[200]||(a[200]=(0,s.Lk)("small",{class:"VV-desc"},"Upload supporting documentation (optional)",-1))])],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",ev,[(0,s.Lk)("div",av,[(0,s.Lk)("div",tv,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-subpolicy-tab",{"VV-subpolicy-tab-active":a===l.policyTabs[l.activePolicyTab].activeSubPolicyTab,excluded:e.exclude}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=a}," Subpolicy "+(0,d.v_)(a+1),11,iv))),128)),(0,s.Lk)("button",{class:"VV-add-subpolicy-tab",onClick:a[78]||(a[78]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",sv,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-exclude-subpolicy-btn",{excluded:l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude}]),onClick:a[79]||(a[79]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},(0,d.v_)(l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?"Include":"Exclude"),3),l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?((0,s.uX)(),(0,s.CE)("div",ov," This subpolicy has been excluded and will not be included in the submission. ")):(0,s.Q3)("",!0),(0,s.Lk)("form",null,[(0,s.Lk)("div",lv,[a[201]||(a[201]=(0,s.Lk)("label",{class:"VV-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[80]||(a[80]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),a[202]||(a[202]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",nv,[a[203]||(a[203]=(0,s.Lk)("label",{class:"VV-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":a[81]||(a[81]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),a[204]||(a[204]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",rv,[a[205]||(a[205]=(0,s.Lk)("label",{class:"VV-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[82]||(a[82]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),a[206]||(a[206]=(0,s.Lk)("small",{class:"VV-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",cv,[a[207]||(a[207]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":a[83]||(a[83]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),a[208]||(a[208]=(0,s.Lk)("small",{class:"VV-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",dv,[(0,s.Lk)("button",{class:"VV-universal-submit-btn",onClick:a[84]||(a[84]=(0,i.D$)(e=>l.showVersionModal=!0,["prevent"]))},"Submit")])):(0,s.Q3)("",!0)],64)}var pv=t(2972);const vv="http://localhost:8000/api";var mv={name:"VV",components:{CustomDropdown:mt.A},data(){return{selectedTab:"framework",selectedFramework:"",selectedPolicy:"",frameworks:[],policies:[],policyTypes:[],policyCategories:[],policySubCategories:[],policyData:[],users:[],entities:[],frameworkForm:{name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:"",createdByName:"",reviewer:""},policyTabs:[],activePolicyTab:0,loading:!1,error:null,showVersionModal:!1,selectedVersionType:"minor"}},watch:{selectedFramework(e){this.handleFrameworkSelection(e)},selectedPolicy(e){"policy"===this.selectedTab&&this.selectedFramework&&e&&this.fetchPolicyDetails(e)},selectedTab(e){"framework"===e?(this.selectedPolicy="",this.fetchFrameworks(),this.selectedFramework&&this.handleFrameworkSelection(this.selectedFramework)):"policy"===e&&(this.selectedPolicy="",this.policyTabs=[],this.fetchFrameworks())}},async created(){try{await Promise.all([this.fetchFrameworks(),this.fetchPolicyData(),this.fetchEntities(),this.fetchUsers()])}catch(e){console.error("Error in component creation:",e),this.error="Failed to initialize component"}},methods:{selectTab(e){this.selectedTab=e},handleFileUpload(e){this.frameworkForm.file=e.target.files[0]},addSubPolicyTab(e){const a=this.policyTabs[e];this.policyTabs[e].subPolicies.push({id:`new-subpolicy-${Date.now()}`,name:"",identifier:"",control:"",description:"",createdByName:a.createdByName,exclude:!1}),this.policyTabs[e].activeSubPolicyTab=this.policyTabs[e].subPolicies.length-1},async handlePolicyFileUpload(e,a){const t=e.target.files[0];t&&(this.policyTabs[a].file=t)},addPolicyTab(){const e=`new-policy-${Date.now()}`;console.log("Creating new policy with ID:",e);const a="framework"===this.selectedTab?this.frameworkForm.createdByName:"",t="framework"===this.selectedTab?this.frameworkForm.reviewer:"";this.policyTabs.push({id:e,name:"",identifier:"",description:"",scope:"",department:"",objective:"",coverageRate:"",applicability:"",type:"",category:"",subCategory:"",entities:[],startDate:"",endDate:"",file:null,createdByName:a,reviewer:t,exclude:!1,subPolicies:[{id:`new-subpolicy-${Date.now()}`,name:"",identifier:"",control:"",description:"",createdByName:a,exclude:!1}],activeSubPolicyTab:0}),this.activePolicyTab=this.policyTabs.length-1},async fetchFrameworks(){try{this.loading=!0;const e=await qe.A.get(`${vv}/frameworks/`);console.log("Raw framework response:",e.data),this.frameworks=e.data.map(e=>({id:e.FrameworkId,name:e.FrameworkName,description:e.FrameworkDescription,category:e.Category,internalExternal:e.InternalExternal,startDate:e.StartDate,endDate:e.EndDate,status:e.Status})),console.log("Mapped frameworks:",this.frameworks),0===this.frameworks.length&&pv.OQ.info("No frameworks found","No Data")}catch(e){console.error("Error fetching frameworks:",e),this.error="Failed to fetch frameworks",pv.OQ.error("Failed to fetch frameworks","Error")}finally{this.loading=!1}},async fetchPolicyData(){try{const e=await qe.A.get(`${vv}/policy-categories/`);this.policyData=e.data,this.policyTypes=[...new Set(this.policyData.map(e=>e.PolicyType))],console.log("Fetched policy types:",this.policyTypes)}catch(e){console.error("Error fetching policy data:",e),this.error="Failed to fetch policy data",pv.OQ.error("Failed to fetch policy data","Error")}},handlePolicyTypeChange(e,a){console.log("Policy type changed:",a);const t=this.policyTabs[e];t.type=a,t.category="",t.subCategory="",this.updatePolicyCategoriesByType(a)},handlePolicyCategoryChange(e,a){console.log("Policy category changed:",a);const t=this.policyTabs[e];t.category=a,t.subCategory="",this.updateSubCategoriesByCategory(t.type,a)},handlePolicySubCategoryChange(e,a){console.log("Policy subcategory changed:",a),this.policyTabs[e].subCategory=a},updatePolicyCategoriesByType(e){if(console.log("Updating categories for type:",e),!e||!this.policyData)return this.policyCategories=[],void(this.policySubCategories=[]);const a=this.policyData.filter(a=>a.PolicyType===e);console.log("Filtered data:",a);const t=[...new Set(a.map(e=>e.PolicyCategory))];console.log("Available categories for type:",t),this.policyCategories=t,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].category="",this.policyTabs[this.activePolicyTab].subCategory=""),this.policySubCategories=[]},updateSubCategoriesByCategory(e,a){if(console.log("Updating subcategories for type:",e,"and category:",a),!e||!a||!this.policyData)return void(this.policySubCategories=[]);const t=this.policyData.filter(t=>t.PolicyType===e&&t.PolicyCategory===a);console.log("Filtered data:",t);const i=[...new Set(t.map(e=>e.PolicySubCategory))];console.log("Available subcategories:",i),this.policySubCategories=i,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].subCategory="")},async fetchEntities(){try{this.loading=!0;const e=await qe.A.get(`${vv}/entities/`);if(console.log("Raw entities response:",e.data),!e.data.entities)throw new Error("Invalid response format");this.entities=e.data.entities.map(e=>({id:e.id,label:e.label})),console.log("Mapped entities:",this.entities)}catch(e){console.error("Error fetching entities:",e),this.error="Failed to fetch entities"}finally{this.loading=!1}},handleEntitySelection(e,a,t){if(!(e<0)&&this.policyTabs[e]){if(console.log("handleEntitySelection:",{idx:e,entityId:a,isChecked:t}),this.policyTabs[e].entities||(this.policyTabs[e].entities=[]),"all"===a)this.policyTabs[e].entities=t?"all":[];else{let i="all"===this.policyTabs[e].entities?[]:Array.isArray(this.policyTabs[e].entities)?this.policyTabs[e].entities:[];const s=Number(a);t?i.includes(s)||i.push(s):i=i.filter(e=>e!==s),this.policyTabs[e].entities=i}console.log("Updated entities:",this.policyTabs[e].entities)}},selectEntity(e,a){if(e<0||!this.policyTabs[e])return;const t="all"===a?this.isAllEntitiesSelected(e):this.isEntitySelected(e,a);this.handleEntitySelection(e,a,!t)},isEntitySelected(e,a){const t=this.policyTabs[e];return!(!t||!t.entities)&&("all"===t.entities?"all"===a:Array.isArray(t.entities)&&t.entities.includes(Number(a)))},isAllEntitiesSelected(e){const a=this.policyTabs[e];return a&&"all"===a.entities},getSelectedEntitiesCount(e){const a=this.policyTabs[e];return a&&a.entities?"all"===a.entities?this.entities.length-1:Array.isArray(a.entities)?a.entities.length:0:0},toggleEntitiesDropdown(e){if(e<0||!this.policyTabs[e])return;this.policyTabs.forEach((a,t)=>{t!==e&&(a.showEntitiesDropdown=!1)});const a=this.policyTabs[e];a.showEntitiesDropdown=!a.showEntitiesDropdown,a.showEntitiesDropdown&&this.entities.length<=1&&this.fetchEntities()},closeAllEntityDropdowns(){this.policyTabs.forEach(e=>{e.showEntitiesDropdown=!1})},async handleFrameworkSelection(e){if(!e)return this.resetForm(),void(this.policies=[]);try{this.loading=!0;const[a,t]=await Promise.all([qe.A.get(`${vv}/frameworks/${e}/`),qe.A.get(`${vv}/frameworks/${e}/get-policies/`)]);console.log("Raw framework details:",a.data),console.log("Raw framework policies:",t.data);const i=a.data;console.log("DEBUG: Framework reviewer data:",{reviewer:i.Reviewer,reviewerName:i.ReviewerName});const s=i.ReviewerName||i.Reviewer||"";this.frameworkForm={name:i.FrameworkName,description:i.FrameworkDescription,identifier:i.Identifier,category:i.Category,internalExternal:i.InternalExternal,file:null,startDate:i.StartDate,endDate:i.EndDate,createdByName:i.CreatedByName,reviewer:s},console.log("DEBUG: Framework form after assignment:",{reviewer:this.frameworkForm.reviewer});const o=t.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive);this.policies=o.map(e=>({id:e.PolicyId,name:e.PolicyName}));const l=await Promise.all(o.map(async e=>{const a=await qe.A.get(`${vv}/policies/${e.PolicyId}/get-subpolicies/`),t="framework"===this.selectedTab?s:e.ReviewerName||e.Reviewer||"";return{id:e.PolicyId.toString(),name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate,file:null,createdByName:e.CreatedByName||i.CreatedByName,reviewer:t,exclude:!1,activeSubPolicyTab:0,subPolicies:a.data.map(e=>({id:e.SubPolicyId.toString(),name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status}))}}));0===l.length&&pv.OQ.info("No approved and active policies found for this framework","No Policies"),this.policyTabs=l,this.activePolicyTab=0}catch(a){console.error("Error handling framework selection:",a),this.error="Failed to load framework details",pv.OQ.error("Failed to load framework details","Error")}finally{this.loading=!1}},async submitFrameworkVersion(){try{if(this.loading=!0,console.log("Submitting framework version with policies:",this.policyTabs),!this.validateForm("framework"))return;const e={version_type:this.selectedVersionType,FrameworkName:this.frameworkForm.name,FrameworkDescription:this.frameworkForm.description,Category:this.frameworkForm.category,StartDate:this.frameworkForm.startDate,EndDate:this.frameworkForm.endDate,Identifier:this.frameworkForm.identifier,CreatedByName:this.frameworkForm.createdByName,ReviewerName:this.frameworkForm.reviewer,InternalExternal:this.frameworkForm.internalExternal,policies:[],new_policies:[]};this.policyTabs.forEach(a=>{if(a.exclude)return;const t={PolicyName:a.name,PolicyDescription:a.description,Department:a.department,Scope:a.scope,Objective:a.objective,Identifier:a.identifier,CoverageRate:a.coverageRate,Applicability:a.applicability,PolicyType:a.type,PolicyCategory:a.category,PolicySubCategory:a.subCategory,Entities:a.entities,StartDate:a.startDate,EndDate:a.endDate,CreatedByName:a.createdByName,ReviewerName:a.reviewer,subpolicies:[],new_subpolicies:[]};a.subPolicies.forEach(e=>{if(e.exclude)return;const i={SubPolicyName:e.name,Description:e.description,Identifier:e.identifier,Control:e.control,CreatedByName:e.createdByName||a.createdByName};e.id&&!String(e.id).startsWith("new-")?(i.original_subpolicy_id=parseInt(e.id),t.subpolicies.push(i)):t.new_subpolicies.push(i)}),a.id&&!String(a.id).startsWith("new-")?(t.original_policy_id=parseInt(a.id),e.policies.push(t)):e.new_policies.push(t)}),console.log("Submitting version data:",e);const a=await qe.A.post(`${vv}/frameworks/${this.selectedFramework}/create-version/`,e,{headers:{"Content-Type":"application/json"}});console.log("Framework version creation response:",a.data),pv.OQ.success("Framework version created successfully!","Success"),setTimeout(()=>{this.resetForm(),window.location.href="/create-policy/versioning"},1500)}catch(e){console.error("Error submitting framework version:",e);const a=e.response?.data?.error||"Failed to submit framework version";pv.OQ.error(a,"Error Creating Framework Version")}finally{this.loading=!1}},validateForm(e){if("framework"===e)return this.frameworkForm.name?this.frameworkForm.description?this.frameworkForm.identifier?this.frameworkForm.category?this.frameworkForm.internalExternal?this.frameworkForm.startDate?this.frameworkForm.createdByName?!!this.frameworkForm.reviewer||(pv.OQ.warning("Reviewer is required","Validation Error"),!1):(pv.OQ.warning("Created By is required","Validation Error"),!1):(pv.OQ.warning("Start date is required","Validation Error"),!1):(pv.OQ.warning("Internal/External selection is required","Validation Error"),!1):(pv.OQ.warning("Framework category is required","Validation Error"),!1):(pv.OQ.warning("Framework identifier is required","Validation Error"),!1):(pv.OQ.warning("Framework description is required","Validation Error"),!1):(pv.OQ.warning("Framework name is required","Validation Error"),!1);if("policy"===e){const e=this.policyTabs[0];return e.name?e.description?e.identifier?e.type?e.category?e.subCategory?e.createdByName?!!e.reviewer||(pv.OQ.warning("Reviewer is required","Validation Error"),!1):(pv.OQ.warning("Created By is required","Validation Error"),!1):(pv.OQ.warning("Policy sub-category is required","Validation Error"),!1):(pv.OQ.warning("Policy category is required","Validation Error"),!1):(pv.OQ.warning("Policy type is required","Validation Error"),!1):(pv.OQ.warning("Policy identifier is required","Validation Error"),!1):(pv.OQ.warning("Policy description is required","Validation Error"),!1):(pv.OQ.warning("Policy name is required","Validation Error"),!1)}return!1},resetForm(){this.frameworkForm={name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:"",createdByName:"",reviewer:""},this.policyTabs=[],this.activePolicyTab=0,this.selectedFramework="",this.selectedPolicy="",this.showVersionModal=!1,this.selectedVersionType="minor",this.policies=[]},async submitPolicyVersion(){try{if(this.loading=!0,console.log("Submitting policy version with data:",this.policyTabs[0]),!this.validateForm("policy"))return;const e={version_type:this.selectedVersionType,PolicyName:this.policyTabs[0].name,PolicyDescription:this.policyTabs[0].description,Department:this.policyTabs[0].department,Scope:this.policyTabs[0].scope,Objective:this.policyTabs[0].objective,Identifier:this.policyTabs[0].identifier,CoverageRate:this.policyTabs[0].coverageRate,Applicability:this.policyTabs[0].applicability,CreatedByName:this.policyTabs[0].createdByName,StartDate:this.policyTabs[0].startDate,EndDate:this.policyTabs[0].endDate,PermanentTemporary:this.policyTabs[0].permanentTemporary||"",DocURL:this.policyTabs[0].docURL||"",PolicyType:this.policyTabs[0].type,PolicyCategory:this.policyTabs[0].category,PolicySubCategory:this.policyTabs[0].subCategory,Entities:this.policyTabs[0].entities,Reviewer:this.policyTabs[0].reviewer},a=[],t=[];this.policyTabs[0].subPolicies.forEach(e=>{e.id&&!String(e.id).startsWith("new-")?a.push({original_subpolicy_id:parseInt(e.id),SubPolicyName:e.name,Description:e.description,Identifier:e.identifier,CreatedByName:e.createdByName,PermanentTemporary:e.permanentTemporary||"",Control:e.control,exclude:e.exclude||!1}):e.exclude||t.push({SubPolicyName:e.name,Description:e.description,Identifier:e.identifier,CreatedByName:e.createdByName,PermanentTemporary:e.permanentTemporary||"",Control:e.control})}),e.subpolicies=a,e.new_subpolicies=t,console.log("Submitting version data:",e);const i=await qe.A.post(`${vv}/policies/${this.selectedPolicy}/create-version/`,e);console.log("Policy version created:",i.data),pv.OQ.success("Policy version created successfully!","Success"),setTimeout(()=>{this.resetForm(),window.location.href="/create-policy/versioning"},1500)}catch(e){console.error("Error creating policy version:",e);const a=e.response?.data?.error||"Failed to create policy version";pv.OQ.error(a,"Error Creating Policy Version")}finally{this.loading=!1}},async confirmVersionType(){this.showVersionModal=!1,"framework"===this.selectedTab?await this.submitFrameworkVersion():"policy"===this.selectedTab&&await this.submitPolicyVersion()},async fetchUsers(){try{const e=await qe.A.get(`${vv}/users/`);console.log("Raw users response:",e.data),this.users=e.data.map(e=>({id:e.UserId,name:e.UserName})),console.log("Mapped users:",this.users)}catch(e){console.error("Error fetching users:",e),this.error="Failed to fetch users",pv.OQ.error("Failed to fetch users","Error")}},async fetchPolicyDetails(e){if(e)try{this.loading=!0;const[a,t]=await Promise.all([qe.A.get(`${vv}/policies/${e}/`),qe.A.get(`${vv}/policies/${e}/get-subpolicies/`)]);console.log("Raw policy details:",a.data),console.log("Raw subpolicies:",t.data);const i=a.data;this.policyTabs=[{id:i.PolicyId,name:i.PolicyName,description:i.PolicyDescription,status:i.Status,department:i.Department,scope:i.Scope,objective:i.Objective,identifier:i.Identifier,coverageRate:i.CoverageRate,applicability:i.Applicability,type:i.PolicyType,category:i.PolicyCategory,subCategory:i.PolicySubCategory,entities:i.Entities,startDate:i.StartDate,endDate:i.EndDate,file:null,createdByName:i.CreatedByName,reviewer:i.Reviewer,activeSubPolicyTab:0,subPolicies:t.data.map(e=>({id:e.SubPolicyId,name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status}))}],this.activePolicyTab=0}catch(a){console.error("Error fetching policy details:",a),this.error="Failed to fetch policy details",pv.OQ.error("Failed to fetch policy details","Error"),this.policyTabs=[]}finally{this.loading=!1}},excludePolicyTab(e){this.policyTabs[e]&&(this.policyTabs[e].exclude=!this.policyTabs[e].exclude,console.log(`Policy ${e} exclude status:`,this.policyTabs[e].exclude),this.policyTabs[e].exclude&&this.policyTabs[e].subPolicies.forEach(e=>{e.exclude=!0}))},excludeSubPolicyTab(e,a){this.policyTabs[e]&&this.policyTabs[e].subPolicies[a]&&(this.policyTabs[e].subPolicies[a].exclude=!this.policyTabs[e].subPolicies[a].exclude)}}};const kv=(0,se.A)(mv,[["render",uv],["__scopeId","data-v-7ab533e0"]]);var hv=kv;const gv={key:0,class:"tree-loading-overlay"},yv={key:0,class:"tree-error-message"},fv={class:"tree-header"},bv=["disabled"],Cv={class:"org-tree-content"},Lv={key:0,class:"org-tree-center"},wv={class:"org-tree-framework-row"},Ev={class:"org-tree-framework-node",ref:"frameworkNode"},Rv={class:"org-tree-policy-node"},Dv=["onClick"],Iv={class:"org-tree-subpolicy-node"};function Pv(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["tree-policies-container",{"sidebar-collapsed":o.isSidebarCollapsed}])},[a[8]||(a[8]=(0,s.Lk)("div",{class:"tree-heading"},[(0,s.Lk)("h2",null,"Tree Policy Structure"),(0,s.Lk)("div",{class:"tree-heading-underline"})],-1)),(0,s.bF)(i.eB,{name:"fade"},{default:(0,s.k6)(()=>[o.loading?((0,s.uX)(),(0,s.CE)("div",gv,a[4]||(a[4]=[(0,s.Lk)("div",{class:"tree-loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading...",-1)]))):(0,s.Q3)("",!0)]),_:1}),(0,s.bF)(i.eB,{name:"slide-fade"},{default:(0,s.k6)(()=>[o.error?((0,s.uX)(),(0,s.CE)("div",yv,[(0,s.eW)((0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{class:"tree-close-btn",onClick:a[0]||(a[0]=e=>o.error=null)},"âœ•")])):(0,s.Q3)("",!0)]),_:1}),(0,s.Lk)("div",fv,[(0,s.bF)(r,{config:o.frameworkDropdownConfig,modelValue:o.treeSelectedFramework,"onUpdate:modelValue":a[1]||(a[1]=e=>o.treeSelectedFramework=e),disabled:o.loading},null,8,["config","modelValue","disabled"]),o.treeSelectedFramework?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"tree-expand-btn",onClick:a[2]||(a[2]=(...e)=>o.expandAllTree&&o.expandAllTree(...e)),disabled:o.loading},a[5]||(a[5]=[(0,s.Lk)("i",{class:"fas fa-expand-alt",style:{"margin-right":"8px"}},null,-1),(0,s.eW)("Expand All ")]),8,bv)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Cv,[(0,s.bF)(i.eB,{name:"fade-scale"},{default:(0,s.k6)(()=>[o.treeSelectedFramework?((0,s.uX)(),(0,s.CE)("div",Lv,[(0,s.Lk)("div",wv,[(0,s.Lk)("div",Ev,[(0,s.Lk)("span",null,(0,d.v_)(o.treeSelectedFramework),1),o.showPolicies?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",{key:0,class:"org-tree-arrow-down clickable",onClick:a[3]||(a[3]=(...e)=>o.togglePolicies&&o.togglePolicies(...e))},a[6]||(a[6]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])))],512)]),(0,s.bF)(i.F,{name:"fade-slide",tag:"div",class:"org-tree-policies-row",ref:"policiesRow"},{default:(0,s.k6)(()=>[o.showPolicies?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.treePolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"org-tree-policy-block"},[(0,s.Lk)("div",Rv,[(0,s.Lk)("span",null,(0,d.v_)(e.title),1),!o.expandedPolicies[t]&&e.subPolicies?.length?((0,s.uX)(),(0,s.CE)("span",{key:0,class:"org-tree-arrow-down clickable",onClick:e=>o.togglePolicyExpand(t)},a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),8,Dv)):(0,s.Q3)("",!0)]),(0,s.bF)(i.F,{name:"fade-slide",tag:"div",class:"org-tree-subpolicies-row"},{default:(0,s.k6)(()=>[o.expandedPolicies[t]&&e.subPolicies?.length?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(e.subPolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"org-tree-subpolicy-block"},[(0,s.Lk)("div",Iv,[(0,s.Lk)("span",null,(0,d.v_)(e.title),1)])]))),128)):(0,s.Q3)("",!0)]),_:2},1024)]))),128)):(0,s.Q3)("",!0)]),_:1},512)])):(0,s.Q3)("",!0)]),_:1})])],2)}const _v="http://localhost:8000/api";var Sv={name:"TreePolicies",components:{CustomDropdown:mt.A},setup(){const e=(0,ee.KR)(700),a=(0,ee.KR)(60),t=(0,ee.KR)(260),i=(0,ee.KR)(50),o=(0,ee.KR)(""),l=(0,ee.KR)(!1),n=(0,ee.KR)({}),r=(0,ee.KR)(!1),c=(0,ee.KR)(!1),d=(0,ee.KR)(null),u=(0,ee.KR)([]),p=(0,ee.KR)(null);try{const e=(0,s.WQ)("sidebarCollapsed",null);null!==e&&(0,s.wB)(e,e=>{r.value=e},{immediate:!0})}catch(_){console.log("Sidebar state not available for injection")}const v=async()=>{try{c.value=!0,d.value=null;const e=await qe.A.get(`${_v}/frameworks/`);u.value=e.data.map(e=>({id:e.FrameworkId,title:e.FrameworkName}))}catch(e){console.error("Error fetching frameworks:",e),d.value="Failed to fetch frameworks"}finally{c.value=!1}},m=async e=>{try{c.value=!0,d.value=null;const a=await qe.A.get(`${_v}/frameworks/${e}/`);p.value=a.data}catch(a){console.error("Error fetching framework details:",a),d.value="Failed to fetch framework details"}finally{c.value=!1}};(0,s.wB)(o,async e=>{if(e){const a=u.value.find(a=>a.title===e);a&&await m(a.id)}else p.value=null});const k=(0,s.EW)(()=>u.value),h=(0,s.EW)(()=>p.value?p.value.policies.map(e=>({title:e.PolicyName,id:e.PolicyId,subPolicies:e.subpolicies.map(e=>({title:e.SubPolicyName,id:e.SubPolicyId}))})):[]),g=(0,s.EW)(()=>({label:"Framework",name:"framework",defaultValue:"Select Framework",values:u.value.map(e=>({value:e.title,label:e.title}))}));function y(){l.value=!l.value,l.value&&setTimeout(()=>{n.value={}},100)}function f(e){n.value={...n.value,[e]:!n.value[e]}}function b(){l.value=!0,setTimeout(()=>{const e={};h.value.forEach((a,t)=>{e[t]=!0}),n.value=e},100)}function C(a){const t=h.value.length;if(1===t)return e.value/2;const i=e.value/(t+1);return i*(a+1)}function L(e,a){if(1===e)return t.value/2;const i=t.value/(e+1);return i*(a+1)}(0,s.sV)(async()=>{await v(),u.value.length>0&&(o.value=u.value[0].title);const e=document.querySelector(".sidebar");e&&e.classList.contains("collapsed")&&(r.value=!0)});const w=64,E=52;function R(){return w}function D(){return a.value-8}function I(){return E}function P(){return i.value-8}return{treeSelectedFramework:o,showPolicies:l,expandedPolicies:n,treeFrameworks:k,treePolicies:h,togglePolicies:y,togglePolicyExpand:f,expandAllTree:b,isSidebarCollapsed:r,loading:c,error:d,getPolicyX:C,getSubX:L,getFrameworkToPolicyY1:R,getFrameworkToPolicyY2:D,getPolicyToSubY1:I,getPolicyToSubY2:P,svgWidth:e,svgPolicyLineHeight:a,svgSubWidth:t,svgSubLineHeight:i,frameworkDropdownConfig:g}}};const Av=(0,se.A)(Sv,[["render",Pv],["__scopeId","data-v-ac0788d4"]]);var Tv=Av;const xv={class:"framework-explorer-container"},Fv={class:"export-controls"},Vv={class:"export-controls-inner"},Mv={class:"summary-cards"},Xv={class:"summary-card-content"},Uv={class:"summary-value"},Nv={class:"summary-card-content"},$v={class:"summary-value"},Ov={class:"summary-card-content"},jv={class:"summary-value"},Bv={class:"summary-card-content"},Wv={class:"summary-value"},Qv={class:"top-controls"},qv={class:"framework-dropdown-section"},Kv={class:"internal-external-dropdown-section"},Jv={class:"entity-dropdown-section"},zv={key:0,class:"active-filter"},Hv={class:"framework-card-grid"},Yv=["onClick"],Gv={class:"framework-card-header"},Zv={class:"framework-title-section"},em={class:"framework-card-title"},am={class:"framework-card-category"},tm={class:"framework-card-desc"},im={class:"framework-card-actions"},sm={class:"action-buttons"},om=["checked","onChange"],lm=["onClick"],nm={key:0,class:"modal-loading"},rm={key:1,class:"modal-body simple-modal-body"},cm={class:"framework-details simple-framework-details"},dm={class:"detail-row simple-detail-row"},um={class:"detail-value simple-detail-value"},pm={class:"detail-row simple-detail-row"},vm={class:"detail-value simple-detail-value"},mm={class:"detail-row simple-detail-row"},km={class:"detail-value simple-detail-value"},hm={class:"detail-row simple-detail-row"},gm={class:"detail-value simple-detail-value"},ym={class:"detail-row simple-detail-row"},fm={class:"detail-value simple-detail-value"},bm={class:"detail-row simple-detail-row"},Cm={class:"detail-value simple-detail-value"},Lm={class:"detail-row simple-detail-row"},wm={class:"detail-value simple-detail-value"},Em={class:"detail-row simple-detail-row"},Rm={class:"detail-value simple-detail-value"},Dm={class:"detail-row simple-detail-row"},Im={class:"detail-value simple-detail-value"},Pm={class:"detail-row simple-detail-row"},_m={class:"detail-value simple-detail-value"},Sm={class:"detail-row simple-detail-row"},Am={class:"detail-value simple-detail-value"},Tm={class:"detail-row simple-detail-row"},xm={class:"detail-value simple-detail-value"},Fm={key:0,class:"detail-row simple-detail-row"},Vm=["href"],Mm={key:2,class:"modal-error"};var Xm={__name:"FrameworkExplorer",setup(e){const a=(0,ee.KR)([]),t=(0,ee.KR)(""),o=(0,ee.KR)(""),l=(0,ee.KR)(""),n=(0,ee.KR)([]),r=(0,ae.rd)(),c=(0,ee.KR)({active_frameworks:0,inactive_frameworks:0,active_policies:0,inactive_policies:0}),u=(0,ee.KR)(!1),p=(0,ee.KR)(null),v=(0,ee.KR)(null),m=(0,s.EW)(()=>{const e=[];if(p.value&&v.value&&e.push(`${p.value} ${v.value}s`),o.value&&e.push(o.value),l.value){const a=n.value.find(e=>e.id===l.value)?.label||l.value;e.push(a)}return e.length>0?e.join(" & "):null}),k=(0,ee.KR)(!1),h=(0,ee.KR)(!1),g=(0,ee.KR)(null),y=(0,ee.KR)(""),f=async()=>{if(t.value&&y.value)try{const a=await qe.A.post(`/api/frameworks/${t.value}/export/`,{format:y.value}),{file_url:i,file_name:s}=a.data;if(!i||!s)return void Za.error("Export failed: No file URL or name returned.","Export Error");try{const e=await qe.A.get(i,{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data])),t=document.createElement("a");t.href=a,t.setAttribute("download",s),document.body.appendChild(t),t.click(),t.remove(),window.URL.revokeObjectURL(a),Za.success("Export completed successfully!","Export Success")}catch(e){Za.success("Export completed successfully!","Export Success"),console.error(e)}}catch(a){Za.error("Export failed. Please try again.","Export Error"),console.error(a)}else Za.warning("Please select a framework and format.","Missing Selection")},b=e=>{if(!e)return"N/A";try{const a=new Date(e);return a.toLocaleDateString()}catch(a){return e}},C=async()=>{u.value=!0;try{const e={};l.value&&(e.entity=l.value);const t=await qe.A.get("/api/framework-explorer/",{params:e});a.value=t.data.frameworks,c.value=t.data.summary}catch(e){console.error("Error fetching frameworks:",e)}finally{u.value=!1}},L=async()=>{try{const e=await qe.A.get("/api/entities/");n.value=e.data.entities||[]}catch(e){console.error("Error fetching entities:",e)}},w=async e=>{g.value=null,k.value=!0,h.value=!0;try{const a=await qe.A.get(`/api/frameworks/${e}/details/`);g.value=a.data}catch(a){console.error("Error fetching framework details:",a)}finally{h.value=!1}},E=()=>{k.value=!1},R=(e,a)=>{p.value===e&&v.value===a?D():(p.value=e,v.value=a)},D=()=>{p.value=null,v.value=null,o.value="",l.value=""},I=async e=>{try{if("Active"===e.status)try{const a=await qe.A.get("/api/users-for-reviewer-selection/"),t=a.data;if(0===t.length)return void Za.warning("No reviewers available. Please contact an administrator.","No Reviewers");const i=t.map(e=>({value:e.UserId,label:`${e.UserName} (${e.Email})`}));Za.select("Please select a reviewer for this framework deactivation request:","Select Reviewer",i,async a=>{console.log("DEBUG: Selected reviewer ID:",a,"Type:",typeof a),a?Za.comment("Please provide a reason for deactivating this framework:","Framework Deactivation",async t=>{if(console.log("DEBUG: Reason provided:",t),t&&""!==t.trim())try{console.log("DEBUG: Sending API request with data:",{reason:t.trim(),cascadeToApproved:!0,ReviewerId:a,UserId:1});const i=await qe.A.post(`/api/frameworks/${e.id}/request-status-change/`,{reason:t.trim(),cascadeToApproved:!0,ReviewerId:a,UserId:1});console.log("DEBUG: API response:",i.data),Za.success("Framework deactivation request submitted. Awaiting approval.","Request Submitted"),await C()}catch(i){console.error("Error submitting deactivation request:",i),console.error("Error response:",i.response?.data),Za.error("Failed to submit deactivation request. Please try again.","Request Failed")}else Za.warning("Deactivation reason is required.","Missing Information")}):Za.warning("Reviewer selection is required.","Missing Information")})}catch(a){return console.error("Error fetching reviewers:",a),void Za.error("Failed to fetch reviewers. Please try again.","Error")}else{const a=await qe.A.post(`/api/frameworks/${e.id}/toggle-status/`,{reason:"Reactivating framework",cascadeToApproved:!0});e.status=a.data.status||"Active";let t="Framework status change request submitted.";Za.success(t,"Status Update"),await C()}}catch(a){console.error("Error toggling framework status:",a),Za.error("Failed to update framework status. Please try again.","Update Failed")}},P=(0,s.EW)(()=>{let e=a.value;return t.value?(e=e.filter(e=>e.id===parseInt(t.value)),e):(o.value&&(e=e.filter(e=>e.internalExternal===o.value)),p.value&&v.value&&("framework"===v.value?e=e.filter(e=>e.status===p.value):"policy"===v.value&&(e="Active"===p.value?e.filter(e=>e.active_policies_count>0):e.filter(e=>e.inactive_policies_count>0))),e)});function _(e){const a={name:"FrameworkPolicies",params:{frameworkId:e}};l.value&&(a.query={entity:l.value}),r.push(a)}(0,s.wB)(l,()=>{C()}),(0,s.sV)(()=>{L();const e=(0,ae.lq)().query.entity;e&&(l.value=e),C()});const S=(0,s.EW)(()=>({label:"Framework",values:[{value:"",label:"Select Framework"},...a.value.map(e=>({value:String(e.id),label:e.name}))]})),A={label:"Type",values:[{value:"",label:"All Types"},{value:"Internal",label:"Internal"},{value:"External",label:"External"}]},T=(0,s.EW)(()=>({label:"Entity",values:[{value:"",label:"All Entities"},...n.value.map(e=>({value:String(e.id),label:e.label}))]}));return(e,a)=>((0,s.uX)(),(0,s.CE)("div",xv,[(0,s.Lk)("div",Fv,[(0,s.Lk)("div",Vv,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),class:"export-dropdown"},a[10]||(a[10]=[(0,s.Fv)('<option value="" disabled data-v-e070cfa2>Select format</option><option value="xlsx" data-v-e070cfa2>Excel (.xlsx)</option><option value="pdf" data-v-e070cfa2>PDF (.pdf)</option><option value="csv" data-v-e070cfa2>CSV (.csv)</option><option value="json" data-v-e070cfa2>JSON (.json)</option><option value="xml" data-v-e070cfa2>XML (.xml)</option><option value="txt" data-v-e070cfa2>Text (.txt)</option>',7)]),512),[[i.u1,y.value]]),(0,s.Lk)("button",{onClick:f}," Export ")])]),a[33]||(a[33]=(0,s.Lk)("div",{class:"page-header"},[(0,s.Lk)("h1",null,"Framework Explorer"),(0,s.Lk)("div",{class:"page-header-underline"})],-1)),(0,s.Lk)("div",Mv,[(0,s.Lk)("div",{class:"summary-card active-framework",onClick:a[1]||(a[1]=e=>R("Active","framework"))},[(0,s.Lk)("div",Xv,[a[11]||(a[11]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"})]),(0,s.Lk)("div",{class:"summary-label"},"Active Framework")],-1)),(0,s.Lk)("span",Uv,(0,d.v_)(c.value.active_frameworks),1)])]),(0,s.Lk)("div",{class:"summary-card inactive-framework",onClick:a[2]||(a[2]=e=>R("Inactive","framework"))},[(0,s.Lk)("div",Nv,[a[12]||(a[12]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-shield"})]),(0,s.Lk)("div",{class:"summary-label"},"Inactive Framework")],-1)),(0,s.Lk)("span",$v,(0,d.v_)(c.value.inactive_frameworks),1)])]),(0,s.Lk)("div",{class:"summary-card active-policy",onClick:a[3]||(a[3]=e=>R("Active","policy"))},[(0,s.Lk)("div",Ov,[a[13]||(a[13]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-file-circle-check"})]),(0,s.Lk)("div",{class:"summary-label"},"Active Policy")],-1)),(0,s.Lk)("span",jv,(0,d.v_)(c.value.active_policies),1)])]),(0,s.Lk)("div",{class:"summary-card inactive-policy",onClick:a[4]||(a[4]=e=>R("Inactive","policy"))},[(0,s.Lk)("div",Bv,[a[14]||(a[14]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-file-circle-xmark"})]),(0,s.Lk)("div",{class:"summary-label"},"Inactive Policy")],-1)),(0,s.Lk)("span",Wv,(0,d.v_)(c.value.inactive_policies),1)])])]),(0,s.Lk)("div",Qv,[(0,s.Lk)("div",qv,[(0,s.bF)(mt.A,{config:S.value,modelValue:t.value,"onUpdate:modelValue":a[5]||(a[5]=e=>t.value=e)},null,8,["config","modelValue"])]),(0,s.Lk)("div",Kv,[(0,s.bF)(mt.A,{config:A,modelValue:o.value,"onUpdate:modelValue":a[6]||(a[6]=e=>o.value=e)},null,8,["modelValue"])]),(0,s.Lk)("div",Jv,[(0,s.bF)(mt.A,{config:T.value,modelValue:l.value,"onUpdate:modelValue":a[7]||(a[7]=e=>l.value=e)},null,8,["config","modelValue"])]),m.value?((0,s.uX)(),(0,s.CE)("div",zv,[(0,s.Lk)("span",null,"Filtered by: "+(0,d.v_)(m.value),1),(0,s.Lk)("button",{class:"clear-filter-btn",onClick:D},"Clear Filter")])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Hv,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(P.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"framework-card",onClick:a=>_(e.id)},[(0,s.Lk)("div",Gv,[(0,s.Lk)("div",Zv,[a[15]||(a[15]=(0,s.Lk)("span",{class:"framework-icon"},[(0,s.Lk)("i",{class:"fas fa-book"})],-1)),(0,s.Lk)("span",em,(0,d.v_)(e.name),1)])]),(0,s.Lk)("div",am,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["framework-card-type",{"type-internal":"Internal"===(e.internalExternal||"Internal"),"type-external":"External"===(e.internalExternal||"Internal")}])}," Type: "+(0,d.v_)(e.internalExternal||"Internal"),3),(0,s.Lk)("div",tm,(0,d.v_)(e.description),1),(0,s.Lk)("div",im,[(0,s.Lk)("div",sm,[(0,s.Lk)("label",{class:"switch",onClick:a[8]||(a[8]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("input",{type:"checkbox",checked:"Active"===e.status,onChange:(0,i.D$)(a=>I(e),["stop"])},null,40,om),a[16]||(a[16]=(0,s.Lk)("span",{class:"slider"},null,-1))]),(0,s.Lk)("span",{class:(0,d.C4)(["switch-label","Active"===e.status?"active":"inactive"])},(0,d.v_)(e.status),3)]),(0,s.Lk)("span",{class:"document-icon",onClick:(0,i.D$)(a=>w(e.id),["stop"])},a[17]||(a[17]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)]),8,lm)])],8,Yv))),128))]),k.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:E},[(0,s.Lk)("div",{class:"modal-content simple-modal",onClick:a[9]||(a[9]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"modal-close-btn simple-close",onClick:E},"Ã—"),a[32]||(a[32]=(0,s.Lk)("div",{class:"simple-modal-header"},[(0,s.Lk)("h2",null,"Framework Details")],-1)),h.value?((0,s.uX)(),(0,s.CE)("div",nm,a[18]||(a[18]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading details... ")]))):g.value?((0,s.uX)(),(0,s.CE)("div",rm,[(0,s.Lk)("div",cm,[(0,s.Lk)("div",dm,[a[19]||(a[19]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Framework Name",-1)),(0,s.Lk)("span",um,(0,d.v_)(g.value.FrameworkName),1)]),(0,s.Lk)("div",pm,[a[20]||(a[20]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Description",-1)),(0,s.Lk)("span",vm,(0,d.v_)(g.value.FrameworkDescription),1)]),(0,s.Lk)("div",mm,[a[21]||(a[21]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Category",-1)),(0,s.Lk)("span",km,(0,d.v_)(g.value.Category),1)]),(0,s.Lk)("div",hm,[a[22]||(a[22]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Version",-1)),(0,s.Lk)("span",gm,(0,d.v_)(g.value.CurrentVersion),1)]),(0,s.Lk)("div",ym,[a[23]||(a[23]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Status",-1)),(0,s.Lk)("span",fm,(0,d.v_)(g.value.Status),1)]),(0,s.Lk)("div",bm,[a[24]||(a[24]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Active/Inactive",-1)),(0,s.Lk)("span",Cm,(0,d.v_)(g.value.ActiveInactive),1)]),(0,s.Lk)("div",Lm,[a[25]||(a[25]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Identifier",-1)),(0,s.Lk)("span",wm,(0,d.v_)(g.value.Identifier),1)]),(0,s.Lk)("div",Em,[a[26]||(a[26]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Effective Date",-1)),(0,s.Lk)("span",Rm,(0,d.v_)(b(g.value.EffectiveDate)),1)]),(0,s.Lk)("div",Dm,[a[27]||(a[27]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Start Date",-1)),(0,s.Lk)("span",Im,(0,d.v_)(b(g.value.StartDate)),1)]),(0,s.Lk)("div",Pm,[a[28]||(a[28]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"End Date",-1)),(0,s.Lk)("span",_m,(0,d.v_)(b(g.value.EndDate)),1)]),(0,s.Lk)("div",Sm,[a[29]||(a[29]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Created By",-1)),(0,s.Lk)("span",Am,(0,d.v_)(g.value.CreatedByName),1)]),(0,s.Lk)("div",Tm,[a[30]||(a[30]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Created Date",-1)),(0,s.Lk)("span",xm,(0,d.v_)(b(g.value.CreatedByDate)),1)]),g.value.DocURL?((0,s.uX)(),(0,s.CE)("div",Fm,[a[31]||(a[31]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Documentation",-1)),(0,s.Lk)("a",{href:g.value.DocURL,target:"_blank",class:"doc-link simple-detail-value"},"View Documentation",8,Vm)])):(0,s.Q3)("",!0)])])):((0,s.uX)(),(0,s.CE)("div",Mm," Failed to load framework details. "))])])):(0,s.Q3)("",!0),(0,s.bF)(vt)]))}};const Um=(0,se.A)(Xm,[["__scopeId","data-v-e070cfa2"]]);var Nm=Um;const $m={class:"framework-policies-container"},Om={class:"breadcrumb-tab"},jm={class:"breadcrumb-chip"},Bm={class:"top-controls"},Wm={class:"entity-dropdown-section"},Qm={class:"policy-card-grid"},qm={class:"policy-card-header"},Km={class:"policy-title-section"},Jm={class:"policy-card-title"},zm={class:"policy-card-meta"},Hm={class:"policy-card-category"},Ym={class:"policy-card-desc"},Gm={class:"policy-card-actions"},Zm={class:"action-buttons"},ek=["checked","onChange"],ak=["onClick"],tk=["onClick"],ik={key:0,class:"modal-loading"},sk={key:1,class:"modal-body"},ok={class:"detail-row"},lk={class:"detail-value"},nk={class:"detail-row"},rk={class:"detail-value"},ck={class:"detail-row"},dk={class:"detail-value"},uk={class:"detail-row"},pk={class:"detail-value"},vk={class:"detail-row"},mk={class:"detail-value"},kk={class:"detail-row"},hk={class:"detail-value"},gk={class:"detail-row"},yk={class:"detail-value"},fk={class:"detail-row"},bk={class:"detail-value"},Ck={class:"detail-row"},Lk={class:"detail-value"},wk={class:"detail-row"},Ek={class:"detail-value"},Rk={class:"detail-row"},Dk={class:"detail-value"},Ik={class:"detail-row"},Pk={class:"detail-value"},_k={class:"detail-row"},Sk={class:"detail-value"},Ak={class:"detail-row"},Tk={class:"detail-value"},xk={key:0,class:"detail-row"},Fk=["href"],Vk={key:1,class:"subpolicies-section"},Mk={class:"subpolicy-header"},Xk={class:"subpolicy-name"},Uk={class:"subpolicy-detail"},Nk={class:"subpolicy-detail"},$k={class:"subpolicy-detail"},Ok={key:2,class:"no-subpolicies"},jk={key:2,class:"modal-error"};var Bk={__name:"FrameworkPolicies",setup(e){const a=(0,ae.rd)(),t=(0,ae.lq)(),o=t.params.frameworkId,l=(0,ee.KR)(""),n=(0,ee.KR)([]),r=(0,ee.KR)([]),c=(0,ee.KR)(""),u=(0,ee.KR)([]),p=(0,ee.KR)(!1),v=(0,ee.Kh)({}),m=(0,ee.KR)(!1),k=(0,ee.KR)(!1),h=(0,ee.KR)(null),g=e=>{if(!e)return"N/A";try{const a=new Date(e);return a.toLocaleDateString()}catch(a){return e}},y=async()=>{p.value=!0;try{const e=await qe.A.get(`/api/frameworks/${o}/policies-list/`);r.value=e.data.policies,l.value=e.data.framework.name;for(const a of r.value)void 0===v[a.id]&&(v[a.id]="")}catch(e){console.error("Error fetching policies:",e)}finally{p.value=!1}},f=async()=>{try{const e=await qe.A.get("/api/entities/");u.value=e.data.entities||[]}catch(e){console.error("Error fetching entities:",e)}},b=(0,s.EW)(()=>{if(!c.value)return r.value;console.log("Filtering policies with entity:",c.value),console.log("Total policies before filtering:",r.value.length);const e=r.value.filter(e=>{if(!e.Entities)return!1;if("all"===e.Entities)return!0;if("all"===c.value)return!0;if(Array.isArray(e.Entities)){const a=parseInt(c.value),t=c.value.toString();return e.Entities.includes("all")||e.Entities.includes(a)||e.Entities.includes(t)}return!1});return console.log("Filtered policies count:",e.length),console.log("Filtered policies:",e.map(e=>({name:e.name,entities:e.Entities}))),e});(0,s.wB)(b,e=>{n.value=e},{immediate:!0});const C=async e=>{h.value=null,m.value=!0,k.value=!0;try{const a=await qe.A.get(`/api/policies/${e}/details/`);h.value=a.data}catch(a){console.error("Error fetching policy details:",a)}finally{k.value=!1}},L=()=>{m.value=!1},w=async e=>{try{if("Active"===e.status)try{const a=await qe.A.get("/api/users-for-reviewer-selection/"),t=a.data;if(0===t.length)return void Za.warning("No reviewers available. Please contact administrator.","No Reviewers");const i=t.map(e=>({value:e.UserId,label:`${e.UserName} (${e.Email})`}));Za.select("Select a reviewer for this policy deactivation request:","Select Reviewer",i,async a=>{console.log("Selected reviewer ID:",a),Za.comment("Please provide a reason for deactivating this policy:","Policy Deactivation Reason",async t=>{if(t&&""!==t.trim())try{await qe.A.post(`/api/policies/${e.id}/toggle-status/`,{reason:t.trim(),ReviewerId:a,cascadeSubpolicies:!0}),Za.success("Policy deactivation request submitted. Awaiting approval.","Request Submitted"),await y()}catch(i){console.error("Error submitting deactivation request:",i),Za.error("Failed to submit deactivation request. Please try again.","Request Failed")}else Za.warning("Deactivation reason is required.","Missing Information")})})}catch(a){console.error("Error fetching reviewers:",a),Za.error("Failed to load reviewers. Please try again.","Load Error")}else{const a=await qe.A.post(`/api/policies/${e.id}/toggle-status/`,{cascadeSubpolicies:!0});e.status=a.data.status||"Active";let t="Policy status change request submitted.";a.data.other_versions_deactivated>0&&(t+=` ${a.data.other_versions_deactivated} previous version(s) of this policy were automatically deactivated.`),a.data.subpolicies_affected>0&&(t+=` ${a.data.subpolicies_affected} subpolicies were also activated.`),Za.success(t,"Status Update"),await y()}}catch(a){console.error("Error toggling policy status:",a),Za.error("Failed to update policy status. Please try again.","Update Failed")}},E=async e=>{try{const a=await qe.A.post(`/api/acknowledge-policy/${e.id}/`);e.isAcknowledged=!0,Za.success(a.data.message,"Policy Acknowledged")}catch(a){console.error("Error acknowledging policy:",a),Za.error("Failed to acknowledge policy. Please try again.","Acknowledgment Failed")}};function R(){const e={name:"FrameworkExplorer"};c.value&&(e.query={entity:c.value}),a.push(e)}(0,s.sV)(()=>{y(),f();const e=t.query.entity;e&&(c.value=e)});const D=(0,s.EW)(()=>({label:"Entity",values:[{value:"",label:"All Entities"},...u.value.map(e=>({value:e.id,label:e.label}))]}));return(e,a)=>((0,s.uX)(),(0,s.CE)("div",$m,[(0,s.Lk)("div",Om,[(0,s.Lk)("span",jm,[(0,s.eW)((0,d.v_)(l.value)+" ",1),(0,s.Lk)("span",{class:"breadcrumb-close",onClick:R},"Ã—")])]),(0,s.Lk)("h2",null,"Policies for "+(0,d.v_)(l.value),1),(0,s.Lk)("div",Bm,[(0,s.Lk)("div",Wm,[(0,s.bF)(mt.A,{config:D.value,modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),"show-search-bar":!0},null,8,["config","modelValue"])])]),(0,s.Lk)("div",Qm,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"policy-card"},[(0,s.Lk)("div",qm,[(0,s.Lk)("div",Km,[a[3]||(a[3]=(0,s.Lk)("span",{class:"policy-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("span",Jm,(0,d.v_)(e.name),1)])]),(0,s.Lk)("div",zm,[(0,s.Lk)("span",Hm,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-card-type","External"===e.type?"external":""])}," Type: "+(0,d.v_)(e.type||"External"),3)]),(0,s.Lk)("div",Ym,(0,d.v_)(e.description),1),(0,s.Lk)("div",Gm,[(0,s.Lk)("div",Zm,[(0,s.Lk)("label",{class:"switch",onClick:a[1]||(a[1]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("input",{type:"checkbox",checked:"Active"===e.status,onChange:a=>w(e)},null,40,ek),a[4]||(a[4]=(0,s.Lk)("span",{class:"slider"},null,-1))]),"Active"===e.status?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a=>E(e),class:(0,d.C4)(["acknowledge-btn",{acknowledged:e.isAcknowledged}])},(0,d.v_)(e.isAcknowledged?"Acknowledged":"Acknowledge"),11,ak)):(0,s.Q3)("",!0),(0,s.Lk)("span",{class:"document-icon",onClick:a=>C(e.id)},a[5]||(a[5]=[(0,s.Lk)("i",{class:"fas fa-file-lines"},null,-1)]),8,tk)])])]))),128))]),m.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:L},[(0,s.Lk)("div",{class:"modal-content",onClick:a[2]||(a[2]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:"modal-header"},[a[6]||(a[6]=(0,s.Lk)("h3",null,"Policy Details",-1)),(0,s.Lk)("span",{class:"close-btn",onClick:L},"Ã—")]),k.value?((0,s.uX)(),(0,s.CE)("div",ik,a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading details... ")]))):h.value?((0,s.uX)(),(0,s.CE)("div",sk,[(0,s.Lk)("div",ok,[a[8]||(a[8]=(0,s.Lk)("span",{class:"detail-label"},"Policy Name:",-1)),(0,s.Lk)("span",lk,(0,d.v_)(h.value.PolicyName),1)]),(0,s.Lk)("div",nk,[a[9]||(a[9]=(0,s.Lk)("span",{class:"detail-label"},"Description:",-1)),(0,s.Lk)("span",rk,(0,d.v_)(h.value.PolicyDescription),1)]),(0,s.Lk)("div",ck,[a[10]||(a[10]=(0,s.Lk)("span",{class:"detail-label"},"Department:",-1)),(0,s.Lk)("span",dk,(0,d.v_)(h.value.Department),1)]),(0,s.Lk)("div",uk,[a[11]||(a[11]=(0,s.Lk)("span",{class:"detail-label"},"Version:",-1)),(0,s.Lk)("span",pk,(0,d.v_)(h.value.CurrentVersion),1)]),(0,s.Lk)("div",vk,[a[12]||(a[12]=(0,s.Lk)("span",{class:"detail-label"},"Status:",-1)),(0,s.Lk)("span",mk,(0,d.v_)(h.value.Status),1)]),(0,s.Lk)("div",kk,[a[13]||(a[13]=(0,s.Lk)("span",{class:"detail-label"},"Active/Inactive:",-1)),(0,s.Lk)("span",hk,(0,d.v_)(h.value.ActiveInactive),1)]),(0,s.Lk)("div",gk,[a[14]||(a[14]=(0,s.Lk)("span",{class:"detail-label"},"Identifier:",-1)),(0,s.Lk)("span",yk,(0,d.v_)(h.value.Identifier),1)]),(0,s.Lk)("div",fk,[a[15]||(a[15]=(0,s.Lk)("span",{class:"detail-label"},"Start Date:",-1)),(0,s.Lk)("span",bk,(0,d.v_)(g(h.value.StartDate)),1)]),(0,s.Lk)("div",Ck,[a[16]||(a[16]=(0,s.Lk)("span",{class:"detail-label"},"End Date:",-1)),(0,s.Lk)("span",Lk,(0,d.v_)(g(h.value.EndDate)),1)]),(0,s.Lk)("div",wk,[a[17]||(a[17]=(0,s.Lk)("span",{class:"detail-label"},"Created By:",-1)),(0,s.Lk)("span",Ek,(0,d.v_)(h.value.CreatedByName),1)]),(0,s.Lk)("div",Rk,[a[18]||(a[18]=(0,s.Lk)("span",{class:"detail-label"},"Created Date:",-1)),(0,s.Lk)("span",Dk,(0,d.v_)(g(h.value.CreatedByDate)),1)]),(0,s.Lk)("div",Ik,[a[19]||(a[19]=(0,s.Lk)("span",{class:"detail-label"},"Applicability:",-1)),(0,s.Lk)("span",Pk,(0,d.v_)(h.value.Applicability),1)]),(0,s.Lk)("div",_k,[a[20]||(a[20]=(0,s.Lk)("span",{class:"detail-label"},"Scope:",-1)),(0,s.Lk)("span",Sk,(0,d.v_)(h.value.Scope),1)]),(0,s.Lk)("div",Ak,[a[21]||(a[21]=(0,s.Lk)("span",{class:"detail-label"},"Objective:",-1)),(0,s.Lk)("span",Tk,(0,d.v_)(h.value.Objective),1)]),h.value.DocURL?((0,s.uX)(),(0,s.CE)("div",xk,[a[22]||(a[22]=(0,s.Lk)("span",{class:"detail-label"},"Documentation:",-1)),(0,s.Lk)("a",{href:h.value.DocURL,target:"_blank",class:"doc-link"},"View Documentation",8,Fk)])):(0,s.Q3)("",!0),h.value.subpolicies&&h.value.subpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",Vk,[a[26]||(a[26]=(0,s.Lk)("h4",null,"Subpolicies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value.subpolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"subpolicy-item"},[(0,s.Lk)("div",Mk,[(0,s.Lk)("span",Xk,(0,d.v_)(e.SubPolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["subpolicy-status",e.Status.toLowerCase()])},(0,d.v_)(e.Status),3)]),(0,s.Lk)("div",Uk,[a[23]||(a[23]=(0,s.Lk)("span",{class:"subpolicy-label"},"Identifier:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.Identifier),1)]),(0,s.Lk)("div",Nk,[a[24]||(a[24]=(0,s.Lk)("span",{class:"subpolicy-label"},"Description:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.Description),1)]),(0,s.Lk)("div",$k,[a[25]||(a[25]=(0,s.Lk)("span",{class:"subpolicy-label"},"Control:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.Control),1)])]))),128))])):((0,s.uX)(),(0,s.CE)("div",Ok," No subpolicies found for this policy. "))])):((0,s.uX)(),(0,s.CE)("div",jk," Failed to load policy details. "))])])):(0,s.Q3)("",!0),(0,s.bF)(vt)]))}};const Wk=(0,se.A)(Bk,[["__scopeId","data-v-615f88f1"]]);var Qk=Wk;const qk={class:"Policy-kpi-kpi-dashboard"},Kk={class:"Policy-kpi-dashboard-header"},Jk={key:0,class:"Policy-kpi-loading-state"},zk={key:1,class:"Policy-kpi-error-state"},Hk={key:2,class:"Policy-kpi-dashboard-content"},Yk={class:"Policy-kpi-kpi-section"},Gk={class:"Policy-kpi-kpi-row"},Zk={class:"Policy-kpi-kpi-card"},eh={class:"Policy-kpi-kpi-body"},ah={class:"Policy-kpi-kpi-visualization"},th={class:"Policy-kpi-circular-progress-inner"},ih={class:"Policy-kpi-kpi-value"},sh={class:"Policy-kpi-kpi-details"},oh={class:"Policy-kpi-detail-item"},lh={class:"Policy-kpi-detail-value"},nh={class:"Policy-kpi-detail-item"},rh={class:"Policy-kpi-detail-value"},ch={class:"Policy-kpi-trend-section"},dh={class:"Policy-kpi-trend-header"},uh={class:"Policy-kpi-detail-item Policy-kpi-status-breakdown"},ph={class:"Policy-kpi-status-row"},vh={class:"Policy-kpi-status-value"},mh={class:"Policy-kpi-status-row"},kh={class:"Policy-kpi-status-value"},hh={class:"Policy-kpi-kpi-card"},gh={class:"Policy-kpi-kpi-body"},yh={class:"Policy-kpi-acknowledgement-table"},fh={class:"Policy-kpi-table-body"},bh={class:"Policy-kpi-policy-info"},Ch={class:"Policy-kpi-policy-name"},Lh={class:"Policy-kpi-policy-stats"},wh={class:"Policy-kpi-acknowledged-count"},Eh={class:"Policy-kpi-total-users"},Rh={class:"Policy-kpi-progress-container"},Dh={class:"Policy-kpi-progress-bar"},Ih={class:"Policy-kpi-progress-text"},Ph={key:1,class:"Policy-kpi-no-data"},_h={class:"Policy-kpi-kpi-card"},Sh={class:"Policy-kpi-kpi-body"},Ah={class:"Policy-kpi-coverage-container"},Th={class:"Policy-kpi-coverage-overview"},xh={class:"Policy-kpi-overall-coverage"},Fh={class:"Policy-kpi-overall-value"},Vh={class:"Policy-kpi-coverage-bars"},Mh={class:"Policy-kpi-bar-header"},Xh={class:"Policy-kpi-department-name"},Uh={class:"Policy-kpi-department-value"},Nh={class:"Policy-kpi-bar-container"},$h={class:"Policy-kpi-department-policies"},Oh={class:"Policy-kpi-kpi-row"},jh={class:"Policy-kpi-kpi-card"},Bh={class:"Policy-kpi-kpi-body"},Wh={class:"Policy-kpi-kpi-visualization"},Qh={class:"Policy-kpi-donut-chart-container"},qh={ref:"revisionDonutChart"},Kh={class:"Policy-kpi-donut-center-text"},Jh={class:"Policy-kpi-kpi-value"},zh={class:"Policy-kpi-kpi-details"},Hh={class:"Policy-kpi-detail-item"},Yh={class:"Policy-kpi-detail-value"},Gh={class:"Policy-kpi-detail-item"},Zh={class:"Policy-kpi-detail-value"},eg={class:"Policy-kpi-detail-item"},ag={class:"Policy-kpi-detail-value"},tg={class:"Policy-kpi-kpi-card"},ig={class:"Policy-kpi-kpi-body"},sg={class:"Policy-kpi-kpi-visualization"},og={class:"Policy-kpi-approval-time-chart-container"},lg={ref:"approvalTimeChart"},ng={class:"Policy-kpi-kpi-details"},rg={class:"Policy-kpi-detail-item"},cg={class:"Policy-kpi-detail-value"},dg={class:"Policy-kpi-trend-section"},ug={class:"Policy-kpi-trend-header"},pg={class:"Policy-kpi-kpi-card"},vg={class:"Policy-kpi-kpi-body"},mg={class:"Policy-kpi-compliance-container"},kg={class:"Policy-kpi-policy-selector"},hg=["value"],gg={key:0,class:"Policy-kpi-compliance-loading"},yg={key:1,class:"Policy-kpi-compliance-error"},fg={key:2,class:"Policy-kpi-compliance-content"},bg={class:"Policy-kpi-compliance-overview"},Cg={class:"Policy-kpi-policy-name"},Lg={class:"Policy-kpi-total-items"},wg={class:"Policy-kpi-compliance-chart"},Eg={class:"Policy-kpi-simple-bar-chart"},Rg={class:"Policy-kpi-horizontal-bars"},Dg={class:"Policy-kpi-chart-bar"},Ig={class:"Policy-kpi-bar-info"},Pg={class:"Policy-kpi-bar-percentage"},_g={class:"Policy-kpi-bar-track"},Sg={class:"Policy-kpi-chart-bar"},Ag={class:"Policy-kpi-bar-info"},Tg={class:"Policy-kpi-bar-percentage"},xg={class:"Policy-kpi-bar-track"},Fg={class:"Policy-kpi-chart-bar"},Vg={class:"Policy-kpi-bar-info"},Mg={class:"Policy-kpi-bar-percentage"},Xg={class:"Policy-kpi-bar-track"},Ug={key:3,class:"Policy-kpi-no-policy-selected"},Ng={key:3,class:"Policy-kpi-modal"},$g={class:"Policy-kpi-modal-content"},Og={class:"Policy-kpi-modal-header"},jg={class:"Policy-kpi-modal-body"},Bg={class:"Policy-kpi-revised-policies-stats"},Wg={class:"Policy-kpi-stat-item"},Qg={class:"Policy-kpi-stat-value"},qg={class:"Policy-kpi-stat-item"},Kg={class:"Policy-kpi-stat-value"};function Jg(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",qk,[(0,s.Lk)("div",Kk,[a[7]||(a[7]=(0,s.Lk)("h1",null,"Policy KPI Dashboard",-1)),(0,s.Lk)("button",{class:(0,d.C4)(["Policy-kpi-refresh-button",{"Policy-kpi-loading":o.loading}]),onClick:a[0]||(a[0]=(...e)=>o.fetchKPIData&&o.fetchKPIData(...e))},a[6]||(a[6]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,s.eW)(" Refresh ")]),2)]),o.loading?((0,s.uX)(),(0,s.CE)("div",Jk,a[8]||(a[8]=[(0,s.Lk)("div",{class:"Policy-kpi-loader"},null,-1),(0,s.Lk)("p",null,"Loading KPI data...",-1)]))):o.error?((0,s.uX)(),(0,s.CE)("div",zk,[a[10]||(a[10]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("p",null,(0,d.v_)(o.error),1),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>o.fetchKPIData&&o.fetchKPIData(...e)),class:"Policy-kpi-retry-button"},a[9]||(a[9]=[(0,s.Lk)("i",{class:"fas fa-redo"},null,-1),(0,s.eW)(" Retry ")]))])):((0,s.uX)(),(0,s.CE)("div",Hk,[(0,s.Lk)("div",Yk,[(0,s.Lk)("div",Gk,[(0,s.Lk)("div",Zk,[a[19]||(a[19]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})]),(0,s.Lk)("h3",null,"Active Policies")],-1)),(0,s.Lk)("div",eh,[(0,s.Lk)("div",ah,[(0,s.Lk)("div",{class:"Policy-kpi-circular-progress",style:(0,d.Tr)({"--progress-color":o.getProgressColor,"--progress-value":3.6*o.progressPercentage+"deg"})},[(0,s.Lk)("div",th,[(0,s.Lk)("div",ih,(0,d.v_)(o.kpiData.active_policies||0),1),a[11]||(a[11]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-label"},"Active",-1))])],4),(0,s.Lk)("div",sh,[(0,s.Lk)("div",oh,[a[12]||(a[12]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Total Policies"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Total number of policies in the system"})],-1)),(0,s.Lk)("span",lh,(0,d.v_)(o.kpiData.total_policies||0),1)]),(0,s.Lk)("div",nh,[a[13]||(a[13]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Active Rate"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Percentage of total policies that are currently active"})],-1)),(0,s.Lk)("span",rh,(0,d.v_)(o.getUtilizationRate)+"%",1)]),(0,s.Lk)("div",ch,[(0,s.Lk)("div",dh,[a[14]||(a[14]=(0,s.Lk)("span",{class:"Policy-kpi-trend-label"},"12 Month Trend",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["Policy-kpi-trend-indicator",o.trendDirection])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas","up"===o.trendDirection?"fa-arrow-up":"down"===o.trendDirection?"fa-arrow-down":"fa-minus"])},null,2)],2)]),a[15]||(a[15]=(0,s.Lk)("div",{class:"Policy-kpi-sparkline-container"},[(0,s.Lk)("canvas",{id:"trendChart"})],-1))]),(0,s.Lk)("div",uh,[a[18]||(a[18]=(0,s.Lk)("div",{class:"Policy-kpi-status-title"},"Status Breakdown",-1)),(0,s.Lk)("div",ph,[a[16]||(a[16]=(0,s.Lk)("span",{class:"Policy-kpi-status-label"},[(0,s.Lk)("span",{class:"Policy-kpi-status-dot Policy-kpi-active"}),(0,s.eW)(" Active ")],-1)),(0,s.Lk)("span",vh,(0,d.v_)(o.kpiData.active_policies||0),1)]),(0,s.Lk)("div",mh,[a[17]||(a[17]=(0,s.Lk)("span",{class:"Policy-kpi-status-label"},[(0,s.Lk)("span",{class:"Policy-kpi-status-dot Policy-kpi-inactive"}),(0,s.eW)(" Inactive ")],-1)),(0,s.Lk)("span",kh,(0,d.v_)(o.getInactivePolicies),1)])])])])])]),(0,s.Lk)("div",hh,[a[21]||(a[21]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})]),(0,s.Lk)("h3",null,"Policy Acknowledgement Rate")],-1)),(0,s.Lk)("div",gh,[(0,s.Lk)("div",yh,[a[20]||(a[20]=(0,s.Lk)("div",{class:"Policy-kpi-table-header"},[(0,s.Lk)("span",null,"Policy Name"),(0,s.Lk)("span",null,"Acknowledgement Rate")],-1)),(0,s.Lk)("div",fh,[o.kpiData.top_acknowledged_policies?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.kpiData.top_acknowledged_policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.policy_id,class:"Policy-kpi-table-row"},[(0,s.Lk)("div",bh,[(0,s.Lk)("span",Ch,(0,d.v_)(e.policy_name),1),(0,s.Lk)("div",Lh,[(0,s.Lk)("span",wh,(0,d.v_)(e.acknowledged_count),1),(0,s.Lk)("span",Eh,"/ "+(0,d.v_)(e.total_users),1)])]),(0,s.Lk)("div",Rh,[(0,s.Lk)("div",Dh,[(0,s.Lk)("div",{class:(0,d.C4)(["Policy-kpi-progress-fill",o.getAcknowledgementClass(e.acknowledgement_rate)]),style:(0,d.Tr)({width:e.acknowledgement_rate+"%"})},null,6)]),(0,s.Lk)("span",Ih,(0,d.v_)(e.acknowledgement_rate)+"%",1)])]))),128)):((0,s.uX)(),(0,s.CE)("div",Ph," No acknowledgement data available "))])])])]),(0,s.Lk)("div",_h,[a[24]||(a[24]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-chart-bar"})]),(0,s.Lk)("h3",null,"Policy Coverage Rate")],-1)),(0,s.Lk)("div",Sh,[(0,s.Lk)("div",Ah,[(0,s.Lk)("div",Th,[(0,s.Lk)("div",xh,[a[22]||(a[22]=(0,s.Lk)("div",{class:"Policy-kpi-overall-label"},"Average Coverage",-1)),(0,s.Lk)("div",Fh,(0,d.v_)(o.kpiData.coverage_metrics?.overall_coverage_rate||0)+"%",1)])]),(0,s.Lk)("div",Vh,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.coverage_metrics?.department_coverage||[],e=>((0,s.uX)(),(0,s.CE)("div",{key:e.department,class:"Policy-kpi-coverage-bar-row"},[(0,s.Lk)("div",Mh,[(0,s.Lk)("span",Xh,(0,d.v_)(e.department),1),(0,s.Lk)("span",Uh,(0,d.v_)(e.coverage_rate)+"%",1)]),(0,s.Lk)("div",Nh,[a[23]||(a[23]=(0,s.Lk)("div",{class:"Policy-kpi-bar-background"},null,-1)),(0,s.Lk)("div",{class:"Policy-kpi-bar-fill",style:(0,d.Tr)({width:e.coverage_rate+"%",backgroundColor:o.getCoverageColor(e.coverage_rate)})},null,4)]),(0,s.Lk)("div",$h,(0,d.v_)(e.total_policies)+" policies",1)]))),128))])])])])]),(0,s.Lk)("div",Oh,[(0,s.Lk)("div",jh,[a[30]||(a[30]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-sync"})]),(0,s.Lk)("h3",null,"Policy Revision Rate")],-1)),(0,s.Lk)("div",Bh,[(0,s.Lk)("div",Wh,[(0,s.Lk)("div",Qh,[(0,s.Lk)("canvas",qh,null,512),(0,s.Lk)("div",Kh,[(0,s.Lk)("div",Jh,(0,d.v_)((o.kpiData.revision_rate||0).toFixed(2))+"%",1),a[25]||(a[25]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-label"},"Revised",-1))])]),(0,s.Lk)("div",zh,[(0,s.Lk)("div",Hh,[a[26]||(a[26]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Revised Policies"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Number of policies that have been revised"})],-1)),(0,s.Lk)("span",Yh,(0,d.v_)(o.kpiData.revised_policies||0),1)]),(0,s.Lk)("div",Gh,[a[27]||(a[27]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Unchanged Policies"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Number of policies that have not been revised"})],-1)),(0,s.Lk)("span",Zh,(0,d.v_)(o.unchangedPolicies),1)]),(0,s.Lk)("div",eg,[a[28]||(a[28]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Time Period"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Time period for revision rate calculation"})],-1)),(0,s.Lk)("span",ag,(0,d.v_)(o.kpiData.measurement_period||"Last Quarter"),1)]),o.kpiData.revised_policies>0?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a[2]||(a[2]=e=>o.showRevisedPolicies=!0),class:"Policy-kpi-drill-down-button"},a[29]||(a[29]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View Revised Policies ")]))):(0,s.Q3)("",!0)])])])]),(0,s.Lk)("div",tg,[a[34]||(a[34]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})]),(0,s.Lk)("h3",null,"Average Policy Approval Time")],-1)),(0,s.Lk)("div",ig,[(0,s.Lk)("div",sg,[(0,s.Lk)("div",og,[(0,s.Lk)("canvas",lg,null,512)]),(0,s.Lk)("div",ng,[(0,s.Lk)("div",rg,[a[31]||(a[31]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Overall Average"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Average time taken to approve policies"})],-1)),(0,s.Lk)("span",cg,(0,d.v_)(o.kpiData.approval_time_metrics?.overall_average||0)+" days",1)]),a[33]||(a[33]=(0,s.Fv)('<div class="Policy-kpi-detail-item" data-v-0138cb69><div class="Policy-kpi-detail-info" data-v-0138cb69><span class="Policy-kpi-detail-label" data-v-0138cb69>Measurement Period</span><i class="fas fa-info-circle Policy-kpi-info-icon" title="Time period for approval time calculation" data-v-0138cb69></i></div><span class="Policy-kpi-detail-value" data-v-0138cb69>Last 12 Months</span></div>',1)),(0,s.Lk)("div",dg,[(0,s.Lk)("div",ug,[a[32]||(a[32]=(0,s.Lk)("span",{class:"Policy-kpi-trend-label"},"Monthly Trend",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["Policy-kpi-trend-indicator",o.approvalTimeTrendDirection])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas","up"===o.approvalTimeTrendDirection?"fa-arrow-up":"down"===o.approvalTimeTrendDirection?"fa-arrow-down":"fa-minus"])},null,2)],2)])])])])])]),(0,s.Lk)("div",pg,[a[44]||(a[44]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-tasks"})]),(0,s.Lk)("h3",null,"Policy Compliance Status")],-1)),(0,s.Lk)("div",vg,[(0,s.Lk)("div",mg,[(0,s.Lk)("div",kg,[a[36]||(a[36]=(0,s.Lk)("label",{for:"policySelect"},"Select Policy:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>o.selectedPolicyId=e),onChange:a[4]||(a[4]=(...e)=>o.fetchComplianceData&&o.fetchComplianceData(...e)),id:"policySelect",class:"Policy-kpi-policy-dropdown"},[a[35]||(a[35]=(0,s.Lk)("option",{value:""},"-- Select a Policy --",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.availablePolicies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.PolicyId,value:e.PolicyId},(0,d.v_)(e.PolicyName),9,hg))),128))],544),[[i.u1,o.selectedPolicyId]])]),o.complianceLoading?((0,s.uX)(),(0,s.CE)("div",gg,a[37]||(a[37]=[(0,s.Lk)("div",{class:"Policy-kpi-small-loader"},null,-1),(0,s.Lk)("p",null,"Loading compliance data...",-1)]))):o.complianceError?((0,s.uX)(),(0,s.CE)("div",yg,[a[38]||(a[38]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("p",null,(0,d.v_)(o.complianceError),1)])):o.complianceData&&o.complianceData.policy_name?((0,s.uX)(),(0,s.CE)("div",fg,[(0,s.Lk)("div",bg,[(0,s.Lk)("div",Cg,(0,d.v_)(o.complianceData.policy_name),1),(0,s.Lk)("div",Lg,"Total Items: "+(0,d.v_)(o.complianceData.total_compliance_items),1)]),(0,s.Lk)("div",wg,[(0,s.Lk)("div",Eg,[a[42]||(a[42]=(0,s.Lk)("div",{class:"Policy-kpi-chart-title"},"Compliance Distribution",-1)),(0,s.Lk)("div",Rg,[(0,s.Lk)("div",Dg,[(0,s.Lk)("div",Ig,[a[39]||(a[39]=(0,s.Lk)("span",{class:"Policy-kpi-bar-name"},"âœ“ Fully Complied",-1)),(0,s.Lk)("span",Pg,(0,d.v_)(o.complianceData.compliance_stats?.fully_complied?.count||0)+" ("+(0,d.v_)(o.complianceData.compliance_stats?.fully_complied?.percentage||0)+"%)",1)]),(0,s.Lk)("div",_g,[(0,s.Lk)("div",{class:"Policy-kpi-bar-progress Policy-kpi-green",style:(0,d.Tr)({width:(o.complianceData.compliance_stats?.fully_complied?.percentage||0)+"%"})},null,4)])]),(0,s.Lk)("div",Sg,[(0,s.Lk)("div",Ag,[a[40]||(a[40]=(0,s.Lk)("span",{class:"Policy-kpi-bar-name"},"â–³ Partially Complied",-1)),(0,s.Lk)("span",Tg,(0,d.v_)(o.complianceData.compliance_stats?.partially_complied?.count||0)+" ("+(0,d.v_)(o.complianceData.compliance_stats?.partially_complied?.percentage||0)+"%)",1)]),(0,s.Lk)("div",xg,[(0,s.Lk)("div",{class:"Policy-kpi-bar-progress Policy-kpi-orange",style:(0,d.Tr)({width:(o.complianceData.compliance_stats?.partially_complied?.percentage||0)+"%"})},null,4)])]),(0,s.Lk)("div",Fg,[(0,s.Lk)("div",Vg,[a[41]||(a[41]=(0,s.Lk)("span",{class:"Policy-kpi-bar-name"},"âœ— Not Complied",-1)),(0,s.Lk)("span",Mg,(0,d.v_)(o.complianceData.compliance_stats?.not_complied?.count||0)+" ("+(0,d.v_)(o.complianceData.compliance_stats?.not_complied?.percentage||0)+"%)",1)]),(0,s.Lk)("div",Xg,[(0,s.Lk)("div",{class:"Policy-kpi-bar-progress Policy-kpi-red",style:(0,d.Tr)({width:(o.complianceData.compliance_stats?.not_complied?.percentage||0)+"%"})},null,4)])])])])])])):((0,s.uX)(),(0,s.CE)("div",Ug,a[43]||(a[43]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.Lk)("p",null,"Please select a policy to view compliance statistics",-1)])))])])])])])])),o.showRevisedPolicies?((0,s.uX)(),(0,s.CE)("div",Ng,[(0,s.Lk)("div",$g,[(0,s.Lk)("div",Og,[a[46]||(a[46]=(0,s.Lk)("h2",null,"Revised Policies",-1)),(0,s.Lk)("button",{onClick:a[5]||(a[5]=e=>o.showRevisedPolicies=!1),class:"Policy-kpi-close-button"},a[45]||(a[45]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",jg,[(0,s.Lk)("div",Bg,[(0,s.Lk)("div",Wg,[a[47]||(a[47]=(0,s.Lk)("span",{class:"Policy-kpi-stat-label"},"Total Revisions:",-1)),(0,s.Lk)("span",Qg,(0,d.v_)(o.kpiData.total_revisions),1)]),(0,s.Lk)("div",qg,[a[48]||(a[48]=(0,s.Lk)("span",{class:"Policy-kpi-stat-label"},"Policies with Multiple Revisions:",-1)),(0,s.Lk)("span",Kg,(0,d.v_)(o.kpiData.policies_with_multiple_revisions),1)])])])])])):(0,s.Q3)("",!0)])}var zg=t(6591),Hg={name:"KPIDashboard",setup(){const e=(0,ee.KR)({}),a=(0,ee.KR)(!0),t=(0,ee.KR)(null),i=(0,ee.KR)(null),o=(0,ee.KR)(null),l=(0,ee.KR)(null),n=(0,ee.KR)(!1),r=(0,ee.KR)(null),c=(0,ee.KR)(""),d=(0,ee.KR)([]),u=(0,ee.KR)({}),p=(0,ee.KR)(!1),v=(0,ee.KR)(null),m=(0,s.EW)(()=>e.value.total_policies?Math.min(e.value.active_policies/e.value.total_policies*100,100):0),k=(0,s.EW)(()=>e.value.total_policies?Math.round(e.value.active_policies/e.value.total_policies*100):0),h=(0,s.EW)(()=>e.value.total_policies?e.value.total_policies-(e.value.active_policies||0):0),g=(0,s.EW)(()=>{const a=e.value.revision_rate||0;return a>66?"#66BB6A":a>33?"#FFA726":"#2196F3"}),y=e=>e>=80?"high":e>=50?"medium":"low",f=(0,s.EW)(()=>e.value.total_policies&&e.value.revised_policies?e.value.total_policies-e.value.revised_policies:0),b=e=>e>=90?"#66BB6A":e>=70?"#FFA726":"#EF5350",C=e=>{const a=e||0;return 0===a?"0%":Math.max(a,5)+"%"},L=(0,s.EW)(()=>{if(!e.value?.approval_time_metrics?.monthly_averages)return"neutral";const a=e.value.approval_time_metrics.monthly_averages;if(a.length<2)return"neutral";const t=a[0].average_time,i=a[a.length-1].average_time;return i>t?"up":i<t?"down":"neutral"}),w=async()=>{if(await(0,s.dY)(),o.value){i.value&&i.value.destroy();try{const a=o.value.getContext("2d");i.value=new zg.Ay(a,{type:"doughnut",data:{labels:["Revised","Unchanged"],datasets:[{data:[e.value.revised_policies||0,f.value],backgroundColor:["#2196F3","#e9ecef"],borderWidth:0,borderRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"75%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(a){const t=a.label||"",i=a.raw||0,s=e.value.total_policies||0,o=(i/s*100).toFixed(1);return`${t}: ${i} (${o}%)`}}}}}})}catch(a){console.error("Error creating chart:",a)}}else console.warn("Canvas element not found")},E=async()=>{await(0,s.dY)();const a=document.querySelector(".Policy-kpi-approval-time-chart-container canvas");if(!a)return;r.value instanceof zg.Ay&&r.value.destroy();const t=e.value?.approval_time_metrics?.monthly_averages||[];try{r.value=new zg.Ay(a,{type:"line",data:{labels:t.map(e=>e.month),datasets:[{label:"Average Approval Time (days)",data:t.map(e=>e.average_time),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",borderWidth:2,tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{title:e=>e[0].label,label:e=>`Average Time: ${e.raw} days`}}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,title:{display:!0,text:"Days"}}}}})}catch(i){console.error("Error creating approval time chart:",i)}};(0,s.wB)([()=>e.value,a],async([e,a])=>{if(!a&&!t.value&&e)try{await Promise.all([w(),E()])}catch(i){console.error("Error updating charts:",i)}},{deep:!0}),(0,s.hi)(()=>{r.value instanceof zg.Ay&&r.value.destroy(),i.value instanceof zg.Ay&&i.value.destroy()});const R=async()=>{try{const e=await qe.A.get("/api/policies/",{baseURL:"http://localhost:8000",headers:{Accept:"application/json","Content-Type":"application/json"}});e.data&&Array.isArray(e.data)&&(d.value=e.data)}catch(e){console.error("Error fetching policies:",e)}},D=async()=>{if(c.value){p.value=!0,v.value=null;try{const e=await qe.A.get(`/api/policies/${c.value}/compliance-stats/`,{baseURL:"http://localhost:8000",headers:{Accept:"application/json","Content-Type":"application/json"}});u.value=e.data}catch(e){console.error("Error fetching compliance data:",e),v.value=e.response?.data?.error||"Failed to load compliance data"}finally{p.value=!1}}else u.value={}},I=async()=>{a.value=!0,t.value=null;try{console.log("Fetching KPI data...");const a=await qe.A.get("/api/policy-kpis/",{baseURL:"http://localhost:8000",headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("KPI data received:",a.data),!a.data||"object"!==typeof a.data)throw new Error("Invalid response format");e.value=a.data,await w()}catch(i){console.error("Detailed error:",i.response?.data||i.message),t.value=`Failed to load KPI data: ${i.response?.data?.error||i.message}`}finally{a.value=!1}},P=(0,s.EW)(()=>e.value?.active_policies_trend?e.value.active_policies_trend.map(e=>e.count).reverse():[]),_=(0,s.EW)(()=>e.value?.active_policies_trend?e.value.active_policies_trend.map(e=>e.month).reverse():[]),S=(0,s.EW)(()=>{if(!P.value.length)return"neutral";const e=P.value[0],a=P.value[P.value.length-1];return a>e?"up":a<e?"down":"neutral"}),A=async()=>{await(0,s.dY)(),l.value&&l.value.destroy();const e=document.getElementById("trendChart");e&&(l.value=new zg.Ay(e,{type:"line",data:{labels:_.value,datasets:[{data:P.value,borderColor:g.value,borderWidth:2,tension:.4,fill:!1,pointRadius:0,pointHoverRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{title:e=>e[0].label,label:e=>`Active Policies: ${e.raw}`}}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}}))};return(0,s.wB)(()=>e.value,()=>{A()}),(0,s.sV)(async()=>{await Promise.all([I(),R()])}),{kpiData:e,loading:a,error:t,fetchKPIData:I,progressPercentage:m,getProgressColor:g,getUtilizationRate:k,getInactivePolicies:h,unchangedPolicies:f,revisionDonutChart:o,showRevisedPolicies:n,getCoverageColor:b,sparklineData:P,sparklineLabels:_,trendDirection:S,getAcknowledgementClass:y,approvalTimeChart:r,approvalTimeTrendDirection:L,selectedPolicyId:c,availablePolicies:d,complianceData:u,complianceLoading:p,complianceError:v,fetchComplianceData:D,getBarWidth:C}}};const Yg=(0,se.A)(Hg,[["render",Jg],["__scopeId","data-v-0138cb69"]]);var Gg=Yg;const Zg={class:"dashboard-container"},ey={class:"dashboard-header"},ay={class:"dashboard-actions"},ty={class:"performance-summary"},iy={class:"summary-card growth"},sy={class:"summary-content"},oy={class:"summary-value"},ly={class:"summary-card"},ny={class:"summary-content"},ry={class:"summary-value"},cy={class:"summary-card"},dy={class:"summary-content"},uy={class:"summary-value"},py={class:"approvals-container"},vy={key:3,class:"empty-state"},my={key:0,class:"framework-details-modal"},ky={class:"framework-details-content"},hy={class:"version-pill"},gy={class:"framework-approval-section"},yy={class:"framework-status-indicator"},fy={key:0,class:"approval-date"},by={class:"framework-actions"},Cy={key:0},Ly={key:1,class:"policies-section"},wy={class:"policy-header"},Ey={class:"policy-name"},Ry={class:"policy-header-actions"},Dy={key:0,class:"policy-actions"},Iy=["onClick","disabled","title"],Py=["onClick"],_y={class:"policy-details"},Sy={class:"policy-detail-item"},Ay={key:0,class:"policy-detail-item"},Ty={key:1,class:"policy-detail-item"},xy={key:2,class:"policy-detail-item"},Fy={key:3,class:"policy-detail-item"},Vy={key:4,class:"policy-detail-item"},My={key:5,class:"policy-detail-item"},Xy={key:6,class:"policy-detail-item"},Uy={key:7,class:"policy-detail-item"},Ny={key:8,class:"policy-detail-item"},$y={key:0,class:"subpolicies-section"},Oy={class:"subpolicy-header"},jy={class:"subpolicy-name"},By={class:"subpolicy-header-actions"},Wy={key:0,class:"subpolicy-actions"},Qy=["onClick","disabled"],qy=["onClick","disabled"],Ky={class:"subpolicy-details"},Jy={class:"subpolicy-detail-item"},zy={key:0,class:"subpolicy-detail-item"},Hy={key:1,class:"subpolicy-detail-item"},Yy={class:"framework-approval-summary"},Gy={class:"approval-summary-item"},Zy={key:0,class:"framework-final-actions"},ef={key:2,class:"policies-section"},af={class:"policies-list"},tf={class:"policy-name"},sf={key:3,class:"rejected-framework-message"},of={key:0,class:"reject-modal"},lf={class:"reject-modal-content"},nf={class:"reject-modal-actions"},rf={key:1,class:"rejected-approvals-listt"},cf=["title"],df={class:"status-badge status-rejected"},uf=["onClick"],pf={key:2,class:"edit-framework-modal"},vf={class:"edit-framework-content"},mf={key:0},kf={class:"rejection-reason"},hf={key:1,class:"edit-policies-section"},gf={class:"form-row"},yf={class:"form-group"},ff=["onUpdate:modelValue"],bf={class:"form-group"},Cf=["onUpdate:modelValue"],Lf={class:"form-row"},wf={class:"form-group"},Ef=["onUpdate:modelValue"],Rf={class:"form-group"},Df=["onUpdate:modelValue"],If={class:"form-row"},Pf={class:"form-group"},_f=["onUpdate:modelValue","onChange"],Sf=["value"],Af={class:"form-group"},Tf=["onUpdate:modelValue","onChange"],xf=["value"],Ff={class:"form-row"},Vf={class:"form-group"},Mf=["onUpdate:modelValue"],Xf=["value"],Uf={key:0,class:"edit-subpolicies-section"},Nf={class:"form-row"},$f={class:"form-group"},Of=["onUpdate:modelValue"],jf={class:"form-group"},Bf=["onUpdate:modelValue"],Wf={class:"form-row"},Qf={class:"form-group"},qf=["onUpdate:modelValue"],Kf={class:"form-group"},Jf=["onUpdate:modelValue"];function zf(e,a,t,o,l,n){const r=(0,s.g2)("CollapsibleTable"),c=(0,s.g2)("DynamicTable"),u=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Zg,[(0,s.Lk)("div",ey,[a[23]||(a[23]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Framework Approver",-1)),(0,s.Lk)("div",ay,[(0,s.Lk)("button",{class:"action-btn",onClick:a[0]||(a[0]=(...e)=>n.refreshData&&n.refreshData(...e))},a[21]||(a[21]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),a[22]||(a[22]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",ty,[(0,s.Lk)("div",iy,[a[25]||(a[25]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",sy,[a[24]||(a[24]=(0,s.Lk)("div",{class:"summary-label"},"Pending Approvals",-1)),(0,s.Lk)("div",oy,(0,d.v_)(n.pendingApprovalsCount),1)])]),(0,s.Lk)("div",ly,[a[27]||(a[27]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",ny,[a[26]||(a[26]=(0,s.Lk)("div",{class:"summary-label"},"Approved",-1)),(0,s.Lk)("div",ry,(0,d.v_)(n.approvedApprovalsCount),1)])]),(0,s.Lk)("div",cy,[a[29]||(a[29]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",dy,[a[28]||(a[28]=(0,s.Lk)("div",{class:"summary-label"},"Rejected",-1)),(0,s.Lk)("div",uy,(0,d.v_)(n.rejectedApprovalsCount),1)])])]),(0,s.Lk)("div",py,[a[31]||(a[31]=(0,s.Lk)("h3",null,"My Framework Approval Tasks",-1)),n.pendingFrameworks.length>0?((0,s.uX)(),(0,s.Wv)(r,{key:0,"section-config":n.pendingSectionConfig,"table-headers":l.tableHeaders,"is-expanded":l.sectionExpansion.pending,pagination:n.pendingPagination,"on-next-page":()=>n.handlePendingPageChange(l.pendingPage+1),"on-prev-page":()=>n.handlePendingPageChange(l.pendingPage-1),onToggle:a[1]||(a[1]=e=>n.toggleSection("pending")),onTaskClick:n.handleTaskClick},null,8,["section-config","table-headers","is-expanded","pagination","on-next-page","on-prev-page","onTaskClick"])):(0,s.Q3)("",!0),n.approvedFrameworks.length>0?((0,s.uX)(),(0,s.Wv)(r,{key:1,"section-config":n.approvedSectionConfig,"table-headers":l.tableHeaders,"is-expanded":l.sectionExpansion.approved,pagination:n.approvedPagination,"on-next-page":()=>n.handleApprovedPageChange(l.approvedPage+1),"on-prev-page":()=>n.handleApprovedPageChange(l.approvedPage-1),onToggle:a[2]||(a[2]=e=>n.toggleSection("approved")),onTaskClick:n.handleTaskClick},null,8,["section-config","table-headers","is-expanded","pagination","on-next-page","on-prev-page","onTaskClick"])):(0,s.Q3)("",!0),n.rejectedFrameworksForTable.length>0?((0,s.uX)(),(0,s.Wv)(r,{key:2,"section-config":n.rejectedSectionConfig,"table-headers":l.tableHeaders,"is-expanded":l.sectionExpansion.rejected,pagination:n.rejectedPagination,"on-next-page":()=>n.handleRejectedPageChange(l.rejectedPage+1),"on-prev-page":()=>n.handleRejectedPageChange(l.rejectedPage-1),onToggle:a[3]||(a[3]=e=>n.toggleSection("rejected")),onTaskClick:n.handleTaskClick},null,8,["section-config","table-headers","is-expanded","pagination","on-next-page","on-prev-page","onTaskClick"])):(0,s.Q3)("",!0),0===n.sortedFrameworks.length?((0,s.uX)(),(0,s.CE)("div",vy,a[30]||(a[30]=[(0,s.Lk)("div",{class:"empty-state-content"},[(0,s.Lk)("i",{class:"fas fa-inbox"}),(0,s.Lk)("h4",null,"No Framework Approval Tasks"),(0,s.Lk)("p",null,"There are currently no frameworks awaiting your approval.")],-1)]))):(0,s.Q3)("",!0)]),l.showFrameworkDetails&&l.selectedApproval?((0,s.uX)(),(0,s.CE)("div",my,[(0,s.Lk)("div",ky,[(0,s.Lk)("span",{class:"close-x",onClick:a[4]||(a[4]=(...e)=>n.closeApprovalDetails&&n.closeApprovalDetails(...e)),title:"Close"},"Ã—"),(0,s.Lk)("h3",null,[a[32]||(a[32]=(0,s.Lk)("span",{class:"detail-type-indicator"},"Framework",-1)),(0,s.eW)(" Details: "+(0,d.v_)(n.getFrameworkId(l.selectedApproval))+" ",1),(0,s.Lk)("span",hy,"Version: "+(0,d.v_)(l.selectedApproval.version||"u1"),1)]),(0,s.Lk)("div",gy,[a[37]||(a[37]=(0,s.Lk)("h4",null,"Framework Approval",-1)),(0,s.Lk)("div",yy,[a[33]||(a[33]=(0,s.Lk)("span",{class:"status-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",{"status-approved":!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status,"status-rejected":!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status,"status-pending":null===l.selectedApproval.ApprovedNot&&"Approved"!==l.selectedApproval.ExtractedData?.Status&&"Rejected"!==l.selectedApproval.ExtractedData?.Status}])},(0,d.v_)(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status?"Approved":!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status?"Rejected":"Under Review"),3),l.selectedApproval.ApprovedDate?((0,s.uX)(),(0,s.CE)("span",fy," (Approved on: "+(0,d.v_)(n.formatDate(l.selectedApproval.ApprovedDate))+") ",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",by,[l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"approve-btn",onClick:a[5]||(a[5]=e=>n.approveFramework())},a[34]||(a[34]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve ")]))):(0,s.Q3)("",!0),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"reject-btn",onClick:a[6]||(a[6]=e=>n.rejectFramework())},a[35]||(a[35]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject ")]))):(0,s.Q3)("",!0),l.isReviewer&&null!==l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"submit-btn",onClick:a[7]||(a[7]=e=>n.submitReview())},a[36]||(a[36]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.eW)(" Submit Review ")]))):(0,s.Q3)("",!0)])]),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",Cy,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.ExtractedData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"framework-detail-row"},["policies"!==t&&"framework_approval"!==t&&"type"!==t&&"totalPolicies"!==t&&"totalSubpolicies"!==t?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("strong",null,(0,d.v_)(n.formatFieldName(t))+":",1),a[38]||(a[38]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(e),1)],64)):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),l.selectedApproval.ExtractedData?.policies&&l.selectedApproval.ExtractedData.policies.length>0?((0,s.uX)(),(0,s.CE)("div",Ly,[(0,s.Lk)("h4",null,"Framework Policies ("+(0,d.v_)(l.selectedApproval.ExtractedData.totalPolicies||l.selectedApproval.ExtractedData.policies.length)+")",1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.ExtractedData.policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.PolicyId,class:"policy-item-detailed"},[(0,s.Lk)("div",wy,[(0,s.Lk)("h5",Ey,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("div",Ry,[(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{"status-approved":"Approved"===e.Status,"status-rejected":"Rejected"===e.Status,"status-pending":"Under Review"===e.Status}])},(0,d.v_)(e.Status),3),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",Dy,[(0,s.Lk)("button",{class:"approve-policy-btn",onClick:a=>n.approvePolicy(e),disabled:!n.canApprovePolicy(e),title:n.canApprovePolicy(e)?"Approve Policy":"All subpolicies must be approved first"},a[39]||(a[39]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]),8,Iy),(0,s.Lk)("button",{class:"reject-policy-btn",onClick:a=>n.rejectPolicy(e)},a[40]||(a[40]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,Py)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",_y,[(0,s.Lk)("div",Sy,[a[41]||(a[41]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.PolicyDescription),1)]),e.Objective?((0,s.uX)(),(0,s.CE)("div",Ay,[a[42]||(a[42]=(0,s.Lk)("strong",null,"Objective:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Objective),1)])):(0,s.Q3)("",!0),e.Scope?((0,s.uX)(),(0,s.CE)("div",Ty,[a[43]||(a[43]=(0,s.Lk)("strong",null,"Scope:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Scope),1)])):(0,s.Q3)("",!0),e.Department?((0,s.uX)(),(0,s.CE)("div",xy,[a[44]||(a[44]=(0,s.Lk)("strong",null,"Department:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Department),1)])):(0,s.Q3)("",!0),e.Applicability?((0,s.uX)(),(0,s.CE)("div",Fy,[a[45]||(a[45]=(0,s.Lk)("strong",null,"Applicability:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Applicability),1)])):(0,s.Q3)("",!0),e.Identifier?((0,s.uX)(),(0,s.CE)("div",Vy,[a[46]||(a[46]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Identifier),1)])):(0,s.Q3)("",!0),e.CoverageRate?((0,s.uX)(),(0,s.CE)("div",My,[a[47]||(a[47]=(0,s.Lk)("strong",null,"Coverage Rate:",-1)),(0,s.eW)(" "+(0,d.v_)(e.CoverageRate)+"% ",1)])):(0,s.Q3)("",!0),e.PolicyType?((0,s.uX)(),(0,s.CE)("div",Xy,[a[48]||(a[48]=(0,s.Lk)("strong",null,"Policy Type:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.PolicyType),1)])):(0,s.Q3)("",!0),e.PolicyCategory?((0,s.uX)(),(0,s.CE)("div",Uy,[a[49]||(a[49]=(0,s.Lk)("strong",null,"Policy Category:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.PolicyCategory),1)])):(0,s.Q3)("",!0),e.PolicySubCategory?((0,s.uX)(),(0,s.CE)("div",Ny,[a[50]||(a[50]=(0,s.Lk)("strong",null,"Policy Sub Category:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.PolicySubCategory),1)])):(0,s.Q3)("",!0)]),e.subpolicies&&e.subpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",$y,[(0,s.Lk)("h6",null,"Sub-Policies ("+(0,d.v_)(e.subpolicies.length)+")",1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,t=>((0,s.uX)(),(0,s.CE)("div",{key:t.SubPolicyId,class:"subpolicy-item"},[(0,s.Lk)("div",Oy,[(0,s.Lk)("span",jy,(0,d.v_)(t.SubPolicyName),1),(0,s.Lk)("div",By,[(0,s.Lk)("span",{class:(0,d.C4)(["subpolicy-status",{"status-approved":"Approved"===t.Status,"status-rejected":"Rejected"===t.Status,"status-pending":"Under Review"===t.Status}])},(0,d.v_)(t.Status),3),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",Wy,[(0,s.Lk)("button",{class:"approve-subpolicy-btn",onClick:a=>n.approveSubpolicy(e,t),disabled:"Approved"===t.Status},a[51]||(a[51]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]),8,Qy),(0,s.Lk)("button",{class:"reject-subpolicy-btn",onClick:a=>n.rejectSubpolicy(e,t),disabled:"Rejected"===t.Status},a[52]||(a[52]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,qy)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Ky,[(0,s.Lk)("div",Jy,[a[53]||(a[53]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(t.Description),1)]),t.Control?((0,s.uX)(),(0,s.CE)("div",zy,[a[54]||(a[54]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(t.Control),1)])):(0,s.Q3)("",!0),t.Identifier?((0,s.uX)(),(0,s.CE)("div",Hy,[a[55]||(a[55]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(t.Identifier),1)])):(0,s.Q3)("",!0)])]))),128))])):(0,s.Q3)("",!0)]))),128)),(0,s.Lk)("div",Yy,[(0,s.Lk)("div",Gy,[a[56]||(a[56]=(0,s.Lk)("strong",null,"Approval Status:",-1)),(0,s.Lk)("span",null,(0,d.v_)(n.getFrameworkApprovalStatus()),1)]),n.canApproveFramework()?((0,s.uX)(),(0,s.CE)("div",Zy,[(0,s.Lk)("button",{class:"approve-framework-btn",onClick:a[8]||(a[8]=e=>n.approveEntireFramework())},a[57]||(a[57]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Approve Entire Framework ")]))])):(0,s.Q3)("",!0)])])):!0===l.selectedApproval.ApprovedNot&&l.selectedApproval.policies&&l.selectedApproval.policies.length>0?((0,s.uX)(),(0,s.CE)("div",ef,[a[58]||(a[58]=(0,s.Lk)("h4",null,"Framework Policies",-1)),(0,s.Lk)("ul",af,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.policies,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.PolicyId,class:"policy-item"},[(0,s.Lk)("span",tf,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{"status-approved":"Approved"===e.Status,"status-rejected":"Rejected"===e.Status,"status-pending":"Under Review"===e.Status}])},(0,d.v_)(e.Status),3)]))),128))])])):(0,s.Q3)("",!0),!1===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",sf,a[59]||(a[59]=[(0,s.Lk)("div",{class:"rejection-note"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" This framework has been rejected. All policies and subpolicies within this framework have been automatically rejected. ")],-1)]))):(0,s.Q3)("",!0)]),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",of,[(0,s.Lk)("div",lf,[(0,s.Lk)("span",{class:"close-x",onClick:a[9]||(a[9]=(...e)=>n.cancelRejection&&n.cancelRejection(...e)),title:"Close"},"Ã—"),a[60]||(a[60]=(0,s.Lk)("h4",null,"Rejection Reason",-1)),(0,s.Lk)("p",null,"Please provide a reason for rejecting this "+(0,d.v_)(l.currentRejectionType),1),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[10]||(a[10]=e=>l.rejectionComment=e),class:"rejection-comment",placeholder:"Enter your comments here..."},null,512),[[i.Jo,l.rejectionComment]]),(0,s.Lk)("div",nf,[(0,s.Lk)("button",{class:"cancel-btn",onClick:a[11]||(a[11]=(...e)=>n.cancelRejection&&n.cancelRejection(...e))},"Cancel"),(0,s.Lk)("button",{class:"confirm-btn",onClick:a[12]||(a[12]=(...e)=>n.confirmRejection&&n.confirmRejection(...e))},"Confirm Rejection")])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),l.rejectedFrameworks.length?((0,s.uX)(),(0,s.CE)("div",rf,[a[63]||(a[63]=(0,s.Lk)("h3",null,"Rejected Frameworks (Edit & Resubmit)",-1)),(0,s.bF)(c,{data:l.rejectedFrameworksTableData,columns:l.rejectedFrameworksColumns,"show-actions":!0,"show-pagination":!0,"default-page-size":5,"unique-key":"FrameworkId",onRowSelect:n.handleRejectedFrameworkSelect},{"cell-rejectionReason":(0,s.k6)(({row:e})=>[(0,s.Lk)("span",{title:e.originalFramework.rejection_reason||"No reason provided",class:"rejection-reason-cell"},(0,d.v_)(e.rejectionReason),9,cf)]),"cell-status":(0,s.k6)(({row:e})=>[(0,s.Lk)("span",df,[a[61]||(a[61]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.status),1)])]),actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"view-btn",onClick:a=>n.openRejectedItem(e.originalFramework),title:"View and Edit Framework"},a[62]||(a[62]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,uf)]),_:1},8,["data","columns","onRowSelect"])])):(0,s.Q3)("",!0),l.showEditModal&&l.editingFramework?((0,s.uX)(),(0,s.CE)("div",pf,[(0,s.Lk)("div",vf,[(0,s.Lk)("h3",null,"Edit & Resubmit Framework: "+(0,d.v_)(n.getFrameworkId(l.editingFramework)),1),(0,s.Lk)("button",{class:"close-btn",onClick:a[13]||(a[13]=(...e)=>n.closeEditModal&&n.closeEditModal(...e))},"Close"),(0,s.Lk)("div",null,[a[64]||(a[64]=(0,s.Lk)("label",null,"Framework Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[14]||(a[14]=e=>l.editingFramework.ExtractedData.FrameworkName=e)},null,512),[[i.Jo,l.editingFramework.ExtractedData.FrameworkName]])]),(0,s.Lk)("div",null,[a[65]||(a[65]=(0,s.Lk)("label",null,"Framework Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[15]||(a[15]=e=>l.editingFramework.ExtractedData.FrameworkDescription=e)},null,512),[[i.Jo,l.editingFramework.ExtractedData.FrameworkDescription]])]),(0,s.Lk)("div",null,[a[66]||(a[66]=(0,s.Lk)("label",null,"Category:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[16]||(a[16]=e=>l.editingFramework.ExtractedData.Category=e)},null,512),[[i.Jo,l.editingFramework.ExtractedData.Category]])]),(0,s.Lk)("div",null,[a[67]||(a[67]=(0,s.Lk)("label",null,"Effective Date:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[17]||(a[17]=e=>l.editingFramework.ExtractedData.EffectiveDate=e)},null,512),[[i.Jo,l.editingFramework.ExtractedData.EffectiveDate]])]),(0,s.Lk)("div",null,[a[68]||(a[68]=(0,s.Lk)("label",null,"Start Date:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[18]||(a[18]=e=>l.editingFramework.ExtractedData.StartDate=e)},null,512),[[i.Jo,l.editingFramework.ExtractedData.StartDate]])]),(0,s.Lk)("div",null,[a[69]||(a[69]=(0,s.Lk)("label",null,"End Date:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[19]||(a[19]=e=>l.editingFramework.ExtractedData.EndDate=e)},null,512),[[i.Jo,l.editingFramework.ExtractedData.EndDate]])]),l.editingFramework.rejection_reason?((0,s.uX)(),(0,s.CE)("div",mf,[a[70]||(a[70]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",kf,(0,d.v_)(l.editingFramework.rejection_reason),1)])):(0,s.Q3)("",!0),l.editingFramework.ExtractedData.policies?((0,s.uX)(),(0,s.CE)("div",hf,[a[86]||(a[86]=(0,s.Lk)("h4",null,"Edit Policies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.editingFramework.ExtractedData.policies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"edit-policy-item"},[(0,s.Lk)("h5",null,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("div",gf,[(0,s.Lk)("div",yf,[a[71]||(a[71]=(0,s.Lk)("label",null,"Policy Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.PolicyName=a},null,8,ff),[[i.Jo,e.PolicyName]])]),(0,s.Lk)("div",bf,[a[72]||(a[72]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.PolicyDescription=a},null,8,Cf),[[i.Jo,e.PolicyDescription]])])]),(0,s.Lk)("div",Lf,[(0,s.Lk)("div",wf,[a[73]||(a[73]=(0,s.Lk)("label",null,"Objective:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Objective=a},null,8,Ef),[[i.Jo,e.Objective]])]),(0,s.Lk)("div",Rf,[a[74]||(a[74]=(0,s.Lk)("label",null,"Scope:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Scope=a},null,8,Df),[[i.Jo,e.Scope]])])]),(0,s.Lk)("div",If,[(0,s.Lk)("div",Pf,[a[76]||(a[76]=(0,s.Lk)("label",null,"Policy Type:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.PolicyType=a,class:"form-control",onChange:a=>n.handlePolicyTypeChange(e)},[a[75]||(a[75]=(0,s.Lk)("option",{value:""},"Select Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.policyTypeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Sf))),128))],40,_f),[[i.u1,e.PolicyType]])]),(0,s.Lk)("div",Af,[a[78]||(a[78]=(0,s.Lk)("label",null,"Policy Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.PolicyCategory=a,class:"form-control",onChange:a=>n.handlePolicyCategoryChange(e)},[a[77]||(a[77]=(0,s.Lk)("option",{value:""},"Select Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicyCategories(e.PolicyType),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,xf))),128))],40,Tf),[[i.u1,e.PolicyCategory]])])]),(0,s.Lk)("div",Ff,[(0,s.Lk)("div",Vf,[a[80]||(a[80]=(0,s.Lk)("label",null,"Policy Sub Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.PolicySubCategory=a,class:"form-control"},[a[79]||(a[79]=(0,s.Lk)("option",{value:""},"Select Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicySubCategories(e.PolicyType,e.PolicyCategory),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Xf))),128))],8,Mf),[[i.u1,e.PolicySubCategory]])])]),e.subpolicies?((0,s.uX)(),(0,s.CE)("div",Uf,[a[85]||(a[85]=(0,s.Lk)("h6",null,"Edit Sub-Policies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"edit-subpolicy-item"},[(0,s.Lk)("div",Nf,[(0,s.Lk)("div",$f,[a[81]||(a[81]=(0,s.Lk)("label",null,"Sub-Policy Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.SubPolicyName=a},null,8,Of),[[i.Jo,e.SubPolicyName]])]),(0,s.Lk)("div",jf,[a[82]||(a[82]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Description=a},null,8,Bf),[[i.Jo,e.Description]])])]),(0,s.Lk)("div",Wf,[(0,s.Lk)("div",Qf,[a[83]||(a[83]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Control=a},null,8,qf),[[i.Jo,e.Control]])]),(0,s.Lk)("div",Kf,[a[84]||(a[84]=(0,s.Lk)("label",null,"Identifier:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.Identifier=a},null,8,Jf),[[i.Jo,e.Identifier]])])])]))),128))])):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"resubmit-btn",onClick:a[20]||(a[20]=e=>n.resubmitFramework(l.editingFramework))},"Resubmit for Review")])])):(0,s.Q3)("",!0),(0,s.bF)(u)])}var Hf={name:"FrameworkApprover",components:{PopupModal:vt,CollapsibleTable:Cl,DynamicTable:Ll.A},data(){return{approvals:[],selectedApproval:null,showFrameworkDetails:!1,showRejectModal:!1,rejectionComment:"",currentRejectionType:"framework",currentRejectionItem:null,rejectedFrameworks:[],showEditModal:!1,editingFramework:null,userId:2,isReviewer:!0,policyCategories:[],policyCategoriesMap:{},tableHeaders:[{key:"frameworkId",label:"Framework ID",width:"120px"},{key:"frameworkName",label:"Framework Name",width:"200px"},{key:"category",label:"Category",width:"150px"},{key:"createdBy",label:"Created By",width:"150px"},{key:"createdDate",label:"Created Date",width:"120px"},{key:"version",label:"Version",width:"80px"},{key:"status",label:"Status",width:"120px"},{key:"actions",label:"Actions",width:"150px",className:"actions-column"}],sectionExpansion:{pending:!0,approved:!1,rejected:!1},rejectedFrameworksTableData:[],rejectedFrameworksColumns:[{key:"frameworkId",label:"Framework ID",width:"120px"},{key:"frameworkName",label:"Framework Name",width:"200px"},{key:"category",label:"Category",width:"150px"},{key:"createdBy",label:"Created By",width:"150px"},{key:"createdDate",label:"Created Date",width:"120px"},{key:"version",label:"Version",width:"80px"},{key:"status",label:"Status",width:"120px"},{key:"rejectionReason",label:"Rejection Reason",width:"200px"},{key:"actions",label:"Actions",width:"120px",className:"actions-column"}],pendingPage:1,pendingPageSize:6,approvedPage:1,approvedPageSize:6,rejectedPage:1,rejectedPageSize:6}},mounted(){this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.fetchPolicyTypes()},methods:{fetchFrameworks(){console.log("Fetching frameworks..."),qe.A.get("http://localhost:8000/api/frameworks/",{params:{include_all_status:!0}}).then(e=>{console.log("Frameworks response:",e.data),this.approvals=e.data.map(e=>{let a=e.CurrentVersion?.toString()||"u1";return{FrameworkId:e.FrameworkId,ExtractedData:{type:"framework",FrameworkName:e.FrameworkName,CreatedByName:e.CreatedByName,CreatedByDate:e.CreatedByDate,Category:e.Category,Status:e.Status,FrameworkDescription:e.FrameworkDescription,EffectiveDate:e.EffectiveDate,StartDate:e.StartDate,EndDate:e.EndDate,Identifier:e.Identifier,DocURL:e.DocURL,Reviewer:e.Reviewer,InternalExternal:e.InternalExternal},ApprovedNot:"Approved"===e.Status||"Rejected"!==e.Status&&null,version:a}}).filter(e=>"Under Review"===e.ExtractedData.Status||"Approved"===e.ExtractedData.Status||"Rejected"===e.ExtractedData.Status),console.log("Processed frameworks for approval:",this.approvals)}).catch(e=>{console.error("Error fetching frameworks:",e)})},openApprovalDetails(e){if(this.selectedApproval&&this.selectedApproval.FrameworkId===e.FrameworkId)return this.showDetails=!this.showDetails,void(this.showDetails||(this.selectedApproval=null));const a=this.getFrameworkId(e);qe.A.get(`http://localhost:8000/api/framework-approvals/latest/${a}/`).then(a=>{if(console.log("Latest framework approval:",a.data),a.data&&a.data.ExtractedData){const t=a.data,i={...e,...t,ExtractedData:t.ExtractedData};!0===i.ApprovedNot&&i.ExtractedData&&"Approved"===i.ExtractedData.Status&&i.ExtractedData.policies&&i.ExtractedData.policies.forEach(e=>{"Approved"!==e.Status&&(console.log(`Correcting status for policy ${e.PolicyId} from ${e.Status} to Approved`),e.Status="Approved"),e.subpolicies&&e.subpolicies.forEach(e=>{"Approved"!==e.Status&&(console.log(`Correcting status for subpolicy ${e.SubPolicyId} from ${e.Status} to Approved`),e.Status="Approved")})}),this.selectedApproval=i,this.showFrameworkDetails=!0,this.$nextTick(()=>{this.$refs.frameworkDetailsContent&&(this.$refs.frameworkDetailsContent.scrollTop=0)})}else console.error("Invalid approval data received:",a.data),Za.error("Error: Could not load framework approval details","Loading Error")}).catch(e=>{this.handleError(e,"loading framework approval details")})},refreshData(){this.fetchFrameworks(),this.selectedApproval&&this.selectedApproval.FrameworkId&&this.openApprovalDetails(this.selectedApproval)},formatDate(e){if(!e)return"";const a=new Date(e);return isNaN(a.getTime())?"":a.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},isNewFramework(e){const a=e.ExtractedData?.CreatedByDate||e.created_at;if(!a)return!1;const t=new Date(a);if(isNaN(t.getTime()))return!1;const i=new Date;return i.setDate(i.getDate()-3),t>i},getFrameworkId(e){return e.FrameworkId?"object"===typeof e.FrameworkId?e.FrameworkId.FrameworkId:e.FrameworkId:e.ApprovalId},closeApprovalDetails(){this.selectedApproval=null,this.showFrameworkDetails=!1},approveFramework(){this.selectedApproval&&this.selectedApproval.FrameworkId?(this.selectedApproval.ExtractedData.framework_approval||(this.selectedApproval.ExtractedData.framework_approval={}),this.selectedApproval.ExtractedData.framework_approval.approved=!0,this.selectedApproval.ExtractedData.framework_approval.remarks="",this.selectedApproval.ApprovedNot=!0,this.selectedApproval.ExtractedData.Status="Approved"):console.error("No framework selected for approval")},rejectFramework(){this.currentRejectionType="framework",this.currentRejectionItem=null,this.showRejectModal=!0},cancelRejection(){this.showRejectModal=!1,this.rejectionComment="",this.currentRejectionType="framework",this.currentRejectionItem=null},confirmRejection(){if(!this.rejectionComment.trim())return void Za.warning("Please provide a rejection reason","Missing Reason");const e=this.getFrameworkId(this.selectedApproval);if("subpolicy"===this.currentRejectionType&&this.currentRejectionItem){const{policy:a,subpolicy:t}=this.currentRejectionItem;qe.A.put(`http://localhost:8000/api/frameworks/${e}/policies/${a.PolicyId}/subpolicies/${t.SubPolicyId}/approve-reject/`,{approved:!1,rejection_reason:this.rejectionComment,submit_review:!0}).then(e=>{console.log("Subpolicy rejected successfully:",e.data),t.Status="Rejected",a.Status="Rejected",a.subpolicies&&a.subpolicies.forEach(e=>{e.Status="Rejected"}),this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ApprovedNot=!1,Za.success("Subpolicy rejected. Framework has been rejected and sent back for revision.","Subpolicy Rejected"),this.cancelRejection(),this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.closeApprovalDetails()}).catch(e=>{this.handleError(e,"rejecting subpolicy")})}else if("policy"===this.currentRejectionType&&this.currentRejectionItem){const a=this.currentRejectionItem;qe.A.put(`http://localhost:8000/api/frameworks/${e}/policies/${a.PolicyId}/approve-reject/`,{approved:!1,rejection_reason:this.rejectionComment,submit_review:!0}).then(e=>{console.log("Policy rejected successfully:",e.data),a.Status="Rejected",a.subpolicies&&a.subpolicies.forEach(e=>{e.Status="Rejected"}),this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ApprovedNot=!1,Za.success("Policy rejected. Framework has been rejected and sent back for revision.","Policy Rejected"),this.cancelRejection(),this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.closeApprovalDetails()}).catch(e=>{this.handleError(e,"rejecting policy")})}else if("framework"===this.currentRejectionType){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return console.error("No framework selected for rejection"),void this.cancelRejection();this.selectedApproval.ExtractedData.framework_approval||(this.selectedApproval.ExtractedData.framework_approval={}),this.selectedApproval.ExtractedData.framework_approval.approved=!1,this.selectedApproval.ExtractedData.framework_approval.remarks=this.rejectionComment,this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ApprovedNot=!1,this.submitFrameworkReview(!1,this.rejectionComment),this.cancelRejection()}},handleError(e,a){console.error(`Error ${a}:`,e);let t="An unexpected error occurred";return t=e.response?e.response.data&&e.response.data.error?e.response.data.error:e.response.data&&"string"===typeof e.response.data?e.response.data:`Server error: ${e.response.status}`:e.request?"No response from server. Please check your connection.":e.message||t,Za.error(`Error ${a}: ${t}`,"Error"),t},submitFrameworkReview(e,a=""){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return void console.error("No framework selected for review submission");const t=this.getFrameworkId(this.selectedApproval);console.log(`Submitting framework review for framework ${t}`,{approved:e,remarks:a});const i={ExtractedData:JSON.parse(JSON.stringify(this.selectedApproval.ExtractedData)),ApprovedNot:e,remarks:a,UserId:this.userId,ReviewerId:this.userId,currentVersion:this.selectedApproval.version||"u1"};!0===e&&i.ExtractedData.policies&&i.ExtractedData.policies.forEach(e=>{e.Status="Approved",e.ActiveInactive="Active",e.subpolicies&&e.subpolicies.forEach(e=>{e.Status="Approved"})}),!0===e&&(i.ExtractedData.ActiveInactive="Active"),!1===e&&a&&(i.ExtractedData.framework_approval||(i.ExtractedData.framework_approval={}),i.ExtractedData.framework_approval.remarks=a),qe.A.post(`http://localhost:8000/api/frameworks/${t}/submit-review/`,i).then(a=>{console.log("Framework review submitted successfully:",a.data),this.selectedApproval.ApprovedNot=e,this.selectedApproval.Version=a.data.Version,e?(this.selectedApproval.ExtractedData.Status="Approved",a.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=a.data.ApprovedDate),this.selectedApproval.ExtractedData.policies&&this.selectedApproval.ExtractedData.policies.forEach(e=>{e.Status="Approved",e.subpolicies&&e.subpolicies.forEach(e=>{e.Status="Approved"})}),Za.success("Framework approved successfully!","Framework Approved")):(this.selectedApproval.ExtractedData.Status="Rejected",Za.success("Framework rejected successfully!","Framework Rejected")),this.fetchFrameworks()}).catch(e=>{this.handleError(e,"submitting framework review")})},fetchRejectedFrameworks(){console.log("Fetching rejected frameworks..."),qe.A.get("http://localhost:8000/api/frameworks/rejected/",{params:{user_id:this.userId}}).then(e=>{console.log("Rejected frameworks response:",e.data),this.rejectedFrameworks=e.data.map(e=>(e.ExtractedData||(e.ExtractedData={}),e)),this.rejectedFrameworksTableData=this.rejectedFrameworks.map(e=>this.transformRejectedFrameworkForTable(e))}).catch(e=>{console.error("Error fetching rejected frameworks:",e)})},openRejectedItem(e){console.log("Opening rejected framework for editing:",e),this.editingFramework=JSON.parse(JSON.stringify(e)),this.editingFramework.ExtractedData||(this.editingFramework.ExtractedData={}),this.editingFramework.ExtractedData.policies?(console.log(`Found ${this.editingFramework.ExtractedData.policies.length} policies in framework`),this.editingFramework.ExtractedData.policies.forEach(e=>{e.PolicyType||(e.PolicyType=""),e.PolicyCategory||(e.PolicyCategory=""),e.PolicySubCategory||(e.PolicySubCategory=""),console.log(`Policy ${e.PolicyId} category fields:`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),e.subpolicies||(e.subpolicies=[])})):(console.warn("No policies found in rejected framework, initializing empty policies array"),this.editingFramework.ExtractedData.policies=[]),this.showEditModal=!0},closeEditModal(){this.showEditModal=!1,this.editingFramework=null},resubmitFramework(e){const a=this.getFrameworkId(e);console.log("Resubmitting framework with ID:",a),console.log("Framework data before preparing:",e);const t=this.validateFrameworkData(e);if(t.length>0)return void Za.warning(`Please fix the following errors before resubmitting:\n${t.join("\n")}`,"Validation Errors");e.ExtractedData.policies&&e.ExtractedData.policies.length>0?e.ExtractedData.policies.forEach((e,a)=>{console.log(`Checking policy ${a} with ID: ${e.PolicyId}`),console.log("Policy category fields:",{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),e.subpolicies&&e.subpolicies.length>0?e.subpolicies.forEach((e,t)=>{console.log(`Checking subpolicy ${t} with ID: ${e.SubPolicyId}`),e.SubPolicyName||console.warn(`SubpolicyName is missing for subpolicy ${t} in policy ${a}`),e.Description||console.warn(`Description is missing for subpolicy ${t} in policy ${a}`)}):console.log(`Policy ${a} has no subpolicies or they are not properly structured`)}):console.warn("No policies found in framework data or policies array is not properly structured");const i={FrameworkName:e.ExtractedData.FrameworkName,FrameworkDescription:e.ExtractedData.FrameworkDescription,Category:e.ExtractedData.Category,EffectiveDate:e.ExtractedData.EffectiveDate,StartDate:e.ExtractedData.StartDate,EndDate:e.ExtractedData.EndDate,policies:e.ExtractedData.policies?e.ExtractedData.policies.map(e=>{console.log(`Processing policy ${e.PolicyId} for resubmission with category fields:`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory});const a={...e,PolicyId:e.PolicyId,PolicyName:e.PolicyName,PolicyDescription:e.PolicyDescription,Status:e.Status,StartDate:e.StartDate,EndDate:e.EndDate,Department:e.Department,Objective:e.Objective,Scope:e.Scope,Applicability:e.Applicability,Identifier:e.Identifier,CoverageRate:e.CoverageRate,PolicyType:e.PolicyType||"",PolicyCategory:e.PolicyCategory||"",PolicySubCategory:e.PolicySubCategory||"",subpolicies:e.subpolicies||[]};return a}):[]};console.log("Prepared resubmission data:",i),console.log("Policies in resubmission data:",i.policies),console.log("Number of policies:",i.policies.length),console.log("Final resubmission data to be sent:",JSON.stringify(i)),i.policies&&i.policies.length>0&&(console.log("CRITICAL - Policy category fields in final resubmission data:"),i.policies.forEach((e,a)=>{e.PolicyType=e.PolicyType||"",e.PolicyCategory=e.PolicyCategory||"",e.PolicySubCategory=e.PolicySubCategory||"",console.log(`Policy ${a} (${e.PolicyId}):`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory})})),qe.A.put(`http://localhost:8000/api/frameworks/${a}/resubmit-approval/`,i).then(e=>{console.log("Framework resubmitted successfully:",e.data),Za.success(`Framework resubmitted for review! New version: ${e.data.Version}`,"Framework Resubmitted"),this.closeEditModal(),this.fetchRejectedFrameworks(),this.fetchFrameworks()}).catch(e=>{console.error("Error data:",e.response?e.response.data:"No response data"),this.handleError(e,"resubmitting framework")})},formatFieldName(e){return e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim()},approvePolicy(e){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return void console.error("No framework selected for policy approval");if(!this.canApprovePolicy(e))return void Za.warning("All subpolicies must be approved before approving the policy","Subpolicies Not Approved");const a=this.getFrameworkId(this.selectedApproval);qe.A.put(`http://localhost:8000/api/frameworks/${a}/policies/${e.PolicyId}/approve-reject/`,{approved:!0}).then(a=>{console.log("Policy approved successfully:",a.data),e.Status="Approved",this.areAllPoliciesApproved()&&(this.selectedApproval.ExtractedData.Status="Ready for Final Approval"),Za.success("Policy approved successfully!","Policy Approved")}).catch(e=>{this.handleError(e,"approving policy")})},rejectPolicy(e){this.selectedApproval&&this.selectedApproval.FrameworkId?(this.currentRejectionType="policy",this.currentRejectionItem=e,this.showRejectModal=!0):console.error("No framework selected for policy rejection")},rejectSubpolicy(e,a){this.selectedApproval&&this.selectedApproval.FrameworkId?(this.currentRejectionType="subpolicy",this.currentRejectionItem={policy:e,subpolicy:a},this.showRejectModal=!0):console.error("No framework selected for subpolicy rejection")},canApprovePolicy(e){return"Approved"!==e.Status&&("Rejected"!==e.Status&&("Ready for Approval"===e.Status||(!(e.subpolicies&&e.subpolicies.length>0)||e.subpolicies.every(e=>"Approved"===e.Status))))},approveSubpolicy(e,a){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return void console.error("No framework selected for subpolicy approval");const t=this.getFrameworkId(this.selectedApproval);qe.A.put(`http://localhost:8000/api/frameworks/${t}/policies/${e.PolicyId}/subpolicies/${a.SubPolicyId}/approve-reject/`,{approved:!0}).then(t=>{console.log("Subpolicy approved successfully:",t.data),a.Status="Approved";const i=e.subpolicies&&e.subpolicies.every(e=>"Approved"===e.Status);i&&(console.log(`All subpolicies in policy "${e.PolicyName}" are now approved`),e.Status="Ready for Approval"),Za.success("Subpolicy approved successfully!","Subpolicy Approved")}).catch(e=>{this.handleError(e,"approving subpolicy")})},areAllSubpoliciesApproved(e){return!e.subpolicies||0===e.subpolicies.length||e.subpolicies.every(e=>"Approved"===e.Status)},areAllPoliciesApproved(){return!!this.selectedApproval.ExtractedData.policies&&this.selectedApproval.ExtractedData.policies.every(e=>"Approved"===e.Status)},getFrameworkApprovalStatus(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData)return"Unknown";const e=this.selectedApproval.ExtractedData.policies||[];if(0===e.length)return"No Policies";const a=e.filter(e=>"Approved"===e.Status).length,t=e.filter(e=>"Rejected"===e.Status).length,i=e.length;return t>0?`Rejected (${t}/${i} policies rejected)`:a===i?`Ready for Final Approval (${a}/${i} policies approved)`:`Under Review (${a}/${i} policies approved)`},canApproveFramework(){return!(!this.selectedApproval||!this.selectedApproval.ExtractedData)&&(null===this.selectedApproval.ApprovedNot&&this.areAllPoliciesApproved())},approveEntireFramework(){this.selectedApproval&&this.selectedApproval.FrameworkId?this.canApproveFramework()?Za.confirm("Are you sure you want to give final approval to this entire framework?","Confirm Final Approval",()=>{this.proceedWithFrameworkApproval()}):Za.warning("All policies must be approved before approving the framework","Policies Not Approved"):console.error("No framework selected for entire framework approval")},proceedWithFrameworkApproval(){const e=this.getFrameworkId(this.selectedApproval);qe.A.put(`http://localhost:8000/api/frameworks/${e}/approve-final/`).then(e=>{console.log("Framework approved successfully:",e.data),this.selectedApproval.ExtractedData.Status="Approved",this.selectedApproval.ApprovedNot=!0,e.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=e.data.ApprovedDate),this.selectedApproval.ExtractedData.policies&&this.selectedApproval.ExtractedData.policies.forEach(e=>{e.Status="Approved",e.subpolicies&&e.subpolicies.forEach(e=>{e.Status="Approved"})}),Za.success("Framework approved successfully!","Framework Approved"),this.fetchFrameworks()}).catch(e=>{this.handleError(e,"approving entire framework")})},submitReview(){console.log("submitReview called with approval:",this.selectedApproval),this.selectedApproval&&null!==this.selectedApproval.ApprovedNot?(console.log("Delegating to submitFrameworkReview with approval status:",this.selectedApproval.ApprovedNot),this.submitFrameworkReview(this.selectedApproval.ApprovedNot)):console.error("Cannot submit review - no approval or approval status set")},validateFrameworkData(e){const a=[];return e.ExtractedData.FrameworkName||a.push("Framework Name is required"),e.ExtractedData.FrameworkDescription||a.push("Framework Description is required"),e.ExtractedData.policies&&e.ExtractedData.policies.length>0&&e.ExtractedData.policies.forEach((e,t)=>{e.PolicyName||a.push(`Policy #${t+1} is missing a name`),console.log(`Validating policy #${t+1} category fields:`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),e.subpolicies&&e.subpolicies.length>0&&e.subpolicies.forEach((i,s)=>{i.SubPolicyName||a.push(`Subpolicy #${s+1} in Policy "${e.PolicyName||`#${t+1}`}" is missing a name`)})}),a},fetchPolicyTypes(){console.log("Fetching policy categories..."),qe.A.get("http://localhost:8000/api/policy-categories/").then(e=>{console.log("Policy categories response:",e.data),this.policyCategories=e.data;const a={};e.data.forEach(e=>{a[e.PolicyType]||(a[e.PolicyType]={categories:{}}),a[e.PolicyType].categories[e.PolicyCategory]||(a[e.PolicyType].categories[e.PolicyCategory]={subCategories:[]}),a[e.PolicyType].categories[e.PolicyCategory].subCategories.push(e.PolicySubCategory)}),this.policyCategoriesMap=a,console.log("Processed policy categories map:",this.policyCategoriesMap)}).catch(e=>{console.error("Error fetching policy categories:",e)})},initializePolicyCategoryFields(e){return console.log(`Initializing policy category fields for policy: ${e.PolicyId||"New Policy"}`),console.log("Current policy category fields:",{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),this.$watch(()=>e.PolicyType,(a,t)=>{a!==t&&(console.log(`Policy type changed from ${t} to ${a}, resetting category and subcategory`),e.PolicyCategory="",e.PolicySubCategory="")}),this.$watch(()=>e.PolicyCategory,(a,t)=>{a!==t&&(console.log(`Policy category changed from ${t} to ${a}, resetting subcategory`),e.PolicySubCategory="")}),e},handlePolicyTypeChange(e){console.log(`Policy type changed to: ${e.PolicyType}`),e.PolicyCategory="",e.PolicySubCategory=""},handlePolicyCategoryChange(e){console.log(`Policy category changed to: ${e.PolicyCategory}`),e.PolicySubCategory=""},getActionButtons(e,a){switch(a){case"Under Review":return'<span class="action-text review-approve">Review & Approve</span>';case"Approved":return'<span class="action-text">View Details</span>';case"Rejected":return'<span class="action-text edit-resubmit">Edit & Resubmit</span>';default:return'<span class="action-text">View Details</span>'}},transformFrameworkForTable(e){const a=this.getFrameworkStatus(e),t=this.isNewFramework(e);return{incidentId:e.FrameworkId||e.ApprovalId,frameworkId:this.getFrameworkId(e),frameworkName:e.ExtractedData?.FrameworkName||"Unnamed Framework",category:e.ExtractedData?.Category||"No Category",createdBy:e.ExtractedData?.CreatedByName||"System",createdDate:this.formatDate(e.ExtractedData?.CreatedByDate||e.created_at),version:e.version||"u1",status:this.getStatusBadge(a,t),criticality:this.getCriticalityBadge(e),priority:this.getPriorityBadge(e),actions:this.getActionButtons(e,a),originalFramework:e}},getFrameworkStatus(e){return!0===e.ApprovedNot||"Approved"===e.ExtractedData?.Status?"Approved":!1===e.ApprovedNot||"Rejected"===e.ExtractedData?.Status?"Rejected":"Under Review"},getStatusBadge(e,a=!1){let t="",i="";switch(e){case"Approved":t="status-approved",i='<i class="fas fa-check-circle"></i>';break;case"Rejected":t="status-rejected",i='<i class="fas fa-times-circle"></i>';break;case"Under Review":default:t="status-pending",i='<i class="fas fa-clock"></i>';break}const s=a?'<span class="new-badge">NEW</span>':"";return`<span class="status-badge ${t}">${i} ${e}</span>${s}`},getCriticalityBadge(e){const a=e.ExtractedData?.Category?.toLowerCase()||"";return a.includes("critical")||a.includes("high")?'<span class="criticality-badge critical">Critical</span>':a.includes("medium")||a.includes("moderate")?'<span class="criticality-badge medium">Medium</span>':'<span class="criticality-badge low">Low</span>'},getPriorityBadge(e){const a=new Date(e.ExtractedData?.CreatedByDate||e.created_at),t=new Date,i=Math.floor((t-a)/864e5);return i<=1?'<span class="priority-badge high">High</span>':i<=3?'<span class="priority-badge medium">Medium</span>':'<span class="priority-badge low">Low</span>'},approveFrameworkFromTable(e){const a=this.findFrameworkById(e);a&&(this.selectedApproval=a,this.approveFramework())},rejectFrameworkFromTable(e){const a=this.findFrameworkById(e);a&&(this.selectedApproval=a,this.rejectFramework())},openApprovalDetailsFromTable(e){const a=this.findFrameworkById(e);a&&this.openApprovalDetails(a)},openRejectedItemFromTable(e){const a=this.findFrameworkById(e);a&&this.openRejectedItem(a)},downloadFramework(e){console.log("Downloading framework:",e),Za.info("Download functionality will be implemented soon.","Download")},findFrameworkById(e){return this.approvals.find(a=>this.getFrameworkId(a)===e)},toggleSection(e){this.sectionExpansion[e]=!this.sectionExpansion[e]},handleTaskClick(e){const a=e.originalFramework;if(!a)return void console.error("No framework data found in task:",e);const t=this.getFrameworkStatus(a);switch(t){case"Under Review":this.openApprovalDetails(a);break;case"Approved":this.openApprovalDetails(a);break;case"Rejected":this.openRejectedItem(a);break;default:this.openApprovalDetails(a);break}},handleRejectedFrameworkSelect({row:e,selected:a}){console.log("Rejected framework selected:",e,a)},transformRejectedFrameworkForTable(e){const a="Rejected",t=this.isNewFramework(e);return{FrameworkId:e.FrameworkId||e.ApprovalId,frameworkId:this.getFrameworkId(e),frameworkName:e.ExtractedData?.FrameworkName||"Unnamed Framework",category:e.ExtractedData?.Category||"No Category",createdBy:e.ExtractedData?.CreatedByName||"System",createdDate:this.formatDate(e.ExtractedData?.CreatedByDate||e.created_at),version:e.version||"u1",status:this.getStatusBadge(a,t),rejectionReason:this.formatRejectionReason(e.rejection_reason),originalFramework:e}},formatRejectionReason(e){return e?e.length>50?e.substring(0,50)+"...":e:"No reason provided"},handlePendingPageChange(e){this.pendingPage=e},handlePendingPageSizeChange(e){this.pendingPageSize=e,this.pendingPage=1},handleApprovedPageChange(e){this.approvedPage=e},handleApprovedPageSizeChange(e){this.approvedPageSize=e,this.approvedPage=1},handleRejectedPageChange(e){this.rejectedPage=e},handleRejectedPageSizeChange(e){this.rejectedPageSize=e,this.rejectedPage=1}},computed:{pendingApprovalsCount(){return this.approvals.filter(e=>null===e.ApprovedNot).length},approvedApprovalsCount(){return this.approvals.filter(e=>!0===e.ApprovedNot).length},rejectedApprovalsCount(){return this.approvals.filter(e=>!1===e.ApprovedNot).length},sortedFrameworks(){return[...this.approvals].sort((e,a)=>{const t=new Date(e.ExtractedData?.CreatedByDate||0),i=new Date(a.ExtractedData?.CreatedByDate||0);return i-t})},pendingFrameworks(){return this.sortedFrameworks.filter(e=>null===e.ApprovedNot||"Under Review"===e.ExtractedData?.Status)},approvedFrameworks(){return this.sortedFrameworks.filter(e=>!0===e.ApprovedNot||"Approved"===e.ExtractedData?.Status)},rejectedFrameworksForTable(){return this.sortedFrameworks.filter(e=>!1===e.ApprovedNot||"Rejected"===e.ExtractedData?.Status)},pendingSectionConfig(){const e=this.pendingFrameworks.map(e=>this.transformFrameworkForTable(e)),a=(this.pendingPage-1)*this.pendingPageSize,t=a+this.pendingPageSize;return{name:"Pending Review",statusClass:"pending",tasks:e.slice(a,t)}},approvedSectionConfig(){const e=this.approvedFrameworks.map(e=>this.transformFrameworkForTable(e)),a=(this.approvedPage-1)*this.approvedPageSize,t=a+this.approvedPageSize;return{name:"Approved",statusClass:"completed",tasks:e.slice(a,t)}},rejectedSectionConfig(){const e=this.rejectedFrameworksForTable.map(e=>this.transformFrameworkForTable(e)),a=(this.rejectedPage-1)*this.rejectedPageSize,t=a+this.rejectedPageSize;return{name:"Rejected",statusClass:"rejected",tasks:e.slice(a,t)}},policyTypeOptions(){return Object.keys(this.policyCategoriesMap)},filteredPolicyCategories(){return e=>e&&this.policyCategoriesMap[e]?Object.keys(this.policyCategoriesMap[e].categories):[]},filteredPolicySubCategories(){return(e,a)=>e&&a&&this.policyCategoriesMap[e]&&this.policyCategoriesMap[e].categories[a]?this.policyCategoriesMap[e].categories[a].subCategories:[]},pendingPagination(){return{currentPage:this.pendingPage,totalPages:Math.max(1,Math.ceil(this.pendingFrameworks.length/this.pendingPageSize)),pageSize:this.pendingPageSize,totalCount:this.pendingFrameworks.length,pageSizeOptions:[6,15,30,50],onPageSizeChange:this.handlePendingPageSizeChange}},approvedPagination(){return{currentPage:this.approvedPage,totalPages:Math.max(1,Math.ceil(this.approvedFrameworks.length/this.approvedPageSize)),pageSize:this.approvedPageSize,totalCount:this.approvedFrameworks.length,pageSizeOptions:[6,15,30,50],onPageSizeChange:this.handleApprovedPageSizeChange}},rejectedPagination(){return{currentPage:this.rejectedPage,totalPages:Math.max(1,Math.ceil(this.rejectedFrameworksForTable.length/this.rejectedPageSize)),pageSize:this.rejectedPageSize,totalCount:this.rejectedFrameworksForTable.length,pageSizeOptions:[6,15,30,50],onPageSizeChange:this.handleRejectedPageSizeChange}}}};const Yf=(0,se.A)(Hf,[["render",zf],["__scopeId","data-v-32eaa29f"]]);var Gf=Yf;const Zf={class:"dashboard-container"},eb={class:"filter-section"},ab={class:"filter-group"},tb={key:0,class:"loading-indicator"},ib={key:1,class:"no-requests"},sb={key:2},ob={class:"framework-grid"},lb={class:"framework-header"},nb={class:"category-tag"},rb={class:"framework-description"},cb={class:"framework-footer"},db={class:"status-toggle"},ub=["checked"],pb={class:"actions"},vb=["onClick"],mb={key:3,class:"framework-details-modal"},kb={class:"framework-details-content"},hb={class:"detail-type-indicator"},gb={class:"version-pill"},yb={class:"framework-approval-section"},fb={class:"approval-status-indicator"},bb={key:0,class:"framework-actions"},Cb={key:1,class:"approval-result"},Lb={key:0,class:"approval-remarks"},wb={key:1,class:"approval-date"},Eb={class:"request-details"},Rb={class:"framework-detail-row"},Db={class:"framework-detail-row"},Ib={class:"framework-detail-row"},Pb={class:"framework-detail-row"},_b={class:"framework-detail-row"},Sb={key:0,class:"framework-detail-row"},Ab={key:0,class:"policy-count"},Tb={key:1,class:"framework-detail-row"},xb={key:0,class:"policy-count"},Fb={key:0,class:"affected-policies-section"},Vb={class:"section-description"},Mb={key:0},Xb={key:1},Ub={class:"policies-list"},Nb={class:"policy-header"},$b={class:"policy-name"},Ob={class:"policy-details"},jb={key:0,class:"policy-detail-item"},Bb={key:1,class:"policy-detail-item"},Wb={key:2,class:"policy-detail-item"},Qb={class:"policy-header"},qb={class:"policy-name"},Kb={class:"policy-details"},Jb={key:0,class:"policy-detail-item"},zb={key:1,class:"policy-detail-item"},Hb={key:2,class:"policy-detail-item"},Yb={key:0,class:"affected-policies-summary"},Gb={key:1,class:"no-policies-message"},Zb={key:2,class:"approval-implications"},eC={class:"implication-item warning"},aC={class:"implication-text"},tC={key:0};var iC={__name:"StatusChangeRequests",setup(e){const a=(0,ee.KR)([]),t=(0,ee.KR)(!1),i=(0,ee.KR)(!1),o=(0,ee.KR)(null),l=(0,ee.KR)(""),n=(0,ee.KR)([]),r=(0,s.EW)(()=>({label:"Filter by Reviewer",name:"reviewer",values:[{value:"",label:"All Reviewers"},...n.value.map(e=>({value:e.UserId,label:`${e.UserName} (${e.Email})`}))],defaultValue:"All Reviewers"})),c=(0,s.EW)(()=>a.value.filter(e=>"Pending Approval"===e.Status)),u=[{key:"name",label:"Name"},{key:"type",label:"Type"},{key:"category",label:"Category/Department"},{key:"date",label:"Request Date"},{key:"reason",label:"Reason"},{key:"actions",label:"Actions"}],p=(0,s.EW)(()=>c.value.map(e=>({...e,name:e.FrameworkName||e.PolicyName,type:"policy"===e.ItemType?"POLICY STATUS CHANGE":"FRAMEWORK STATUS CHANGE",category:e.Category||e.Department,date:v(e.RequestDate),reason:e.Reason}))),v=e=>{if(!e)return"N/A";try{const a=new Date(e);return a.toLocaleDateString()}catch(a){return e}},m=e=>{const a={};return e.forEach(e=>{!0===e.ApprovedNot?(a[e.FrameworkName]="Approved",e.Status="Approved"):!1===e.ApprovedNot?(a[e.FrameworkName]="Rejected",e.Status="Rejected"):(a[e.FrameworkName]="Pending Approval",e.Status="Pending Approval")}),e.forEach(e=>{e.Status=a[e.FrameworkName],e.AffectedPolicies&&e.AffectedPolicies.forEach(a=>{"Approved"===e.Status?a.ActiveInactive="Inactive":"Rejected"===e.Status&&(a.ActiveInactive="Active")})}),e},k=async()=>{t.value=!0;try{const[e,t]=await Promise.all([qe.A.get("/api/framework-status-change-requests/"),qe.A.get("/api/policy-status-change-requests/")]),i=m(e.data),s=t.data.map(e=>({...e,RequestType:"Policy Status Change",ItemType:"policy"})),o=[...i,...s];o.forEach(e=>{e.ItemType||(e.ItemType="framework")}),a.value=o.sort((e,a)=>{const t=new Date(e.RequestDate||0),i=new Date(a.RequestDate||0);return i-t})}catch(e){console.error("Error fetching status change requests:",e)}finally{t.value=!1}},h=e=>{o.value=e,i.value=!0},g=()=>{o.value=null,i.value=!1},y=async e=>{const a=e.FrameworkName||e.PolicyName,t="policy"===e.ItemType?"policy":"framework",i="policy"===e.ItemType?e.CascadeToSubpolicies?" This will also make all subpolicies inactive.":"":e.CascadeToApproved?" This will also make all approved policies inactive.":"";Za.confirm(`Are you sure you want to approve changing the status of "${a}" to Inactive?${i}`,"Confirm Approval",async()=>{Za.comment("Enter any remarks (optional):","Approval Remarks",async i=>{try{const s="policy"===e.ItemType?`/api/policy-approvals/${e.ApprovalId}/approve-status-change/`:`/api/framework-approvals/${e.ApprovalId}/approve-status-change/`;await qe.A.post(s,{approved:!0,remarks:i||"Status change approved"});const o="policy"===e.ItemType?e.SubpolicyCount:e.PolicyCount,l="policy"===e.ItemType?"subpolicies":"policies";Za.success(`${t.charAt(0).toUpperCase()+t.slice(1)} "${a}" has been set to Inactive.${o>0?` ${o} ${l} were also made inactive.`:""}`,"Status Changed"),g(),await k()}catch(s){console.error("Error approving status change request:",s),Za.error("Failed to approve status change request. Please try again.","Approval Failed")}})})},f=async e=>{const a=e.FrameworkName||e.PolicyName,t="policy"===e.ItemType?"policy":"framework";Za.confirm(`Are you sure you want to reject the status change request for "${a}"? The ${t} will remain Active.`,"Confirm Rejection",async()=>{Za.comment("Enter rejection reason (optional):","Rejection Reason",async i=>{try{const s="policy"===e.ItemType?`/api/policy-approvals/${e.ApprovalId}/approve-status-change/`:`/api/framework-approvals/${e.ApprovalId}/approve-status-change/`;await qe.A.post(s,{approved:!1,remarks:i||"Status change rejected"}),Za.success(`Status change request for "${a}" has been rejected. The ${t} remains Active.`,"Request Rejected"),g(),await k()}catch(s){console.error("Error rejecting status change request:",s),Za.error("Failed to reject status change request. Please try again.","Rejection Failed")}})})};(0,s.sV)(()=>{k(),b()});const b=async()=>{try{const e=await qe.A.get("/api/users-for-reviewer-selection/");n.value=e.data}catch(e){console.error("Error fetching reviewers:",e)}},C=async e=>{l.value=e.value,t.value=!0;try{let e,t;l.value?(e=await qe.A.get(`/api/status-change-requests-by-reviewer/${l.value}/`),t=await qe.A.get(`/api/policy-status-change-requests-by-reviewer/${l.value}/`)):(e=await qe.A.get("/api/framework-status-change-requests/"),t=await qe.A.get("/api/policy-status-change-requests/"));const i=m(e.data),s=t.data.map(e=>({...e,RequestType:"Policy Status Change",ItemType:"policy"})),o=s,n=[...i,...o];n.forEach(e=>{e.ItemType||(e.ItemType="framework")}),a.value=n.sort((e,a)=>{const t=new Date(e.RequestDate||0),i=new Date(a.RequestDate||0);return i-t})}catch(i){console.error("Error filtering requests by reviewer:",i)}finally{t.value=!1}};return(e,n)=>((0,s.uX)(),(0,s.CE)("div",Zf,[(0,s.Lk)("div",{class:"dashboard-header"},[n[4]||(n[4]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Status Change Approval Tasks",-1)),(0,s.Lk)("div",{class:"dashboard-actions"},[(0,s.Lk)("button",{class:"action-btn",onClick:k},n[3]||(n[3]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)]))])]),(0,s.Lk)("div",eb,[(0,s.Lk)("div",ab,[(0,s.bF)(mt.A,{config:r.value,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),onChange:C},null,8,["config","modelValue"])])]),t.value?((0,s.uX)(),(0,s.CE)("div",tb,n[5]||(n[5]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading status change requests... ")]))):0===a.value.length?((0,s.uX)(),(0,s.CE)("div",ib,n[6]||(n[6]=[(0,s.Lk)("p",null,"No status change requests found.",-1)]))):((0,s.uX)(),(0,s.CE)("div",sb,[c.value.length>0?((0,s.uX)(),(0,s.Wv)(Cl,{key:0,sectionConfig:{name:"Pending",statusClass:"pending",tasks:p.value},tableHeaders:u,isExpanded:!0,onTaskClick:h},null,8,["sectionConfig"])):(0,s.Q3)("",!0),(0,s.Lk)("div",ob,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.value.filter(e=>"Pending Approval"!==e.Status),e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ApprovalId,class:"framework-card"},[(0,s.Lk)("div",lb,[(0,s.Lk)("i",{class:(0,d.C4)("policy"===e.ItemType?"fas fa-file-alt":"fas fa-book")},null,2),(0,s.Lk)("span",null,(0,d.v_)(e.FrameworkName||e.PolicyName),1)]),(0,s.Lk)("div",nb,(0,d.v_)("policy"===e.ItemType?"Department":"Category")+": "+(0,d.v_)(e.Category||e.Department),1),(0,s.Lk)("div",rb,(0,d.v_)(e.Reason),1),(0,s.Lk)("div",cb,[(0,s.Lk)("div",db,[(0,s.Lk)("input",{type:"checkbox",checked:"Approved"===e.Status,disabled:""},null,8,ub),(0,s.Lk)("span",{class:(0,d.C4)(["switch-label",{active:"Rejected"===e.Status||"Pending Approval"===e.Status,inactive:"Approved"===e.Status}])},(0,d.v_)("Approved"===e.Status?"Inactive":"Rejected"===e.Status?"Active":"Pending"),3)]),(0,s.Lk)("div",pb,[(0,s.Lk)("button",{class:"view-btn",onClick:a=>h(e)},n[7]||(n[7]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,vb)])])]))),128))])])),i.value&&o.value?((0,s.uX)(),(0,s.CE)("div",mb,[(0,s.Lk)("div",kb,[(0,s.Lk)("span",{class:"close-x",onClick:g,title:"Close"},"Ã—"),(0,s.Lk)("h3",null,[(0,s.Lk)("span",hb,(0,d.v_)("policy"===o.value.ItemType?"POLICY":"FRAMEWORK")+" STATUS CHANGE REQUEST ",1),(0,s.eW)(" Details: "+(0,d.v_)(o.value.FrameworkName||o.value.PolicyName)+" ",1),(0,s.Lk)("span",gb,"Version: "+(0,d.v_)(o.value.Version),1)]),(0,s.Lk)("div",yb,[n[13]||(n[13]=(0,s.Lk)("h4",null,"Status Change Approval",-1)),n[14]||(n[14]=(0,s.Lk)("div",{class:"framework-status-indicator"},[(0,s.Lk)("span",{class:"status-label"},"Request Type:"),(0,s.Lk)("span",{class:"status-value status-inactive"}," Change Status to Inactive ")],-1)),(0,s.Lk)("div",fb,[n[8]||(n[8]=(0,s.Lk)("span",{class:"status-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",{"status-approved":"Approved"===o.value.Status,"status-inactive":"Rejected"===o.value.Status,"status-pending":"Pending Approval"===o.value.Status}])},(0,d.v_)(o.value.Status),3)]),"Pending Approval"===o.value.Status?((0,s.uX)(),(0,s.CE)("div",bb,[(0,s.Lk)("button",{class:"approve-btn",onClick:n[1]||(n[1]=e=>y(o.value))},n[9]||(n[9]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve (Make Inactive) ")])),(0,s.Lk)("button",{class:"reject-btn",onClick:n[2]||(n[2]=e=>f(o.value))},n[10]||(n[10]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject (Keep Active) ")]))])):((0,s.uX)(),(0,s.CE)("div",Cb,[o.value.Remarks?((0,s.uX)(),(0,s.CE)("div",Lb,[n[11]||(n[11]=(0,s.Lk)("strong",null,"Remarks:",-1)),(0,s.eW)(" "+(0,d.v_)(o.value.Remarks),1)])):(0,s.Q3)("",!0),o.value.ApprovedDate?((0,s.uX)(),(0,s.CE)("div",wb,[n[12]||(n[12]=(0,s.Lk)("strong",null,"Date:",-1)),(0,s.eW)(" "+(0,d.v_)(v(o.value.ApprovedDate)),1)])):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",Eb,[(0,s.Lk)("div",Rb,[(0,s.Lk)("strong",null,(0,d.v_)("policy"===o.value.ItemType?"Policy":"Framework")+" Name:",1),(0,s.Lk)("span",null,(0,d.v_)(o.value.FrameworkName||o.value.PolicyName),1)]),(0,s.Lk)("div",Db,[(0,s.Lk)("strong",null,(0,d.v_)("policy"===o.value.ItemType?"Department":"Category")+":",1),(0,s.Lk)("span",null,(0,d.v_)(o.value.Category||o.value.Department),1)]),(0,s.Lk)("div",Ib,[n[15]||(n[15]=(0,s.Lk)("strong",null,"Request Date:",-1)),n[16]||(n[16]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(v(o.value.RequestDate)),1)]),(0,s.Lk)("div",Pb,[n[17]||(n[17]=(0,s.Lk)("strong",null,"Current Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)({"status-active":"Rejected"===o.value.Status||"Pending Approval"===o.value.Status,"status-inactive":"Approved"===o.value.Status})},(0,d.v_)("Approved"===o.value.Status?"Inactive":"Active"),3)]),(0,s.Lk)("div",_b,[n[18]||(n[18]=(0,s.Lk)("strong",null,"Reason for Change:",-1)),n[19]||(n[19]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(o.value.Reason),1)]),"framework"===o.value.ItemType?((0,s.uX)(),(0,s.CE)("div",Sb,[n[20]||(n[20]=(0,s.Lk)("strong",null,"Cascade to Policies:",-1)),(0,s.Lk)("span",{class:(0,d.C4)({"cascade-yes":o.value.CascadeToApproved,"cascade-no":!o.value.CascadeToApproved})},[(0,s.eW)((0,d.v_)(o.value.CascadeToApproved?"Yes":"No")+" ",1),o.value.PolicyCount>0?((0,s.uX)(),(0,s.CE)("span",Ab," ("+(0,d.v_)(o.value.PolicyCount)+" policies will be affected) ",1)):(0,s.Q3)("",!0)],2)])):(0,s.Q3)("",!0),"policy"===o.value.ItemType?((0,s.uX)(),(0,s.CE)("div",Tb,[n[21]||(n[21]=(0,s.Lk)("strong",null,"Cascade to Subpolicies:",-1)),(0,s.Lk)("span",{class:(0,d.C4)({"cascade-yes":o.value.CascadeToSubpolicies,"cascade-no":!o.value.CascadeToSubpolicies})},[(0,s.eW)((0,d.v_)(o.value.CascadeToSubpolicies?"Yes":"No")+" ",1),o.value.SubpolicyCount>0?((0,s.uX)(),(0,s.CE)("span",xb," ("+(0,d.v_)(o.value.SubpolicyCount)+" subpolicies will be affected) ",1)):(0,s.Q3)("",!0)],2)])):(0,s.Q3)("",!0)]),o.value.AffectedPolicies&&o.value.AffectedPolicies.length>0||o.value.AffectedSubpolicies&&o.value.AffectedSubpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",Fb,[(0,s.Lk)("h4",null,(0,d.v_)("policy"===o.value.ItemType?"Affected Subpolicies":"Affected Policies"),1),(0,s.Lk)("p",Vb,["Approved"===o.value.Status?((0,s.uX)(),(0,s.CE)("span",Mb," The following "+(0,d.v_)("policy"===o.value.ItemType?"subpolicies":"policies")+" have been set to Inactive: ",1)):((0,s.uX)(),(0,s.CE)("span",Xb," The following "+(0,d.v_)("policy"===o.value.ItemType?"subpolicies":"policies")+" will become inactive if this request is approved: ",1))]),(0,s.Lk)("div",Ub,["framework"===o.value.ItemType?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.value.AffectedPolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.PolicyId,class:"policy-item"},[(0,s.Lk)("div",Nb,[(0,s.Lk)("span",$b,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{active:"Approved"!==o.value.Status,inactive:"Approved"===o.value.Status}])},(0,d.v_)("Approved"===o.value.Status?"Inactive":"Active"),3)]),(0,s.Lk)("div",Ob,[e.Identifier?((0,s.uX)(),(0,s.CE)("div",jb,[n[22]||(n[22]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Identifier),1)])):(0,s.Q3)("",!0),e.Department?((0,s.uX)(),(0,s.CE)("div",Bb,[n[23]||(n[23]=(0,s.Lk)("strong",null,"Department:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Department),1)])):(0,s.Q3)("",!0),e.Description?((0,s.uX)(),(0,s.CE)("div",Wb,[n[24]||(n[24]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)])):(0,s.Q3)("",!0)])]))),128)):(0,s.Q3)("",!0),"policy"===o.value.ItemType?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(o.value.AffectedSubpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.SubPolicyId,class:"policy-item"},[(0,s.Lk)("div",Qb,[(0,s.Lk)("span",qb,(0,d.v_)(e.SubPolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{active:"Approved"!==o.value.Status,inactive:"Approved"===o.value.Status}])},(0,d.v_)("Approved"===o.value.Status?"Inactive":"Active"),3)]),(0,s.Lk)("div",Kb,[e.Identifier?((0,s.uX)(),(0,s.CE)("div",Jb,[n[25]||(n[25]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Identifier),1)])):(0,s.Q3)("",!0),e.Control?((0,s.uX)(),(0,s.CE)("div",zb,[n[26]||(n[26]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Control),1)])):(0,s.Q3)("",!0),e.Description?((0,s.uX)(),(0,s.CE)("div",Hb,[n[27]||(n[27]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)])):(0,s.Q3)("",!0)])]))),128)):(0,s.Q3)("",!0)]),"Approved"!==o.value.Status?((0,s.uX)(),(0,s.CE)("div",Yb,n[28]||(n[28]=[(0,s.Lk)("div",{class:"summary-warning"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.Lk)("span",null,[(0,s.eW)("All of these policies will be changed to "),(0,s.Lk)("strong",null,"Inactive"),(0,s.eW)(" if the request is approved.")])],-1)]))):(0,s.Q3)("",!0)])):o.value.CascadeToApproved?((0,s.uX)(),(0,s.CE)("div",Gb,n[29]||(n[29]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.Lk)("span",null,"No active policies found that would be affected by this change.",-1)]))):(0,s.Q3)("",!0),"Pending Approval"===o.value.Status?((0,s.uX)(),(0,s.CE)("div",Zb,[n[37]||(n[37]=(0,s.Lk)("h4",null,"Approval Implications",-1)),(0,s.Lk)("div",eC,[n[36]||(n[36]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("div",aC,[n[32]||(n[32]=(0,s.Lk)("strong",null,"If approved:",-1)),n[33]||(n[33]=(0,s.eW)(" The framework will become ")),n[34]||(n[34]=(0,s.Lk)("span",{class:"status-inactive"},"Inactive",-1)),n[35]||(n[35]=(0,s.eW)(". ")),o.value.CascadeToApproved&&o.value.PolicyCount>0?((0,s.uX)(),(0,s.CE)("span",tC,[n[30]||(n[30]=(0,s.eW)(" Additionally, ")),(0,s.Lk)("strong",null,(0,d.v_)(o.value.PolicyCount)+" approved policies",1),n[31]||(n[31]=(0,s.eW)(" will also become inactive. "))])):(0,s.Q3)("",!0)])]),n[38]||(n[38]=(0,s.Lk)("div",{class:"implication-item info"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("div",{class:"implication-text"},[(0,s.Lk)("strong",null,"If rejected:"),(0,s.eW)(" The framework will remain "),(0,s.Lk)("span",{class:"status-approved"},"Active"),(0,s.eW)(" and no changes will be made. ")])],-1))])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.bF)(vt)]))}};const sC=(0,se.A)(iC,[["__scopeId","data-v-289e31fe"]]);var oC=sC;const lC={class:"TT-page-wrapper"},nC={class:"TT-toggle-group"},rC={key:0,class:"TT-top-dropdowns"},cC={key:0,class:"TT-error"},dC={key:1,class:"TT-loading"},uC={key:1,class:"TT-top-dropdowns"},pC={key:0,class:"TT-error"},vC={key:1,class:"TT-loading"},mC={key:2},kC={class:"TT-container"},hC={class:"TT-form-group"},gC={class:"TT-form-group"},yC={class:"TT-row"},fC={class:"TT-form-group TT-half"},bC={class:"TT-form-group TT-half"},CC={class:"TT-row"},LC={class:"TT-form-group TT-half"},wC={class:"TT-form-group TT-half"},EC={class:"TT-row"},RC={class:"TT-form-group TT-half"},DC={class:"TT-form-group TT-half"},IC={class:"TT-row"},PC={class:"TT-form-group TT-half"},_C=["value"],SC={class:"TT-form-group TT-half"},AC=["value"],TC={class:"TT-policy-tabs-container"},xC={class:"TT-policy-tabs-row"},FC={class:"TT-policy-tabs"},VC=["onClick"],MC={key:0,class:"TT-policy-form-container"},XC={class:"TT-row"},UC={class:"TT-form-group TT-half"},NC={class:"TT-form-group TT-half"},$C={class:"TT-form-group"},OC={class:"TT-row"},jC={class:"TT-form-group TT-half"},BC={class:"TT-form-group TT-half"},WC={class:"TT-form-group"},QC={class:"TT-row"},qC={class:"TT-form-group TT-half"},KC={class:"TT-form-group TT-half"},JC={class:"TT-row"},zC={class:"TT-form-group TT-half"},HC=["disabled"],YC=["value"],GC={class:"TT-form-group TT-half"},ZC=["disabled"],eL=["value"],aL={class:"TT-row"},tL={class:"TT-form-group TT-half"},iL=["disabled"],sL=["value"],oL={class:"TT-form-group TT-half"},lL={class:"form-row"},nL={class:"form-group entities-group"},rL={class:"entities-dropdown"},cL={class:"entity-content"},dL={key:0,class:"loading-text"},uL={key:1,class:"entity-tag all-tag"},pL={key:2,class:"placeholder"},vL={key:3,class:"entity-count"},mL={key:0,class:"entities-options"},kL={key:0,class:"entities-loading"},hL={key:1,class:"entities-error"},gL=["onClick"],yL=["checked","onChange"],fL={class:"entity-label"},bL={key:0,class:"TT-error-text"},CL={class:"TT-row"},LL={class:"TT-form-group TT-half"},wL={class:"TT-form-group TT-half"},EL={class:"TT-form-group"},RL={key:0,class:"TT-subpolicy-tabs-container"},DL={class:"TT-subpolicy-tabs-row"},IL={class:"TT-subpolicy-tabs"},PL=["onClick"],_L={key:0,class:"TT-subpolicy-form-container"},SL={class:"TT-form-group"},AL={class:"TT-form-group"},TL={class:"TT-form-group"},xL={class:"TT-form-group"},FL={key:3},VL={key:4,class:"TT-universal-submit-wrapper"},ML={key:5},XL={class:"TT-policy-tabs-container"},UL={class:"TT-policy-tabs-row"},NL={class:"TT-policy-tabs"},$L=["onClick"],OL={key:0,class:"TT-policy-form-container"},jL={class:"TT-row"},BL={class:"TT-form-group TT-half"},WL={class:"TT-form-group TT-half"},QL={class:"TT-form-group"},qL={class:"TT-row"},KL={class:"TT-form-group TT-half"},JL={class:"TT-form-group TT-half"},zL={class:"TT-form-group"},HL={class:"TT-row"},YL={class:"TT-form-group TT-half"},GL={class:"TT-form-group TT-half"},ZL={class:"TT-row"},ew={class:"TT-form-group TT-half"},aw=["disabled"],tw=["value"],iw={class:"TT-form-group TT-half"},sw=["disabled"],ow=["value"],lw={class:"TT-row"},nw={class:"TT-form-group TT-half"},rw=["disabled"],cw=["value"],dw={class:"TT-form-group TT-half"},uw={class:"form-row"},pw={class:"form-group entities-group"},vw={class:"entities-dropdown"},mw={class:"entity-content"},kw={key:0,class:"loading-text"},hw={key:1,class:"entity-tag all-tag"},gw={key:2,class:"placeholder"},yw={key:3,class:"entity-count"},fw={key:0,class:"entities-options"},bw={key:0,class:"entities-loading"},Cw={key:1,class:"entities-error"},Lw=["onClick"],ww=["checked","onChange"],Ew={class:"entity-label"},Rw={class:"TT-row"},Dw={class:"TT-form-group TT-half"},Iw={class:"TT-form-group TT-half"},Pw={class:"TT-form-group"},_w={key:0,class:"TT-row"},Sw={class:"TT-form-group TT-half"},Aw=["value"],Tw={class:"TT-form-group TT-half"},xw=["value"],Fw={key:0,class:"TT-subpolicy-tabs-container"},Vw={class:"TT-subpolicy-tabs-row"},Mw={class:"TT-subpolicy-tabs"},Xw=["onClick"],Uw={key:0,class:"TT-subpolicy-form-container"},Nw={class:"TT-form-group"},$w={class:"TT-form-group"},Ow={class:"TT-form-group"},jw={class:"TT-form-group"},Bw={key:6,class:"TT-universal-submit-wrapper"};function Ww(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)("div",lC,[(0,s.bF)(r),a[184]||(a[184]=(0,s.Lk)("div",{class:"tt-page-header"},[(0,s.Lk)("h2",null,"Tailoring & Templating"),(0,s.Lk)("p",{class:"tt-page-description"},"Only Internal Frameworks can be tailored")],-1)),(0,s.Lk)("div",nC,[(0,s.Lk)("button",{class:(0,d.C4)(["TT-toggle",{"TT-active":"framework"===l.selectedTab}]),onClick:a[0]||(a[0]=e=>n.selectTab("framework"))},"Framework",2),(0,s.Lk)("button",{class:(0,d.C4)(["TT-toggle",{"TT-active":"policy"===l.selectedTab}]),onClick:a[1]||(a[1]=e=>n.selectTab("policy"))},"Policy",2)]),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",rC,[(0,s.bF)(c,{modelValue:l.selectedFramework,"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:`${e.name} (${e.category||"No Category"}) - ${e.status||"No Status"}`})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"340px"}},null,8,["modelValue","config"]),l.error?((0,s.uX)(),(0,s.CE)("div",cC,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("div",dC,"Loading...")):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",uC,[(0,s.bF)(c,{modelValue:l.selectedFramework,"onUpdate:modelValue":a[3]||(a[3]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:`${e.name} (${e.category||"No Category"}) - ${e.status||"No Status"}`})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"]),(0,s.bF)(c,{modelValue:l.selectedPolicy,"onUpdate:modelValue":a[4]||(a[4]=e=>l.selectedPolicy=e),config:{label:"Policy",values:l.policies.map(e=>({value:e.id,label:`${e.name} (${e.status||"No Status"})`})),defaultLabel:"Select Policy"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"]),l.error?((0,s.uX)(),(0,s.CE)("div",pC,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("div",vC,"Loading...")):(0,s.Q3)("",!0)])),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",mC,[(0,s.Lk)("div",kC,[(0,s.Lk)("form",{onSubmit:a[15]||(a[15]=(0,i.D$)((...a)=>e.submitFramework&&e.submitFramework(...a),["prevent"]))},[(0,s.Lk)("div",hC,[a[79]||(a[79]=(0,s.Lk)("label",{class:"TT-label"},"FRAMEWORK NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[5]||(a[5]=e=>l.frameworkForm.name=e),type:"text",required:"",placeholder:"Enter Framework name"},null,512),[[i.Jo,l.frameworkForm.name]]),a[80]||(a[80]=(0,s.Lk)("small",{class:"TT-desc"},"Enter a descriptive name for your framework",-1))]),(0,s.Lk)("div",gC,[a[81]||(a[81]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[6]||(a[6]=e=>l.frameworkForm.description=e),rows:"3",required:"",placeholder:"Enter framework description"},null,512),[[i.Jo,l.frameworkForm.description]]),a[82]||(a[82]=(0,s.Lk)("small",{class:"TT-desc"},"Describe the purpose, scope, and objectives of this framework",-1))]),(0,s.Lk)("div",yC,[(0,s.Lk)("div",fC,[a[83]||(a[83]=(0,s.Lk)("label",{class:"TT-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[7]||(a[7]=e=>l.frameworkForm.identifier=e),type:"text",required:"",placeholder:"Enter Identifier"},null,512),[[i.Jo,l.frameworkForm.identifier]]),a[84]||(a[84]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'FW-001' or 'ISO-27001'",-1))]),(0,s.Lk)("div",bC,[a[85]||(a[85]=(0,s.Lk)("label",{class:"TT-label"},"CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[8]||(a[8]=e=>l.frameworkForm.category=e),type:"text",required:"",placeholder:"Enter category"},null,512),[[i.Jo,l.frameworkForm.category]]),a[86]||(a[86]=(0,s.Lk)("small",{class:"TT-desc"},"e.g., Security, Compliance, Risk Management, etc.",-1))])]),(0,s.Lk)("div",CC,[(0,s.Lk)("div",LC,[a[88]||(a[88]=(0,s.Lk)("label",{class:"TT-label"},"INTERNAL/EXTERNAL *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[9]||(a[9]=e=>l.frameworkForm.internalExternal=e),required:""},a[87]||(a[87]=[(0,s.Lk)("option",{value:"",disabled:""},"Select Type",-1),(0,s.Lk)("option",{value:"Internal"},"Internal",-1),(0,s.Lk)("option",{value:"External"},"External",-1)]),512),[[i.u1,l.frameworkForm.internalExternal]]),a[89]||(a[89]=(0,s.Lk)("small",{class:"TT-desc"},"Select whether this framework is for internal or external use",-1))]),(0,s.Lk)("div",wC,[a[90]||(a[90]=(0,s.Lk)("label",{class:"TT-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"TT-input",type:"file",onChange:a[10]||(a[10]=(...e)=>n.handleFileUpload&&n.handleFileUpload(...e))},null,32),a[91]||(a[91]=(0,s.Lk)("small",{class:"TT-desc"},"Upload a supporting document for this framework (optional)",-1))])]),(0,s.Lk)("div",EC,[(0,s.Lk)("div",RC,[a[92]||(a[92]=(0,s.Lk)("label",{class:"TT-label"},"EFFECTIVE START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[11]||(a[11]=e=>l.frameworkForm.startDate=e),type:"date",required:""},null,512),[[i.Jo,l.frameworkForm.startDate]]),a[93]||(a[93]=(0,s.Lk)("small",{class:"TT-desc"},"Date when the framework implementation begins",-1))]),(0,s.Lk)("div",DC,[a[94]||(a[94]=(0,s.Lk)("label",{class:"TT-label"},"EFFECTIVE END DATE",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[12]||(a[12]=e=>l.frameworkForm.endDate=e),type:"date"},null,512),[[i.Jo,l.frameworkForm.endDate]]),a[95]||(a[95]=(0,s.Lk)("small",{class:"TT-desc"},"Date when the framework expires or requires review",-1))])]),(0,s.Lk)("div",IC,[(0,s.Lk)("div",PC,[a[97]||(a[97]=(0,s.Lk)("label",{class:"TT-label"},"CREATED BY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[13]||(a[13]=e=>l.frameworkForm.createdByName=e),required:""},[a[96]||(a[96]=(0,s.Lk)("option",{value:""},"Select Creator",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,_C))),128))],512),[[i.u1,l.frameworkForm.createdByName]]),a[98]||(a[98]=(0,s.Lk)("small",{class:"TT-desc"},"Select who created this framework",-1))]),(0,s.Lk)("div",SC,[a[100]||(a[100]=(0,s.Lk)("label",{class:"TT-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[14]||(a[14]=e=>l.frameworkForm.reviewer=e),required:""},[a[99]||(a[99]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,AC))),128))],512),[[i.u1,l.frameworkForm.reviewer]]),a[101]||(a[101]=(0,s.Lk)("small",{class:"TT-desc"},"Select who will review this framework",-1))])])],32)]),(0,s.Lk)("div",TC,[(0,s.Lk)("div",xC,[(0,s.Lk)("div",FC,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-policy-tab",{"TT-policy-tab-active":a===l.activePolicyTab}]),onClick:e=>l.activePolicyTab=a}," Policy "+(0,d.v_)(a+1),11,VC))),128)),(0,s.Lk)("button",{class:"TT-add-policy-tab",onClick:a[16]||(a[16]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",MC,[(0,s.Lk)("button",{class:"TT-exclude-policy-btn",onClick:a[17]||(a[17]=e=>n.excludePolicyTab(l.activePolicyTab))},"Exclude"),((0,s.uX)(),(0,s.CE)("form",{onSubmit:a[38]||(a[38]=(0,i.D$)(e=>n.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",XC,[(0,s.Lk)("div",UC,[a[102]||(a[102]=(0,s.Lk)("label",{class:"TT-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[18]||(a[18]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].name]]),a[103]||(a[103]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",NC,[a[104]||(a[104]=(0,s.Lk)("label",{class:"TT-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[19]||(a[19]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].identifier]]),a[105]||(a[105]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",$C,[a[106]||(a[106]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[20]||(a[20]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].description]]),a[107]||(a[107]=(0,s.Lk)("small",{class:"TT-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",OC,[(0,s.Lk)("div",jC,[a[108]||(a[108]=(0,s.Lk)("label",{class:"TT-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[21]||(a[21]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].scope]]),a[109]||(a[109]=(0,s.Lk)("small",{class:"TT-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",BC,[a[110]||(a[110]=(0,s.Lk)("label",{class:"TT-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[22]||(a[22]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].department]]),a[111]||(a[111]=(0,s.Lk)("small",{class:"TT-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",WC,[a[112]||(a[112]=(0,s.Lk)("label",{class:"TT-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[23]||(a[23]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].objective]]),a[113]||(a[113]=(0,s.Lk)("small",{class:"TT-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",QC,[(0,s.Lk)("div",qC,[a[114]||(a[114]=(0,s.Lk)("label",{class:"TT-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[24]||(a[24]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),a[115]||(a[115]=(0,s.Lk)("small",{class:"TT-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",KC,[a[116]||(a[116]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[25]||(a[25]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].applicability]]),a[117]||(a[117]=(0,s.Lk)("small",{class:"TT-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",JC,[(0,s.Lk)("div",zC,[a[119]||(a[119]=(0,s.Lk)("label",{class:"TT-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[26]||(a[26]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:a[27]||(a[27]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),disabled:l.policyTabs[l.activePolicyTab].exclude,required:""},[a[118]||(a[118]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,YC))),128))],40,HC),[[i.u1,l.policyTabs[l.activePolicyTab].type]])]),(0,s.Lk)("div",GC,[a[121]||(a[121]=(0,s.Lk)("label",{class:"TT-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[28]||(a[28]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:a[29]||(a[29]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type||l.policyTabs[l.activePolicyTab].exclude,required:""},[a[120]||(a[120]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getCategoriesForType(l.policyTabs[l.activePolicyTab].type),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,eL))),128))],40,ZC),[[i.u1,l.policyTabs[l.activePolicyTab].category]])])]),(0,s.Lk)("div",aL,[(0,s.Lk)("div",tL,[a[123]||(a[123]=(0,s.Lk)("label",{class:"TT-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[30]||(a[30]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),onChange:a[31]||(a[31]=e=>n.handlePolicySubCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].category||l.policyTabs[l.activePolicyTab].exclude,required:""},[a[122]||(a[122]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSubCategoriesForCategory(l.policyTabs[l.activePolicyTab].type,l.policyTabs[l.activePolicyTab].category),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,sL))),128))],40,iL),[[i.u1,l.policyTabs[l.activePolicyTab].subCategory]])]),(0,s.Lk)("div",oL,[a[125]||(a[125]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",lL,[(0,s.Lk)("div",nL,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:a[34]||(a[34]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",rL,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:a[32]||(a[32]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",cL,[l.loading?((0,s.uX)(),(0,s.CE)("span",dL," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",uL," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",pL," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",vL,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),a[124]||(a[124]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",mL,[l.loading?((0,s.uX)(),(0,s.CE)("div",kL," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",hL,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:a=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:a=>n.handleEntitySelection(l.activePolicyTab,e.id,a.target.checked),onClick:a[33]||(a[33]=(0,i.D$)(()=>{},["stop"]))},null,40,yL),(0,s.Lk)("span",fL,(0,d.v_)(e.label),1)],10,gL))),128))])):(0,s.Q3)("",!0)])])])]),l.error&&l.error.includes("entities")?((0,s.uX)(),(0,s.CE)("small",bL,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",CL,[(0,s.Lk)("div",LL,[a[126]||(a[126]=(0,s.Lk)("label",{class:"TT-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[35]||(a[35]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].startDate]]),a[127]||(a[127]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",wL,[a[128]||(a[128]=(0,s.Lk)("label",{class:"TT-label"},"END DATE",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[36]||(a[36]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].endDate]]),a[129]||(a[129]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("div",EL,[a[130]||(a[130]=(0,s.Lk)("label",{class:"TT-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"TT-input",type:"file",onChange:a[37]||(a[37]=e=>n.handlePolicyFileUpload(e,l.activePolicyTab))},null,32),a[131]||(a[131]=(0,s.Lk)("small",{class:"TT-desc"},"Upload supporting documentation (optional)",-1))])],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",RL,[(0,s.Lk)("div",DL,[(0,s.Lk)("div",IL,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-subpolicy-tab",{"TT-subpolicy-tab-active":a===l.policyTabs[l.activePolicyTab].activeSubPolicyTab}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=a}," Subpolicy "+(0,d.v_)(a+1),11,PL))),128)),(0,s.Lk)("button",{class:"TT-add-subpolicy-tab",onClick:a[39]||(a[39]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",_L,[(0,s.Lk)("button",{class:"TT-exclude-subpolicy-btn",onClick:a[40]||(a[40]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},"Exclude"),(0,s.Lk)("form",null,[(0,s.Lk)("div",SL,[a[132]||(a[132]=(0,s.Lk)("label",{class:"TT-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[41]||(a[41]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),a[133]||(a[133]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",AL,[a[134]||(a[134]=(0,s.Lk)("label",{class:"TT-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[42]||(a[42]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),a[135]||(a[135]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",TL,[a[136]||(a[136]=(0,s.Lk)("label",{class:"TT-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[43]||(a[43]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),a[137]||(a[137]=(0,s.Lk)("small",{class:"TT-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",xL,[a[138]||(a[138]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[44]||(a[44]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),a[139]||(a[139]=(0,s.Lk)("small",{class:"TT-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):"framework"!==l.selectedTab||l.selectedFramework?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",FL)),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",VL,[(0,s.Lk)("button",{class:"TT-universal-submit-btn",onClick:a[45]||(a[45]=(...e)=>n.submitTailoredFramework&&n.submitTailoredFramework(...e))},"Submit")])):(0,s.Q3)("",!0),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",ML,[(0,s.Lk)("div",XL,[(0,s.Lk)("div",UL,[(0,s.Lk)("div",NL,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-policy-tab",{"TT-policy-tab-active":a===l.activePolicyTab}]),onClick:e=>l.activePolicyTab=a}," Policy "+(0,d.v_)(a+1),11,$L))),128)),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"TT-add-policy-tab",onClick:a[46]||(a[46]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")):(0,s.Q3)("",!0)])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",OL,["framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"TT-exclude-policy-btn",onClick:a[47]||(a[47]=e=>n.excludePolicyTab(l.activePolicyTab))},"Exclude")):(0,s.Q3)("",!0),((0,s.uX)(),(0,s.CE)("form",{onSubmit:a[71]||(a[71]=(0,i.D$)(e=>n.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",jL,[(0,s.Lk)("div",BL,[a[140]||(a[140]=(0,s.Lk)("label",{class:"TT-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[48]||(a[48]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].name]]),a[141]||(a[141]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",WL,[a[142]||(a[142]=(0,s.Lk)("label",{class:"TT-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[49]||(a[49]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].identifier]]),a[143]||(a[143]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",QL,[a[144]||(a[144]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[50]||(a[50]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].description]]),a[145]||(a[145]=(0,s.Lk)("small",{class:"TT-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",qL,[(0,s.Lk)("div",KL,[a[146]||(a[146]=(0,s.Lk)("label",{class:"TT-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[51]||(a[51]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].scope]]),a[147]||(a[147]=(0,s.Lk)("small",{class:"TT-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",JL,[a[148]||(a[148]=(0,s.Lk)("label",{class:"TT-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[52]||(a[52]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].department]]),a[149]||(a[149]=(0,s.Lk)("small",{class:"TT-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",zL,[a[150]||(a[150]=(0,s.Lk)("label",{class:"TT-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[53]||(a[53]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].objective]]),a[151]||(a[151]=(0,s.Lk)("small",{class:"TT-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",HL,[(0,s.Lk)("div",YL,[a[152]||(a[152]=(0,s.Lk)("label",{class:"TT-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[54]||(a[54]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),a[153]||(a[153]=(0,s.Lk)("small",{class:"TT-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",GL,[a[154]||(a[154]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[55]||(a[55]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].applicability]]),a[155]||(a[155]=(0,s.Lk)("small",{class:"TT-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",ZL,[(0,s.Lk)("div",ew,[a[157]||(a[157]=(0,s.Lk)("label",{class:"TT-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[56]||(a[56]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:a[57]||(a[57]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),disabled:l.policyTabs[l.activePolicyTab].exclude,required:""},[a[156]||(a[156]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,tw))),128))],40,aw),[[i.u1,l.policyTabs[l.activePolicyTab].type]])]),(0,s.Lk)("div",iw,[a[159]||(a[159]=(0,s.Lk)("label",{class:"TT-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[58]||(a[58]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:a[59]||(a[59]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type||l.policyTabs[l.activePolicyTab].exclude,required:""},[a[158]||(a[158]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getCategoriesForType(l.policyTabs[l.activePolicyTab].type),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ow))),128))],40,sw),[[i.u1,l.policyTabs[l.activePolicyTab].category]])])]),(0,s.Lk)("div",lw,[(0,s.Lk)("div",nw,[a[161]||(a[161]=(0,s.Lk)("label",{class:"TT-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[60]||(a[60]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),onChange:a[61]||(a[61]=e=>n.handlePolicySubCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].category||l.policyTabs[l.activePolicyTab].exclude,required:""},[a[160]||(a[160]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSubCategoriesForCategory(l.policyTabs[l.activePolicyTab].type,l.policyTabs[l.activePolicyTab].category),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,cw))),128))],40,rw),[[i.u1,l.policyTabs[l.activePolicyTab].subCategory]])]),(0,s.Lk)("div",dw,[a[163]||(a[163]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",uw,[(0,s.Lk)("div",pw,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:a[64]||(a[64]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",vw,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:a[62]||(a[62]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",mw,[l.loading?((0,s.uX)(),(0,s.CE)("span",kw," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",hw," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",gw," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",yw,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),a[162]||(a[162]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",fw,[l.loading?((0,s.uX)(),(0,s.CE)("div",bw," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",Cw,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:a=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:a=>n.handleEntitySelection(l.activePolicyTab,e.id,a.target.checked),onClick:a[63]||(a[63]=(0,i.D$)(()=>{},["stop"]))},null,40,ww),(0,s.Lk)("span",Ew,(0,d.v_)(e.label),1)],10,Lw))),128))])):(0,s.Q3)("",!0)])])])])])]),(0,s.Lk)("div",Rw,[(0,s.Lk)("div",Dw,[a[164]||(a[164]=(0,s.Lk)("label",{class:"TT-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[65]||(a[65]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].startDate]]),a[165]||(a[165]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",Iw,[a[166]||(a[166]=(0,s.Lk)("label",{class:"TT-label"},"END DATE",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[66]||(a[66]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].endDate]]),a[167]||(a[167]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("div",Pw,[a[168]||(a[168]=(0,s.Lk)("label",{class:"TT-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"TT-input",type:"file",onChange:a[67]||(a[67]=e=>n.handlePolicyFileUpload(e,l.activePolicyTab))},null,32),a[169]||(a[169]=(0,s.Lk)("small",{class:"TT-desc"},"Upload supporting documentation (optional)",-1))]),"policy"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",_w,[(0,s.Lk)("div",Sw,[a[171]||(a[171]=(0,s.Lk)("label",{class:"TT-label"},"CREATED BY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[68]||(a[68]=e=>l.policyTabs[l.activePolicyTab].createdByName=e),required:"",onChange:a[69]||(a[69]=(...e)=>n.handleCreatedByNameChange&&n.handleCreatedByNameChange(...e))},[a[170]||(a[170]=(0,s.Lk)("option",{value:""},"Select Creator",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Aw))),128))],544),[[i.u1,l.policyTabs[l.activePolicyTab].createdByName]]),a[172]||(a[172]=(0,s.Lk)("small",{class:"TT-desc"},"Select who created this policy",-1))]),(0,s.Lk)("div",Tw,[a[174]||(a[174]=(0,s.Lk)("label",{class:"TT-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":a[70]||(a[70]=e=>l.policyTabs[l.activePolicyTab].reviewer=e),required:""},[a[173]||(a[173]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,xw))),128))],512),[[i.u1,l.policyTabs[l.activePolicyTab].reviewer]]),a[175]||(a[175]=(0,s.Lk)("small",{class:"TT-desc"},"Select who will review this policy",-1))])])):(0,s.Q3)("",!0)],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",Fw,[(0,s.Lk)("div",Vw,[(0,s.Lk)("div",Mw,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-subpolicy-tab",{"TT-subpolicy-tab-active":a===l.policyTabs[l.activePolicyTab].activeSubPolicyTab}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=a}," Subpolicy "+(0,d.v_)(a+1),11,Xw))),128)),(0,s.Lk)("button",{class:"TT-add-subpolicy-tab",onClick:a[72]||(a[72]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",Uw,[(0,s.Lk)("button",{class:"TT-exclude-subpolicy-btn",onClick:a[73]||(a[73]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},"Exclude"),(0,s.Lk)("form",null,[(0,s.Lk)("div",Nw,[a[176]||(a[176]=(0,s.Lk)("label",{class:"TT-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[74]||(a[74]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),a[177]||(a[177]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",$w,[a[178]||(a[178]=(0,s.Lk)("label",{class:"TT-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":a[75]||(a[75]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),a[179]||(a[179]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",Ow,[a[180]||(a[180]=(0,s.Lk)("label",{class:"TT-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[76]||(a[76]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),a[181]||(a[181]=(0,s.Lk)("small",{class:"TT-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",jw,[a[182]||(a[182]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":a[77]||(a[77]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[i.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),a[183]||(a[183]=(0,s.Lk)("small",{class:"TT-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",Bw,[(0,s.Lk)("button",{class:"TT-universal-submit-btn",onClick:a[78]||(a[78]=(...e)=>n.submitTailoredPolicy&&n.submitTailoredPolicy(...e))},"Submit")])):(0,s.Q3)("",!0)])}const Qw="http://localhost:8000/api";var qw={name:"TT",components:{CustomDropdown:mt.A},data(){return{selectedTab:"framework",selectedFramework:"",selectedPolicy:"",frameworks:[],policies:[],policyTypes:[],policyCategories:[],policySubCategories:[],policyData:[],users:[],frameworkForm:{name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:"",createdByName:"",reviewer:""},policyTabs:[],activePolicyTab:0,loading:!1,error:null,entities:[]}},watch:{selectedFramework(e){this.handleFrameworkSelection(e)},selectedPolicy(e){"policy"===this.selectedTab&&this.selectedFramework&&e&&this.fetchPolicyDetails(e)},selectedTab(e){"framework"===e?(this.selectedPolicy="",this.fetchFrameworks(),this.selectedFramework&&this.handleFrameworkSelection(this.selectedFramework)):"policy"===e&&(this.selectedPolicy="",this.policyTabs=[],this.fetchFrameworks())},"policyTabs[activePolicyTab].type":{immediate:!0,handler(e){console.log("Policy type changed to:",e),this.updatePolicyCategoriesByType(e)}},"policyTabs[activePolicyTab].category":{immediate:!0,handler(e){console.log("Policy category changed to:",e);const a=this.policyTabs[this.activePolicyTab]?.type;this.updateSubCategoriesByCategory(a,e)}}},async created(){try{await Promise.all([this.fetchFrameworks(),this.fetchPolicyCategories(),this.fetchEntities(),this.fetchUsers()])}catch(e){console.error("Error in component creation:",e),this.error="Failed to initialize component"}},methods:{selectTab(e){this.selectedTab=e},handleFileUpload(e){this.frameworkForm.file=e.target.files[0]},async fetchFrameworks(){try{this.loading=!0;const e=await qe.A.get(`${Qw}/frameworks/`);console.log("Raw framework response:",e.data);const a=e.data.map(e=>({id:e.FrameworkId,name:e.FrameworkName,description:e.FrameworkDescription,category:e.Category,internalExternal:e.InternalExternal,startDate:e.StartDate,endDate:e.EndDate,status:e.Status}));this.frameworks="framework"===this.selectedTab?a.filter(e=>"Internal"===e.internalExternal):a,console.log("Mapped frameworks:",this.frameworks)}catch(e){console.error("Error fetching frameworks:",e),this.error="Failed to fetch frameworks"}finally{this.loading=!1}},async fetchPoliciesByFramework(e){try{this.loading=!0;const a=await qe.A.get(`${Qw}/frameworks/${e}/get-policies/`);console.log("Raw policies response:",a.data),this.policies=a.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive).map(e=>({id:e.PolicyId,name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate})),console.log("Mapped and filtered policies:",this.policies)}catch(a){console.error("Error fetching policies:",a),this.error="Failed to fetch policies"}finally{this.loading=!1}},async fetchPolicyDetails(e){try{this.loading=!0;const[a,t]=await Promise.all([qe.A.get(`${Qw}/policies/${e}/`),qe.A.get(`${Qw}/policies/${e}/get-subpolicies/`)]);console.log("Raw policy details:",a.data),console.log("Raw subpolicies:",t.data);const i=a.data,s=t.data.map(e=>({id:e.SubPolicyId,name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status})),o={id:i.PolicyId,name:i.PolicyName,description:i.PolicyDescription,status:i.Status,department:i.Department,scope:i.Scope,objective:i.Objective,identifier:i.Identifier,coverageRate:i.CoverageRate,applicability:i.Applicability,type:i.PolicyType,category:i.PolicyCategory,subCategory:i.PolicySubCategory,entities:i.Entities,startDate:i.StartDate,endDate:i.EndDate,file:null,createdByName:i.CreatedByName,reviewer:i.Reviewer,subPolicies:s,activeSubPolicyTab:0};this.policyTabs=[o],this.activePolicyTab=0}catch(a){console.error("Error fetching policy details:",a),this.error="Failed to fetch policy details"}finally{this.loading=!1}},async submitTailoredFramework(){if(this.validateForm("framework"))try{this.loading=!0;const e={title:this.frameworkForm.name,description:this.frameworkForm.description,identifier:this.frameworkForm.identifier,category:this.frameworkForm.category,internalExternal:this.frameworkForm.internalExternal,startDate:this.frameworkForm.startDate,endDate:this.frameworkForm.endDate,createdByName:this.frameworkForm.createdByName,reviewer:this.frameworkForm.reviewer,policies:this.policyTabs.map(e=>{let a=e.entities;return Array.isArray(a)&&(a=Array.from(a).map(Number)),(!a||Array.isArray(a)&&0===a.length)&&(a=[]),{title:e.name,description:e.description,identifier:e.identifier,department:e.department,scope:e.scope,objective:e.objective,coverageRate:e.coverageRate,applicability:e.applicability,PolicyType:e.type,PolicyCategory:e.category,PolicySubCategory:e.subCategory,Entities:a,startDate:e.startDate,endDate:e.endDate,createdByName:"framework"===this.selectedTab?this.frameworkForm.createdByName:e.createdByName,reviewer:"framework"===this.selectedTab?this.frameworkForm.reviewer:e.reviewer,subPolicies:e.subPolicies.map(a=>({title:a.name,identifier:a.identifier,description:a.description,control:a.control,createdByName:"framework"===this.selectedTab?this.frameworkForm.createdByName:e.createdByName}))}})};console.log("Submitting framework data:",e);const a=await qe.A.post(`${Qw}/tailoring/create-framework/`,e,{headers:{"Content-Type":"application/json"}});console.log("Framework creation response:",a.data),this.$emit("framework-created"),this.resetForm(),this.error=null,pv.OQ.success("Framework created successfully!","Success")}catch(e){console.error("Error submitting framework:",e),this.error=e.response?.data?.error||"Failed to submit framework",pv.OQ.error(this.error,"Error Creating Framework")}finally{this.loading=!1}},async submitPolicy(e){if(this.validateForm("policy"))try{this.loading=!0;const a=new FormData,t=this.policyTabs[e];Object.keys(t).forEach(e=>{"file"===e&&t[e]?a.append("file",t[e]):"subPolicies"!==e&&"activeSubPolicyTab"!==e&&a.append(e,t[e])}),t.subPolicies.forEach((e,t)=>{Object.keys(e).forEach(i=>{a.append(`subPolicies[${t}][${i}]`,e[i])})}),await qe.A.post(`${Qw}/tailoring/create-policy/`,a,{headers:{"Content-Type":"multipart/form-data"}}),this.$emit("policy-created"),this.resetForm()}catch(a){console.error("Error submitting policy:",a),this.error="Failed to submit policy"}finally{this.loading=!1}},async handleFrameworkSelection(e){if(e)try{this.loading=!0;const[a,t]=await Promise.all([qe.A.get(`${Qw}/frameworks/${e}/`),qe.A.get(`${Qw}/frameworks/${e}/get-policies/`)]);console.log("Raw framework details:",a.data),console.log("Raw framework policies:",t.data);const i=a.data;if(this.frameworkForm={name:i.FrameworkName,description:i.FrameworkDescription,identifier:i.Identifier,category:i.Category,internalExternal:i.InternalExternal,file:null,startDate:i.StartDate,endDate:i.EndDate,createdByName:i.CreatedByName,reviewer:i.Reviewer},this.policies=t.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive).map(e=>({id:e.PolicyId,name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate})),"framework"===this.selectedTab){const e=await Promise.all(t.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive).map(async e=>{const a=await qe.A.get(`${Qw}/policies/${e.PolicyId}/get-subpolicies/`);return{id:e.PolicyId,name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate,file:null,createdByName:e.CreatedByName,reviewer:e.Reviewer,activeSubPolicyTab:0,subPolicies:a.data.map(e=>({id:e.SubPolicyId,name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status}))}}));this.policyTabs=e,this.activePolicyTab=0}else this.policyTabs=[],this.activePolicyTab=0;this.selectedPolicy=""}catch(a){console.error("Error handling framework selection:",a),this.error="Failed to load framework details"}finally{this.loading=!1}else this.resetForm()},async handlePolicyFileUpload(e,a){const t=e.target.files[0];t&&(this.policyTabs[a].file=t)},addPolicyTab(){const e="framework"===this.selectedTab?this.frameworkForm.createdByName:"",a="framework"===this.selectedTab?this.frameworkForm.reviewer:"";this.policyTabs.push({id:Date.now(),name:"",identifier:"",description:"",scope:"",department:"",objective:"",coverageRate:"",applicability:"",type:"",category:"",subCategory:"",entities:[],showEntitiesDropdown:!1,startDate:"",endDate:"",file:null,createdByName:e,reviewer:a,subPolicies:[{id:Date.now(),name:"",identifier:"",control:"",description:"",createdByName:e}],activeSubPolicyTab:0}),this.activePolicyTab=this.policyTabs.length-1},excludePolicyTab(e){this.policyTabs.length>1&&(this.policyTabs.splice(e,1),this.activePolicyTab>=this.policyTabs.length&&(this.activePolicyTab=this.policyTabs.length-1))},addSubPolicyTab(e){const a=this.policyTabs[e];this.policyTabs[e].subPolicies.push({id:Date.now(),name:"",identifier:"",control:"",description:"",createdByName:a.createdByName}),this.policyTabs[e].activeSubPolicyTab=this.policyTabs[e].subPolicies.length-1},excludeSubPolicyTab(e,a){const t=this.policyTabs[e].subPolicies;t.length>1&&(t.splice(a,1),this.policyTabs[e].activeSubPolicyTab>=t.length&&(this.policyTabs[e].activeSubPolicyTab=t.length-1))},resetForm(){this.frameworkForm={name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:""},this.policyTabs=[],this.activePolicyTab=0,this.selectedFramework="",this.selectedPolicy=""},async fetchPolicyCategories(){try{this.loading=!0;const e=await qe.A.get(`${Qw}/policy-categories/`);console.log("Raw policy categories response:",e.data),this.policyData=e.data,this.policyTypes=[...new Set(e.data.map(e=>e.PolicyType))],console.log("Available policy types:",this.policyTypes)}catch(e){console.error("Error fetching policy categories:",e),this.error="Failed to fetch policy categories"}finally{this.loading=!1}},getCategoriesForType(e){if(!e||!this.policyData)return[];const a=this.policyData.filter(a=>a.PolicyType===e).map(e=>e.PolicyCategory);return[...new Set(a)]},getSubCategoriesForCategory(e,a){if(!e||!a||!this.policyData)return[];const t=this.policyData.filter(t=>t.PolicyType===e&&t.PolicyCategory===a).map(e=>e.PolicySubCategory);return[...new Set(t)]},handlePolicyTypeChange(e,a){console.log("Policy type changed:",a);const t=this.policyTabs[e];t.PolicyType=a,t.PolicyCategory="",t.PolicySubCategory="",this.policyCategories=this.getCategoriesForType(a),console.log("Updated categories:",this.policyCategories)},handlePolicyCategoryChange(e,a){console.log("Policy category changed:",a);const t=this.policyTabs[e];t.PolicyCategory=a,t.PolicySubCategory="",this.policySubCategories=this.getSubCategoriesForCategory(t.PolicyType,a),console.log("Updated subcategories:",this.policySubCategories)},handlePolicySubCategoryChange(e,a){console.log("Policy subcategory changed:",a),this.policyTabs[e].PolicySubCategory=a},updatePolicyCategoriesByType(e){if(console.log("Updating categories for type:",e),!e||!this.policyData)return this.policyCategories=[],void(this.policySubCategories=[]);const a=this.policyData.filter(a=>a.PolicyType===e);console.log("Filtered data:",a);const t=[...new Set(a.map(e=>e.PolicyCategory))];console.log("Available categories for type:",t),this.policyCategories=t,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].category="",this.policyTabs[this.activePolicyTab].subCategory=""),this.policySubCategories=[]},updateSubCategoriesByCategory(e,a){if(console.log("Updating subcategories for type:",e,"and category:",a),!e||!a||!this.policyData)return void(this.policySubCategories=[]);const t=this.policyData.filter(t=>t.PolicyType===e&&t.PolicyCategory===a);console.log("Filtered data:",t);const i=[...new Set(t.map(e=>e.PolicySubCategory))];console.log("Available subcategories:",i),this.policySubCategories=i,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].subCategory="")},async fetchEntities(){try{this.loading=!0;const e=await qe.A.get(`${Qw}/entities/`);if(console.log("Raw entities response:",e.data),!e.data.entities)throw new Error("Invalid response format");this.entities=e.data.entities.map(e=>({id:e.id,label:e.label})),console.log("Mapped entities:",this.entities)}catch(e){console.error("Error fetching entities:",e),this.error="Failed to fetch entities"}finally{this.loading=!1}},handleEntitySelection(e,a,t){if(!(e<0)&&this.policyTabs[e]){if(console.log("handleEntitySelection:",{idx:e,entityId:a,isChecked:t}),this.policyTabs[e].entities||(this.policyTabs[e].entities=[]),"all"===a)this.policyTabs[e].entities=t?"all":[];else{let i="all"===this.policyTabs[e].entities?[]:Array.isArray(this.policyTabs[e].entities)?this.policyTabs[e].entities:[];const s=Number(a);t?i.includes(s)||i.push(s):i=i.filter(e=>e!==s),this.policyTabs[e].entities=i}console.log("Updated entities:",this.policyTabs[e].entities)}},selectEntity(e,a){if(e<0||!this.policyTabs[e])return;const t="all"===a?this.isAllEntitiesSelected(e):this.isEntitySelected(e,a);this.handleEntitySelection(e,a,!t)},isEntitySelected(e,a){const t=this.policyTabs[e];return!(!t||!t.entities)&&("all"===t.entities?"all"===a:Array.isArray(t.entities)&&t.entities.includes(Number(a)))},isAllEntitiesSelected(e){const a=this.policyTabs[e];return a&&"all"===a.entities},getSelectedEntitiesCount(e){const a=this.policyTabs[e];return a&&a.entities?"all"===a.entities?this.entities.length-1:Array.isArray(a.entities)?a.entities.length:0:0},toggleEntitiesDropdown(e){if(e<0||!this.policyTabs[e])return;this.policyTabs.forEach((a,t)=>{t!==e&&(a.showEntitiesDropdown=!1)});const a=this.policyTabs[e];a.showEntitiesDropdown=!a.showEntitiesDropdown,a.showEntitiesDropdown&&this.entities.length<=1&&this.fetchEntities()},closeAllEntityDropdowns(){this.policyTabs.forEach(e=>{e.showEntitiesDropdown=!1})},handleClickOutside(e){const a=document.querySelectorAll(".entities-multi-select");a.forEach(a=>{a.contains(e.target)||this.closeAllEntityDropdowns()})},async fetchUsers(){try{const e=await qe.A.get(`${Qw}/users/`);console.log("Raw users response:",e.data),this.users=e.data.map(e=>({id:e.UserId,name:e.UserName})),console.log("Mapped users:",this.users)}catch(e){console.error("Error fetching users:",e),this.error="Failed to fetch users"}},handleCreatedByNameChange(){if("policy"===this.selectedTab&&this.policyTabs[this.activePolicyTab]){const e=this.policyTabs[this.activePolicyTab].createdByName;this.policyTabs[this.activePolicyTab].subPolicies.forEach(a=>{a.createdByName=e})}},async submitTailoredPolicy(){if(this.validateForm("policy"))try{this.loading=!0;const e=parseFloat(this.policyTabs[this.activePolicyTab].coverageRate);if(isNaN(e)||e<0||e>100)throw new Error("Coverage Rate must be a number between 0 and 100");const a={TargetFrameworkId:this.selectedFramework,PolicyName:this.policyTabs[this.activePolicyTab].name,PolicyDescription:this.policyTabs[this.activePolicyTab].description,Department:this.policyTabs[this.activePolicyTab].department,Scope:this.policyTabs[this.activePolicyTab].scope,Objective:this.policyTabs[this.activePolicyTab].objective,CoverageRate:e,Applicability:this.policyTabs[this.activePolicyTab].applicability,PolicyType:this.policyTabs[this.activePolicyTab].type,PolicyCategory:this.policyTabs[this.activePolicyTab].category,PolicySubCategory:this.policyTabs[this.activePolicyTab].subCategory,Entities:this.policyTabs[this.activePolicyTab].entities,StartDate:this.policyTabs[this.activePolicyTab].startDate,EndDate:this.policyTabs[this.activePolicyTab].endDate,CreatedByName:this.policyTabs[this.activePolicyTab].createdByName,Reviewer:this.policyTabs[this.activePolicyTab].reviewer,Identifier:this.policyTabs[this.activePolicyTab].identifier,subpolicies:this.policyTabs[this.activePolicyTab].subPolicies.map(e=>({SubPolicyName:e.name,Identifier:e.identifier,Description:e.description,Control:e.control,exclude:!1}))};console.log("Submitting policy data:",a);const t=await qe.A.post(`${Qw}/tailoring/create-policy/`,a,{headers:{"Content-Type":"application/json"}});console.log("Policy creation response:",t.data),this.$emit("policy-created"),this.resetForm(),this.error=null,pv.OQ.success("Policy created successfully!","Success")}catch(e){console.error("Error submitting policy:",e),this.error=e.response?.data?.error||"Failed to submit policy",pv.OQ.error(this.error,"Error Creating Policy")}finally{this.loading=!1}},validateForm(e){if("framework"===e)return this.frameworkForm.name?this.frameworkForm.description?this.frameworkForm.identifier?this.frameworkForm.category?this.frameworkForm.internalExternal?this.frameworkForm.startDate?this.frameworkForm.createdByName?!!this.frameworkForm.reviewer||(pv.OQ.warning("Reviewer is required","Validation Error"),!1):(pv.OQ.warning("Created By is required","Validation Error"),!1):(pv.OQ.warning("Start date is required","Validation Error"),!1):(pv.OQ.warning("Internal/External selection is required","Validation Error"),!1):(pv.OQ.warning("Framework category is required","Validation Error"),!1):(pv.OQ.warning("Framework identifier is required","Validation Error"),!1):(pv.OQ.warning("Framework description is required","Validation Error"),!1):(pv.OQ.warning("Framework name is required","Validation Error"),!1);if("policy"===e){const e=this.policyTabs[this.activePolicyTab];return e.name?e.description?e.identifier?e.department?e.scope?e.objective?e.coverageRate?e.applicability?e.type?e.category?e.subCategory?e.startDate?e.createdByName?e.reviewer?!(!e.entities||Array.isArray(e.entities)&&0===e.entities.length)||(pv.OQ.warning("At least one entity must be selected","Validation Error"),!1):(pv.OQ.warning("Reviewer is required","Validation Error"),!1):(pv.OQ.warning("Created By is required","Validation Error"),!1):(pv.OQ.warning("Start Date is required","Validation Error"),!1):(pv.OQ.warning("Policy Sub Category is required","Validation Error"),!1):(pv.OQ.warning("Policy Category is required","Validation Error"),!1):(pv.OQ.warning("Policy Type is required","Validation Error"),!1):(pv.OQ.warning("Applicability is required","Validation Error"),!1):(pv.OQ.warning("Coverage Rate is required","Validation Error"),!1):(pv.OQ.warning("Objective is required","Validation Error"),!1):(pv.OQ.warning("Scope is required","Validation Error"),!1):(pv.OQ.warning("Department is required","Validation Error"),!1):(pv.OQ.warning("Policy identifier is required","Validation Error"),!1):(pv.OQ.warning("Policy description is required","Validation Error"),!1):(pv.OQ.warning("Policy name is required","Validation Error"),!1)}return!1}},mounted(){document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)}};const Kw=(0,se.A)(qw,[["render",Ww],["__scopeId","data-v-296cfc6c"]]);var Jw=Kw;const zw={class:"assign-audit-page"},Hw={class:"audit-content"},Yw={class:"audit-tabs"},Gw=["onClick"],Zw={class:"tab-number"},eE={key:0,class:"tab-content"},aE={class:"dynamic-fields-row"},tE={class:"dynamic-field-col"},iE={class:"narrow-dropdown"},sE={key:0,class:"compliance-scope-desc"},oE={key:1,class:"tab-content"},lE={class:"dynamic-fields-row"},nE={class:"dynamic-field-col"},rE={class:"dynamic-field-col"},cE={class:"dynamic-field-col"},dE=["onClick"],uE={key:2,class:"tab-content"},pE={class:"team-assignments-section"},vE={class:"member-header"},mE={class:"collapsible-section"},kE=["onClick"],hE={class:"dynamic-fields-row"},gE={class:"dynamic-field-col"},yE={class:"dynamic-field-col"},fE={class:"dynamic-field-col"},bE={class:"reports-section"},CE={class:"reports-row"},LE={class:"reports-col"},wE=["onClick"],EE={key:0,class:"selected-reports"},RE={class:"selected-reports-list"},DE={class:"report-title"},IE={class:"report-info"},PE=["onClick"],_E={class:"collapsible-section"},SE=["onClick"],AE={class:"dynamic-fields-row"},TE={class:"dynamic-field-col"},xE=["onUpdate:modelValue"],FE={class:"dynamic-field-col"},VE=["onUpdate:modelValue"],ME={class:"dynamic-fields-row"},XE={class:"dynamic-field-col"},UE={class:"dynamic-field-col"},NE={class:"dynamic-fields-row"},$E={class:"dynamic-field-col"},OE={class:"dynamic-field-col"},jE={class:"dynamic-field-col"},BE={key:0,class:"compliance-preview"},WE={class:"preview-content"},QE={key:0},qE={key:1},KE={key:0,class:"compliance-scope-desc"},JE={key:3,class:"tab-content"},zE={class:"assignments-summary"},HE={class:"summary-header"},YE={class:"member-name"},GE={class:"member-role"},ZE={class:"review-section"},eR=["onClick"],aR={class:"review-controls"},tR=["onClick"],iR={class:"edit-view"},sR={class:"dynamic-fields-row"},oR={class:"dynamic-field-col"},lR={class:"dynamic-field-col"},nR={class:"dynamic-field-col"},rR={key:0,class:"compliance-preview"},cR={class:"preview-content"},dR={key:0},uR={key:1},pR={class:"reports-section"},vR={class:"reports-row"},mR={class:"reports-col"},kR=["onClick"],hR={key:0,class:"selected-reports"},gR={class:"selected-reports-list"},yR={class:"report-title"},fR={class:"report-info"},bR=["onClick"],CR={class:"review-section"},LR=["onClick"],wR={class:"review-controls"},ER=["onClick"],RR={class:"edit-view"},DR={class:"dynamic-fields-row"},IR={class:"dynamic-field-col"},PR=["onUpdate:modelValue"],_R={class:"dynamic-field-col"},SR=["onUpdate:modelValue"],AR={class:"dynamic-fields-row"},TR={class:"dynamic-field-col"},xR={class:"dynamic-field-col"},FR={class:"dynamic-fields-row"},VR={class:"dynamic-field-col"},MR={class:"dynamic-field-col"},XR={class:"dynamic-field-col"},UR={class:"dynamic-fields-row"},NR={class:"dynamic-field-col"},$R={class:"dynamic-field-col"},OR={class:"tab-navigation"},jR=["disabled"],BR=["disabled"],WR={key:0,class:"modal-overlay"},QR={class:"modal-content"},qR={class:"modal-header"},KR={class:"modal-body"},JR={key:0,class:"loading"},zR={key:1,class:"error-message"},HR={key:2,class:"no-reports"},YR={key:3,class:"reports-list"},GR={class:"report-label"},ZR=["value"],eD={class:"report-info"},aD={class:"report-title"},tD={class:"report-details"},iD={class:"modal-footer"},sD=["disabled"];function oD(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("TextareaInput"),u=(0,s.g2)("SelectInput"),p=(0,s.g2)("DateInput");return(0,s.uX)(),(0,s.CE)("div",zw,[(0,s.Lk)("div",Hw,[a[67]||(a[67]=(0,s.Lk)("h1",{class:"audit-title"},"Audit Assignment",-1)),(0,s.Lk)("div",Yw,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.tabs,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:a,class:(0,d.C4)(["tab-button",{active:l.currentTab===a}]),onClick:e=>l.currentTab=a},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",Zw,(0,d.v_)(a+1),1)],10,Gw))),128))]),0===l.currentTab?((0,s.uX)(),(0,s.CE)("div",eE,[a[11]||(a[11]=(0,s.Lk)("h2",null,"Framework Selection",-1)),(0,s.Lk)("div",aE,[(0,s.Lk)("div",tE,[a[9]||(a[9]=(0,s.Lk)("label",{class:"dynamic-label"},"Framework",-1)),a[10]||(a[10]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the framework under which this audit is being conducted.",-1)),(0,s.Lk)("div",iE,[(0,s.bF)(r,{modelValue:l.auditData.framework,"onUpdate:modelValue":a[0]||(a[0]=e=>l.auditData.framework=e),config:{name:"Framework",label:"Framework",values:l.frameworks.map(e=>({value:e.FrameworkId,label:e.FrameworkName})),defaultValue:"Select Framework"},onChange:n.onFrameworkChange},null,8,["modelValue","config","onChange"])]),l.auditData.framework&&!l.auditData.policy?((0,s.uX)(),(0,s.CE)("div",sE," Will include permanent compliances from all policies and subpolicies under this framework ")):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),1===l.currentTab?((0,s.uX)(),(0,s.CE)("div",oE,[a[19]||(a[19]=(0,s.Lk)("h2",null,"Team Creation",-1)),(0,s.Lk)("button",{class:"add-member-btn",onClick:a[1]||(a[1]=(...e)=>n.addTeamMember&&n.addTeamMember(...e))},a[12]||(a[12]=[(0,s.Lk)("span",{class:"plus-icon"},"+",-1),(0,s.eW)(" Add Team Member ")])),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.teamMembers,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"team-member-card"},[(0,s.Lk)("div",lE,[(0,s.Lk)("div",nE,[a[13]||(a[13]=(0,s.Lk)("label",{class:"dynamic-label"},"Auditor",-1)),a[14]||(a[14]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the auditor responsible for this audit.",-1)),(0,s.bF)(r,{modelValue:e.auditor,"onUpdate:modelValue":a=>e.auditor=a,config:{name:"Auditor",label:"Auditor",values:l.users.map(e=>({value:e.UserId,label:e.UserName})),defaultValue:"Select Auditor"},showSearchBar:!0,error:n.getFieldError("auditor",t)},null,8,["modelValue","onUpdate:modelValue","config","error"])]),(0,s.Lk)("div",rE,[a[15]||(a[15]=(0,s.Lk)("label",{class:"dynamic-label"},"Role",-1)),a[16]||(a[16]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the role of the auditor in this audit.",-1)),(0,s.bF)(r,{modelValue:e.role,"onUpdate:modelValue":a=>e.role=a,config:{name:"Role",label:"Role",values:l.roles.map(e=>({value:e,label:e})),defaultValue:"Select Role"},showSearchBar:!0,error:n.getFieldError("role",t)},null,8,["modelValue","onUpdate:modelValue","config","error"])]),(0,s.Lk)("div",cE,[a[17]||(a[17]=(0,s.Lk)("label",{class:"dynamic-label"},"Primary Responsibilities",-1)),a[18]||(a[18]=(0,s.Lk)("div",{class:"dynamic-desc"},"Describe the main responsibilities for this team member.",-1)),(0,s.bF)(c,{modelValue:e.responsibilities,"onUpdate:modelValue":a=>e.responsibilities=a,label:"Primary Responsibilities",placeholder:"Enter responsibilities...",error:n.getFieldError("responsibilities",t),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])])]),t>0?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"remove-member-btn",onClick:e=>n.removeTeamMember(t)}," Remove ",8,dE)):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),2===l.currentTab?((0,s.uX)(),(0,s.CE)("div",uE,[a[46]||(a[46]=(0,s.Lk)("h2",null,"Policy Assignment & Audit Details",-1)),(0,s.Lk)("div",pE,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.teamMembers,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"team-assignment-card"},[(0,s.Lk)("div",vE,[(0,s.Lk)("h4",null,(0,d.v_)(n.getUserName(e.auditor)||"Team Member")+" - "+(0,d.v_)(e.role),1)]),(0,s.Lk)("div",mE,[(0,s.Lk)("div",{class:"section-header",onClick:a=>n.toggleSection(e,"policyAssignment")},[a[20]||(a[20]=(0,s.Lk)("h5",null,"Policy Assignment",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isPolicyAssignmentExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,kE),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isPolicyAssignmentExpanded}])},[(0,s.Lk)("div",hE,[(0,s.Lk)("div",gE,[a[21]||(a[21]=(0,s.Lk)("label",{class:"dynamic-label"},"Assigned Policy",-1)),a[22]||(a[22]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the policy to be audited by this team member.",-1)),(0,s.bF)(r,{modelValue:e.assignedPolicy,"onUpdate:modelValue":a=>e.assignedPolicy=a,config:{name:"Assigned Policy",label:"Assigned Policy",values:l.policies.map(e=>({value:e.PolicyId,label:e.PolicyName})),defaultValue:"Select Policy"},showSearchBar:!0,error:n.getFieldError("assignedPolicy",t),onChange:e=>n.onMemberPolicyChange(t)},null,8,["modelValue","onUpdate:modelValue","config","error","onChange"])]),(0,s.Lk)("div",yE,[a[23]||(a[23]=(0,s.Lk)("label",{class:"dynamic-label"},"Sub Policy",-1)),a[24]||(a[24]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select specific sub policy if applicable.",-1)),(0,s.bF)(r,{modelValue:e.assignedSubPolicy,"onUpdate:modelValue":a=>e.assignedSubPolicy=a,config:{name:"Sub Policy",label:"Sub Policy",values:n.getMemberSubpolicies(t).map(e=>({value:e.SubPolicyId,label:e.SubPolicyName})),defaultValue:"Select Sub Policy"},showSearchBar:!0,onChange:e=>n.onSubPolicyChange(t)},null,8,["modelValue","onUpdate:modelValue","config","onChange"])]),(0,s.Lk)("div",fE,[a[25]||(a[25]=(0,s.Lk)("label",{class:"dynamic-label"},"Reviewer",-1)),a[26]||(a[26]=(0,s.Lk)("div",{class:"dynamic-desc"},"Choose the reviewer who will review this audit.",-1)),(0,s.bF)(r,{modelValue:e.reviewer,"onUpdate:modelValue":a=>e.reviewer=a,config:{name:"Reviewer",label:"Reviewer",values:l.users.map(e=>({value:e.UserId,label:e.UserName})),defaultValue:"Select Reviewer"},showSearchBar:!0,error:n.getFieldError("reviewer",t)},null,8,["modelValue","onUpdate:modelValue","config","error"])])]),(0,s.Lk)("div",bE,[(0,s.Lk)("div",CE,[(0,s.Lk)("div",LE,[(0,s.Lk)("button",{class:"reports-btn",onClick:a=>n.showReportsModal(e)},a[27]||(a[27]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1),(0,s.eW)(" Attach Reports ")]),8,wE)])]),n.getSelectedReportsForMember(e).length>0?((0,s.uX)(),(0,s.CE)("div",EE,[a[29]||(a[29]=(0,s.Lk)("h6",null,"Selected Reports:",-1)),(0,s.Lk)("div",RE,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSelectedReportsForMember(e),t=>((0,s.uX)(),(0,s.CE)("div",{key:t.ReportId,class:"selected-report-item"},[(0,s.Lk)("span",DE,"Report #"+(0,d.v_)(t.ReportId),1),(0,s.Lk)("span",IE,(0,d.v_)(t.AuditorName)+" - "+(0,d.v_)(n.formatDate(t.CompletionDate)),1),(0,s.Lk)("button",{class:"remove-report-btn",onClick:a=>n.removeReport(e,t.ReportId)},a[28]||(a[28]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,PE)]))),128))])])):(0,s.Q3)("",!0)])],2)]),(0,s.Lk)("div",_E,[(0,s.Lk)("div",{class:"section-header",onClick:a=>n.toggleSection(e,"auditDetails")},[a[30]||(a[30]=(0,s.Lk)("h5",null,"Audit Details",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isAuditDetailsExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,SE),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isAuditDetailsExpanded}])},[(0,s.Lk)("div",AE,[(0,s.Lk)("div",TE,[a[31]||(a[31]=(0,s.Lk)("label",{class:"dynamic-label"},"Audit Title",-1)),a[32]||(a[32]=(0,s.Lk)("div",{class:"dynamic-desc"},"Enter a concise title for this audit assignment.",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>e.auditTitle=a,class:"dynamic-input",placeholder:"Enter audit title..."},null,8,xE),[[i.Jo,e.auditTitle]])]),(0,s.Lk)("div",FE,[a[33]||(a[33]=(0,s.Lk)("label",{class:"dynamic-label"},"Business Unit",-1)),a[34]||(a[34]=(0,s.Lk)("div",{class:"dynamic-desc"},"Mention the business unit or process area being audited.",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>e.businessUnit=a,class:"dynamic-input",placeholder:"Enter business unit..."},null,8,VE),[[i.Jo,e.businessUnit]])])]),(0,s.Lk)("div",ME,[(0,s.Lk)("div",XE,[a[35]||(a[35]=(0,s.Lk)("label",{class:"dynamic-label"},"Scope",-1)),a[36]||(a[36]=(0,s.Lk)("div",{class:"dynamic-desc"},"Specify the boundaries and extent of the audit.",-1)),(0,s.bF)(c,{modelValue:e.scope,"onUpdate:modelValue":a=>e.scope=a,label:"Scope",placeholder:"Enter scope...",error:n.getFieldError("scope",t),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",UE,[a[37]||(a[37]=(0,s.Lk)("label",{class:"dynamic-label"},"Objective",-1)),a[38]||(a[38]=(0,s.Lk)("div",{class:"dynamic-desc"},"State the main goals or objectives of the audit.",-1)),(0,s.bF)(c,{modelValue:e.objective,"onUpdate:modelValue":a=>e.objective=a,label:"Objective",placeholder:"Enter objective...",error:n.getFieldError("objective",t),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])])]),(0,s.Lk)("div",NE,[(0,s.Lk)("div",$E,[a[39]||(a[39]=(0,s.Lk)("label",{class:"dynamic-label"},"Type",-1)),a[40]||(a[40]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select whether the audit is Internal or External.",-1)),(0,s.bF)(u,{modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,options:[{value:"I",label:"Internal"},{value:"E",label:"External"},{value:"S",label:"Self-Audit"}],label:"Type",placeholder:"Select Type",error:n.getFieldError("type",t)},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",OE,[a[41]||(a[41]=(0,s.Lk)("label",{class:"dynamic-label"},"Frequency",-1)),a[42]||(a[42]=(0,s.Lk)("div",{class:"dynamic-desc"},"How often should this audit occur?",-1)),(0,s.bF)(u,{modelValue:e.frequency,"onUpdate:modelValue":a=>e.frequency=a,options:[{value:"0",label:"Only Once"},{value:"1",label:"Daily"},{value:"60",label:"Every 2 Months"},{value:"120",label:"Every 4 Months"},{value:"182",label:"Half Yearly"},{value:"365",label:"Yearly"},{value:"365a",label:"Annually"}],label:"Frequency",placeholder:"Select Frequency",error:n.getFieldError("frequency",t)},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",jE,[a[43]||(a[43]=(0,s.Lk)("label",{class:"dynamic-label"},"Due Date",-1)),a[44]||(a[44]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the due date for this audit.",-1)),(0,s.bF)(p,{modelValue:e.dueDate,"onUpdate:modelValue":a=>e.dueDate=a,label:"Due Date",placeholder:"Select due date",error:n.getFieldError("dueDate",t)},null,8,["modelValue","onUpdate:modelValue","error"])])])],2)]),e.assignedPolicy?((0,s.uX)(),(0,s.CE)("div",BE,[a[45]||(a[45]=(0,s.Lk)("div",{class:"preview-header"},"Compliance Items to be Audited:",-1)),(0,s.Lk)("div",WE,[(0,s.Lk)("div",{class:(0,d.C4)(["compliance-count",{loading:l.complianceCountLoading[`${e.assignedPolicy}-loading`]}])},[l.complianceCountLoading[`${e.assignedPolicy}-loading`]?((0,s.uX)(),(0,s.CE)("span",QE,"Loading...")):((0,s.uX)(),(0,s.CE)("span",qE,(0,d.v_)(n.getComplianceCount(e.assignedPolicy,e.assignedSubPolicy))+" items",1))],2),e.assignedSubPolicy?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",KE," Will include permanent compliances from all subpolicies under this policy "))])])):(0,s.Q3)("",!0)]))),128))])])):(0,s.Q3)("",!0),3===l.currentTab?((0,s.uX)(),(0,s.CE)("div",JE,[a[66]||(a[66]=(0,s.Lk)("h2",null,"Review & Assign",-1)),(0,s.Lk)("div",zE,[a[65]||(a[65]=(0,s.Lk)("h3",null,"Assignment Summary",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.teamMembers,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"summary-card"},[(0,s.Lk)("div",HE,[(0,s.Lk)("span",YE,(0,d.v_)(n.getUserName(e.auditor)),1),(0,s.Lk)("span",GE,(0,d.v_)(e.role),1)]),(0,s.Lk)("div",ZE,[(0,s.Lk)("div",{class:"review-section-header",onClick:a=>e.isReviewPolicyExpanded=!e.isReviewPolicyExpanded},[a[47]||(a[47]=(0,s.Lk)("h4",null,"Policy Assignment",-1)),(0,s.Lk)("div",aR,[(0,s.Lk)("button",{class:"edit-btn",onClick:(0,i.D$)(a=>n.togglePolicyEditMode(e),["stop"])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isPolicyEditMode?"fa-check":"fa-edit"])},null,2),(0,s.eW)(" "+(0,d.v_)(e.isPolicyEditMode?"Save":"Edit"),1)],8,tR),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isReviewPolicyExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)])],8,eR),(0,s.Lk)("div",{class:(0,d.C4)(["review-section-content",{collapsed:!e.isReviewPolicyExpanded}])},[(0,s.Lk)("div",iR,[(0,s.Lk)("div",sR,[(0,s.Lk)("div",oR,[a[48]||(a[48]=(0,s.Lk)("label",{class:"dynamic-label"},"Assigned Policy",-1)),(0,s.bF)(u,{modelValue:e.assignedPolicy,"onUpdate:modelValue":a=>e.assignedPolicy=a,options:l.policies.map(e=>({value:e.PolicyId,label:e.PolicyName})),label:"Assigned Policy",placeholder:"Select Policy",onChange:e=>n.onMemberPolicyChange(t)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),(0,s.Lk)("div",lR,[a[49]||(a[49]=(0,s.Lk)("label",{class:"dynamic-label"},"Sub Policy",-1)),(0,s.bF)(u,{modelValue:e.assignedSubPolicy,"onUpdate:modelValue":a=>e.assignedSubPolicy=a,options:n.getMemberSubpolicies(t).map(e=>({value:e.SubPolicyId,label:e.SubPolicyName})),label:"Sub Policy",placeholder:"Select Sub Policy",onChange:e=>n.onSubPolicyChange(t)},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),(0,s.Lk)("div",nR,[a[50]||(a[50]=(0,s.Lk)("label",{class:"dynamic-label"},"Reviewer",-1)),(0,s.bF)(u,{modelValue:e.reviewer,"onUpdate:modelValue":a=>e.reviewer=a,options:l.users.map(e=>({value:e.UserId,label:e.UserName})),label:"Reviewer",placeholder:"Select Reviewer"},null,8,["modelValue","onUpdate:modelValue","options"])])]),e.assignedPolicy?((0,s.uX)(),(0,s.CE)("div",rR,[(0,s.Lk)("div",cR,[(0,s.Lk)("div",{class:(0,d.C4)(["compliance-count",{loading:l.complianceCountLoading[`${e.assignedPolicy}-loading`]}])},[l.complianceCountLoading[`${e.assignedPolicy}-loading`]?((0,s.uX)(),(0,s.CE)("span",dR,"Loading...")):((0,s.uX)(),(0,s.CE)("span",uR,"Compliance Items: "+(0,d.v_)(n.getComplianceCount(e.assignedPolicy,e.assignedSubPolicy)),1))],2)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",pR,[(0,s.Lk)("div",vR,[(0,s.Lk)("div",mR,[(0,s.Lk)("button",{class:"reports-btn",onClick:a=>n.showReportsModal(e)},a[51]||(a[51]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1),(0,s.eW)(" Manage Reports ")]),8,kR)])]),n.getSelectedReportsForMember(e).length>0?((0,s.uX)(),(0,s.CE)("div",hR,[a[53]||(a[53]=(0,s.Lk)("h6",null,"Selected Reports:",-1)),(0,s.Lk)("div",gR,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSelectedReportsForMember(e),t=>((0,s.uX)(),(0,s.CE)("div",{key:t.ReportId,class:"selected-report-item"},[(0,s.Lk)("span",yR,"Report #"+(0,d.v_)(t.ReportId),1),(0,s.Lk)("span",fR,(0,d.v_)(t.AuditorName)+" - "+(0,d.v_)(n.formatDate(t.CompletionDate)),1),(0,s.Lk)("button",{class:"remove-report-btn",onClick:a=>n.removeReport(e,t.ReportId)},a[52]||(a[52]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,bR)]))),128))])])):(0,s.Q3)("",!0)])])],2)]),(0,s.Lk)("div",CR,[(0,s.Lk)("div",{class:"review-section-header",onClick:a=>e.isReviewDetailsExpanded=!e.isReviewDetailsExpanded},[a[54]||(a[54]=(0,s.Lk)("h4",null,"Audit Details",-1)),(0,s.Lk)("div",wR,[(0,s.Lk)("button",{class:"edit-btn",onClick:(0,i.D$)(a=>n.toggleDetailsEditMode(e),["stop"])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isDetailsEditMode?"fa-check":"fa-edit"])},null,2),(0,s.eW)(" "+(0,d.v_)(e.isDetailsEditMode?"Save":"Edit"),1)],8,ER),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isReviewDetailsExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)])],8,LR),(0,s.Lk)("div",{class:(0,d.C4)(["review-section-content",{collapsed:!e.isReviewDetailsExpanded}])},[(0,s.Lk)("div",RR,[(0,s.Lk)("div",DR,[(0,s.Lk)("div",IR,[a[55]||(a[55]=(0,s.Lk)("label",{class:"dynamic-label"},"Audit Title",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>e.auditTitle=a,class:"dynamic-input",placeholder:"Enter audit title..."},null,8,PR),[[i.Jo,e.auditTitle]])]),(0,s.Lk)("div",_R,[a[56]||(a[56]=(0,s.Lk)("label",{class:"dynamic-label"},"Business Unit",-1)),a[57]||(a[57]=(0,s.Lk)("div",{class:"dynamic-desc"},"Mention the business unit or process area being audited.",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>e.businessUnit=a,class:"dynamic-input",placeholder:"Enter business unit..."},null,8,SR),[[i.Jo,e.businessUnit]])])]),(0,s.Lk)("div",AR,[(0,s.Lk)("div",TR,[a[58]||(a[58]=(0,s.Lk)("label",{class:"dynamic-label"},"Scope",-1)),(0,s.bF)(c,{modelValue:e.scope,"onUpdate:modelValue":a=>e.scope=a,label:"Scope",placeholder:"Enter scope...",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])]),(0,s.Lk)("div",xR,[a[59]||(a[59]=(0,s.Lk)("label",{class:"dynamic-label"},"Objective",-1)),(0,s.bF)(c,{modelValue:e.objective,"onUpdate:modelValue":a=>e.objective=a,label:"Objective",placeholder:"Enter objective...",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])])]),(0,s.Lk)("div",FR,[(0,s.Lk)("div",VR,[a[60]||(a[60]=(0,s.Lk)("label",{class:"dynamic-label"},"Type",-1)),(0,s.bF)(u,{modelValue:e.type,"onUpdate:modelValue":a=>e.type=a,options:[{value:"I",label:"Internal"},{value:"E",label:"External"},{value:"S",label:"Self-Audit"}],label:"Type",placeholder:"Select Type"},null,8,["modelValue","onUpdate:modelValue"])]),(0,s.Lk)("div",MR,[a[61]||(a[61]=(0,s.Lk)("label",{class:"dynamic-label"},"Frequency",-1)),(0,s.bF)(u,{modelValue:e.frequency,"onUpdate:modelValue":a=>e.frequency=a,options:[{value:"0",label:"Only Once"},{value:"1",label:"Daily"},{value:"60",label:"Every 2 Months"},{value:"120",label:"Every 4 Months"},{value:"182",label:"Half Yearly"},{value:"365",label:"Yearly"},{value:"365a",label:"Annually"}],label:"Frequency",placeholder:"Select Frequency"},null,8,["modelValue","onUpdate:modelValue"])]),(0,s.Lk)("div",XR,[a[62]||(a[62]=(0,s.Lk)("label",{class:"dynamic-label"},"Due Date",-1)),(0,s.bF)(p,{modelValue:e.dueDate,"onUpdate:modelValue":a=>e.dueDate=a,label:"Due Date",placeholder:"Select due date"},null,8,["modelValue","onUpdate:modelValue"])])]),(0,s.Lk)("div",UR,[(0,s.Lk)("div",NR,[a[63]||(a[63]=(0,s.Lk)("label",{class:"dynamic-label"},"Role",-1)),(0,s.bF)(u,{modelValue:e.role,"onUpdate:modelValue":a=>e.role=a,options:l.roles.map(e=>({value:e,label:e})),label:"Role",placeholder:"Select Role"},null,8,["modelValue","onUpdate:modelValue","options"])]),(0,s.Lk)("div",$R,[a[64]||(a[64]=(0,s.Lk)("label",{class:"dynamic-label"},"Responsibilities",-1)),(0,s.bF)(c,{modelValue:e.responsibilities,"onUpdate:modelValue":a=>e.responsibilities=a,label:"Responsibilities",placeholder:"Enter responsibilities...",rows:"3"},null,8,["modelValue","onUpdate:modelValue"])])])])],2)])]))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",OR,[l.currentTab>0?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"nav-button prev",onClick:a[2]||(a[2]=e=>l.currentTab--)}," Previous ")):(0,s.Q3)("",!0),l.currentTab<l.tabs.length-1?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"nav-button next",onClick:a[3]||(a[3]=e=>l.currentTab++),disabled:!n.canProceed}," Next ",8,jR)):(0,s.Q3)("",!0),l.currentTab===l.tabs.length-1?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"nav-button assign",onClick:a[4]||(a[4]=(...e)=>n.submitAudit&&n.submitAudit(...e)),disabled:!n.canAssign||l.assigning},(0,d.v_)(l.assigning?"Assigning...":"Assign Audit"),9,BR)):(0,s.Q3)("",!0)])]),l.showingReportsModal?((0,s.uX)(),(0,s.CE)("div",WR,[(0,s.Lk)("div",QR,[(0,s.Lk)("div",qR,[a[68]||(a[68]=(0,s.Lk)("h2",null,"Select Reports",-1)),(0,s.Lk)("button",{class:"close-btn",onClick:a[5]||(a[5]=(...e)=>n.closeReportsModal&&n.closeReportsModal(...e))},"Ã—")]),(0,s.Lk)("div",KR,[l.loadingReports?((0,s.uX)(),(0,s.CE)("div",JR," Loading reports... ")):l.reportsError?((0,s.uX)(),(0,s.CE)("div",zR,(0,d.v_)(l.reportsError),1)):0===l.availableReports.length?((0,s.uX)(),(0,s.CE)("div",HR," No reports available for this selection. ")):((0,s.uX)(),(0,s.CE)("div",YR,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.availableReports,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ReportId,class:"report-item"},[(0,s.Lk)("label",GR,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:e.ReportId,"onUpdate:modelValue":a[6]||(a[6]=e=>l.selectedReports=e)},null,8,ZR),[[i.lH,l.selectedReports]]),(0,s.Lk)("div",eD,[(0,s.Lk)("div",aD,"Report #"+(0,d.v_)(e.ReportId),1),(0,s.Lk)("div",tD,[(0,s.Lk)("span",null,(0,d.v_)(e.AuditorName),1),(0,s.Lk)("span",null,(0,d.v_)(n.formatDate(e.CompletionDate)),1)])])])]))),128))]))]),(0,s.Lk)("div",iD,[(0,s.Lk)("button",{class:"cancel-btn",onClick:a[7]||(a[7]=(...e)=>n.closeReportsModal&&n.closeReportsModal(...e))},"Cancel"),(0,s.Lk)("button",{class:"save-btn",onClick:a[8]||(a[8]=(...e)=>n.saveSelectedReports&&n.saveSelectedReports(...e)),disabled:0===l.selectedReports.length}," Save ",8,sD)])])])):(0,s.Q3)("",!0)])}var lD={methods:{validateString(e,a={}){const{required:t=!0,minLength:i=1,maxLength:s=255,fieldName:o="Field"}=a;if(!e&&t)return`${o} is required`;if(e){if(e.length<i)return`${o} must be at least ${i} characters`;if(e.length>s)return`${o} cannot exceed ${s} characters`}return null},validateId(e,a="ID"){if(!e)return`${a} is required`;const t=parseInt(e);return isNaN(t)||t<1?`${a} must be a valid positive number`:null},validateDate(e,a="Date"){if(!e)return`${a} is required`;const t=new Date(e);if(isNaN(t.getTime()))return`${a} must be a valid date`;const i=new Date;return i.setHours(0,0,0,0),t<i?`${a} cannot be in the past`:null},validateAuditType(e){const a=["I","E","S"];return a.includes(e)?null:"Invalid audit type. Must be Internal, External, or Self-Audit"},validateFrequency(e){const a=["0","1","60","120","182","365","365a"];return a.includes(e)?null:"Invalid frequency value"},validateTeamMember(e){const a={},t=this.validateId(e.auditor,"Auditor");t&&(a.auditor=t);const i=this.validateString(e.role,{fieldName:"Role",minLength:2,maxLength:100});i&&(a.role=i);const s=this.validateString(e.responsibilities,{fieldName:"Responsibilities",minLength:10,maxLength:500});s&&(a.responsibilities=s);const o=this.validateId(e.assignedPolicy,"Policy");o&&(a.assignedPolicy=o);const l=this.validateId(e.reviewer,"Reviewer");l&&(a.reviewer=l);const n=this.validateString(e.scope,{fieldName:"Scope",minLength:10,maxLength:1e3});n&&(a.scope=n);const r=this.validateString(e.objective,{fieldName:"Objective",minLength:10,maxLength:1e3});r&&(a.objective=r);const c=this.validateAuditType(e.type);c&&(a.type=c);const d=this.validateFrequency(e.frequency);d&&(a.frequency=d);const u=this.validateDate(e.dueDate,"Due Date");return u&&(a.dueDate=u),Object.keys(a).length>0?a:null}}};const nD=["for"],rD={key:0,class:"required"},cD={class:"input-wrapper"},dD={key:1,class:"helper-text"},uD={key:2,class:"error-text"};var pD={__name:"BaseInput",props:{id:{type:String,required:!0},label:{type:String,default:""},required:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""}},setup(e){const a=e,t=(0,s.EW)(()=>!!a.errorMessage);return(a,i)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["form-group",{"form-group-error":t.value}])},[e.label?((0,s.uX)(),(0,s.CE)("label",{key:0,for:e.id,class:"form-label"},[(0,s.eW)((0,d.v_)(e.label)+" ",1),e.required?((0,s.uX)(),(0,s.CE)("span",rD,"*")):(0,s.Q3)("",!0)],8,nD)):(0,s.Q3)("",!0),(0,s.Lk)("div",cD,[(0,s.RG)(a.$slots,"default")]),e.helperText?((0,s.uX)(),(0,s.CE)("small",dD,(0,d.v_)(e.helperText),1)):(0,s.Q3)("",!0),e.errorMessage?((0,s.uX)(),(0,s.CE)("small",uD,(0,d.v_)(e.errorMessage),1)):(0,s.Q3)("",!0)],2))}};const vD=(0,se.A)(pD,[["__scopeId","data-v-64a6f058"]]);var mD=vD;const kD=["id","value","required","disabled","name"],hD={key:0,value:"",disabled:""},gD=["value","disabled"];var yD={__name:"SelectInput",props:{id:{type:String,required:!0},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"Select an option"},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},options:{type:Array,default:()=>[],validator:e=>e.every(e=>"object"===typeof e&&"value"in e&&"label"in e)},name:{type:String,default:""}},emits:["update:modelValue","change","blur","focus"],setup(e,{emit:a}){const t=e,i=a,o=(0,s.EW)(()=>!!t.errorMessage),l=e=>{i("update:modelValue",e.target.value),i("change",e)},n=e=>{i("blur",e)},r=e=>{i("focus",e)};return(a,t)=>((0,s.uX)(),(0,s.Wv)(mD,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("select",{id:e.id,value:e.modelValue,required:e.required,disabled:e.disabled,name:e.name,class:(0,d.C4)(["select-input",{"input-error":o.value,"input-disabled":e.disabled}]),onChange:l,onBlur:n,onFocus:r},[e.placeholder?((0,s.uX)(),(0,s.CE)("option",hD,(0,d.v_)(e.placeholder),1)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.options,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value,disabled:e.disabled},(0,d.v_)(e.label),9,gD))),128))],42,kD)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const fD=(0,se.A)(yD,[["__scopeId","data-v-41e820b8"]]);var bD=fD;const CD=["id","value","placeholder","required","disabled","readonly","rows","cols","maxlength","minlength","name"];var LD={__name:"TextareaInput",props:{id:{type:String,required:!0},modelValue:{type:String,default:""},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},rows:{type:Number,default:4},cols:{type:Number,default:null},maxlength:{type:Number,default:null},minlength:{type:Number,default:null},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:a}){const t=e,i=a,o=(0,s.EW)(()=>!!t.errorMessage),l=e=>{i("update:modelValue",e.target.value)},n=e=>{i("blur",e)},r=e=>{i("focus",e)};return(a,t)=>((0,s.uX)(),(0,s.Wv)(mD,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("textarea",{id:e.id,value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,rows:e.rows,cols:e.cols,maxlength:e.maxlength,minlength:e.minlength,name:e.name,class:(0,d.C4)(["textarea-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,CD)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const wD=(0,se.A)(LD,[["__scopeId","data-v-24543950"]]);var ED=wD;const RD=["id","type","value","placeholder","required","disabled","readonly","min","max","name"];var DD={__name:"DateInput",props:{id:{type:String,required:!0},modelValue:{type:String,default:""},type:{type:String,default:"date",validator:e=>["date","time","datetime-local","month","week"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},min:{type:String,default:""},max:{type:String,default:""},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:a}){const t=e,i=a,o=(0,s.EW)(()=>!!t.errorMessage),l=e=>{i("update:modelValue",e.target.value)},n=e=>{i("blur",e)},r=e=>{i("focus",e)};return(a,t)=>((0,s.uX)(),(0,s.Wv)(mD,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("input",{id:e.id,type:e.type,value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,min:e.min,max:e.max,name:e.name,class:(0,d.C4)(["date-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,RD)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const ID=(0,se.A)(DD,[["__scopeId","data-v-e06e25e4"]]);var PD=ID,_D={name:"AssignAudit",mixins:[lD],components:{SelectInput:bD,CustomDropdown:mt.A,TextareaInput:ED,DateInput:PD},data(){return{currentTab:0,tabs:[{name:"Framework Selection",required:["framework"]},{name:"Team Creation",required:[]},{name:"Policy Assignment",required:[]},{name:"Review & Assign",required:["scope","objective","type","frequency","dueDate"]}],auditData:{framework:"",policy:"",subPolicy:"",auditor:"",role:"",reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",responsibilities:""},frameworks:[],policies:[],subpolicies:[],users:[],roles:["Chief Audit Executive (CAE) / Audit Director","Audit Manager","Senior Audit Manager","IT Audit Manager","Operational Audit Manager","Compliance Audit Manager","Senior Auditor","Lead Auditor","Financial Auditor","Operational Auditor","IT Systems Auditor","Staff Auditor","Junior Auditor","Audit Reviewer","Quality Assurance Reviewer","Forensic Auditor","Regulatory Compliance Auditor","Risk Auditor","External Audit Coordinator","Regulatory Examiner Liaison","Audit Technology Specialist","Continuous Auditing Specialist","Audit Committee Secretary","Board Reporting Specialist"],assigning:!1,teamMembers:[{auditor:"",role:"",responsibilities:"",assignedPolicy:"",assignedSubPolicy:"",memberSubpolicies:[],reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",reports:"",isPolicyAssignmentExpanded:!0,isAuditDetailsExpanded:!0,isReviewPolicyExpanded:!0,isReviewDetailsExpanded:!0,isPolicyEditMode:!1,isDetailsEditMode:!1}],memberComplianceCounts:{},complianceCountLoading:{},showingReportsModal:!1,loadingReports:!1,reportsError:null,availableReports:[],selectedReports:[],currentMember:null,validationErrors:{},fieldErrors:{}}},computed:{canProceed(){return 0===this.currentTab?!!this.auditData.framework:1===this.currentTab?this.teamMembers.some(e=>e.auditor&&e.role&&e.responsibilities):2!==this.currentTab||this.teamMembers.every(e=>e.assignedPolicy&&e.reviewer&&e.scope&&e.objective&&e.type&&e.frequency&&e.dueDate)},canAssign(){if(!this.auditData.framework)return!1;const e=this.teamMembers.some(e=>{const a=e.auditor&&e.role&&e.responsibilities,t=e.assignedPolicy&&e.reviewer,i=e.scope&&e.objective&&e.type&&e.frequency&&e.dueDate;return a&&t&&i});return e},getFieldError(){return(e,a=null)=>null!==a&&this.validationErrors.teamMembers?this.validationErrors.teamMembers[a]?.[e]:this.validationErrors[e]}},methods:{async fetchFrameworks(){try{const e=await qe.A.get("/api/frameworks/");this.frameworks=e.data}catch(e){console.error("Error fetching frameworks:",e),this.frameworks=[]}},async fetchUsers(){try{const e=await qe.A.get("/api/users/");this.users=e.data}catch(e){console.error("Error fetching users:",e),this.users=[]}},async onFrameworkChange(){if(this.auditData.policy="",this.auditData.subPolicy="",this.policies=[],this.subpolicies=[],this.auditData.framework)try{const e=await qe.A.get("/api/policies/",{params:{framework_id:this.auditData.framework}});this.policies=e.data}catch(e){console.error("Error fetching policies:",e),this.policies=[]}},async onPolicyChange(){if(this.auditData.subPolicy="",this.subpolicies=[],this.auditData.policy)try{const e=await qe.A.get("/api/subpolicies/",{params:{policy_id:this.auditData.policy}});this.subpolicies=e.data}catch(e){console.error("Error fetching subpolicies:",e),this.subpolicies=[]}},addTeamMember(){this.teamMembers.push({auditor:"",role:"",responsibilities:"",assignedPolicy:"",assignedSubPolicy:"",memberSubpolicies:[],reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",reports:"",isPolicyAssignmentExpanded:!0,isAuditDetailsExpanded:!0,isReviewPolicyExpanded:!0,isReviewDetailsExpanded:!0,isPolicyEditMode:!1,isDetailsEditMode:!1})},removeTeamMember(e){this.teamMembers.splice(e,1)},validateForm(){this.validationErrors={},this.fieldErrors={};const e=this.validateId(this.auditData.framework,"Framework");e&&(this.validationErrors.framework=e);const a=[];return this.teamMembers.forEach((e,t)=>{const i=this.validateTeamMember(e);i&&(a[t]=i)}),a.length>0&&(this.validationErrors.teamMembers=a),0===Object.keys(this.validationErrors).length},async submitAudit(){if(!this.assigning)try{this.assigning=!0;const e=this.teamMembers[0],a={title:e.auditTitle,scope:e.scope,objective:e.objective,business_unit:e.businessUnit,role:e.role,responsibility:e.responsibilities,team_members:this.teamMembers.map(e=>e.auditor),reviewer:e.reviewer,framework_id:this.auditData.framework,policy_id:e.assignedPolicy||null,subpolicy_id:e.assignedSubPolicy||null,due_date:e.dueDate,frequency:e.frequency,audit_type:e.type,reports:e.reports||""},t=await qe.A.post("/api/create-audit/",a);if(!(t.data.audits_created>0))throw new Error("No audits were created");this.$popup.success(`Successfully created ${t.data.audits_created} audit(s)`),this.resetForm()}catch(e){const a=e.response?.data?.error||"Please try again.";e.response?.data?.details&&this.handleBackendValidationErrors(e.response.data.details),this.$popup.error("Error assigning audits: "+a),console.error("Error in submitAudit:",e)}finally{this.assigning=!1}},handleBackendValidationErrors(e){try{const a=JSON.parse(e);this.validationErrors=a}catch(a){this.validationErrors.general=e}},resetForm(){this.auditData={framework:""},this.teamMembers=[{auditor:"",role:"",responsibilities:"",assignedPolicy:"",assignedSubPolicy:"",memberSubpolicies:[],reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",reports:"",isPolicyAssignmentExpanded:!0,isAuditDetailsExpanded:!0,isReviewPolicyExpanded:!0,isReviewDetailsExpanded:!0,isPolicyEditMode:!1,isDetailsEditMode:!1}],this.currentTab=0},getUserName(e){const a=this.users.find(a=>a.UserId===e);return a?a.UserName:""},getPolicyName(e){const a=this.policies.find(a=>a.PolicyId===e);return a?a.PolicyName:"Not Assigned"},getSubPolicyName(e){const a=this.teamMembers.find(a=>a.memberSubpolicies.some(a=>a.SubPolicyId===e));if(a){const t=a.memberSubpolicies.find(a=>a.SubPolicyId===e);return t?t.SubPolicyName:"Not Assigned"}return"Not Assigned"},async onMemberPolicyChange(e){const a=this.teamMembers[e];if(a.assignedSubPolicy="",a.memberSubpolicies=[],a.assignedPolicy)try{this.complianceCountLoading={...this.complianceCountLoading,[`${a.assignedPolicy}-loading`]:!0};const t=await qe.A.get("/api/subpolicies/",{params:{policy_id:a.assignedPolicy}});a.memberSubpolicies=t.data,await this.fetchComplianceCount(e)}catch(t){console.error("Error in onMemberPolicyChange:",t)}finally{this.complianceCountLoading={...this.complianceCountLoading,[`${a.assignedPolicy}-loading`]:!1}}},async fetchComplianceCount(e){const a=this.teamMembers[e];if(a&&a.assignedPolicy)try{const e=await qe.A.get("/api/compliance-count/",{params:{policy_id:a.assignedPolicy,subpolicy_id:a.assignedSubPolicy||""}}),t=`${a.assignedPolicy}-${a.assignedSubPolicy||""}`;this.memberComplianceCounts={...this.memberComplianceCounts,[t]:e.data.count||0}}catch(t){console.error("Error fetching compliance count:",t);const e=`${a.assignedPolicy}-${a.assignedSubPolicy||""}`;this.memberComplianceCounts={...this.memberComplianceCounts,[e]:0}}},async onSubPolicyChange(e){const a=this.teamMembers[e];if(a&&a.assignedPolicy)try{this.complianceCountLoading={...this.complianceCountLoading,[`${a.assignedPolicy}-loading`]:!0},await this.fetchComplianceCount(e)}catch(t){console.error("Error in onSubPolicyChange:",t)}finally{this.complianceCountLoading={...this.complianceCountLoading,[`${a.assignedPolicy}-loading`]:!1}}},getMemberSubpolicies(e){return this.teamMembers[e].memberSubpolicies},getComplianceCount(e,a){if(!e)return 0;const t=`${e}-${a||""}`;return this.memberComplianceCounts[t]||0},async showReportsModal(e){this.currentMember=e,this.showingReportsModal=!0,this.loadingReports=!0,this.reportsError=null,this.selectedReports=[];try{const a=new URLSearchParams({framework_id:this.auditData.framework,policy_id:e.assignedPolicy||"",subpolicy_id:e.assignedSubPolicy||""}),t=await qe.A.get("/api/audit-reports/check/",{params:a});this.availableReports=t.data.reports||[]}catch(a){console.error("Error fetching reports:",a),this.reportsError="Failed to load reports. Please try again."}finally{this.loadingReports=!1}},closeReportsModal(){this.showingReportsModal=!1,this.currentMember=null,this.selectedReports=[],this.availableReports=[],this.reportsError=null},async saveSelectedReports(){try{if(0===this.selectedReports.length)return;const e=new URLSearchParams;e.append("report_ids",this.selectedReports.join(","));const a=await qe.A.get("/api/audit-reports/details/",{params:e}),t=a.data.reports,i={reports:t.map((e,a)=>({[`Report_${a+1}`]:{ReportId:e.report_id,Report:e.report,AuditorName:e.auditor_name,CompletionDate:e.completion_date,PolicyId:this.currentMember.assignedPolicy||null,SubPolicyId:this.currentMember.assignedSubPolicy||null,FrameworkId:this.auditData.framework}}))};this.currentMember.reports=JSON.stringify(i),this.closeReportsModal()}catch(e){console.error("Error saving reports:",e),this.$popup.error("Error saving reports. Please try again.")}},formatDate(e){if(!e)return"N/A";const a=new Date(e);return a.toLocaleDateString()},getSelectedReportsForMember(e){if(!e.reports)return[];try{const a=JSON.parse(e.reports);return a.reports.map((e,a)=>{const t=`Report_${a+1}`;return{ReportId:e[t].ReportId,Report:e[t].Report,AuditorName:e[t].AuditorName||"Unknown",CompletionDate:e[t].CompletionDate}})}catch(a){return console.error("Error parsing reports:",a),[]}},removeReport(e,a){try{if(!e.reports)return;const t=JSON.parse(e.reports),i=t.reports.filter(e=>{const t=Object.keys(e)[0];return e[t].ReportId!==a});t.reports=i,e.reports=JSON.stringify(t)}catch(t){console.error("Error removing report:",t)}},toggleSection(e,a){"policyAssignment"===a?e.isPolicyAssignmentExpanded=!e.isPolicyAssignmentExpanded:"auditDetails"===a&&(e.isAuditDetailsExpanded=!e.isAuditDetailsExpanded)},togglePolicyEditMode(e){e.isPolicyEditMode=!e.isPolicyEditMode},toggleDetailsEditMode(e){e.isDetailsEditMode=!e.isDetailsEditMode},getAuditTypeLabel(e){switch(e){case"I":return"Internal";case"E":return"External";case"S":return"Self-Audit";default:return e||"Not specified"}},getFrequencyLabel(e){switch(e){case"0":return"Only Once";case"1":return"Daily";case"60":return"Every 2 Months";case"120":return"Every 4 Months";case"182":return"Half Yearly";case"365":return"Yearly";case"365a":return"Annually";default:return e||"Not specified"}}},watch:{teamMembers:{deep:!0,handler(e){e.forEach((e,a)=>{e.assignedSubPolicy&&this.onSubPolicyChange(a)})}}},mounted(){this.fetchFrameworks(),this.fetchUsers()}};const SD=(0,se.A)(_D,[["render",oD],["__scopeId","data-v-54b214d4"]]);var AD=SD,TD=t(3435);const xD={class:"reviewer-page"},FD={key:0,class:"loading"},VD={key:1,class:"error-message"},MD={key:2,class:"no-data"},XD={class:"progress-bar"},UD={class:"progress-text"},ND=["onUpdate:modelValue","onChange"],$D={key:1},OD=["onClick"],jD={key:2},BD=["onClick"],WD={key:0,class:"approved-rejected-badge rejected",style:{display:"block","margin-top":"5px"}},QD={key:3},qD=["disabled","onClick"];function KD(e,a,t,o,l,n){const r=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",xD,[a[5]||(a[5]=(0,s.Lk)("h1",{class:"reviewer-title"},"Review Audit",-1)),l.loading?((0,s.uX)(),(0,s.CE)("div",FD,a[1]||(a[1]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading review tasks...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",VD,[(0,s.Lk)("p",null,(0,d.v_)(l.error),1),(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>n.fetchReviewTasks&&n.fetchReviewTasks(...e)),class:"btn-retry"},"Retry")])):0===l.audits.length?((0,s.uX)(),(0,s.CE)("div",MD,a[2]||(a[2]=[(0,s.Lk)("p",null,"No review tasks found",-1)]))):((0,s.uX)(),(0,s.Wv)(r,{key:3,title:"Review Tasks",data:n.filteredAudits,columns:l.columns,filters:l.filters,uniqueKey:"audit_id",showPagination:!0,defaultPageSize:10},{"cell-completion_percentage":(0,s.k6)(({row:e})=>[(0,s.Lk)("div",XD,[(0,s.Lk)("div",{class:(0,d.C4)(["progress-fill",n.getProgressClass(e.completion_percentage)]),style:(0,d.Tr)({width:`${e.completion_percentage}%`})},null,6)]),(0,s.Lk)("span",UD,(0,d.v_)(e.completion_percentage)+"%",1)]),"cell-policy":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(e.policy||"All Policies"),1)]),"cell-subpolicy":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(e.subpolicy||"All Subpolicies"),1)]),"cell-review_status":(0,s.k6)(({row:e})=>["Under review"===e.status&&"Yet to Start"!==e.review_status&&"In Review"!==e.review_status&&"Reject"!==e.review_status?(0,s.bo)(((0,s.uX)(),(0,s.CE)("select",{key:0,"onUpdate:modelValue":a=>e.review_status=a,onChange:a=>n.updateReviewStatus(e),class:"review-status-select"},a[3]||(a[3]=[(0,s.Lk)("option",{value:"Accept"},"Accept",-1),(0,s.Lk)("option",{value:"Reject"},"Reject",-1)]),40,ND)),[[i.u1,e.review_status]]):"Yet to Start"===e.review_status&&"Under review"===e.status?((0,s.uX)(),(0,s.CE)("span",$D,[(0,s.Lk)("button",{onClick:a=>n.startReview(e),class:"btn-review",title:"Start review process"}," Start ",8,OD)])):"In Review"!==e.review_status&&"Reject"!==e.review_status||"Under review"!==e.status?((0,s.uX)(),(0,s.CE)("span",QD,(0,d.v_)(e.review_status),1)):((0,s.uX)(),(0,s.CE)("span",jD,[(0,s.Lk)("button",{onClick:a=>n.openReviewDialog(e),class:"btn-review btn-in-progress",title:"Edit review in progress"}," Edit Review ",8,BD),"Rejected"===e.approved_rejected?((0,s.uX)(),(0,s.CE)("span",WD," Rejected ")):(0,s.Q3)("",!0)])),!e.approved_rejected||"Reject"===e.review_status&&"Under review"===e.status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",{key:4,class:(0,d.C4)(["approved-rejected-badge",n.getApprovedRejectedClass(e.approved_rejected)])},(0,d.v_)(e.approved_rejected),3))]),"cell-download":(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"btn-download",disabled:!n.canDownload(e),onClick:a=>n.downloadAuditReport(e.audit_id),title:"Download Audit Report"},a[4]||(a[4]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Download ")]),8,qD)]),_:1},8,["data","columns","filters"]))])}var JD=t(6604);const zD=JD.FH.baseURL||"/api";var HD={name:"ReviewerPage",components:{DynamicTable:Ll.A},data(){return{audits:[],loading:!0,error:null,searchQuery:"",statusFilter:"",columns:[{key:"audit_id",label:"ID"},{key:"framework",label:"Framework"},{key:"policy",label:"Policy",slot:!0},{key:"subpolicy",label:"Subpolicy",slot:!0},{key:"auditor",label:"Auditor"},{key:"duedate",label:"Due Date"},{key:"completion_percentage",label:"Progress",slot:!0},{key:"status",label:"Audit Status"},{key:"review_status",label:"Review Status",slot:!0},{key:"download",label:"Download",slot:!0}],filters:[{name:"statusFilter",label:"Filter by Status",type:"select",values:[{value:"",label:"All Statuses"},{value:"Yet to Start",label:"Yet to Start"},{value:"In Review",label:"In Review"},{value:"Accept",label:"Accepted"},{value:"Reject",label:"Rejected"}],defaultValue:"",filterFunction:(e,a)=>!a||e.review_status===a}]}},computed:{filteredAudits(){let e=this.audits;if(this.searchQuery){const a=this.searchQuery.toLowerCase();e=e.filter(e=>{const t=[e.framework,e.policy,e.subpolicy,e.auditor,e.status,e.review_status].filter(Boolean).map(e=>e.toLowerCase());return t.some(e=>e.includes(a))})}return e}},created(){this.fetchReviewTasks()},methods:{async fetchReviewTasks(){this.loading=!0,this.error=null;try{console.log("Fetching review tasks...");const e=await JD.FH.getMyReviews();this.audits=e.data.audits,console.log(`Fetched ${this.audits.length} review tasks`)}catch(e){console.error("Error fetching review tasks:",e),this.error=e.response?.data?.error||"Failed to load review tasks. Please try again."}finally{this.loading=!1}},getProgressClass(e){return e<30?"progress-low":e<70?"progress-medium":"progress-high"},getApprovedRejectedClass(e){return"Approved"===e?"approved":"Rejected"===e?"rejected":""},canDownload(e){return"Accept"===e.review_status||"ACCEPTED"===e.status||"APPROVED"===e.status},async downloadAuditReport(e){try{console.log(`Downloading audit report for audit ${e}`),this.$popup.success("Generating audit report...");const a=`${zD}/generate-audit-report/${e}/`;console.log(`Downloading report from URL: ${a}`),window.open(a,"_blank"),this.$popup.success("Report download initiated")}catch(a){console.error("Error initiating report download:",a);const e=a.message||"Failed to download report. Please try again.";this.$popup.error(e)}},startReview(e){e.review_status="In Review",this.updateReviewStatus(e),this.openReviewDialog(e)},openReviewDialog(e){console.log(`Opening review for audit ${e.audit_id}`);const a=!0===e.justUpdatedToUnderReview;a?(console.log("This is a fresh review after status change, adding freshReview parameter"),this.$router.push(`/reviewer/task/${e.audit_id}?freshReview=true`)):this.$router.push(`/reviewer/task/${e.audit_id}`)},async updateReviewStatus(e){try{console.log(`Updating review status for audit ${e.audit_id} to ${e.review_status}`);let i=!1;if("Under review"!==e.status){console.log(`Audit status is currently ${e.status}, updating to 'Under review' first`);try{console.log(`Making direct POST request to ${zD}/audits/${e.audit_id}/status/`);const a=await qe.A.post(`${zD}/audits/${e.audit_id}/status/`,{status:"Under review"});console.log("Status update response:",a.data),e.status="Under review",e.justUpdatedToUnderReview=!0,console.log("Audit status updated to Under review"),i=!0}catch(a){console.error("Error updating audit status with direct axios:",a),console.error("Status code:",a.response?.status),console.error("Error message:",a.response?.data||a.message);try{console.log("Trying fallback to api.updateAuditStatus...");const a=await JD.FH.updateAuditStatus(e.audit_id,{status:"Under review"});console.log("Fallback status update successful:",a.data),e.status="Under review",e.justUpdatedToUnderReview=!0,console.log("Audit status updated to Under review via fallback"),i=!0}catch(t){throw console.error("Both direct and fallback status update methods failed:",t),this.$popup.error(`Failed to update audit status. Please try again later. Error: ${t.message||"Unknown error"}`),t}}}let s="";if("Reject"===e.review_status){if(s=await this.$popup.comment("Please provide rejection comments:","Rejection Comments"),null===s)return void this.fetchReviewTasks()}else if("Accept"===e.review_status&&(s=await this.$popup.comment("Please provide any approval comments (optional):","Approval Comments"),null===s))return void this.fetchReviewTasks();const o=await JD.FH.updateReviewStatus(e.audit_id,{review_status:e.review_status,review_comments:s});console.log("Review status updated successfully:",o.data),e.review_comments=s,"Accept"===e.review_status&&o.data.audit_status&&(e.status=o.data.audit_status),this.$popup.success("Review status updated successfully!"),i&&"In Review"===e.review_status&&(console.log("Automatically opening review dialog after status update"),this.openReviewDialog(e))}catch(i){console.error("Error updating review status:",i),this.fetchReviewTasks(),this.$popup.error(i.response?.data?.error||"Failed to update review status. Please try again.")}}}};const YD=(0,se.A)(HD,[["render",KD],["__scopeId","data-v-bece817c"]]);var GD=YD;const ZD={class:"audit_task-view"},eI={key:0,class:"audit_error-message"},aI={key:1,class:"audit_loading"},tI={key:2,class:"audit_content"},iI={class:"audit-details"},sI={class:"audit_details-container"},oI={class:"audit_detail-item"},lI={class:"audit_detail-item"},nI={class:"audit_detail-item"},rI={class:"audit_detail-item"},cI={class:"audit_hierarchy-details"},dI={class:"audit_hierarchy-item"},uI={class:"audit_hierarchy-item"},pI={class:"audit_hierarchy-item"},vI={class:"audit_compliance-section"},mI={class:"audit_compliance-header-row"},kI={class:"audit_compliance-tabs"},hI=["onClick"],gI={key:0,class:"audit_compliance-details"},yI={class:"audit_compliance-header"},fI={class:"audit_compliance-row"},bI={class:"audit_form-group"},CI={key:0,class:"audit_error-message"},LI={class:"audit_form-group"},wI={class:"audit_form-group"},EI={key:0,class:"audit_error-message"},RI={class:"audit_compliance-row"},DI={class:"audit_form-group"},II={class:"audit_form-group"},PI={class:"audit_form-group"},_I={class:"audit_compliance-row"},SI={class:"audit_form-group"},AI={class:"audit_form-group"},TI={class:"audit_form-group"},xI={class:"audit_compliance-row"},FI={class:"audit_form-group"},VI=["value"],MI={class:"audit_form-group"},XI={key:0,class:"audit_corrective-actions-container"},UI={class:"audit_risk-header"},NI={class:"audit_mitigation-actions"},$I={class:"audit_mitigation-checkbox"},OI=["value"],jI={class:"audit_mitigation-text"},BI={key:1,class:"audit_no-actions"},WI={class:"audit_compliance-row"},QI={class:"audit_form-group"},qI={class:"audit_form-group small-input"},KI={class:"audit_form-group"},JI={class:"audit_compliance-row"},zI={class:"audit_form-group checkbox-group"},HI={key:0,class:"audit_form-group"},YI={class:"audit_form-group"},GI={class:"audit_compliance-row"},ZI={class:"audit_form-group"},eP={class:"audit_form-group"},aP={class:"audit_evidence-footer"},tP={class:"audit_form-group"},iP={class:"audit_upload-container"},sP={key:0,class:"audit_uploaded-files"},oP={class:"audit_file-name"},lP={key:0,class:"audit_version-badge-small"},nP=["href"],rP=["onClick"],cP={key:1,class:"audit_upload-progress"},dP={class:"audit_progress-bar"},uP={class:"audit_floating-save-container"},pP=["disabled"],vP={class:"audit_save-text"},mP={class:"audit_evidence-section"},kP={class:"audit_upload-container"},hP={key:0,class:"audit_uploaded-files"},gP={class:"audit_file-name"},yP={key:0,class:"audit_version-badge-small"},fP=["href"],bP=["onClick"],CP={key:1,class:"audit_upload-progress"},LP={class:"audit_progress-bar"},wP={class:"audit_overall-comments-section"},EP={class:"audit_form-group"},RP={class:"audit_overall-review-comments-section"},DP=["disabled"],IP={key:0,class:"audit_version-info"},PP={class:"audit_version-badge"},_P={class:"audit_version-number"},SP={class:"audit_version-type"},AP={key:0,class:"audit_last-saved"},TP={class:"audit_saved-time"},xP={key:1,class:"audit_version-info"},FP={class:"audit_modal-header"},VP={class:"audit_modal-footer"},MP=["disabled"],XP={class:"audit_modal-header"},UP={class:"audit_modal-body"},NP={class:"audit_form-row"},$P={class:"audit_form-group"},OP={key:0,class:"audit_error-message"},jP={class:"audit_form-group"},BP={key:0,class:"audit_error-message"},WP={class:"audit_form-group"},QP={class:"audit_form-row"},qP={class:"audit_form-group"},KP={class:"audit_form-group"},JP={class:"audit_form-row"},zP={class:"audit_form-group"},HP={class:"audit_form-group"},YP={class:"audit_form-row"},GP={class:"audit_form-group"},ZP={class:"audit_radio-group"},e_={class:"audit_radio-label"},a_={class:"audit_radio-label"},t_={class:"audit_form-group"},i_={class:"audit_form-group"},s_={class:"audit_form-row"},o_={class:"audit_form-group"},l_={class:"audit_form-group"},n_={class:"audit_modal-footer"},r_=["disabled"];function c_(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",ZD,[(0,s.Lk)("button",{class:"audit_back-button",onClick:a[0]||(a[0]=a=>e.$router.back())},"Go back"),l.error?((0,s.uX)(),(0,s.CE)("div",eI,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>n.retryFetch&&n.retryFetch(...e)),class:"audit_retry-button"},"Retry")])):l.loading?((0,s.uX)(),(0,s.CE)("div",aI," Loading audit details... ")):l.auditDetails?((0,s.uX)(),(0,s.CE)("div",tI,[(0,s.Lk)("div",iI,[a[105]||(a[105]=(0,s.Lk)("h1",null,"Audit Details",-1)),(0,s.Lk)("div",sI,[(0,s.Lk)("div",oI,[a[71]||(a[71]=(0,s.Lk)("h3",null,"Title",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.title),1)]),(0,s.Lk)("div",lI,[a[72]||(a[72]=(0,s.Lk)("h3",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.scope),1)]),(0,s.Lk)("div",nI,[a[73]||(a[73]=(0,s.Lk)("h3",null,"Objective",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.objective),1)]),(0,s.Lk)("div",rI,[a[74]||(a[74]=(0,s.Lk)("h3",null,"Business Unit",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.business_unit),1)])]),(0,s.Lk)("div",cI,[(0,s.Lk)("div",dI,[a[75]||(a[75]=(0,s.Lk)("h3",null,"Framework",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.framework_name),1)]),a[78]||(a[78]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"â†’",-1)),(0,s.Lk)("div",uI,[a[76]||(a[76]=(0,s.Lk)("h3",null,"Policy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.policy_name),1)]),a[79]||(a[79]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"â†’",-1)),(0,s.Lk)("div",pI,[a[77]||(a[77]=(0,s.Lk)("h3",null,"Subpolicy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.subpolicy_name),1)])]),(0,s.Lk)("div",vI,[(0,s.Lk)("div",mI,[a[81]||(a[81]=(0,s.Lk)("h2",null,"Compliance Items",-1)),(0,s.Lk)("button",{onClick:a[2]||(a[2]=e=>l.showAddComplianceModal=!0),class:"audit_add-compliance-button"},a[80]||(a[80]=[(0,s.Lk)("span",{class:"audit_add-icon"},"+",-1),(0,s.eW)(" Add Compliance ")]))]),(0,s.Lk)("div",kI,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditDetails.compliances,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["audit_tab-button",{active:l.selectedComplianceIndex===a}]),onClick:t=>n.selectCompliance(e,a)}," Compliance "+(0,d.v_)(a+1),11,hI))),128))]),n.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",gI,[(0,s.Lk)("div",yI,[(0,s.Lk)("h3",null,(0,d.v_)(n.selectedCompliance.description),1)]),(0,s.Lk)("div",fI,[(0,s.Lk)("div",bI,[a[83]||(a[83]=(0,s.Lk)("label",null,"Compliance Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>n.selectedCompliance.status=e),onChange:a[4]||(a[4]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},a[82]||(a[82]=[(0,s.Lk)("option",{value:"2"},"Fully Compliant",-1),(0,s.Lk)("option",{value:"1"},"Partially Compliant",-1),(0,s.Lk)("option",{value:"0"},"Not Compliant",-1),(0,s.Lk)("option",{value:"3"},"Not Applicable",-1)]),544),[[i.u1,n.selectedCompliance.status]]),n.getFieldError("status",l.selectedComplianceIndex)?((0,s.uX)(),(0,s.CE)("div",CI,(0,d.v_)(n.getFieldError("status",l.selectedComplianceIndex)),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",LI,[a[85]||(a[85]=(0,s.Lk)("label",null,"Type of Findings",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>n.selectedCompliance.major_minor=e),onChange:a[6]||(a[6]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},a[84]||(a[84]=[(0,s.Lk)("option",{value:""},"Select Type",-1),(0,s.Lk)("option",{value:"0"},"Minor",-1),(0,s.Lk)("option",{value:"1"},"Major",-1)]),544),[[i.u1,n.selectedCompliance.major_minor]])]),(0,s.Lk)("div",wI,[a[86]||(a[86]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=e=>n.selectedCompliance.severity_rating=e),onInput:a[8]||(a[8]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),min:"1",max:"10",class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.severity_rating]]),n.getFieldError("severity_rating",l.selectedComplianceIndex)?((0,s.uX)(),(0,s.CE)("div",EI,(0,d.v_)(n.getFieldError("severity_rating",l.selectedComplianceIndex)),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",RI,[(0,s.Lk)("div",DI,[a[87]||(a[87]=(0,s.Lk)("label",null,"What to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[9]||(a[9]=e=>n.selectedCompliance.what_to_verify=e),onInput:a[10]||(a[10]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.what_to_verify]])]),(0,s.Lk)("div",II,[a[88]||(a[88]=(0,s.Lk)("label",null,"How to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[11]||(a[11]=e=>n.selectedCompliance.how_to_verify=e),onInput:a[12]||(a[12]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.how_to_verify]])]),(0,s.Lk)("div",PI,[a[89]||(a[89]=(0,s.Lk)("label",null,"Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[13]||(a[13]=e=>n.selectedCompliance.impact=e),onInput:a[14]||(a[14]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.impact]])])]),(0,s.Lk)("div",_I,[(0,s.Lk)("div",SI,[a[90]||(a[90]=(0,s.Lk)("label",null,"Why to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[15]||(a[15]=e=>n.selectedCompliance.why_to_verify=e),onInput:a[16]||(a[16]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.why_to_verify]])]),(0,s.Lk)("div",AI,[a[91]||(a[91]=(0,s.Lk)("label",null,"Details of Findings",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[17]||(a[17]=e=>n.selectedCompliance.details_of_finding=e),onInput:a[18]||(a[18]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.details_of_finding]])]),(0,s.Lk)("div",TI,[a[92]||(a[92]=(0,s.Lk)("label",null,"Underlying Cause",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[19]||(a[19]=e=>n.selectedCompliance.underlying_cause=e),onInput:a[20]||(a[20]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.underlying_cause]])])]),(0,s.Lk)("div",xI,[(0,s.Lk)("div",FI,[a[93]||(a[93]=(0,s.Lk)("label",null,"Predictive Risks",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[21]||(a[21]=e=>n.selectedCompliance.selected_risks=e),class:"audit_form-control",multiple:"",onChange:a[22]||(a[22]=(...e)=>n.updateCorrectiveActions&&n.updateCorrectiveActions(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectedCompliance.risks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e},(0,d.v_)(e.title)+" ("+(0,d.v_)(e.category)+") ",9,VI))),128))],544),[[i.u1,n.selectedCompliance.selected_risks]])]),(0,s.Lk)("div",MI,[a[94]||(a[94]=(0,s.Lk)("label",null,"Corrective Actions",-1)),n.selectedCompliance.selected_risks&&n.selectedCompliance.selected_risks.length>0?((0,s.uX)(),(0,s.CE)("div",XI,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectedCompliance.selected_risks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"audit_risk-mitigation"},[(0,s.Lk)("div",UI,[(0,s.Lk)("strong",null,(0,d.v_)(e.title),1)]),(0,s.Lk)("div",NI,[(0,s.Lk)("label",$I,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[23]||(a[23]=e=>n.selectedCompliance.selected_mitigations=e),value:{risk_id:e.id,mitigation:e.mitigation},onChange:a[24]||(a[24]=(...e)=>n.handleMitigationChange&&n.handleMitigationChange(...e))},null,40,OI),[[i.lH,n.selectedCompliance.selected_mitigations]]),(0,s.Lk)("span",jI,(0,d.v_)(e.mitigation),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",BI," Select risks to view corrective actions "))])]),(0,s.Lk)("div",WI,[(0,s.Lk)("div",QI,[a[95]||(a[95]=(0,s.Lk)("label",null,"Suggested Action Plan",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[25]||(a[25]=e=>n.selectedCompliance.suggested_action_plan=e),onInput:a[26]||(a[26]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.suggested_action_plan]])]),(0,s.Lk)("div",qI,[a[96]||(a[96]=(0,s.Lk)("label",null,"Responsible for Plan",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[27]||(a[27]=e=>n.selectedCompliance.responsible_for_plan=e),onInput:a[28]||(a[28]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.responsible_for_plan]])]),(0,s.Lk)("div",KI,[a[97]||(a[97]=(0,s.Lk)("label",null,"Mitigation Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[29]||(a[29]=e=>n.selectedCompliance.mitigation_date=e),onChange:a[30]||(a[30]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.mitigation_date]])])]),(0,s.Lk)("div",JI,[(0,s.Lk)("div",zI,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[31]||(a[31]=e=>n.selectedCompliance.re_audit=e),onChange:a[32]||(a[32]=(...e)=>n.onFieldChange&&n.onFieldChange(...e))},null,544),[[i.lH,n.selectedCompliance.re_audit]]),a[98]||(a[98]=(0,s.eW)(" Re-audit Required "))])]),n.selectedCompliance.re_audit?((0,s.uX)(),(0,s.CE)("div",HI,[a[99]||(a[99]=(0,s.Lk)("label",null,"Re-audit Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[33]||(a[33]=e=>n.selectedCompliance.re_audit_date=e),onChange:a[34]||(a[34]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.re_audit_date]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",YI,[a[100]||(a[100]=(0,s.Lk)("label",null,"Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[35]||(a[35]=e=>n.selectedCompliance.comments=e),onInput:a[36]||(a[36]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[i.Jo,n.selectedCompliance.comments]])])]),(0,s.Lk)("div",GI,[(0,s.Lk)("div",ZI,[a[102]||(a[102]=(0,s.Lk)("label",null,"Review Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[37]||(a[37]=e=>n.selectedCompliance.review_status=e),disabled:"",class:"audit_form-control disabled"},a[101]||(a[101]=[(0,s.Lk)("option",{value:"in_review"},"In Review",-1),(0,s.Lk)("option",{value:"accept"},"Accept",-1),(0,s.Lk)("option",{value:"reject"},"Reject",-1)]),512),[[i.u1,n.selectedCompliance.review_status]])]),(0,s.Lk)("div",eP,[a[103]||(a[103]=(0,s.Lk)("label",null,"Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[38]||(a[38]=e=>n.selectedCompliance.review_comments=e),disabled:"",class:"audit_form-control disabled",placeholder:"Review comments will appear here..."},null,512),[[i.Jo,n.selectedCompliance.review_comments]])])]),(0,s.Lk)("div",aP,[(0,s.Lk)("div",tP,[a[104]||(a[104]=(0,s.Lk)("label",null,"Compliance Evidence",-1)),(0,s.Lk)("div",iP,[(0,s.Lk)("input",{type:"file",onChange:a[39]||(a[39]=(...e)=>n.handleComplianceFileUpload&&n.handleComplianceFileUpload(...e)),ref:"complianceFileInput",multiple:"",style:{display:"none"}},null,544),(0,s.Lk)("button",{onClick:a[40]||(a[40]=a=>e.$refs.complianceFileInput.click()),class:"audit_upload-button"}," Upload Compliance Evidence "),n.selectedCompliance.evidence_files&&n.selectedCompliance.evidence_files.length>0?((0,s.uX)(),(0,s.CE)("div",sP,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectedCompliance.evidence_files,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["audit_file-item",{"from-version":e.fromVersion}])},[(0,s.Lk)("span",oP,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",lP,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"ðŸ‘ï¸",8,nP)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:e=>n.removeComplianceFile(a),class:"audit_remove-file-btn"},"Ã—",8,rP)],2))),128))])):(0,s.Q3)("",!0),l.complianceUploadProgress>0&&l.complianceUploadProgress<100?((0,s.uX)(),(0,s.CE)("div",cP,[(0,s.Lk)("div",dP,[(0,s.Lk)("div",{class:"audit_progress-fill",style:(0,d.Tr)({width:l.complianceUploadProgress+"%"})},null,4)]),(0,s.Lk)("span",null,(0,d.v_)(l.complianceUploadProgress)+"%",1)])):(0,s.Q3)("",!0)])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",uP,[(0,s.Lk)("button",{onClick:a[41]||(a[41]=(...e)=>n.saveCompliance&&n.saveCompliance(...e)),class:"audit_floating-save-button",disabled:l.isSaving},[(0,s.Lk)("span",vP,(0,d.v_)(l.isSaving?"Saving Version...":"Save Changes"),1)],8,pP)])])]),(0,s.Lk)("div",mP,[a[106]||(a[106]=(0,s.Lk)("h3",null,"Audit Evidence",-1)),(0,s.Lk)("div",kP,[(0,s.Lk)("input",{type:"file",onChange:a[42]||(a[42]=(...e)=>n.handleAuditFileUpload&&n.handleAuditFileUpload(...e)),ref:"auditFileInput",multiple:"",style:{display:"none"}},null,544),(0,s.Lk)("button",{onClick:a[43]||(a[43]=a=>e.$refs.auditFileInput.click()),class:"audit_upload-button audit_audit-upload"}," Upload Audit Evidence "),l.auditEvidenceFiles&&l.auditEvidenceFiles.length>0?((0,s.uX)(),(0,s.CE)("div",hP,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditEvidenceFiles,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["audit_file-item",{"from-version":e.fromVersion}])},[(0,s.Lk)("span",gP,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",yP,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"ðŸ‘ï¸",8,fP)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:e=>n.removeAuditFile(a),class:"audit_remove-file-btn"},"Ã—",8,bP)],2))),128))])):(0,s.Q3)("",!0),l.auditUploadProgress>0&&l.auditUploadProgress<100?((0,s.uX)(),(0,s.CE)("div",CP,[(0,s.Lk)("div",LP,[(0,s.Lk)("div",{class:"audit_progress-fill",style:(0,d.Tr)({width:l.auditUploadProgress+"%"})},null,4)]),(0,s.Lk)("span",null,(0,d.v_)(l.auditUploadProgress)+"%",1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",wP,[a[107]||(a[107]=(0,s.Lk)("h3",null,"Overall Audit Comments",-1)),(0,s.Lk)("div",EP,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[44]||(a[44]=e=>l.overallAuditComments=e),onInput:a[45]||(a[45]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control audit_overall-comments-textarea",placeholder:"Enter overall comments about this audit...",rows:"4"},null,544),[[i.Jo,l.overallAuditComments]])])]),(0,s.Lk)("div",RP,[a[108]||(a[108]=(0,s.Lk)("h3",null,"Overall Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[46]||(a[46]=e=>l.overallReviewComments=e),disabled:l.isAuditFrozen,class:"audit_form-control",placeholder:"Enter overall review comments...",rows:"4"},null,8,DP),[[i.Jo,l.overallReviewComments]])]),l.currentVersion?((0,s.uX)(),(0,s.CE)("div",IP,[(0,s.Lk)("div",PP,[a[109]||(a[109]=(0,s.Lk)("span",{class:"audit_version-label"},"Current Version:",-1)),(0,s.Lk)("span",_P,(0,d.v_)(l.currentVersion),1),(0,s.Lk)("span",SP,(0,d.v_)(n.getVersionType(l.currentVersion)),1)]),l.lastSavedTime?((0,s.uX)(),(0,s.CE)("div",AP,[a[110]||(a[110]=(0,s.Lk)("span",{class:"audit_saved-label"},"Last Saved:",-1)),(0,s.Lk)("span",TP,(0,d.v_)(n.formatDateTime(l.lastSavedTime)),1)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",xP,a[111]||(a[111]=[(0,s.Lk)("div",{class:"audit_version-badge"},[(0,s.Lk)("span",{class:"audit_version-label"},"Status:"),(0,s.Lk)("span",{class:"audit_version-number new-audit"},"New Audit"),(0,s.Lk)("span",{class:"audit_version-type"},"No versions saved yet")],-1)])))])):(0,s.Q3)("",!0),l.showReviewModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"audit_modal-overlay",onClick:a[51]||(a[51]=(...e)=>n.closeReviewModal&&n.closeReviewModal(...e))},[(0,s.Lk)("div",{class:"audit_modal-content",onClick:a[50]||(a[50]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",FP,[a[112]||(a[112]=(0,s.Lk)("h3",null,"Update Audit Status",-1)),(0,s.Lk)("button",{onClick:a[47]||(a[47]=(...e)=>n.closeReviewModal&&n.closeReviewModal(...e)),class:"audit_close-button"},"Ã—")]),a[113]||(a[113]=(0,s.Lk)("div",{class:"audit_modal-body"},[(0,s.Lk)("div",{class:"audit_success-message"},[(0,s.Lk)("h4",null,"Changes Saved Successfully"),(0,s.Lk)("p",null,"You have saved the following changes:")]),(0,s.Lk)("div",{class:"audit_review-question"},[(0,s.Lk)("h4",null,"Do you want to send this audit for review?"),(0,s.Lk)("p",{class:"audit_review-note"},[(0,s.Lk)("em",null,'This will change the audit status from "Work In Progress" to "Under Review"')])])],-1)),(0,s.Lk)("div",VP,[(0,s.Lk)("button",{onClick:a[48]||(a[48]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_btn-secondary"},"No, Keep Editing"),(0,s.Lk)("button",{onClick:a[49]||(a[49]=(...e)=>n.sendForReview&&n.sendForReview(...e)),class:"audit_btn-primary",disabled:l.isSendingForReview},(0,d.v_)(l.isSendingForReview?"Sending...":"Yes, Send for Review"),9,MP)])])])):(0,s.Q3)("",!0),l.showAddComplianceModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"audit_modal-overlay",onClick:a[70]||(a[70]=(...e)=>n.closeAddComplianceModal&&n.closeAddComplianceModal(...e))},[(0,s.Lk)("div",{class:"audit_modal-content audit_add-compliance-modal",onClick:a[69]||(a[69]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",XP,[a[114]||(a[114]=(0,s.Lk)("h3",null,"Add New Compliance",-1)),(0,s.Lk)("button",{onClick:a[52]||(a[52]=(...e)=>n.closeAddComplianceModal&&n.closeAddComplianceModal(...e)),class:"audit_close-button"},"Ã—")]),(0,s.Lk)("div",UP,[(0,s.Lk)("form",{onSubmit:a[66]||(a[66]=(0,i.D$)((...e)=>n.submitNewCompliance&&n.submitNewCompliance(...e),["prevent"]))},[(0,s.Lk)("div",NP,[(0,s.Lk)("div",$P,[a[115]||(a[115]=(0,s.Lk)("label",null,"Identifier*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[53]||(a[53]=e=>l.newCompliance.identifier=e),required:"",class:"audit_form-control"},null,512),[[i.Jo,l.newCompliance.identifier]]),n.getFieldError("identifier")?((0,s.uX)(),(0,s.CE)("div",OP,(0,d.v_)(n.getFieldError("identifier")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",jP,[a[116]||(a[116]=(0,s.Lk)("label",null,"Compliance Title*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[54]||(a[54]=e=>l.newCompliance.complianceTitle=e),required:"",class:"audit_form-control"},null,512),[[i.Jo,l.newCompliance.complianceTitle]]),n.getFieldError("complianceTitle")?((0,s.uX)(),(0,s.CE)("div",BP,(0,d.v_)(n.getFieldError("complianceTitle")),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",WP,[a[117]||(a[117]=(0,s.Lk)("label",null,"Compliance Description*",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[55]||(a[55]=e=>l.newCompliance.complianceItemDescription=e),required:"",class:"audit_form-control",rows:"3"},null,512),[[i.Jo,l.newCompliance.complianceItemDescription]])]),(0,s.Lk)("div",QP,[(0,s.Lk)("div",qP,[a[118]||(a[118]=(0,s.Lk)("label",null,"Compliance Type*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[56]||(a[56]=e=>l.newCompliance.complianceType=e),required:"",class:"audit_form-control"},null,512),[[i.Jo,l.newCompliance.complianceType]])]),(0,s.Lk)("div",KP,[a[119]||(a[119]=(0,s.Lk)("label",null,"Scope*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[57]||(a[57]=e=>l.newCompliance.scope=e),required:"",class:"audit_form-control"},null,512),[[i.Jo,l.newCompliance.scope]])])]),(0,s.Lk)("div",JP,[(0,s.Lk)("div",zP,[a[120]||(a[120]=(0,s.Lk)("label",null,"Objective*",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[58]||(a[58]=e=>l.newCompliance.objective=e),required:"",class:"audit_form-control",rows:"2"},null,512),[[i.Jo,l.newCompliance.objective]])]),(0,s.Lk)("div",HP,[a[121]||(a[121]=(0,s.Lk)("label",null,"Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[59]||(a[59]=e=>l.newCompliance.impact=e),class:"audit_form-control",rows:"2"},null,512),[[i.Jo,l.newCompliance.impact]])])]),(0,s.Lk)("div",YP,[(0,s.Lk)("div",GP,[a[124]||(a[124]=(0,s.Lk)("label",null,"Is Risk?",-1)),(0,s.Lk)("div",ZP,[(0,s.Lk)("label",e_,[(0,s.bo)((0,s.Lk)("input",{type:"radio","onUpdate:modelValue":a[60]||(a[60]=e=>l.newCompliance.isRisk=e),value:1},null,512),[[i.XL,l.newCompliance.isRisk]]),a[122]||(a[122]=(0,s.eW)(" Yes "))]),(0,s.Lk)("label",a_,[(0,s.bo)((0,s.Lk)("input",{type:"radio","onUpdate:modelValue":a[61]||(a[61]=e=>l.newCompliance.isRisk=e),value:0},null,512),[[i.XL,l.newCompliance.isRisk]]),a[123]||(a[123]=(0,s.eW)(" No "))])])]),(0,s.Lk)("div",t_,[a[126]||(a[126]=(0,s.Lk)("label",null,"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[62]||(a[62]=e=>l.newCompliance.criticality=e),class:"audit_form-control"},a[125]||(a[125]=[(0,s.Lk)("option",{value:"high"},"High",-1),(0,s.Lk)("option",{value:"medium"},"Medium",-1),(0,s.Lk)("option",{value:"low"},"Low",-1)]),512),[[i.u1,l.newCompliance.criticality]])]),(0,s.Lk)("div",i_,[a[128]||(a[128]=(0,s.Lk)("label",null,"Probability",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[63]||(a[63]=e=>l.newCompliance.probability=e),class:"audit_form-control"},a[127]||(a[127]=[(0,s.Lk)("option",{value:"high"},"High",-1),(0,s.Lk)("option",{value:"medium"},"Medium",-1),(0,s.Lk)("option",{value:"low"},"Low",-1)]),512),[[i.u1,l.newCompliance.probability]])])]),(0,s.Lk)("div",s_,[(0,s.Lk)("div",o_,[a[129]||(a[129]=(0,s.Lk)("label",null,"Possible Damage",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[64]||(a[64]=e=>l.newCompliance.possibleDamage=e),class:"audit_form-control",rows:"2"},null,512),[[i.Jo,l.newCompliance.possibleDamage]])]),(0,s.Lk)("div",l_,[a[130]||(a[130]=(0,s.Lk)("label",null,"Mitigation",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[65]||(a[65]=e=>l.newCompliance.mitigation=e),class:"audit_form-control",rows:"2"},null,512),[[i.Jo,l.newCompliance.mitigation]])])]),a[131]||(a[131]=(0,s.Lk)("div",{class:"audit_form-note"},[(0,s.Lk)("p",null,[(0,s.Lk)("strong",null,"Note:"),(0,s.eW)(" Fields marked with * are required")]),(0,s.Lk)("p",null,'This compliance will be added as "Temporary" and associated with the current audit.')],-1))],32)]),(0,s.Lk)("div",n_,[(0,s.Lk)("button",{onClick:a[67]||(a[67]=(...e)=>n.closeAddComplianceModal&&n.closeAddComplianceModal(...e)),class:"audit_btn-secondary"},"Cancel"),(0,s.Lk)("button",{onClick:a[68]||(a[68]=(...e)=>n.submitNewCompliance&&n.submitNewCompliance(...e)),class:"audit_btn-primary",disabled:l.isAddingCompliance},(0,d.v_)(l.isAddingCompliance?"Adding...":"Add Compliance"),9,r_)])])])):(0,s.Q3)("",!0)])}var d_={name:"TaskView",mixins:[lD],data(){return{auditDetails:null,error:null,loading:!0,selectedComplianceIndex:null,auditEvidenceFiles:[],complianceUploadProgress:0,auditUploadProgress:0,currentVersion:null,lastSavedTime:null,isSaving:!1,hasUnsavedChanges:!1,overallAuditComments:"",showReviewModal:!1,isSendingForReview:!1,savedVersionData:null,showAddComplianceModal:!1,isAddingCompliance:!1,newCompliance:{identifier:"",complianceTitle:"",complianceItemDescription:"",complianceType:"",scope:"",objective:"",impact:"",isRisk:0,possibleDamage:"",mitigation:"",criticality:"medium",probability:"medium"},isAuditFrozen:!1,overallReviewComments:"",validationErrors:{},fieldErrors:{}}},computed:{selectedCompliance(){return this.auditDetails?.compliances?this.auditDetails.compliances[this.selectedComplianceIndex]:null}},watch:{auditDetails:{handler(e,a){a&&e&&(this.hasUnsavedChanges=!0)},deep:!0},auditEvidenceFiles:{handler(){this.hasUnsavedChanges=!0},deep:!0}},methods:{formatDateTime(e){return e?new Date(e).toLocaleString():""},getVersionType(e){return e?e.startsWith("A")?"Auditor Version":e.startsWith("R")?"Reviewer Version":"Unknown Version":""},extractFilenameFromUrl(e){if(!e)return null;try{const a=e.split("/"),t=a[a.length-1];return decodeURIComponent(t)}catch(a){return console.warn("Error extracting filename from URL:",e,a),null}},async handleComplianceFileUpload(e){const a=Array.from(e.target.files);if(0===a.length)return;this.complianceUploadProgress=0,this.onFieldChange();const t=[];try{for(let s=0;s<a.length;s++){const e=a[s],i=new FormData;i.append("file",e),i.append("userId","current-user"),i.append("documentType","evidence"),i.append("compliance_id",this.selectedCompliance.id),i.append("audit_id",this.$route.params.auditId),i.append("fileName",e.name);const o=await JD.FH.uploadFile(i,e=>{const t=Math.round(100*e.loaded/e.total);this.complianceUploadProgress=Math.round((100*s+t)/a.length)});o.data.success&&(t.push(o.data.file.url),this.selectedCompliance.evidence_files.push({name:e.name,url:o.data.file.url,uploadedAt:(new Date).toISOString(),fromVersion:!1}))}const e=this.selectedCompliance.evidence?this.selectedCompliance.evidence.split(",").filter(e=>e.trim()):[],i=[...e];t.forEach(e=>{i.includes(e)||i.push(e)}),this.selectedCompliance.evidence_urls=i.join(","),this.selectedCompliance.evidence=this.selectedCompliance.evidence_urls,console.log("Updated evidence URLs:",this.selectedCompliance.evidence),this.complianceUploadProgress=100,this.hasUnsavedChanges=!0,setTimeout(()=>{this.complianceUploadProgress=0},2e3),this.$toast?.success(`${a.length} compliance evidence file(s) uploaded successfully`)}catch(i){console.error("Error uploading compliance files:",i),this.$toast?.error("Failed to upload compliance evidence files"),this.complianceUploadProgress=0}e.target.value=""},async handleAuditFileUpload(e){const a=Array.from(e.target.files);if(0===a.length)return;this.auditUploadProgress=0,this.onFieldChange();const t=[];try{for(let s=0;s<a.length;s++){const e=a[s],i=new FormData;i.append("file",e),i.append("userId","current-user"),i.append("documentType","audit_evidence"),i.append("audit_id",this.$route.params.auditId),i.append("fileName",e.name);const o=await JD.FH.uploadFile(i,e=>{const t=Math.round(100*e.loaded/e.total);this.auditUploadProgress=Math.round((100*s+t)/a.length)});o.data.success&&(t.push(o.data.file.url),this.auditEvidenceFiles.push({name:e.name,url:o.data.file.url,uploadedAt:(new Date).toISOString(),fromVersion:!1}))}const e=this.auditDetails.evidence_urls?this.auditDetails.evidence_urls.split(",").filter(e=>e.trim()):[],i=[...e];t.forEach(e=>{i.includes(e)||i.push(e)}),this.auditDetails.evidence_urls=i.join(","),console.log("Updated audit evidence URLs:",this.auditDetails.evidence_urls),this.auditUploadProgress=100,this.hasUnsavedChanges=!0,setTimeout(()=>{this.auditUploadProgress=0},2e3),this.$toast?.success(`${a.length} audit evidence file(s) uploaded successfully`)}catch(i){console.error("Error uploading audit files:",i),this.$toast?.error("Failed to upload audit evidence files"),this.auditUploadProgress=0}e.target.value=""},removeComplianceFile(e){const a=this.selectedCompliance.evidence_files[e];if(this.selectedCompliance.evidence_files.splice(e,1),a&&a.url){const e=this.selectedCompliance.evidence.split(",").filter(e=>e.trim()),t=e.filter(e=>e!==a.url);this.selectedCompliance.evidence=t.join(","),this.selectedCompliance.evidence_urls=this.selectedCompliance.evidence,console.log("Updated evidence URLs after removal:",this.selectedCompliance.evidence)}this.onFieldChange()},removeAuditFile(e){const a=this.auditEvidenceFiles[e];if(this.auditEvidenceFiles.splice(e,1),a&&a.url){const e=this.auditDetails.evidence_urls.split(",").filter(e=>e.trim()),t=e.filter(e=>e!==a.url);this.auditDetails.evidence_urls=t.join(","),console.log("Updated audit evidence URLs after removal:",this.auditDetails.evidence_urls)}this.onFieldChange()},async fetchAuditDetails(){this.loading=!0,this.error=null;try{this.error=null;const e=this.$route.params.auditId;if(!e)return void(this.error="No audit ID provided");console.log("Fetching details for audit:",e);const a=await JD.FH.getAuditTaskDetails(e);if(this.auditDetails=a.data,this.auditDetails.compliances.forEach(e=>{if(e.selected_risks=e.selected_risks||[],e.selected_mitigations=e.selected_mitigations||[],e.risks=e.risks||[],e.evidence_files=[],e.evidence_urls=e.evidence||"",e.evidence){const a=e.evidence.split(",").filter(e=>e.trim());e.evidence_files=a.map((e,a)=>{const t=this.extractFilenameFromUrl(e)||`Evidence ${a+1}`;return{name:t,url:e.trim(),uploadedAt:null,fromVersion:this.auditDetails.loaded_from_version||!1}})}}),this.auditEvidenceFiles=[],this.auditDetails.evidence_urls){const e=this.auditDetails.evidence_urls.split(",").filter(e=>e.trim());this.auditEvidenceFiles=e.map((e,a)=>{const t=this.extractFilenameFromUrl(e)||`Audit Evidence ${a+1}`;return{name:t,url:e.trim(),uploadedAt:null,fromVersion:this.auditDetails.loaded_from_version||!1}})}this.auditDetails.current_version&&(this.currentVersion=this.auditDetails.current_version,this.lastSavedTime=this.auditDetails.version_date,console.log(`Loaded version: ${this.currentVersion} from ${this.lastSavedTime}`),this.auditDetails.loaded_from_version?this.$toast?.info(`Loaded data from ${this.getVersionType(this.currentVersion)} ${this.currentVersion}`):"A1"===this.currentVersion&&this.$toast?.success(`Initial version ${this.currentVersion} created successfully`)),this.overallAuditComments=this.auditDetails.overall_audit_comments||"",this.overallReviewComments=this.auditDetails.overall_review_comments||"",this.hasUnsavedChanges=!0,this.auditDetails.compliances&&this.auditDetails.compliances.length>0&&null===this.selectedComplianceIndex&&this.selectCompliance(this.auditDetails.compliances[0],0),console.log(`Loaded ${this.auditDetails.compliances?this.auditDetails.compliances.length:0} compliances`)}catch(e){console.error("Error fetching audit details:",e),this.error=e.response?.data?.error||"Failed to load audit details"}finally{this.loading=!1}},retryFetch(){this.fetchAuditDetails()},getStatusClass(e){switch(e){case"2":return"status-completed";case"1":return"status-progress";case"0":return"status-pending";default:return"status-pending"}},getStatusText(e){switch(e){case"2":return"Completed";case"1":return"In Progress";case"0":return"Not Started";default:return"Not Started"}},updateCorrectiveActions(){this.selectedCompliance.selected_mitigations=[],this.hasUnsavedChanges=!0,this.onFieldChange()},handleMitigationChange(){this.hasUnsavedChanges=!0},onFieldChange(){this.hasUnsavedChanges=!0,this.selectedCompliance&&null!==this.selectedComplianceIndex&&(this.fieldErrors[this.selectedComplianceIndex]&&(this.fieldErrors[this.selectedComplianceIndex]={}),this.validateComplianceField("status",this.selectedCompliance.status,this.selectedComplianceIndex),this.validateComplianceField("severity_rating",this.selectedCompliance.severity_rating,this.selectedComplianceIndex),this.validateComplianceField("major_minor",this.selectedCompliance.major_minor,this.selectedComplianceIndex))},async saveCompliance(){if(console.log("Save button clicked!"),console.log("isSaving state:",this.isSaving),this.isSaving)return;const e=this.validateAuditData();if(console.log("Validation result:",e),console.log("Field errors:",this.fieldErrors),console.log("Validation errors:",this.validationErrors),!e){console.log("Validation failed - showing specific errors");let e="Validation errors found:";Object.keys(this.validationErrors).length>0&&(e+=" "+Object.values(this.validationErrors).join(", "));for(const a in this.fieldErrors)Object.keys(this.fieldErrors[a]).length>0&&(e+=` Compliance ${parseInt(a)+1}: `+Object.values(this.fieldErrors[a]).join(", "));return void this.$toast?.error(e)}console.log("Starting save operation...");try{this.isSaving=!0;const e=e=>{if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;try{const a=new Date(e);if(!isNaN(a.getTime()))return a.toISOString().split("T")[0]}catch(a){console.warn("Could not parse date:",e)}return e},a={};console.log("Processing compliances:",this.auditDetails.compliances.length),this.auditDetails.compliances.forEach(t=>{console.log("Processing compliance:",t.id,"mitigation_date:",t.mitigation_date),a[t.id]={description:t.description,status:t.status,evidence:t.evidence||"",comments:t.comments||"",how_to_verify:t.how_to_verify||"",impact:t.impact||"",recommendation:t.recommendation||"",details_of_finding:t.details_of_finding||"",major_minor:t.major_minor||"",severity_rating:t.severity_rating||"",why_to_verify:t.why_to_verify||"",what_to_verify:t.what_to_verify||"",underlying_cause:t.underlying_cause||"",suggested_action_plan:t.suggested_action_plan||"",responsible_for_plan:t.responsible_for_plan||"",mitigation_date:e(t.mitigation_date),re_audit:t.re_audit||!1,re_audit_date:e(t.re_audit_date),selected_risks:t.selected_risks||[],selected_mitigations:t.selected_mitigations||[],review_status:t.review_status||"in_review",review_comments:t.review_comments||""},console.log("Formatted mitigation_date for compliance",t.id,":",a[t.id].mitigation_date)});const t=this.auditEvidenceFiles.map(e=>e.url).join(",");console.log("Audit evidence URLs being saved:",t);const i={user_id:1050,compliances:a,audit_evidence_urls:t||this.auditDetails.evidence_urls||"",audit_title:this.auditDetails.title||"",audit_scope:this.auditDetails.scope||"",audit_objective:this.auditDetails.objective||"",business_unit:this.auditDetails.business_unit||"",overall_comments:this.overallAuditComments||""};console.log("Payload to be sent:",JSON.stringify(i,null,2));const s=this.$route.params.auditId;console.log("Calling api.saveVersion with auditId:",s);const o=await JD.FH.saveVersion(s,i);if(console.log("Save response received:",o),!o.data.success)throw new Error("Failed to save audit version");this.savedVersionData={version:o.data.version,data:o.data.data},this.hasUnsavedChanges=!1,this.currentVersion=o.data.version,this.lastSavedTime=(new Date).toISOString(),this.validationErrors={},this.fieldErrors={},console.log("Saved version:",o.data.version),console.log("Version data:",o.data.data),this.showReviewModal=!0}catch(a){console.error("Error saving audit version:",a),400===a.response?.status&&a.response?.data?.error?a.response.data.error.includes("Validation error")?this.$toast?.error("Validation error: "+a.response.data.error):this.$toast?.error(a.response.data.error):this.$toast?.error("Failed to save audit version: "+(a.response?.data?.error||a.message))}finally{this.isSaving=!1}},selectCompliance(e,a){console.log("Selecting compliance:",e.id,"at index:",a),this.selectedComplianceIndex=a,this.onFieldChange(),console.log("Selected compliance is now:",this.selectedCompliance?.id)},closeReviewModal(){this.showReviewModal=!1,this.savedVersionData=null},keepEditing(){this.closeReviewModal(),this.$toast?.success(`Audit version ${this.currentVersion} saved successfully`)},async sendForReview(){if(!this.isSendingForReview)try{this.isSendingForReview=!0;const e=this.$route.params.auditId,a=await JD.FH.sendForReview(e,{version:this.currentVersion});if(!a.data.success)throw new Error("Failed to send audit for review");this.closeReviewModal(),this.$toast?.success("Audit sent for review successfully")}catch(e){console.error("Error sending audit for review:",e),this.$toast?.error("Failed to send audit for review: "+(e.response?.data?.error||e.message))}finally{this.isSendingForReview=!1}},closeAddComplianceModal(){this.showAddComplianceModal=!1,this.newCompliance={identifier:"",complianceTitle:"",complianceItemDescription:"",complianceType:"",scope:"",objective:"",impact:"",isRisk:0,possibleDamage:"",mitigation:"",criticality:"medium",probability:"medium"}},async submitNewCompliance(){if(!this.isAddingCompliance)if(this.validateNewComplianceForm())try{this.isAddingCompliance=!0;const e=this.$route.params.auditId,a={identifier:this.newCompliance.identifier,complianceTitle:this.newCompliance.complianceTitle,complianceItemDescription:this.newCompliance.complianceItemDescription,complianceType:this.newCompliance.complianceType,scope:this.newCompliance.scope,objective:this.newCompliance.objective,impact:this.newCompliance.impact||"",isRisk:Number(this.newCompliance.isRisk||0),possibleDamage:this.newCompliance.possibleDamage||"",mitigation:this.newCompliance.mitigation||"",criticality:this.newCompliance.criticality||"medium",probability:this.newCompliance.probability||"medium",permanentTemporary:"Temporary",createdByName:"1050",createdByDate:(new Date).toISOString().split("T")[0]};console.log("Submitting compliance data:",a);const t=await JD.FH.addComplianceToAudit(e,a);if(!t.data.success)throw new Error(t.data.error||"Failed to add compliance");if(this.$toast?.success("Compliance added successfully"),this.closeAddComplianceModal(),console.log("Refreshing audit details with the latest data including the new compliance"),await this.fetchAuditDetails(),this.auditDetails&&this.auditDetails.compliances&&this.auditDetails.compliances.length>0){const e=this.auditDetails.compliances.length-1;this.selectCompliance(this.auditDetails.compliances[e],e),this.currentVersion&&this.$toast?.info(`Updated to version ${this.currentVersion} with the added compliance`)}}catch(e){console.error("Error adding compliance:",e);let a="Failed to add compliance";400===e.response?.status&&e.response?.data?.error?a=e.response.data.error.includes("Validation error")?"Validation error: "+e.response.data.error:e.response.data.error:e.response?.data?.error?(a+=": "+e.response.data.error,console.error("Server error details:",e.response.data)):e.message&&(a+=": "+e.message),this.$toast?.error(a)}finally{this.isAddingCompliance=!1}else this.$toast?.error("Please fix validation errors before submitting")},validateComplianceField(e,a,t=null){const i={};switch(e){case"status":{const e=this.validateComplianceStatus(a);e&&(i.status=e);break}case"severity_rating":if(null!==a&&""!==a){const e=parseInt(a);(isNaN(e)||e<1||e>10)&&(i.severity_rating="Severity rating must be between 1 and 10")}break;case"major_minor":a&&!["0","1"].includes(a)&&(i.major_minor="Invalid finding type");break;case"comments":case"how_to_verify":case"impact":case"details_of_finding":case"underlying_cause":case"suggested_action_plan":case"why_to_verify":case"what_to_verify":{const t=this.validateString(a,{required:!1,minLength:0,maxLength:"comments"===e||"details_of_finding"===e||"suggested_action_plan"===e?2e3:1e3,fieldName:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())});t&&(i[e]=t);break}case"responsible_for_plan":{const t=this.validateString(a,{required:!1,minLength:0,maxLength:200,fieldName:"Responsible for Plan"});t&&(i[e]=t);break}case"mitigation_date":case"re_audit_date":if(a){const t=this.validateDate(a,e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()));t&&(i[e]=t)}break}return null!==t&&(this.fieldErrors[t]||(this.fieldErrors[t]={}),Object.keys(i).length>0?this.fieldErrors[t]={...this.fieldErrors[t],...i}:delete this.fieldErrors[t][e]),0===Object.keys(i).length},validateComplianceStatus(e){const a=["0","1","2","3"];return a.includes(e)?null:"Invalid compliance status"},validateNewComplianceForm(){const e={},a=["identifier","complianceTitle","complianceItemDescription","complianceType","scope","objective"];a.forEach(a=>{const t=this.newCompliance[a];t&&""!==t.trim()||(e[a]=`${a.replace(/([A-Z])/g," $1").toLowerCase()} is required`)});const t=this.validateString(this.newCompliance.identifier,{fieldName:"Identifier",minLength:1,maxLength:100});t&&(e.identifier=t);const i=this.validateString(this.newCompliance.complianceTitle,{fieldName:"Compliance Title",minLength:1,maxLength:200});i&&(e.complianceTitle=i);const s=this.validateString(this.newCompliance.complianceItemDescription,{fieldName:"Compliance Description",minLength:1,maxLength:2e3});s&&(e.complianceItemDescription=s);const o=this.validateString(this.newCompliance.complianceType,{fieldName:"Compliance Type",minLength:1,maxLength:100});o&&(e.complianceType=o);const l=this.validateString(this.newCompliance.scope,{fieldName:"Scope",minLength:1,maxLength:500});l&&(e.scope=l);const n=this.validateString(this.newCompliance.objective,{fieldName:"Objective",minLength:1,maxLength:1e3});if(n&&(e.objective=n),this.newCompliance.impact){const a=this.validateString(this.newCompliance.impact,{fieldName:"Impact",required:!1,maxLength:1e3});a&&(e.impact=a)}if(this.newCompliance.possibleDamage){const a=this.validateString(this.newCompliance.possibleDamage,{fieldName:"Possible Damage",required:!1,maxLength:1e3});a&&(e.possibleDamage=a)}if(this.newCompliance.mitigation){const a=this.validateString(this.newCompliance.mitigation,{fieldName:"Mitigation",required:!1,maxLength:1e3});a&&(e.mitigation=a)}const r=["high","medium","low"];return r.includes(this.newCompliance.criticality)||(e.criticality="Criticality must be high, medium, or low"),r.includes(this.newCompliance.probability)||(e.probability="Probability must be high, medium, or low"),0!==this.newCompliance.isRisk&&1!==this.newCompliance.isRisk&&(e.isRisk="Is Risk must be yes or no"),this.validationErrors=e,0===Object.keys(e).length},validateAuditData(){const e={};if(this.overallAuditComments){const a=this.validateString(this.overallAuditComments,{fieldName:"Overall Audit Comments",required:!1,maxLength:5e3});a&&(e.overallAuditComments=a)}this.auditEvidenceFiles&&this.auditEvidenceFiles.length>20&&(e.auditEvidenceFiles="Too many audit evidence files (maximum 20)"),this.fieldErrors={},this.auditDetails&&this.auditDetails.compliances&&this.auditDetails.compliances.forEach((e,a)=>{e.severity_rating&&""!==e.severity_rating&&this.validateComplianceField("severity_rating",e.severity_rating,a),e.status&&this.validateComplianceField("status",e.status,a),e.major_minor&&this.validateComplianceField("major_minor",e.major_minor,a)});let a=!1;for(const t in this.fieldErrors)if(Object.keys(this.fieldErrors[t]).length>0){a=!0;break}return console.log("Basic validation errors:",e),console.log("Has field errors:",a),0===Object.keys(e).length&&!a},getFieldError(e,a=null){return null!==a&&this.fieldErrors[a]?this.fieldErrors[a][e]:this.validationErrors[e]}},mounted(){this.fetchAuditDetails()}};const u_=(0,se.A)(d_,[["render",c_],["__scopeId","data-v-a2598020"]]);var p_=u_;const v_={class:"audit_task-view"},m_={key:0,class:"audit_error-message"},k_={key:1,class:"audit_loading"},h_={key:2,class:"audit_content"},g_={class:"audit_audit-details"},y_={class:"audit_details-container"},f_={class:"audit_detail-item"},b_={class:"audit_detail-item"},C_={class:"audit_detail-item"},L_={class:"audit_detail-item"},w_={class:"audit_hierarchy-details"},E_={class:"audit_hierarchy-item"},R_={class:"audit_hierarchy-item"},D_={class:"audit_hierarchy-item"},I_={class:"audit_compliance-section"},P_={class:"audit_compliance-tabs"},__=["onClick"],S_={key:0,class:"audit_compliance-details"},A_={class:"audit_compliance-header"},T_={class:"audit_compliance-row"},x_={class:"audit_form-group"},F_={class:"audit_form-group"},V_={class:"audit_form-group"},M_={class:"audit_compliance-row"},X_={class:"audit_form-group"},U_={class:"audit_form-group"},N_={class:"audit_form-group"},$_={class:"audit_compliance-row"},O_={class:"audit_form-group"},j_={class:"audit_form-group"},B_={class:"audit_form-group"},W_={class:"audit_compliance-row"},Q_={class:"audit_form-group"},q_=["value"],K_={class:"audit_form-group"},J_={key:0,class:"audit_corrective-actions-container"},z_={class:"audit_risk-header"},H_={class:"audit_mitigation-actions"},Y_={class:"audit_mitigation-checkbox"},G_=["value"],Z_={class:"audit_mitigation-text"},eS={key:1,class:"audit_no-actions"},aS={class:"audit_compliance-row"},tS={class:"audit_form-group"},iS={class:"audit_form-group audit_small-input"},sS={class:"audit_form-group"},oS={class:"audit_compliance-row"},lS={class:"audit_form-group audit_checkbox-group"},nS={key:0,class:"audit_form-group"},rS={class:"audit_form-group"},cS={class:"audit_compliance-row audit_review-section"},dS={class:"audit_form-group"},uS={class:"audit_form-group"},pS={class:"audit_evidence-footer"},vS={class:"audit_form-group"},mS={key:0,class:"audit_uploaded-files"},kS={class:"audit_file-name"},hS={key:0,class:"audit_version-badge-small"},gS=["href"],yS={key:1,class:"audit_no-evidence"},fS={class:"audit_audit-evidence-section"},bS={key:0,class:"audit_uploaded-files"},CS={class:"audit_file-name"},LS={key:0,class:"audit_version-badge-small"},wS=["href"],ES={key:1,class:"audit_no-evidence"},RS={class:"audit_overall-comments-section"},DS={class:"audit_form-group"},IS={class:"audit_overall-review-comments-section"},PS={key:0,class:"audit_version-info"},_S={class:"audit_version-badge"},SS={class:"audit_version-number"},AS={class:"audit_version-type"},TS={key:0,class:"audit_last-saved"},xS={class:"audit_saved-time"},FS={class:"audit_floating-save-container"},VS=["disabled"],MS={class:"audit_save-text"},XS={class:"audit_modal-header"},US={class:"audit_modal-footer"},NS={class:"audit_modal-header"},$S={class:"audit_modal-footer"};function OS(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",v_,[(0,s.Lk)("button",{class:"audit_back-button",onClick:a[0]||(a[0]=a=>e.$router.back())},"Go back"),l.error?((0,s.uX)(),(0,s.CE)("div",m_,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>n.retryFetch&&n.retryFetch(...e)),class:"audit_retry-button"},"Retry")])):l.loading?((0,s.uX)(),(0,s.CE)("div",k_," Loading audit details... ")):l.auditDetails?((0,s.uX)(),(0,s.CE)("div",h_,[(0,s.Lk)("div",g_,[a[67]||(a[67]=(0,s.Lk)("h1",null,"Audit Review",-1)),(0,s.Lk)("div",y_,[(0,s.Lk)("div",f_,[a[34]||(a[34]=(0,s.Lk)("h3",null,"Title",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.title),1)]),(0,s.Lk)("div",b_,[a[35]||(a[35]=(0,s.Lk)("h3",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.scope),1)]),(0,s.Lk)("div",C_,[a[36]||(a[36]=(0,s.Lk)("h3",null,"Objective",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.objective),1)]),(0,s.Lk)("div",L_,[a[37]||(a[37]=(0,s.Lk)("h3",null,"Business Unit",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.business_unit),1)])]),(0,s.Lk)("div",w_,[(0,s.Lk)("div",E_,[a[38]||(a[38]=(0,s.Lk)("h3",null,"Framework",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.framework_name),1)]),a[41]||(a[41]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"â†’",-1)),(0,s.Lk)("div",R_,[a[39]||(a[39]=(0,s.Lk)("h3",null,"Policy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.policy_name),1)]),a[42]||(a[42]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"â†’",-1)),(0,s.Lk)("div",D_,[a[40]||(a[40]=(0,s.Lk)("h3",null,"Subpolicy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.subpolicy_name),1)])]),(0,s.Lk)("div",I_,[a[66]||(a[66]=(0,s.Lk)("div",{class:"audit_compliance-header-row"},[(0,s.Lk)("h2",null,"Compliance Items")],-1)),(0,s.Lk)("div",P_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditDetails.compliances,(e,a)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["audit_tab-button",{active:l.selectedComplianceIndex===a}]),onClick:t=>n.selectCompliance(e,a)}," Compliance "+(0,d.v_)(a+1),11,__))),128))]),l.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",S_,[(0,s.Lk)("div",A_,[(0,s.Lk)("h3",null,(0,d.v_)(l.selectedCompliance.description),1)]),(0,s.Lk)("div",T_,[(0,s.Lk)("div",x_,[a[44]||(a[44]=(0,s.Lk)("label",null,"Compliance Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedCompliance.status=e),disabled:"",class:"audit_form-control"},a[43]||(a[43]=[(0,s.Lk)("option",{value:"2"},"Fully Compliant",-1),(0,s.Lk)("option",{value:"1"},"Partially Compliant",-1),(0,s.Lk)("option",{value:"0"},"Not Compliant",-1),(0,s.Lk)("option",{value:"3"},"Not Applicable",-1)]),512),[[i.u1,l.selectedCompliance.status]])]),(0,s.Lk)("div",F_,[a[46]||(a[46]=(0,s.Lk)("label",null,"Type of Findings",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[3]||(a[3]=e=>l.selectedCompliance.major_minor=e),disabled:"",class:"audit_form-control"},a[45]||(a[45]=[(0,s.Lk)("option",{value:""},"Select Type",-1),(0,s.Lk)("option",{value:"0"},"Minor",-1),(0,s.Lk)("option",{value:"1"},"Major",-1)]),512),[[i.u1,l.selectedCompliance.major_minor]])]),(0,s.Lk)("div",V_,[a[47]||(a[47]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=e=>l.selectedCompliance.severity_rating=e),disabled:"",min:"1",max:"10",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.severity_rating]])])]),(0,s.Lk)("div",M_,[(0,s.Lk)("div",X_,[a[48]||(a[48]=(0,s.Lk)("label",null,"What to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[5]||(a[5]=e=>l.selectedCompliance.what_to_verify=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.what_to_verify]])]),(0,s.Lk)("div",U_,[a[49]||(a[49]=(0,s.Lk)("label",null,"How to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[6]||(a[6]=e=>l.selectedCompliance.how_to_verify=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.how_to_verify]])]),(0,s.Lk)("div",N_,[a[50]||(a[50]=(0,s.Lk)("label",null,"Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>l.selectedCompliance.impact=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.impact]])])]),(0,s.Lk)("div",$_,[(0,s.Lk)("div",O_,[a[51]||(a[51]=(0,s.Lk)("label",null,"Why to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[8]||(a[8]=e=>l.selectedCompliance.why_to_verify=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.why_to_verify]])]),(0,s.Lk)("div",j_,[a[52]||(a[52]=(0,s.Lk)("label",null,"Details of Findings",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[9]||(a[9]=e=>l.selectedCompliance.details_of_finding=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.details_of_finding]])]),(0,s.Lk)("div",B_,[a[53]||(a[53]=(0,s.Lk)("label",null,"Underlying Cause",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[10]||(a[10]=e=>l.selectedCompliance.underlying_cause=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.underlying_cause]])])]),(0,s.Lk)("div",W_,[(0,s.Lk)("div",Q_,[a[54]||(a[54]=(0,s.Lk)("label",null,"Predictive Risks",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[11]||(a[11]=e=>l.selectedCompliance.selected_risks=e),class:"audit_form-control",multiple:"",disabled:""},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedCompliance.risks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e},(0,d.v_)(e.title)+" ("+(0,d.v_)(e.category)+") ",9,q_))),128))],512),[[i.u1,l.selectedCompliance.selected_risks]])]),(0,s.Lk)("div",K_,[a[55]||(a[55]=(0,s.Lk)("label",null,"Corrective Actions",-1)),l.selectedCompliance.selected_risks&&l.selectedCompliance.selected_risks.length>0?((0,s.uX)(),(0,s.CE)("div",J_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedCompliance.selected_risks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"audit_risk-mitigation"},[(0,s.Lk)("div",z_,[(0,s.Lk)("strong",null,(0,d.v_)(e.title),1)]),(0,s.Lk)("div",H_,[(0,s.Lk)("label",Y_,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[12]||(a[12]=e=>l.selectedCompliance.selected_mitigations=e),value:{risk_id:e.id,mitigation:e.mitigation},disabled:""},null,8,G_),[[i.lH,l.selectedCompliance.selected_mitigations]]),(0,s.Lk)("span",Z_,(0,d.v_)(e.mitigation),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",eS," No risks selected "))])]),(0,s.Lk)("div",aS,[(0,s.Lk)("div",tS,[a[56]||(a[56]=(0,s.Lk)("label",null,"Suggested Action Plan",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[13]||(a[13]=e=>l.selectedCompliance.suggested_action_plan=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.suggested_action_plan]])]),(0,s.Lk)("div",iS,[a[57]||(a[57]=(0,s.Lk)("label",null,"Responsible for Plan",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=e=>l.selectedCompliance.responsible_for_plan=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.responsible_for_plan]])]),(0,s.Lk)("div",sS,[a[58]||(a[58]=(0,s.Lk)("label",null,"Mitigation Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[15]||(a[15]=e=>l.selectedCompliance.mitigation_date=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.mitigation_date]])])]),(0,s.Lk)("div",oS,[(0,s.Lk)("div",lS,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[16]||(a[16]=e=>l.selectedCompliance.re_audit=e),disabled:""},null,512),[[i.lH,l.selectedCompliance.re_audit]]),a[59]||(a[59]=(0,s.eW)(" Re-audit Required "))])]),l.selectedCompliance.re_audit?((0,s.uX)(),(0,s.CE)("div",nS,[a[60]||(a[60]=(0,s.Lk)("label",null,"Re-audit Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[17]||(a[17]=e=>l.selectedCompliance.re_audit_date=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.re_audit_date]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",rS,[a[61]||(a[61]=(0,s.Lk)("label",null,"Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[18]||(a[18]=e=>l.selectedCompliance.comments=e),disabled:"",class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.comments]])])]),(0,s.Lk)("div",cS,[(0,s.Lk)("div",dS,[a[63]||(a[63]=(0,s.Lk)("label",null,"Review Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[19]||(a[19]=e=>l.selectedCompliance.review_status=e),class:"audit_form-control"},a[62]||(a[62]=[(0,s.Lk)("option",{value:"in_review"},"In Review",-1),(0,s.Lk)("option",{value:"accept"},"Accept",-1),(0,s.Lk)("option",{value:"reject"},"Reject",-1)]),512),[[i.u1,l.selectedCompliance.review_status]])]),(0,s.Lk)("div",uS,[a[64]||(a[64]=(0,s.Lk)("label",null,"Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[20]||(a[20]=e=>l.selectedCompliance.review_comments=e),class:"audit_form-control"},null,512),[[i.Jo,l.selectedCompliance.review_comments]])])]),(0,s.Lk)("div",pS,[(0,s.Lk)("div",vS,[a[65]||(a[65]=(0,s.Lk)("label",null,"Compliance Evidence",-1)),l.selectedCompliance.evidence_files&&l.selectedCompliance.evidence_files.length>0?((0,s.uX)(),(0,s.CE)("div",mS,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedCompliance.evidence_files,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["audit_file-item",{"audit_from-version":e.fromVersion}])},[(0,s.Lk)("span",kS,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",hS,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"ðŸ‘ï¸",8,gS)):(0,s.Q3)("",!0)],2))),128))])):((0,s.uX)(),(0,s.CE)("div",yS," No evidence files uploaded "))])])])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",fS,[a[68]||(a[68]=(0,s.Lk)("h3",null,"Audit Evidence",-1)),l.auditEvidenceFiles&&l.auditEvidenceFiles.length>0?((0,s.uX)(),(0,s.CE)("div",bS,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditEvidenceFiles,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["audit_file-item",{"audit_from-version":e.fromVersion}])},[(0,s.Lk)("span",CS,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",LS,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"ðŸ‘ï¸",8,wS)):(0,s.Q3)("",!0)],2))),128))])):((0,s.uX)(),(0,s.CE)("div",ES," No audit evidence files uploaded "))]),(0,s.Lk)("div",RS,[a[69]||(a[69]=(0,s.Lk)("h3",null,"Overall Audit Comments",-1)),(0,s.Lk)("div",DS,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[21]||(a[21]=e=>l.overallAuditComments=e),disabled:"",class:"audit_form-control audit_overall-comments-textarea",placeholder:"No overall audit comments available",rows:"4"},null,512),[[i.Jo,l.overallAuditComments]])])]),(0,s.Lk)("div",IS,[a[70]||(a[70]=(0,s.Lk)("h3",null,"Overall Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[22]||(a[22]=e=>l.overallReviewComments=e),class:"audit_form-control",placeholder:"Enter overall review comments...",rows:"4"},null,512),[[i.Jo,l.overallReviewComments]])]),l.currentVersion?((0,s.uX)(),(0,s.CE)("div",PS,[(0,s.Lk)("div",_S,[a[71]||(a[71]=(0,s.Lk)("span",{class:"audit_version-label"},"Current Version:",-1)),(0,s.Lk)("span",SS,(0,d.v_)(l.currentVersion),1),(0,s.Lk)("span",AS,(0,d.v_)(n.getVersionType(l.currentVersion)),1)]),l.lastSavedTime?((0,s.uX)(),(0,s.CE)("div",TS,[a[72]||(a[72]=(0,s.Lk)("span",{class:"audit_saved-label"},"Last Saved:",-1)),(0,s.Lk)("span",xS,(0,d.v_)(n.formatDateTime(l.lastSavedTime)),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",FS,[(0,s.Lk)("button",{onClick:a[23]||(a[23]=(...e)=>n.saveReview&&n.saveReview(...e)),class:"audit_floating-save-button",disabled:l.isSavingReview},[(0,s.Lk)("span",MS,(0,d.v_)(l.isSavingReview?"Saving Review...":"Save Review"),1)],8,VS)])])):(0,s.Q3)("",!0),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"audit_modal-overlay",onClick:a[28]||(a[28]=(...e)=>n.keepEditing&&n.keepEditing(...e))},[(0,s.Lk)("div",{class:"audit_modal-content",onClick:a[27]||(a[27]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",XS,[a[73]||(a[73]=(0,s.Lk)("h3",null,"Confirm Rejection",-1)),(0,s.Lk)("button",{onClick:a[24]||(a[24]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_close-button"},"Ã—")]),a[74]||(a[74]=(0,s.Lk)("div",{class:"audit_modal-body"},[(0,s.Lk)("div",{class:"audit_warning-message"},[(0,s.Lk)("h4",null,"Review Rejection Detected"),(0,s.Lk)("p",null,"You have rejected one or more compliance items. This will send the audit back for revision."),(0,s.Lk)("p",{class:"audit_status-note"},[(0,s.Lk)("em",null,'This will change the audit status from "Under Review" to "Needs Revision"')])])],-1)),(0,s.Lk)("div",US,[(0,s.Lk)("button",{onClick:a[25]||(a[25]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_btn-secondary"},"Keep Editing"),(0,s.Lk)("button",{onClick:a[26]||(a[26]=(...e)=>n.confirmReject&&n.confirmReject(...e)),class:"audit_btn-danger"}," Yes, Reject and Return ")])])])):(0,s.Q3)("",!0),l.showAcceptModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"audit_modal-overlay",onClick:a[33]||(a[33]=(...e)=>n.keepEditing&&n.keepEditing(...e))},[(0,s.Lk)("div",{class:"audit_modal-content",onClick:a[32]||(a[32]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",NS,[a[75]||(a[75]=(0,s.Lk)("h3",null,"Confirm Acceptance",-1)),(0,s.Lk)("button",{onClick:a[29]||(a[29]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_close-button"},"Ã—")]),a[76]||(a[76]=(0,s.Lk)("div",{class:"audit_modal-body"},[(0,s.Lk)("div",{class:"audit_success-message"},[(0,s.Lk)("h4",null,"All Items Accepted"),(0,s.Lk)("p",null,"You have accepted all compliance items. This will complete the audit review."),(0,s.Lk)("p",{class:"audit_status-note"},[(0,s.Lk)("em",null,'This will change the audit status to "Completed"')])])],-1)),(0,s.Lk)("div",$S,[(0,s.Lk)("button",{onClick:a[30]||(a[30]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_btn-secondary"},"Keep Editing"),(0,s.Lk)("button",{onClick:a[31]||(a[31]=(...e)=>n.confirmAccept&&n.confirmAccept(...e)),class:"audit_btn-primary"}," Yes, Complete Review ")])])])):(0,s.Q3)("",!0)])}var jS={name:"ReviewTaskView",data(){return{auditDetails:null,error:null,loading:!0,selectedComplianceIndex:null,auditEvidenceFiles:[],currentVersion:null,lastSavedTime:null,isSavingReview:!1,selectedCompliance:null,hasUnsavedChanges:!1,overallAuditComments:"",overallReviewComments:"",savedVersionData:null,showRejectModal:!1,showAcceptModal:!1}},methods:{formatDateTime(e){return e?new Date(e).toLocaleString():""},getVersionType(e){return e?e.startsWith("A")?"Auditor Version":e.startsWith("R")?"Reviewer Version":"Unknown Version":""},async fetchAuditDetails(){this.loading=!0,this.error=null;try{const e=this.$route.params.auditId;if(!e)return void(this.error="No audit ID provided");console.log("Fetching details for audit:",e);const a=await JD.FH.getAuditTaskDetails(e);if(this.auditDetails=a.data,this.auditDetails.compliances.forEach(e=>{if(e.review_status||(e.review_status="in_review"),e.review_comments||(e.review_comments=""),e.evidence_files=[],e.evidence){const a=e.evidence.split(",").filter(e=>e.trim());e.evidence_files=a.map(e=>({name:this.extractFilenameFromUrl(e)||"Evidence File",url:e.trim(),fromVersion:this.auditDetails.loaded_from_version||!1}))}}),this.auditEvidenceFiles=[],this.auditDetails.evidence_urls){const e=this.auditDetails.evidence_urls.split(",").filter(e=>e.trim());this.auditEvidenceFiles=e.map(e=>({name:this.extractFilenameFromUrl(e)||"Audit Evidence File",url:e.trim(),fromVersion:this.auditDetails.loaded_from_version||!1}))}this.auditDetails.current_version&&(this.currentVersion=this.auditDetails.current_version,this.lastSavedTime=this.auditDetails.version_date),this.overallAuditComments=this.auditDetails.overall_audit_comments||"",this.overallReviewComments=this.auditDetails.overall_review_comments||"",this.auditDetails.compliances?.length>0&&this.selectCompliance(this.auditDetails.compliances[0],0)}catch(e){console.error("Error fetching audit details:",e),this.error=e.response?.data?.error||"Failed to load audit details"}finally{this.loading=!1}},extractFilenameFromUrl(e){if(!e)return null;try{const a=e.split("/");return decodeURIComponent(a[a.length-1])}catch(a){return console.warn("Error extracting filename from URL:",a),null}},selectCompliance(e,a){this.selectedCompliance=e,this.selectedComplianceIndex=a},async saveReview(){if(!this.isSavingReview)try{this.isSavingReview=!0;const e=this.$route.params.auditId,a=this.auditDetails.compliances,t=a.filter(e=>!e.review_status||"in_review"===e.review_status),i=a.map(e=>({compliance_id:e.id,review_status:e.review_status||"in_review",review_comments:e.review_comments||""})),s={compliance_reviews:i,review_comments:this.overallReviewComments||"",overall_audit_comments:this.overallAuditComments||"",save_only:!0};if(0===t.length){const e=a.some(e=>"reject"===e.review_status),t=a.every(e=>"accept"===e.review_status);if(e)return this.showRejectModal=!0,void(this.savedVersionData=s);if(t)return this.showAcceptModal=!0,void(this.savedVersionData=s)}const o=await JD.FH.saveReviewProgress(e,s);if(!o.data.message)throw new Error("Failed to save review version");this.currentVersion=o.data.review_version,this.lastSavedTime=(new Date).toISOString(),this.hasUnsavedChanges=!1,t.length>0?this.$toast?.info(`Saved progress. ${t.length} compliance(s) still need review.`):this.$toast?.success(`Review version ${this.currentVersion} saved successfully`)}catch(e){console.error("Error in saveReview:",e),this.$toast?.error("Failed to save review: "+(e.response?.data?.error||e.message))}finally{this.isSavingReview=!1}},async confirmReject(){try{if(this.savedVersionData){const e=this.$route.params.auditId,a=await JD.FH.saveReviewProgress(e,{compliance_reviews:this.savedVersionData.compliance_reviews,review_comments:this.overallReviewComments,overall_audit_comments:this.overallAuditComments,save_only:!1,is_rejected:!0});if(!a.data.message)throw new Error("Failed to save review version");await JD.FH.updateReviewStatus(e,{review_status:"Reject",status:"Work In Progress",review_comments:this.overallReviewComments,overall_audit_comments:this.overallAuditComments,compliance_reviews:this.savedVersionData.compliance_reviews}),this.$toast?.success("Audit has been rejected and returned for revision"),this.showRejectModal=!1,this.$router.push("/reviewer")}}catch(e){console.error("Error confirming rejection:",e),this.$toast?.error("Failed to process rejection: "+(e.response?.data?.error||e.message))}},async confirmAccept(){try{if(this.savedVersionData){const e=this.$route.params.auditId,a=this.auditDetails.compliances.map(e=>({compliance_id:e.id,review_status:e.review_status||"accept",review_comments:e.review_comments||"",evidence:e.evidence||"",how_to_verify:e.how_to_verify||"",impact:e.impact||"",details_of_finding:e.details_of_finding||"",comments:e.comments||"",major_minor:e.major_minor||"",severity_rating:e.severity_rating||0,predictive_risks:e.selected_risks||[],corrective_actions:e.selected_mitigations||[],underlying_cause:e.underlying_cause||"",why_to_verify:e.why_to_verify||"",what_to_verify:e.what_to_verify||"",suggested_action_plan:e.suggested_action_plan||"",mitigation_date:e.mitigation_date||null,responsible_for_plan:e.responsible_for_plan||"",re_audit:e.re_audit?1:0,re_audit_date:e.re_audit_date||null,compliance_status:e.status})),t=await JD.FH.saveReviewProgress(e,{...this.savedVersionData,compliance_data:a,overall_audit_comments:this.overallAuditComments,save_only:!1});if(!t.data.message)throw new Error("Failed to save review version");await JD.FH.updateReviewStatus(e,{status:"accept",review_comments:this.overallReviewComments,overall_audit_comments:this.overallAuditComments,compliance_reviews:a}),this.showAcceptModal=!1,this.$router.push("/reviewer")}}catch(e){console.error("Error confirming acceptance:",e),this.$toast?.error("Failed to process acceptance: "+(e.response?.data?.error||e.message))}},keepEditing(){if(this.showRejectModal=!1,this.showAcceptModal=!1,this.savedVersionData){const e=this.$route.params.auditId;JD.FH.saveReviewProgress(e,{...this.savedVersionData,overall_audit_comments:this.overallAuditComments,review_comments:this.overallReviewComments,save_only:!0,is_rejected:!1}).then(e=>{e.data.message&&(this.currentVersion=e.data.review_version,this.lastSavedTime=(new Date).toISOString(),this.$toast?.success(`Review version ${this.currentVersion} saved successfully`))}).catch(e=>{console.error("Error saving review:",e),this.$toast?.error("Failed to save review: "+(e.response?.data?.error||e.message))})}this.savedVersionData=null},retryFetch(){this.fetchAuditDetails()}},mounted(){this.fetchAuditDetails()}};const BS=(0,se.A)(jS,[["render",OS],["__scopeId","data-v-44ee7ebe"]]);var WS=BS;const QS={class:"review-confirmation"},qS={class:"confirmation-card"},KS={class:"confirmation-header"},JS={key:0,class:"confirmation-title accept-title"},zS={key:1,class:"confirmation-title reject-title"},HS={key:2,class:"confirmation-title"},YS={class:"confirmation-body"},GS={class:"confirmation-message"},ZS={key:0},eA={key:1},aA={key:2},tA={class:"confirmation-details"},iA={class:"detail-row"},sA={class:"detail-value"},oA={class:"detail-row"},lA={class:"detail-value"},nA={class:"detail-row"},rA={class:"detail-row"},cA={class:"detail-value"},dA={class:"detail-row"},uA={class:"detail-value"},pA={key:0,class:"review-comments-section"},vA={class:"review-comments"},mA={class:"confirmation-actions"};function kA(e,a,t,i,o,l){return(0,s.uX)(),(0,s.CE)("div",QS,[(0,s.Lk)("div",qS,[(0,s.Lk)("div",KS,["Accept"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("h1",JS,a[1]||(a[1]=[(0,s.Lk)("span",{class:"confirmation-icon"},"âœ“",-1),(0,s.eW)(" Review Approved ")]))):"Reject"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("h1",zS,a[2]||(a[2]=[(0,s.Lk)("span",{class:"confirmation-icon"},"âœ—",-1),(0,s.eW)(" Review Rejected ")]))):((0,s.uX)(),(0,s.CE)("h1",HS,a[3]||(a[3]=[(0,s.Lk)("span",{class:"confirmation-icon"},"â“˜",-1),(0,s.eW)(" Review Submitted ")])))]),(0,s.Lk)("div",YS,[(0,s.Lk)("div",GS,["Accept"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("p",ZS," You have approved the audit. The audit has been marked as completed. ")):"Reject"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("p",eA," You have rejected the audit. The audit has been sent back to the auditor for revisions. ")):((0,s.uX)(),(0,s.CE)("p",aA," Your review has been saved successfully. "))]),(0,s.Lk)("div",tA,[(0,s.Lk)("div",iA,[a[4]||(a[4]=(0,s.Lk)("span",{class:"detail-label"},"Audit ID:",-1)),(0,s.Lk)("span",sA,(0,d.v_)(o.reviewData.auditId),1)]),(0,s.Lk)("div",oA,[a[5]||(a[5]=(0,s.Lk)("span",{class:"detail-label"},"Framework:",-1)),(0,s.Lk)("span",lA,(0,d.v_)(o.reviewData.frameworkName),1)]),(0,s.Lk)("div",nA,[a[6]||(a[6]=(0,s.Lk)("span",{class:"detail-label"},"Review Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["detail-value",l.getStatusClass(o.reviewData.reviewStatus)])},(0,d.v_)(o.reviewData.reviewStatus),3)]),(0,s.Lk)("div",rA,[a[7]||(a[7]=(0,s.Lk)("span",{class:"detail-label"},"Audit Status:",-1)),(0,s.Lk)("span",cA,(0,d.v_)(o.reviewData.auditStatus),1)]),(0,s.Lk)("div",dA,[a[8]||(a[8]=(0,s.Lk)("span",{class:"detail-label"},"Submitted:",-1)),(0,s.Lk)("span",uA,(0,d.v_)(l.formatDate(o.reviewData.timestamp)),1)]),o.reviewData.reviewComments?((0,s.uX)(),(0,s.CE)("div",pA,[a[9]||(a[9]=(0,s.Lk)("h3",null,"Review Comments:",-1)),(0,s.Lk)("div",vA,(0,d.v_)(o.reviewData.reviewComments),1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",mA,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>l.goToReviews&&l.goToReviews(...e)),class:"btn-back"}," Back to Reviews ")])])])}var hA={name:"ReviewConfirmation",props:{auditId:{type:[String,Number],required:!0}},data(){return{reviewData:{auditId:this.auditId,frameworkName:"",reviewStatus:"",reviewComments:"",auditStatus:"",timestamp:(new Date).toISOString()}}},created(){this.loadReviewData()},methods:{loadReviewData(){try{const e=localStorage.getItem("reviewSubmissionResult");if(e){const a=JSON.parse(e);a.auditId==this.auditId?this.reviewData=a:console.warn("Stored review data is for a different audit")}else console.warn("No review data found in localStorage")}catch(e){console.error("Error loading review data:",e)}},formatDate(e){try{const a=new Date(e);return a.toLocaleString()}catch(a){return"Unknown date"}},getStatusClass(e){return"Accept"===e?"status-accept":"Reject"===e?"status-reject":""},goToReviews(){localStorage.removeItem("reviewSubmissionResult"),this.$router.push("/auditor/reviewer")}}};const gA=(0,se.A)(hA,[["render",kA],["__scopeId","data-v-8af88906"]]);var yA=gA;const fA={class:"audit-report-container"},bA={key:0,class:"loading-message"},CA={key:1,class:"error-message"},LA=["onClick"],wA={class:"popup-header"},EA={class:"popup-body"},RA={key:0,class:"loading-message"},DA={key:1,class:"error-message"},IA={key:2,class:"no-data-message"},PA={key:3,class:"versions-table-wrapper"},_A={class:"version-actions"},SA=["onClick"],AA=["onClick"],TA={key:0,class:"fas fa-spinner fa-spin",title:"Downloading..."},xA=["onClick"],FA={key:1,class:"disabled-icon",title:"Download not available for rejected reports"};function VA(e,a,t,o,l,n){const r=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",fA,[a[5]||(a[5]=(0,s.Lk)("h1",{class:"audit-report-title"},"Audit Report",-1)),o.loading?((0,s.uX)(),(0,s.CE)("div",bA,"Loading audit reports...")):o.error?((0,s.uX)(),(0,s.CE)("div",CA,(0,d.v_)(o.error),1)):((0,s.uX)(),(0,s.Wv)(r,{key:2,title:"Audit Reports",data:o.audits,columns:o.tableColumns,"unique-key":"AuditId","show-pagination":!0,"default-page-size":10,"page-size-options":[5,10,20,50],onRowClick:o.handleRowClick},{"cell-AuditId":(0,s.k6)(({row:e,value:a})=>[(0,s.Lk)("button",{class:"audit-id-btn",onClick:a=>o.fetchAuditVersions(e.AuditId)},(0,d.v_)(a),9,LA)]),_:1},8,["data","columns","onRowClick"])),o.showVersionsPopup?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"popup-overlay",onClick:a[2]||(a[2]=(...e)=>o.closeVersionsPopup&&o.closeVersionsPopup(...e))},[(0,s.Lk)("div",{class:"popup-content",onClick:a[1]||(a[1]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"close-btn",onClick:a[0]||(a[0]=(...e)=>o.closeVersionsPopup&&o.closeVersionsPopup(...e))},a[3]||(a[3]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)])),(0,s.Lk)("div",wA,[(0,s.Lk)("h3",null,"Audit Versions - Audit ID: "+(0,d.v_)(o.selectedAuditId),1)]),(0,s.Lk)("div",EA,[o.loadingVersions?((0,s.uX)(),(0,s.CE)("div",RA,"Loading versions...")):o.versionError?((0,s.uX)(),(0,s.CE)("div",DA,(0,d.v_)(o.versionError),1)):0===o.auditVersions.length?((0,s.uX)(),(0,s.CE)("div",IA,"No approved or rejected report versions available for this audit.")):((0,s.uX)(),(0,s.CE)("div",PA,[(0,s.bF)(r,{title:"Audit Versions",data:o.auditVersions,columns:o.versionTableColumns,"unique-key":"Version","show-pagination":!1,onRowClick:o.handleVersionRowClick},{"cell-actions":(0,s.k6)(({row:e})=>[(0,s.Lk)("div",_A,[(0,s.Lk)("i",{class:"fas fa-eye action-icon",onClick:a=>o.viewReport(o.selectedAuditId,e.Version),title:"View"},null,8,SA),(0,s.Lk)("i",{class:"fas fa-trash action-icon",onClick:a=>o.confirmDelete(o.selectedAuditId,e.Version),title:"Delete"},null,8,AA),o.isRejected(e)?((0,s.uX)(),(0,s.CE)("span",FA,a[4]||(a[4]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1)]))):((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[o.downloadingVersion===e.Version?((0,s.uX)(),(0,s.CE)("i",TA)):((0,s.uX)(),(0,s.CE)("i",{key:1,class:"fas fa-download action-icon",onClick:a=>o.downloadReport(o.selectedAuditId,e.Version),title:"Download"},null,8,xA))],64))])]),_:1},8,["data","columns","onRowClick"])]))])])])):(0,s.Q3)("",!0)])}var MA={name:"AuditReport",components:{DynamicTable:Ll.A},setup(){const e=(0,ee.KR)([]),a=(0,ee.KR)([]),t=(0,ee.KR)(!1),i=(0,ee.KR)(null),o=(0,ee.KR)(!0),l=(0,ee.KR)(!1),n=(0,ee.KR)(null),r=(0,ee.KR)(null),c=(0,ee.KR)(null),d=(0,ee.KR)(null),u=(0,ae.rd)(),p={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:8000/api",v=(0,s.EW)(()=>[{key:"AuditId",label:"Audit ID",sortable:!0,cellClass:"audit-id-cell",slot:!0},{key:"Framework",label:"Framework",sortable:!0},{key:"Policy",label:"Policy",sortable:!0},{key:"SubPolicy",label:"Sub Policy",sortable:!0},{key:"Assigned",label:"Assigned",sortable:!0},{key:"Auditor",label:"Auditor",sortable:!0},{key:"Reviewer",label:"Reviewer",sortable:!0},{key:"CompletionDate",label:"Completed Date",sortable:!0}]),m=(0,s.EW)(()=>[{key:"Version",label:"Version NO",sortable:!0},{key:"Date",label:"Date",sortable:!0},{key:"ReportStatus",label:"Report Status",sortable:!0,type:"status",cellClass:"status-cell"},{key:"actions",label:"Actions",type:"actions",cellClass:"actions-cell",slot:!0}]),k=async()=>{o.value=!0,n.value=null;try{const a=await qe.A.get(`${p}/audit-reports/`);e.value=a.data.audits}catch(a){console.error("Error fetching audit reports:",a),n.value="Failed to load audit reports. Please try again later."}finally{o.value=!1}},h=e=>{y(e.AuditId)},g=e=>{console.log("Version row clicked:",e)},y=async e=>{i.value=e,t.value=!0,l.value=!0,r.value=null,a.value=[];try{const t=await qe.A.get(`${p}/audit-reports/${e}/versions/`);a.value=t.data.versions,console.log("Audit versions received:",a.value),a.value.forEach(e=>{console.log(`Version ${e.Version} - ApprovedRejected: ${e.ApprovedRejected}, ReportStatus: ${e.ReportStatus}`)}),a.value=a.value.filter(e=>null!==e.ApprovedRejected&&""!==e.ApprovedRejected),a.value.forEach(a=>{28===Number(e)&&"R1"===a.Version&&(a.ApprovedRejected="1",a.ReportStatus="Approved",console.log(`Fixed status for Audit ${e}, Version ${a.Version}: ApprovedRejected=${a.ApprovedRejected}, ReportStatus=${a.ReportStatus}`)),"1"===a.ApprovedRejected||1===a.ApprovedRejected?a.ReportStatus="Approved":"2"!==a.ApprovedRejected&&2!==a.ApprovedRejected||(a.ReportStatus="Rejected")})}catch(s){console.error(`Error fetching versions for audit ${e}:`,s),r.value="Failed to load audit versions. Please try again later."}finally{l.value=!1}},f=()=>{t.value=!1,i.value=null,a.value=[]},b=async(e,a)=>{const t=await u.app.config.globalProperties.$popup.confirm(`Are you sure you want to delete version ${a}? This action cannot be undone.`,"Confirm Deletion");t&&C(e,a)},C=async(e,a)=>{try{d.value=a,console.log(`Deleting version ${a} for audit ${e}`);const t=await qe.A.post(`${p}/audit-reports/${e}/versions/${a}/delete/`);console.log("Delete response:",t.data),t.data.success?(y(e),u.app.config.globalProperties.$popup.success(`Successfully deleted version ${a}`)):u.app.config.globalProperties.$popup.error(`Error: ${t.data.error||"Failed to delete version"}`)}catch(t){console.error(`Error deleting version ${a} for audit ${e}:`,t),u.app.config.globalProperties.$popup.error(`Error: ${t.response?.data?.error||"Failed to delete version"}`)}finally{d.value=null}},L=(e,a)=>{console.log(`Viewing report for audit ${e}, version ${a}`),localStorage.setItem("current_audit_id",e),localStorage.setItem("current_version_id",a),f(),u.push(`/audit/${e}/tasks?version=${a}&from=reports`)},w=e=>{const a=String(e.ApprovedRejected||"");return"2"===a},E=async(e,a)=>{try{c.value=a;const t=await qe.A.get(`${p}/audit-reports/${e}/versions/${a}/s3-link/`);t.data&&t.data.s3_link?window.open(t.data.s3_link,"_blank"):(console.log("No S3 link available, generating new report..."),window.open(`${p}/generate-audit-report/${e}/?version=${a}`,"_blank")),setTimeout(()=>{c.value===a&&(c.value=null)},3e3)}catch(t){console.error(`Error downloading report for audit ${e}, version ${a}:`,t),t.response&&403===t.response.status?u.app.config.globalProperties.$popup.error("Cannot download rejected reports."):u.app.config.globalProperties.$popup.error(`Error downloading report: ${t.response?.data?.error||"Unknown error"}`),c.value=null}},R=e=>{const a=String(e||"");return"1"===a||"Approved"===a?"status-approved":"2"===a||"Rejected"===a?"status-rejected":"status-pending"},D=e=>{if(console.log(`getStatusText for ${e.Version} - ApprovedRejected: ${e.ApprovedRejected}, ReportStatus: ${e.ReportStatus}`),"Approved"===e.ReportStatus||"Rejected"===e.ReportStatus)return e.ReportStatus;const a=String(e.ApprovedRejected||"");return"1"===a?"Approved":"2"===a?"Rejected":"Unknown"};return(0,s.sV)(k),{audits:e,auditVersions:a,showVersionsPopup:t,selectedAuditId:i,loading:o,loadingVersions:l,error:n,versionError:r,downloadingVersion:c,tableColumns:v,versionTableColumns:m,fetchAuditVersions:y,closeVersionsPopup:f,viewReport:L,downloadReport:E,confirmDelete:b,getStatusClass:R,getStatusText:D,isRejected:w,handleRowClick:h,handleVersionRowClick:g}}};const XA=(0,se.A)(MA,[["render",VA],["__scopeId","data-v-fcad9ed4"]]);var UA=XA;const NA={class:"performance-analysis-container"};function $A(e,a,t,i,o,l){const n=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",NA,[(0,s.bF)(n)])}var OA={name:"PerformanceAnalysis"};const jA=(0,se.A)(OA,[["render",$A],["__scopeId","data-v-bafb8120"]]);var BA=jA;const WA={class:"kpi-container"},QA={class:"kpi-row"},qA={class:"kpi-card-wrapper",style:{flex:"1","min-width":"500px"}},KA={class:"d-flex flex-column align-center pa-4"},JA={class:"period-selector"},zA=["onClick"],HA={class:"severity-chart"},YA={class:"severity-label"},GA={class:"severity-bar-container"},ZA={class:"severity-bar-value"},eT={class:"target-info"},aT={class:"target-label"},tT={key:0,class:"target-label"},iT={class:"critical-count"},sT={class:"high-count"},oT={key:1,class:"target-label"},lT={class:"kpi-row"},nT={class:"kpi-card-wrapper"},rT={class:"d-flex flex-column align-center pa-4"},cT={class:"filter-dropdown"},dT=["value"],uT={class:"target-info"},pT={class:"target-label"},vT={key:0,class:"trend-chart-container"},mT={class:"line-chart"},kT={class:"chart-grid"},hT={class:"chart-y-axis"},gT=["title","onMouseover"],yT={class:"tooltip-month"},fT={class:"tooltip-rate"},bT={key:0,class:"tooltip-threshold"},CT={key:1,class:"tooltip-threshold good"},LT={class:"chart-labels"},wT={class:"chart-legend"},ET={class:"legend-item"},RT={class:"legend-label"},DT={class:"kpi-card-wrapper"},IT={class:"d-flex flex-column align-center pa-4"},PT={class:"period-selector"},_T=["onClick"],ST={class:"view-toggle-container mt-2"},AT={class:"flip-card-front"},TT={class:"time-to-close-container"},xT={class:"left-section",style:{width:"100%"}},FT={class:"target-info"},VT={class:"target-label"},MT={key:0,class:"close-time-chart-container"},XT={class:"line-chart close-time-chart"},UT={class:"chart-grid"},NT={class:"chart-y-axis"},$T=["title","onMouseover"],OT={class:"tooltip-month"},jT={class:"tooltip-rate"},BT={key:0,class:"tooltip-threshold"},WT={key:1,class:"tooltip-threshold good"},QT={class:"chart-labels close-time-labels"},qT={class:"flip-instruction"},KT={class:"flip-card-back"},JT={class:"time-to-close-table-container"},zT={class:"findings-table-container"},HT={class:"findings-table full-width"},YT={class:"summary-row"},GT={class:"flip-instruction"},ZT={class:"kpi-card-wrapper"},ex={class:"d-flex flex-column align-center pa-4"},ax={class:"period-selector"},tx=["onClick"],ix={class:"severity-filter"},sx=["onClick"],ox={key:0,class:"trend-indicator"},lx={class:"severity-breakdown"},nx={class:"severity-item"},rx={class:"severity-count"},cx={class:"severity-item"},dx={class:"severity-count"},ux={class:"severity-item"},px={class:"severity-count"},vx={key:0,class:"text-body-2 mt-1 text-center"},mx={key:1,class:"text-body-2 mt-1 text-center"},kx={key:2,class:"issues-monthly-chart"},hx={class:"monthly-trend-simple"},gx={class:"month-name"},yx={class:"month-count"},fx={class:"kpi-row"},bx={class:"kpi-card-wrapper"},Cx={class:"d-flex flex-column align-center pa-4"},Lx={key:0,class:"audit-selector"},wx=["value"],Ex={class:"gauge-container"},Rx={class:"target-info"},Dx={class:"target-label"},Ix={key:1,class:"evidence-audits"},Px={class:"evidence-audit-list"},_x=["onClick"],Sx={class:"evidence-audit-name"},Ax={class:"evidence-audit-framework"},Tx={class:"evidence-audit-progress"},xx={class:"progress-bar-container"},Fx={class:"progress-text"},Vx={key:2,class:"evidence-details"},Mx={class:"evidence-detail-summary"},Xx={class:"evidence-detail-count"},Ux={class:"evidence-detail-count"},Nx={class:"kpi-card-wrapper"},$x={class:"d-flex flex-column align-center pa-4"},Ox={class:"period-selector"},jx=["onClick"],Bx={class:"percentage-value"},Wx={class:"target-info"},Qx={class:"target-label"},qx={class:"text-body-2 mt-1 text-center"},Kx={key:0,class:"histogram-container"},Jx={class:"histogram-chart"},zx=["title","onMouseover"],Hx={class:"histogram-bar-label"},Yx={class:"histogram-bar-count"},Gx={class:"kpi-row"},Zx={class:"kpi-card-wrapper"},eF={class:"d-flex flex-column align-center pa-4"},aF={key:0,class:"filter-controls"},tF={class:"filter-selectors"},iF={key:0,class:"filter-dropdown"},sF=["value"],oF={key:1,class:"filter-dropdown"},lF=["value"],nF={class:"gauge-container"},rF={class:"target-info"},cF={class:"target-label"},dF={key:1,class:"filter-info"},uF={class:"filter-name"},pF={key:3,class:"criticality-breakdown"},vF={class:"criticality-bars"},mF={class:"criticality-label"},kF={class:"progress-bar-container"},hF={class:"progress-text"},gF={class:"criticality-counts"},yF={class:"kpi-card-wrapper"},fF={class:"d-flex flex-column align-center pa-4"},bF={class:"period-selector"},CF=["onClick"],LF={class:"gauge-container"},wF={class:"metrics-grid"},EF={class:"metric-item"},RF={class:"metric-value"},DF={class:"metric-item"},IF={class:"metric-value"},PF={key:0,class:"bar-chart-container"},_F={class:"bar-chart"},SF={class:"chart-y-axis"},AF={class:"bar-groups-container"},TF={class:"bar-container"},xF=["title"],FF={class:"bar-container"},VF=["title"],MF={class:"month-label"},XF={class:"evidence-modal-content"},UF={class:"evidence-filter"},NF={class:"filter-buttons"},$F={class:"evidence-list"},OF={class:"evidence-item-header"},jF={class:"evidence-item-id"},BF={key:0,class:"evidence-content"},WF={class:"evidence-text"},QF={class:"tooltip-title"},qF={class:"tooltip-count"},KF={class:"tooltip-percentage"},JF={class:"late-reports-content"},zF={class:"late-reports-list"},HF={class:"late-report-header"},YF={class:"late-report-id"},GF={class:"late-report-details"},ZF={class:"late-report-framework"},eV={class:"late-report-dates"},aV={class:"late-report-due"},tV={class:"late-report-completed"},iV={class:"frameworks-modal-content"},sV={class:"frameworks-list"},oV=["onClick"],lV={class:"framework-item-header"},nV={class:"framework-name"},rV={class:"framework-percentage"},cV={class:"framework-progress"},dV={class:"progress-bar-container"},uV={class:"framework-counts"};var pV={__name:"KpiAnalysis",setup(e){const a=(0,ee.KR)(!1),t=(0,ee.KR)(null),o=(0,ee.KR)("month"),l=(0,ee.KR)({total_audits:0,completed_audits:0,completion_percentage:0,monthly_breakdown:[]}),n=(0,ee.KR)([]),r=(0,ee.KR)(5),c=(0,s.EW)(()=>{const e=r.value,a=Math.ceil(e/4),t=[];for(let i=0;i<=e;i+=a)t.push(i);return t}),u=(0,ee.KR)(!1),p=(0,ee.KR)(null),v=(0,ee.KR)(""),m=(0,ee.KR)([]),k=(0,ee.KR)({overall_avg_days:0,target_days:30,efficiency:"N/A",monthly_breakdown:[]}),h=(0,ee.KR)([]),g=(0,ee.KR)(50),y=(0,ee.KR)(!1),f=(0,ee.KR)({}),b=(0,ee.KR)({month:"",avg_cycle_days:0}),C=(0,ee.KR)(!1),L=(0,ee.KR)(null),w=(0,ee.KR)("year"),E=(0,ee.KR)({avg_findings_per_audit:0,low_threshold:2,high_threshold:5,rating:"N/A",top_audits:[]}),R=(0,ee.KR)(!1),D=(0,ee.KR)(null),I=(0,ee.KR)("year"),P=(0,ee.KR)("number"),_=(0,ee.KR)(!1),S=(0,ee.KR)({avg_close_days:0,target_days:14,efficiency:"N/A",oldest_findings:[],monthly_trend:[],closed_count:0,total_count:0,closure_rate:0}),A=(0,ee.KR)([]),T=(0,ee.KR)(50),x=(0,ee.KR)(!1),F=(0,ee.KR)({}),V=(0,ee.KR)({month:"",avg_close_days:0}),M=(0,ee.KR)(!1),X=(0,ee.KR)(null),U=(0,ee.KR)("year"),N=(0,ee.KR)("all"),$=(0,ee.KR)({total_count:0,trend_direction:"stable",trend_percentage:0,selected_severity:"all",severity_breakdown:[],top_areas:[],monthly_trend:[]}),O=(0,ee.KR)(!1),j=(0,ee.KR)(null),B=(0,ee.KR)("year"),W=(0,ee.KR)({severity_distribution:[],total_issues:0,most_common:null,major_count:0,minor_count:0}),Q=(0,ee.KR)(!1),q=(0,ee.KR)(null),K=(0,ee.KR)({completion_percentage:0,evidence_collected:0,total_findings:0,rating:"N/A",color:"info"}),J=(0,ee.KR)([]),z=(0,ee.KR)([]),H=(0,ee.KR)(""),Y=(0,ee.KR)([]),G=(0,ee.KR)("all"),Z=(0,ee.KR)(!1),ae=(0,ee.KR)(!1),te=(0,ee.KR)(null),ie=(0,ee.KR)("year"),se=(0,ee.KR)({percent_on_time:0,on_time_count:0,total_reports:0,avg_days_difference:0}),oe=(0,ee.KR)([]),le=(0,ee.KR)([]),ne=(0,ee.KR)(!1),re=(0,ee.KR)({}),ce=(0,ee.KR)({label:"",count:0,percentage:0}),de=(0,ee.KR)(!1),ue=(0,ee.KR)(!1),pe=(0,ee.KR)(null),ve=(0,ee.KR)({total_defined:0,implemented_count:0,readiness_percentage:0,rating:"N/A",color:"info"}),me=(0,ee.KR)([]),ke=(0,ee.KR)([]),he=(0,ee.KR)([]),ge=(0,ee.KR)(""),ye=(0,ee.KR)(""),fe=(0,ee.KR)(!1),be=(0,s.EW)(()=>{const e=l.value.completion_percentage||0;return e>=80?"success":e>=50?"warning":"error"}),Ce=(0,s.EW)(()=>{const e=k.value.overall_avg_days||0,a=k.value.target_days||30;return e<=a?"efficiency-good":e<=1.5*a?"efficiency-warning":"efficiency-poor"}),Le=(0,s.EW)(()=>{const e=S.value.efficiency||"";return"Good"===e?"close-time-good":"Fair"===e?"close-time-fair":"close-time-poor"}),we=(0,s.EW)(()=>{const e=$.value.trend_direction||"stable";return"down"===e?"issues-trend-good":"up"===e?"issues-trend-bad":"issues-trend-neutral"}),Ee=(0,s.EW)(()=>{const e=$.value.trend_direction||"stable";return"down"===e?"success":"up"===e?"error":"info"}),Re=(e,a)=>e/a*100+"%",De=(0,s.EW)(()=>{const e=K.value.completion_percentage||0;return e>=80?"success":e>=50?"warning":"error"}),Ie=(0,s.EW)(()=>{const e=K.value.rating||"";return"Excellent"===e?"evidence-excellent":"Good"===e?"evidence-good":"Fair"===e?"evidence-fair":"evidence-poor"}),Pe=(0,s.EW)(()=>{const e=z.value.filter(e=>e.has_evidence).length,a=z.value.length-e;return{withEvidence:e,withoutEvidence:a}}),_e=(0,s.EW)(()=>"all"===G.value?z.value:"with"===G.value?z.value.filter(e=>e.has_evidence):z.value.filter(e=>!e.has_evidence)),Se=(0,s.EW)(()=>se.value.color||"info"),Ae=(0,s.EW)(()=>{const e=se.value.rating||"";return"Excellent"===e?"timeliness-excellent":"Good"===e?"timeliness-good":"Fair"===e?"timeliness-fair":"timeliness-poor"}),Te=(0,s.EW)(()=>{const e=g.value,a=Math.ceil(e/5),t=[];for(let i=0;i<=e;i+=a)t.push(i);return t}),xe=(0,s.EW)(()=>{const e=T.value,a=Math.ceil(e/4),t=[];for(let i=0;i<=e;i+=a)t.push(i);return t}),Fe=async()=>{a.value=!0,t.value=null;try{const e=await qe.A.get(`http://localhost:8000/api/kpi/audit-completion/?period=${o.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch audit metrics");l.value=e.data.data.metrics,n.value=e.data.data.monthly_breakdown||[],r.value=e.data.data.chart_max||5}catch(e){console.error("Error fetching audit metrics:",e),t.value="Failed to load audit metrics"}finally{a.value=!1}},Ve=async()=>{u.value=!0,p.value=null;try{let e="http://localhost:8000/api/kpi/audit-cycle-time/";v.value&&(e+=`?framework_id=${v.value}`);const a=await qe.A.get(e);if(!a.data.success||!a.data.data)throw new Error(a.data.message||"Failed to fetch cycle time metrics");if(k.value=a.data.data.metrics,m.value=a.data.data.frameworks||[],h.value=a.data.data.monthly_breakdown||[],h.value.length>0){const e=Math.max(...h.value.map(e=>e.avg_cycle_days),k.value.target_days);g.value=Math.ceil(1.2*e)}}catch(e){console.error("Error fetching cycle time metrics:",e),p.value="Failed to load cycle time data"}finally{u.value=!1}},Me=async()=>{C.value=!0,L.value=null;try{const e=await qe.A.get(`http://localhost:8000/api/kpi/finding-rate/?period=${w.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch finding rate metrics");E.value=e.data.data.metrics,E.value.top_audits=e.data.data.top_audits||[]}catch(e){console.error("Error fetching finding rate metrics:",e),L.value="Failed to load finding rate data"}finally{C.value=!1}},Xe=async()=>{R.value=!0,D.value=null;try{const[e,a]=await Promise.all([qe.A.get(`http://localhost:8000/api/kpi/time-to-close/?period=${I.value}`),qe.A.get(`http://localhost:8000/api/kpi/closure-rate/?period=${I.value}`)]);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch time to close metrics");if(S.value=e.data.data.metrics,S.value.oldest_findings=e.data.data.oldest_findings||[],A.value=e.data.data.monthly_trend||[],A.value.length>0){const e=Math.max(...A.value.map(e=>e.avg_close_days),S.value.target_days);T.value=Math.ceil(1.25*e)}if(a.data.success&&a.data.data){const e=a.data.data.metrics;S.value.closed_count=e.closed_count||0,S.value.total_count=e.opened_count||0,S.value.closure_rate=e.closure_rate||0;const t=a.data.data.monthly_trend||[];A.value.length>0&&t.length>0&&(A.value=A.value.map(e=>{const a=t.find(a=>a.month===e.month);return a?{...e,closed_count:a.closed_count||0,total_count:a.opened_count||0,closure_rate:a.rate||0}:e}))}}catch(e){console.error("Error fetching time to close metrics:",e),D.value="Failed to load time to close data"}finally{R.value=!1}},Ue=async()=>{M.value=!0,X.value=null;try{const e=await qe.A.get(`http://localhost:8000/api/kpi/non-compliance-issues/?period=${U.value}&severity=${N.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch issues metrics");$.value=e.data.data.metrics,$.value.severity_breakdown=e.data.data.severity_breakdown||[],$.value.top_areas=e.data.data.top_areas||[],$.value.monthly_trend=e.data.data.monthly_trend||[]}catch(e){console.error("Error fetching issues metrics:",e),X.value="Failed to load issues data"}finally{M.value=!1}},Ne=async()=>{O.value=!0,j.value=null;try{const e=await qe.A.get(`http://localhost:8000/api/kpi/severity-distribution/?period=${B.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch severity metrics");W.value=e.data.data.metrics,W.value.severity_distribution=e.data.data.severity_distribution||[]}catch(e){console.error("Error fetching severity metrics:",e),j.value="Failed to load severity data"}finally{O.value=!1}},$e=async()=>{Q.value=!0,q.value=null;try{let e="http://localhost:8000/api/kpi/evidence-completion/";H.value&&(e+=`?audit_id=${H.value}`);const a=await qe.A.get(e);if(!a.data.success||!a.data.data)throw new Error(a.data.message||"Failed to fetch evidence metrics");K.value=a.data.data.metrics,J.value=a.data.data.audit_breakdown||[],z.value=a.data.data.evidence_details||[],0===Y.value.length&&J.value.length>0&&(Y.value=J.value.map(e=>({id:e.audit_id,name:e.framework_name||"Unknown Framework"})))}catch(e){console.error("Error fetching evidence metrics:",e),q.value="Failed to load evidence data"}finally{Q.value=!1}},Oe=e=>e>=90?"#4CAF50":e>=70?"#3f51b5":e>=50?"#FF9800":"#f44336",je=async e=>{o.value=e,await Fe()},Be=async()=>{await Ve()},We=async e=>{I.value=e,await Xe()},Qe=()=>{_.value=!_.value},Ke=async e=>{U.value=e,await Ue()},Je=async e=>{N.value=e,await Ue()},ze=async e=>{B.value=e,await Ne()},He=async()=>{await $e()},Ye=e=>e?e.split(" ")[0]:"",Ge=e=>`${e}%`,Ze=(e,a)=>{ce.value={label:e.label,count:e.count,percentage:e.percentage};const t=a.target.getBoundingClientRect();re.value={left:`${t.left+window.scrollX+10}px`,top:t.top+window.scrollY-70+"px"},ne.value=!0},ea=()=>{ne.value=!1},aa=e=>e<=0?"late-report-early":e<=7?"late-report-on-time":e<=14?"late-report-late":"late-report-very-late",ta=async()=>{ae.value=!0,te.value=null;try{const e=await qe.A.get(`http://localhost:8000/api/kpi/report-timeliness/?period=${ie.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch timeliness metrics");se.value=e.data.data.metrics,oe.value=e.data.data.histogram||[],le.value=e.data.data.late_reports||[]}catch(e){console.error("Error fetching timeliness metrics:",e),te.value="Failed to load timeliness data"}finally{ae.value=!1}},ia=async e=>{ie.value=e,await ta()},sa=async()=>{ue.value=!0,pe.value=null;try{let e="http://localhost:8000/api/kpi/compliance-readiness/";ge.value?e+=`?framework_id=${ge.value}`:ye.value&&(e+=`?policy_id=${ye.value}`);const a=await qe.A.get(e);if(!a.data.success||!a.data.data)throw new Error(a.data.message||"Failed to fetch readiness metrics");ve.value=a.data.data.metrics,me.value=a.data.data.frameworks||[],ke.value=a.data.data.policies||[],he.value=a.data.data.criticality_breakdown||[]}catch(e){console.error("Error fetching readiness metrics:",e),pe.value="Failed to load readiness data"}finally{ue.value=!1}},oa=async e=>{ge.value=e,ye.value="",await sa()},la=async e=>{ye.value=e,ge.value="",await sa()},na=async()=>{ge.value="",ye.value="",await sa()},ra=(0,s.EW)(()=>{const e=ve.value.rating||"";return"Excellent"===e?"readiness-excellent":"Good"===e?"readiness-good":"Fair"===e?"readiness-fair":"readiness-poor"}),ca=e=>e>=90?"#4CAF50":e>=75?"#3f51b5":e>=50?"#FF9800":"#f44336",da=e=>{switch(e){case"Critical":return"#d32f2f";case"High":return"#f44336";case"Medium":return"#FF9800";case"Low":return"#4caf50";default:return"#9e9e9e"}},ua=e=>{const a=h.value[e],t=h.value[e+1];if(!a||!t)return{};const i=e/(h.value.length-1)*100,s=a.avg_cycle_days/g.value*100,o=(e+1)/(h.value.length-1)*100,l=t.avg_cycle_days/g.value*100,n=Math.sqrt(Math.pow(o-i,2)+Math.pow(l-s,2)),r=180*Math.atan2(l-s,o-i)/Math.PI;return{width:`${n}%`,left:`${i}%`,bottom:`${s}%`,transform:`rotate(${r}deg)`,transformOrigin:"left bottom"}},pa=e=>{const a=h.value[e],t=h.value[e+1];return!(!a||!t)&&(a.avg_cycle_days>k.value.target_days||t.avg_cycle_days>k.value.target_days)},va=(e,a)=>{const t=h.value[e];if(!t)return;b.value={month:t.month,avg_cycle_days:t.avg_cycle_days};const i=a.target.getBoundingClientRect();f.value={left:`${i.left+window.scrollX+10}px`,top:i.top+window.scrollY-70+"px"},y.value=!0},ma=()=>{y.value=!1},ka=e=>{const a=A.value[e],t=A.value[e+1];if(!a||!t)return{};const i=e/(A.value.length-1)*100,s=a.avg_close_days/T.value*100,o=(e+1)/(A.value.length-1)*100,l=t.avg_close_days/T.value*100,n=Math.sqrt(Math.pow(o-i,2)+Math.pow(l-s,2)),r=180*Math.atan2(l-s,o-i)/Math.PI;return{width:`${n}%`,left:`${i}%`,bottom:`${s}%`,transform:`rotate(${r}deg)`,transformOrigin:"left bottom"}},ha=e=>{const a=A.value[e],t=A.value[e+1];return!(!a||!t)&&(a.avg_close_days>S.value.target_days||t.avg_close_days>S.value.target_days)},ga=(e,a)=>{const t=A.value[e];if(!t)return;V.value={month:t.month,avg_close_days:t.avg_close_days};const i=a.target.getBoundingClientRect();F.value={left:`${i.left+window.scrollX+10}px`,top:i.top+window.scrollY-70+"px"},x.value=!0},ya=()=>{x.value=!1};(0,s.sV)(()=>{Fe(),Ve(),Me(),Xe(),Ue(),Ne(),$e(),ta(),sa()});const fa=e=>"Unspecified"===e?"NA":e,ba=(0,s.EW)(()=>{const e=S.value.avg_close_days||0,a=S.value.target_days||14;if(e<=0||a<=0)return 0;const t=Math.min(200,Math.max(0,a/e*100));return Math.round(t)}),Ca=e=>$.value.severity_breakdown.find(a=>a.severity===e)?.count||0;return(e,C)=>{const L=(0,s.g2)("v-card-item"),w=(0,s.g2)("v-icon"),E=(0,s.g2)("v-card-text"),ee=(0,s.g2)("v-card"),Fe=(0,s.g2)("v-progress-circular"),Ve=(0,s.g2)("v-spacer"),Me=(0,s.g2)("v-btn"),Xe=(0,s.g2)("v-card-title"),Ue=(0,s.g2)("v-dialog");return(0,s.uX)(),(0,s.CE)("div",WA,[(0,s.Lk)("div",QA,[(0,s.Lk)("div",qA,[(0,s.bF)(ee,{loading:O.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",KA,[(0,s.Lk)("div",JA,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:B.value===e}]),onClick:a=>ze(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,zA)),64))]),(0,s.Lk)("div",HA,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(W.value.severity_distribution,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"severity-bar"},[(0,s.Lk)("div",YA,(0,d.v_)(fa(e.severity)),1),(0,s.Lk)("div",GA,[(0,s.Lk)("div",{class:"severity-bar-fill",style:(0,d.Tr)({width:Re(e.count,W.value.total_issues),backgroundColor:e.color})},null,4),(0,s.Lk)("span",ZA,(0,d.v_)(e.count),1)])]))),128))]),C[25]||(C[25]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Severity of Issues",-1)),(0,s.Lk)("div",eT,[(0,s.Lk)("div",aT,"Most common: "+(0,d.v_)(fa(W.value.most_common)||"None"),1),W.value.major_count>0?((0,s.uX)(),(0,s.CE)("div",tT,[(0,s.Lk)("span",iT,(0,d.v_)(W.value.major_count),1),C[23]||(C[23]=(0,s.eW)(" Major, ")),(0,s.Lk)("span",sT,(0,d.v_)(W.value.minor_count),1),C[24]||(C[24]=(0,s.eW)(" Minor issues "))])):((0,s.uX)(),(0,s.CE)("div",oT,"No major issues found"))])])]),_:1}),j.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[26]||(C[26]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[26]}),(0,s.eW)(" "+(0,d.v_)(j.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])])]),(0,s.Lk)("div",lT,[(0,s.Lk)("div",nT,[(0,s.bF)(ee,{loading:u.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",rT,[(0,s.Lk)("div",cT,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[0]||(C[0]=e=>v.value=e),onChange:Be,class:"filter-select"},[C[27]||(C[27]=(0,s.Lk)("option",{value:""},"All Frameworks",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,dT))),128))],544),[[i.u1,v.value]])]),(0,s.Lk)("div",{class:(0,d.C4)(["time-badge",Ce.value])},[(0,s.eW)((0,d.v_)(k.value.overall_avg_days||0)+" ",1),C[28]||(C[28]=(0,s.Lk)("span",{class:"time-unit"},"days",-1))],2),C[32]||(C[32]=(0,s.Lk)("div",{class:"text-h6 mt-4 text-center"},"Audit Cycle Time",-1)),(0,s.Lk)("div",uT,[(0,s.Lk)("div",pT,"Target: "+(0,d.v_)(k.value.target_days||30)+" days",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Ce.value])},(0,d.v_)(k.value.efficiency||"N/A"),3)]),h.value.length>0?((0,s.uX)(),(0,s.CE)("div",vT,[C[31]||(C[31]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Cycle Time Trend",-1)),(0,s.Lk)("div",mT,[(0,s.Lk)("div",kT,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Te.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"chart-grid-line",style:(0,d.Tr)({bottom:e/g.value*100+"%"})},null,4))),128))]),(0,s.Lk)("div",hT,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Te.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"chart-y-label",style:(0,d.Tr)({bottom:e/g.value*100+"%"})},(0,d.v_)(e),5))),128))]),(0,s.Lk)("div",{class:"threshold-line",style:(0,d.Tr)({bottom:k.value.target_days/g.value*100+"%"})},null,4),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["chart-point",{"point-above-threshold":e.avg_cycle_days>k.value.target_days}]),style:(0,d.Tr)({left:a/(h.value.length-1)*100+"%",bottom:e.avg_cycle_days/g.value*100+"%"}),title:`${e.month}: ${e.avg_cycle_days} days`,onMouseover:e=>va(a,e),onMouseleave:C[1]||(C[1]=e=>ma())},null,46,gT))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value.slice(0,-1),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:`line-${a}`,class:(0,d.C4)(["chart-line",{"line-above-threshold":pa(a)}]),style:(0,d.Tr)(ua(a))},null,6))),128)),y.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"chart-tooltip",style:(0,d.Tr)(f.value)},[(0,s.Lk)("div",yT,(0,d.v_)(b.value.month),1),(0,s.Lk)("div",fT,(0,d.v_)(b.value.avg_cycle_days)+" days",1),b.value.avg_cycle_days>k.value.target_days?((0,s.uX)(),(0,s.CE)("div",bT,(0,d.v_)(b.value.avg_cycle_days-k.value.target_days)+" days above target ",1)):((0,s.uX)(),(0,s.CE)("div",CT,(0,d.v_)(k.value.target_days-b.value.avg_cycle_days)+" days below target ",1))],4)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",LT,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:`label-${a}`,class:"chart-label",style:(0,d.Tr)({left:a/(h.value.length-1)*100+"%",transform:"translateX(-50%)"})},(0,d.v_)(Ye(e.month)),5))),128))]),(0,s.Lk)("div",wT,[C[30]||(C[30]=(0,s.Lk)("div",{class:"legend-item"},[(0,s.Lk)("div",{class:"legend-color cycle-time-color"}),(0,s.Lk)("div",{class:"legend-label"},"Cycle Time")],-1)),(0,s.Lk)("div",ET,[C[29]||(C[29]=(0,s.Lk)("div",{class:"legend-color threshold-color"},null,-1)),(0,s.Lk)("div",RT,"Target ("+(0,d.v_)(k.value.target_days)+" days)",1)])])])):(0,s.Q3)("",!0)])]),_:1}),p.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[33]||(C[33]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[33]}),(0,s.eW)(" "+(0,d.v_)(p.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",DT,[(0,s.bF)(ee,{loading:R.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",IT,[(0,s.Lk)("div",PT,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:I.value===e}]),onClick:a=>We(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,_T)),64))]),(0,s.Lk)("div",ST,[(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-button",{active:"number"===P.value}]),onClick:C[2]||(C[2]=e=>P.value="number")}," Days ",2),(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-button",{active:"percentage"===P.value}]),onClick:C[3]||(C[3]=e=>P.value="percentage")}," Percentage ",2)]),(0,s.Lk)("div",{class:"flip-card-container",onClick:Qe},[(0,s.Lk)("div",{class:(0,d.C4)(["flip-card",{flipped:_.value}])},[(0,s.Lk)("div",AT,[(0,s.Lk)("div",TT,[(0,s.Lk)("div",xT,[(0,s.Lk)("div",{class:(0,d.C4)(["time-badge",Le.value])},["number"===P.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(S.value.avg_close_days||0)+" ",1),C[34]||(C[34]=(0,s.Lk)("span",{class:"time-unit"},"days",-1))],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,d.v_)(ba.value)+"% ",1)],64))],2),C[36]||(C[36]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Time to Close",-1)),(0,s.Lk)("div",FT,[(0,s.Lk)("div",VT,"Target: "+(0,d.v_)(S.value.target_days||14)+" days",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Le.value])},(0,d.v_)(S.value.efficiency||"N/A"),3)]),A.value.length>0?((0,s.uX)(),(0,s.CE)("div",MT,[C[35]||(C[35]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Trend",-1)),(0,s.Lk)("div",XT,[(0,s.Lk)("div",UT,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(xe.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"chart-grid-line",style:(0,d.Tr)({bottom:e/T.value*100+"%"})},null,4))),128))]),(0,s.Lk)("div",NT,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(xe.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"chart-y-label",style:(0,d.Tr)({bottom:e/T.value*100+"%"})},["number"===P.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e),1)],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,d.v_)(Math.round(e/S.value.target_days*100))+"% ",1)],64))],4))),128))]),(0,s.Lk)("div",{class:"threshold-line",style:(0,d.Tr)({bottom:S.value.target_days/T.value*100+"%"})},null,4),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["chart-point",{"point-above-threshold":e.avg_close_days>S.value.target_days}]),style:(0,d.Tr)({left:a/(A.value.length-1)*100+"%",bottom:e.avg_close_days/T.value*100+"%"}),title:`${e.month}: ${e.avg_close_days} days`,onMouseover:e=>ga(a,e),onMouseleave:C[4]||(C[4]=e=>ya())},null,46,$T))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.value.slice(0,-1),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:`line-${a}`,class:(0,d.C4)(["chart-line",{"line-above-threshold":ha(a)}]),style:(0,d.Tr)(ka(a))},null,6))),128)),x.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"chart-tooltip",style:(0,d.Tr)(F.value)},[(0,s.Lk)("div",OT,(0,d.v_)(V.value.month),1),(0,s.Lk)("div",jT,["number"===P.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(V.value.avg_close_days)+" days ",1)],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,d.v_)(Math.round(V.value.avg_close_days/S.value.target_days*100))+"% ",1)],64))]),V.value.avg_close_days>S.value.target_days?((0,s.uX)(),(0,s.CE)("div",BT,(0,d.v_)(V.value.avg_close_days-S.value.target_days)+" days above target ",1)):((0,s.uX)(),(0,s.CE)("div",WT,(0,d.v_)(S.value.target_days-V.value.avg_close_days)+" days below target ",1))],4)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",QT,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:`label-${a}`,class:"chart-label",style:(0,d.Tr)({left:a/(A.value.length-1)*100+"%",transform:"translateX(-50%)"})},(0,d.v_)(Ye(e.month)),5))),128))])])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",qT,[(0,s.bF)(w,{small:"",class:"mr-1"},{default:(0,s.k6)(()=>C[37]||(C[37]=[(0,s.eW)("mdi-flip-horizontal")])),_:1,__:[37]}),C[38]||(C[38]=(0,s.eW)(" Click to view detailed table "))])]),(0,s.Lk)("div",KT,[(0,s.Lk)("div",JT,[C[41]||(C[41]=(0,s.Lk)("div",{class:"section-title"},"Time to Close Details",-1)),(0,s.Lk)("div",zT,[(0,s.Lk)("table",HT,[C[40]||(C[40]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Month"),(0,s.Lk)("th",null,"Avg Days"),(0,s.Lk)("th",null,"Target"),(0,s.Lk)("th",null,"Variance"),(0,s.Lk)("th",null,"Closed"),(0,s.Lk)("th",null,"Total"),(0,s.Lk)("th",null,"Rate")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.value,(e,a)=>((0,s.uX)(),(0,s.CE)("tr",{key:a,class:(0,d.C4)({"critical-age":e.avg_close_days>1.5*S.value.target_days,"warning-age":e.avg_close_days>S.value.target_days&&e.avg_close_days<=1.5*S.value.target_days,"good-age":e.avg_close_days<=S.value.target_days})},[(0,s.Lk)("td",null,(0,d.v_)(e.month),1),(0,s.Lk)("td",null,(0,d.v_)(e.avg_close_days.toFixed(1)),1),(0,s.Lk)("td",null,(0,d.v_)(S.value.target_days),1),(0,s.Lk)("td",{class:(0,d.C4)({"negative-variance":e.avg_close_days>S.value.target_days,"positive-variance":e.avg_close_days<=S.value.target_days})},(0,d.v_)((e.avg_close_days-S.value.target_days).toFixed(1)),3),(0,s.Lk)("td",null,(0,d.v_)(e.closed_count||0),1),(0,s.Lk)("td",null,(0,d.v_)(e.total_count||0),1),(0,s.Lk)("td",null,(0,d.v_)(e.closure_rate?e.closure_rate.toFixed(1)+"%":"N/A"),1)],2))),128))]),(0,s.Lk)("tfoot",null,[(0,s.Lk)("tr",YT,[C[39]||(C[39]=(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,"Overall")],-1)),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(S.value.avg_close_days.toFixed(1)),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(S.value.target_days),1)]),(0,s.Lk)("td",{class:(0,d.C4)({"negative-variance":S.value.avg_close_days>S.value.target_days,"positive-variance":S.value.avg_close_days<=S.value.target_days})},[(0,s.Lk)("strong",null,(0,d.v_)((S.value.avg_close_days-S.value.target_days).toFixed(1)),1)],2),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(S.value.closed_count||0),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(S.value.total_count||0),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(S.value.closure_rate?S.value.closure_rate.toFixed(1)+"%":"N/A"),1)])])])])])]),(0,s.Lk)("div",GT,[(0,s.bF)(w,{small:"",class:"mr-1"},{default:(0,s.k6)(()=>C[42]||(C[42]=[(0,s.eW)("mdi-flip-horizontal")])),_:1,__:[42]}),C[43]||(C[43]=(0,s.eW)(" Click to view chart "))])])],2)])])]),_:1}),D.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[44]||(C[44]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[44]}),(0,s.eW)(" "+(0,d.v_)(D.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",ZT,[(0,s.bF)(ee,{loading:M.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",ex,[(0,s.Lk)("div",ax,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:U.value===e}]),onClick:a=>Ke(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,tx)),64))]),(0,s.Lk)("div",ix,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["all","major","minor","none"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["severity-button",{active:N.value===e}]),onClick:a=>Je(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,sx)),64))]),(0,s.Lk)("div",{class:(0,d.C4)(["issues-badge",we.value])},[(0,s.eW)((0,d.v_)($.value.total_count||0)+" ",1),"stable"!==$.value.trend_direction?((0,s.uX)(),(0,s.CE)("span",ox,[(0,s.bF)(w,{size:"small",color:Ee.value},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)("up"===$.value.trend_direction?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1},8,["color"]),(0,s.eW)(" "+(0,d.v_)(Math.abs($.value.trend_percentage))+"% ",1)])):(0,s.Q3)("",!0)],2),C[49]||(C[49]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Non-Compliance Issues",-1)),(0,s.Lk)("div",lx,[(0,s.Lk)("div",nx,[C[45]||(C[45]=(0,s.Lk)("div",{class:"severity-name"},"Major:",-1)),(0,s.Lk)("div",rx,(0,d.v_)(Ca("Major")),1)]),(0,s.Lk)("div",cx,[C[46]||(C[46]=(0,s.Lk)("div",{class:"severity-name"},"Minor:",-1)),(0,s.Lk)("div",dx,(0,d.v_)(Ca("Minor")),1)]),(0,s.Lk)("div",ux,[C[47]||(C[47]=(0,s.Lk)("div",{class:"severity-name"},"None:",-1)),(0,s.Lk)("div",px,(0,d.v_)(Ca("None")),1)])]),$.value.top_areas&&$.value.top_areas.length?((0,s.uX)(),(0,s.CE)("div",vx," Top area: "+(0,d.v_)($.value.top_areas[0].compliance_name)+" ("+(0,d.v_)($.value.top_areas[0].count)+" issues) ",1)):((0,s.uX)(),(0,s.CE)("div",mx," No top areas identified ")),$.value.monthly_trend&&$.value.monthly_trend.length?((0,s.uX)(),(0,s.CE)("div",kx,[C[48]||(C[48]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Trend",-1)),(0,s.Lk)("div",hx,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)($.value.monthly_trend.slice(-2),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"month-item"},[(0,s.Lk)("div",gx,(0,d.v_)(Ye(e.month)),1),(0,s.Lk)("div",yx,(0,d.v_)(e.count),1)]))),128))])])):(0,s.Q3)("",!0)])]),_:1}),X.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[50]||(C[50]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[50]}),(0,s.eW)(" "+(0,d.v_)(X.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])])]),(0,s.Lk)("div",fx,[(0,s.Lk)("div",bx,[(0,s.bF)(ee,{loading:Q.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",Cx,[Y.value.length>0?((0,s.uX)(),(0,s.CE)("div",Lx,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[5]||(C[5]=e=>H.value=e),class:"audit-select",onChange:He},[C[51]||(C[51]=(0,s.Lk)("option",{value:""},"All Audits",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Y.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id}," Audit #"+(0,d.v_)(e.id)+" - "+(0,d.v_)(e.name),9,wx))),128))],544),[[i.u1,H.value]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Ex,[(0,s.bF)(Fe,{"model-value":K.value.completion_percentage||0,size:130,width:15,color:De.value,class:"gauge-chart"},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(K.value.completion_percentage||0)+"% ",1)]),_:1},8,["model-value","color"])]),C[54]||(C[54]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Evidence Collection",-1)),(0,s.Lk)("div",Rx,[(0,s.Lk)("div",Dx,(0,d.v_)(K.value.evidence_collected||0)+" of "+(0,d.v_)(K.value.total_findings||0)+" findings have evidence",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Ie.value])},(0,d.v_)(K.value.rating||"N/A"),3)]),!H.value&&J.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ix,[C[52]||(C[52]=(0,s.Lk)("div",{class:"evidence-audits-title"},"Top Audits by Evidence Completion",-1)),(0,s.Lk)("div",Px,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(J.value.slice(0,3),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"evidence-audit-item",onClick:a=>{H.value=e.audit_id,He()}},[(0,s.Lk)("div",Sx,"Audit #"+(0,d.v_)(e.audit_id),1),(0,s.Lk)("div",Ax,(0,d.v_)(e.framework_name),1),(0,s.Lk)("div",Tx,[(0,s.Lk)("div",xx,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:`${e.completion_percentage}%`,backgroundColor:Oe(e.completion_percentage)})},null,4)]),(0,s.Lk)("span",Fx,(0,d.v_)(e.completion_percentage)+"%",1)])],8,_x))),128))])])):(0,s.Q3)("",!0),H.value&&z.value.length>0?((0,s.uX)(),(0,s.CE)("div",Vx,[C[53]||(C[53]=(0,s.Lk)("div",{class:"evidence-details-title"},"Evidence Details",-1)),(0,s.Lk)("div",Mx,[(0,s.Lk)("div",Xx,(0,d.v_)(Pe.value.withEvidence)+" with evidence",1),(0,s.Lk)("div",Ux,(0,d.v_)(Pe.value.withoutEvidence)+" without evidence",1)]),(0,s.Lk)("button",{class:"view-all-button",onClick:C[6]||(C[6]=e=>Z.value=!0)}," View All Evidence ")])):(0,s.Q3)("",!0)])]),_:1}),q.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[55]||(C[55]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[55]}),(0,s.eW)(" "+(0,d.v_)(q.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",Nx,[(0,s.bF)(ee,{loading:ae.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",$x,[(0,s.Lk)("div",Ox,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:ie.value===e}]),onClick:a=>ia(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,jx)),64))]),(0,s.Lk)("div",{class:"percentage-display",style:(0,d.Tr)({color:Se.value})},[(0,s.Lk)("span",Bx,(0,d.v_)(se.value.percent_on_time||0)+"%",1)],4),C[57]||(C[57]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Report Timeliness",-1)),(0,s.Lk)("div",Wx,[(0,s.Lk)("div",Qx,(0,d.v_)(se.value.on_time_count||0)+" of "+(0,d.v_)(se.value.total_reports||0)+" reports on time",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Ae.value])},(0,d.v_)(se.value.rating||"N/A"),3)]),(0,s.Lk)("div",qx,(0,d.v_)(se.value.avg_days_difference>0?"Avg "+se.value.avg_days_difference+" days late":"Avg "+Math.abs(se.value.avg_days_difference)+" days early"),1),oe.value.length>0?((0,s.uX)(),(0,s.CE)("div",Kx,[C[56]||(C[56]=(0,s.Lk)("div",{class:"histogram-title"},"Report Submission Timeliness",-1)),(0,s.Lk)("div",Jx,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(oe.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"histogram-bar",title:`${e.label}: ${e.count} reports (${e.percentage}%)`,onMouseover:a=>Ze(e,a),onMouseleave:C[7]||(C[7]=e=>ea())},[(0,s.Lk)("div",{class:"histogram-bar-fill",style:(0,d.Tr)({height:Ge(e.percentage),backgroundColor:e.color})},null,4),(0,s.Lk)("div",Hx,(0,d.v_)(e.label),1),(0,s.Lk)("div",Yx,(0,d.v_)(e.count),1)],40,zx))),128))])])):(0,s.Q3)("",!0),le.value.length>0?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"view-late-button",onClick:C[8]||(C[8]=e=>de.value=!0)}," View "+(0,d.v_)(le.value.length)+" Late Reports ",1)):(0,s.Q3)("",!0)])]),_:1}),te.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[58]||(C[58]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[58]}),(0,s.eW)(" "+(0,d.v_)(te.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])])]),(0,s.Lk)("div",Gx,[(0,s.Lk)("div",Zx,[(0,s.bF)(ee,{loading:ue.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",eF,[me.value.length>0||ke.value.length>0?((0,s.uX)(),(0,s.CE)("div",aF,[(0,s.Lk)("div",tF,[me.value.length>0?((0,s.uX)(),(0,s.CE)("div",iF,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[9]||(C[9]=e=>ge.value=e),onChange:C[10]||(C[10]=e=>oa(ge.value)),class:"filter-select"},[C[59]||(C[59]=(0,s.Lk)("option",{value:""},"All Frameworks",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(me.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.framework_id,value:e.framework_id},(0,d.v_)(e.name),9,sF))),128))],544),[[i.u1,ge.value]])])):(0,s.Q3)("",!0),ke.value.length>0?((0,s.uX)(),(0,s.CE)("div",oF,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[11]||(C[11]=e=>ye.value=e),onChange:C[12]||(C[12]=e=>la(ye.value)),class:"filter-select"},[C[60]||(C[60]=(0,s.Lk)("option",{value:""},"All Policies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ke.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.policy_id,value:e.policy_id},(0,d.v_)(e.name),9,lF))),128))],544),[[i.u1,ye.value]])])):(0,s.Q3)("",!0)]),ge.value||ye.value?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:na,class:"reset-filter-button"}," Reset Filters ")):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",nF,[(0,s.bF)(Fe,{"model-value":ve.value.readiness_percentage||0,size:150,width:15,color:ve.value.color||"info",class:"gauge-chart"},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(ve.value.readiness_percentage||0)+"% ",1)]),_:1},8,["model-value","color"])]),C[62]||(C[62]=(0,s.Lk)("div",{class:"text-h6 mt-4 text-center"},"Compliance Readiness",-1)),(0,s.Lk)("div",rF,[(0,s.Lk)("div",cF,(0,d.v_)(ve.value.implemented_count||0)+" of "+(0,d.v_)(ve.value.total_defined||0)+" controls implemented ",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",ra.value])},(0,d.v_)(ve.value.rating||"N/A"),3)]),ge.value||ye.value?((0,s.uX)(),(0,s.CE)("div",dF,[(0,s.Lk)("div",uF,(0,d.v_)(ge.value?"Framework: "+(me.value.find(e=>e.framework_id==ge.value)?.name||""):"Policy: "+(ke.value.find(e=>e.policy_id==ye.value)?.name||"")),1)])):(0,s.Q3)("",!0),!ge.value&&!ye.value&&me.value.length>0?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"view-breakdown-button",onClick:C[13]||(C[13]=e=>fe.value=!0)}," View Framework Breakdown ")):(0,s.Q3)("",!0),he.value.length>0?((0,s.uX)(),(0,s.CE)("div",pF,[C[61]||(C[61]=(0,s.Lk)("div",{class:"breakdown-title"},"Breakdown by Criticality",-1)),(0,s.Lk)("div",vF,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(he.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"criticality-bar-item"},[(0,s.Lk)("div",mF,(0,d.v_)(e.criticality),1),(0,s.Lk)("div",kF,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:`${e.readiness_percentage}%`,backgroundColor:da(e.criticality)})},null,4),(0,s.Lk)("span",hF,(0,d.v_)(e.readiness_percentage)+"%",1)]),(0,s.Lk)("div",gF,(0,d.v_)(e.implemented_count)+" / "+(0,d.v_)(e.total_defined),1)]))),128))])])):(0,s.Q3)("",!0)])]),_:1}),pe.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[63]||(C[63]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[63]}),(0,s.eW)(" "+(0,d.v_)(pe.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",yF,[(0,s.bF)(ee,{loading:a.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",fF,[(0,s.Lk)("div",bF,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["day","week","month","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:o.value===e}]),onClick:a=>je(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,CF)),64))]),(0,s.Lk)("div",LF,[(0,s.bF)(Fe,{"model-value":l.value.completion_percentage||0,size:150,width:15,color:be.value,class:"gauge-chart"},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(l.value.completion_percentage||0)+"% ",1)]),_:1},8,["model-value","color"])]),C[68]||(C[68]=(0,s.Lk)("div",{class:"text-h6 mt-4 text-center"},"Audit Completion",-1)),(0,s.Lk)("div",wF,[(0,s.Lk)("div",EF,[(0,s.Lk)("div",RF,(0,d.v_)(l.value.total_audits||0),1),C[64]||(C[64]=(0,s.Lk)("div",{class:"metric-label"},"Planned",-1))]),(0,s.Lk)("div",DF,[(0,s.Lk)("div",IF,(0,d.v_)(l.value.completed_audits||0),1),C[65]||(C[65]=(0,s.Lk)("div",{class:"metric-label"},"Completed",-1))])]),n.value.length>0?((0,s.uX)(),(0,s.CE)("div",PF,[C[66]||(C[66]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Audit Completion",-1)),(0,s.Lk)("div",_F,[(0,s.Lk)("div",SF,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"y-axis-label",style:(0,d.Tr)({bottom:e/r.value*100+"%"})},(0,d.v_)(e),5))),128))]),(0,s.Lk)("div",AF,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"bar-group"},[(0,s.Lk)("div",TF,[(0,s.Lk)("div",{class:"bar planned-bar",style:(0,d.Tr)({height:e.planned/r.value*100+"%",opacity:e.planned>0?1:.3}),title:`Planned: ${e.planned}`},null,12,xF)]),(0,s.Lk)("div",FF,[(0,s.Lk)("div",{class:"bar completed-bar",style:(0,d.Tr)({height:e.completed/r.value*100+"%",opacity:e.completed>0?1:.3}),title:`Completed: ${e.completed}`},null,12,VF)]),(0,s.Lk)("div",MF,(0,d.v_)(e.month),1)]))),128))])]),C[67]||(C[67]=(0,s.Lk)("div",{class:"chart-legend"},[(0,s.Lk)("div",{class:"legend-item"},[(0,s.Lk)("div",{class:"legend-color planned-color"}),(0,s.Lk)("div",{class:"legend-label"},"Planned")]),(0,s.Lk)("div",{class:"legend-item"},[(0,s.Lk)("div",{class:"legend-color completed-color"}),(0,s.Lk)("div",{class:"legend-label"},"Completed")])],-1))])):(0,s.Q3)("",!0)])]),_:1}),t.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[69]||(C[69]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[69]}),(0,s.eW)(" "+(0,d.v_)(t.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])])]),(0,s.bF)(Ue,{modelValue:Z.value,"onUpdate:modelValue":C[18]||(C[18]=e=>Z.value=e),"max-width":"800px"},{default:(0,s.k6)(()=>[(0,s.bF)(ee,null,{default:(0,s.k6)(()=>[(0,s.bF)(Xe,{class:"modal-title"},{default:(0,s.k6)(()=>[(0,s.eW)(" Evidence Details for Audit #"+(0,d.v_)(H.value)+" ",1),(0,s.bF)(Ve),(0,s.bF)(Me,{icon:"",onClick:C[14]||(C[14]=e=>Z.value=!1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>C[70]||(C[70]=[(0,s.eW)("mdi-close")])),_:1,__:[70]})]),_:1})]),_:1}),(0,s.bF)(E,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",XF,[(0,s.Lk)("div",UF,[C[71]||(C[71]=(0,s.Lk)("label",{class:"filter-label"},"Show:",-1)),(0,s.Lk)("div",NF,[(0,s.Lk)("button",{class:(0,d.C4)(["filter-button",{active:"all"===G.value}]),onClick:C[15]||(C[15]=e=>G.value="all")}," All ",2),(0,s.Lk)("button",{class:(0,d.C4)(["filter-button",{active:"with"===G.value}]),onClick:C[16]||(C[16]=e=>G.value="with")}," With Evidence ",2),(0,s.Lk)("button",{class:(0,d.C4)(["filter-button",{active:"without"===G.value}]),onClick:C[17]||(C[17]=e=>G.value="without")}," Without Evidence ",2)])]),(0,s.Lk)("div",$F,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(_e.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["evidence-item",{"has-evidence":e.has_evidence}])},[(0,s.Lk)("div",OF,[(0,s.Lk)("div",jF,"Finding #"+(0,d.v_)(e.finding_id)+" (Compliance #"+(0,d.v_)(e.compliance_id)+")",1),(0,s.Lk)("div",{class:(0,d.C4)(["evidence-status",{"status-positive":e.has_evidence,"status-negative":!e.has_evidence}])},(0,d.v_)(e.has_evidence?"Evidence Provided":"No Evidence"),3)]),e.has_evidence?((0,s.uX)(),(0,s.CE)("div",BF,[(0,s.Lk)("div",WF,(0,d.v_)(e.evidence),1)])):(0,s.Q3)("",!0)],2))),128))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),ne.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"histogram-tooltip",style:(0,d.Tr)(re.value)},[(0,s.Lk)("div",QF,(0,d.v_)(ce.value.label),1),(0,s.Lk)("div",qF,(0,d.v_)(ce.value.count)+" reports",1),(0,s.Lk)("div",KF,(0,d.v_)(ce.value.percentage)+"% of total",1)],4)):(0,s.Q3)("",!0),(0,s.bF)(Ue,{modelValue:de.value,"onUpdate:modelValue":C[20]||(C[20]=e=>de.value=e),"max-width":"800px"},{default:(0,s.k6)(()=>[(0,s.bF)(ee,null,{default:(0,s.k6)(()=>[(0,s.bF)(Xe,{class:"modal-title"},{default:(0,s.k6)(()=>[C[73]||(C[73]=(0,s.eW)(" Late Audit Reports ")),(0,s.bF)(Ve),(0,s.bF)(Me,{icon:"",onClick:C[19]||(C[19]=e=>de.value=!1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>C[72]||(C[72]=[(0,s.eW)("mdi-close")])),_:1,__:[72]})]),_:1})]),_:1,__:[73]}),(0,s.bF)(E,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",JF,[(0,s.Lk)("div",zF,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(le.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"late-report-item"},[(0,s.Lk)("div",HF,[(0,s.Lk)("div",YF,"Audit #"+(0,d.v_)(e.audit_id),1),(0,s.Lk)("div",{class:(0,d.C4)(["late-report-days",aa(e.days_late)])},(0,d.v_)(e.days_late)+" days late ",3)]),(0,s.Lk)("div",GF,[(0,s.Lk)("div",ZF,(0,d.v_)(e.framework_name),1),(0,s.Lk)("div",eV,[(0,s.Lk)("span",aV,"Due: "+(0,d.v_)(e.due_date),1),(0,s.Lk)("span",tV,"Completed: "+(0,d.v_)(e.completion_date),1)])])]))),128))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,s.bF)(Ue,{modelValue:fe.value,"onUpdate:modelValue":C[22]||(C[22]=e=>fe.value=e),"max-width":"800px"},{default:(0,s.k6)(()=>[(0,s.bF)(ee,null,{default:(0,s.k6)(()=>[(0,s.bF)(Xe,{class:"modal-title"},{default:(0,s.k6)(()=>[C[75]||(C[75]=(0,s.eW)(" Framework Compliance Readiness ")),(0,s.bF)(Ve),(0,s.bF)(Me,{icon:"",onClick:C[21]||(C[21]=e=>fe.value=!1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>C[74]||(C[74]=[(0,s.eW)("mdi-close")])),_:1,__:[74]})]),_:1})]),_:1,__:[75]}),(0,s.bF)(E,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",iV,[(0,s.Lk)("div",sV,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(me.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"framework-item",onClick:a=>{oa(e.framework_id),fe.value=!1}},[(0,s.Lk)("div",lV,[(0,s.Lk)("div",nV,(0,d.v_)(e.name),1),(0,s.Lk)("div",rV,(0,d.v_)(e.readiness_percentage)+"% ",1)]),(0,s.Lk)("div",cV,[(0,s.Lk)("div",dV,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:`${e.readiness_percentage}%`,backgroundColor:ca(e.readiness_percentage)})},null,4)])]),(0,s.Lk)("div",uV,(0,d.v_)(e.implemented_count)+" of "+(0,d.v_)(e.total_defined)+" controls implemented ",1)],8,oV))),128))])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};const vV=pV;var mV=vV;const kV={class:"dashboard-container"},hV={class:"dashboard-header"},gV={class:"dashboard-actions"},yV={class:"performance-summary"},fV={class:"summary-card growth"},bV={class:"summary-content"},CV={class:"summary-value"},LV={class:"summary-card"},wV={class:"summary-content"},EV={class:"summary-value"},RV={class:"summary-card"},DV={class:"summary-content"},IV={class:"summary-value"},PV={class:"summary-card"},_V={class:"summary-content"},SV={class:"summary-value"},AV={class:"dashboard-main-row dashboard-main-row-3col"},TV={class:"dashboard-main-col asset-performance-col"},xV={class:"chart-card tabbed-chart-card"},FV={class:"card-header"},VV={class:"chart-controls"},MV={class:"axis-selectors"},XV=["disabled"],UV=["disabled"],NV={class:"chart-tabs"},$V=["onClick","title","disabled"],OV={class:"chart-container"},jV={key:0,class:"chart-loading"},BV={class:"dashboard-main-col recent-activity-col"},WV={class:"activity-card"},QV={class:"card-header"},qV={key:0,class:"activity-loading"},KV={key:1,class:"activity-empty"},JV={key:2,class:"activity-list"},zV={class:"activity-content"},HV={class:"activity-title"},YV={class:"activity-desc"},GV={class:"activity-time"};function ZV(e,a,t,o,l,n){const r=(0,s.g2)("LineChart"),c=(0,s.g2)("Bar"),u=(0,s.g2)("Doughnut");return(0,s.uX)(),(0,s.CE)("div",kV,[(0,s.Lk)("div",hV,[a[6]||(a[6]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Auditor Dashboard",-1)),(0,s.Lk)("div",gV,[(0,s.Lk)("button",{class:"action-btn",onClick:a[0]||(a[0]=(...e)=>o.refreshData&&o.refreshData(...e))},a[4]||(a[4]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),a[5]||(a[5]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",yV,[(0,s.Lk)("div",fV,[a[9]||(a[9]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-check"})],-1)),(0,s.Lk)("div",bV,[a[8]||(a[8]=(0,s.Lk)("div",{class:"summary-label"},"Audit Completion Rate",-1)),(0,s.Lk)("div",CV,[(0,s.Lk)("span",{class:(0,d.C4)({positive:o.auditCompletionData.is_positive_change,negative:!o.auditCompletionData.is_positive_change})},(0,d.v_)(o.auditCompletionData.is_positive_change?"+":"-")+(0,d.v_)(Math.abs(o.auditCompletionData.current_month_rate).toFixed(1))+"% ",3),a[7]||(a[7]=(0,s.Lk)("span",{class:"period"},"this month",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.auditCompletionData.is_positive_change,negative:!o.auditCompletionData.is_positive_change}])},(0,d.v_)(o.auditCompletionData.is_positive_change?"+":"-")+(0,d.v_)(Math.abs(o.auditCompletionData.change_in_rate).toFixed(2))+"% vs last month ",3)])]),(0,s.Lk)("div",LV,[a[11]||(a[11]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-tasks"})],-1)),(0,s.Lk)("div",wV,[a[10]||(a[10]=(0,s.Lk)("div",{class:"summary-label"},"Total Audits",-1)),(0,s.Lk)("div",EV,(0,d.v_)(o.totalAuditsData.total_current_month),1),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.totalAuditsData.is_positive_change,negative:!o.totalAuditsData.is_positive_change}])},(0,d.v_)(o.totalAuditsData.is_positive_change?"+":"-")+(0,d.v_)(Math.abs(o.totalAuditsData.change_in_total))+" this month ",3)])]),(0,s.Lk)("div",RV,[a[13]||(a[13]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-hourglass-half"})],-1)),(0,s.Lk)("div",DV,[a[12]||(a[12]=(0,s.Lk)("div",{class:"summary-label"},"Open Audits",-1)),(0,s.Lk)("div",IV,(0,d.v_)(o.openAuditsData.open_this_week),1),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.openAuditsData.is_improvement,negative:!o.openAuditsData.is_improvement}])},(0,d.v_)(o.openAuditsData.is_improvement?"+":"-")+(0,d.v_)(Math.abs(o.openAuditsData.change_in_open))+" since last week ",3)])]),(0,s.Lk)("div",PV,[a[15]||(a[15]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",_V,[a[14]||(a[14]=(0,s.Lk)("div",{class:"summary-label"},"Completed Audits",-1)),(0,s.Lk)("div",SV,(0,d.v_)(o.completedAuditsData.this_week_count),1),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.completedAuditsData.is_improvement,negative:!o.completedAuditsData.is_improvement}])},(0,d.v_)(o.completedAuditsData.is_improvement?"+":"")+(0,d.v_)(o.completedAuditsData.change_in_completed)+" this week ",3)])])]),(0,s.Lk)("div",AV,[(0,s.Lk)("div",TV,[(0,s.Lk)("div",xV,[(0,s.Lk)("div",FV,[a[18]||(a[18]=(0,s.Lk)("span",{class:"chart-title"},"Audit performance",-1)),(0,s.Lk)("div",VV,[(0,s.Lk)("div",MV,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>o.selectedXAxis=e),class:"axis-select",disabled:o.isLoading},a[16]||(a[16]=[(0,s.Lk)("option",{value:"time"},"Time",-1),(0,s.Lk)("option",{value:"frameworks"},"Frameworks",-1),(0,s.Lk)("option",{value:"categories"},"Categories",-1),(0,s.Lk)("option",{value:"status"},"Status",-1)]),8,XV),[[i.u1,o.selectedXAxis]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>o.selectedYAxis=e),class:"axis-select",disabled:o.isLoading},a[17]||(a[17]=[(0,s.Lk)("option",{value:"completion"},"Performance",-1),(0,s.Lk)("option",{value:"compliance"},"Compliance Rate",-1),(0,s.Lk)("option",{value:"findings"},"Finding Count",-1)]),8,UV),[[i.u1,o.selectedYAxis]])]),(0,s.Lk)("div",NV,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.chartTypes,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.type,class:(0,d.C4)(["chart-tab-btn",{active:o.activeChart===e.type}]),onClick:a=>o.activeChart=e.type,title:e.label,disabled:o.isLoading},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon)},null,2)],10,$V))),128))])])]),(0,s.Lk)("div",OV,[o.isLoading?((0,s.uX)(),(0,s.CE)("div",jV,a[19]||(a[19]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading chart data...",-1)]))):"line"===o.activeChart?((0,s.uX)(),(0,s.Wv)(r,{key:1,data:o.lineChartData,options:o.lineChartOptions},null,8,["data","options"])):"bar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:2,data:o.barChartData,options:o.barChartOptions},null,8,["data","options"])):"doughnut"===o.activeChart?((0,s.uX)(),(0,s.Wv)(u,{key:3,data:o.donutChartData,options:o.donutChartOptions},null,8,["data","options"])):"horizontalBar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:4,data:o.horizontalBarChartData,options:o.horizontalBarChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",BV,[(0,s.Lk)("div",WV,[(0,s.Lk)("div",QV,[a[20]||(a[20]=(0,s.Lk)("h3",null,"Recent Audit Activity",-1)),(0,s.Lk)("button",{class:"card-action",onClick:a[3]||(a[3]=(...e)=>o.fetchRecentActivities&&o.fetchRecentActivities(...e))},[(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-sync-alt",{"fa-spin":o.isLoadingActivities}])},null,2)])]),o.isLoadingActivities&&o.isEmpty(o.recentActivities)?((0,s.uX)(),(0,s.CE)("div",qV,a[21]||(a[21]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading activities...",-1)]))):o.isEmpty(o.filteredActivities)?((0,s.uX)(),(0,s.CE)("div",KV,a[22]||(a[22]=[(0,s.Lk)("p",null,"No recent activities found",-1)]))):((0,s.uX)(),(0,s.CE)("div",JV,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredActivities,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"activity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["activity-icon",o.getActivityIconClass(e.type)])},[(0,s.Lk)("i",{class:(0,d.C4)(o.getActivityIcon(e.type))},null,2)],2),(0,s.Lk)("div",zV,[(0,s.Lk)("div",HV,(0,d.v_)(e.title||"Activity"),1),(0,s.Lk)("div",YV,(0,d.v_)(e.description||"No description available"),1),(0,s.Lk)("div",GV,(0,d.v_)(e.time_ago||"Recently"),1)])]))),128))]))])])])])}ze.t1.register(ze.Bs,ze.E8,ze.PP,ze.kc,ze.FN,ze.No,ze.m_,ze.s$);var eM={name:"AuditorDashboard",components:{Doughnut:He.nu,Bar:He.yP,LineChart:He.N1},setup(){const e=(0,ee.KR)(!1),a=(0,ee.KR)(!1),t=(0,ee.Kh)({current_month_rate:0,previous_month_rate:0,change_in_rate:0,is_positive_change:!0}),i=(0,ee.Kh)({total_current_month:0,total_previous_month:0,change_in_total:0,is_positive_change:!0}),o=(0,ee.Kh)({open_this_week:0,open_last_week:0,change_in_open:0,percent_change:0,is_improvement:!0}),l=(0,ee.Kh)({this_week_count:0,last_week_count:0,change_in_completed:0,percent_change:0,is_improvement:!0}),n=(0,ee.Kh)({completion_trend:[],compliance_trend:[],finding_trend:[],framework_performance:[],category_performance:[],status_distribution:{}}),r=(0,ee.KR)([]),c=async()=>{try{const e=await qe.A.get("/api/dashboard/audit-completion-rate/");e.data&&(t.current_month_rate=e.data.current_month_rate,t.previous_month_rate=e.data.previous_month_rate,t.change_in_rate=e.data.change_in_rate,t.is_positive_change=e.data.is_positive_change)}catch(e){console.error("Error fetching audit completion rate:",e)}},d=async()=>{try{const e=await qe.A.get("/api/dashboard/total-audits/");e.data&&(i.total_current_month=e.data.total_current_month,i.total_previous_month=e.data.total_previous_month,i.change_in_total=e.data.change_in_total,i.is_positive_change=e.data.is_positive_change)}catch(e){console.error("Error fetching total audits:",e)}},u=async()=>{try{const e=await qe.A.get("/api/dashboard/open-audits/");e.data&&(o.open_this_week=e.data.open_this_week,o.open_last_week=e.data.open_last_week,o.change_in_open=e.data.change_in_open,o.percent_change=e.data.percent_change,o.is_improvement=e.data.is_improvement)}catch(e){console.error("Error fetching open audits:",e)}},p=async()=>{try{const e=await qe.A.get("/api/dashboard/completed-audits/");e.data&&(l.this_week_count=e.data.this_week_count,l.last_week_count=e.data.last_week_count,l.change_in_completed=e.data.change_in_completed,l.percent_change=e.data.percent_change,l.is_improvement=e.data.is_improvement)}catch(e){console.error("Error fetching completed audits:",e)}},v=async()=>{y(h.value,g.value);try{try{const e=await qe.A.get("/api/dashboard/audit-completion-trend/");e.data&&(n.completion_trend=e.data)}catch(e){console.error("Error fetching completion trend data:",e)}try{const e=await qe.A.get("/api/dashboard/audit-compliance-trend/");e.data&&(n.compliance_trend=e.data)}catch(e){console.error("Error fetching compliance trend data:",e)}try{const e=await qe.A.get("/api/dashboard/audit-finding-trend/");e.data&&(n.finding_trend=e.data)}catch(e){console.error("Error fetching finding trend data:",e)}try{const e=await qe.A.get("/api/dashboard/framework-performance/");e.data&&(n.framework_performance=e.data)}catch(e){console.error("Error fetching framework performance data:",e)}try{const e=await qe.A.get("/api/dashboard/category-performance/");e.data&&(n.category_performance=e.data)}catch(e){console.error("Error fetching category performance data:",e)}try{const e=await qe.A.get("/api/dashboard/status-distribution/");e.data&&(n.status_distribution=e.data)}catch(e){console.error("Error fetching status distribution data:",e)}}catch(e){console.error("Error fetching chart data:",e)}finally{y(h.value,g.value)}},m=async()=>{a.value=!0;try{const e=await qe.A.get("/api/dashboard/recent-audit-activities/");e.data?r.value=e.data:r.value=[]}catch(e){console.error("Error fetching recent activities:",e),r.value=[{type:"completed",audit_id:0,title:"Sample Activity",description:"Recent activities will appear here",time_ago:"Recently"},{type:"review",audit_id:0,title:"Review Activity",description:"Sample review activity",time_ago:"Recently"},{type:"due",audit_id:0,title:"Due Date Approaching",description:"Sample upcoming deadline",time_ago:"Soon"}]}finally{a.value=!1}},k=async()=>{e.value=!0;try{await Promise.all([c(),d(),u(),p(),v(),m()])}catch(a){console.error("Error refreshing dashboard data:",a)}finally{e.value=!1}};(0,s.sV)(()=>{k()});const h=(0,ee.KR)("time"),g=(0,ee.KR)("completion");(0,s.wB)([h,g],([a,t])=>{e.value=!0,setTimeout(()=>{y(a,t),e.value=!1},300)});const y=(e,a)=>{const{labels:t,datasets:i}=f(e,a);w.labels=t,w.datasets=[{label:b(a),data:i[0].data,fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}],I.labels=t,i.length>1?I.datasets=i.map(e=>({...e,stack:"Stack 0",borderRadius:4})):I.datasets=[{label:b(a),data:i[0].data,backgroundColor:i[0].backgroundColor||"#4ade80",borderRadius:4}],R.labels=t;const s=i[0].multipleColors||["#4ade80","#fbbf24","#f87171","#60a5fa","#a78bfa","#c084fc","#f472b6","#fb7185","#34d399","#38bdf8"];R.datasets=[{data:i[0].data,backgroundColor:Array.isArray(i[0].backgroundColor)?i[0].backgroundColor:i[0].data.map((e,a)=>s[a%s.length]),borderWidth:0,hoverOffset:5}],_.labels=t,"status"===e||1===i.length?_.datasets=[{label:b(a),data:i[0].data,backgroundColor:Array.isArray(i[0].backgroundColor)?i[0].backgroundColor:i[0].data.map((e,a)=>s[a%s.length]),borderRadius:6,barPercentage:.5,categoryPercentage:.7}]:_.datasets=i.map(e=>({...e,borderRadius:6,barPercentage:.5,categoryPercentage:.7}))},f=(e,a)=>{let t=[],i=[];if("time"===e){if(t=n.completion_trend.length>0?n.completion_trend.map(e=>e.month):["Jan","Feb","Mar","Apr","May","Jun","Jul"],"completion"===a){const e=n.completion_trend.length>0?n.completion_trend.map(e=>e.completion_rate):[65,70,75,78,82,85,88];i=[{label:"Completion Rate",data:e,backgroundColor:"#4ade80"}]}else if("compliance"===a){const e=n.compliance_trend.length>0?n.compliance_trend.map(e=>e.compliance_rate):[92,90,88,86,89,91,93];i=[{label:"Compliance Rate",data:e,backgroundColor:"#60a5fa"}]}else if("findings"===a){const e=n.finding_trend.length>0?n.finding_trend.map(e=>e.major_findings):[5,4,6,8,6,5,6],a=n.finding_trend.length>0?n.finding_trend.map(e=>e.minor_findings):[10,8,12,14,10,9,11];i=[{label:"Major Findings",data:e,backgroundColor:"#f87171"},{label:"Minor Findings",data:a,backgroundColor:"#fbbf24"}]}}else if("frameworks"===e){const e=n.framework_performance.length>0?n.framework_performance:[{framework:"ISO 27001",framework_id:1,completion_rate:65,completed:12,in_progress:3,yet_to_start:2},{framework:"NIST 800-53",framework_id:2,completion_rate:70,completed:10,in_progress:4,yet_to_start:1},{framework:"GDPR",framework_id:3,completion_rate:75,completed:8,in_progress:6,yet_to_start:2},{framework:"PCI DSS",framework_id:4,completion_rate:82,completed:14,in_progress:2,yet_to_start:1},{framework:"HIPAA",framework_id:5,completion_rate:78,completed:9,in_progress:5,yet_to_start:3}];if(t=e.map(e=>e.framework),"completion"===a){const a=e.map(e=>e.completion_rate),t=["#4ade80","#60a5fa","#fbbf24","#f87171","#a78bfa","#c084fc","#f472b6"];i=[{label:"Completion Rate",data:a,backgroundColor:"#4ade80",borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",multipleColors:t}]}else"compliance"!==a&&"findings"!==a||(i=[{label:"Completed",data:e.map(e=>e.completed),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"In Progress",data:e.map(e=>e.in_progress),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4},{label:"Yet To Start",data:e.map(e=>e.yet_to_start),backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4}])}else if("categories"===e){const e=n.category_performance.length>0?n.category_performance:[{category:"Information Security",completion_rate:86,total:25,completed:21},{category:"Data Protection",completion_rate:92,total:18,completed:16},{category:"Risk Assessment",completion_rate:78,total:15,completed:12},{category:"Access Control",completion_rate:84,total:20,completed:17},{category:"Change Management",completion_rate:73,total:12,completed:9}];t=e.map(e=>e.category);const s=["#4ade80","#60a5fa","#fbbf24","#f87171","#a78bfa","#c084fc","#f472b6"];if("completion"===a||"compliance"===a){const a=e.map(e=>e.completion_rate);i=[{label:"Completion Rate",data:a,backgroundColor:"#4ade80",borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",multipleColors:s}]}else"findings"===a&&(i=[{label:"Completed",data:e.map(e=>e.completed),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Remaining",data:e.map(e=>e.total-e.completed),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4}])}else if("status"===e){const e=Object.keys(n.status_distribution).length>0?n.status_distribution:{completed:53,in_progress:32,yet_to_start:15,completed_percent:53,in_progress_percent:32,yet_to_start_percent:15};t=["Completed","In Progress","Yet To Start"];const a=[e.completed_percent||0,e.in_progress_percent||0,e.yet_to_start_percent||0];i=[{label:"Distribution",data:a,backgroundColor:["#4ade80","#fbbf24","#f87171"]}]}return{labels:t,datasets:i}},b=e=>{switch(e){case"completion":return"Completion Rate";case"compliance":return"Compliance Rate";case"findings":return"Finding Count";default:return"Value"}},C=[{type:"line",icon:"fas fa-chart-line",label:"Line"},{type:"bar",icon:"fas fa-chart-bar",label:"Bar"},{type:"doughnut",icon:"fas fa-dot-circle",label:"Donut"},{type:"horizontalBar",icon:"fas fa-align-left",label:"Horizontal Bar"}],L=(0,ee.KR)("line"),w=(0,ee.Kh)({labels:["Jan","Feb","Mar","Apr","May","Jun","Jul"],datasets:[{label:"Audit Completion Rate",data:[65,70,75,78,82,85,88],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}),E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:11}}},x:{grid:{display:!1},ticks:{font:{size:11},maxRotation:45,minRotation:0}}},animation:{duration:1500,easing:"easeOutQuart"}},R=(0,ee.Kh)({labels:["Completed","In Progress","Yet To Start"],datasets:[{data:[53,32,15],backgroundColor:["#4ade80","#fbbf24","#f87171"],borderWidth:0,hoverOffset:5}]}),D={cutout:"70%",plugins:{legend:{display:!0,position:"right",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeOutCubic"}},I=(0,ee.Kh)({labels:["ISO 27001","NIST 800-53"],datasets:[{label:"Completed",data:[12,10],backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"In Progress",data:[3,4],backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4},{label:"Yet To Start",data:[2,1],backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4}]}),P={plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#222",font:{size:10},maxRotation:45,minRotation:0}},y:{stacked:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}},beginAtZero:!0}},animation:{duration:1e3,easing:"easeInOutQuart"}},_=(0,ee.Kh)({labels:["Information Security","Data Protection","Risk Assessment","Access Control","Change Management"],datasets:[{label:"Completion Rate (%)",data:[86,92,78,84,73],backgroundColor:"#4ade80",borderRadius:6,barPercentage:.5,categoryPercentage:.7}]}),S={indexAxis:"y",plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}},stacked:!0},y:{grid:{display:!1},ticks:{color:"#222",font:{size:10}},stacked:!0}},maintainAspectRatio:!1,animation:{duration:1e3,easing:"easeInOutQuart"}},A=e=>{switch(e){case"completed":return"fas fa-check-circle";case"review":return"fas fa-sync-alt";case"due":return"fas fa-exclamation-circle";default:return"fas fa-info-circle"}},T=e=>{switch(e){case"completed":return"";case"review":return"update";case"due":return"alert";default:return""}},x=e=>!e||!Array.isArray(e)||0===e.length,F=(0,s.EW)(()=>r.value&&Array.isArray(r.value)?r.value.filter(e=>null!==e&&void 0!==e):[]);return{isLoading:e,isLoadingActivities:a,auditCompletionData:t,totalAuditsData:i,openAuditsData:o,completedAuditsData:l,chartData:n,recentActivities:r,refreshData:k,fetchRecentActivities:m,getActivityIcon:A,getActivityIconClass:T,isEmpty:x,lineChartData:w,lineChartOptions:E,donutChartData:R,donutChartOptions:D,barChartData:I,barChartOptions:P,horizontalBarChartData:_,horizontalBarChartOptions:S,chartTypes:C,activeChart:L,selectedXAxis:h,selectedYAxis:g,filteredActivities:F}}};const aM=(0,se.A)(eM,[["render",ZV],["__scopeId","data-v-31407e38"]]);var tM=aM;const iM={class:"upload-framework-container"},sM={class:"step-indicator"},oM={key:0,class:"back-button-container"},lM={class:"upload-section"},nM={key:1,class:"or-divider"},rM={key:2,class:"default-data-section"},cM={class:"default-data-content"},dM=["disabled"],uM={key:3,class:"file-preview"},pM={class:"file-info"},vM={class:"file-details"},mM={class:"upload-actions"},kM=["disabled"],hM={key:4,class:"processing-section"},gM={class:"processing-header"},yM={class:"progress-container"},fM={class:"progress-bar"},bM={class:"progress-text"},CM={class:"processing-details"},LM={class:"detail-item"},wM={class:"detail-item"},EM={key:5,class:"completion-section"},RM={class:"completion-actions"},DM={key:6,class:"extraction-section"},IM={class:"extraction-header"},PM={class:"progress-container"},_M={class:"progress-bar"},SM={class:"progress-text"},AM={key:7,class:"policy-review-section"},TM={class:"policy-summary"},xM={class:"summary-card"},FM={class:"summary-content"},VM={class:"summary-card"},MM={class:"summary-content"},XM={class:"review-actions"},UM={key:8,class:"policy-details-section"},NM={class:"dynamic-forms-layout"},$M={class:"form-section framework-form"},OM={class:"form-container"},jM={class:"form-group"},BM={class:"form-group"},WM={class:"form-group"},QM={class:"form-row date-row"},qM={class:"form-group"},KM={class:"form-row date-row"},JM={class:"form-group"},zM={class:"form-group"},HM={class:"form-section policy-form"},YM={class:"section-header"},GM={class:"form-container"},ZM={class:"form-group"},eX=["onUpdate:modelValue"],aX={class:"form-group"},tX=["onUpdate:modelValue"],iX={class:"form-row"},sX={class:"form-group"},oX=["onUpdate:modelValue"],lX={class:"form-group"},nX=["onUpdate:modelValue"],rX={class:"form-group"},cX=["onUpdate:modelValue","placeholder"],dX={class:"form-group"},uX=["onUpdate:modelValue"],pX={class:"form-row"},vX={class:"form-group"},mX=["onUpdate:modelValue"],kX={class:"form-group"},hX=["onUpdate:modelValue"],gX={class:"form-row"},yX={class:"form-group"},fX=["onUpdate:modelValue"],bX={class:"form-group"},CX=["onUpdate:modelValue"],LX={class:"section-header"},wX={class:"policy-count"},EX={class:"form-container"},RX={class:"form-row"},DX={class:"form-group"},IX=["onUpdate:modelValue"],PX={class:"form-group"},_X=["onUpdate:modelValue"],SX={class:"form-group"},AX=["onUpdate:modelValue"],TX={class:"form-row"},xX={class:"form-group"},FX=["onUpdate:modelValue"],VX={class:"form-group"},MX=["onUpdate:modelValue"],XX={class:"form-row"},UX={class:"form-group"},NX=["onUpdate:modelValue"],$X={class:"form-group"},OX=["onUpdate:modelValue"],jX={class:"form-row"},BX={class:"form-group"},WX=["onUpdate:modelValue"],QX={class:"form-group"},qX=["onUpdate:modelValue"],KX={class:"form-row date-row"},JX={class:"form-group"},zX=["onUpdate:modelValue"],HX={class:"form-group"},YX=["onUpdate:modelValue"],GX={class:"form-group"},ZX={class:"file-upload-container"},eU=["id","onChange"],aU=["for"],tU={key:0,class:"file-name"},iU={class:"section-header"},sU={class:"policy-count"},oU=["onClick"],lU={key:0,class:"compliance-container"},nU={class:"compliance-header"},rU={class:"compliance-letter"},cU={class:"compliance-title"},dU=["onClick"],uU={class:"compliance-form-container"},pU={class:"form-row"},vU={class:"form-group"},mU=["onUpdate:modelValue"],kU={class:"form-group"},hU=["onUpdate:modelValue"],gU={class:"form-group"},yU=["onUpdate:modelValue"],fU={class:"form-row"},bU={class:"form-group"},CU=["onUpdate:modelValue"],LU={class:"form-group"},wU=["onUpdate:modelValue"],EU={class:"form-group"},RU={class:"file-upload-container"},DU=["id","onChange"],IU=["for"],PU={key:0,class:"file-name"},_U={class:"form-actions-global"},SU={key:10,class:"congratulations-modal"},AU={class:"congratulations-container"},TU={class:"congratulations-actions"},xU={key:11,class:"global-notification success"},FU={class:"notification-content"},VU={class:"notification-message"},MU={key:12,class:"policy-edit-modal"},XU={class:"policy-edit-container"},UU={class:"policy-edit-header"},NU={class:"policy-edit-actions"},$U={class:"policy-edit-body"},OU={class:"policy-field"},jU={class:"policy-field"},BU={class:"policy-field"},WU={class:"policy-field"},QU={class:"policy-field"},qU={class:"policy-field"},KU={key:13,class:"content-viewer-modal"},JU={class:"content-viewer-container"},zU={class:"content-viewer-header"},HU={class:"content-viewer-body"},YU={class:"search-box"},GU={class:"section-list"},ZU=["onClick"],eN={class:"section-checkbox"},aN=["onUpdate:modelValue","onChange"],tN={key:0,class:"section-content"},iN={class:"subsection-checkbox"},sN=["onUpdate:modelValue","onChange"],oN={class:"content-viewer-footer"},lN={key:14,class:"policy-extractor-modal"},nN={class:"policy-extractor-container"},rN={class:"policy-extractor-header"},cN={class:"policy-actions"},dN={class:"policy-extractor-body"},uN={class:"policy-table-container"},pN={key:0,class:"policy-table"},vN={class:"control-cell"},mN={class:"actions-cell"},kN=["onClick"],hN=["onClick"],gN={key:0,class:"detail-row"},yN={colspan:"5"},fN={class:"policy-details-container"},bN={class:"policy-details-section"},CN={class:"detail-content"},LN={class:"policy-details-section"},wN={class:"detail-content"},EN={class:"policy-details-section"},RN={class:"detail-content control-content"},DN={key:0},IN={key:1},PN={class:"policy-details-section"},_N={class:"detail-content"},SN={class:"policy-details-section"},AN={class:"detail-content"},TN={key:1,class:"no-policies-message"};function xN(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",iM,[(0,s.Lk)("div",sM,[(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:1===o.currentStep,completed:o.currentStep>1}])},a[37]||(a[37]=[(0,s.Lk)("div",{class:"step-number"},"1",-1),(0,s.Lk)("div",{class:"step-label"},"Upload Document",-1)]),2),a[43]||(a[43]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:2===o.currentStep,completed:o.currentStep>2}])},a[38]||(a[38]=[(0,s.Lk)("div",{class:"step-number"},"2",-1),(0,s.Lk)("div",{class:"step-label"},"Processing",-1)]),2),a[44]||(a[44]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:3===o.currentStep,completed:o.currentStep>3}])},a[39]||(a[39]=[(0,s.Lk)("div",{class:"step-number"},"3",-1),(0,s.Lk)("div",{class:"step-label"},"Content Selection",-1)]),2),a[45]||(a[45]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:4===o.currentStep,completed:o.currentStep>4}])},a[40]||(a[40]=[(0,s.Lk)("div",{class:"step-number"},"4",-1),(0,s.Lk)("div",{class:"step-label"},"Policy Extraction",-1)]),2),a[46]||(a[46]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:5===o.currentStep,completed:o.currentStep>5}])},a[41]||(a[41]=[(0,s.Lk)("div",{class:"step-number"},"5",-1),(0,s.Lk)("div",{class:"step-label"},"Review Policies",-1)]),2),a[47]||(a[47]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:6===o.currentStep,completed:o.currentStep>6}])},a[42]||(a[42]=[(0,s.Lk)("div",{class:"step-number"},"6",-1),(0,s.Lk)("div",{class:"step-label"},"Edit Policy Details",-1)]),2)]),o.currentStep>1&&!o.isProcessing?((0,s.uX)(),(0,s.CE)("div",oM,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>o.goBack&&o.goBack(...e)),class:"back-btn"},a[48]||(a[48]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])):(0,s.Q3)("",!0),a[144]||(a[144]=(0,s.Lk)("div",{class:"header"},[(0,s.Lk)("h1",null,"Upload Framework"),(0,s.Lk)("p",null,"Upload framework documents to the system")],-1)),(0,s.Lk)("div",lM,[1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["upload-area",{"drag-over":o.isDragOver}]),onDrop:a[2]||(a[2]=(...e)=>o.handleDrop&&o.handleDrop(...e)),onDragover:a[3]||(a[3]=(0,i.D$)(e=>o.isDragOver=!0,["prevent"])),onDragleave:a[4]||(a[4]=e=>o.isDragOver=!1),onClick:a[5]||(a[5]=(...e)=>o.triggerFileInput&&o.triggerFileInput(...e))},[a[49]||(a[49]=(0,s.Lk)("div",{class:"upload-content"},[(0,s.Lk)("div",{class:"upload-icon-container"},[(0,s.Lk)("i",{class:"fas fa-cloud-upload-alt upload-icon"})]),(0,s.Lk)("h3",null,"Drag & Drop your framework file here"),(0,s.Lk)("p",null,"or click to browse files"),(0,s.Lk)("div",{class:"supported-formats"},[(0,s.Lk)("small",null,"Supported formats: PDF, DOC, DOCX, TXT, XLS, XLSX")])],-1)),(0,s.Lk)("input",{ref:"fileInput",type:"file",onChange:a[1]||(a[1]=(...e)=>o.handleFileSelect&&o.handleFileSelect(...e)),accept:".pdf,.doc,.docx,.txt,.xls,.xlsx",style:{display:"none"}},null,544)],34)):(0,s.Q3)("",!0),1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",nM,a[50]||(a[50]=[(0,s.Lk)("div",{class:"divider-line"},null,-1),(0,s.Lk)("span",{class:"divider-text"},"OR",-1),(0,s.Lk)("div",{class:"divider-line"},null,-1)]))):(0,s.Q3)("",!0),1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",rM,[(0,s.Lk)("div",cM,[a[52]||(a[52]=(0,s.Lk)("div",{class:"default-icon-container"},[(0,s.Lk)("i",{class:"fas fa-database default-icon"})],-1)),a[53]||(a[53]=(0,s.Lk)("h3",null,"Load Default Framework Data",-1)),a[54]||(a[54]=(0,s.Lk)("p",null,"Use pre-loaded NIST framework data for quick testing",-1)),(0,s.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>o.loadDefaultData&&o.loadDefaultData(...e)),disabled:o.isLoadingDefault,class:"load-default-btn"},[a[51]||(a[51]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.isLoadingDefault?"Loading Default Data...":"Load Default Data"),1)],8,dM)])])):(0,s.Q3)("",!0),o.selectedFile&&1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",uM,[(0,s.Lk)("div",pM,[a[56]||(a[56]=(0,s.Lk)("div",{class:"file-icon-container"},[(0,s.Lk)("i",{class:"fas fa-file file-icon"})],-1)),(0,s.Lk)("div",vM,[(0,s.Lk)("h4",null,(0,d.v_)(o.selectedFile.name),1),(0,s.Lk)("p",null,(0,d.v_)(o.formatFileSize(o.selectedFile.size)),1)]),(0,s.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>o.removeFile&&o.removeFile(...e)),class:"remove-btn"},a[55]||(a[55]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",mM,[(0,s.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>o.uploadFile&&o.uploadFile(...e)),disabled:!o.selectedFile||o.isUploading,class:"upload-btn"},[a[57]||(a[57]=(0,s.Lk)("i",{class:"fas fa-upload"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.isUploading?"Uploading...":"Upload Framework"),1)],8,kM)])])):(0,s.Q3)("",!0),2===o.currentStep?((0,s.uX)(),(0,s.CE)("div",hM,[(0,s.Lk)("div",gM,[a[58]||(a[58]=(0,s.Lk)("div",{class:"processing-icon-container"},[(0,s.Lk)("i",{class:"fas fa-cog fa-spin processing-icon"})],-1)),a[59]||(a[59]=(0,s.Lk)("h3",null,"Processing Framework Document",-1)),(0,s.Lk)("p",null,(0,d.v_)(o.processingStatus.message||"Extracting document sections..."),1)]),(0,s.Lk)("div",yM,[(0,s.Lk)("div",fM,[(0,s.Lk)("div",{class:"progress-fill",style:(0,d.Tr)({width:o.processingStatus.progress+"%"})},null,4)]),(0,s.Lk)("div",bM,(0,d.v_)(o.processingStatus.progress||0)+"%",1)]),(0,s.Lk)("div",CM,[(0,s.Lk)("div",LM,[a[60]||(a[60]=(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)),(0,s.Lk)("span",null,"File: "+(0,d.v_)(o.uploadedFileName),1)]),(0,s.Lk)("div",wM,[a[61]||(a[61]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.Lk)("span",null,"Started: "+(0,d.v_)(o.processingStartTime),1)])])])):(0,s.Q3)("",!0),3===o.currentStep?((0,s.uX)(),(0,s.CE)("div",EM,[a[63]||(a[63]=(0,s.Lk)("div",{class:"completion-icon-container"},[(0,s.Lk)("div",{class:"success-circle"},[(0,s.Lk)("i",{class:"fas fa-check"})])],-1)),a[64]||(a[64]=(0,s.Lk)("div",{class:"completion-header"},[(0,s.Lk)("h3",null,"Processing Complete!"),(0,s.Lk)("p",null,"Your framework document has been successfully processed and extracted.")],-1)),(0,s.Lk)("div",RM,[(0,s.Lk)("button",{onClick:a[9]||(a[9]=(...e)=>o.viewExtractedContent&&o.viewExtractedContent(...e)),class:"view-content-btn"},a[62]||(a[62]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View Extracted Content ")]))])])):(0,s.Q3)("",!0),4===o.currentStep?((0,s.uX)(),(0,s.CE)("div",DM,[(0,s.Lk)("div",IM,[a[65]||(a[65]=(0,s.Lk)("div",{class:"extraction-icon-container"},[(0,s.Lk)("i",{class:"fas fa-brain fa-spin extraction-icon"})],-1)),a[66]||(a[66]=(0,s.Lk)("h3",null,"Extracting Policy Information",-1)),(0,s.Lk)("p",null,(0,d.v_)(o.policyExtractionMessage),1)]),(0,s.Lk)("div",PM,[(0,s.Lk)("div",_M,[(0,s.Lk)("div",{class:"progress-fill",style:(0,d.Tr)({width:o.policyExtractionProgress+"%"})},null,4)]),(0,s.Lk)("div",SM,(0,d.v_)(o.policyExtractionProgress||0)+"%",1)]),a[67]||(a[67]=(0,s.Fv)('<div class="extraction-details" data-v-bda8a6cc><div class="detail-item" data-v-bda8a6cc><i class="fas fa-file-alt" data-v-bda8a6cc></i><span data-v-bda8a6cc>Analyzing selected sections...</span></div><div class="detail-item" data-v-bda8a6cc><i class="fas fa-robot" data-v-bda8a6cc></i><span data-v-bda8a6cc>AI Processing in progress</span></div></div>',1))])):(0,s.Q3)("",!0),5===o.currentStep?((0,s.uX)(),(0,s.CE)("div",AM,[a[74]||(a[74]=(0,s.Lk)("div",{class:"review-header"},[(0,s.Lk)("div",{class:"review-icon-container"},[(0,s.Lk)("div",{class:"success-circle"},[(0,s.Lk)("i",{class:"fas fa-check"})])]),(0,s.Lk)("h3",null,"Policy Extraction Complete!"),(0,s.Lk)("p",null,"Your policies have been successfully extracted and are ready for review.")],-1)),(0,s.Lk)("div",TM,[(0,s.Lk)("div",xM,[a[69]||(a[69]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("div",FM,[(0,s.Lk)("h4",null,(0,d.v_)(o.extractedPoliciesCount),1),a[68]||(a[68]=(0,s.Lk)("p",null,"Policies Extracted",-1))])]),(0,s.Lk)("div",VM,[a[71]||(a[71]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-layer-group"})],-1)),(0,s.Lk)("div",MM,[(0,s.Lk)("h4",null,(0,d.v_)(o.selectedSectionsCount),1),a[70]||(a[70]=(0,s.Lk)("p",null,"Sections Processed",-1))])])]),(0,s.Lk)("div",XM,[(0,s.Lk)("button",{onClick:a[10]||(a[10]=(...e)=>o.viewPolicyExtractor&&o.viewPolicyExtractor(...e)),class:"view-policies-btn"},a[72]||(a[72]=[(0,s.Lk)("i",{class:"fas fa-table"},null,-1),(0,s.eW)(" View Extracted Policies ")])),(0,s.Lk)("button",{onClick:a[11]||(a[11]=(...e)=>o.resetUpload&&o.resetUpload(...e)),class:"upload-another-btn"},a[73]||(a[73]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Upload Another Document ")]))])])):(0,s.Q3)("",!0),6===o.currentStep?((0,s.uX)(),(0,s.CE)("div",UM,[a[117]||(a[117]=(0,s.Lk)("div",{class:"details-header"},[(0,s.Lk)("h3",null,"Policy Details & Extracted Content"),(0,s.Lk)("p",null,"Review extracted policies and provide additional information in one place")],-1)),(0,s.Lk)("div",NM,[(0,s.Lk)("div",$M,[a[81]||(a[81]=(0,s.Lk)("div",{class:"section-header"},[(0,s.Lk)("h4",null,"Framework Information")],-1)),(0,s.Lk)("div",OM,[(0,s.Lk)("div",jM,[a[75]||(a[75]=(0,s.Lk)("label",null,"TITLE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[12]||(a[12]=e=>o.policyDetails.title=e),placeholder:"ISO 27001"},null,512),[[i.Jo,o.policyDetails.title]])]),(0,s.Lk)("div",BM,[a[76]||(a[76]=(0,s.Lk)("label",null,"DESCRIPTION:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[13]||(a[13]=e=>o.policyDetails.description=e),placeholder:"Information security, cyber security and privacy protection - Information Security Management Systems"},null,512),[[i.Jo,o.policyDetails.description]])]),(0,s.Lk)("div",WM,[a[77]||(a[77]=(0,s.Lk)("label",null,"CATEGORY:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=e=>o.policyDetails.category=e),placeholder:"Security"},null,512),[[i.Jo,o.policyDetails.category]])]),(0,s.Lk)("div",QM,[(0,s.Lk)("div",qM,[a[78]||(a[78]=(0,s.Lk)("label",null,"EFFECTIVE DATE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[15]||(a[15]=e=>o.policyDetails.effectiveDate=e)},null,512),[[i.Jo,o.policyDetails.effectiveDate]])])]),(0,s.Lk)("div",KM,[(0,s.Lk)("div",JM,[a[79]||(a[79]=(0,s.Lk)("label",null,"START DATE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[16]||(a[16]=e=>o.policyDetails.startDate=e)},null,512),[[i.Jo,o.policyDetails.startDate]])]),(0,s.Lk)("div",zM,[a[80]||(a[80]=(0,s.Lk)("label",null,"END DATE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[17]||(a[17]=e=>o.policyDetails.endDate=e)},null,512),[[i.Jo,o.policyDetails.endDate]])])])])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.uniqueSectionNames,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"section-"+t,class:"policy-section-group"},[(0,s.Lk)("div",HM,[(0,s.Lk)("div",YM,[(0,s.Lk)("h4",null,"Policy "+(0,d.v_)(t+1)+" - "+(0,d.v_)(e),1)]),(0,s.Lk)("div",GM,[(0,s.Lk)("div",ZM,[a[82]||(a[82]=(0,s.Lk)("label",null,"DOCUMENT URL:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].documentUrl=a,placeholder:"https://updated-url.com"},null,8,eX),[[i.Jo,o.policyFormData[e].documentUrl]])]),(0,s.Lk)("div",aX,[a[83]||(a[83]=(0,s.Lk)("label",null,"IDENTIFIER:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].identifier=a,placeholder:"ISO"},null,8,tX),[[i.Jo,o.policyFormData[e].identifier]])]),(0,s.Lk)("div",iX,[(0,s.Lk)("div",sX,[a[84]||(a[84]=(0,s.Lk)("label",null,"CREATED BY:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].createdBy=a,placeholder:"John Doe"},null,8,oX),[[i.Jo,o.policyFormData[e].createdBy]])]),(0,s.Lk)("div",lX,[a[85]||(a[85]=(0,s.Lk)("label",null,"REVIEWER:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].reviewer=a,placeholder:"Jane Smith"},null,8,nX),[[i.Jo,o.policyFormData[e].reviewer]])])]),(0,s.Lk)("div",rX,[a[86]||(a[86]=(0,s.Lk)("label",null,"POLICY NAME:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].policyName=a,placeholder:"Enter policy name for "+e},null,8,cX),[[i.Jo,o.policyFormData[e].policyName]])]),(0,s.Lk)("div",dX,[a[87]||(a[87]=(0,s.Lk)("label",null,"DEPARTMENT:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].department=a,placeholder:"Enter department"},null,8,uX),[[i.Jo,o.policyFormData[e].department]])]),(0,s.Lk)("div",pX,[(0,s.Lk)("div",vX,[a[88]||(a[88]=(0,s.Lk)("label",null,"SCOPE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].scope=a,placeholder:"Enter policy scope"},null,8,mX),[[i.Jo,o.policyFormData[e].scope]])]),(0,s.Lk)("div",kX,[a[89]||(a[89]=(0,s.Lk)("label",null,"APPLICABILITY:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a=>o.policyFormData[e].applicability=a,placeholder:"Enter applicability"},null,8,hX),[[i.Jo,o.policyFormData[e].applicability]])])]),(0,s.Lk)("div",gX,[(0,s.Lk)("div",yX,[a[90]||(a[90]=(0,s.Lk)("label",null,"OBJECTIVE:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>o.policyFormData[e].objective=a,placeholder:"Enter policy objective"},null,8,fX),[[i.Jo,o.policyFormData[e].objective]])]),(0,s.Lk)("div",bX,[a[91]||(a[91]=(0,s.Lk)("label",null,"COVERAGE RATE (%):",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a=>o.policyFormData[e].coverageRate=a,placeholder:"Enter coverage rate",min:"0",max:"100"},null,8,CX),[[i.Jo,o.policyFormData[e].coverageRate]])])])])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies.filter(a=>a.section_name===e),(t,l)=>((0,s.uX)(),(0,s.CE)("div",{key:"subpolicy-"+e+"-"+l,class:"form-section sub-policy-form"},[(0,s.Lk)("div",LX,[(0,s.Lk)("h4",null,"Sub-Policy "+(0,d.v_)(l+1)+" - "+(0,d.v_)(t.Sub_policy_id||"N/A"),1),(0,s.Lk)("div",wX,[(0,s.Lk)("span",null,"Related to: "+(0,d.v_)(e),1)])]),(0,s.Lk)("div",EX,[(0,s.Lk)("div",RX,[(0,s.Lk)("div",DX,[a[92]||(a[92]=(0,s.Lk)("label",null,"POLICY NAME:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.sub_policy_name=e,placeholder:"Enter policy name"},null,8,IX),[[i.Jo,t.sub_policy_name]])]),(0,s.Lk)("div",PX,[a[93]||(a[93]=(0,s.Lk)("label",null,"POLICY IDENTIFIER:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.Sub_policy_id=e,placeholder:"Enter policy identifier"},null,8,_X),[[i.Jo,t.Sub_policy_id]])])]),(0,s.Lk)("div",SX,[a[94]||(a[94]=(0,s.Lk)("label",null,"DESCRIPTION:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e=>t.control=e,placeholder:"Enter policy description",rows:"4"},null,8,AX),[[i.Jo,t.control]])]),(0,s.Lk)("div",TX,[(0,s.Lk)("div",xX,[a[95]||(a[95]=(0,s.Lk)("label",null,"SCOPE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.scope=e,placeholder:"Enter policy scope"},null,8,FX),[[i.Jo,t.scope]])]),(0,s.Lk)("div",VX,[a[96]||(a[96]=(0,s.Lk)("label",null,"DEPARTMENT:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.department=e,placeholder:"Enter department"},null,8,MX),[[i.Jo,t.department]])])]),(0,s.Lk)("div",XX,[(0,s.Lk)("div",UX,[a[97]||(a[97]=(0,s.Lk)("label",null,"OBJECTIVE:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e=>t.objective=e,placeholder:"Enter policy objective",rows:"3"},null,8,NX),[[i.Jo,t.objective]])]),(0,s.Lk)("div",$X,[a[98]||(a[98]=(0,s.Lk)("label",null,"APPLICABILITY:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.applicability=e,placeholder:"Enter applicability"},null,8,OX),[[i.Jo,t.applicability]])])]),(0,s.Lk)("div",jX,[(0,s.Lk)("div",BX,[a[99]||(a[99]=(0,s.Lk)("label",null,"COVERAGE RATE (%):",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":e=>t.coverage_rate=e,placeholder:"Enter coverage rate",min:"0",max:"100"},null,8,WX),[[i.Jo,t.coverage_rate]])]),(0,s.Lk)("div",QX,[a[100]||(a[100]=(0,s.Lk)("label",null,"RELATED CONTROLS:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>t.related_controls=e,placeholder:"Enter related controls"},null,8,qX),[[i.Jo,t.related_controls]])])]),(0,s.Lk)("div",KX,[(0,s.Lk)("div",JX,[a[101]||(a[101]=(0,s.Lk)("label",null,"START DATE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e=>t.start_date=e},null,8,zX),[[i.Jo,t.start_date]])]),(0,s.Lk)("div",HX,[a[102]||(a[102]=(0,s.Lk)("label",null,"END DATE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e=>t.end_date=e},null,8,YX),[[i.Jo,t.end_date]])])]),(0,s.Lk)("div",GX,[a[104]||(a[104]=(0,s.Lk)("label",null,"UPLOAD DOCUMENT:",-1)),(0,s.Lk)("div",ZX,[(0,s.Lk)("input",{type:"file",id:"file-"+e+"-"+l,onChange:e=>o.handleSubPolicyFileUpload(e,o.policies.indexOf(t)),accept:".pdf,.doc,.docx,.txt"},null,40,eU),(0,s.Lk)("label",{for:"file-"+e+"-"+l,class:"file-upload-btn"},a[103]||(a[103]=[(0,s.Lk)("i",{class:"fas fa-upload"},null,-1),(0,s.eW)(" Choose File ")]),8,aU),t.uploaded_file?((0,s.uX)(),(0,s.CE)("span",tU,(0,d.v_)(t.uploaded_file.name),1)):(0,s.Q3)("",!0)])])])]))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies.filter(a=>a.section_name===e),(t,l)=>((0,s.uX)(),(0,s.CE)("div",{key:"compliance-"+e+"-"+l,class:"form-section compliance-form"},[(0,s.Lk)("div",iU,[(0,s.Lk)("h4",null,"Compliance Items for "+(0,d.v_)(t.Sub_policy_id||"Sub-Policy "+(l+1)),1),(0,s.Lk)("div",sU,[(0,s.Lk)("span",null,(0,d.v_)(o.complianceData[`${e}_${t.Sub_policy_id}`]?.length||0)+" compliance items",1)]),(0,s.Lk)("button",{onClick:a=>o.addComplianceItem(`${e}_${t.Sub_policy_id}`),class:"add-compliance-btn"},a[105]||(a[105]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Compliance ")]),8,oU)]),o.complianceData[`${e}_${t.Sub_policy_id}`]?((0,s.uX)(),(0,s.CE)("div",lU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.complianceData[`${e}_${t.Sub_policy_id}`],(n,r)=>((0,s.uX)(),(0,s.CE)("div",{key:"compliance-item-"+r,class:"compliance-item"},[(0,s.Lk)("div",nU,[(0,s.Lk)("div",rU,(0,d.v_)(n.letter)+")",1),(0,s.Lk)("div",cU,"Compliance "+(0,d.v_)(r+1),1),o.complianceData[`${e}_${t.Sub_policy_id}`].length>1?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a=>o.removeComplianceItem(`${e}_${t.Sub_policy_id}`,r),class:"remove-compliance-btn"},a[106]||(a[106]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,dU)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",uU,[(0,s.Lk)("div",pU,[(0,s.Lk)("div",vU,[a[107]||(a[107]=(0,s.Lk)("label",null,"COMPLIANCE NAME:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>n.name=e,placeholder:"Enter compliance name"},null,8,mU),[[i.Jo,n.name]])]),(0,s.Lk)("div",kU,[a[109]||(a[109]=(0,s.Lk)("label",null,"STATUS:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":e=>n.status=e},a[108]||(a[108]=[(0,s.Lk)("option",{value:"pending"},"Pending",-1),(0,s.Lk)("option",{value:"in-progress"},"In Progress",-1),(0,s.Lk)("option",{value:"completed"},"Completed",-1),(0,s.Lk)("option",{value:"not-applicable"},"Not Applicable",-1)]),8,hU),[[i.u1,n.status]])])]),(0,s.Lk)("div",gU,[a[110]||(a[110]=(0,s.Lk)("label",null,"DESCRIPTION:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e=>n.description=e,placeholder:"Enter compliance description",rows:"3"},null,8,yU),[[i.Jo,n.description]])]),(0,s.Lk)("div",fU,[(0,s.Lk)("div",bU,[a[111]||(a[111]=(0,s.Lk)("label",null,"ASSIGNEE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>n.assignee=e,placeholder:"Enter assignee name"},null,8,CU),[[i.Jo,n.assignee]])]),(0,s.Lk)("div",LU,[a[112]||(a[112]=(0,s.Lk)("label",null,"DUE DATE:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e=>n.dueDate=e},null,8,wU),[[i.Jo,n.dueDate]])])]),(0,s.Lk)("div",EU,[a[114]||(a[114]=(0,s.Lk)("label",null,"EVIDENCE DOCUMENT:",-1)),(0,s.Lk)("div",RU,[(0,s.Lk)("input",{type:"file",id:"compliance-file-"+e+"-"+l+"-"+r,onChange:a=>o.handleComplianceFileUpload(a,`${e}_${t.Sub_policy_id}`,r),accept:".pdf,.doc,.docx,.txt,.jpg,.png"},null,40,DU),(0,s.Lk)("label",{for:"compliance-file-"+e+"-"+l+"-"+r,class:"file-upload-btn"},a[113]||(a[113]=[(0,s.Lk)("i",{class:"fas fa-upload"},null,-1),(0,s.eW)(" Upload Evidence ")]),8,IU),n.evidence?((0,s.uX)(),(0,s.CE)("span",PU,(0,d.v_)(n.evidence.name),1)):(0,s.Q3)("",!0)])])])]))),128))])):(0,s.Q3)("",!0)]))),128))]))),128)),(0,s.Lk)("div",_U,[(0,s.Lk)("button",{onClick:a[18]||(a[18]=(...e)=>o.saveAllDetails&&o.saveAllDetails(...e)),class:"save-btn primary-btn"},a[115]||(a[115]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save All Details ")])),(0,s.Lk)("button",{onClick:a[19]||(a[19]=(...e)=>o.resetAllForms&&o.resetAllForms(...e)),class:"reset-btn secondary-btn"},a[116]||(a[116]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset All Forms ")]))])])])):(0,s.Q3)("",!0),o.uploadStatus&&1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",{key:9,class:(0,d.C4)(["status-message",o.uploadStatus.type])},[(0,s.Lk)("i",{class:(0,d.C4)("success"===o.uploadStatus.type?"fas fa-check-circle":"fas fa-exclamation-circle")},null,2),(0,s.eW)(" "+(0,d.v_)(o.uploadStatus.message),1)],2)):(0,s.Q3)("",!0),o.showCongratulationsModal?((0,s.uX)(),(0,s.CE)("div",SU,[(0,s.Lk)("div",AU,[a[119]||(a[119]=(0,s.Fv)('<div class="congratulations-header" data-v-bda8a6cc><div class="congratulations-icon-container" data-v-bda8a6cc><i class="fas fa-check-circle" data-v-bda8a6cc></i></div><h2 data-v-bda8a6cc>Congratulations!</h2><p class="congratulations-message" data-v-bda8a6cc>Your framework has been successfully added to the system.</p></div><div class="congratulations-content" data-v-bda8a6cc><p data-v-bda8a6cc>You have completed all the steps to add a new framework to your GRC system.</p><p data-v-bda8a6cc>Your framework is now ready to be used for compliance management.</p></div>',2)),(0,s.Lk)("div",TU,[(0,s.Lk)("button",{onClick:a[20]||(a[20]=(...e)=>o.goToPolicyDashboard&&o.goToPolicyDashboard(...e)),class:"ok-btn"},a[118]||(a[118]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Go to Policy Dashboard ")]))])])])):(0,s.Q3)("",!0),o.uploadStatus&&"success"===o.uploadStatus.type&&o.currentStep>1?((0,s.uX)(),(0,s.CE)("div",xU,[(0,s.Lk)("div",FU,[a[121]||(a[121]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.Lk)("div",VU,(0,d.v_)(o.uploadStatus.message),1),(0,s.Lk)("button",{onClick:a[21]||(a[21]=e=>o.uploadStatus=null),class:"notification-close"},a[120]||(a[120]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))])])):(0,s.Q3)("",!0),o.showPolicyDetail?((0,s.uX)(),(0,s.CE)("div",MU,[(0,s.Lk)("div",XU,[(0,s.Lk)("div",UU,[a[124]||(a[124]=(0,s.Lk)("h3",null,"Edit Policy",-1)),(0,s.Lk)("div",NU,[(0,s.Lk)("button",{onClick:a[22]||(a[22]=(...e)=>o.savePolicy&&o.savePolicy(...e)),class:"save-btn"},a[122]||(a[122]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save ")])),(0,s.Lk)("button",{onClick:a[23]||(a[23]=(...e)=>o.closePolicyDetail&&o.closePolicyDetail(...e)),class:"close-btn"},a[123]||(a[123]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))])]),(0,s.Lk)("div",$U,[(0,s.Lk)("div",OU,[a[125]||(a[125]=(0,s.Lk)("label",null,"Section",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[24]||(a[24]=e=>o.currentPolicy.section_name=e)},null,512),[[i.Jo,o.currentPolicy.section_name]])]),(0,s.Lk)("div",jU,[a[126]||(a[126]=(0,s.Lk)("label",null,"Control ID",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[25]||(a[25]=e=>o.currentPolicy.Sub_policy_id=e)},null,512),[[i.Jo,o.currentPolicy.Sub_policy_id]])]),(0,s.Lk)("div",BU,[a[127]||(a[127]=(0,s.Lk)("label",null,"Policy Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[26]||(a[26]=e=>o.currentPolicy.sub_policy_name=e)},null,512),[[i.Jo,o.currentPolicy.sub_policy_name]])]),(0,s.Lk)("div",WU,[a[128]||(a[128]=(0,s.Lk)("label",null,"Control",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[27]||(a[27]=e=>o.currentPolicy.control=e),rows:"8"},null,512),[[i.Jo,o.currentPolicy.control]])]),(0,s.Lk)("div",QU,[a[129]||(a[129]=(0,s.Lk)("label",null,"Related Controls",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[28]||(a[28]=e=>o.currentPolicy.related_controls=e)},null,512),[[i.Jo,o.currentPolicy.related_controls]])]),(0,s.Lk)("div",qU,[a[130]||(a[130]=(0,s.Lk)("label",null,"Control Enhancements",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[29]||(a[29]=e=>o.currentPolicy.control_enhancements=e),rows:"5"},null,512),[[i.Jo,o.currentPolicy.control_enhancements]])])])])])):(0,s.Q3)("",!0),o.showContentViewer?((0,s.uX)(),(0,s.CE)("div",KU,[(0,s.Lk)("div",JU,[(0,s.Lk)("div",zU,[a[132]||(a[132]=(0,s.Lk)("h3",null,"Framework Content Viewer",-1)),(0,s.Lk)("button",{onClick:a[30]||(a[30]=(...e)=>o.closeContentViewer&&o.closeContentViewer(...e)),class:"close-btn"},a[131]||(a[131]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",HU,[(0,s.Lk)("div",YU,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[31]||(a[31]=e=>o.searchQuery=e),placeholder:"Search sections..."},null,512),[[i.Jo,o.searchQuery]])]),(0,s.Lk)("div",GU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredSections,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"section-item"},[(0,s.Lk)("div",{class:"section-header",onClick:a=>o.toggleSection(e.id)},[(0,s.Lk)("div",eN,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a=>e.selected=a,onChange:a=>o.updateSelection(e)},null,40,aN),[[i.lH,e.selected]]),(0,s.Lk)("span",null,(0,d.v_)(e.title),1)]),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.expanded?"fa-chevron-down":"fa-chevron-right"])},null,2)],8,ZU),e.expanded?((0,s.uX)(),(0,s.CE)("div",tN,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subsections,(a,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"subsection-item"},[(0,s.Lk)("div",iN,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>a.selected=e,onChange:a=>o.updateSubsectionSelection(e)},null,40,sN),[[i.lH,a.selected]]),(0,s.Lk)("span",null,(0,d.v_)(a.title),1)])]))),128))])):(0,s.Q3)("",!0)]))),128))])]),(0,s.Lk)("div",oN,[(0,s.Lk)("button",{onClick:a[32]||(a[32]=(...e)=>o.selectAllSections&&o.selectAllSections(...e)),class:"select-all-btn"},"Select All"),(0,s.Lk)("button",{onClick:a[33]||(a[33]=(...e)=>o.deselectAllSections&&o.deselectAllSections(...e)),class:"deselect-all-btn"},"Deselect All"),(0,s.Lk)("button",{onClick:a[34]||(a[34]=(...e)=>o.saveSelectedSections&&o.saveSelectedSections(...e)),class:"save-selection-btn"},"Save Selection")])])])):(0,s.Q3)("",!0),o.showPolicyExtractor?((0,s.uX)(),(0,s.CE)("div",lN,[(0,s.Lk)("div",nN,[(0,s.Lk)("div",rN,[a[135]||(a[135]=(0,s.Lk)("h3",null,"Extracted Policies",-1)),(0,s.Lk)("div",cN,[(0,s.Lk)("button",{onClick:a[35]||(a[35]=(...e)=>o.saveAllPolicies&&o.saveAllPolicies(...e)),class:"save-all-btn"},a[133]||(a[133]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save All ")])),(0,s.Lk)("button",{onClick:a[36]||(a[36]=(...e)=>o.closePolicyExtractor&&o.closePolicyExtractor(...e)),class:"close-btn"},a[134]||(a[134]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))])]),(0,s.Lk)("div",dN,[(0,s.Lk)("div",uN,[o.policies.length>0?((0,s.uX)(),(0,s.CE)("table",pN,[a[142]||(a[142]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Section"),(0,s.Lk)("th",null,"Control ID"),(0,s.Lk)("th",null,"Policy Name"),(0,s.Lk)("th",null,"Control"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies,(e,t)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t},[(0,s.Lk)("tr",{class:(0,d.C4)({"expanded-row":o.expandedRows[t]})},[(0,s.Lk)("td",null,(0,d.v_)(e.section_name||"N/A"),1),(0,s.Lk)("td",null,(0,d.v_)(e.Sub_policy_id||"N/A"),1),(0,s.Lk)("td",null,(0,d.v_)(e.sub_policy_name||"N/A"),1),(0,s.Lk)("td",vN,(0,d.v_)(e.control?e.control.length>100?e.control.substring(0,100)+"...":e.control:"N/A"),1),(0,s.Lk)("td",mN,[(0,s.Lk)("button",{onClick:e=>o.toggleExpandRow(t),class:"view-btn"},[(0,s.Lk)("i",{class:(0,d.C4)(o.expandedRows[t]?"fas fa-chevron-up":"fas fa-eye")},null,2),(0,s.eW)(" "+(0,d.v_)(o.expandedRows[t]?"Hide":"View"),1)],8,kN),(0,s.Lk)("button",{onClick:a=>o.editPolicy(e,t),class:"edit-btn"},a[136]||(a[136]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,hN)])],2),o.expandedRows[t]?((0,s.uX)(),(0,s.CE)("tr",gN,[(0,s.Lk)("td",yN,[(0,s.Lk)("div",fN,[(0,s.Lk)("div",bN,[a[137]||(a[137]=(0,s.Lk)("h4",null,"Control ID",-1)),(0,s.Lk)("div",CN,(0,d.v_)(e.Sub_policy_id||"N/A"),1)]),(0,s.Lk)("div",LN,[a[138]||(a[138]=(0,s.Lk)("h4",null,"Policy Name",-1)),(0,s.Lk)("div",wN,(0,d.v_)(e.sub_policy_name||"N/A"),1)]),(0,s.Lk)("div",EN,[a[139]||(a[139]=(0,s.Lk)("h4",null,"Control",-1)),(0,s.Lk)("div",RN,[o.getFormattedControl(e.control).length>0?((0,s.uX)(),(0,s.CE)("div",DN,[(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.getFormattedControl(e.control),(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a},(0,d.v_)(e),1))),128))])])):((0,s.uX)(),(0,s.CE)("div",IN,(0,d.v_)(e.control||"N/A"),1))])]),(0,s.Lk)("div",PN,[a[140]||(a[140]=(0,s.Lk)("h4",null,"Related Controls",-1)),(0,s.Lk)("div",_N,(0,d.v_)(e.related_controls||"N/A"),1)]),(0,s.Lk)("div",SN,[a[141]||(a[141]=(0,s.Lk)("h4",null,"Control Enhancements",-1)),(0,s.Lk)("div",AN,(0,d.v_)(e.control_enhancements||"N/A"),1)])])])])):(0,s.Q3)("",!0)],64))),128))])])):((0,s.uX)(),(0,s.CE)("div",TN,a[143]||(a[143]=[(0,s.Lk)("p",null,"No policies found. Please try processing the document again.",-1)])))])])])])):(0,s.Q3)("",!0)])])}var FN={name:"UploadFramework",setup(){const e=(0,ee.KR)(null),a=(0,ee.KR)(!1),t=(0,ee.KR)(!1),i=(0,ee.KR)(!1),o=(0,ee.KR)(!1),l=(0,ee.KR)(!1),n=(0,ee.KR)(null),r=(0,ee.KR)(null),c=(0,ee.KR)({progress:0,message:""}),d=(0,ee.KR)(null),u=(0,ee.KR)(""),p=(0,ee.KR)("");let v=null;const m=(0,ee.KR)(1),k=(0,ee.KR)([1]),h=(0,ee.KR)(!1),g=(0,ee.KR)([]),y=(0,ee.KR)(""),f=(0,ee.KR)(!1),b=(0,ee.KR)(!1),C=(0,ee.KR)(""),L=(0,ee.KR)(0),w=(0,ee.KR)(!1),E=(0,ee.KR)([]),R=(0,ee.KR)(0),D=(0,ee.KR)(0),I=(0,ee.KR)(!1),P=(0,ee.KR)({}),_=(0,ee.KR)(null),S=(0,ee.KR)(!1),A=(0,ee.KR)({}),T=e=>{A.value={...A.value,[e]:!A.value[e]}},x=e=>e?/^\s*[\d*-]+\s+/.test(e)?e.split("\n").filter(e=>e.trim()).map(e=>e.trim()):e.split(/\.\s+|\.\n/).filter(e=>e.trim()).map(e=>e.trim()+(e.endsWith(".")?"":".")):[],F=(0,s.EW)(()=>{if(!y.value)return g.value;const e=y.value.toLowerCase();return g.value.filter(a=>a.title.toLowerCase().includes(e)||a.subsections.some(a=>a.title.toLowerCase().includes(e)))}),V=(0,s.EW)(()=>{if(!P.value||!P.value.control)return[];const e=P.value.control;return/^\s*[\d*-]+\s+/.test(e)?e.split("\n").filter(e=>e.trim()).map(e=>e.trim()):e.split(/\.\s+|\.\n/).filter(e=>e.trim()).map(e=>e.trim()+(e.endsWith(".")?"":"."))}),M=e=>{e!==m.value&&(k.value.push(m.value),m.value=e)},X=()=>{m.value=Math.max(1,m.value-1)},U=()=>{r.value.click()},N=a=>{const t=a.target.files[0];t&&(e.value=t,n.value=null)},$=t=>{t.preventDefault(),a.value=!1;const i=t.dataTransfer.files[0];i&&(e.value=i,n.value=null)},O=()=>{e.value=null,n.value=null,r.value.value=""},j=e=>{if(0===e)return"0 Bytes";const a=1024,t=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,i)).toFixed(2))+" "+t[i]},B=(e,a=null)=>{d.value=e;let t=0;v=setInterval(async()=>{try{const i=await qe.A.get(`/api/processing-status/${e}/`);void 0!==i.data.progress?c.value=i.data:(t+=15*Math.random()+5,t>95&&(t=95),c.value={progress:Math.floor(t),message:W(Math.floor(t))}),c.value.progress>=100&&(clearInterval(v),o.value=!1,l.value=!0,a?a():(M(3),K(e)))}catch(i){console.error("Error fetching progress:",i),404===i.response?.status&&(clearInterval(v),o.value=!1,n.value={type:"error",message:"Processing task not found or expired"},m.value=1)}},1e3)},W=e=>e<20?"Initializing document processing...":e<40?"Extracting text content...":e<60?"Analyzing document structure...":e<80?"Identifying sections and subsections...":e<95?"Finalizing extraction...":"Processing complete!",Q=async()=>{if(!e.value)return;t.value=!0,n.value=null;const a=new FormData;a.append("file",e.value);try{const e=await qe.A.post("/api/upload-framework/",a,{headers:{"Content-Type":"multipart/form-data"}});u.value=e.data.filename,p.value=(new Date).toLocaleTimeString(),e.data.processing&&e.data.task_id?(o.value=!0,M(2),B(e.data.task_id)):(n.value={type:"success",message:`File "${e.data.filename}" uploaded successfully!`},setTimeout(()=>{O(),n.value=null},3e3))}catch(i){n.value={type:"error",message:i.response?.data?.error||"Upload failed. Please try again."}}finally{t.value=!1}},q=async()=>{i.value=!0,n.value=null;try{const e=await qe.A.post("/api/load-default-data/");if(u.value=e.data.filename,p.value=(new Date).toLocaleTimeString(),e.data.processing&&e.data.task_id){o.value=!0,d.value=e.data.task_id;const a=e.data.has_pre_selected_content,t=e.data.has_pre_extracted_policies;t?(M(5),B(e.data.task_id,()=>{oe()})):a?(M(4),B(e.data.task_id,()=>{b.value=!0,C.value="Starting policy extraction with default selections...",L.value=0,se()})):(M(2),B(e.data.task_id))}else n.value={type:"success",message:`Default data "${e.data.filename}" loaded successfully!`}}catch(e){n.value={type:"error",message:e.response?.data?.error||"Failed to load default data. Please try again."}}finally{i.value=!1}},K=async e=>{try{const a=await qe.A.get(`/api/get-sections/${e}/`);g.value=a.data.map((e,a)=>{const t=e.subsections.filter(e=>e.name.startsWith("txt_chunks/")&&e.name.endsWith(".txt")),i=t.map((e,a)=>({id:a,title:e.name.replace("txt_chunks/extracted_","").replace(".txt","").replace(/_/g," "),originalName:e.name,content:e.content,selected:!1}));return{id:a,title:e.name,selected:!1,expanded:!1,subsections:i}}).filter(e=>e.subsections.length>0)}catch(a){console.error("Error fetching extracted content:",a)}},J=()=>{e.value=null,o.value=!1,i.value=!1,l.value=!1,n.value=null,c.value={progress:0,message:""},d.value=null,u.value="",p.value="",r.value.value="",g.value=[],h.value=!1,f.value=!1,b.value=!1,C.value="",L.value=0,w.value=!1,E.value=[],R.value=0,D.value=0,m.value=1,k.value=[1]},z=()=>{h.value=!0},H=()=>{h.value=!1},Y=e=>{const a=g.value.find(a=>a.id===e);a&&(a.expanded=!a.expanded)},G=e=>{e.subsections.forEach(a=>{a.selected=e.selected})},Z=e=>{e.selected=e.subsections.every(e=>e.selected)},ae=()=>{g.value.forEach(e=>{e.selected=!0,e.subsections.forEach(e=>{e.selected=!0})})},te=()=>{g.value.forEach(e=>{e.selected=!1,e.subsections.forEach(e=>{e.selected=!1})})},ie=async()=>{try{const e=g.value.filter(e=>e.selected||e.subsections.some(e=>e.selected)).map(e=>({name:e.title,subsections:e.subsections.filter(e=>e.selected).map(e=>({name:e.originalName,content:e.content}))})).filter(e=>e.subsections.length>0);if(0===e.length)return void alert("No sections selected. Please select at least one item.");D.value=e.reduce((e,a)=>e+a.subsections.length,0);const a=await qe.A.post("/api/create-checked-structure/",{task_id:d.value,sections:e});200===a.status&&(H(),M(4),b.value=!0,C.value="Initializing policy extraction...",L.value=0,se())}catch(e){console.error("Error saving selected sections:",e),alert("Error saving selected sections: "+e.message)}},se=()=>{let e=setInterval(async()=>{try{const a=await qe.A.get(`/api/policy-extraction-progress/${d.value}/`),t=a.data.progress||0,i=a.data.message||"Processing...";L.value=Math.floor(t),C.value=i,t>=100&&(clearInterval(e),L.value=100,C.value="Policy extraction complete!",setTimeout(async()=>{f.value=!0,b.value=!1,await oe(),M(5)},1e3))}catch(a){console.error("Error checking extraction status:",a);try{const a=await qe.A.get(`/api/processing-status/${d.value}/`);a.data.progress>=100&&(clearInterval(e),L.value=100,C.value="Policy extraction complete!",setTimeout(async()=>{f.value=!0,b.value=!1,await oe(),M(5)},1e3))}catch(t){console.error("Error with fallback status check:",t),b.value=!1,clearInterval(e)}}},2e3)},oe=async()=>{try{const e=await qe.A.get(`/api/get-extracted-policies/${d.value}/`);E.value=e.data.policies||[],R.value=e.data.total_policies||E.value.length,console.log("Fetched policies:",E.value.length),console.log("Policies data:",E.value)}catch(e){console.error("Error fetching policies:",e),E.value=[],R.value=0,404===e.response?.status&&console.log("Policy data not found - extraction may still be in progress")}},le=async()=>{try{const e=await qe.A.get(`/api/extracted-policies/${d.value}/`);e.data.policies&&(E.value=e.data.policies,R.value=e.data.total_policies||E.value.length,ne(),ve.value="extracted",M(6))}catch(e){console.error("Error loading extracted policies:",e),n.value={type:"error",message:"Failed to load extracted policies. Please try again."}}},ne=()=>{De.value={},Ie.value.forEach(e=>{De.value[e]={documentUrl:"",identifier:"",createdBy:"",reviewer:"",policyName:"",department:"",scope:"",applicability:"",objective:"",coverageRate:0}}),console.log("Initialized policy form data:",De.value)},re=()=>{w.value=!1},ce=(e,a)=>{P.value={...e},_.value=a,I.value=!0},de=()=>{S.value=!0},ue=async()=>{try{null!==_.value&&(E.value[_.value]={...P.value});const e=await qe.A.post("/api/save-single-policy/",{policy:P.value,task_id:d.value});200===e.status&&(I.value=!1,n.value={type:"success",message:`Policy "${P.value.Sub_policy_id}" saved successfully! Files updated: ${e.data.original_file} and ${e.data.updated_file}`},setTimeout(()=>{n.value=null},5e3))}catch(e){console.error("Error saving policy:",e),n.value={type:"error",message:e.response?.data?.error||"Failed to save policy. Please try again."}}},pe=async()=>{try{const e=await qe.A.post("/api/save-policies/",{policies:E.value,task_id:d.value,filename:`policies_${d.value}`});200===e.status&&(n.value={type:"success",message:`All policies saved successfully! (${E.value.length} policies)\nFiles updated: ${e.data.original_file} and ${e.data.updated_file}`},setTimeout(()=>{n.value=null},5e3))}catch(e){console.error("Error saving all policies:",e),n.value={type:"error",message:e.response?.data?.error||"Failed to save policies. Please try again."}}};(0,s.hi)(()=>{v&&clearInterval(v)});const ve=(0,ee.KR)("basic"),me=(0,ee.KR)({title:"",description:"",category:"",effectiveDate:"",startDate:"",endDate:""}),ke=async()=>{try{const e=await qe.A.post("/api/save-policy-details/",{task_id:d.value,details:{basic:{title:me.value.title,description:me.value.description,category:me.value.category,effectiveDate:me.value.effectiveDate,startDate:me.value.startDate,endDate:me.value.endDate}}});200===e.status&&(n.value={type:"success",message:"Basic details saved successfully!"},ve.value="additional",setTimeout(()=>{n.value=null},3e3))}catch(e){console.error("Error saving basic details:",e),n.value={type:"error",message:e.response?.data?.error||"Failed to save details. Please try again."}}},he=async()=>{try{const e=await qe.A.post("/api/save-policy-details/",{task_id:d.value,details:{additional:{documentUrl:me.value.documentUrl,identifier:me.value.identifier,createdBy:me.value.createdBy,reviewer:me.value.reviewer,policyName:me.value.policyName,department:me.value.department,scope:me.value.scope,applicability:me.value.applicability,objective:me.value.objective,coverageRate:me.value.coverageRate}}});200===e.status&&(n.value={type:"success",message:"Additional details saved successfully!"},ve.value="extracted",setTimeout(()=>{n.value=null},3e3))}catch(e){console.error("Error saving additional details:",e),n.value={type:"error",message:e.response?.data?.error||"Failed to save details. Please try again."}}},ge=(0,ee.KR)(!1),ye=async()=>{try{const a={task_id:d.value,framework_details:me.value,policy_forms:De.value,sub_policies:E.value,compliance_data:xe.value,unique_sections:Ie.value};console.log("Saving complete package:",a),console.log("Task ID:",d.value),console.log("Framework Details:",me.value),console.log("Policy Forms:",De.value),console.log("Sub Policies:",E.value),console.log("Compliance Data:",xe.value),console.log("Unique Sections:",Ie.value);const t=await qe.A.post("/api/save-complete-policy-package/",a);if(200===t.status){const a=t.data;try{const e=await qe.A.post("/api/save-framework-to-database/",{task_id:d.value});200===e.status?(n.value={type:"success",message:`Framework "${me.value.title}" has been created successfully in the database with ID: ${e.data.framework_id}\n                           Created ${e.data.total_policies} policies, ${e.data.total_sub_policies} sub-policies, and ${e.data.total_compliance_items} compliance items.\n                           Hierarchical JSON: ${a.hierarchical_json_file}\n                           Flat Excel: ${a.flat_excel_file}`},ge.value=!0,setTimeout(()=>{n.value=null},8e3)):n.value={type:"warning",message:`Files saved successfully, but database save failed.\n                           Hierarchical JSON: ${a.hierarchical_json_file}\n                           Flat Excel: ${a.flat_excel_file}`}}catch(e){console.error("Error saving to database:",e),n.value={type:"warning",message:`Files saved successfully, but database save failed: ${e.response?.data?.error||e.message}\n                         Hierarchical JSON: ${a.hierarchical_json_file}\n                         Flat Excel: ${a.flat_excel_file}`}}}}catch(a){console.error("Error saving complete package:",a),console.error("Error response:",a.response?.data),n.value={type:"error",message:a.response?.data?.error||"Failed to save package. Please try again."}}},fe=()=>{ge.value=!1,window.location.href="/policy-dashboard"},be=()=>{"basic"===ve.value?(me.value.title="",me.value.description="",me.value.category="",me.value.effectiveDate="",me.value.startDate="",me.value.endDate=""):"additional"===ve.value&&(me.value.documentUrl="",me.value.identifier="",me.value.createdBy="",me.value.reviewer="",me.value.policyName="",me.value.department="",me.value.scope="",me.value.applicability="",me.value.objective="",me.value.coverageRate=0)},Ce=()=>{I.value=!1,P.value={},_.value=null},Le=()=>{M(6),ve.value="basic"},we=()=>{ve.value="extracted"},Ee=(0,ee.KR)(""),Re=(0,s.EW)(()=>{if(!Ee.value)return E.value;const e=Ee.value.toLowerCase();return E.value.filter(a=>a.Sub_policy_id&&a.Sub_policy_id.toLowerCase().includes(e)||a.sub_policy_name&&a.sub_policy_name.toLowerCase().includes(e)||a.control&&a.control.toLowerCase().includes(e)||a.related_controls&&a.related_controls.toLowerCase().includes(e))}),De=(0,ee.KR)({}),Ie=(0,s.EW)(()=>{if(!E.value||0===E.value.length)return[];const e=[...new Set(E.value.map(e=>e.section_name).filter(e=>e))];return e.sort()}),Pe=()=>{const e={};Ie.value.forEach(a=>{De.value[a]?e[a]=De.value[a]:e[a]={documentUrl:"",identifier:"",createdBy:"",reviewer:"",policyName:"",department:"",scope:"",applicability:"",objective:"",coverageRate:0}}),De.value=e};(0,s.wB)(E,()=>{Pe()},{deep:!0});const _e=(e,a)=>{const t=e.target.files[0];t&&E.value[a]&&(E.value[a].uploaded_file=t)},Se=e=>{const a={section_name:e,Sub_policy_id:"",sub_policy_name:"",control:"",scope:"",department:"",objective:"",applicability:"",coverage_rate:0,related_controls:"",start_date:"",end_date:"",uploaded_file:null};E.value.push(a)},Ae=e=>{E.value.length>1&&E.value.splice(e,1)},Te=()=>{me.value={title:"",description:"",category:"",effectiveDate:"",startDate:"",endDate:""},De.value={},Pe(),E.value.forEach(e=>{e.scope="",e.department="",e.objective="",e.applicability="",e.coverage_rate=0,e.start_date="",e.end_date="",e.uploaded_file=null})},xe=(0,ee.KR)({}),Fe=e=>{if(!e||""===e.trim())return[];const a=/([a-z])[.)](\s*)/gi,t=[];let i;while(null!==(i=a.exec(e)))t.push({letter:i[1].toLowerCase(),index:i.index,matchLength:i[0].length});if(0===t.length)return e.trim().length<5?[]:[{id:"compliance_1",letter:"a",name:e.substring(0,100)+(e.length>100?"...":""),description:e,status:"pending",assignee:"",dueDate:"",evidence:null}];const s=t.map((a,i)=>{const s=a.index+a.matchLength,o=i<t.length-1?t[i+1].index:e.length,l=e.substring(s,o).trim();return l.length<5?null:{id:`compliance_${i+1}`,letter:a.letter,name:l.substring(0,100)+(l.length>100?"...":""),description:l,status:"pending",assignee:"",dueDate:"",evidence:null}}).filter(e=>null!==e);return s},Ve=()=>{const e={};E.value.forEach(a=>{if(!a.control||""===a.control.trim())return;const t=`${a.section_name}_${a.Sub_policy_id}`,i=Fe(a.control);i.length>0&&(e[t]=i)}),xe.value=e},Me=(e,a,t)=>{const i=e.target.files[0];i&&xe.value[a]&&xe.value[a][t]&&(xe.value[a][t].evidence=i)},Xe=e=>{xe.value[e]||(xe.value[e]=[]);const a=xe.value[e].length,t={id:`compliance_${a+1}`,letter:String.fromCharCode(97+a),name:"",description:"",status:"pending",assignee:"",dueDate:"",evidence:null};xe.value[e].push(t)},Ue=(e,a)=>{xe.value[e]&&xe.value[e].length>1&&(xe.value[e].splice(a,1),xe.value[e].forEach((e,a)=>{e.letter=String.fromCharCode(97+a),e.id=`compliance_${a+1}`}))};return(0,s.wB)(E,()=>{E.value.length>0&&Ve()},{immediate:!0}),{selectedFile:e,isDragOver:a,isUploading:t,isLoadingDefault:i,isProcessing:o,processingComplete:l,uploadStatus:n,fileInput:r,processingStatus:c,uploadedFileName:u,processingStartTime:p,showContentViewer:h,sections:g,searchQuery:y,filteredSections:F,policyExtractionComplete:f,policyExtractionInProgress:b,policyExtractionMessage:C,policyExtractionProgress:L,showPolicyExtractor:w,policies:E,extractedPoliciesCount:R,selectedSectionsCount:D,currentStep:m,triggerFileInput:U,handleFileSelect:N,handleDrop:$,removeFile:O,formatFileSize:j,uploadFile:Q,loadDefaultData:q,resetUpload:J,viewExtractedContent:z,closeContentViewer:H,toggleSection:Y,updateSelection:G,updateSubsectionSelection:Z,selectAllSections:ae,deselectAllSections:te,saveSelectedSections:ie,viewPolicyExtractor:le,closePolicyExtractor:re,goBack:X,goToStep:M,showPolicyDetail:I,currentPolicy:P,currentPolicyIndex:_,isEditing:S,formattedControl:V,editPolicy:ce,startEditing:de,savePolicy:ue,saveAllPolicies:pe,expandedRows:A,toggleExpandRow:T,getFormattedControl:x,activeTab:ve,policyDetails:me,saveBasicDetails:ke,saveAdditionalDetails:he,saveAllDetails:ye,cancelEdit:be,closePolicyDetail:Ce,goToEditDetails:Le,resetExtractedForm:we,policySearchQuery:Ee,filteredPolicies:Re,handleSubPolicyFileUpload:_e,addSubPolicy:Se,removeSubPolicy:Ae,resetAllForms:Te,uniqueSectionNames:Ie,policyFormData:De,initializePolicyFormData:Pe,initializeDynamicForms:ne,complianceData:xe,getComplianceItems:Fe,initializeComplianceData:Ve,handleComplianceFileUpload:Me,addComplianceItem:Xe,removeComplianceItem:Ue,showCongratulationsModal:ge,goToPolicyDashboard:fe}}};const VN=(0,se.A)(FN,[["render",xN],["__scopeId","data-v-bda8a6cc"]]);var MN=VN;const XN={class:"incident-form-page incident"},UN={class:"incident-form-box"},NN={class:"incident-title-description-section"},$N={class:"section-header"},ON=["disabled"],jN={class:"title-description-fields"},BN={class:"field-title required"},WN=["aria-invalid"],QN={key:0,class:"validation-error"},qN={class:"field-description required"},KN=["aria-invalid"],JN={key:0,class:"validation-error"},zN={class:"field-third"},HN=["aria-invalid"],YN={key:0,class:"validation-error"},GN={class:"field-third required"},ZN=["aria-invalid"],e$={key:0,class:"validation-error"},a$={class:"field-third required"},t$=["aria-invalid"],i$={key:0,class:"validation-error"},s$={class:"field-third required"},o$=["aria-invalid"],l$={key:0,class:"validation-error"},n$={class:"field-third required"},r$=["aria-invalid"],c$={class:"selected-items"},d$={key:0,class:"placeholder"},u$=["onClick"],p$={key:0,class:"dropdown-panel"},v$={class:"search-box"},m$={class:"options-list"},k$={key:0,class:"no-options"},h$=["onClick"],g$=["checked"],y$={key:0,class:"validation-error"},f$={class:"field-third"},b$=["aria-invalid"],C$={key:0,class:"validation-error"},L$={class:"field-third"},w$=["aria-invalid"],E$={key:0,class:"validation-error"},R$={class:"field-third"},D$={key:0,class:"validation-error"},I$={class:"field-third"},P$={class:"multi-select-dropdown"},_$={class:"selected-items"},S$={key:0,class:"placeholder"},A$=["onClick"],T$={key:0,class:"dropdown-panel"},x$={class:"search-box"},F$={class:"options-list"},V$={key:0,class:"no-options"},M$=["onClick"],X$=["checked"],U$={key:0,class:"validation-error"},N$={class:"field-third"},$$={key:0,class:"validation-error"},O$={class:"field-third"},j$={key:0,class:"validation-error"},B$={class:"field-third"},W$={class:"field-third"},Q$={key:0,class:"validation-error"},q$={class:"field-third"},K$={key:0,class:"validation-error"},J$={class:"field-third"},z$={key:0,class:"validation-error"},H$={class:"field-third"},Y$={key:0,class:"validation-error"},G$={class:"field-third"},Z$={key:0,class:"validation-error"},eO={class:"field-third"},aO={key:0,class:"validation-error"},tO={class:"field-third"},iO={key:0,class:"validation-error"},sO={class:"field-third"},oO={key:0,class:"validation-error"},lO={class:"field-third"},nO={key:0,class:"field-full compliance-mapping-section"},rO={class:"field-full"},cO={key:0,class:"compliance-loading"},dO={key:1,class:"no-compliances-available"},uO={key:2,class:"compliance-dropdown"},pO={key:0,class:"compliance-info"},vO={key:1,class:"compliance-info"},mO={class:"compliance-options-container"},kO=["onClick"],hO={class:"compliance-checkbox"},gO=["id","value","checked","onChange"],yO=["for"],fO={class:"compliance-content"},bO={class:"compliance-header"},CO={class:"compliance-details"},LO={class:"framework-name"},wO={class:"policy-name"},EO={key:0,class:"compliance-mitigation"},RO={key:3,class:"no-compliances"},DO={key:0,class:"selected-compliance"},IO={class:"compliance-card"},PO={class:"compliance-card-header"},_O={class:"compliance-card-body"},SO={key:0},AO={key:1},TO={key:1,class:"incident-status-info"},xO={class:"status-details"},FO={class:"status-item"},VO={key:0,class:"status-item"},MO={class:"value"},XO={key:1,class:"status-item"},UO={key:2,class:"status-item"},NO={class:"incident-form-actions"},$O=["disabled","title"];function OO(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",XN,[a[142]||(a[142]=(0,s.Lk)("div",{class:"incident-form-page-header"},[(0,s.Lk)("h1",{class:"incident-form-page-title"},"Create New Incident")],-1)),(0,s.Lk)("div",UN,[(0,s.Lk)("form",{onSubmit:a[76]||(a[76]=(0,i.D$)((...e)=>o.validateAndSubmit&&o.validateAndSubmit(...e),["prevent"])),class:"incident-create-form"},[(0,s.Lk)("div",NN,[(0,s.Lk)("div",$N,[a[78]||(a[78]=(0,s.Lk)("h3",null,[(0,s.Lk)("i",{class:"fas fa-edit"}),(0,s.eW)("Incident Overview")],-1)),(0,s.Lk)("button",{type:"button",onClick:a[0]||(a[0]=(...e)=>o.generateAnalysis&&o.generateAnalysis(...e)),class:"generate-analysis-btn",disabled:o.isGeneratingAnalysis},a[77]||(a[77]=[(0,s.Lk)("i",{class:"fas fa-magic"},null,-1),(0,s.eW)(" Generate Analysis ")]),8,ON)]),(0,s.Lk)("div",jN,[(0,s.Lk)("label",BN,[a[79]||(a[79]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-heading"}),(0,s.eW)("Incident Title")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.IncidentTitle=e),onInput:a[2]||(a[2]=(...e)=>o.validateIncidentTitle&&o.validateIncidentTitle(...e)),onBlur:a[3]||(a[3]=(...e)=>o.validateIncidentTitle&&o.validateIncidentTitle(...e)),"aria-invalid":!!o.validationErrors.IncidentTitle,class:(0,d.C4)({error:o.validationErrors.IncidentTitle}),required:""},null,42,WN),[[i.Jo,o.formData.IncidentTitle]]),a[80]||(a[80]=(0,s.Lk)("div",{class:"field-helper-tip"}," Provide a clear, concise title that summarizes the incident ",-1)),o.validationErrors.IncidentTitle?((0,s.uX)(),(0,s.CE)("div",QN,(0,d.v_)(o.validationErrors.IncidentTitle),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",qN,[a[81]||(a[81]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-align-left"}),(0,s.eW)("Description")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[4]||(a[4]=e=>o.formData.Description=e),onInput:a[5]||(a[5]=(...e)=>o.validateDescription&&o.validateDescription(...e)),onBlur:a[6]||(a[6]=(...e)=>o.validateDescription&&o.validateDescription(...e)),"aria-invalid":!!o.validationErrors.Description,class:(0,d.C4)({error:o.validationErrors.Description}),required:""},null,42,KN),[[i.Jo,o.formData.Description]]),a[82]||(a[82]=(0,s.Lk)("div",{class:"field-helper-tip"}," Describe what happened in detail: What was the nature of the incident? How was it discovered? What systems or processes were affected? Include timeline if known... ",-1)),o.validationErrors.Description?((0,s.uX)(),(0,s.CE)("div",JN,(0,d.v_)(o.validationErrors.Description),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("label",zN,[a[84]||(a[84]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-tag"}),(0,s.eW)("Origin")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>o.formData.Origin=e),onChange:a[8]||(a[8]=(...e)=>o.validateOrigin&&o.validateOrigin(...e)),"aria-invalid":!!o.validationErrors.Origin,class:(0,d.C4)({error:o.validationErrors.Origin}),title:"Select how this incident was discovered or reported"},a[83]||(a[83]=[(0,s.Lk)("option",{value:""},"Select Origin",-1),(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Audit Finding"},"Audit Finding",-1),(0,s.Lk)("option",{value:"System Generated"},"System Generated",-1)]),42,HN),[[i.u1,o.formData.Origin]]),o.validationErrors.Origin?((0,s.uX)(),(0,s.CE)("div",YN,(0,d.v_)(o.validationErrors.Origin),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",GN,[a[85]||(a[85]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-calendar"}),(0,s.eW)("Date")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[9]||(a[9]=e=>o.formData.Date=e),onInput:a[10]||(a[10]=(...e)=>o.validateDate&&o.validateDate(...e)),onBlur:a[11]||(a[11]=(...e)=>o.validateDate&&o.validateDate(...e)),"aria-invalid":!!o.validationErrors.Date,class:(0,d.C4)({error:o.validationErrors.Date}),title:"Date when the incident occurred or was discovered",required:""},null,42,ZN),[[i.Jo,o.formData.Date]]),o.validationErrors.Date?((0,s.uX)(),(0,s.CE)("div",e$,(0,d.v_)(o.validationErrors.Date),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",a$,[a[86]||(a[86]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-clock"}),(0,s.eW)("Time")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"time","onUpdate:modelValue":a[12]||(a[12]=e=>o.formData.Time=e),onInput:a[13]||(a[13]=(...e)=>o.validateTime&&o.validateTime(...e)),onBlur:a[14]||(a[14]=(...e)=>o.validateTime&&o.validateTime(...e)),"aria-invalid":!!o.validationErrors.Time,class:(0,d.C4)({error:o.validationErrors.Time}),title:"Time when the incident occurred or was discovered",required:""},null,42,t$),[[i.Jo,o.formData.Time]]),o.validationErrors.Time?((0,s.uX)(),(0,s.CE)("div",i$,(0,d.v_)(o.validationErrors.Time),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",s$,[a[88]||(a[88]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)("Risk Priority")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>o.formData.RiskPriority=e),onChange:a[16]||(a[16]=(...e)=>o.validateRiskPriority&&o.validateRiskPriority(...e)),"aria-invalid":!!o.validationErrors.RiskPriority,class:(0,d.C4)({error:o.validationErrors.RiskPriority,"priority-select":!0}),title:"Assess the severity level of this incident",required:""},a[87]||(a[87]=[(0,s.Lk)("option",{value:""},"Select Priority",-1),(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),42,o$),[[i.u1,o.formData.RiskPriority]]),o.validationErrors.RiskPriority?((0,s.uX)(),(0,s.CE)("div",l$,(0,d.v_)(o.validationErrors.RiskPriority),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",n$,[a[90]||(a[90]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)("Risk Category")],-1)),(0,s.Lk)("div",{class:(0,d.C4)(["multi-select-dropdown",{error:o.validationErrors.RiskCategory}])},[(0,s.Lk)("div",{class:(0,d.C4)(["multi-select-input",{error:o.validationErrors.RiskCategory}]),onClick:a[17]||(a[17]=(...e)=>o.toggleCategoryDropdown&&o.toggleCategoryDropdown(...e)),"aria-invalid":!!o.validationErrors.RiskCategory},[(0,s.Lk)("div",c$,[0===o.selectedCategories.length?((0,s.uX)(),(0,s.CE)("span",d$," Select categories or type to add new... ")):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.selectedCategories,e=>((0,s.uX)(),(0,s.CE)("span",{key:e,class:"selected-item"},[(0,s.eW)((0,d.v_)(e)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:(0,i.D$)(a=>o.removeCategory(e),["stop"])},null,8,u$)]))),128))]),(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-chevron-down dropdown-arrow",{rotated:o.showCategoryDropdown}])},null,2)],10,r$),o.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",p$,[(0,s.Lk)("div",v$,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=e=>o.categorySearchTerm=e),onInput:a[19]||(a[19]=(...e)=>o.filterCategories&&o.filterCategories(...e)),onKeydown:a[20]||(a[20]=(0,i.jR)((0,i.D$)((...e)=>o.addCustomCategory&&o.addCustomCategory(...e),["prevent"]),["enter"])),placeholder:"Search categories or type new...",class:"search-input"},null,544),[[i.Jo,o.categorySearchTerm]]),o.categorySearchTerm&&!o.availableCategories.includes(o.categorySearchTerm)?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:a[21]||(a[21]=(0,i.D$)((...e)=>o.addCustomCategory&&o.addCustomCategory(...e),["stop"])),class:"add-new-btn"},[a[89]||(a[89]=(0,s.Lk)("i",{class:"fas fa-plus"},null,-1)),(0,s.eW)(' Add "'+(0,d.v_)(o.categorySearchTerm)+'" ',1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",m$,[0!==o.filteredCategories.length||o.categorySearchTerm?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",k$," No categories available ")),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"option-item",onClick:a=>o.toggleCategory(e)},[(0,s.Lk)("input",{type:"checkbox",checked:o.selectedCategories.includes(e)},null,8,g$),(0,s.Lk)("span",null,(0,d.v_)(e),1)],8,h$))),128))])])):(0,s.Q3)("",!0)],2),o.validationErrors.RiskCategory?((0,s.uX)(),(0,s.CE)("div",y$,(0,d.v_)(o.validationErrors.RiskCategory),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",f$,[a[92]||(a[92]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-radiation-alt"}),(0,s.eW)("Criticality")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[22]||(a[22]=e=>o.formData.Criticality=e),onChange:a[23]||(a[23]=(...e)=>o.validateCriticality&&o.validateCriticality(...e)),"aria-invalid":!!o.validationErrors.Criticality,class:(0,d.C4)({error:o.validationErrors.Criticality}),title:"Rate the overall criticality level of this incident"},a[91]||(a[91]=[(0,s.Fv)('<option value="">Select Criticality</option><option value="Critical">Critical</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option>',5)]),42,b$),[[i.u1,o.formData.Criticality]]),o.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("div",C$,(0,d.v_)(o.validationErrors.Criticality),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",L$,[a[93]||(a[93]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-dollar-sign"}),(0,s.eW)("Cost of Incident")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[24]||(a[24]=e=>o.formData.CostOfIncident=e),onInput:a[25]||(a[25]=(...e)=>o.validateCost&&o.validateCost(...e)),onBlur:a[26]||(a[26]=(...e)=>o.validateCost&&o.validateCost(...e)),"aria-invalid":!!o.validationErrors.CostOfIncident,class:(0,d.C4)({error:o.validationErrors.CostOfIncident})},null,42,w$),[[i.Jo,o.formData.CostOfIncident]]),a[94]||(a[94]=(0,s.Lk)("div",{class:"field-helper-tip"}," Estimate the financial impact or cost of this incident (e.g., $50,000, â‚¬25,000.50, 100000) ",-1)),o.validationErrors.CostOfIncident?((0,s.uX)(),(0,s.CE)("div",E$,(0,d.v_)(o.validationErrors.CostOfIncident),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",R$,[a[95]||(a[95]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)("Possible Damage")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[27]||(a[27]=e=>o.formData.PossibleDamage=e),onInput:a[28]||(a[28]=(...e)=>o.validatePossibleDamage&&o.validatePossibleDamage(...e)),onBlur:a[29]||(a[29]=(...e)=>o.validatePossibleDamage&&o.validatePossibleDamage(...e))},null,544),[[i.Jo,o.formData.PossibleDamage]]),a[96]||(a[96]=(0,s.Lk)("div",{class:"field-helper-tip"}," Describe potential damage that could result from this incident (e.g., Data loss, customer trust impact, regulatory fines, business disruption, reputation damage...) ",-1)),o.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",D$,(0,d.v_)(o.validationErrors.PossibleDamage),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",I$,[a[98]||(a[98]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)("Business Unit")],-1)),(0,s.Lk)("div",P$,[(0,s.Lk)("div",{class:"multi-select-input",onClick:a[30]||(a[30]=(...e)=>o.toggleBusinessUnitDropdown&&o.toggleBusinessUnitDropdown(...e))},[(0,s.Lk)("div",_$,[0===o.selectedBusinessUnits.length?((0,s.uX)(),(0,s.CE)("span",S$," Select business units or type to add new... ")):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.selectedBusinessUnits,e=>((0,s.uX)(),(0,s.CE)("span",{key:e,class:"selected-item"},[(0,s.eW)((0,d.v_)(e)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:(0,i.D$)(a=>o.removeBusinessUnit(e),["stop"])},null,8,A$)]))),128))]),(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-chevron-down dropdown-arrow",{rotated:o.showBusinessUnitDropdown}])},null,2)]),o.showBusinessUnitDropdown?((0,s.uX)(),(0,s.CE)("div",T$,[(0,s.Lk)("div",x$,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[31]||(a[31]=e=>o.businessUnitSearchTerm=e),onInput:a[32]||(a[32]=(...e)=>o.filterBusinessUnits&&o.filterBusinessUnits(...e)),onKeydown:a[33]||(a[33]=(0,i.jR)((0,i.D$)((...e)=>o.addCustomBusinessUnit&&o.addCustomBusinessUnit(...e),["prevent"]),["enter"])),placeholder:"Search business units or type new...",class:"search-input"},null,544),[[i.Jo,o.businessUnitSearchTerm]]),o.businessUnitSearchTerm&&!o.availableBusinessUnits.includes(o.businessUnitSearchTerm)?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:a[34]||(a[34]=(0,i.D$)((...e)=>o.addCustomBusinessUnit&&o.addCustomBusinessUnit(...e),["stop"])),class:"add-new-btn"},[a[97]||(a[97]=(0,s.Lk)("i",{class:"fas fa-plus"},null,-1)),(0,s.eW)(' Add "'+(0,d.v_)(o.businessUnitSearchTerm)+'" ',1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",F$,[0!==o.filteredBusinessUnits.length||o.businessUnitSearchTerm?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",V$," No business units available ")),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredBusinessUnits,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"option-item",onClick:a=>o.toggleBusinessUnit(e)},[(0,s.Lk)("input",{type:"checkbox",checked:o.selectedBusinessUnits.includes(e)},null,8,X$),(0,s.Lk)("span",null,(0,d.v_)(e),1)],8,M$))),128))])])):(0,s.Q3)("",!0)]),o.validationErrors.AffectedBusinessUnit?((0,s.uX)(),(0,s.CE)("div",U$,(0,d.v_)(o.validationErrors.AffectedBusinessUnit),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",N$,[a[99]||(a[99]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-map-marker-alt"}),(0,s.eW)("Location")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[35]||(a[35]=e=>o.formData.GeographicLocation=e),onInput:a[36]||(a[36]=(...e)=>o.validateGeographicLocation&&o.validateGeographicLocation(...e)),onBlur:a[37]||(a[37]=(...e)=>o.validateGeographicLocation&&o.validateGeographicLocation(...e))},null,544),[[i.Jo,o.formData.GeographicLocation]]),a[100]||(a[100]=(0,s.Lk)("div",{class:"field-helper-tip"}," Specify the geographic location where the incident occurred (e.g., New York Office, London Branch, Remote/Cloud, Data Center - Dallas...) ",-1)),o.validationErrors.GeographicLocation?((0,s.uX)(),(0,s.CE)("div",$$,(0,d.v_)(o.validationErrors.GeographicLocation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",O$,[a[101]||(a[101]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-server"}),(0,s.eW)("Systems Involved")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[38]||(a[38]=e=>o.formData.SystemsAssetsInvolved=e),onInput:a[39]||(a[39]=(...e)=>o.validateSystemsInvolved&&o.validateSystemsInvolved(...e)),onBlur:a[40]||(a[40]=(...e)=>o.validateSystemsInvolved&&o.validateSystemsInvolved(...e))},null,544),[[i.Jo,o.formData.SystemsAssetsInvolved]]),a[102]||(a[102]=(0,s.Lk)("div",{class:"field-helper-tip"}," List the systems, applications, or assets involved in the incident (e.g., Customer CRM, Payment Gateway, Email Server, Database XYZ, Network Infrastructure...) ",-1)),o.validationErrors.SystemsAssetsInvolved?((0,s.uX)(),(0,s.CE)("div",j$,(0,d.v_)(o.validationErrors.SystemsAssetsInvolved),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",B$,[a[104]||(a[104]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-tags"}),(0,s.eW)("Incident Classification")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[41]||(a[41]=e=>o.formData.IncidentClassification=e),onChange:a[42]||(a[42]=(...e)=>o.onClassificationChange&&o.onClassificationChange(...e)),title:"Classify the type of incident for proper handling and escalation"},a[103]||(a[103]=[(0,s.Fv)('<option value="">Select Classification</option><option value="NonConformance">NonConformance</option><option value="Control GAP">Control GAP</option><option value="Risk">Risk</option><option value="Issue">No Issue</option>',5)]),544),[[i.u1,o.formData.IncidentClassification]])]),(0,s.Lk)("label",W$,[a[105]||(a[105]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)("Initial Impact Assessment")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[43]||(a[43]=e=>o.formData.InitialImpactAssessment=e),onInput:a[44]||(a[44]=(...e)=>o.validateInitialImpact&&o.validateInitialImpact(...e)),onBlur:a[45]||(a[45]=(...e)=>o.validateInitialImpact&&o.validateInitialImpact(...e))},null,544),[[i.Jo,o.formData.InitialImpactAssessment]]),a[106]||(a[106]=(0,s.Lk)("div",{class:"field-helper-tip"}," Describe the immediate and potential impacts: operational disruption, customer impact, data exposure, service availability, compliance implications... ",-1)),o.validationErrors.InitialImpactAssessment?((0,s.uX)(),(0,s.CE)("div",Q$,(0,d.v_)(o.validationErrors.InitialImpactAssessment),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",q$,[a[107]||(a[107]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)("Mitigation Steps")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[46]||(a[46]=e=>o.formData.Mitigation=e),onInput:a[47]||(a[47]=(...e)=>o.validateMitigation&&o.validateMitigation(...e)),onBlur:a[48]||(a[48]=(...e)=>o.validateMitigation&&o.validateMitigation(...e))},null,544),[[i.Jo,o.formData.Mitigation]]),a[108]||(a[108]=(0,s.Lk)("div",{class:"field-helper-tip"}," Detail the immediate actions taken and planned mitigation steps: containment measures, system isolation, patches applied, temporary workarounds... ",-1)),o.validationErrors.Mitigation?((0,s.uX)(),(0,s.CE)("div",K$,(0,d.v_)(o.validationErrors.Mitigation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",J$,[a[109]||(a[109]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-comments"}),(0,s.eW)("Comments")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[49]||(a[49]=e=>o.formData.Comments=e),onInput:a[50]||(a[50]=(...e)=>o.validateComments&&o.validateComments(...e)),onBlur:a[51]||(a[51]=(...e)=>o.validateComments&&o.validateComments(...e))},null,544),[[i.Jo,o.formData.Comments]]),a[110]||(a[110]=(0,s.Lk)("div",{class:"field-helper-tip"}," Additional observations, context, or relevant information not covered elsewhere... ",-1)),o.validationErrors.Comments?((0,s.uX)(),(0,s.CE)("div",z$,(0,d.v_)(o.validationErrors.Comments),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",H$,[a[111]||(a[111]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-users"}),(0,s.eW)("Internal Contacts")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[52]||(a[52]=e=>o.formData.InternalContacts=e),onInput:a[53]||(a[53]=(...e)=>o.validateInternalContacts&&o.validateInternalContacts(...e)),onBlur:a[54]||(a[54]=(...e)=>o.validateInternalContacts&&o.validateInternalContacts(...e))},null,544),[[i.Jo,o.formData.InternalContacts]]),a[112]||(a[112]=(0,s.Lk)("div",{class:"field-helper-tip"}," Names and roles of internal staff involved (e.g., John Smith (IT Manager), Sarah Jones (Security Lead)...) ",-1)),o.validationErrors.InternalContacts?((0,s.uX)(),(0,s.CE)("div",Y$,(0,d.v_)(o.validationErrors.InternalContacts),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",G$,[a[113]||(a[113]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)("External Parties")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[55]||(a[55]=e=>o.formData.ExternalPartiesInvolved=e),onInput:a[56]||(a[56]=(...e)=>o.validateExternalParties&&o.validateExternalParties(...e)),onBlur:a[57]||(a[57]=(...e)=>o.validateExternalParties&&o.validateExternalParties(...e))},null,544),[[i.Jo,o.formData.ExternalPartiesInvolved]]),a[114]||(a[114]=(0,s.Lk)("div",{class:"field-helper-tip"}," External organizations, vendors, customers, or partners affected (e.g., ABC Vendor, Customer Portal Users, Third-party Service Provider...) ",-1)),o.validationErrors.ExternalPartiesInvolved?((0,s.uX)(),(0,s.CE)("div",Z$,(0,d.v_)(o.validationErrors.ExternalPartiesInvolved),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",eO,[a[115]||(a[115]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-gavel"}),(0,s.eW)("Regulatory Bodies")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[58]||(a[58]=e=>o.formData.RegulatoryBodies=e),onInput:a[59]||(a[59]=(...e)=>o.validateRegulatoryBodies&&o.validateRegulatoryBodies(...e)),onBlur:a[60]||(a[60]=(...e)=>o.validateRegulatoryBodies&&o.validateRegulatoryBodies(...e))},null,544),[[i.Jo,o.formData.RegulatoryBodies]]),a[116]||(a[116]=(0,s.Lk)("div",{class:"field-helper-tip"}," Relevant regulatory authorities (e.g., SEC, GDPR Authority, FINRA, HIPAA, PCI DSS Council...) ",-1)),o.validationErrors.RegulatoryBodies?((0,s.uX)(),(0,s.CE)("div",aO,(0,d.v_)(o.validationErrors.RegulatoryBodies),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",tO,[a[117]||(a[117]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)("Violated Policies/Procedures")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[61]||(a[61]=e=>o.formData.RelevantPoliciesProceduresViolated=e),onInput:a[62]||(a[62]=(...e)=>o.validateViolatedPolicies&&o.validateViolatedPolicies(...e)),onBlur:a[63]||(a[63]=(...e)=>o.validateViolatedPolicies&&o.validateViolatedPolicies(...e))},null,544),[[i.Jo,o.formData.RelevantPoliciesProceduresViolated]]),a[118]||(a[118]=(0,s.Lk)("div",{class:"field-helper-tip"}," List specific policies, procedures, or standards that were violated (e.g., Data Protection Policy section 3.2, Access Control Procedure, Change Management Process...) ",-1)),o.validationErrors.RelevantPoliciesProceduresViolated?((0,s.uX)(),(0,s.CE)("div",iO,(0,d.v_)(o.validationErrors.RelevantPoliciesProceduresViolated),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",sO,[a[119]||(a[119]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-times-circle"}),(0,s.eW)("Control Failures")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[64]||(a[64]=e=>o.formData.ControlFailures=e),onInput:a[65]||(a[65]=(...e)=>o.validateControlFailures&&o.validateControlFailures(...e)),onBlur:a[66]||(a[66]=(...e)=>o.validateControlFailures&&o.validateControlFailures(...e))},null,544),[[i.Jo,o.formData.ControlFailures]]),a[120]||(a[120]=(0,s.Lk)("div",{class:"field-helper-tip"}," Identify failed controls (e.g., firewall misconfiguration, inadequate access controls, missing monitoring, failed backup procedures...) ",-1)),o.validationErrors.ControlFailures?((0,s.uX)(),(0,s.CE)("div",oO,(0,d.v_)(o.validationErrors.ControlFailures),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",lO,[a[121]||(a[121]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-lightbulb"}),(0,s.eW)("Lessons Learned")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[67]||(a[67]=e=>o.formData.LessonsLearned=e),title:"Document key insights and lessons learned from this incident for future prevention"},null,512),[[i.Jo,o.formData.LessonsLearned]]),a[122]||(a[122]=(0,s.Lk)("div",{class:"field-helper-tip"}," What can be learned from this incident? What should be done differently next time? What processes need improvement? What preventive measures can be implemented... ",-1))]),o.showComplianceMapping?((0,s.uX)(),(0,s.CE)("div",nO,[(0,s.Lk)("label",rO,[a[127]||(a[127]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-link"}),(0,s.eW)("Map to Existing Compliance")],-1)),(0,s.Lk)("div",{class:"compliance-selector",onClick:a[73]||(a[73]=(0,i.D$)(()=>{},["stop"]))},[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[68]||(a[68]=e=>o.complianceSearchTerm=e),placeholder:"Search compliances by description, policy name, or framework...",onInput:a[69]||(a[69]=(...e)=>o.filterCompliances&&o.filterCompliances(...e)),onFocus:a[70]||(a[70]=e=>o.showDropdown=!0),onBlur:a[71]||(a[71]=(...e)=>o.hideDropdownDelayed&&o.hideDropdownDelayed(...e)),class:"compliance-search",title:"Search and select a compliance requirement to link with this incident"},null,544),[[i.Jo,o.complianceSearchTerm]]),o.loadingCompliances?((0,s.uX)(),(0,s.CE)("div",cO,a[123]||(a[123]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading compliances... ")]))):0===o.compliances.length?((0,s.uX)(),(0,s.CE)("div",dO,a[124]||(a[124]=[(0,s.Lk)("div",{class:"external-risk-message"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.Lk)("div",null,[(0,s.Lk)("strong",null,"No Compliances Available"),(0,s.Lk)("p",null,[(0,s.eW)("This incident will be saved as an "),(0,s.Lk)("strong",null,"External Risk"),(0,s.eW)(" since no compliance items are available in the system.")])])],-1)]))):o.showDropdown&&o.filteredCompliances.length>0?((0,s.uX)(),(0,s.CE)("div",uO,[o.complianceSearchTerm?((0,s.uX)(),(0,s.CE)("div",vO,[(0,s.Lk)("small",null,[a[126]||(a[126]=(0,s.Lk)("i",{class:"fas fa-search"},null,-1)),(0,s.eW)(" Found "+(0,d.v_)(o.filteredCompliances.length)+' compliance(s) matching "'+(0,d.v_)(o.complianceSearchTerm)+'"',1)])])):((0,s.uX)(),(0,s.CE)("div",pO,[(0,s.Lk)("small",null,[a[125]||(a[125]=(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1)),(0,s.eW)(" Showing "+(0,d.v_)(o.filteredCompliances.length)+" total compliances. Use search to filter results.",1)])])),(0,s.Lk)("div",mO,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,onClick:a=>o.selectCompliance(e),class:(0,d.C4)(["compliance-option",{selected:o.formData.ComplianceId===e.ComplianceId}])},[(0,s.Lk)("div",hO,[(0,s.Lk)("input",{type:"radio",id:"compliance-"+e.ComplianceId,value:e.ComplianceId,checked:o.formData.ComplianceId===e.ComplianceId,onClick:a[72]||(a[72]=(0,i.D$)(()=>{},["stop"])),onChange:a=>o.selectCompliance(e)},null,40,gO),(0,s.Lk)("label",{for:"compliance-"+e.ComplianceId,class:"radio-label"},null,8,yO)]),(0,s.Lk)("div",fO,[(0,s.Lk)("div",bO,[(0,s.Lk)("strong",null,(0,d.v_)(e.ComplianceItemDescription),1),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality","criticality-"+(e.Criticality||"medium").toLowerCase()])},(0,d.v_)(e.Criticality),3)]),(0,s.Lk)("div",CO,[(0,s.Lk)("span",LO,(0,d.v_)(e.SubPolicy?.Policy?.Framework?.FrameworkName||"No Framework"),1),(0,s.Lk)("span",wO,(0,d.v_)(e.SubPolicy?.Policy?.PolicyName||"No Policy"),1)]),e.Mitigation&&"string"===typeof e.Mitigation?((0,s.uX)(),(0,s.CE)("div",EO,[(0,s.Lk)("small",null,(0,d.v_)(o.safeSubstring(e.Mitigation,100)),1)])):(0,s.Q3)("",!0)])],10,kO))),128))])])):!o.loadingCompliances&&o.complianceSearchTerm&&o.showDropdown?((0,s.uX)(),(0,s.CE)("div",RO,' No compliances found matching "'+(0,d.v_)(o.complianceSearchTerm)+'" ',1)):(0,s.Q3)("",!0)])]),o.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",DO,[a[134]||(a[134]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-check-circle"}),(0,s.eW)(" Selected Compliance")],-1)),(0,s.Lk)("div",IO,[(0,s.Lk)("div",PO,[(0,s.Lk)("strong",null,(0,d.v_)(o.selectedCompliance.ComplianceItemDescription),1),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality","criticality-"+(o.selectedCompliance.Criticality||"medium").toLowerCase()])},(0,d.v_)(o.selectedCompliance.Criticality),3)]),(0,s.Lk)("div",_O,[(0,s.Lk)("p",null,[a[128]||(a[128]=(0,s.Lk)("strong",null,"Framework:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.SubPolicy?.Policy?.Framework?.FrameworkName||"N/A"),1)]),(0,s.Lk)("p",null,[a[129]||(a[129]=(0,s.Lk)("strong",null,"Policy:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.SubPolicy?.Policy?.PolicyName||"N/A"),1)]),(0,s.Lk)("p",null,[a[130]||(a[130]=(0,s.Lk)("strong",null,"Sub Policy:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.SubPolicy?.SubPolicyName||"N/A"),1)]),o.selectedCompliance.Mitigation&&"string"===typeof o.selectedCompliance.Mitigation?((0,s.uX)(),(0,s.CE)("p",SO,[a[131]||(a[131]=(0,s.Lk)("strong",null,"Mitigation:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.Mitigation),1)])):(0,s.Q3)("",!0),o.selectedCompliance.PossibleDamage&&"string"===typeof o.selectedCompliance.PossibleDamage?((0,s.uX)(),(0,s.CE)("p",AO,[a[132]||(a[132]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.PossibleDamage),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{type:"button",onClick:a[74]||(a[74]=(...e)=>o.clearCompliance&&o.clearCompliance(...e)),class:"clear-compliance-btn"},a[133]||(a[133]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Clear Selection ")]))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),o.showComplianceMapping?((0,s.uX)(),(0,s.CE)("div",TO,[a[139]||(a[139]=(0,s.Lk)("div",{class:"status-header"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("strong",null,"Incident Information")],-1)),(0,s.Lk)("div",xO,[(0,s.Lk)("div",FO,[a[135]||(a[135]=(0,s.Lk)("span",{class:"label"},"Type:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["value","incident-type-"+o.incidentType.toLowerCase().replace(/[^a-z]/g,"-")])},(0,d.v_)(o.incidentType),3)]),o.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",VO,[a[136]||(a[136]=(0,s.Lk)("span",{class:"label"},"Linked Compliance:",-1)),(0,s.Lk)("span",MO,(0,d.v_)(o.selectedCompliance.ComplianceItemDescription),1)])):o.showComplianceMapping&&0===o.compliances.length?((0,s.uX)(),(0,s.CE)("div",XO,a[137]||(a[137]=[(0,s.Lk)("span",{class:"label"},"Note:",-1),(0,s.Lk)("span",{class:"value warning"},"No compliance items available - saving as external risk",-1)]))):o.showComplianceMapping?((0,s.uX)(),(0,s.CE)("div",UO,a[138]||(a[138]=[(0,s.Lk)("span",{class:"label"},"Note:",-1),(0,s.Lk)("span",{class:"value"},"No compliance selected - will save as external risk",-1)]))):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",NO,[(0,s.Lk)("button",{type:"button",onClick:a[75]||(a[75]=(...e)=>o.cancel&&o.cancel(...e)),class:"incident-cancel-btn"},a[140]||(a[140]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Cancel ")])),(0,s.Lk)("button",{type:"submit",class:"incident-submit-btn",disabled:!o.isReadyToSubmit,title:o.isReadyToSubmit?`Create ${o.incidentType}`:"Please fill in all required fields"},[a[141]||(a[141]=(0,s.Lk)("i",{class:"fas fa-save"},null,-1)),(0,s.eW)(" Create "+(0,d.v_)(o.incidentType),1)],8,$O)])],32)]),(0,s.bF)(r)])}var jO={name:"CreateIncident",components:{PopupModal:pv.wA},setup(){const e=(0,ae.rd)(),a=(0,ee.KR)({IncidentTitle:"",Description:"",Mitigation:"",Date:"",Time:"",Origin:"",Comments:"",RiskCategory:"",RiskPriority:"",Status:"Open",AffectedBusinessUnit:"",SystemsAssetsInvolved:"",GeographicLocation:"",Criticality:"",TimelineOfEvents:"",InitialImpactAssessment:"",InternalContacts:"",ExternalPartiesInvolved:"",RegulatoryBodies:"",RelevantPoliciesProceduresViolated:"",ControlFailures:"",LessonsLearned:"",CostOfIncident:"",PossibleDamage:"",RepeatedNot:!1,ReopenedNot:!1,IncidentClassification:"",ComplianceId:null}),t=(0,ee.KR)({}),i=(0,ee.KR)(!1),o=(0,ee.KR)([]),l=(0,ee.KR)(""),n=(0,ee.KR)(null),r=(0,ee.KR)(!1),c=(0,ee.KR)(!1),d=(0,ee.KR)([]),u=(0,ee.KR)([]),p=(0,ee.KR)(""),v=(0,ee.KR)(!1),m=(0,ee.KR)([]),k=(0,ee.KR)([]),h=(0,ee.KR)([]),g=(0,ee.KR)(""),y=(0,ee.KR)(!1),f=(0,ee.KR)([]),b=(e,a=100)=>e&&"string"===typeof e?e.length>a?e.substring(0,a)+"...":e:"",C=(0,s.EW)(()=>"NonConformance"===a.value.IncidentClassification||"Control GAP"===a.value.IncidentClassification),L=(0,s.EW)(()=>l.value?o.value.filter(e=>{const a=l.value.toLowerCase();return e.ComplianceItemDescription&&"string"===typeof e.ComplianceItemDescription&&e.ComplianceItemDescription.toLowerCase().includes(a)||e.Identifier&&"string"===typeof e.Identifier&&e.Identifier.toLowerCase().includes(a)||e.SubPolicy?.Policy?.PolicyName&&"string"===typeof e.SubPolicy.Policy.PolicyName&&e.SubPolicy.Policy.PolicyName.toLowerCase().includes(a)||e.SubPolicy?.Policy?.Framework?.FrameworkName&&"string"===typeof e.SubPolicy.Policy.Framework.FrameworkName&&e.SubPolicy.Policy.Framework.FrameworkName.toLowerCase().includes(a)}):o.value),w=(0,s.EW)(()=>C.value?0===o.value.length?"External Risk":n.value?"Compliance-Linked Incident":"External Risk":"Regular Incident"),E=(0,s.EW)(()=>{const e=a.value.IncidentTitle&&a.value.Description&&a.value.Date&&a.value.Time&&a.value.RiskPriority&&u.value.length>0,i=0===Object.keys(t.value).length,s=e&&i;return s||(console.log("=== FORM NOT READY - DEBUG INFO ==="),console.log("Missing required fields:",{IncidentTitle:!a.value.IncidentTitle,Description:!a.value.Description,Date:!a.value.Date,Time:!a.value.Time,RiskPriority:!a.value.RiskPriority,Categories:0===u.value.length}),console.log("Validation errors:",t.value),console.log("Has required fields:",e),console.log("Has no errors:",i)),s}),R=/^[a-zA-Z0-9\s\-_.,!?():;/\\@#$%&*+=<>[\]{}|~`"']*$/,D=/^[a-zA-Z0-9\s\-_.,!?()]*$/,I=/^[a-zA-Z0-9\s\-_.,!?()&]*$/,P=/^[$Â£â‚¬]?[0-9]+(\.[0-9]{1,2})?$/,_=(e,a,t={})=>{const{required:i=!1,minLength:s=0,maxLength:o=255,pattern:l=null}=t;if(i&&(!e||""===e.trim()))return`${a} is required`;if(!i&&(!e||""===e.trim()))return null;const n=e.trim();return n.length<s?`${a} must be at least ${s} characters`:n.length>o?`${a} must be no more than ${o} characters`:l&&!l.test(n)?`${a} contains invalid characters`:null},S=()=>{const e=a.value.CostOfIncident;e&&!P.test(e.toString().trim())?t.value.CostOfIncident="Must be a valid currency amount (e.g., $100.50, 250.75)":delete t.value.CostOfIncident},A=()=>{const e=_(a.value.IncidentTitle,"Incident Title",{required:!0,minLength:3,maxLength:255,pattern:R});e?t.value.IncidentTitle=e:delete t.value.IncidentTitle},T=()=>{const e=_(a.value.Description,"Description",{required:!0,minLength:10,maxLength:2e3,pattern:R});e?t.value.Description=e:delete t.value.Description},x=()=>{const e=["Manual","Audit Finding","System Generated"];a.value.Origin?e.includes(a.value.Origin)?delete t.value.Origin:t.value.Origin="Must be one of: Manual, Audit Finding, System Generated":delete t.value.Origin},F=()=>{a.value.Date?delete t.value.Date:t.value.Date="Date is required"},V=()=>{a.value.Time?delete t.value.Time:t.value.Time="Time is required"},M=()=>{const e=["High","Medium","Low"];a.value.RiskPriority?e.includes(a.value.RiskPriority)?delete t.value.RiskPriority:t.value.RiskPriority="Must be one of: High, Medium, Low":t.value.RiskPriority="Risk priority is required"},X=()=>{if(0===u.value.length)t.value.RiskCategory="At least one risk category is required";else{const e=u.value.filter(e=>{const a=e&&e.length<=100&&I.test(e);return!a});e.length>0?t.value.RiskCategory="One or more categories contain invalid characters or are too long":delete t.value.RiskCategory}},U=()=>{const e=["Critical","High","Medium","Low"];a.value.Criticality&&!e.includes(a.value.Criticality)?t.value.Criticality="Must be one of: Critical, High, Medium, Low":delete t.value.Criticality},N=()=>{const e=_(a.value.PossibleDamage,"Possible Damage",{maxLength:1e3,pattern:R});e?t.value.PossibleDamage=e:delete t.value.PossibleDamage},$=()=>{if(h.value.length>0){const e=h.value.filter(e=>!e||e.length>100||!D.test(e));e.length>0?t.value.AffectedBusinessUnit="One or more business units contain invalid characters or are too long":delete t.value.AffectedBusinessUnit}else delete t.value.AffectedBusinessUnit},O=()=>{const e=_(a.value.GeographicLocation,"Geographic Location",{maxLength:100,pattern:D});e?t.value.GeographicLocation=e:delete t.value.GeographicLocation},j=()=>{const e=_(a.value.SystemsAssetsInvolved,"Systems Involved",{maxLength:500,pattern:R});e?t.value.SystemsAssetsInvolved=e:delete t.value.SystemsAssetsInvolved},B=()=>{const e=_(a.value.InitialImpactAssessment,"Initial Impact Assessment",{maxLength:2e3,pattern:R});e?t.value.InitialImpactAssessment=e:delete t.value.InitialImpactAssessment},W=()=>{const e=_(a.value.Mitigation,"Mitigation Steps",{maxLength:2e3,pattern:R});e?t.value.Mitigation=e:delete t.value.Mitigation},Q=()=>{const e=_(a.value.Comments,"Comments",{maxLength:1e3,pattern:R});e?t.value.Comments=e:delete t.value.Comments},q=()=>{const e=_(a.value.InternalContacts,"Internal Contacts",{maxLength:500,pattern:R});e?t.value.InternalContacts=e:delete t.value.InternalContacts},K=()=>{const e=_(a.value.ExternalPartiesInvolved,"External Parties",{maxLength:500,pattern:R});e?t.value.ExternalPartiesInvolved=e:delete t.value.ExternalPartiesInvolved},J=()=>{const e=_(a.value.RegulatoryBodies,"Regulatory Bodies",{maxLength:500,pattern:R});e?t.value.RegulatoryBodies=e:delete t.value.RegulatoryBodies},z=()=>{const e=_(a.value.RelevantPoliciesProceduresViolated,"Violated Policies/Procedures",{maxLength:1e3,pattern:R});e?t.value.RelevantPoliciesProceduresViolated=e:delete t.value.RelevantPoliciesProceduresViolated},H=()=>{const e=_(a.value.ControlFailures,"Control Failures",{maxLength:1e3,pattern:R});e?t.value.ControlFailures=e:delete t.value.ControlFailures},Y=()=>{t.value={};const e=["IncidentTitle","Description","IncidentType","IncidentOrigin","DetectedBy","ReportedBy","DateDetected","DateReported"];let i=!0;for(const s of e)a.value[s]&&("string"!==typeof a.value[s]||a.value[s].trim())||(t.value[s]=`${s.replace(/([A-Z])/g," $1").trim()} is required`,i=!1);return i},G=()=>{console.log("Validation errors:",t.value),Object.entries(t.value).forEach(([e,a])=>{console.log(`${e}: ${a}`)})},Z=async()=>{if(!(o.value.length>0)){r.value=!0;try{const e=await qe.A.get("/api/incident-compliances/");if(e.data.success){o.value=e.data.data,console.log("Loaded compliances:",o.value.length);const a=o.value.filter(e=>e.Mitigation&&"string"!==typeof e.Mitigation||e.PossibleDamage&&"string"!==typeof e.PossibleDamage||e.ComplianceItemDescription&&"string"!==typeof e.ComplianceItemDescription);a.length>0&&console.warn("Found compliances with invalid data types:",a)}else console.error("Failed to fetch compliances:",e.data.message)}catch(e){console.error("Error fetching compliances:",e),ht.wr.handleApiError(e,"view compliances")||pv.OQ.error("Failed to load compliances. Please try again.")}finally{r.value=!1}}},te=()=>{C.value?(Z(),c.value=!1):(a.value.ComplianceId=null,n.value=null,l.value="",c.value=!1)},ie=e=>{a.value.ComplianceId=e.ComplianceId,n.value=e,l.value="",c.value=!1,!a.value.PossibleDamage&&e.PossibleDamage&&"string"===typeof e.PossibleDamage&&(a.value.PossibleDamage=e.PossibleDamage),!a.value.Mitigation&&e.Mitigation&&"string"===typeof e.Mitigation&&(a.value.Mitigation=e.Mitigation),!a.value.Criticality&&e.Criticality&&"string"===typeof e.Criticality&&(a.value.Criticality=e.Criticality),console.log("Selected compliance:",e.ComplianceId,e.ComplianceItemDescription),console.log("Dropdown closed after selection")},se=()=>{a.value.ComplianceId=null,n.value=null,l.value="",c.value=!1,console.log("Compliance selection cleared")},oe=()=>{l.value.length>0&&(c.value=!0)},le=()=>{setTimeout(()=>{c.value=!1},150)},ne=async()=>{if(console.log("=== SUBMIT ATTEMPT ==="),!Y())return console.log("Form validation failed"),G(),void pv.OQ.error("Please correct the validation errors before submitting. Check the console for details.");console.log("Form validation passed, submitting..."),await re()},re=async()=>{try{const t={...a.value};n.value&&a.value.ComplianceId?console.log("Compliance selected:",n.value.ComplianceItemDescription):(t.ComplianceId=null,console.log("No compliance selected - saving as external risk")),console.log("Submitting incident with data:",t);const i=await qe.A.post("/api/incidents/create/",t);201===i.status&&(pv.OQ.success("Incident created successfully! It has been saved to the incidents table and will be escalated to risk management when needed."),setTimeout(()=>{e.push("/incident/incident")},2e3))}catch(i){if(console.error("Error creating incident:",i),!ht.wr.handleApiError(i,"create incidents"))if(i.response&&i.response.data){const e=i.response.data;Object.keys(e).forEach(a=>{t.value[a]=Array.isArray(e[a])?e[a][0]:e[a]}),pv.OQ.error("Please correct the validation errors and try again.")}else pv.OQ.error("Error creating incident. Please try again.")}},ce=()=>{e.push("/incident/incident")},de=async()=>{if(a.value.IncidentTitle&&a.value.Description)if(a.value.IncidentTitle.trim().length<3)pv.OQ.error("Incident title must be at least 3 characters long.");else if(a.value.Description.trim().length<10)pv.OQ.error("Incident description must be at least 10 characters long.");else{i.value=!0;try{pv.OQ.info("Generating analysis... This may take a few moments.");const e=await qe.A.post("api/incidents/generate-analysis/",{title:a.value.IncidentTitle.trim(),description:a.value.Description.trim()},{timeout:6e4});if(!e.data.success||!e.data.analysis)throw new Error(e.data.error||"Analysis failed");{const i=e.data.analysis;if(console.log("Analysis received:",i),i.riskPriority){const e={P0:"High",P1:"High",P2:"Medium",P3:"Low"};a.value.RiskPriority=e[i.riskPriority]||i.riskPriority}if(i.criticality&&(a.value.Criticality=i.criticality),i.costOfIncident&&(a.value.CostOfIncident=i.costOfIncident),i.possibleDamage&&(a.value.PossibleDamage=i.possibleDamage),i.systemsInvolved&&Array.isArray(i.systemsInvolved)&&(a.value.SystemsAssetsInvolved=i.systemsInvolved.join(", ")),i.initialImpactAssessment&&(a.value.InitialImpactAssessment=i.initialImpactAssessment),i.mitigationSteps&&Array.isArray(i.mitigationSteps)&&(a.value.Mitigation=i.mitigationSteps.join("\n")),i.comments&&(a.value.Comments=i.comments),i.violatedPolicies&&Array.isArray(i.violatedPolicies)&&(a.value.RelevantPoliciesProceduresViolated=i.violatedPolicies.join("\n")),i.procedureControlFailures&&Array.isArray(i.procedureControlFailures)&&(a.value.ControlFailures=i.procedureControlFailures.join("\n")),i.lessonsLearned&&Array.isArray(i.lessonsLearned)&&(a.value.LessonsLearned=i.lessonsLearned.join("\n")),i.riskCategory||i.category){const e=i.riskCategory||i.category;if(u.value=[],"string"===typeof e){const a=e.split(/[,;|&]/).map(e=>e.trim()).filter(e=>e.length>0);for(const e of a)d.value.some(a=>a.toLowerCase()===e.toLowerCase())||d.value.push(e),u.value.includes(e)||u.value.push(e);ge()}}Object.keys(t.value).forEach(e=>{a.value[e]&&a.value[e].toString().trim()&&delete t.value[e]}),pv.OQ.success("Analysis completed! Form fields have been populated with AI-generated insights. Please review and modify as needed before saving.")}}catch(e){if(console.error("Error generating analysis:",e),!ht.wr.handleApiError(e,"generate incident analysis")){let a="Failed to generate analysis. ";"ECONNABORTED"===e.code?a+="Request timed out. The server took too long to respond. Please try again or fill the form manually.":e.response&&e.response.data&&e.response.data.error?a+=e.response.data.error:e.message?a+=e.message:a+="Please try again or fill the form manually.",pv.OQ.error(a)}}finally{i.value=!1}}else pv.OQ.error("Please enter both incident title and description before generating analysis.")},ue=async()=>{try{const e=await qe.A.get("/api/categories/");d.value=e.data,m.value=e.data}catch(e){console.error("Error fetching categories:",e),ht.wr.handleApiError(e,"view categories")||pv.OQ.error("Failed to load categories. Please try again.")}},pe=()=>{v.value=!v.value,v.value&&(m.value=d.value)},ve=()=>{const e=p.value.toLowerCase();m.value=d.value.filter(a=>a.toLowerCase().includes(e))},me=e=>{u.value.includes(e)?u.value=u.value.filter(a=>a!==e):u.value.push(e),ge()},ke=e=>{u.value=u.value.filter(a=>a!==e),ge()},he=async()=>{const e=p.value.trim();if(console.log("Adding custom category:",e),e&&!d.value.some(a=>a.toLowerCase()===e.toLowerCase()))try{console.log("Posting new category to API:",e);const a=await qe.A.post("/api/categories/add/",{value:e});console.log("API response:",a.data);const i=a.data.value||e;d.value.includes(i)||(d.value.push(i),console.log("Added to available categories:",i)),u.value.includes(i)||(u.value.push(i),console.log("Added to selected categories:",i)),p.value="",m.value=d.value,ge(),setTimeout(()=>{u.value.length>0&&(delete t.value.RiskCategory,console.log("Force cleared RiskCategory validation error"))},100),pv.OQ.success(`Category "${i}" added successfully!`)}catch(a){console.error("Error adding category:",a),ht.wr.handleApiError(a,"add categories")||pv.OQ.error("Failed to add category. Please try again.")}else if(e&&d.value.some(a=>a.toLowerCase()===e.toLowerCase())){const a=d.value.find(a=>a.toLowerCase()===e.toLowerCase());console.log("Category already exists, selecting:",a),u.value.includes(a)||(u.value.push(a),ge()),p.value=""}else e?console.log("Category already selected:",e):console.log("Empty category name provided")},ge=()=>{a.value.RiskCategory=u.value.join(", "),X()},ye=async()=>{try{const e=await qe.A.get("/api/business-units/");k.value=e.data,f.value=e.data}catch(e){console.error("Error fetching business units:",e),ht.wr.handleApiError(e,"view business units")||pv.OQ.error("Failed to load business units. Please try again.")}},fe=()=>{y.value=!y.value,y.value&&(f.value=k.value)},be=()=>{const e=g.value.toLowerCase();f.value=k.value.filter(a=>a.toLowerCase().includes(e))},Ce=e=>{h.value.includes(e)?h.value=h.value.filter(a=>a!==e):h.value.push(e),Ee()},Le=e=>{h.value=h.value.filter(a=>a!==e),Ee()},we=async()=>{const e=g.value.trim();if(console.log("Adding custom business unit:",e),e&&!k.value.some(a=>a.toLowerCase()===e.toLowerCase()))try{console.log("Posting new business unit to API:",e);const a=await qe.A.post("/api/business-units/add/",{value:e});console.log("API response:",a.data);const i=a.data.value||e;k.value.includes(i)||(k.value.push(i),console.log("Added to available business units:",i)),h.value.includes(i)||(h.value.push(i),console.log("Added to selected business units:",i)),g.value="",f.value=k.value,Ee(),setTimeout(()=>{delete t.value.AffectedBusinessUnit,console.log("Force cleared AffectedBusinessUnit validation error")},100),pv.OQ.success(`Business unit "${i}" added successfully!`)}catch(a){console.error("Error adding business unit:",a),ht.wr.handleApiError(a,"add business units")||pv.OQ.error("Failed to add business unit. Please try again.")}else if(e&&k.value.some(a=>a.toLowerCase()===e.toLowerCase())){const a=k.value.find(a=>a.toLowerCase()===e.toLowerCase());console.log("Business unit already exists, selecting:",a),h.value.includes(a)||(h.value.push(a),Ee()),g.value=""}else e?console.log("Business unit already selected:",e):console.log("Empty business unit name provided")},Ee=()=>{a.value.AffectedBusinessUnit=h.value.join(", "),$()},Re=()=>{a.value.RiskCategory&&(u.value=a.value.RiskCategory.split(", ").filter(e=>e.trim())),a.value.AffectedBusinessUnit&&(h.value=a.value.AffectedBusinessUnit.split(", ").filter(e=>e.trim()))};return(0,s.sV)(()=>{ue(),ye(),Re();const e=e=>{const a=document.querySelector(".compliance-selector"),t=document.querySelector(".multi-select-dropdown");a&&!a.contains(e.target)&&(c.value=!1),t&&!e.target.closest(".multi-select-dropdown")&&(v.value=!1,y.value=!1)};document.addEventListener("click",e),(0,s.hi)(()=>{document.removeEventListener("click",e)})}),{formData:a,validationErrors:t,compliances:o,complianceSearchTerm:l,selectedCompliance:n,loadingCompliances:r,showDropdown:c,showComplianceMapping:C,filteredCompliances:L,availableCategories:d,selectedCategories:u,categorySearchTerm:p,showCategoryDropdown:v,filteredCategories:m,availableBusinessUnits:k,selectedBusinessUnits:h,businessUnitSearchTerm:g,showBusinessUnitDropdown:y,filteredBusinessUnits:f,safeSubstring:b,onClassificationChange:te,selectCompliance:ie,clearCompliance:se,filterCompliances:oe,hideDropdownDelayed:le,isGeneratingAnalysis:i,fetchCategories:ue,toggleCategoryDropdown:pe,filterCategories:ve,toggleCategory:me,removeCategory:ke,addCustomCategory:he,updateFormDataCategories:ge,fetchBusinessUnits:ye,toggleBusinessUnitDropdown:fe,filterBusinessUnits:be,toggleBusinessUnit:Ce,removeBusinessUnit:Le,addCustomBusinessUnit:we,updateFormDataBusinessUnits:Ee,initializeSelectedData:Re,validateCost:S,validateIncidentTitle:A,validateDescription:T,validateOrigin:x,validateDate:F,validateTime:V,validateRiskPriority:M,validateRiskCategory:X,validateCriticality:U,validatePossibleDamage:N,validateBusinessUnit:$,validateGeographicLocation:O,validateSystemsInvolved:j,validateInitialImpact:B,validateMitigation:W,validateComments:Q,validateInternalContacts:q,validateExternalParties:K,validateRegulatoryBodies:J,validateViolatedPolicies:z,validateControlFailures:H,validateAndSubmit:ne,submitForm:re,cancel:ce,generateAnalysis:de,incidentType:w,isReadyToSubmit:E}}};const BO=(0,se.A)(jO,[["render",OO]]);var WO=BO;const QO={class:"incident-dashboard-wrapper"},qO={class:"kpi-row"},KO={class:"kpi-card"},JO={class:"kpi-value"},zO={class:"unit"},HO={class:"kpi-chart"},YO={class:"line-chart"},GO={viewBox:"0 0 300 60",preserveAspectRatio:"none"},ZO=["d"],ej=["cx","cy"],aj=["cx","cy","onMouseover"],tj={key:0,class:"tooltip-content"},ij={class:"tooltip-header"},sj={class:"tooltip-value"},oj={class:"tooltip-details"},lj={class:"tooltip-count"},nj={key:0},rj={key:1},cj={key:2,class:"tooltip-no-data"},dj={key:0,class:"tooltip-incidents-list"},uj={class:"tooltip-incident-title"},pj={class:"tooltip-incident-time"},vj={key:0,class:"tooltip-more"},mj={class:"chart-months"},kj={class:"kpi-card"},hj={class:"kpi-value"},gj={class:"unit"},yj={class:"kpi-chart"},fj={class:"line-chart"},bj={viewBox:"0 0 300 60",preserveAspectRatio:"none"},Cj=["d"],Lj=["cx","cy"],wj=["cx","cy","onMouseover"],Ej={class:"chart-months"},Rj={class:"kpi-card"},Dj={class:"kpi-value"},Ij={class:"unit"},Pj={class:"kpi-chart"},_j={class:"line-chart"},Sj={viewBox:"0 0 300 60",preserveAspectRatio:"none"},Aj=["d"],Tj=["cx","cy"],xj=["cx","cy","onMouseover"],Fj={class:"chart-months"},Vj={class:"kpi-row"},Mj={class:"kpi-card expanded-card"},Xj={class:"kpi-value"},Uj={class:"unit"},Nj={class:"kpi-card expanded-card"},$j={class:"kpi-value"},Oj={class:"unit"},jj={class:"kpi-chart"},Bj={class:"line-chart"},Wj={viewBox:"0 0 300 60",preserveAspectRatio:"none"},Qj=["d"],qj=["cx","cy"],Kj=["cx","cy","onMouseover"],Jj={class:"chart-months"},zj={class:"kpi-row"},Hj={class:"kpi-card"},Yj={class:"kpi-value"},Gj={class:"kpi-chart"},Zj={class:"bar-chart vertical"},eB={class:"tooltip"},aB={key:0,class:"tooltip-incidents"},tB={key:0},iB={key:0},sB={class:"kpi-card"},oB={class:"kpi-value"},lB={class:"kpi-chart"},nB={class:"progress-bar"},rB={class:"chart-values"},cB={class:"kpi-card"},dB={class:"kpi-value"},uB={class:"unit"},pB={class:"kpi-chart"},vB={class:"progress-bar"},mB={class:"kpi-row"},kB={class:"kpi-card"},hB={class:"kpi-value"},gB={class:"unit"},yB={class:"kpi-chart"},fB={class:"donut-chart"},bB={class:"kpi-card"},CB={class:"kpi-value"},LB={class:"unit"},wB={class:"kpi-chart"},EB={class:"progress-bar"},RB={class:"kpi-card"},DB={class:"kpi-value"},IB={class:"cost-breakdown"},PB={class:"kpi-row"},_B={class:"kpi-card expanded-card"},SB={class:"kpi-chart pie-chart-container"},AB={viewBox:"0 0 100 100",class:"pie-chart-svg",style:{width:"80px",height:"80px"}},TB=["stroke-dasharray"],xB=["stroke-dasharray","stroke-dashoffset"],FB=["stroke-dasharray","stroke-dashoffset"],VB={key:0,class:"pie-tooltip-content"},MB={class:"pie-tooltip-header"},XB={class:"pie-tooltip-value"},UB={class:"pie-tooltip-count"},NB={class:"chart-legend"},$B={class:"legend-item"},OB={class:"legend-item"},jB={class:"legend-item"},BB={class:"kpi-card expanded-card"},WB={class:"kpi-chart small-donut-container",id:"origin-chart-container"},QB={viewBox:"0 0 100 100",class:"donut-chart-svg",style:{width:"60px",height:"60px"}},qB=["stroke","stroke-dasharray","stroke-dashoffset","onMouseover"],KB={x:"50",y:"56","text-anchor":"middle","font-size":"8","font-weight":"bold"},JB={key:0,class:"origin-tooltip-content"},zB={class:"origin-tooltip-header"},HB={class:"origin-tooltip-value"},YB={class:"origin-tooltip-count"},GB={class:"chart-legend"},ZB={class:"legend-text"},eW={class:"kpi-row"},aW={class:"kpi-card root-cause-card"},tW={class:"kpi-chart bar-chart-container"},iW={class:"horizontal-bar-chart"},sW={class:"h-bar-label"},oW={class:"h-bar-track"},lW=["onMouseover"],nW={class:"h-bar-value"},rW={key:0,class:"root-cause-tooltip-content"},cW={class:"root-cause-tooltip-header"},dW={class:"root-cause-tooltip-value"},uW={class:"root-cause-tooltip-count"},pW={class:"kpi-card threat-types-card"},vW={class:"kpi-chart bar-chart-container"},mW={class:"vertical-bar-chart"},kW={class:"v-bar-label"},hW={class:"v-bar-value"},gW={key:1,class:"no-data-message"},yW={class:"kpi-row"},fW={class:"kpi-card incident-volume-card"},bW={class:"kpi-value"},CW={class:"trend-chart"},LW={width:"100%",height:"80",viewBox:"0 0 400 80",preserveAspectRatio:"none"},wW=["d"],EW={class:"trend-labels"},RW={class:"kpi-card escalation-rate-card"},DW={class:"kpi-value"},IW={class:"kpi-chart stacked-bar-container"},PW={class:"stacked-bar"},_W={class:"stacked-bar-legend"},SW={class:"legend-item"},AW={class:"legend-label"},TW={class:"legend-item"},xW={class:"legend-label"},FW={key:0,class:"stacked-tooltip-content"},VW={class:"tooltip-header"},MW={class:"tooltip-value"},XW={class:"kpi-card repeat-rate-card"},UW={class:"kpi-value"},NW={class:"kpi-chart donut-chart-container"},$W={class:"donut-chart repeat-donut"},OW={class:"donut-hole"},jW={class:"donut-hole-text"},BW={class:"chart-legend"},WW={class:"legend-item"},QW={class:"legend-item"};function qW(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",QO,[(0,s.Lk)("div",qO,[(0,s.Lk)("div",KO,[a[20]||(a[20]=(0,s.Lk)("h3",null,"Mean Time to Detect (MTTD)",-1)),(0,s.Lk)("div",JO,[(0,s.eW)((0,d.v_)(o.kpiData.mttd.value),1),(0,s.Lk)("span",zO,(0,d.v_)(o.kpiData.mttd.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.mttd.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.mttd.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.mttd.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",HO,[(0,s.Lk)("div",YO,[((0,s.uX)(),(0,s.CE)("svg",GO,[o.kpiData.mttd.trend&&o.kpiData.mttd.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.mttd.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,ZO)):(0,s.Q3)("",!0),o.kpiData.mttd.trend&&o.kpiData.mttd.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.mttd.trend.map(e=>e.minutes)),(e,t)=>((0,s.uX)(),(0,s.CE)("g",{key:"mttd-point-"+t,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,ej),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.mttd.trend[t]),onMouseout:a[0]||(a[0]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,aj)]))),128)):(0,s.Q3)("",!0)])),(0,s.Lk)("div",{id:"chart-tooltip",class:"chart-tooltip",style:(0,d.Tr)(o.tooltipStyle)},[o.activeTooltip?((0,s.uX)(),(0,s.CE)("div",tj,[(0,s.Lk)("div",ij,(0,d.v_)(o.activeTooltip.month),1),(0,s.Lk)("div",sj,(0,d.v_)(o.activeTooltip.minutes)+" "+(0,d.v_)(o.kpiData.mttd.unit),1),(0,s.Lk)("div",oj,[(0,s.Lk)("div",lj,[a[16]||(a[16]=(0,s.Lk)("strong",null,"Incidents:",-1)),(0,s.eW)(" "+(0,d.v_)(o.activeTooltip.count||0),1)]),o.activeTooltip.fastest&&o.activeTooltip.count>0?((0,s.uX)(),(0,s.CE)("div",nj,[a[17]||(a[17]=(0,s.Lk)("strong",null,"Fastest:",-1)),(0,s.eW)(" "+(0,d.v_)(o.activeTooltip.fastest)+" "+(0,d.v_)(o.kpiData.mttd.unit),1)])):(0,s.Q3)("",!0),o.activeTooltip.slowest&&o.activeTooltip.count>0?((0,s.uX)(),(0,s.CE)("div",rj,[a[18]||(a[18]=(0,s.Lk)("strong",null,"Slowest:",-1)),(0,s.eW)(" "+(0,d.v_)(o.activeTooltip.slowest)+" "+(0,d.v_)(o.kpiData.mttd.unit),1)])):(0,s.Q3)("",!0),o.activeTooltip.count&&0!==o.activeTooltip.count?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",cj,"No incidents in this period"))]),o.activeTooltip.details&&o.activeTooltip.details.length>0?((0,s.uX)(),(0,s.CE)("div",dj,[a[19]||(a[19]=(0,s.Lk)("div",{class:"tooltip-list-header"},"Recent incidents:",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.activeTooltip.details.slice(0,3),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"tooltip-incident-item"},[(0,s.Lk)("div",uj,(0,d.v_)(e.title||"Untitled Incident"),1),(0,s.Lk)("div",pj,(0,d.v_)(e.minutes)+" "+(0,d.v_)(o.kpiData.mttd.unit),1)]))),128)),o.activeTooltip.details.length>3?((0,s.uX)(),(0,s.CE)("div",vj," + "+(0,d.v_)(o.activeTooltip.details.length-3)+" more ",1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",mj,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.mttd.trend,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"mttd-month-"+a},(0,d.v_)(e.month),1))),128))])])]),(0,s.Lk)("div",kj,[a[21]||(a[21]=(0,s.Lk)("h3",null,"Mean Time to Respond (MTTR)",-1)),(0,s.Lk)("div",hj,[(0,s.eW)((0,d.v_)(o.kpiData.mttr.value.toFixed(1)),1),(0,s.Lk)("span",gj,(0,d.v_)(o.kpiData.mttr.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.mttr.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.mttr.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.mttr.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",yj,[(0,s.Lk)("div",fj,[((0,s.uX)(),(0,s.CE)("svg",bj,[o.kpiData.mttr.trend&&o.kpiData.mttr.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.mttr.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,Cj)):(0,s.Q3)("",!0),o.kpiData.mttr.trend&&o.kpiData.mttr.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.mttr.trend.map(e=>e.minutes)),(e,t)=>((0,s.uX)(),(0,s.CE)("g",{key:"mttr-point-"+t,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,Lj),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.mttr.trend[t]),onMouseout:a[1]||(a[1]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,wj)]))),128)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",Ej,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.mttr.trend,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"mttr-month-"+a},(0,d.v_)(e.month),1))),128))])])]),(0,s.Lk)("div",Rj,[a[22]||(a[22]=(0,s.Lk)("h3",null,"Mean Time to Contain (MTTC)",-1)),(0,s.Lk)("div",Dj,[(0,s.eW)((0,d.v_)(Number(o.kpiData.mttc.value).toFixed(1)),1),(0,s.Lk)("span",Ij,(0,d.v_)(o.kpiData.mttc.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.mttc.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.mttc.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.mttc.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",Pj,[(0,s.Lk)("div",_j,[((0,s.uX)(),(0,s.CE)("svg",Sj,[o.kpiData.mttc.trend&&o.kpiData.mttc.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.mttc.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,Aj)):(0,s.Q3)("",!0),o.kpiData.mttc.trend&&o.kpiData.mttc.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.mttc.trend.map(e=>e.minutes)),(e,t)=>((0,s.uX)(),(0,s.CE)("g",{key:"mttc-point-"+t,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,Tj),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.mttc.trend[t]),onMouseout:a[2]||(a[2]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,xj)]))),128)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",Fj,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.mttc.trend,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"mttc-month-"+a},(0,d.v_)(e.month),1))),128))])])])]),(0,s.Lk)("div",Vj,[(0,s.Lk)("div",Mj,[a[24]||(a[24]=(0,s.Lk)("h3",null,"Mean Time to Resolve (MTTRv)",-1)),(0,s.Lk)("div",Xj,[(0,s.eW)((0,d.v_)(o.kpiData.mttrv.value),1),(0,s.Lk)("span",Uj,(0,d.v_)(o.kpiData.mttrv.unit),1),a[23]||(a[23]=(0,s.Lk)("span",{class:"value-change negative"},[(0,s.Lk)("i",{class:"fas fa-caret-down"}),(0,s.eW)("2.0%")],-1))]),a[25]||(a[25]=(0,s.Fv)('<div class="kpi-chart" data-v-ba40ffbc><div class="line-chart" data-v-ba40ffbc><svg viewBox="0 0 300 60" preserveAspectRatio="none" data-v-ba40ffbc><path d="M0,20 C25,25 50,20 75,15 C100,10 125,15 150,20 C175,25 200,20 225,15 C250,10 275,15 300,20" fill="none" stroke="#3498db" stroke-width="2" data-v-ba40ffbc></path><circle cx="0" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="50" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="100" cy="10" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="150" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="200" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="250" cy="10" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="300" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle></svg></div><div class="chart-months" data-v-ba40ffbc><span data-v-ba40ffbc>Jan</span><span data-v-ba40ffbc>Feb</span><span data-v-ba40ffbc>Mar</span><span data-v-ba40ffbc>Apr</span><span data-v-ba40ffbc>May</span><span data-v-ba40ffbc>Jun</span></div></div>',1))]),(0,s.Lk)("div",Nj,[a[26]||(a[26]=(0,s.Lk)("h3",null,"First Response Time",-1)),(0,s.Lk)("div",$j,[(0,s.eW)((0,d.v_)(o.kpiData.firstResponseTime.value),1),(0,s.Lk)("span",Oj,(0,d.v_)(o.kpiData.firstResponseTime.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.firstResponseTime.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.firstResponseTime.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.firstResponseTime.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",jj,[(0,s.Lk)("div",Bj,[((0,s.uX)(),(0,s.CE)("svg",Wj,[o.kpiData.firstResponseTime.trend&&o.kpiData.firstResponseTime.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.firstResponseTime.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,Qj)):(0,s.Q3)("",!0),o.kpiData.firstResponseTime.trend&&o.kpiData.firstResponseTime.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.firstResponseTime.trend.map(e=>e.minutes)),(e,t)=>((0,s.uX)(),(0,s.CE)("g",{key:"first-response-point-"+t,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,qj),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.firstResponseTime.trend[t]),onMouseout:a[3]||(a[3]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,Kj)]))),128)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",Jj,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.firstResponseTime.trend,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"first-response-month-"+a},(0,d.v_)(e.month),1))),128))])])])]),(0,s.Lk)("div",zj,[(0,s.Lk)("div",Hj,[a[27]||(a[27]=(0,s.Lk)("h3",null,"Number of Incidents Detected",-1)),(0,s.Lk)("div",Yj,(0,d.v_)(o.kpiData.incidentsDetected.value),1),(0,s.Lk)("div",Gj,[(0,s.Lk)("div",Zj,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentsDetected.byDay,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"incident-bar-"+a,class:"bar tooltip-container",style:(0,d.Tr)({height:l.calculateBarHeight(e,o.kpiData.incidentsDetected.byDay)})},[(0,s.Lk)("div",eB,[(0,s.Lk)("strong",null,(0,d.v_)(o.kpiData.incidentsDetected.details&&o.kpiData.incidentsDetected.details[a]?.day)+": "+(0,d.v_)(e),1),e>0?((0,s.uX)(),(0,s.CE)("div",aB,[o.kpiData.incidentsDetected.details&&o.kpiData.incidentsDetected.details[a]?.incidents.length>0?((0,s.uX)(),(0,s.CE)("div",tB,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentsDetected.details[a]?.incidents.slice(0,3),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"tooltip-incident"},(0,d.v_)(e.title),1))),128)),o.kpiData.incidentsDetected.details&&o.kpiData.incidentsDetected.details[a]?.incidents.length>3?((0,s.uX)(),(0,s.CE)("div",iB," + "+(0,d.v_)(o.kpiData.incidentsDetected.details[a]?.incidents.length-3)+" more ",1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])],4))),128))])]),a[28]||(a[28]=(0,s.Lk)("div",{class:"chart-labels"},[(0,s.Lk)("span",null,"M"),(0,s.Lk)("span",null,"T"),(0,s.Lk)("span",null,"W"),(0,s.Lk)("span",null,"T"),(0,s.Lk)("span",null,"F"),(0,s.Lk)("span",null,"S"),(0,s.Lk)("span",null,"S")],-1))]),(0,s.Lk)("div",sB,[a[29]||(a[29]=(0,s.Lk)("h3",null,"Number of Reopened Incidents",-1)),(0,s.Lk)("div",oB,(0,d.v_)(o.kpiData.reopenedIncidents.value),1),(0,s.Lk)("div",lB,[(0,s.Lk)("div",nB,[(0,s.Lk)("div",{class:"progress",style:(0,d.Tr)({width:o.kpiData.reopenedIncidents.percentage+"%"})},null,4)])]),(0,s.Lk)("div",rB,[(0,s.Lk)("span",null,(0,d.v_)(o.kpiData.reopenedIncidents.percentage.toFixed(1))+"% of total incidents",1)])]),(0,s.Lk)("div",cB,[a[30]||(a[30]=(0,s.Lk)("h3",null,"Incident Closure Rate",-1)),(0,s.Lk)("div",dB,[(0,s.eW)((0,d.v_)(Math.round(o.kpiData.closureRate.value)),1),(0,s.Lk)("span",uB,(0,d.v_)(o.kpiData.closureRate.unit),1)]),(0,s.Lk)("div",pB,[(0,s.Lk)("div",vB,[(0,s.Lk)("div",{class:"progress",style:(0,d.Tr)({width:o.kpiData.closureRate.value+"%"})},null,4)])])])]),(0,s.Lk)("div",mB,[(0,s.Lk)("div",kB,[a[33]||(a[33]=(0,s.Lk)("h3",null,"False Positive Rate",-1)),(0,s.Lk)("div",hB,[(0,s.eW)((0,d.v_)(Math.round(o.kpiData.falsePositiveRate.value)),1),(0,s.Lk)("span",gB,(0,d.v_)(o.kpiData.falsePositiveRate.unit),1)]),(0,s.Lk)("div",yB,[(0,s.Lk)("div",fB,[a[32]||(a[32]=(0,s.Lk)("div",{class:"donut-hole"},null,-1)),(0,s.Lk)("div",{class:"donut-chart",style:(0,d.Tr)(`--percentage: ${o.kpiData.falsePositiveRate.value};`)},a[31]||(a[31]=[(0,s.Lk)("div",{class:"donut-hole"},null,-1)]),4)])])]),(0,s.Lk)("div",bB,[a[34]||(a[34]=(0,s.Lk)("h3",null,"Detection Accuracy",-1)),(0,s.Lk)("div",CB,[(0,s.eW)((0,d.v_)(Math.round(o.kpiData.detectionAccuracy.value)),1),(0,s.Lk)("span",LB,(0,d.v_)(o.kpiData.detectionAccuracy.unit),1)]),(0,s.Lk)("div",wB,[(0,s.Lk)("div",EB,[(0,s.Lk)("div",{class:"progress",style:(0,d.Tr)({width:o.kpiData.detectionAccuracy.value+"%"})},null,4)])])]),(0,s.Lk)("div",RB,[a[35]||(a[35]=(0,s.Lk)("h3",null,"Cost per Incident",-1)),(0,s.Lk)("div",DB,"â‚¹"+(0,d.v_)(o.kpiData.costData.total_cost_k||"0")+"K",1),(0,s.Lk)("div",IB,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.costData.by_severity,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["cost-bar",e.severity.toLowerCase()])},(0,d.v_)(e.label),3))),128))])])]),(0,s.Lk)("div",PB,[(0,s.Lk)("div",_B,[a[40]||(a[40]=(0,s.Lk)("h3",null,"Percentage of Incidents by Severity",-1)),(0,s.Lk)("div",SB,[((0,s.uX)(),(0,s.CE)("svg",AB,[a[36]||(a[36]=(0,s.Lk)("circle",{cx:"50",cy:"50",r:"40",fill:"white"},null,-1)),(0,s.Lk)("circle",{r:"40",cx:"50",cy:"50",fill:"transparent",stroke:"#84cc16","stroke-width":"40","stroke-dasharray":`${2.51*o.kpiData.incidentsBySeverity.low} ${100*2.51-2.51*o.kpiData.incidentsBySeverity.low}`,"stroke-dashoffset":"0",transform:"rotate(-90 50 50)",class:"pie-segment-path",onMouseover:a[4]||(a[4]=e=>l.showPieTooltip(e,"Low",o.kpiData.incidentsBySeverity.low)),onMouseout:a[5]||(a[5]=(...e)=>l.hidePieTooltip&&l.hidePieTooltip(...e))},null,40,TB),(0,s.Lk)("circle",{r:"40",cx:"50",cy:"50",fill:"transparent",stroke:"#facc15","stroke-width":"40","stroke-dasharray":`${2.51*o.kpiData.incidentsBySeverity.medium} ${100*2.51-2.51*o.kpiData.incidentsBySeverity.medium}`,"stroke-dashoffset":""+2.51*(100-o.kpiData.incidentsBySeverity.low),transform:"rotate(-90 50 50)",class:"pie-segment-path",onMouseover:a[6]||(a[6]=e=>l.showPieTooltip(e,"Medium",o.kpiData.incidentsBySeverity.medium)),onMouseout:a[7]||(a[7]=(...e)=>l.hidePieTooltip&&l.hidePieTooltip(...e))},null,40,xB),(0,s.Lk)("circle",{r:"40",cx:"50",cy:"50",fill:"transparent",stroke:"#f97316","stroke-width":"40","stroke-dasharray":`${2.51*o.kpiData.incidentsBySeverity.high} ${100*2.51-2.51*o.kpiData.incidentsBySeverity.high}`,"stroke-dashoffset":""+2.51*(100-o.kpiData.incidentsBySeverity.low-o.kpiData.incidentsBySeverity.medium),transform:"rotate(-90 50 50)",class:"pie-segment-path",onMouseover:a[8]||(a[8]=e=>l.showPieTooltip(e,"High",o.kpiData.incidentsBySeverity.high)),onMouseout:a[9]||(a[9]=(...e)=>l.hidePieTooltip&&l.hidePieTooltip(...e))},null,40,FB)])),(0,s.Lk)("div",{id:"pie-tooltip",class:"pie-tooltip",style:(0,d.Tr)(o.pieTooltipStyle)},[o.activePieTooltip?((0,s.uX)(),(0,s.CE)("div",VB,[(0,s.Lk)("div",MB,(0,d.v_)(o.activePieTooltip.severity),1),(0,s.Lk)("div",XB,(0,d.v_)(o.activePieTooltip.percentage)+"%",1),(0,s.Lk)("div",UB,"Count: "+(0,d.v_)(Math.round(o.activePieTooltip.count)),1)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",NB,[(0,s.Lk)("div",$B,[a[37]||(a[37]=(0,s.Lk)("span",{class:"legend-color high"},null,-1)),(0,s.eW)("High ("+(0,d.v_)(o.kpiData.incidentsBySeverity.high)+"%) ",1)]),(0,s.Lk)("div",OB,[a[38]||(a[38]=(0,s.Lk)("span",{class:"legend-color medium"},null,-1)),(0,s.eW)("Medium ("+(0,d.v_)(o.kpiData.incidentsBySeverity.medium)+"%) ",1)]),(0,s.Lk)("div",jB,[a[39]||(a[39]=(0,s.Lk)("span",{class:"legend-color low"},null,-1)),(0,s.eW)("Low ("+(0,d.v_)(o.kpiData.incidentsBySeverity.low)+"%) ",1)])])]),(0,s.Lk)("div",BB,[a[43]||(a[43]=(0,s.Lk)("h3",null,"Incident Origin Distribution",-1)),(0,s.Lk)("div",WB,[((0,s.uX)(),(0,s.CE)("svg",QB,[a[41]||(a[41]=(0,s.Lk)("circle",{cx:"50",cy:"50",r:"40",fill:"white"},null,-1)),o.kpiData.incidentOrigins&&o.kpiData.incidentOrigins.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.kpiData.incidentOrigins,(e,t)=>((0,s.uX)(),(0,s.CE)("circle",{key:"origin-"+t,r:"25",cx:"50",cy:"50",fill:"transparent",stroke:l.getOriginColor(e.origin),"stroke-width":"12","stroke-dasharray":`${2.51*e.percentage} ${100*2.51-2.51*e.percentage}`,"stroke-dashoffset":l.getStrokeDashOffset(t),transform:"rotate(-90 50 50)",class:"donut-segment-path",onMouseover:a=>l.showOriginTooltip(a,e.origin,e.percentage,e.count),onMouseout:a[10]||(a[10]=(...e)=>l.hideOriginTooltip&&l.hideOriginTooltip(...e))},null,40,qB))),128)):(0,s.Q3)("",!0),a[42]||(a[42]=(0,s.Lk)("text",{x:"50",y:"47","text-anchor":"middle","font-size":"6","font-weight":"bold"},"Total",-1)),(0,s.Lk)("text",KB,(0,d.v_)(o.incidentCounts.total),1)])),(0,s.Lk)("div",{id:"origin-tooltip",class:"origin-tooltip",style:(0,d.Tr)(o.originTooltipStyle)},[o.activeOriginTooltip?((0,s.uX)(),(0,s.CE)("div",JB,[(0,s.Lk)("div",zB,(0,d.v_)(o.activeOriginTooltip.origin),1),(0,s.Lk)("div",HB,(0,d.v_)(o.activeOriginTooltip.percentage)+"%",1),(0,s.Lk)("div",YB,"Count: "+(0,d.v_)(o.activeOriginTooltip.count),1)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",GB,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentOrigins,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"legend-"+a,class:"legend-item"},[(0,s.Lk)("span",{class:"legend-color",style:(0,d.Tr)({backgroundColor:l.getOriginColor(e.origin)})},null,4),(0,s.Lk)("span",ZB,(0,d.v_)(e.origin.length>8?e.origin.substring(0,8)+"...":e.origin),1)]))),128))])])]),(0,s.Lk)("div",eW,[(0,s.Lk)("div",aW,[a[44]||(a[44]=(0,s.Lk)("h3",null,"Incident Root Cause Categories",-1)),(0,s.Lk)("div",tW,[(0,s.Lk)("div",iW,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.rootCauseCategories,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"h-bar-item"},[(0,s.Lk)("div",sW,(0,d.v_)(t),1),(0,s.Lk)("div",oW,[(0,s.Lk)("div",{class:"h-bar-progress",style:(0,d.Tr)({width:e+"%"}),onMouseover:a=>l.showRootCauseTooltip(a,t,e),onMouseout:a[11]||(a[11]=(...e)=>l.hideRootCauseTooltip&&l.hideRootCauseTooltip(...e))},null,44,lW)]),(0,s.Lk)("div",nW,(0,d.v_)(e)+"%",1)]))),128))]),(0,s.Lk)("div",{class:"root-cause-tooltip",style:(0,d.Tr)(o.rootCauseTooltipStyle)},[o.activeRootCauseTooltip?((0,s.uX)(),(0,s.CE)("div",rW,[(0,s.Lk)("div",cW,(0,d.v_)(o.activeRootCauseTooltip.category),1),(0,s.Lk)("div",dW,(0,d.v_)(o.activeRootCauseTooltip.percentage)+"%",1),(0,s.Lk)("div",uW,"Count: "+(0,d.v_)(Math.round(o.activeRootCauseTooltip.count)),1)])):(0,s.Q3)("",!0)],4)])]),(0,s.Lk)("div",pW,[a[45]||(a[45]=(0,s.Lk)("h3",null,"Volume of Incident Types",-1)),(0,s.Lk)("div",vW,[(0,s.Lk)("div",mW,[Array.isArray(o.kpiData.incidentTypes)&&o.kpiData.incidentTypes.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.kpiData.incidentTypes.slice(0,5),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"type-"+a,class:"v-bar-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["v-bar-progress","type-color-"+a%5]),style:(0,d.Tr)({height:l.calculateBarHeight(e.count,o.kpiData.incidentTypes.map(e=>e.count))})},null,6),(0,s.Lk)("div",kW,(0,d.v_)(e.type),1),(0,s.Lk)("div",hW,(0,d.v_)(e.count),1)]))),128)):((0,s.uX)(),(0,s.CE)("div",gW," No incident type data available "))])])])]),(0,s.Lk)("div",yW,[(0,s.Lk)("div",fW,[a[46]||(a[46]=(0,s.Lk)("h3",null,"Incident Volume",-1)),(0,s.Lk)("div",bW,(0,d.v_)(o.kpiData.incidentVolume.total||0),1),(0,s.Lk)("div",CW,[((0,s.uX)(),(0,s.CE)("svg",LW,[(0,s.Lk)("path",{d:l.getVolumeTrendPath(o.kpiData.incidentVolume.trend),fill:"rgba(33, 150, 243, 0.2)",stroke:"#2196F3","stroke-width":"2"},null,8,wW)])),(0,s.Lk)("div",EW,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentVolume.trend,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:a},(0,d.v_)(e.day),1))),128))])])]),(0,s.Lk)("div",RW,[a[50]||(a[50]=(0,s.Lk)("h3",null,"Incident Escalation Rate",-1)),(0,s.Lk)("div",DW,[(0,s.eW)((0,d.v_)(o.kpiData.escalationRate.value||0),1),a[47]||(a[47]=(0,s.Lk)("span",{class:"unit"},"%",-1))]),(0,s.Lk)("div",IW,[(0,s.Lk)("div",PW,[(0,s.Lk)("div",{class:"stacked-segment audit",style:(0,d.Tr)({width:o.kpiData.escalationRate.audit+"%"}),onMouseover:a[12]||(a[12]=e=>l.showStackedTooltip(e,"Audit",o.kpiData.escalationRate.audit)),onMouseout:a[13]||(a[13]=(...e)=>l.hideStackedTooltip&&l.hideStackedTooltip(...e))},null,36),(0,s.Lk)("div",{class:"stacked-segment manual",style:(0,d.Tr)({width:o.kpiData.escalationRate.manual+"%"}),onMouseover:a[14]||(a[14]=e=>l.showStackedTooltip(e,"Manual",o.kpiData.escalationRate.manual)),onMouseout:a[15]||(a[15]=(...e)=>l.hideStackedTooltip&&l.hideStackedTooltip(...e))},null,36)]),(0,s.Lk)("div",_W,[(0,s.Lk)("div",SW,[a[48]||(a[48]=(0,s.Lk)("span",{class:"legend-color audit"},null,-1)),(0,s.Lk)("span",AW,"Audit ("+(0,d.v_)(o.kpiData.escalationRate.audit)+"%)",1)]),(0,s.Lk)("div",TW,[a[49]||(a[49]=(0,s.Lk)("span",{class:"legend-color manual"},null,-1)),(0,s.Lk)("span",xW,"Manual ("+(0,d.v_)(o.kpiData.escalationRate.manual)+"%)",1)])])]),(0,s.Lk)("div",{class:"stacked-tooltip",style:(0,d.Tr)(o.stackedTooltipStyle)},[o.activeStackedTooltip?((0,s.uX)(),(0,s.CE)("div",FW,[(0,s.Lk)("div",VW,(0,d.v_)(o.activeStackedTooltip.type),1),(0,s.Lk)("div",MW,(0,d.v_)(o.activeStackedTooltip.percentage)+"%",1)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",XW,[a[54]||(a[54]=(0,s.Lk)("h3",null,"Repeat Incident Rate",-1)),(0,s.Lk)("div",UW,[(0,s.eW)((0,d.v_)(o.kpiData.repeatRate.value||0),1),a[51]||(a[51]=(0,s.Lk)("span",{class:"unit"},"%",-1))]),(0,s.Lk)("div",NW,[(0,s.Lk)("div",$W,[(0,s.Lk)("div",{class:"donut-segment new",style:(0,d.Tr)({"--start-angle":"0deg","--end-angle":3.6*o.kpiData.repeatRate.new+"deg"})},null,4),(0,s.Lk)("div",{class:"donut-segment repeat",style:(0,d.Tr)({"--start-angle":3.6*o.kpiData.repeatRate.new+"deg","--end-angle":"360deg"})},null,4),(0,s.Lk)("div",OW,[(0,s.Lk)("div",jW,(0,d.v_)(o.kpiData.repeatRate.value)+"%",1)])])]),(0,s.Lk)("div",BW,[(0,s.Lk)("div",WW,[a[52]||(a[52]=(0,s.Lk)("span",{class:"legend-color new"},null,-1)),(0,s.eW)("New ("+(0,d.v_)(o.kpiData.repeatRate.new)+"%)",1)]),(0,s.Lk)("div",QW,[a[53]||(a[53]=(0,s.Lk)("span",{class:"legend-color repeat"},null,-1)),(0,s.eW)("Repeat ("+(0,d.v_)(o.kpiData.repeatRate.repeat)+"%)",1)])])])]),(0,s.bF)(n)])}var KW={name:"IncidentDashboard",components:{PopupModal:pv.wA},data(){return{loading:!0,kpiData:{mttd:{value:0,unit:"hours",trend:[],change_percentage:0},mttr:{value:0,unit:"hours",trend:[],change_percentage:0},mttc:{value:0,unit:"hours",trend:[],change_percentage:0},mttrv:{value:0,unit:"hours",trend:[]},firstResponseTime:{value:0,unit:"hours",trend:[]},escalationTime:{value:0,unit:"hours",trend:[]},incidentsDetected:{value:0,byDay:[0,0,0,0,0,0,0]},reopenedIncidents:{value:0,percentage:0},closureRate:{value:0,unit:"%"},falsePositiveRate:{value:0,unit:"%"},detectionAccuracy:{value:0,unit:"%"},slaComplianceRate:{value:0,unit:"%"},incidentsBySeverity:{high:0,medium:0,low:0},rootCauseCategories:{},incidentTypes:[],incidentVolume:{total:0,trend:[]},escalationRate:{value:0,audit:0,manual:0},repeatRate:{value:0,new:0,repeat:0},incidentOrigins:[],averageCost:null,totalCost:null,costCount:null,costData:{total_cost:0,by_severity:[]}},incidentCounts:{total:0,pending:0,accepted:0,rejected:0,resolved:0},tooltipStyle:{display:"none",left:"0px",top:"0px"},activeTooltip:null,pieTooltipStyle:{display:"none",left:"0px",top:"0px"},activePieTooltip:null,rootCauseTooltipStyle:{display:"none",left:"0px",top:"0px"},activeRootCauseTooltip:null,originTooltipStyle:{display:"none",left:"0px",top:"0px"},activeOriginTooltip:null,stackedTooltipStyle:{display:"none",left:"0px",top:"0px"},activeStackedTooltip:null}},methods:{async fetchKPIData(){try{this.loading=!0,console.log("Starting to fetch KPI data");try{console.log("Fetching MTTD data from /api/incident/mttd/");const e=await qe.A.get("/api/incident/mttd/",{params:{timeRange:"all"}});if(e.data){const a=e.data.value,t=parseFloat(a),i=e.data.trend.map(e=>({month:e.month,minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]}));console.log("Processed trend data:",i),this.kpiData.mttd={value:t,unit:e.data.unit,trend:i,change_percentage:e.data.change_percentage||0},console.log("Updated MTTD in kpiData:",this.kpiData.mttd)}}catch(e){console.error("Error fetching MTTD data:",e)}try{console.log("Fetching MTTR data from /api/incident/mttr/");const e=await qe.A.get("/api/incident/mttr/",{params:{timeRange:"all"}});if(e.data){const a=e.data.mttr;console.log("Raw MTTR value from API:",a);const t=a/60;console.log("Converted MTTR value to hours:",t);const i=(e.data.chart_data||[]).map(e=>({month:e.date.substring(0,7),minutes:(e.value||0)/60,count:e.count||0}));this.kpiData.mttr={value:t,unit:"hours",trend:i,change_percentage:e.data.change_percentage||0},console.log("Updated MTTR in kpiData:",this.kpiData.mttr)}}catch(a){console.error("Error fetching MTTR data:",a)}try{console.log("Fetching MTTC data from /api/incident/mttc/");const e=await qe.A.get("/api/incident/mttc/",{params:{timeRange:"all"}});if(e.data){console.log("Raw MTTC response:",e.data);const a=e.data.value,t=parseFloat(a);console.log("Parsed MTTC value:",t),this.kpiData.mttc={value:t,unit:e.data.unit||"hours",trend:Array.isArray(e.data.trend)?e.data.trend.map(e=>({month:e.month||"",minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]})):[],change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated MTTC in kpiData:",this.kpiData.mttc)}else console.warn("MTTC response has no data")}catch(t){console.error("Error fetching MTTC data:",t)}try{console.log("Fetching MTTRv data from /api/incident/mttrv/");const e=await qe.A.get("/api/incident/mttrv/",{params:{timeRange:"all"}});if(e.data){const a=e.data.value,t=parseFloat(a),i=Array.isArray(e.data.trend)?e.data.trend.map(e=>({month:e.month||"",minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]})):[];this.kpiData.mttrv={value:t,unit:e.data.unit||"hours",trend:i},console.log("Updated MTTRv in kpiData:",this.kpiData.mttrv)}}catch(i){console.error("Error fetching MTTRv data:",i)}try{console.log("Fetching False Positive Rate data from /api/incident/false-positive-rate/");const e=await qe.A.get("/api/incident/false-positive-rate/",{params:{timeRange:"all"}});if(e.data){console.log("Raw False Positive Rate response:",e.data);const a=e.data.value,t=parseFloat(a);console.log("Parsed False Positive Rate value:",t),this.kpiData.falsePositiveRate={value:t,unit:e.data.unit||"%",change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated falsePositiveRate in kpiData:",this.kpiData.falsePositiveRate)}else console.warn("False Positive Rate response has no data")}catch(s){console.error("Error fetching False Positive Rate data:",s)}try{console.log("Fetching Detection Accuracy data from /api/incident/detection-accuracy/");const e=await qe.A.get("/api/incident/detection-accuracy/",{params:{timeRange:"all"}});if(e.data){console.log("Raw Detection Accuracy response:",e.data);const a=e.data.value,t=parseFloat(a);this.kpiData.detectionAccuracy={value:t,unit:e.data.unit||"%",change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated detectionAccuracy in kpiData:",this.kpiData.detectionAccuracy)}else console.warn("Detection Accuracy response has no data")}catch(i){console.error("Error fetching Detection Accuracy data:",i)}try{console.log("Fetching Incident Closure Rate data from /api/incident/incident-closure-rate/");const e=await qe.A.get("/api/incident/incident-closure-rate/",{params:{timeRange:"all"}});if(e.data){console.log("Raw Incident Closure Rate response:",e.data);const a=e.data.value,t=parseFloat(a);this.kpiData.closureRate={value:t,unit:e.data.unit||"%",change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated closureRate in kpiData:",this.kpiData.closureRate)}else console.warn("Incident Closure Rate response has no data")}catch(i){console.error("Error fetching Incident Closure Rate data:",i)}try{console.log("Fetching reopened incidents count data");const e=await qe.A.get("/api/incident/reopened-count/");e.data&&(this.kpiData.reopenedIncidents.value=e.data.reopened_incidents||0,this.kpiData.reopenedIncidents.percentage=e.data.percentage_reopened||0)}catch(i){console.error("Error fetching reopened incidents:",i)}try{console.log("Fetching First Response Time data from /api/incident/first-response-time/");const e=await qe.A.get("/api/incident/first-response-time/",{params:{timeRange:"all"}});if(e.data){console.log("Raw First Response Time data:",e.data);const a=e.data.value,t=parseFloat(a),i=Array.isArray(e.data.trend)?e.data.trend.map(e=>({month:e.month||"",minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]})):[];this.kpiData.firstResponseTime={value:t,unit:e.data.unit||"hours",trend:i,change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated firstResponseTime in kpiData:",this.kpiData.firstResponseTime)}}catch(i){console.error("Error fetching First Response Time data:",i)}try{console.log("Fetching incident count data from /api/incident/count/");const e=await qe.A.get("/api/incident/count/",{params:{timeRange:"all"}});if(console.log("Incident count response:",JSON.stringify(e.data)),e.data){const a=e.data.value,t=e.data.byDay,i=e.data.details||[];this.kpiData.incidentsDetected={value:a,byDay:t,details:i},console.log("Updated incident count:",this.kpiData.incidentsDetected.value),console.log("Day distribution:",this.kpiData.incidentsDetected.byDay)}}catch(o){console.error("Error fetching incident count data:",o)}try{console.log("Fetching incidents by severity data");const e=await qe.A.get("/api/incident/by-severity/");if(e.data&&e.data.data){console.log("Raw severity response:",e.data);const a={high:0,medium:0,low:0};e.data.data.forEach(e=>{const t=e.severity.toLowerCase();t in a&&(a[t]=e.percentage)}),this.kpiData.incidentsBySeverity=a,console.log("Updated incidents by severity:",this.kpiData.incidentsBySeverity)}}catch(l){console.error("Error fetching incidents by severity:",l)}try{console.log("Fetching incident root causes data");const e=await qe.A.get("/api/incident/root-causes/");if(e.data&&e.data.data){console.log("Raw root causes response:",e.data);const a={};e.data.data.forEach(e=>{a[e.category]=e.percentage}),this.kpiData.rootCauseCategories=a,console.log("Updated root cause categories:",this.kpiData.rootCauseCategories)}}catch(n){console.error("Error fetching incident root causes:",n)}try{console.log("Fetching incident origins data");const e=await qe.A.get("/api/incident/origins/");e.data&&e.data.data&&(console.log("Raw origins response:",e.data),this.kpiData.incidentOrigins=e.data.data,console.log("Updated incident origins:",this.kpiData.incidentOrigins))}catch(r){console.error("Error fetching incident origins:",r)}try{console.log("Fetching incident types data");const e=await qe.A.get("/api/incident/types/");e.data&&e.data.data&&(console.log("Raw incident types response:",e.data),this.kpiData.incidentTypes=e.data.data,console.log("Updated incident types:",this.kpiData.incidentTypes))}catch(c){console.error("Error fetching incident types:",c)}try{const e=await qe.A.get("/api/incident/incident-volume/");this.kpiData.incidentVolume=e.data}catch(i){console.error("Error fetching incident volume:",i)}try{console.log("Fetching escalation rate data");const e=await qe.A.get("/api/incident/escalation-rate/");e.data&&(this.kpiData.escalationRate={value:e.data.value||0,audit:e.data.audit||0,manual:e.data.manual||0},console.log("Updated escalation rate:",this.kpiData.escalationRate))}catch(i){console.error("Error fetching escalation rate:",i)}try{console.log("Fetching cost per incident data");const e=await qe.A.get("/api/incident/cost/");e.data&&(console.log("Cost data response:",e.data),this.kpiData.costData={total_cost:e.data.total_cost||0,total_cost_k:e.data.total_cost_k||0,display_total:e.data.display_total||"0",by_severity:Array.isArray(e.data.by_severity)?e.data.by_severity.map(e=>({severity:e.severity||"Unknown",cost:e.cost||0,cost_k:e.cost_k||0,label:e.label||e.severity})):[]},console.log("Updated costData:",this.kpiData.costData))}catch(i){console.error("Error fetching cost per incident:",i)}try{console.log("Fetching repeat rate data");const e=await qe.A.get("/api/incident/repeat-rate/");e.data&&(this.kpiData.repeatRate={value:e.data.value||0,new:e.data.new||0,repeat:e.data.repeat||0},console.log("Updated repeat rate:",this.kpiData.repeatRate))}catch(i){console.error("Error fetching repeat rate:",i)}this.loading=!1}catch(i){console.error("Error in fetchKPIData:",i),pv.OQ.error("Error loading dashboard data. Please try again later."),this.loading=!1}},generateTrendPath(e){if(!e||0===e.length)return"";const a=Math.max(...e),t=Math.min(...e),i=a-t||1,s=300,o=60,l=10,n=10,r=o-l-n,c=s/(e.length-1||1);let d="M0,"+(o-n-(e[0]-t)/i*r);for(let u=1;u<e.length;u++){const a=u*c,s=o-n-(e[u]-t)/i*r;d+=` L${a},${s}`}return d},getTrendPoints(e){if(!e||0===e.length)return[];const a=Math.max(...e),t=Math.min(...e),i=a-t||1,s=300,o=60,l=10,n=10,r=o-l-n,c=s/(e.length-1||1);return e.map((e,a)=>({x:a*c,y:o-n-(e-t)/i*r}))},fetchIncidentCounts(){console.log("Fetching incident counts"),fetch("/api/incidents/counts/").then(e=>e.json()).then(e=>{console.log("Received incident counts:",e),this.incidentCounts=e}).catch(e=>{console.error("Error fetching incident counts:",e)})},calculateBarHeight(e,a){if(!a||0===a.length||!e)return"0%";const t=Math.max(...a);return 0===t?"0%":e/t*85+"%"},showTooltip(e,a){const t=e.target.closest(".line-chart").getBoundingClientRect(),i=t.width,s=e.clientX-t.left,o=e.clientY-t.top;let l,n;const r=150;s<r/2?(l=s+10,this.tooltipStyle.transform="translateX(0)"):s>i-r/2?(l=s-10,this.tooltipStyle.transform="translateX(-100%)"):(l=s,this.tooltipStyle.transform="translateX(-50%)"),n=Math.max(5,o-70),this.tooltipStyle={display:"block",left:`${l}px`,top:`${n}px`,transform:this.tooltipStyle.transform,zIndex:1e3},this.activeTooltip=a},hideTooltip(){this.tooltipStyle={display:"none",left:"0px",top:"0px"},this.activeTooltip=null},fetchMTTR(){console.log("Fetching MTTR data");const e=this.selectedTimeRange;fetch(`/api/incident/mttr/?timeRange=${e}`).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{console.log("MTTR data received:",e),this.mttr=e.mttr,this.mttrChartData=e.chart_data,this.mttrChangePercentage=e.change_percentage,this.$nextTick(()=>{this.renderMTTRChart()})}).catch(e=>{console.error("Error fetching MTTR data:",e)})},renderMTTRChart(){if(!this.mttrChartData||0===this.mttrChartData.length)return;const e=this.$refs.mttrChart;if(!e)return;while(e.firstChild)e.removeChild(e.firstChild);const a=300,t=60,i=5,s=a-2*i,o=t-2*i,l=this.mttrChartData.map(e=>e.value),n=this.mttrChartData.map(e=>e.date),r=this.mttrChartData.map(e=>e.count),c=Math.min(...l),d=Math.max(...l),u=e=>i+e/(l.length-1)*s,p=e=>t-i-(e-c)/(d-c)*o;let v="";l.forEach((e,a)=>{const t=u(a),i=p(e);v+=(0===a?"M":"L")+t+","+i});const m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",v),m.setAttribute("fill","none"),m.setAttribute("stroke","#3498db"),m.setAttribute("stroke-width","2"),e.appendChild(m),l.forEach((a,t)=>{const i=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=u(t),o=p(a);i.setAttribute("cx",s),i.setAttribute("cy",o),i.setAttribute("r","4"),i.setAttribute("fill","#3498db");const l=n[t],c=r[t];i.addEventListener("mouseover",e=>{const t=document.getElementById("mttr-tooltip");t.innerHTML=`<strong>Date:</strong> ${l}<br><strong>MTTR:</strong> ${a} mins<br><strong>Incidents:</strong> ${c}`;const i=e.target.getBoundingClientRect(),s=t.getBoundingClientRect(),o=window.innerWidth;let n=i.left;n+s.width>o-20&&(n=i.left-s.width),t.style.left=`${n}px`,t.style.top=i.top-s.height-10+"px",t.style.display="block"}),i.addEventListener("mouseout",()=>{document.getElementById("mttr-tooltip").style.display="none"}),e.appendChild(i)})},refreshData(){this.fetchMTTD(),this.fetchIncidentsCount(),this.fetchMTTR()},showPieTooltip(e,a,t){const i=this.incidentCounts.total||100,s=t/100*i,o=e.target.closest(".pie-chart-container").getBoundingClientRect(),l=e.clientX-o.left,n=e.clientY-o.top;this.pieTooltipStyle={display:"block",left:`${l}px`,top:n-60+"px"},this.activePieTooltip={severity:a,percentage:t,count:s}},hidePieTooltip(){this.pieTooltipStyle={display:"none",left:"0px",top:"0px"},this.activePieTooltip=null},showRootCauseTooltip(e,a,t){const i=this.incidentCounts.total||100,s=t/100*i,o=e.target.getBoundingClientRect(),l=o.left+o.width/2,n=o.top-10;this.rootCauseTooltipStyle={display:"block",left:`${l}px`,top:n-60+"px"},this.activeRootCauseTooltip={category:a,percentage:t,count:s}},hideRootCauseTooltip(){this.rootCauseTooltipStyle={display:"none",left:"0px",top:"0px"},this.activeRootCauseTooltip=null},getOriginColor(e){const a={Manual:"#ffd166",SIEM:"#118ab2",Unknown:"#073b4c","Audit Finding":"#ef476f",System:"#06d6a0",User:"#4361ee",Automated:"#ff6b6b"};return a[e]||"#95a5a6"},getStrokeDashOffset(e){let a=0;for(let t=0;t<e;t++)a+=2.51*this.kpiData.incidentOrigins[t].percentage;return a},showOriginTooltip(e,a,t,i){try{const s=e.target.closest(".small-donut-container");if(!s)return void console.warn("Could not find chart container for tooltip positioning");const o=s.getBoundingClientRect(),l=e.clientX-o.left,n=e.clientY-o.top;this.originTooltipStyle={display:"block",left:`${l}px`,top:n-10+"px",zIndex:2e3},this.activeOriginTooltip={origin:a,percentage:t,count:i}}catch(s){console.error("Error showing origin tooltip:",s),this.hideOriginTooltip()}},hideOriginTooltip(){this.originTooltipStyle={display:"none",left:"0px",top:"0px"},this.activeOriginTooltip=null},getVolumeTrendPath(e){if(!e||0===e.length)return"";const a=400,t=80,i=5,s=Math.max(...e.map(e=>e.count),1),o=e.map((o,l)=>{const n=i+l*(a-2*i)/(e.length-1),r=t-i-o.count/s*(t-2*i);return`${n},${r}`}),l=`M${o.join(" L")}`,n=`${l} L${a-i},${t-i} L${i},${t-i} Z`;return n},showStackedTooltip(e,a,t){const i=e.target.getBoundingClientRect();this.stackedTooltipStyle={display:"block",left:i.left+i.width/2+"px",top:i.top-40+"px"},this.activeStackedTooltip={type:a,percentage:t}},hideStackedTooltip(){this.stackedTooltipStyle={display:"none",left:"0px",top:"0px"},this.activeStackedTooltip=null},fetchIncidentCost(){console.log("Fetching incident cost data..."),qe.A.get("/api/incident/cost/").then(e=>{console.log("Cost data received:",e.data),this.kpiData.costData=e.data}).catch(e=>{console.error("Error fetching incident cost:",e)})},formatCurrency(e){if(!e)return"0";const a=e/1e3;return a}},mounted(){this.fetchKPIData(),this.fetchIncidentCounts()}};const JW=(0,se.A)(KW,[["render",qW],["__scopeId","data-v-ba40ffbc"]]);var zW=JW,HW=t(7928);const YW={class:"incident-details-page"},GW={class:"incident-details-header"},ZW={key:0,class:"incident-loading-state"},eQ={key:1,class:"incident-error-state"},aQ={key:2,class:"incident-details-content"},tQ={class:"incident-header-section"},iQ={class:"incident-title-container"},sQ={class:"incident-title-section"},oQ={class:"incident-title"},lQ={class:"incident-id"},nQ={class:"incident-status-container"},rQ={key:0,class:"incident-status-badge incident-scheduled"},cQ={key:1,class:"incident-status-badge incident-rejected"},dQ={key:2,class:"incident-status-badge incident-assigned"},uQ={key:3,class:"incident-status-badge incident-approved"},pQ={key:4,class:"incident-status-badge incident-active"},vQ={key:5,class:"incident-status-badge incident-under-review"},mQ={key:6,class:"incident-status-badge incident-completed"},kQ={key:7,class:"incident-status-badge incident-closed"},hQ={key:8,class:"incident-status-badge incident-open"},gQ={class:"incident-details-section"},yQ={class:"incident-basic-info-grid"},fQ={class:"incident-detail-item"},bQ={class:"incident-detail-item"},CQ={class:"incident-detail-item"},LQ={class:"incident-detail-item"},wQ={class:"incident-detail-value"},EQ={class:"incident-detail-item"},RQ={class:"incident-detail-value"},DQ={class:"incident-detail-item"},IQ={class:"incident-detail-value"},PQ={class:"incident-details-section"},_Q={class:"incident-description-content"},SQ={class:"incident-detail-value incident-description-value"},AQ={class:"incident-details-section"},TQ={class:"incident-impact-grid"},xQ={class:"incident-detail-item"},FQ={class:"incident-detail-value"},VQ={class:"incident-detail-item"},MQ={class:"incident-detail-value"},XQ={class:"incident-detail-item"},UQ={class:"incident-detail-value"},NQ={class:"incident-detail-item"},$Q={class:"incident-detail-value"},OQ={class:"incident-detail-item incident-full-width"},jQ={class:"incident-detail-value incident-description-style"},BQ={class:"incident-detail-item incident-full-width"},WQ={class:"incident-detail-value incident-description-style"},QQ={class:"incident-details-section"},qQ={class:"incident-impact-grid"},KQ={class:"incident-detail-item incident-full-width"},JQ={class:"incident-detail-value incident-description-style"},zQ={class:"incident-detail-item incident-full-width"},HQ={class:"incident-detail-value incident-description-style"},YQ={class:"incident-detail-item incident-full-width"},GQ={class:"incident-detail-value incident-description-style"},ZQ={class:"incident-details-section"},eq={class:"incident-compliance-grid"},aq={class:"incident-detail-item"},tq={class:"incident-detail-value incident-description-style"},iq={class:"incident-detail-item"},sq={class:"incident-detail-value incident-description-style"},oq={class:"incident-details-section"},lq={class:"incident-response-grid"},nq={class:"incident-response-item mitigation-section"},rq={class:"incident-section-content"},cq={class:"incident-response-item comments-section"},dq={class:"incident-section-content"},uq={class:"incident-response-item lessons-section"},pq={class:"incident-section-content"},vq={class:"incident-details-section"},mq={class:"incident-basic-info-grid"},kq={class:"incident-detail-item"},hq={class:"incident-detail-item"},gq={class:"incident-details-footer"},yq={key:0},fq={key:1},bq={class:"incident-status-badge incident-rejected"},Cq={key:2},Lq={key:3},wq={key:4},Eq={key:5},Rq={key:6},Dq={key:7},Iq={key:8,class:"incident-action-buttons"},Pq={key:0,class:"no-permission-message"};function _q(e,a,t,i,o,l){const n=(0,s.g2)("router-link"),r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",YW,[(0,s.Lk)("div",GW,[(0,s.bF)(n,{to:"/incident/incident",class:"incident-back-link"},{default:(0,s.k6)(()=>a[2]||(a[2]=[(0,s.Lk)("span",{class:"incident-back-arrow"},"â†",-1),(0,s.Lk)("span",{class:"back-text"},"Back to Incidents",-1)])),_:1,__:[2]})]),o.loading?((0,s.uX)(),(0,s.CE)("div",ZW," Loading incident details... ")):o.error?((0,s.uX)(),(0,s.CE)("div",eQ,(0,d.v_)(o.error),1)):o.incident?((0,s.uX)(),(0,s.CE)("div",aQ,[(0,s.Lk)("div",tQ,[(0,s.Lk)("div",iQ,[(0,s.Lk)("div",sQ,[(0,s.Lk)("h1",oQ,(0,d.v_)(o.incident.IncidentTitle),1),(0,s.Lk)("div",lQ,"Incident #"+(0,d.v_)(o.incident?.IncidentId),1)]),(0,s.Lk)("div",nQ,["Scheduled"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",rQ,"Mitigated to Risk")):"Rejected"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",cQ,(0,d.v_)("RISK"===o.incident.RejectionSource?"Rejected from Risk":"Rejected as Incident"),1)):"Assigned"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",dQ,"Assigned")):"Approved"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",uQ,"Approved")):"Active"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",pQ,"Active")):"Under Review"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",vQ,"Under Review")):"Completed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",mQ,"Completed")):"Closed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",kQ,"Closed")):((0,s.uX)(),(0,s.CE)("span",hQ,"Open"))])])]),(0,s.Lk)("div",gQ,[a[9]||(a[9]=(0,s.Lk)("h2",{class:"incident-section-title"},"Basic Information",-1)),(0,s.Lk)("div",yQ,[(0,s.Lk)("div",fQ,[a[3]||(a[3]=(0,s.Lk)("span",{class:"incident-detail-label"},"Priority",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-priority-badge",l.getPriorityClass(o.incident.RiskPriority)])},(0,d.v_)(o.incident.RiskPriority||"Not Set"),3)]),(0,s.Lk)("div",bQ,[a[4]||(a[4]=(0,s.Lk)("span",{class:"incident-detail-label"},"Category",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-category-badge",l.getRiskCategoryClass(o.incident.RiskCategory)])},(0,d.v_)(o.incident.RiskCategory||"Not Set"),3)]),(0,s.Lk)("div",CQ,[a[5]||(a[5]=(0,s.Lk)("span",{class:"incident-detail-label"},"Origin",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-origin-badge",l.getOriginClass(o.incident.Origin)])},(0,d.v_)(o.incident.Origin||"Not Set"),3)]),(0,s.Lk)("div",LQ,[a[6]||(a[6]=(0,s.Lk)("span",{class:"incident-detail-label"},"Criticality",-1)),(0,s.Lk)("span",wQ,(0,d.v_)(o.incident.Criticality||"Not Set"),1)]),(0,s.Lk)("div",EQ,[a[7]||(a[7]=(0,s.Lk)("span",{class:"incident-detail-label"},"Date",-1)),(0,s.Lk)("span",RQ,(0,d.v_)(l.formatDate(o.incident.Date)),1)]),(0,s.Lk)("div",DQ,[a[8]||(a[8]=(0,s.Lk)("span",{class:"incident-detail-label"},"Time",-1)),(0,s.Lk)("span",IQ,(0,d.v_)(o.incident.Time||"Not Set"),1)])])]),(0,s.Lk)("div",PQ,[a[10]||(a[10]=(0,s.Lk)("h2",{class:"incident-section-title"},"Description",-1)),(0,s.Lk)("div",_Q,[(0,s.Lk)("div",SQ,(0,d.v_)(o.incident.Description||"No description provided"),1)])]),(0,s.Lk)("div",AQ,[a[17]||(a[17]=(0,s.Lk)("h2",{class:"incident-section-title"},"Impact & Assessment",-1)),(0,s.Lk)("div",TQ,[(0,s.Lk)("div",xQ,[a[11]||(a[11]=(0,s.Lk)("span",{class:"incident-detail-label"},"Affected Business Unit",-1)),(0,s.Lk)("span",FQ,(0,d.v_)(o.incident.AffectedBusinessUnit||"Not specified"),1)]),(0,s.Lk)("div",VQ,[a[12]||(a[12]=(0,s.Lk)("span",{class:"incident-detail-label"},"Systems/Assets Involved",-1)),(0,s.Lk)("span",MQ,(0,d.v_)(o.incident.SystemsAssetsInvolved||"Not specified"),1)]),(0,s.Lk)("div",XQ,[a[13]||(a[13]=(0,s.Lk)("span",{class:"incident-detail-label"},"Geographic Location",-1)),(0,s.Lk)("span",UQ,(0,d.v_)(o.incident.GeographicLocation||"Not specified"),1)]),(0,s.Lk)("div",NQ,[a[14]||(a[14]=(0,s.Lk)("span",{class:"incident-detail-label"},"Cost of Incident",-1)),(0,s.Lk)("span",$Q,(0,d.v_)(o.incident.CostOfIncident||"Not specified"),1)]),(0,s.Lk)("div",OQ,[a[15]||(a[15]=(0,s.Lk)("span",{class:"incident-detail-label"},"Initial Impact Assessment",-1)),(0,s.Lk)("div",jQ,(0,d.v_)(o.incident.InitialImpactAssessment||"No assessment provided"),1)]),(0,s.Lk)("div",BQ,[a[16]||(a[16]=(0,s.Lk)("span",{class:"incident-detail-label"},"Possible Damage",-1)),(0,s.Lk)("div",WQ,(0,d.v_)(o.incident.PossibleDamage||"No damage assessment provided"),1)])])]),(0,s.Lk)("div",QQ,[a[21]||(a[21]=(0,s.Lk)("h2",{class:"incident-section-title"},"Contacts & Involved Parties",-1)),(0,s.Lk)("div",qQ,[(0,s.Lk)("div",KQ,[a[18]||(a[18]=(0,s.Lk)("span",{class:"incident-detail-label"},"Internal Contacts",-1)),(0,s.Lk)("div",JQ,(0,d.v_)(o.incident.InternalContacts||"No internal contacts specified"),1)]),(0,s.Lk)("div",zQ,[a[19]||(a[19]=(0,s.Lk)("span",{class:"incident-detail-label"},"External Parties Involved",-1)),(0,s.Lk)("div",HQ,(0,d.v_)(o.incident.ExternalPartiesInvolved||"No external parties specified"),1)]),(0,s.Lk)("div",YQ,[a[20]||(a[20]=(0,s.Lk)("span",{class:"incident-detail-label"},"Regulatory Bodies",-1)),(0,s.Lk)("div",GQ,(0,d.v_)(o.incident.RegulatoryBodies||"No regulatory bodies involved"),1)])])]),(0,s.Lk)("div",ZQ,[a[24]||(a[24]=(0,s.Lk)("h2",{class:"incident-section-title"},"Compliance & Controls",-1)),(0,s.Lk)("div",eq,[(0,s.Lk)("div",aq,[a[22]||(a[22]=(0,s.Lk)("span",{class:"incident-detail-label"},"Relevant Policies/Procedures Violated",-1)),(0,s.Lk)("div",tq,(0,d.v_)(o.incident.RelevantPoliciesProceduresViolated||"No violations identified"),1)]),(0,s.Lk)("div",iq,[a[23]||(a[23]=(0,s.Lk)("span",{class:"incident-detail-label"},"Control Failures",-1)),(0,s.Lk)("div",sq,(0,d.v_)(o.incident.ControlFailures||"No control failures identified"),1)])])]),(0,s.Lk)("div",oq,[a[28]||(a[28]=(0,s.Lk)("h2",{class:"incident-section-title"},"Response & Resolution",-1)),(0,s.Lk)("div",lq,[(0,s.Lk)("div",nq,[a[25]||(a[25]=(0,s.Lk)("div",{class:"incident-section-header"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Mitigation Plan ")],-1)),(0,s.Lk)("div",rq,(0,d.v_)(o.incident.Mitigation||"No mitigation plan provided"),1)]),(0,s.Lk)("div",cq,[a[26]||(a[26]=(0,s.Lk)("div",{class:"incident-section-header"},[(0,s.Lk)("i",{class:"fas fa-comments"}),(0,s.eW)(" Comments ")],-1)),(0,s.Lk)("div",dq,(0,d.v_)(o.incident.Comments||"No comments available"),1)]),(0,s.Lk)("div",uq,[a[27]||(a[27]=(0,s.Lk)("div",{class:"incident-section-header"},[(0,s.Lk)("i",{class:"fas fa-lightbulb"}),(0,s.eW)(" Lessons Learned ")],-1)),(0,s.Lk)("div",pq,(0,d.v_)(o.incident.LessonsLearned||"No lessons learned documented"),1)])])]),(0,s.Lk)("div",vq,[a[31]||(a[31]=(0,s.Lk)("h2",{class:"incident-section-title"},"Additional Information",-1)),(0,s.Lk)("div",mq,[(0,s.Lk)("div",kq,[a[29]||(a[29]=(0,s.Lk)("span",{class:"incident-detail-label"},"Repeated Incident",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-flag-badge",o.incident.RepeatedNot?"incident-flag-yes":"incident-flag-no"])},(0,d.v_)(o.incident.RepeatedNot?"Yes":"No"),3)]),(0,s.Lk)("div",hq,[a[30]||(a[30]=(0,s.Lk)("span",{class:"incident-detail-label"},"Reopened Incident",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-flag-badge",o.incident.ReopenedNot?"incident-flag-yes":"incident-flag-no"])},(0,d.v_)(o.incident.ReopenedNot?"Yes":"No"),3)])])]),(0,s.Lk)("div",gq,["Scheduled"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",yq,a[32]||(a[32]=[(0,s.Lk)("span",{class:"incident-status-badge incident-scheduled"},"Mitigated to Risk",-1)]))):"Rejected"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",fq,[(0,s.Lk)("span",bq,(0,d.v_)("RISK"===o.incident.RejectionSource?"Rejected from Risk":"Rejected as Incident"),1)])):"Assigned"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",Cq,a[33]||(a[33]=[(0,s.Lk)("span",{class:"incident-status-badge incident-assigned"},"Assigned",-1)]))):"Approved"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",Lq,a[34]||(a[34]=[(0,s.Lk)("span",{class:"incident-status-badge incident-approved"},"Approved",-1)]))):"Active"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",wq,a[35]||(a[35]=[(0,s.Lk)("span",{class:"incident-status-badge incident-active"},"Active",-1)]))):"Under Review"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",Eq,a[36]||(a[36]=[(0,s.Lk)("span",{class:"incident-status-badge incident-under-review"},"Under Review",-1)]))):"Completed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",Rq,a[37]||(a[37]=[(0,s.Lk)("span",{class:"incident-status-badge incident-completed"},"Completed",-1)]))):"Closed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",Dq,a[38]||(a[38]=[(0,s.Lk)("span",{class:"incident-status-badge incident-closed"},"Closed",-1)]))):((0,s.uX)(),(0,s.CE)("div",Iq,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>l.openSolveModal&&l.openSolveModal(...e)),class:"incident-solve-btn"},a[39]||(a[39]=[(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1),(0,s.eW)(" ESCALATE TO RISK ")])),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>l.openRejectModal&&l.openRejectModal(...e)),class:"incident-no-btn"},a[40]||(a[40]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" REJECT INCIDENT ")])),e.canEscalateIncident()||e.canEditIncident()?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Pq,a[41]||(a[41]=[(0,s.Lk)("i",{class:"fas fa-lock"},null,-1),(0,s.Lk)("span",null,"No actions available - insufficient permissions",-1)])))]))])])):(0,s.Q3)("",!0),(0,s.bF)(r)])}var Sq=t(766),Aq={name:"IncidentDetails",components:{PopupModal:pv.wA},mixins:[Sq.r],data(){return{incident:null,loading:!0,error:null}},async created(){await this.fetchIncidentDetails()},methods:{async fetchIncidentDetails(){try{this.loading=!0,this.error=null;const e=this.$route.params.id;if(console.log("Fetching incident:",e),this.logUserAction("VIEW_INCIDENT_DETAILS","incident",e),!this.canViewIncident())return console.warn("âŒ Permission denied for viewing incident details"),void(this.error="You do not have permission to view incident details.");console.log("âœ… Permission granted for viewing incident details");const a=await qe.A.get("http://localhost:8000/api/incident-incidents/"),t=a.data;if(this.incident=t.find(a=>a.IncidentId.toString()===e.toString()),!this.incident)throw new Error("Incident not found");console.log("Fetched incident:",this.incident)}catch(e){console.error("Failed to fetch incident details:",e),this.error="Failed to load incident details. Please try again."}finally{this.loading=!1}},openSolveModal(){if(this.logUserAction("ESCALATE_INCIDENT","incident",this.incident?.IncidentId),!this.canEscalateIncident())return console.warn("âŒ Permission denied for escalating incident"),void pv.OQ.error("You don't have permission to escalate incidents");console.log("âœ… Permission granted for escalating incident"),pv.OQ.confirm("This incident will be forwarded to the Risk module. Do you want to proceed?","Forward to Risk",()=>this.confirmSolve(),()=>{})},openRejectModal(){if(this.logUserAction("REJECT_INCIDENT","incident",this.incident?.IncidentId),!this.canEditIncident())return console.warn("âŒ Permission denied for rejecting incident"),void pv.OQ.error("You don't have permission to reject incidents");console.log("âœ… Permission granted for rejecting incident"),pv.OQ.confirm("Are you sure you want to reject this incident?","Reject Incident",()=>this.confirmReject(),()=>{})},confirmSolve(){qe.A.put(`http://localhost:8000/incidents/${this.incident.IncidentId}/status/`,{status:"Scheduled"}).then(e=>{console.log("Incident escalated to risk:",e.data),this.incident.Status="Scheduled",pv.OQ.success("Incident forwarded to Risk module successfully!"),setTimeout(()=>{},2e3)}).catch(e=>{console.error("Error updating incident status:",e)})},confirmReject(){qe.A.put(`http://localhost:8000/incidents/${this.incident.IncidentId}/status/`,{status:"Rejected"}).then(e=>{console.log("Incident rejected:",e.data),this.incident.Status="Rejected",pv.OQ.success("Incident rejected successfully!")}).catch(e=>{console.error("Error updating incident status:",e)})},getPriorityClass(e){switch(e?.toLowerCase()){case"high":return"incident-priority-high";case"medium":return"incident-priority-medium";case"low":return"incident-priority-low";default:return""}},getRiskCategoryClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("security")?"incident-category-security":a.includes("compliance")?"incident-category-compliance":a.includes("operational")?"incident-category-operational":a.includes("financial")?"incident-category-financial":a.includes("strategic")?"incident-category-strategic":"incident-category-other"},getOriginClass(e){const a=e?.toLowerCase()||"";return a.includes("manual")?"incident-origin-manual":a.includes("audit")?"incident-origin-audit":a.includes("siem")?"incident-origin-siem":"incident-origin-other"},formatDate(e){if(!e)return"";const[a,t,i]=e.split("-");return`${t}/${i}/${a}`}}};const Tq=(0,se.A)(Aq,[["render",_q]]);var xq=Tq;const Fq={class:"audit-findings-container"},Vq={class:"audit-findings-header"},Mq={class:"incident-actions"},Xq={class:"incident-export-controls"},Uq=["disabled"],Nq={key:0},$q={key:1},Oq={key:0,class:"loading-container"},jq={key:1,class:"error-container"},Bq={key:2,class:"incident-findings-content"},Wq={class:"incident-summary-cards"},Qq={class:"card-content"},qq={class:"card-value"},Kq={class:"card-content"},Jq={class:"card-value"},zq={class:"card-content"},Hq={class:"card-value"},Yq={class:"card-content"},Gq={class:"card-value"},Zq={class:"card-content"},eK={class:"card-value"},aK={class:"card-content"},tK={class:"card-value"},iK={class:"incident-controls"},sK={class:"incident-search-controls"},oK={class:"incident-filters-wrapper"},lK={class:"incident-filters"},nK={class:"action-buttons"},rK={key:0,class:"actions-dropdown"},cK=["onClick"],dK=["onClick"],uK=["onClick"],pK=["onClick"],vK=["onClick"],mK=["onClick"],kK={key:0,class:"empty-state"},hK={class:"modal-content"},gK={key:0,class:"solve-container"},yK={class:"modal-footer"},fK={key:1,class:"rejected-container"},bK={class:"modal-footer"},CK={key:4,class:"assignment-workflow-section"},LK={class:"assignment-header"},wK={class:"assignment-body"},EK={class:"incident-summary"},RK={class:"incident-details"},DK={class:"user-selection"},IK={class:"user-form"},PK={class:"form-group"},_K=["value"],SK={class:"form-group"},AK=["value"],TK={class:"mitigation-workflow"},xK={key:0,class:"workflow-timeline"},FK={class:"step-number"},VK={class:"step-content"},MK=["onUpdate:modelValue"],XK={class:"step-actions"},UK=["onClick"],NK={key:1,class:"no-mitigations"},$K={class:"add-mitigation"},OK=["disabled"],jK={class:"due-date-section"},BK=["min"],WK={class:"assignment-notes-section"},QK={class:"assignment-actions"},qK=["disabled"];function KK(e,a,t,o,l,n){const r=(0,s.g2)("DynamicalSearch"),c=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Fq,[(0,s.Lk)("div",Vq,[a[30]||(a[30]=(0,s.Lk)("h1",null,"Audit Finding Incidents",-1)),(0,s.Lk)("div",Mq,[(0,s.Lk)("div",Xq,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.exportFormat=e),class:"incident-export-format-select"},a[28]||(a[28]=[(0,s.Fv)('<option value="xlsx" data-v-3a027c71>Excel (.xlsx)</option><option value="csv" data-v-3a027c71>CSV (.csv)</option><option value="pdf" data-v-3a027c71>PDF (.pdf)</option><option value="json" data-v-3a027c71>JSON (.json)</option><option value="xml" data-v-3a027c71>XML (.xml)</option><option value="txt" data-v-3a027c71>Text (.txt)</option>',6)]),512),[[i.u1,o.exportFormat]]),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>o.exportAuditFindings&&o.exportAuditFindings(...e)),class:"incident-export-btn",disabled:o.isExporting},[o.isExporting?((0,s.uX)(),(0,s.CE)("span",Nq,"Exporting...")):((0,s.uX)(),(0,s.CE)("span",$q,"Export"))],8,Uq)]),(0,s.Lk)("button",{class:"incident-refresh-btn",onClick:a[2]||(a[2]=(...e)=>o.fetchData&&o.fetchData(...e))},a[29]||(a[29]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1),(0,s.eW)(" Refresh ")]))])]),o.loading?((0,s.uX)(),(0,s.CE)("div",Oq,a[31]||(a[31]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("p",null,"Loading audit findings...",-1)]))):(0,s.Q3)("",!0),o.error?((0,s.uX)(),(0,s.CE)("div",jq,[a[32]||(a[32]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("p",null,(0,d.v_)(o.error),1),(0,s.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>o.fetchData&&o.fetchData(...e))},"Retry")])):(0,s.Q3)("",!0),o.loading||o.error?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Bq,[(0,s.Lk)("div",Wq,[(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card open-card",{active:"open"===o.filterStatus}]),onClick:a[4]||(a[4]=e=>o.filterByStatus("open"))},[a[34]||(a[34]=(0,s.Lk)("div",{class:"card-icon open"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"})],-1)),(0,s.Lk)("div",Qq,[a[33]||(a[33]=(0,s.Lk)("h3",null,"Open",-1)),(0,s.Lk)("div",qq,(0,d.v_)(o.summary.open||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card assigned-card",{active:"assigned"===o.filterStatus}]),onClick:a[5]||(a[5]=e=>o.filterByStatus("assigned"))},[a[36]||(a[36]=(0,s.Lk)("div",{class:"card-icon assigned"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",Kq,[a[35]||(a[35]=(0,s.Lk)("h3",null,"Assigned",-1)),(0,s.Lk)("div",Jq,(0,d.v_)(o.summary.assigned||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card closed-card",{active:"closed"===o.filterStatus}]),onClick:a[6]||(a[6]=e=>o.filterByStatus("closed"))},[a[38]||(a[38]=(0,s.Lk)("div",{class:"card-icon closed"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",zq,[a[37]||(a[37]=(0,s.Lk)("h3",null,"Closed",-1)),(0,s.Lk)("div",Hq,(0,d.v_)(o.summary.closed||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card rejected-card",{active:"rejected"===o.filterStatus}]),onClick:a[7]||(a[7]=e=>o.filterByStatus("rejected"))},[a[40]||(a[40]=(0,s.Lk)("div",{class:"card-icon rejected"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",Yq,[a[39]||(a[39]=(0,s.Lk)("h3",null,"Rejected",-1)),(0,s.Lk)("div",Gq,(0,d.v_)(o.summary.rejected||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card mitigated-card",{active:"scheduled"===o.filterStatus}]),onClick:a[8]||(a[8]=e=>o.filterByStatus("scheduled"))},[a[42]||(a[42]=(0,s.Lk)("div",{class:"card-icon mitigated"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"})],-1)),(0,s.Lk)("div",Zq,[a[41]||(a[41]=(0,s.Lk)("h3",null,"Mitigated to Risk",-1)),(0,s.Lk)("div",eK,(0,d.v_)(o.summary.mitigated||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card total-card",{active:"all"===o.filterStatus}]),onClick:a[9]||(a[9]=e=>o.filterByStatus("all"))},[a[44]||(a[44]=(0,s.Lk)("div",{class:"card-icon total"},[(0,s.Lk)("i",{class:"fas fa-list-alt"})],-1)),(0,s.Lk)("div",aK,[a[43]||(a[43]=(0,s.Lk)("h3",null,"Total Incidents",-1)),(0,s.Lk)("div",tK,(0,d.v_)(o.summary.total||0),1)])],2)]),(0,s.Lk)("div",iK,[(0,s.Lk)("div",sK,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":a[10]||(a[10]=e=>o.searchQuery=e),placeholder:"Search by title, ID, or description...",onInput:o.applyFilters,onSearch:o.applyFilters},null,8,["modelValue","onInput","onSearch"])]),(0,s.Lk)("div",oK,[(0,s.Lk)("div",lK,[(0,s.bF)(c,{modelValue:o.filterStatus,"onUpdate:modelValue":a[11]||(a[11]=e=>o.filterStatus=e),config:o.statusFilterConfig,onChange:o.applyFilters},null,8,["modelValue","config","onChange"]),(0,s.bF)(c,{modelValue:o.sortBy,"onUpdate:modelValue":a[12]||(a[12]=e=>o.sortBy=e),config:o.sortByConfig,onChange:o.applyFilters},null,8,["modelValue","config","onChange"])])])]),(0,s.Lk)("div",{class:(0,d.C4)(["incident-findings-table",{"dropdown-open":null!==o.dropdownOpenFor}])},[(0,s.Lk)("table",null,[a[52]||(a[52]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Incident ID"),(0,s.Lk)("th",null,"Title"),(0,s.Lk)("th",null,"Priority"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Origin"),(0,s.Lk)("th",null,"Date"),(0,s.Lk)("th",null,"Time"),(0,s.Lk)("th",null,"Description"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.findings,(e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t,class:(0,d.C4)(o.getRowClass(e.Status))},[(0,s.Lk)("td",null,(0,d.v_)(e.IncidentId),1),(0,s.Lk)("td",null,(0,d.v_)(e.IncidentTitle),1),(0,s.Lk)("td",null,(0,d.v_)(e.RiskPriority||"N/A"),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",o.getStatusClass(e.Status)]),style:{display:"inline-block !important",visibility:"visible !important"}},(0,d.v_)(e.Status||"Open"),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.Origin),1),(0,s.Lk)("td",null,(0,d.v_)(o.formatDate(e.Date)),1),(0,s.Lk)("td",null,(0,d.v_)(e.Time||"N/A"),1),(0,s.Lk)("td",null,(0,d.v_)(o.truncateText(e.Description,50)),1),(0,s.Lk)("td",null,[(0,s.Lk)("div",nK,[e.Status&&"Open"!==e.Status?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"view-details-btn",onClick:a=>o.viewDetails(e),title:"View Details"},a[51]||(a[51]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View Details ")]),8,mK)):((0,s.uX)(),(0,s.CE)("div",rK,[(0,s.Lk)("button",{class:(0,d.C4)(["actions-button",{active:o.dropdownOpenFor===t}]),onClick:e=>o.toggleActionDropdown(t)},[a[45]||(a[45]=(0,s.Lk)("i",{class:"fas fa-cog gear-icon"},null,-1)),a[46]||(a[46]=(0,s.eW)(" Actions ")),(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-chevron-down dropdown-arrow",{rotate:o.dropdownOpenFor===t}])},null,2)],10,cK),(0,s.Lk)("div",{class:(0,d.C4)(["actions-dropdown-menu",{show:o.dropdownOpenFor===t}])},[(0,s.Lk)("button",{class:"dropdown-item",onClick:a=>o.handleDropdownAction("view",e)},a[47]||(a[47]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View Details ")]),8,dK),(0,s.Lk)("button",{class:"dropdown-item",onClick:a=>o.handleDropdownAction("assign",e)},a[48]||(a[48]=[(0,s.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,s.eW)(" Assign as Incident ")]),8,uK),(0,s.Lk)("button",{class:"dropdown-item",onClick:a=>o.handleDropdownAction("escalate",e)},a[49]||(a[49]=[(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1),(0,s.eW)(" Escalate to Risk ")]),8,pK),(0,s.Lk)("button",{class:"dropdown-item",onClick:a=>o.handleDropdownAction("reject",e)},a[50]||(a[50]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject Incident ")]),8,vK)],2)]))])])],2))),128))])])],2),0===o.findings.length?((0,s.uX)(),(0,s.CE)("div",kK,a[53]||(a[53]=[(0,s.Lk)("i",{class:"fas fa-search"},null,-1),(0,s.Lk)("p",null,"No audit finding incidents match your criteria.",-1)]))):(0,s.Q3)("",!0)])),o.showModal&&"assign"!==o.modalAction?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"modal-overlay",onClick:a[19]||(a[19]=(...e)=>o.closeModal&&o.closeModal(...e))},[(0,s.Lk)("div",{class:"modal-container",onClick:a[18]||(a[18]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"modal-close-btn",onClick:a[13]||(a[13]=(...e)=>o.closeModal&&o.closeModal(...e))},"âœ•"),(0,s.Lk)("div",hK,["solve"===o.modalAction?((0,s.uX)(),(0,s.CE)("div",gK,[a[54]||(a[54]=(0,s.Lk)("div",{class:"solve-icon"},"ðŸ”„",-1)),a[55]||(a[55]=(0,s.Lk)("h3",{class:"modal-title solve"},"Forwarded to Risk",-1)),a[56]||(a[56]=(0,s.Lk)("p",{class:"modal-subtitle"},"You will be directed to the Risk module",-1)),(0,s.Lk)("div",yK,[(0,s.Lk)("button",{onClick:a[14]||(a[14]=(...e)=>o.confirmSolve&&o.confirmSolve(...e)),class:"modal-btn confirm-btn"},"Confirm Forward"),(0,s.Lk)("button",{onClick:a[15]||(a[15]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"modal-btn cancel-btn"},"Cancel")])])):"reject"===o.modalAction?((0,s.uX)(),(0,s.CE)("div",fK,[a[57]||(a[57]=(0,s.Lk)("div",{class:"rejected-icon"},"âœ•",-1)),a[58]||(a[58]=(0,s.Lk)("h3",{class:"modal-title rejected"},"REJECTED",-1)),(0,s.Lk)("div",bK,[(0,s.Lk)("button",{onClick:a[16]||(a[16]=(...e)=>o.confirmReject&&o.confirmReject(...e)),class:"modal-btn reject-btn"},"Confirm Reject"),(0,s.Lk)("button",{onClick:a[17]||(a[17]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"modal-btn cancel-btn"},"Cancel")])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),o.showAssignmentWorkflow?((0,s.uX)(),(0,s.CE)("div",CK,[(0,s.Lk)("div",LK,[(0,s.Lk)("button",{class:"back-btn",onClick:a[20]||(a[20]=(...e)=>o.closeAssignmentWorkflow&&o.closeAssignmentWorkflow(...e))},a[59]||(a[59]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Audit Findings ")]))]),(0,s.Lk)("div",wK,[(0,s.Lk)("div",EK,[(0,s.Lk)("h3",null,(0,d.v_)(o.selectedIncident.IncidentTitle||"Incident #"+o.selectedIncident.IncidentId),1),(0,s.Lk)("div",RK,[(0,s.Lk)("p",null,[a[60]||(a[60]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedIncident.IncidentId),1)]),(0,s.Lk)("p",null,[a[61]||(a[61]=(0,s.Lk)("strong",null,"Priority:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedIncident.RiskPriority),1)]),(0,s.Lk)("p",null,[a[62]||(a[62]=(0,s.Lk)("strong",null,"Origin:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedIncident.Origin),1)])])]),(0,s.Lk)("div",DK,[a[67]||(a[67]=(0,s.Lk)("h3",null,"Assignment Details",-1)),(0,s.Lk)("div",IK,[(0,s.Lk)("div",PK,[a[64]||(a[64]=(0,s.Lk)("label",{for:"assigner"},"Assigner:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[21]||(a[21]=e=>o.selectedAssigner=e),id:"assigner",class:"assign-select",required:""},[a[63]||(a[63]=(0,s.Lk)("option",{value:""},"Select Assigner",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.availableUsers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,_K))),128))],512),[[i.u1,o.selectedAssigner]])]),(0,s.Lk)("div",SK,[a[66]||(a[66]=(0,s.Lk)("label",{for:"reviewer"},"Reviewer:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[22]||(a[22]=e=>o.selectedReviewer=e),id:"reviewer",class:"assign-select",required:""},[a[65]||(a[65]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.availableUsers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,AK))),128))],512),[[i.u1,o.selectedReviewer]])])])]),(0,s.Lk)("div",TK,[a[74]||(a[74]=(0,s.Lk)("h3",null,"Mitigation Steps",-1)),o.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",xK,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.mitigationSteps,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"workflow-step"},[(0,s.Lk)("div",FK,(0,d.v_)(t+1),1),(0,s.Lk)("div",VK,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.description=a,class:"mitigation-textarea",placeholder:"Enter mitigation step description"},null,8,MK),[[i.Jo,e.description]]),(0,s.Lk)("div",XK,[(0,s.Lk)("button",{onClick:e=>o.removeMitigationStep(t),class:"remove-step-btn"},a[68]||(a[68]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1),(0,s.eW)(" Remove ")]),8,UK)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",NK,a[69]||(a[69]=[(0,s.Lk)("p",null,"No mitigation steps found for this incident. Add steps below.",-1)]))),(0,s.Lk)("div",$K,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[23]||(a[23]=e=>o.newMitigationStep=e),class:"mitigation-textarea",placeholder:"Enter mitigation step description(s). You can add multiple steps by separating them with commas or new lines."},null,512),[[i.Jo,o.newMitigationStep]]),(0,s.Lk)("button",{onClick:a[24]||(a[24]=(...e)=>o.addMitigationStep&&o.addMitigationStep(...e)),class:"add-step-btn",disabled:!o.newMitigationStep.trim()},a[70]||(a[70]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Mitigation Step ")]),8,OK)]),(0,s.Lk)("div",jK,[a[71]||(a[71]=(0,s.Lk)("h4",null,"Due Date for Mitigation Completion",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[25]||(a[25]=e=>o.mitigationDueDate=e),class:"due-date-input",min:o.getTodayDate()},null,8,BK),[[i.Jo,o.mitigationDueDate]])]),(0,s.Lk)("div",WK,[a[72]||(a[72]=(0,s.Lk)("h4",null,"Assignment Notes (Optional)",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[26]||(a[26]=e=>o.assignmentNotes=e),class:"assignment-notes-textarea",placeholder:"Add any specific instructions or notes for the assignees...",rows:"3"},null,512),[[i.Jo,o.assignmentNotes]])]),(0,s.Lk)("div",QK,[(0,s.Lk)("button",{onClick:a[27]||(a[27]=(...e)=>o.confirmAssignmentWorkflow&&o.confirmAssignmentWorkflow(...e)),class:"submit-assignment-btn",disabled:!o.selectedAssigner||!o.selectedReviewer||0===o.mitigationSteps.length||!o.mitigationDueDate},a[73]||(a[73]=[(0,s.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,s.eW)(" Assign Incident with Mitigations ")]),8,qK)])])])])):(0,s.Q3)("",!0),(0,s.bF)(u)])}var JK=t(2018),zK={name:"AuditFindings",components:{PopupModal:pv.wA,DynamicalSearch:JK.A,CustomDropdown:mt.A},setup(){const e=(0,ae.rd)(),a=(0,ee.KR)([]),t=(0,ee.KR)(!0),i=(0,ee.KR)(null),o=(0,ee.KR)({}),l=(0,ee.KR)(!1),n=(0,ee.KR)(""),r=(0,ee.KR)(null),c=(0,ee.KR)(!1),d=(0,ee.KR)(""),u=(0,ee.KR)(""),p=(0,ee.KR)(""),v=(0,ee.KR)([]),m=(0,ee.KR)([]),k=(0,ee.KR)(""),h=(0,ee.KR)(""),g=(0,ee.KR)("all"),y=(0,ee.KR)("Date"),f=(0,ee.KR)("xlsx"),b=(0,ee.KR)(!1),C=(0,ee.KR)(null),L=(0,ee.KR)(""),w={name:"Status",values:[{value:"all",label:"All Status"},{value:"open",label:"Open"},{value:"assigned",label:"Assigned"},{value:"closed",label:"Closed"},{value:"rejected",label:"Rejected"},{value:"scheduled",label:"Escalated to Risk"}],defaultValue:"all"},E={name:"Sort By",values:[{value:"Date",label:"Date (Newest First)"},{value:"IncidentTitle",label:"Title"},{value:"RiskPriority",label:"Priority"},{value:"Status",label:"Status"}],defaultValue:"Date"},R=async()=>{t.value=!0,i.value=null;try{const e={};"all"!==g.value&&(e.status=g.value),e.sort=y.value,e.order="Date"===y.value?"desc":"asc",L.value&&(e.search=L.value);const t=await qe.A.get("http://localhost:8000/api/audit-findings/",{params:e});if(!t.data||!t.data.success)throw new Error(t.data?.message||"Failed to load audit finding incidents");a.value=t.data.data||[],o.value=t.data.summary||{}}catch(e){console.error("Error fetching audit finding incidents:",e),i.value=e.message||"Failed to load audit finding incidents. Please try again."}finally{t.value=!1}},D=()=>{R()},I=e=>{g.value=e,D()},P=e=>e&&"Open"!==e?"Assigned"===e?"row-assigned":"Closed"===e?"row-closed":"Rejected"===e?"row-rejected":"Scheduled"===e?"row-escalated":"":"row-open",_=e=>e&&"Open"!==e?"Assigned"===e?"status-assigned":"Closed"===e?"status-closed":"Rejected"===e?"status-rejected":"Scheduled"===e?"status-escalated":"":"status-open",S=a=>{e.push(`/incident/audit-finding-details/${a.IncidentId}`)},A=e=>{r.value=e,n.value="solve",l.value=!0},T=e=>{r.value=e,n.value="reject",l.value=!0},x=e=>{r.value=e,c.value=!0,d.value="",u.value="",p.value="",k.value="",h.value="",B(),console.log("Selected incident:",e),console.log("Incident Mitigation field:",e.Mitigation),N(e)},F=()=>{l.value=!1,r.value=null,d.value="",u.value="",p.value=""},V=()=>{c.value=!1,r.value=null,d.value="",u.value="",p.value="",m.value=[],k.value="",h.value=""},M=()=>{if(!k.value.trim())return;const e=k.value.split(/[,\n]/).filter(e=>e.trim());e.forEach(e=>{m.value.push({description:e.trim(),status:"Not Started"})}),k.value=""},X=e=>{m.value.splice(e,1)},U=()=>{const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${i}`},N=e=>{if(m.value=[],e.Mitigation)try{let t=e.Mitigation;if("string"===typeof t&&(t.trim().startsWith("{")||t.trim().startsWith("[")))try{t=JSON.parse(t)}catch(a){console.log("Mitigation data is not JSON, treating as plain text")}if("string"===typeof t){const e=t.split(/[,\n]/).filter(e=>e.trim());m.value=e.map(e=>({description:e.trim(),status:"Not Started"}))}else Array.isArray(t)?m.value=t.map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})):"object"===typeof t&&(m.value=Object.values(t).map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})));console.log("Loaded existing mitigation steps:",m.value)}catch(i){console.error("Error parsing mitigation data:",i),m.value=[{description:e.Mitigation,status:"Not Started"}]}0===m.value.length&&console.log("No existing mitigation steps found")},$=()=>{if(!d.value||!u.value)return void pv.OQ.error("Please select both assigner and reviewer");if(d.value===u.value)return void pv.OQ.error("Assigner and reviewer cannot be the same person");if(0===m.value.length)return void pv.OQ.error("Please add at least one mitigation step");if(!h.value)return void pv.OQ.error("Please select a due date");console.log("Assigning incident:",r.value.IncidentId);const a=v.value.find(e=>e.id===d.value),t=v.value.find(e=>e.id===u.value),i={};m.value.forEach((e,a)=>{i[a+1]=e.description}),qe.A.put(`http://localhost:8000/api/incidents/${r.value.IncidentId}/assign/`,{status:"In Progress",assigner_id:d.value,assigner_name:a.name,reviewer_id:u.value,reviewer_name:t.name,assignment_notes:p.value,assigned_date:(new Date).toISOString(),mitigations:i,due_date:h.value}).then(a=>{console.log("Incident assigned successfully - API response:",a.data),pv.OQ.success(`Incident ${r.value.IncidentId} assigned successfully with mitigation steps!`),R(),V(),setTimeout(()=>{e.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error assigning incident:",e),pv.OQ.error("Failed to assign incident. Please try again.")})},O=()=>{console.log("Escalating incident to risk:",r.value.IncidentId),qe.A.put(`http://localhost:8000/api/incidents/${r.value.IncidentId}/status/`,{status:"Scheduled"}).then(a=>{console.log("Incident escalated to risk - API response:",a.data),pv.OQ.success(`Incident ${r.value.IncidentId} escalated to Risk successfully!`),R(),F(),setTimeout(()=>{e.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating incident status:",e),pv.OQ.error("Failed to escalate incident. Please try again.")})},j=()=>{console.log("Rejecting incident:",r.value.IncidentId),qe.A.put(`http://localhost:8000/api/incidents/${r.value.IncidentId}/status/`,{status:"Rejected",rejection_source:"INCIDENT"}).then(a=>{console.log("Incident rejected - API response:",a.data),pv.OQ.success(`Incident ${r.value.IncidentId} rejected successfully!`),R(),F(),setTimeout(()=>{e.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating incident status:",e),pv.OQ.error("Failed to reject incident. Please try again.")})},B=async()=>{try{const e=await qe.A.get("http://localhost:8000/api/users/");v.value=e.data.map(e=>({id:e.UserId,name:e.UserName,role:e.role})),console.log("Fetched users:",v.value)}catch(e){console.error("Failed to fetch users:",e),v.value=[]}},W=e=>{if(!e)return"N/A";const a=new Date(e);return a.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},Q=(e,a)=>e?e.length>a?e.substring(0,a)+"...":e:"N/A",q=async()=>{b.value=!0;const e=a.value;try{const a=await qe.A.post("http://localhost:8000/api/audit-findings/export/",{file_format:f.value,data:JSON.stringify(e),user_id:"audit_user",options:JSON.stringify({filters:{filterStatus:g.value,sortBy:y.value}})});if(console.log("Export successful:",a.data),a.data&&a.data.file_url){const e=document.createElement("a");e.href=a.data.file_url,e.setAttribute("download",a.data.file_name||`audit_findings.${f.value}`),document.body.appendChild(e),e.click(),document.body.removeChild(e),pv.OQ.success("Export completed successfully")}}catch(t){console.error("Export failed:",t),pv.OQ.error("Export failed. Please try again.")}finally{b.value=!1}},K=e=>{C.value!==e?C.value=e:C.value=null},J=()=>{C.value=null},z=e=>{e.target.closest(".actions-dropdown")||J()},H=(e,a)=>{switch(J(),e){case"view":S(a);break;case"assign":x(a);break;case"escalate":A(a);break;case"reject":T(a);break}};return(0,s.sV)(()=>{R(),B(),document.addEventListener("click",z)}),(0,s.hi)(()=>{document.removeEventListener("click",z)}),{findings:a,loading:t,error:i,summary:o,statusFilterConfig:w,sortByConfig:E,showModal:l,modalAction:n,selectedIncident:r,showAssignmentWorkflow:c,selectedAssigner:d,selectedReviewer:u,assignmentNotes:p,availableUsers:v,mitigationSteps:m,newMitigationStep:k,mitigationDueDate:h,filterStatus:g,sortBy:y,exportFormat:f,isExporting:b,dropdownOpenFor:C,searchQuery:L,fetchData:R,fetchUsers:B,applyFilters:D,filterByStatus:I,getRowClass:P,getStatusClass:_,viewDetails:S,toggleActionDropdown:K,closeAllDropdowns:J,handleDropdownAction:H,openSolveModal:A,openRejectModal:T,openAssignModal:x,closeModal:F,closeAssignmentWorkflow:V,addMitigationStep:M,removeMitigationStep:X,getTodayDate:U,loadExistingMitigations:N,confirmAssignmentWorkflow:$,confirmSolve:O,confirmReject:j,formatDate:W,truncateText:Q,exportAuditFindings:q}}};const HK=(0,se.A)(zK,[["render",KK],["__scopeId","data-v-3a027c71"]]);var YK=HK;const GK={class:"risk-view-container"},ZK={class:"risk-view-header"},eJ={key:0,class:"risk-view-no-data"},aJ={key:1,class:"risk-view-no-data"},tJ={key:2,class:"risk-view-details-card"},iJ={class:"risk-view-details-top"},sJ={class:"risk-view-id-section"},oJ={class:"risk-view-id-value"},lJ={class:"risk-view-meta"},nJ={class:"risk-view-category"},rJ={class:"risk-view-title-section"},cJ={class:"risk-view-compliance-section"},dJ={class:"risk-view-compliance-value"},uJ={class:"risk-view-content"},pJ={class:"risk-view-content-row"},vJ={class:"risk-view-content-column"},mJ={class:"risk-view-section-content"},kJ={class:"risk-view-content-column"},hJ={class:"risk-view-section-content"},gJ={class:"risk-view-content-row"},yJ={class:"risk-view-content-column"},fJ={class:"risk-view-section-content"},bJ={class:"risk-view-content-column"},CJ={class:"risk-view-section-content"},LJ={class:"risk-view-content-row"},wJ={class:"risk-view-content-column"},EJ={class:"risk-view-section-content"},RJ={class:"risk-view-content-column"},DJ={class:"risk-view-section-content"},IJ={class:"risk-view-content-row"},PJ={class:"risk-view-content-column"},_J={class:"risk-view-section-content"},SJ={class:"risk-view-content-column"},AJ={class:"risk-view-section-content"},TJ={class:"risk-view-content-row"},xJ={class:"risk-view-content-column"},FJ={class:"risk-view-section-content"},VJ={class:"risk-view-content-column"},MJ={class:"risk-view-section-content"},XJ={key:0,class:"risk-view-actions"};function UJ(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",GK,[(0,s.bF)(n),(0,s.Lk)("div",ZK,[a[4]||(a[4]=(0,s.Lk)("h2",{class:"risk-view-title"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle risk-view-icon"}),(0,s.eW)(" Audit Finding Details")],-1)),(0,s.Lk)("button",{class:"risk-view-back-button",onClick:a[0]||(a[0]=(...e)=>l.goBack&&l.goBack(...e))},a[3]||(a[3]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Audit Findings ")]))]),o.loading?((0,s.uX)(),(0,s.CE)("div",eJ," Loading audit finding details... ")):o.error?((0,s.uX)(),(0,s.CE)("div",aJ,(0,d.v_)(o.error),1)):o.auditFinding?((0,s.uX)(),(0,s.CE)("div",tJ,[(0,s.Lk)("div",iJ,[(0,s.Lk)("div",sJ,[a[5]||(a[5]=(0,s.Lk)("span",{class:"risk-view-id-label"},"Audit Finding ID:",-1)),(0,s.Lk)("span",oJ,(0,d.v_)(o.auditFinding.IncidentId),1)]),(0,s.Lk)("div",lJ,[(0,s.Lk)("div",nJ,(0,d.v_)(o.auditFinding.RiskCategory||"N/A"),1),(0,s.Lk)("div",{class:(0,d.C4)(["risk-view-criticality",l.getCriticalityClass(o.auditFinding.Criticality)])},(0,d.v_)(o.auditFinding.Criticality||"N/A"),3)])]),(0,s.Lk)("div",rJ,[(0,s.Lk)("h3",null,(0,d.v_)(o.auditFinding.IncidentTitle),1),(0,s.Lk)("div",cJ,[a[6]||(a[6]=(0,s.Lk)("span",{class:"risk-view-compliance-label"},"Compliance ID:",-1)),(0,s.Lk)("span",dJ,(0,d.v_)(o.auditFinding.ComplianceId||"N/A"),1)])]),(0,s.Lk)("div",uJ,[(0,s.Lk)("div",pJ,[(0,s.Lk)("div",vJ,[a[7]||(a[7]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Description:",-1)),(0,s.Lk)("div",mJ,(0,d.v_)(o.auditFinding.Description||"N/A"),1)]),(0,s.Lk)("div",kJ,[a[8]||(a[8]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Business Impact:",-1)),(0,s.Lk)("div",hJ,(0,d.v_)(o.auditFinding.InitialImpactAssessment||"N/A"),1)])]),(0,s.Lk)("div",gJ,[(0,s.Lk)("div",yJ,[a[9]||(a[9]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Possible Damage:",-1)),(0,s.Lk)("div",fJ,(0,d.v_)(o.auditFinding.PossibleDamage||"N/A"),1)]),(0,s.Lk)("div",bJ,[a[10]||(a[10]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Status:",-1)),(0,s.Lk)("div",CJ,(0,d.v_)(o.auditFinding.Status||"N/A"),1)])]),(0,s.Lk)("div",LJ,[(0,s.Lk)("div",wJ,[a[11]||(a[11]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Systems/Assets Involved:",-1)),(0,s.Lk)("div",EJ,(0,d.v_)(o.auditFinding.SystemsAssetsInvolved||"N/A"),1)]),(0,s.Lk)("div",RJ,[a[12]||(a[12]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Geographic Location:",-1)),(0,s.Lk)("div",DJ,(0,d.v_)(o.auditFinding.GeographicLocation||"N/A"),1)])]),(0,s.Lk)("div",IJ,[(0,s.Lk)("div",PJ,[a[13]||(a[13]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Mitigation Plan:",-1)),(0,s.Lk)("div",_J,(0,d.v_)(o.auditFinding.Mitigation||"N/A"),1)]),(0,s.Lk)("div",SJ,[a[14]||(a[14]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Comments:",-1)),(0,s.Lk)("div",AJ,(0,d.v_)(o.auditFinding.Comments||"N/A"),1)])]),(0,s.Lk)("div",TJ,[(0,s.Lk)("div",xJ,[a[15]||(a[15]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Created At:",-1)),(0,s.Lk)("div",FJ,(0,d.v_)(l.formatDate(o.auditFinding.Date)),1)]),(0,s.Lk)("div",VJ,[a[16]||(a[16]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Time:",-1)),(0,s.Lk)("div",MJ,(0,d.v_)(o.auditFinding.Time||"N/A"),1)])])]),"Open"===o.auditFinding.Status?((0,s.uX)(),(0,s.CE)("div",XJ,[(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>l.openSolveModal&&l.openSolveModal(...e)),class:"risk-view-action-button risk-view-escalate"},a[17]||(a[17]=[(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1),(0,s.eW)(" ESCALATE TO RISK ")])),(0,s.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>l.openRejectModal&&l.openRejectModal(...e)),class:"risk-view-action-button risk-view-reject"},a[18]||(a[18]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" REJECT AUDIT FINDING ")]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])}var NJ={name:"AuditFindingDetails",components:{PopupModal:pv.wA},data(){return{auditFinding:null,loading:!0,error:null}},async created(){await this.fetchAuditFindingDetails()},methods:{async fetchAuditFindingDetails(){try{this.loading=!0,this.error=null;const e=this.$route.params.id,a=await qe.A.get(`http://localhost:8000/api/audit-findings/incident/${e}/`);if(!a.data.success)throw new Error(a.data.message||"Failed to fetch audit finding details");this.auditFinding=a.data.data}catch(e){console.error("Failed to fetch audit finding details:",e),this.error="Failed to load audit finding details. Please try again."}finally{this.loading=!1}},getCriticalityClass(e){return e?(e=e.toLowerCase(),"critical"===e?"risk-view-priority-critical":"high"===e?"risk-view-priority-high":"medium"===e?"risk-view-priority-medium":"low"===e?"risk-view-priority-low":""):""},formatDate(e){if(!e)return"N/A";const[a,t,i]=e.split("-");return`${t}/${i}/${a}`},goBack(){this.$router.push("/incident/audit-findings")},openSolveModal(){pv.OQ.confirm("This audit finding will be forwarded to the Risk module. Do you want to proceed?","Forward to Risk",()=>this.confirmSolve(),()=>{})},openRejectModal(){pv.OQ.confirm("Are you sure you want to reject this audit finding?","Reject Audit Finding",()=>this.confirmReject(),()=>{})},confirmSolve(){qe.A.put(`http://localhost:8000/api/incidents/${this.auditFinding.IncidentId}/status/`,{status:"Scheduled"}).then(()=>{this.auditFinding.Status="Scheduled",pv.OQ.success(`Incident ${this.auditFinding.IncidentId} escalated to Risk successfully!`),setTimeout(()=>{this.$router.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating audit finding status:",e),pv.OQ.error("Failed to escalate audit finding. Please try again.")})},confirmReject(){qe.A.put(`http://localhost:8000/api/incidents/${this.auditFinding.IncidentId}/status/`,{status:"Rejected"}).then(()=>{this.auditFinding.Status="Rejected",pv.OQ.success(`Incident ${this.auditFinding.IncidentId} rejected successfully!`),setTimeout(()=>{this.$router.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating audit finding status:",e),pv.OQ.error("Failed to reject audit finding. Please try again.")})}}};const $J=(0,se.A)(NJ,[["render",UJ],["__scopeId","data-v-f810d432"]]);var OJ=$J;const jJ={class:"workflow-container incident-workflow-container user-tasks-container"},BJ={key:0},WJ={class:"user-filter"},QJ={class:"tabs",style:{border:"3px solid blue",width:"100%",display:"flex !important"}},qJ={key:0,class:"loading"},KJ={key:1,class:"error-message"},JJ={key:2},zJ={key:0,class:"no-data"},HJ={key:1,class:"no-data"},YJ={key:2},GJ={class:"debug-section",style:{"margin-bottom":"15px"}},ZJ={class:"approved-section"},ez={class:"status-title"},az={key:0,class:"user-tasks-table-responsive"},tz={class:"user-tasks-table"},iz={class:"id-column"},sz={class:"title-column"},oz={class:"title-text"},lz={class:"origin-column"},nz={class:"priority-column"},rz={class:"date-column"},cz={class:"actions-column"},dz=["onClick"],uz={key:1,class:"no-data"},pz={class:"rejected-section"},vz={class:"status-title"},mz={key:0},kz={class:"user-tasks-table-responsive"},hz={class:"user-tasks-table"},gz={class:"id-column"},yz={class:"title-column"},fz={class:"title-text"},bz={class:"origin-column"},Cz={class:"priority-column"},Lz={class:"date-column"},wz={class:"actions-column"},Ez=["onClick"],Rz={key:1,class:"no-data"},Dz={class:"pending-review-section"},Iz={class:"status-title"},Pz={key:0},_z={class:"user-tasks-table-responsive"},Sz={class:"user-tasks-table"},Az={class:"id-column"},Tz={class:"title-column"},xz={class:"title-text"},Fz={class:"origin-column"},Vz={class:"priority-column"},Mz={class:"date-column"},Xz={class:"actions-column"},Uz=["onClick"],Nz={key:1,class:"no-data"},$z={class:"assigned-section"},Oz={class:"status-title"},jz={key:0,class:"user-tasks-table-responsive"},Bz={class:"user-tasks-table"},Wz={class:"id-column"},Qz={class:"title-column"},qz={class:"title-text"},Kz={class:"origin-column"},Jz={class:"priority-column"},zz={class:"date-column"},Hz={class:"actions-column"},Yz=["onClick"],Gz={key:1,class:"no-data"},Zz={key:3,class:"reviewer-tasks-section"},eH={key:0,class:"no-data"},aH={key:1,class:"no-data"},tH={key:2},iH={class:"pending-review-section"},sH={class:"status-title"},oH={key:0,class:"user-tasks-table-responsive"},lH={class:"user-tasks-table"},nH={class:"id-column"},rH={class:"title-column"},cH={class:"title-text"},dH={class:"origin-column"},uH={class:"priority-column"},pH={class:"date-column"},vH={class:"actions-column"},mH=["onClick"],kH={key:1,class:"no-data"},hH={class:"approved-section"},gH={class:"status-title"},yH={key:0,class:"user-tasks-table-responsive"},fH={class:"user-tasks-table"},bH={class:"id-column"},CH={class:"title-column"},LH={class:"title-text"},wH={class:"origin-column"},EH={class:"priority-column"},RH={class:"date-column"},DH={class:"actions-column"},IH=["onClick"],PH={key:1,class:"no-data"},_H={key:1,class:"workflow-fullscreen",style:{display:"block !important","z-index":"1001 !important"}},SH={class:"back-to-tasks"},AH={key:0,class:"rejection-banner"},TH={key:1,class:"loading"},xH={key:2,class:"no-data"},FH={key:3,class:"simplified-workflow"},VH={class:"timeline"},MH={class:"step-circle"},XH={key:0},UH={key:1},NH={class:"step-box"},$H={key:0,class:"approval-indicator approved"},OH={key:1,class:"approval-indicator rejected"},jH={key:0,class:"rejection-remarks"},BH={key:2,class:"approval-indicator pending"},WH={key:3,class:"submission-date user-date"},QH={key:4,class:"submission-date reviewer-date"},qH={key:5,class:"step-inputs"},KH={key:0,class:"previous-comments-display"},JH={class:"previous-comments-content"},zH={class:"input-group"},HH={for:"comments"},YH=["onUpdate:modelValue","placeholder"],GH={class:"file-upload"},ZH={class:"upload-btn"},eY=["onChange"],aY={key:0,class:"file-uploading"},tY={key:1,class:"file-name"},iY={class:"status-control"},sY=["onClick"],oY={key:6,class:"step-readonly"},lY={key:0,class:"comments-display"},nY={key:1,class:"file-display"},rY=["href","download"],cY={key:0,class:"assessment-rejection-notice"},dY={class:"assessment-rejection-feedback"},uY={key:1,class:"completion-notice"},pY={key:2,class:"questionnaire-section"},vY={class:"questionnaire-form"},mY={class:"question-group"},kY={class:"input-with-prefix"},hY={class:"question-group"},gY={class:"question-group"},yY={class:"question-group"},fY={class:"question-group"},bY={class:"question-group"},CY={class:"input-with-prefix"},LY={class:"question-group"},wY={class:"input-with-suffix"},EY={class:"question-group"},RY={class:"input-with-suffix"},DY={class:"question-group"},IY={class:"question-group"},PY={class:"questionnaire-actions"},_Y=["disabled"],SY={key:2,class:"reviewer-workflow-fullscreen"},AY={class:"back-to-tasks"},TY={key:0,class:"loading"},xY={key:1},FY={class:"incident-summary"},VY={key:0,class:"questionnaire-review-section"},MY={class:"questionnaire-review-grid"},XY={key:0,class:"questionnaire-item"},UY={key:1,class:"questionnaire-item"},NY={key:2,class:"questionnaire-item"},$Y={key:3,class:"questionnaire-item"},OY={key:4,class:"questionnaire-item"},jY={key:5,class:"questionnaire-item"},BY={key:6,class:"questionnaire-item"},WY={key:7,class:"questionnaire-item"},QY={key:8,class:"questionnaire-item"},qY={key:9,class:"questionnaire-item"},KY={key:10,class:"questionnaire-item"},JY={key:0,class:"assessment-approval-section"},zY={class:"assessment-controls"},HY={key:0,class:"assessment-feedback-section"},YY={key:1,class:"assessment-status-display"},GY={key:0,class:"assessment-feedback-display"},ZY={key:0,class:"status-message"},eG={key:1,class:"status-message"},aG={class:"mitigation-review-list"},tG=["data-id"],iG={class:"mitigation-heading"},sG={class:"mitigation-split-content"},oG={class:"mitigation-previous"},lG={key:0,class:"mitigation-content"},nG={key:0,class:"comments-section"},rG={class:"comments-text"},cG={key:1,class:"evidence-section"},dG=["href","filename"],uG={key:1,class:"mitigation-empty"},pG={class:"mitigation-current"},vG={class:"mitigation-content"},mG={key:0,class:"comments-section"},kG={class:"comments-text"},hG={key:1,class:"evidence-section"},gG=["href","filename"],yG={class:"approval-controls"},fG={key:0,class:"approval-buttons"},bG=["onClick"],CG=["onClick"],LG={key:1,class:"remarks-field"},wG=["onUpdate:modelValue"],EG=["onClick"],RG=["onClick"],DG={key:2,class:"approved-readonly"},IG={key:0,class:"approved-actions"},PG=["onClick"],_G={key:3,class:"reviewer-remarks-display"},SG={class:"review-actions"},AG=["disabled"],TG=["disabled"],xG={key:0,class:"review-complete-notice"},FG={key:1,class:"review-warning"};function VG(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",jJ,[l.showMitigationWorkflow||l.showReviewerWorkflow?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",BJ,[a[74]||(a[74]=(0,s.Lk)("div",{class:"incident-form-page-header"},[(0,s.Lk)("h1",{class:"incident-form-page-title"},"User Task Management")],-1)),(0,s.Lk)("div",WJ,[(0,s.bF)(r,{modelValue:l.selectedUserId,"onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedUserId=e),config:l.userFilterConfig,onChange:n.fetchData},null,8,["modelValue","config","onChange"])]),(0,s.Lk)("div",QJ,[(0,s.Lk)("div",{class:(0,d.C4)(["tab",{active:"user"===l.activeTab}]),onClick:a[1]||(a[1]=e=>l.activeTab="user"),style:{border:"2px solid green",display:"block !important",flex:"1"}}," My Tasks ("+(0,d.v_)(l.userIncidents.length)+") ",3),(0,s.Lk)("div",{class:(0,d.C4)(["tab",{active:"reviewer"===l.activeTab}]),onClick:a[2]||(a[2]=(...e)=>n.switchToReviewerTab&&n.switchToReviewerTab(...e)),style:{border:"2px solid orange",display:"block !important",flex:"1"}}," Reviewer Tasks ("+(0,d.v_)(l.reviewerTasks.length)+") ",3)]),l.loading?((0,s.uX)(),(0,s.CE)("div",qJ," Loading data... ")):l.error?((0,s.uX)(),(0,s.CE)("div",KJ,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),"user"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",JJ,[l.selectedUserId?0===l.userIncidents.length?((0,s.uX)(),(0,s.CE)("div",HJ,a[35]||(a[35]=[(0,s.Lk)("p",null,"No tasks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",YJ,[(0,s.Lk)("div",GJ,[(0,s.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>n.testEndpoints&&n.testEndpoints(...e)),class:"debug-btn",style:{background:"#333",color:"white",padding:"5px 10px","border-radius":"4px"}}," Test API Endpoints ")]),(0,s.Lk)("div",ZJ,[(0,s.Lk)("div",{class:"status-header approved",onClick:a[4]||(a[4]=e=>n.toggleSection("approved"))},[a[37]||(a[37]=(0,s.Lk)("span",{class:"status-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("span",ez,"Approved ("+(0,d.v_)(l.approvedIncidents.length)+")",1),(0,s.Lk)("span",{class:(0,d.C4)(["arrow-indicator",{expanded:l.expandedSections.approved}])},a[36]||(a[36]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),2)]),(0,s.Lk)("div",{class:(0,d.C4)(["collapsible-content",{expanded:l.expandedSections.approved}])},[l.approvedIncidents.length>0?((0,s.uX)(),(0,s.CE)("div",az,[(0,s.Lk)("table",tz,[a[40]||(a[40]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{style:{width:"8%"}},"ID"),(0,s.Lk)("th",{style:{width:"30%"}},"Title"),(0,s.Lk)("th",{style:{width:"15%"}},"Origin"),(0,s.Lk)("th",{style:{width:"15%"}},"Priority"),(0,s.Lk)("th",{style:{width:"15%"}},"Due Date"),(0,s.Lk)("th",{style:{width:"17%"}},"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.approvedIncidents,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"status-approved"},[(0,s.Lk)("td",iz,(0,d.v_)(e.id),1),(0,s.Lk)("td",sz,[a[38]||(a[38]=(0,s.Lk)("span",{class:"status-dot approved"},null,-1)),(0,s.Lk)("span",oz,(0,d.v_)(e.Title),1)]),(0,s.Lk)("td",lz,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",nz,[(0,s.Lk)("span",{class:(0,d.C4)(["priority-badge",e.Priority?.toLowerCase()])},(0,d.v_)(e.Priority),3)]),(0,s.Lk)("td",rz,(0,d.v_)(n.formatDate(e.MitigationDueDate)),1),(0,s.Lk)("td",cz,[(0,s.Lk)("button",{onClick:a=>n.viewMitigations(e.id),class:"view-btn approved-incident"},a[39]||(a[39]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" View ")]),8,dz)])]))),128))])])])):((0,s.uX)(),(0,s.CE)("div",uz,a[41]||(a[41]=[(0,s.Lk)("p",null,"No approved tasks found.",-1)])))],2)]),(0,s.Lk)("div",pz,[(0,s.Lk)("div",{class:"status-header rejected",onClick:a[5]||(a[5]=e=>n.toggleSection("rejected"))},[a[43]||(a[43]=(0,s.Lk)("span",{class:"status-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("span",vz,"Rejected ("+(0,d.v_)(l.rejectedIncidents.length)+")",1),(0,s.Lk)("span",{class:(0,d.C4)(["arrow-indicator",{expanded:l.expandedSections.rejected}])},a[42]||(a[42]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),2)]),(0,s.Lk)("div",{class:(0,d.C4)(["collapsible-content",{expanded:l.expandedSections.rejected}])},[l.rejectedIncidents.length>0?((0,s.uX)(),(0,s.CE)("div",mz,[(0,s.Lk)("div",kz,[(0,s.Lk)("table",hz,[a[46]||(a[46]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{style:{width:"8%"}},"ID"),(0,s.Lk)("th",{style:{width:"30%"}},"Title"),(0,s.Lk)("th",{style:{width:"15%"}},"Origin"),(0,s.Lk)("th",{style:{width:"15%"}},"Priority"),(0,s.Lk)("th",{style:{width:"15%"}},"Due Date"),(0,s.Lk)("th",{style:{width:"17%"}},"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.rejectedIncidents,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"status-rejected"},[(0,s.Lk)("td",gz,(0,d.v_)(e.id),1),(0,s.Lk)("td",yz,[a[44]||(a[44]=(0,s.Lk)("span",{class:"status-dot rejected"},null,-1)),(0,s.Lk)("span",fz,(0,d.v_)(e.Title),1)]),(0,s.Lk)("td",bz,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",Cz,[(0,s.Lk)("span",{class:(0,d.C4)(["priority-badge",e.Priority?.toLowerCase()])},(0,d.v_)(e.Priority),3)]),(0,s.Lk)("td",Lz,(0,d.v_)(n.formatDate(e.MitigationDueDate)),1),(0,s.Lk)("td",wz,[(0,s.Lk)("button",{onClick:a=>n.viewMitigations(e.id),class:"view-btn rejected-incident"},a[45]||(a[45]=[(0,s.Lk)("i",{class:"fas fa-redo"},null,-1),(0,s.eW)(" Resubmit ")]),8,Ez)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",Rz,a[47]||(a[47]=[(0,s.Lk)("p",null,"No rejected tasks found.",-1)])))],2)]),(0,s.Lk)("div",Dz,[(0,s.Lk)("div",{class:"status-header pending-review",onClick:a[6]||(a[6]=e=>n.toggleSection("pendingReview"))},[a[49]||(a[49]=(0,s.Lk)("span",{class:"status-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})],-1)),(0,s.Lk)("span",Iz,"Pending Review ("+(0,d.v_)(l.pendingReviewIncidents.length)+")",1),(0,s.Lk)("span",{class:(0,d.C4)(["arrow-indicator",{expanded:l.expandedSections.pendingReview}])},a[48]||(a[48]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),2)]),(0,s.Lk)("div",{class:(0,d.C4)(["collapsible-content",{expanded:l.expandedSections.pendingReview}])},[l.pendingReviewIncidents.length>0?((0,s.uX)(),(0,s.CE)("div",Pz,[(0,s.Lk)("div",_z,[(0,s.Lk)("table",Sz,[a[52]||(a[52]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{style:{width:"8%"}},"ID"),(0,s.Lk)("th",{style:{width:"30%"}},"Title"),(0,s.Lk)("th",{style:{width:"15%"}},"Origin"),(0,s.Lk)("th",{style:{width:"15%"}},"Priority"),(0,s.Lk)("th",{style:{width:"15%"}},"Due Date"),(0,s.Lk)("th",{style:{width:"17%"}},"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.pendingReviewIncidents,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"status-pending-review"},[(0,s.Lk)("td",Az,(0,d.v_)(e.id),1),(0,s.Lk)("td",Tz,[a[50]||(a[50]=(0,s.Lk)("span",{class:"status-dot pending-review"},null,-1)),(0,s.Lk)("span",xz,(0,d.v_)(e.Title),1)]),(0,s.Lk)("td",Fz,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",Vz,[(0,s.Lk)("span",{class:(0,d.C4)(["priority-badge",e.Priority?.toLowerCase()])},(0,d.v_)(e.Priority),3)]),(0,s.Lk)("td",Mz,(0,d.v_)(n.formatDate(e.MitigationDueDate)),1),(0,s.Lk)("td",Xz,[(0,s.Lk)("button",{onClick:a=>n.viewMitigations(e.id),class:"view-btn"},a[51]||(a[51]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,Uz)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",Nz,a[53]||(a[53]=[(0,s.Lk)("p",null,"No tasks pending review found.",-1)])))],2)]),(0,s.Lk)("div",$z,[(0,s.Lk)("div",{class:"status-header assigned",onClick:a[7]||(a[7]=e=>n.toggleSection("assigned"))},[a[55]||(a[55]=(0,s.Lk)("span",{class:"status-icon"},[(0,s.Lk)("i",{class:"fas fa-tasks"})],-1)),(0,s.Lk)("span",Oz,"Assigned ("+(0,d.v_)(l.assignedIncidents.length)+")",1),(0,s.Lk)("span",{class:(0,d.C4)(["arrow-indicator",{expanded:l.expandedSections.assigned}])},a[54]||(a[54]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),2)]),(0,s.Lk)("div",{class:(0,d.C4)(["collapsible-content",{expanded:l.expandedSections.assigned}])},[l.assignedIncidents.length>0?((0,s.uX)(),(0,s.CE)("div",jz,[(0,s.Lk)("table",Bz,[a[58]||(a[58]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{style:{width:"8%"}},"ID"),(0,s.Lk)("th",{style:{width:"30%"}},"Title"),(0,s.Lk)("th",{style:{width:"15%"}},"Origin"),(0,s.Lk)("th",{style:{width:"15%"}},"Priority"),(0,s.Lk)("th",{style:{width:"15%"}},"Due Date"),(0,s.Lk)("th",{style:{width:"17%"}},"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assignedIncidents,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"status-assigned"},[(0,s.Lk)("td",Wz,(0,d.v_)(e.id),1),(0,s.Lk)("td",Qz,[a[56]||(a[56]=(0,s.Lk)("span",{class:"status-dot assigned"},null,-1)),(0,s.Lk)("span",qz,(0,d.v_)(e.Title),1)]),(0,s.Lk)("td",Kz,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",Jz,[(0,s.Lk)("span",{class:(0,d.C4)(["priority-badge",e.Priority?.toLowerCase()])},(0,d.v_)(e.Priority),3)]),(0,s.Lk)("td",zz,(0,d.v_)(n.formatDate(e.MitigationDueDate)),1),(0,s.Lk)("td",Hz,[(0,s.Lk)("button",{onClick:a=>n.viewMitigations(e.id),class:"view-btn"},a[57]||(a[57]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,Yz)])]))),128))])])])):((0,s.uX)(),(0,s.CE)("div",Gz,a[59]||(a[59]=[(0,s.Lk)("p",null,"No assigned tasks found.",-1)])))],2)])])):((0,s.uX)(),(0,s.CE)("div",zJ,a[34]||(a[34]=[(0,s.Lk)("p",null,"Please select a user to view their assigned tasks.",-1)])))])):(0,s.Q3)("",!0),"reviewer"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",Zz,[l.selectedUserId?0===l.reviewerTasks.length?((0,s.uX)(),(0,s.CE)("div",aH,a[61]||(a[61]=[(0,s.Lk)("p",null,"No review tasks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",tH,[(0,s.Lk)("div",iH,[(0,s.Lk)("div",{class:"status-header pending-review",onClick:a[8]||(a[8]=e=>n.toggleSection("reviewerPending"))},[a[63]||(a[63]=(0,s.Lk)("span",{class:"status-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})],-1)),(0,s.Lk)("span",sH,"Pending Review ("+(0,d.v_)(l.pendingReviewerTasks.length)+")",1),(0,s.Lk)("span",{class:(0,d.C4)(["arrow-indicator",{expanded:l.expandedSections.reviewerPending}])},a[62]||(a[62]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),2)]),(0,s.Lk)("div",{class:(0,d.C4)(["collapsible-content",{expanded:l.expandedSections.reviewerPending}])},[l.pendingReviewerTasks.length>0?((0,s.uX)(),(0,s.CE)("div",oH,[(0,s.Lk)("table",lH,[a[66]||(a[66]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{style:{width:"8%"}},"ID"),(0,s.Lk)("th",{style:{width:"30%"}},"Title"),(0,s.Lk)("th",{style:{width:"15%"}},"Origin"),(0,s.Lk)("th",{style:{width:"15%"}},"Priority"),(0,s.Lk)("th",{style:{width:"15%"}},"Assigned By"),(0,s.Lk)("th",{style:{width:"17%"}},"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.pendingReviewerTasks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"status-pending-review"},[(0,s.Lk)("td",nH,(0,d.v_)(e.id),1),(0,s.Lk)("td",rH,[a[64]||(a[64]=(0,s.Lk)("span",{class:"status-dot pending-review"},null,-1)),(0,s.Lk)("span",cH,(0,d.v_)(e.Title),1)]),(0,s.Lk)("td",dH,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",uH,[(0,s.Lk)("span",{class:(0,d.C4)(["priority-badge",e.Priority?.toLowerCase()||"unknown"])},(0,d.v_)(e.Priority||"Unknown"),3)]),(0,s.Lk)("td",pH,(0,d.v_)(n.getUserName(e.AssignerId)),1),(0,s.Lk)("td",vH,[(0,s.Lk)("button",{onClick:a=>n.reviewMitigations(e),class:"review-btn"},a[65]||(a[65]=[(0,s.Lk)("i",{class:"fas fa-tasks"},null,-1),(0,s.eW)(" Review ")]),8,mH)])]))),128))])])])):((0,s.uX)(),(0,s.CE)("div",kH,a[67]||(a[67]=[(0,s.Lk)("p",null,"No pending review tasks found.",-1)])))],2)]),(0,s.Lk)("div",hH,[(0,s.Lk)("div",{class:"status-header approved",onClick:a[9]||(a[9]=e=>n.toggleSection("reviewerApproved"))},[a[69]||(a[69]=(0,s.Lk)("span",{class:"status-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("span",gH,"Approved ("+(0,d.v_)(l.approvedReviewerTasks.length)+")",1),(0,s.Lk)("span",{class:(0,d.C4)(["arrow-indicator",{expanded:l.expandedSections.reviewerApproved}])},a[68]||(a[68]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)]),2)]),(0,s.Lk)("div",{class:(0,d.C4)(["collapsible-content",{expanded:l.expandedSections.reviewerApproved}])},[l.approvedReviewerTasks.length>0?((0,s.uX)(),(0,s.CE)("div",yH,[(0,s.Lk)("table",fH,[a[72]||(a[72]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{style:{width:"8%"}},"ID"),(0,s.Lk)("th",{style:{width:"30%"}},"Title"),(0,s.Lk)("th",{style:{width:"15%"}},"Origin"),(0,s.Lk)("th",{style:{width:"15%"}},"Priority"),(0,s.Lk)("th",{style:{width:"15%"}},"Assigned By"),(0,s.Lk)("th",{style:{width:"17%"}},"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.approvedReviewerTasks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:"status-approved"},[(0,s.Lk)("td",bH,(0,d.v_)(e.id),1),(0,s.Lk)("td",CH,[a[70]||(a[70]=(0,s.Lk)("span",{class:"status-dot approved"},null,-1)),(0,s.Lk)("span",LH,(0,d.v_)(e.Title),1)]),(0,s.Lk)("td",wH,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",EH,[(0,s.Lk)("span",{class:(0,d.C4)(["priority-badge",e.Priority?.toLowerCase()||"unknown"])},(0,d.v_)(e.Priority||"Unknown"),3)]),(0,s.Lk)("td",RH,(0,d.v_)(n.getUserName(e.AssignerId)),1),(0,s.Lk)("td",DH,[(0,s.Lk)("button",{onClick:a=>n.reviewMitigations(e),class:"review-btn approved"},a[71]||(a[71]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,IH)])]))),128))])])])):((0,s.uX)(),(0,s.CE)("div",PH,a[73]||(a[73]=[(0,s.Lk)("p",null,"No approved review tasks found.",-1)])))],2)])])):((0,s.uX)(),(0,s.CE)("div",eH,a[60]||(a[60]=[(0,s.Lk)("p",null,"Please select a user to view their reviewer tasks.",-1)])))])):(0,s.Q3)("",!0)])),l.showMitigationWorkflow?((0,s.uX)(),(0,s.CE)("div",_H,[(0,s.Lk)("div",SH,[(0,s.Lk)("button",{onClick:a[10]||(a[10]=(...e)=>n.closeMitigationModal&&n.closeMitigationModal(...e)),class:"back-btn",title:"Back to tasks"},a[75]||(a[75]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),(0,s.Lk)("h1",null,(0,d.v_)(n.isAuditFinding?"Audit Finding":"Incident")+" Mitigation Workflow",1),n.isIncidentRejected?((0,s.uX)(),(0,s.CE)("div",AH,a[76]||(a[76]=[(0,s.Lk)("div",{class:"rejection-banner-content"},[(0,s.Lk)("div",{class:"rejection-banner-icon"},"âš ï¸"),(0,s.Lk)("div",{class:"rejection-banner-text"},[(0,s.Lk)("h3",null,"This incident has been rejected and requires resubmission"),(0,s.Lk)("p",null,"The reviewer has rejected your submission. Please review the feedback below, update the required information, and resubmit for review.")])],-1)]))):(0,s.Q3)("",!0),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",TH,a[77]||(a[77]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation steps...",-1)]))):l.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",FH,[(0,s.Lk)("div",VH,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["timeline-step",{completed:"Completed"===e.status,active:n.isStepActive(t),locked:n.isStepLocked(t),approved:!0===e.approved,rejected:!1===e.approved}]),style:(0,d.Tr)({"--step-index":t})},[(0,s.Lk)("div",MH,["Completed"===e.status?((0,s.uX)(),(0,s.CE)("span",XH,a[78]||(a[78]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]))):((0,s.uX)(),(0,s.CE)("span",UH,(0,d.v_)(t+1),1))]),(0,s.Lk)("div",NH,[(0,s.Lk)("h3",null,(0,d.v_)(e.description),1),!0===e.approved?((0,s.uX)(),(0,s.CE)("div",$H,a[79]||(a[79]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" This step has been approved by the reviewer ")]))):(0,s.Q3)("",!0),!1===e.approved?((0,s.uX)(),(0,s.CE)("div",OH,[a[81]||(a[81]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),a[82]||(a[82]=(0,s.eW)(" This step was rejected by the reviewer and needs to be updated ")),e.remarks?((0,s.uX)(),(0,s.CE)("div",jH,[a[80]||(a[80]=(0,s.Lk)("strong",null,"Reviewer Feedback:",-1)),(0,s.eW)(" "+(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),null===e.approved&&"Completed"===e.status?((0,s.uX)(),(0,s.CE)("div",BH,a[83]||(a[83]=[(0,s.Lk)("i",{class:"fas fa-clock"},null,-1),(0,s.eW)(" This step is completed and awaiting reviewer approval ")]))):(0,s.Q3)("",!0),e.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",WH,[a[84]||(a[84]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(e.user_submitted_date)),1)])):(0,s.Q3)("",!0),e.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",QH,[a[85]||(a[85]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(e.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0),!1===e.approved||null===e.approved?((0,s.uX)(),(0,s.CE)("div",qH,[e.previousComments&&e.previousComments.trim()?((0,s.uX)(),(0,s.CE)("div",KH,[a[86]||(a[86]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-history"}),(0,s.eW)(" Previous Comments")],-1)),(0,s.Lk)("div",JH,(0,d.v_)(e.previousComments),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",zH,[(0,s.Lk)("label",HH,(0,d.v_)(e.previousComments&&e.previousComments.trim()?"Add New Comments:":"Comments:"),1),(0,s.bo)((0,s.Lk)("textarea",{id:"comments","onUpdate:modelValue":a=>e.comments=a,placeholder:e.previousComments&&e.previousComments.trim()?"Add additional comments about this mitigation step...":"Add your comments about this mitigation step...",rows:"3"},null,8,YH),[[i.Jo,e.comments]])]),(0,s.Lk)("div",GH,[(0,s.Lk)("label",ZH,[a[87]||(a[87]=(0,s.Lk)("i",{class:"fas fa-upload"},null,-1)),a[88]||(a[88]=(0,s.eW)(" Upload Evidence ")),(0,s.Lk)("input",{type:"file",onChange:e=>n.handleFileUpload(e,t),accept:".pdf,.doc,.docx,.jpg,.png"},null,40,eY)]),e.uploading?((0,s.uX)(),(0,s.CE)("div",aY,a[89]||(a[89]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Uploading... ")]))):e.fileName?((0,s.uX)(),(0,s.CE)("div",tY,[a[90]||(a[90]=(0,s.Lk)("i",{class:"fas fa-file"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",iY,[(0,s.Lk)("button",{onClick:e=>n.updateStepStatus(t,"Completed"),class:(0,d.C4)(["complete-btn",{active:"Completed"===e.status}])},a[91]||(a[91]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Mark as Complete ")]),10,sY)])])):((0,s.uX)(),(0,s.CE)("div",oY,[e.previousComments||e.comments?((0,s.uX)(),(0,s.CE)("div",lY,[a[92]||(a[92]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-comment"}),(0,s.eW)(" Comments")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.previousComments||e.comments),1)])):(0,s.Q3)("",!0),e.fileName?((0,s.uX)(),(0,s.CE)("div",nY,[a[94]||(a[94]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-file"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:e["aws-file_link"],download:e.fileName,target:"_blank"},[a[93]||(a[93]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)],8,rY)])):(0,s.Q3)("",!0),a[95]||(a[95]=(0,s.Lk)("div",{class:"approved-status-display"},[(0,s.Lk)("i",{class:"fas fa-lock"}),(0,s.eW)(" This mitigation has been approved and is locked for editing ")],-1))]))])],6))),128))]),l.assessmentFeedbackForUser&&!l.assessmentFeedbackForUser.approved?((0,s.uX)(),(0,s.CE)("div",cY,[a[97]||(a[97]=(0,s.Lk)("h3",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Assessment Requires Revision")],-1)),a[98]||(a[98]=(0,s.Lk)("p",null,"The reviewer has rejected your assessment and provided the following feedback:",-1)),(0,s.Lk)("div",dY,[a[96]||(a[96]=(0,s.Lk)("strong",null,"Reviewer's Feedback:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.assessmentFeedbackForUser.remarks),1)]),a[99]||(a[99]=(0,s.Lk)("p",null,"Please review the feedback and update your assessment by completing the questionnaire again.",-1))])):(0,s.Q3)("",!0),n.allStepsCompleted&&!l.showQuestionnaire?((0,s.uX)(),(0,s.CE)("div",uY,[a[101]||(a[101]=(0,s.Lk)("h3",null,"All Mitigation Steps Completed!",-1)),a[102]||(a[102]=(0,s.Lk)("p",null,"Please complete the incident assessment questionnaire to finalize your submission.",-1)),(0,s.Lk)("button",{onClick:a[11]||(a[11]=e=>l.showQuestionnaire=!0),class:"show-questionnaire-btn"},a[100]||(a[100]=[(0,s.Lk)("i",{class:"fas fa-clipboard-list"},null,-1),(0,s.eW)(" Complete Assessment ")]))])):(0,s.Q3)("",!0),l.showQuestionnaire?((0,s.uX)(),(0,s.CE)("div",pY,[a[135]||(a[135]=(0,s.Lk)("h3",null,"Incident Assessment Questionnaire",-1)),(0,s.Lk)("div",vY,[(0,s.Lk)("div",mY,[a[104]||(a[104]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"1"),(0,s.eW)(" What is the total cost for implementing this mitigation? (Optional) ")],-1)),(0,s.Lk)("div",kY,[a[103]||(a[103]=(0,s.Lk)("span",{class:"currency-prefix"},"$",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[12]||(a[12]=e=>l.questionnaireData.cost=e),placeholder:"Enter amount (e.g., 5000.50) - Include all direct and indirect costs for implementation",class:"question-input currency-input",min:"0",step:"0.01",onInput:a[13]||(a[13]=e=>n.validateCurrencyInput("cost",e))},null,544),[[i.Jo,l.questionnaireData.cost]])]),a[105]||(a[105]=(0,s.Lk)("small",{class:"field-hint"},"Include labor, materials, technology, and any third-party costs",-1))]),(0,s.Lk)("div",hY,[a[107]||(a[107]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"2"),(0,s.eW)(" What is the overall impact level of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[14]||(a[14]=e=>l.questionnaireData.impact=e),class:"question-select"},a[106]||(a[106]=[(0,s.Fv)('<option value="" data-v-00b1e972>Select impact level...</option><option value="Very Low" data-v-00b1e972>Very Low - Minimal disruption, easily contained</option><option value="Low" data-v-00b1e972>Low - Minor disruption, limited scope</option><option value="Medium" data-v-00b1e972>Medium - Moderate disruption, manageable impact</option><option value="High" data-v-00b1e972>High - Significant disruption, widespread impact</option><option value="Very High" data-v-00b1e972>Very High - Severe disruption, critical impact</option>',6)]),512),[[i.u1,l.questionnaireData.impact]]),a[108]||(a[108]=(0,s.Lk)("small",{class:"field-hint"},"Consider operational, business, and stakeholder impact",-1))]),(0,s.Lk)("div",gY,[a[110]||(a[110]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"3"),(0,s.eW)(" What is the financial impact scale of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>l.questionnaireData.financialImpact=e),class:"question-select"},a[109]||(a[109]=[(0,s.Fv)('<option value="" data-v-00b1e972>Select financial impact level...</option><option value="Very Low" data-v-00b1e972>Very Low - Under $1,000 in losses/costs</option><option value="Low" data-v-00b1e972>Low - $1,000 - $10,000 in losses/costs</option><option value="Medium" data-v-00b1e972>Medium - $10,000 - $100,000 in losses/costs</option><option value="High" data-v-00b1e972>High - $100,000 - $1,000,000 in losses/costs</option><option value="Very High" data-v-00b1e972>Very High - Over $1,000,000 in losses/costs</option>',6)]),512),[[i.u1,l.questionnaireData.financialImpact]]),a[111]||(a[111]=(0,s.Lk)("small",{class:"field-hint"},"Include direct losses, opportunity costs, and recovery expenses",-1))]),(0,s.Lk)("div",yY,[a[113]||(a[113]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"4"),(0,s.eW)(" What is the reputational impact scale of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[16]||(a[16]=e=>l.questionnaireData.reputationalImpact=e),class:"question-select"},a[112]||(a[112]=[(0,s.Fv)('<option value="" data-v-00b1e972>Select reputational impact level...</option><option value="Very Low" data-v-00b1e972>Very Low - Minimal or no reputational damage</option><option value="Low" data-v-00b1e972>Low - Minor reputational concerns, limited visibility</option><option value="Medium" data-v-00b1e972>Medium - Moderate reputational impact, some stakeholder concern</option><option value="High" data-v-00b1e972>High - Significant reputational damage, widespread attention</option><option value="Very High" data-v-00b1e972>Very High - Severe reputational crisis, major media coverage</option>',6)]),512),[[i.u1,l.questionnaireData.reputationalImpact]]),a[114]||(a[114]=(0,s.Lk)("small",{class:"field-hint"},"Consider impact on brand, customer trust, media coverage, and stakeholder confidence",-1))]),(0,s.Lk)("div",fY,[a[116]||(a[116]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"5"),(0,s.eW)(" What is the operational impact scale of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[17]||(a[17]=e=>l.questionnaireData.operationalImpact=e),class:"question-select"},a[115]||(a[115]=[(0,s.Fv)('<option value="" data-v-00b1e972>Select operational impact level...</option><option value="Very Low" data-v-00b1e972>Very Low - Minimal disruption, normal operations maintained</option><option value="Low" data-v-00b1e972>Low - Minor disruption, limited service impact</option><option value="Medium" data-v-00b1e972>Medium - Moderate disruption, some services affected</option><option value="High" data-v-00b1e972>High - Significant disruption, major service interruption</option><option value="Very High" data-v-00b1e972>Very High - Severe disruption, critical systems down</option>',6)]),512),[[i.u1,l.questionnaireData.operationalImpact]]),a[117]||(a[117]=(0,s.Lk)("small",{class:"field-hint"},"Consider disruptions to processes, services, productivity, and normal operations",-1))]),(0,s.Lk)("div",bY,[a[119]||(a[119]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"6"),(0,s.eW)(" What is the estimated financial loss from this incident? (Optional) ")],-1)),(0,s.Lk)("div",CY,[a[118]||(a[118]=(0,s.Lk)("span",{class:"currency-prefix"},"$",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[18]||(a[18]=e=>l.questionnaireData.financialLoss=e),placeholder:"Enter total loss amount (e.g., 25000.00) - Include revenue loss, fines, penalties, and recovery costs",class:"question-input currency-input",min:"0",step:"0.01",onInput:a[19]||(a[19]=e=>n.validateCurrencyInput("financialLoss",e))},null,544),[[i.Jo,l.questionnaireData.financialLoss]])]),a[120]||(a[120]=(0,s.Lk)("small",{class:"field-hint"},"Include revenue loss, regulatory fines, penalties, legal costs, and recovery expenses",-1))]),(0,s.Lk)("div",LY,[a[122]||(a[122]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"7"),(0,s.eW)(" What is the expected system downtime if this incident occurs again? (Optional) ")],-1)),(0,s.Lk)("div",wY,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[20]||(a[20]=e=>l.questionnaireData.systemDowntime=e),placeholder:"Enter hours (e.g., 8.5) - Total time systems would be unavailable",class:"question-input hours-input",min:"0",step:"0.5",onInput:a[21]||(a[21]=e=>n.validateHoursInput("systemDowntime",e))},null,544),[[i.Jo,l.questionnaireData.systemDowntime]]),a[121]||(a[121]=(0,s.Lk)("span",{class:"hours-suffix"},"hours",-1))]),a[123]||(a[123]=(0,s.Lk)("small",{class:"field-hint"},"Estimate total time systems/services would be unavailable (decimals allowed, e.g., 2.5 hours)",-1))]),(0,s.Lk)("div",EY,[a[125]||(a[125]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"8"),(0,s.eW)(" How long did it take to recover from this incident? (Optional) ")],-1)),(0,s.Lk)("div",RY,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[22]||(a[22]=e=>l.questionnaireData.recoveryTime=e),placeholder:"Enter hours (e.g., 12.0) - Time from incident detection to full recovery",class:"question-input hours-input",min:"0",step:"0.5",onInput:a[23]||(a[23]=e=>n.validateHoursInput("recoveryTime",e))},null,544),[[i.Jo,l.questionnaireData.recoveryTime]]),a[124]||(a[124]=(0,s.Lk)("span",{class:"hours-suffix"},"hours",-1))]),a[126]||(a[126]=(0,s.Lk)("small",{class:"field-hint"},"Time from incident detection to complete restoration of normal operations (decimals allowed)",-1))]),(0,s.Lk)("div",DY,[a[128]||(a[128]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"9"),(0,s.eW)(" Is it possible that this incident will recur again? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[24]||(a[24]=e=>l.questionnaireData.riskRecurrence=e),class:"question-select"},a[127]||(a[127]=[(0,s.Lk)("option",{value:""},"Select likelihood...",-1),(0,s.Lk)("option",{value:"yes"},"Yes - High likelihood of recurrence",-1),(0,s.Lk)("option",{value:"maybe"},"Maybe - Possible but uncertain recurrence",-1),(0,s.Lk)("option",{value:"no"},"No - Very unlikely to recur",-1)]),512),[[i.u1,l.questionnaireData.riskRecurrence]]),a[129]||(a[129]=(0,s.Lk)("small",{class:"field-hint"},"Consider if root causes have been addressed and preventive measures are in place",-1))]),(0,s.Lk)("div",IY,[a[131]||(a[131]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"10"),(0,s.eW)(" Is this mitigation an improvement initiative that will prevent future recurrence? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[25]||(a[25]=e=>l.questionnaireData.improvementInitiative=e),class:"question-select"},a[130]||(a[130]=[(0,s.Lk)("option",{value:""},"Select prevention level...",-1),(0,s.Lk)("option",{value:"yes"},"Yes - Completely prevents recurrence",-1),(0,s.Lk)("option",{value:"partially"},"Partially - Reduces likelihood of recurrence",-1),(0,s.Lk)("option",{value:"no"},"No - Does not prevent recurrence",-1)]),512),[[i.u1,l.questionnaireData.improvementInitiative]]),a[132]||(a[132]=(0,s.Lk)("small",{class:"field-hint"},"Assess whether this mitigation addresses root causes and prevents similar incidents",-1))])]),(0,s.Lk)("div",PY,[(0,s.Lk)("button",{onClick:a[26]||(a[26]=e=>l.showQuestionnaire=!1),class:"cancel-questionnaire-btn"},a[133]||(a[133]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Cancel ")])),(0,s.Lk)("button",{onClick:a[27]||(a[27]=(...e)=>n.submitIncidentAssessment&&n.submitIncidentAssessment(...e)),class:"submit-assessment-btn",disabled:!n.isQuestionnaireValid},a[134]||(a[134]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Submit Assessment ")]),8,_Y)])])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",xH," No mitigation steps found for this incident. "))])):(0,s.Q3)("",!0),l.showReviewerWorkflow?((0,s.uX)(),(0,s.CE)("div",SY,[(0,s.Lk)("div",AY,[(0,s.Lk)("button",{onClick:a[28]||(a[28]=(...e)=>n.closeReviewerModal&&n.closeReviewerModal(...e)),class:"back-btn",title:"Back to tasks"},a[136]||(a[136]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),a[182]||(a[182]=(0,s.Lk)("h1",null,"Review Incident Mitigations",-1)),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",TY,a[137]||(a[137]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",xY,[(0,s.Lk)("div",FY,[(0,s.Lk)("h3",null,(0,d.v_)(l.currentReviewTask?.Title||"Incident #"+l.currentReviewTask?.id),1),(0,s.Lk)("p",null,[a[138]||(a[138]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentReviewTask?.id),1)]),(0,s.Lk)("p",null,[a[139]||(a[139]=(0,s.Lk)("strong",null,"Submitted By:",-1)),(0,s.eW)(" "+(0,d.v_)(n.getUserName(l.currentReviewTask?.AssignerId)),1)])]),l.questionnaireReviewData?((0,s.uX)(),(0,s.CE)("div",VY,[a[157]||(a[157]=(0,s.Lk)("h3",null,"Assessment Questionnaire",-1)),(0,s.Lk)("div",MY,[l.questionnaireReviewData.cost?((0,s.uX)(),(0,s.CE)("div",XY,[a[140]||(a[140]=(0,s.Lk)("label",null,"Cost for Mitigation:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.cost),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.impact?((0,s.uX)(),(0,s.CE)("div",UY,[a[141]||(a[141]=(0,s.Lk)("label",null,"Impact:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.impact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.financialImpact?((0,s.uX)(),(0,s.CE)("div",NY,[a[142]||(a[142]=(0,s.Lk)("label",null,"Financial Impact:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.financialImpact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.reputationalImpact?((0,s.uX)(),(0,s.CE)("div",$Y,[a[143]||(a[143]=(0,s.Lk)("label",null,"Reputational Impact Scale:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.reputationalImpact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.operationalImpact?((0,s.uX)(),(0,s.CE)("div",OY,[a[144]||(a[144]=(0,s.Lk)("label",null,"Operational Impact Scale:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.operationalImpact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.financialLoss?((0,s.uX)(),(0,s.CE)("div",jY,[a[145]||(a[145]=(0,s.Lk)("label",null,"Financial Loss:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.financialLoss),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.systemDowntime?((0,s.uX)(),(0,s.CE)("div",BY,[a[146]||(a[146]=(0,s.Lk)("label",null,"Expected System Downtime (hrs):",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.systemDowntime),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.recoveryTime?((0,s.uX)(),(0,s.CE)("div",WY,[a[147]||(a[147]=(0,s.Lk)("label",null,"Recovery Time (hrs):",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.recoveryTime),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.riskRecurrence?((0,s.uX)(),(0,s.CE)("div",QY,[a[148]||(a[148]=(0,s.Lk)("label",null,"Risk Recurrence Possibility:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.riskRecurrence),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.improvementInitiative?((0,s.uX)(),(0,s.CE)("div",qY,[a[149]||(a[149]=(0,s.Lk)("label",null,"Improvement Initiative:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.improvementInitiative),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.submittedAt?((0,s.uX)(),(0,s.CE)("div",KY,[a[150]||(a[150]=(0,s.Lk)("label",null,"Submitted At:",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.formatDateTime(l.questionnaireReviewData.submittedAt)),1)])):(0,s.Q3)("",!0)]),l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",JY,[a[154]||(a[154]=(0,s.Lk)("h4",null,"Assessment Review",-1)),(0,s.Lk)("div",zY,[(0,s.Lk)("button",{onClick:a[29]||(a[29]=e=>n.approveAssessment(!0)),class:(0,d.C4)(["approve-assessment-btn",{active:!0===l.assessmentFeedback.approved}])},a[151]||(a[151]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Approve Assessment ")]),2),(0,s.Lk)("button",{onClick:a[30]||(a[30]=e=>n.approveAssessment(!1)),class:(0,d.C4)(["reject-assessment-btn",{active:!1===l.assessmentFeedback.approved}])},a[152]||(a[152]=[(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1),(0,s.eW)(" Reject Assessment ")]),2)]),!1===l.assessmentFeedback.approved?((0,s.uX)(),(0,s.CE)("div",HY,[a[153]||(a[153]=(0,s.Lk)("label",{for:"assessment-feedback"},"Assessment Feedback (required for rejection):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"assessment-feedback","onUpdate:modelValue":a[31]||(a[31]=e=>l.assessmentFeedback.remarks=e),class:"assessment-feedback-input",placeholder:"Provide detailed feedback about why the assessment was rejected...",rows:"4"},null,512),[[i.Jo,l.assessmentFeedback.remarks]])])):(0,s.Q3)("",!0)])),l.reviewCompleted&&void 0!==l.assessmentFeedback.approved?((0,s.uX)(),(0,s.CE)("div",YY,[a[156]||(a[156]=(0,s.Lk)("h4",null,"Assessment Status",-1)),(0,s.Lk)("div",{class:(0,d.C4)(["assessment-status",{approved:l.assessmentFeedback.approved,rejected:!l.assessmentFeedback.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",l.assessmentFeedback.approved?"fa-check-circle":"fa-times-circle"])},null,2),(0,s.eW)(" "+(0,d.v_)(l.assessmentFeedback.approved?"Assessment Approved":"Assessment Rejected"),1)],2),!l.assessmentFeedback.approved&&l.assessmentFeedback.remarks?((0,s.uX)(),(0,s.CE)("div",GY,[a[155]||(a[155]=(0,s.Lk)("strong",null,"Feedback:",-1)),(0,s.eW)(" "+(0,d.v_)(l.assessmentFeedback.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,d.C4)(["review-status-banner",{approved:l.reviewApproved,rejected:!l.reviewApproved}])},[l.reviewApproved?((0,s.uX)(),(0,s.CE)("div",ZY,a[158]||(a[158]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" This incident has been approved ")]))):((0,s.uX)(),(0,s.CE)("div",eG,a[159]||(a[159]=[(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1),(0,s.eW)(" This incident was rejected and is awaiting revision ")])))],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",aG,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationReviewData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"mitigation-review-item","data-id":t},[(0,s.Lk)("div",iG,[(0,s.Lk)("h4",null,"Mitigation #"+(0,d.v_)(t),1),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["mitigation-status-badge",{approved:!0===e.approved,rejected:!1===e.approved,pending:void 0===e.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===e.approved,"fa-times-circle":!1===e.approved,"fa-clock":void 0===e.approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending Review"),1)],2)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",sG,[(0,s.Lk)("div",oG,[a[165]||(a[165]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),n.getPreviousMitigation(t)?((0,s.uX)(),(0,s.CE)("div",lG,[a[163]||(a[163]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousMitigation(t).description||"No description available"),1),n.getPreviousMitigation(t).comments?((0,s.uX)(),(0,s.CE)("div",nG,[a[160]||(a[160]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",rG,(0,d.v_)(n.getPreviousMitigation(t).comments),1)])):(0,s.Q3)("",!0),n.getPreviousMitigation(t)["aws-file_link"]?((0,s.uX)(),(0,s.CE)("div",cG,[a[162]||(a[162]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:n.getPreviousMitigation(t)["aws-file_link"],download:"",filename:n.getPreviousMitigation(t).fileName,class:"evidence-link"},[a[161]||(a[161]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(n.getPreviousMitigation(t).fileName),1)],8,dG)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",uG,a[164]||(a[164]=[(0,s.Lk)("i",{class:"fas fa-history"},null,-1),(0,s.Lk)("p",null,"No previous version available",-1)])))]),(0,s.Lk)("div",pG,[a[170]||(a[170]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("div",vG,[a[169]||(a[169]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.description),1),e.comments?((0,s.uX)(),(0,s.CE)("div",mG,[a[166]||(a[166]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",kG,(0,d.v_)(e.comments),1)])):(0,s.Q3)("",!0),e["aws-file_link"]?((0,s.uX)(),(0,s.CE)("div",hG,[a[168]||(a[168]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:e["aws-file_link"],download:"",filename:e.fileName,class:"evidence-link"},[a[167]||(a[167]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)],8,gG)])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",yG,[!0===e.approved||!1===e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",fG,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!0),class:"approve-btn"},a[171]||(a[171]=[(0,s.Lk)("i",{class:"fas fa-check-double"},null,-1),(0,s.eW)(" Approve ")]),8,bG),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!1),class:"reject-btn"},a[172]||(a[172]=[(0,s.Lk)("i",{class:"fas fa-ban"},null,-1),(0,s.eW)(" Reject ")]),8,CG)])),!1!==e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",LG,[a[175]||(a[175]=(0,s.Lk)("label",{for:"remarks"},"Feedback (required for rejection):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"remarks","onUpdate:modelValue":a=>e.remarks=a,class:"remarks-input",placeholder:"Provide feedback explaining why this mitigation was rejected..."},null,8,wG),[[i.Jo,e.remarks]]),(0,s.Lk)("button",{onClick:e=>n.updateRemarks(t),class:"save-remarks-btn"},a[173]||(a[173]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Feedback ")]),8,EG),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!0),class:"change-decision-btn"},a[174]||(a[174]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Approve ")]),8,RG)])),!0===e.approved?((0,s.uX)(),(0,s.CE)("div",DG,[a[177]||(a[177]=(0,s.Lk)("div",{class:"readonly-notice"},[(0,s.Lk)("i",{class:"fas fa-lock"}),(0,s.eW)(" This mitigation was previously approved and is read-only ")],-1)),l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",IG,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!1),class:"change-decision-btn"},a[176]||(a[176]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Reject ")]),8,PG)]))])):(0,s.Q3)("",!0),!1===e.approved&&l.reviewCompleted&&e.remarks?((0,s.uX)(),(0,s.CE)("div",_G,[a[178]||(a[178]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-exclamation"}),(0,s.eW)(" Rejection Feedback")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])],8,tG))),128))]),(0,s.Lk)("div",SG,[(0,s.Lk)("button",{class:"submit-review-btn",disabled:!n.canSubmitReview||l.reviewCompleted,onClick:a[32]||(a[32]=e=>n.submitReview(!0))},a[179]||(a[179]=[(0,s.Lk)("i",{class:"fas fa-check-double"},null,-1),(0,s.eW)(" Approve Incident ")]),8,AG),(0,s.Lk)("button",{class:"reject-review-btn",disabled:!n.canSubmitReview||l.reviewCompleted,onClick:a[33]||(a[33]=e=>n.submitReview(!1))},a[180]||(a[180]=[(0,s.Lk)("i",{class:"fas fa-ban"},null,-1),(0,s.eW)(" Reject Incident ")]),8,TG),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",xG," This review has been completed ")):n.canSubmitReview?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",FG,a[181]||(a[181]=[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1),(0,s.eW)(" You must approve or reject each mitigation and the assessment before submitting ")])))])]))])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var MG={name:"IncidentUserTasks",components:{PopupModal:pv.wA,CustomDropdown:mt.A},data(){return{userIncidents:[],reviewerTasks:[],users:[],selectedUserId:"",userFilterConfig:{name:"User",label:"User",defaultLabel:"All Users",values:[]},loading:!0,error:null,showMitigationWorkflow:!1,showReviewerWorkflow:!1,loadingMitigations:!1,mitigationSteps:[],selectedIncidentId:null,activeTab:"user",mitigationReviewData:{},currentReviewTask:null,reviewCompleted:!1,reviewApproved:!1,previousVersions:{},showQuestionnaire:!1,questionnaireReviewData:{},assessmentFeedback:{},assessmentFeedbackForUser:null,questionnaireData:{cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",riskRecurrence:"",improvementInitiative:""},expandedSections:{approved:!1,rejected:!1,pendingReview:!1,assigned:!1,reviewerPending:!1,reviewerApproved:!1},approvedIncidents:[],rejectedIncidents:[],pendingReviewIncidents:[],assignedIncidents:[],pendingReviewerTasks:[],approvedReviewerTasks:[]}},computed:{allStepsCompleted(){const e=this.mitigationSteps.filter(e=>!1===e.approved||null===e.approved);return e.length>0&&e.every(e=>"Completed"===e.status)},canSubmitReview(){const e=Object.values(this.mitigationReviewData).every(e=>!0===e.approved||!1===e.approved&&e.remarks&&""!==e.remarks.trim()),a=void 0!==this.assessmentFeedback.approved&&(!0===this.assessmentFeedback.approved||!1===this.assessmentFeedback.approved&&this.assessmentFeedback.remarks&&""!==this.assessmentFeedback.remarks.trim());return e&&a},hasRejectedOrNewSteps(){return this.mitigationSteps.some(e=>!1===e.approved||null===e.approved)},rejectedStepsCompleted(){const e=this.mitigationSteps.filter(e=>!1===e.approved||null===e.approved);return e.length>0&&e.every(e=>"Completed"===e.status)},isQuestionnaireValid(){return!0},isAuditFinding(){const e=this.userIncidents.find(e=>e.id===this.selectedIncidentId);return e&&"audit_finding"===e.itemType},isIncidentRejected(){const e=this.userIncidents.find(e=>e.id===this.selectedIncidentId);return e&&"Rejected"===e.Status},currentIncidentDetails(){return this.userIncidents.find(e=>e.id===this.selectedIncidentId)||{}}},mounted(){this.fetchUsers(),this.initializeFromQuery()},methods:{fetchUsers(){qe.A.get("http://localhost:8000/api/custom-users/").then(e=>{console.log("User data received:",e.data),this.users=e.data,this.userFilterConfig.values=[{value:"",label:"All Users"},...this.users.map(e=>({value:e.UserId,label:`${e.UserName} (${e.role})`}))],this.loading=!1}).catch(e=>{console.error("Error fetching users:",e),this.error=`Failed to fetch users: ${e.message}`,this.loading=!1})},switchToReviewerTab(){console.log("Switching to reviewer tab"),this.activeTab="reviewer",this.selectedUserId&&(console.log("Refreshing data for reviewer tab"),this.fetchData(),this.$nextTick(()=>{this.pendingReviewerTasks.length>0?(this.expandedSections.reviewerPending=!0,this.expandedSections.reviewerApproved=!1):this.approvedReviewerTasks.length>0&&(this.expandedSections.reviewerApproved=!0)}))},fetchData(){if(!this.selectedUserId)return this.userIncidents=[],void(this.reviewerTasks=[]);this.loading=!0,Promise.all([qe.A.get(`http://localhost:8000/api/user-incidents/${this.selectedUserId}/`),qe.A.get(`http://localhost:8000/api/user-audit-findings/${this.selectedUserId}/`),qe.A.get(`http://localhost:8000/api/incident-reviewer-tasks/${this.selectedUserId}/`),qe.A.get(`http://localhost:8000/api/audit-finding-reviewer-tasks/${this.selectedUserId}/`)]).then(([e,a,t,i])=>{const s=e.data||[],o=a.data||[],l=s.map(e=>({...e,itemType:"incident"})),n=o.map(e=>({...e,itemType:"audit_finding"})),r=[...l,...n],c=r.filter((e,a,t)=>a===t.findIndex(a=>a.id===e.id));this.userIncidents=c,this.approvedIncidents=this.userIncidents.filter(e=>"Approved"===e.Status),this.rejectedIncidents=this.userIncidents.filter(e=>"Rejected"===e.Status),this.pendingReviewIncidents=this.userIncidents.filter(e=>"Pending Review"===e.Status||"Under Review"===e.Status),this.assignedIncidents=this.userIncidents.filter(e=>!["Approved","Rejected","Pending Review","Under Review"].includes(e.Status)),this.expandedSections={approved:this.approvedIncidents.length>0,rejected:this.rejectedIncidents.length>0,pendingReview:this.pendingReviewIncidents.length>0,assigned:0===this.assignedIncidents.length||this.assignedIncidents.length<5};const d=t.data||[],u=i.data||[],p=d.map(e=>({...e,itemType:"incident"})),v=u.map(e=>({...e,itemType:"audit_finding"})),m=[...p,...v],k=m.filter((e,a,t)=>a===t.findIndex(a=>a.id===e.id));this.reviewerTasks=k,this.approvedReviewerTasks=this.reviewerTasks.filter(e=>"Approved"===e.Status),this.pendingReviewerTasks=this.reviewerTasks.filter(e=>"Approved"!==e.Status),this.expandedSections.reviewerPending=this.pendingReviewerTasks.length>0,this.expandedSections.reviewerApproved=this.approvedReviewerTasks.length>0&&0===this.pendingReviewerTasks.length,console.log("Combined user tasks:",this.userIncidents),console.log("Combined reviewer tasks:",this.reviewerTasks),console.log("Debug - Incident reviewer tasks:",d),console.log("Debug - Audit reviewer tasks:",u),console.log("Debug - Final reviewerTasks length:",this.reviewerTasks.length),this.loading=!1,this.error=null}).catch(e=>{console.error("Error fetching data:",e),this.error=`Failed to fetch data: ${e.message}`,this.loading=!1})},getUserName(e){const a=this.users.find(a=>a.UserId==e);return a?a.UserName:"Unknown"},viewMitigations(e){console.log("viewMitigations called with ID:",e);const a="string"===typeof e?parseInt(e,10):e,t=this.userIncidents.find(e=>e.id===a);if(!t)return console.error("Task not found for ID:",a),void pv.OQ.error(`Error: Task not found for ID ${a}`);console.log("Found task:",t);const i=t&&"audit_finding"===t.itemType;this.selectedIncidentId=a,this.showMitigationWorkflow=!0,this.loadingMitigations=!0,this.assessmentFeedbackForUser=null,this.$nextTick(()=>{console.log("showMitigationWorkflow set to:",this.showMitigationWorkflow);const e=i?`http://localhost:8000/api/audit-finding-mitigations/${a}/`:`http://localhost:8000/api/incident-mitigations/${a}/`,t=i?`http://localhost:8000/api/audit-finding-review-data/${a}/`:`http://localhost:8000/api/incident-review-data/${a}/`;console.log("Fetching from endpoints:",{mitigationsEndpoint:e,reviewEndpoint:t}),Promise.all([qe.A.get(e),qe.A.get(t)]).then(([e,a])=>{console.log((i?"Audit finding":"Incident")+" mitigations received:",e.data),console.log((i?"Audit finding":"Incident")+" review data received:",a.data),e.data&&e.data.mitigations?(console.log("DEBUG: Raw mitigations from backend:",e.data.mitigations),Object.keys(e.data.mitigations).forEach(a=>{const t=e.data.mitigations[a];console.log(`DEBUG: Mitigation ${a} raw data:`,t)})):console.warn("No mitigations data found in response"),this.mitigationSteps=this.parseMitigations(e.data),console.log("Parsed mitigation steps:",this.mitigationSteps),a.data&&a.data.assessment_feedback&&(this.assessmentFeedbackForUser=a.data.assessment_feedback,console.log("Assessment feedback:",this.assessmentFeedbackForUser)),e.data.previous_assessment_data&&Object.keys(e.data.previous_assessment_data).length>0&&(this.questionnaireData={...this.questionnaireData,...e.data.previous_assessment_data},console.log("Pre-filled questionnaire data:",this.questionnaireData)),this.loadingMitigations=!1}).catch(e=>{console.error(`Error fetching ${i?"audit finding":"incident"} data:`,e),e.response&&(console.error("Response data:",e.response.data),console.error("Response status:",e.response.status)),pv.OQ.error(`Error loading data: ${e.message}`),this.mitigationSteps=[],this.assessmentFeedbackForUser=null,this.loadingMitigations=!1})})},parseMitigations(e){if(e&&e.mitigations){const a=e.mitigations,t=Object.keys(a),i=[];t.sort((e,a)=>Number(e)-Number(a));for(const e of t){const t=a[e];let s,o,l,n;"string"===typeof t?(s=t,o=null,l=null,n="Not Started"):(s=t.description||t,o=t.approved,l=t.remarks,n=t.status||"Not Started"),console.log(`DEBUG: Parsing mitigation ${e} - approved: ${o}, remarks: ${l}, description: ${s}`),i.push({title:`Step ${e}`,description:s,status:n,approved:o,remarks:l,previousComments:t.comments||"",comments:"","aws-file_link":t["aws-file_link"]||null,fileName:t.fileName||null})}return i}const a=e.mitigations||e;if(a&&"object"===typeof a&&!Array.isArray(a)){const e=Object.keys(a);if(e.length>0&&!isNaN(Number(e[0]))){const t=[];e.sort((e,a)=>Number(e)-Number(a));for(const i of e)t.push({title:`Step ${i}`,description:a[i],status:"Not Started",approved:null,remarks:null,comments:"","aws-file_link":null,fileName:null});return t}}if(Array.isArray(a))return a;if("string"===typeof a)try{const e=JSON.parse(a);return e&&"object"===typeof e&&!Array.isArray(e)?this.parseMitigations({mitigations:e}):Array.isArray(e)?e:[e]}catch(t){return console.error("Error parsing mitigation JSON:",t),[{title:"Mitigation",description:a,approved:null,remarks:null}]}return[{title:"Mitigation",description:"No detailed mitigation steps available",approved:null,remarks:null}]},closeMitigationModal(){this.showMitigationWorkflow=!1,this.mitigationSteps=[],this.selectedIncidentId=null,this.showQuestionnaire=!1,this.questionnaireData={cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",riskRecurrence:"",improvementInitiative:""}},updateStepStatus(e,a){console.log(`Updating step ${e+1} status to ${a}`),!0!==this.mitigationSteps[e].approved?!1!==this.mitigationSteps[e].approved&&null!==this.mitigationSteps[e].approved||(this.mitigationSteps[e].status=a):pv.OQ.warning("This mitigation step has been approved by the reviewer and cannot be modified.")},submitIncidentAssessment(){const e=this.userIncidents.find(e=>e.id===this.selectedIncidentId),a=e&&"audit_finding"===e.itemType;this.loading=!0;const t={};this.mitigationSteps.forEach((e,a)=>{const i=(a+1).toString();let s="";const o=e.previousComments&&e.previousComments.trim(),l=e.comments&&e.comments.trim();o&&l?s=`Previous: ${e.previousComments.trim()}\n\nNew: ${e.comments.trim()}`:o?s=e.previousComments.trim():l&&(s=e.comments.trim()),t[i]={description:e.description,status:e.status||"Completed",comments:s,"aws-file_link":e["aws-file_link"],fileName:e.fileName,approved:e.approved,remarks:e.remarks}});const i={cost:this.questionnaireData.cost||"",impact:this.questionnaireData.impact||"",financialImpact:this.questionnaireData.financialImpact||"",reputationalImpact:this.questionnaireData.reputationalImpact||"",operationalImpact:this.questionnaireData.operationalImpact||"",financialLoss:this.questionnaireData.financialLoss||"",systemDowntime:this.questionnaireData.systemDowntime||"",recoveryTime:this.questionnaireData.recoveryTime||"",riskRecurrence:this.questionnaireData.riskRecurrence||"",improvementInitiative:this.questionnaireData.improvementInitiative||"",mitigations:t,submittedAt:(new Date).toISOString()},s=a?"http://localhost:8000/api/submit-audit-finding-assessment/":"http://localhost:8000/api/submit-incident-assessment/";qe.A.post(s,{incident_id:this.selectedIncidentId,user_id:this.selectedUserId,extracted_info:i}).then(e=>{console.log((a?"Audit finding":"Incident")+" assessment submitted:",e.data),this.loading=!1,this.closeMitigationModal(),pv.OQ.success((a?"Audit finding":"Incident")+" assessment submitted for review successfully!"),this.fetchData()}).catch(e=>{console.error(`Error submitting ${a?"audit finding":"incident"} assessment:`,e),this.loading=!1,pv.OQ.error("Failed to submit assessment. Please try again.")})},closeReviewerModal(){this.showReviewerWorkflow=!1,this.currentReviewTask=null,this.mitigationReviewData={},this.previousVersions={},this.reviewCompleted=!1,this.reviewApproved=!1},approveMitigation(e,a){const t={...this.mitigationReviewData[e],approved:a,reviewer_submitted_date:(new Date).toISOString()};a&&(t.remarks=""),this.mitigationReviewData={...this.mitigationReviewData,[e]:t}},approveAssessment(e){this.assessmentFeedback={approved:e,remarks:e?"":this.assessmentFeedback.remarks||""},console.log("Assessment feedback updated:",this.assessmentFeedback)},submitReview(e){if(!this.canSubmitReview)return void pv.OQ.warning("Please complete the review of all mitigations");const a=this.currentReviewTask&&"audit_finding"===this.currentReviewTask.itemType;this.loading=!0;const t={};Object.keys(this.mitigationReviewData).forEach(e=>{const a=this.mitigationReviewData[e];t[e]={approved:a.approved,remarks:a.remarks||null}});const i={incident_id:this.currentReviewTask.id,approved:e,reviewer_id:this.selectedUserId,mitigation_feedback:t,assessment_feedback:this.assessmentFeedback};a&&(i.overall_decision=e?"approved":"rejected"),console.log(`Submitting ${a?"audit finding":"incident"} review with mitigation feedback:`,i);const s=a?"http://localhost:8000/api/complete-audit-finding-review/":"http://localhost:8000/api/complete-incident-review/";qe.A.post(s,i).then(t=>{console.log((a?"Audit finding":"Incident")+" review completed:",t.data),this.loading=!1;const i=this.reviewerTasks.findIndex(e=>e.id===this.currentReviewTask.id);-1!==i&&this.reviewerTasks.splice(i,1),this.reviewCompleted=!0,this.reviewApproved=e,pv.OQ.success(`${a?"Audit finding":"Incident"} ${e?"approved":"rejected"} successfully!`),setTimeout(()=>{this.closeReviewerModal()},2500)}).catch(e=>{console.error(`Error completing ${a?"audit finding":"incident"} review:`,e),this.loading=!1,pv.OQ.error("Failed to submit review. Please try again.")})},updateRemarks(e){this.mitigationReviewData[e].remarks.trim()?(this.mitigationReviewData={...this.mitigationReviewData},console.log(`Mitigation ${e} remarks updated successfully`)):pv.OQ.warning("Please provide remarks for rejection")},handleFileUpload(e,a){const t=e.target.files[0];if(!t)return;if(t.size>5242880)return pv.OQ.error("File size exceeds 5MB limit"),void(e.target.value="");this.mitigationSteps[a].uploading=!0;const i=new FormData;i.append("file",t),i.append("incidentId",this.selectedIncidentId),i.append("mitigationNumber",a+1),qe.A.post("http://localhost:8000/api/upload-file/",i,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log("File processed successfully:",e.data),e.data.success?(this.mitigationSteps[a]["aws-file_link"]=e.data.file_url,this.mitigationSteps[a].fileName=t.name,pv.OQ.success("File uploaded successfully")):pv.OQ.error("Error uploading file: "+e.data.error)}).catch(e=>{console.error("Error processing file:",e),e.response&&e.response.data&&e.response.data.error?pv.OQ.error("Error uploading file: "+e.response.data.error):pv.OQ.error("Error uploading file. Please try again.")}).finally(()=>{this.mitigationSteps[a].uploading=!1})},reviewMitigations(e){const a=e&&"audit_finding"===e.itemType;console.log(`Starting reviewMitigations with ${a?"audit finding":"incident"} task:`,e),this.currentReviewTask=e,this.selectedIncidentId=e.id,this.loadingMitigations=!0,this.showReviewerWorkflow=!0,this.previousVersions={},this.assessmentFeedback={};const t=a?`http://localhost:8000/api/audit-finding-review-data/${e.id}/`:`http://localhost:8000/api/incident-review-data/${e.id}/`;qe.A.get(t).then(e=>{if(console.log((a?"Audit finding":"Incident")+" review data:",e.data),e.data){this.mitigationReviewData=e.data.mitigations||{},this.questionnaireReviewData=e.data.questionnaire_data||{},this.previousVersions=e.data.previous_versions||{},e.data.assessment_feedback&&(this.assessmentFeedback=e.data.assessment_feedback);const a=e.data.approval_entry?.review_completed;this.reviewCompleted=a,this.reviewApproved="Approved"===e.data.approval_entry?.approved_rejected,this.loadingMitigations=!1}else this.mitigationReviewData={},this.questionnaireReviewData={},this.previousVersions={},this.assessmentFeedback={},this.loadingMitigations=!1}).catch(e=>{console.error(`Error fetching ${a?"audit finding":"incident"} review data:`,e),this.mitigationReviewData={},this.questionnaireReviewData={},this.previousVersions={},this.assessmentFeedback={},this.loadingMitigations=!1})},formatDateTime(e){if(!e)return"";const a=new Date(e);return a.toLocaleDateString()+" "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},formatDate(e){if(!e)return"Not set";const a=new Date(e);return a.toLocaleDateString()},getDueStatusClass(e){if(!e)return"";const a=new Date(e),t=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);const i=Math.floor((a-t)/864e5);return i<0?"overdue":i<=3?"urgent":i<=7?"warning":"on-track"},getDueStatusText(e){if(!e)return"";const a=new Date(e),t=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);const i=Math.floor((a-t)/864e5);return i<0?`(Delayed by ${Math.abs(i)} days)`:0===i?"(Due today)":1===i?"(Due tomorrow)":`(${i} days left)`},getPreviousMitigation(e){return this.previousVersions&&"object"===typeof this.previousVersions&&this.previousVersions[e]?this.previousVersions[e]:null},isStepActive(e){const a=this.mitigationSteps[e];return!1===a.approved||null===a.approved},isStepLocked(e){const a=this.mitigationSteps[e];return!0===a.approved},isOverdue(e){if(!e)return!1;const a=new Date(e),t=new Date;return a.setHours(0,0,0,0),t.setHours(0,0,0,0),a<t},initializeFromQuery(){const e=this.$route.query;e.userId&&(this.selectedUserId=e.userId),e.taskId&&this.viewMitigations(e.taskId),"reviewer"===e.mode&&e.taskId&&(this.activeTab="reviewer",this.$nextTick(()=>{const a={id:e.taskId};this.reviewMitigations(a)}))},validateCurrencyInput(e,a){const t=a.target.value;if(!t||""===t)return;const i=t.replace(/[^0-9.]/g,""),s=/^[0-9]+(\.[0-9]{0,2})?$/;if(s.test(i)){const e=parseFloat(i);e<0?a.target.setCustomValidity("Amount cannot be negative"):e>999999999.99?a.target.setCustomValidity("Amount exceeds maximum allowed value"):a.target.setCustomValidity("")}else a.target.setCustomValidity("Please enter a valid amount (e.g., 1000.50)");this.questionnaireData[e]=i},validateHoursInput(e,a){const t=a.target.value;if(!t||""===t)return;const i=/^[0-9]+(\.[0-9]{0,2})?$/;if(i.test(t)){const e=parseFloat(t);e<0?a.target.setCustomValidity("Hours cannot be negative"):e>8760?a.target.setCustomValidity("Hours exceeds reasonable maximum (8760 = 1 year)"):a.target.setCustomValidity("")}else a.target.setCustomValidity("Please enter a valid number of hours (e.g., 8.5)")},toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]},testEndpoints(){if(0===this.userIncidents.length)return void pv.OQ.error("No incidents available for testing");const e=this.userIncidents[0].id,a="audit_finding"===this.userIncidents[0].itemType;console.log("Testing API endpoints with ID:",e);const t=a?`http://localhost:8000/api/audit-finding-mitigations/${e}/`:`http://localhost:8000/api/incident-mitigations/${e}/`,i=a?`http://localhost:8000/api/audit-finding-review-data/${e}/`:`http://localhost:8000/api/incident-review-data/${e}/`;qe.A.get(t).then(e=>{console.log("Mitigations endpoint test successful:",e.data),pv.OQ.success("Mitigations endpoint test successful")}).catch(e=>{console.error("Mitigations endpoint test failed:",e),pv.OQ.error(`Mitigations endpoint test failed: ${e.message}`)}),qe.A.get(i).then(e=>{console.log("Review endpoint test successful:",e.data),pv.OQ.success("Review endpoint test successful")}).catch(e=>{console.error("Review endpoint test failed:",e),pv.OQ.error(`Review endpoint test failed: ${e.message}`)})}}};const XG=(0,se.A)(MG,[["render",VG],["__scopeId","data-v-00b1e972"]]);var UG=XG;const NG={class:"audits-container"},$G={key:0,class:"error-message"},OG={class:"search-container"},jG={class:"audits-search"},BG={class:"view-toggle"},WG={key:0,class:"active-filters"},QG=["onClick"],qG={key:1,class:"loading-indicator"},KG={key:2,class:"audits-table-wrapper"},JG={class:"audits-table"},zG=["onClick"],HG=["title"],YG=["title"],GG=["title"],ZG=["title"],eZ=["title"],aZ=["title"],tZ=["title"],iZ=["title"],sZ={class:"status-dropdown-container"},oZ=["onClick"],lZ={key:0,class:"status-options"},nZ=["onClick"],rZ=["onClick"],cZ=["onClick"],dZ=["title"],uZ={key:0},pZ={key:3,class:"audits-card-wrapper"},vZ={key:0,class:"no-data"},mZ={key:1,class:"audits-card-grid"},kZ=["onClick"],hZ={class:"card-header"},gZ={class:"card-framework"},yZ=["onClick"],fZ={key:0,class:"status-options"},bZ=["onClick"],CZ=["onClick"],LZ=["onClick"],wZ={class:"card-body"},EZ={class:"card-info-row"},RZ={class:"card-info-value"},DZ={class:"card-info-row"},IZ={class:"card-info-value"},PZ={class:"card-info-row"},_Z={class:"card-info-value"},SZ={class:"card-info-row"},AZ={class:"card-info-value"},TZ={class:"card-info-row"},xZ={class:"card-info-value"},FZ={class:"card-info-row"},VZ={class:"card-info-value"},MZ={class:"card-footer"},XZ={class:"card-audit-type"},UZ={class:"card-report"},NZ={key:4,class:"sort-dropdown-overlay"},$Z={class:"dropdown-content"},OZ={class:"dropdown-header"},jZ=["onClick"],BZ={key:5,class:"audits-modal"},WZ={class:"audits-modal-content audit-details-modal"},QZ={class:"modal-header"},qZ={key:0,class:"loading-indicator"},KZ={key:1,class:"audit-details-content"},JZ={class:"audit-info"},zZ={class:"info-item"},HZ={class:"info-item"},YZ={class:"info-item"},GZ={class:"info-item"},ZZ={class:"info-item"},e0={class:"info-item"},a0={class:"info-item"},t0={class:"info-item"},i0={class:"info-item"},s0={key:0,class:"compliance-items"},o0={class:"compliance-table"},l0={key:1,class:"no-compliance-items"};function n0(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",NG,[a[67]||(a[67]=(0,s.Lk)("div",{class:"audits-header"},[(0,s.Lk)("h1",null,"Audits")],-1)),l.error?((0,s.uX)(),(0,s.CE)("div",$G,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>n.retryLoading&&n.retryLoading(...e)),class:"retry-btn"},"Retry")])):(0,s.Q3)("",!0),(0,s.Lk)("div",OG,[(0,s.Lk)("div",jG,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Search","onUpdate:modelValue":a[1]||(a[1]=e=>l.searchQuery=e),onInput:a[2]||(a[2]=(...e)=>n.handleSearch&&n.handleSearch(...e))},null,544),[[i.Jo,l.searchQuery]])]),(0,s.Lk)("div",BG,[(0,s.Lk)("button",{class:(0,d.C4)(["view-btn",{active:"list"===l.viewMode}]),onClick:a[3]||(a[3]=e=>l.viewMode="list")},a[20]||(a[20]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" List ")]),2),(0,s.Lk)("button",{class:(0,d.C4)(["view-btn",{active:"card"===l.viewMode}]),onClick:a[4]||(a[4]=e=>l.viewMode="card")},a[21]||(a[21]=[(0,s.Lk)("i",{class:"fas fa-th-large"},null,-1),(0,s.eW)(" Card ")]),2)]),Object.keys(l.activeFilters).length>0?((0,s.uX)(),(0,s.CE)("div",WG,[a[22]||(a[22]=(0,s.Lk)("span",null,"Active Filters: ",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeFilters,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:a,class:"filter-badge"},[(0,s.eW)((0,d.v_)(a)+": "+(0,d.v_)(e)+" ",1),(0,s.Lk)("span",{class:"remove-filter",onClick:e=>n.applyFilter(a,"")},"Ã—",8,QG)]))),128))])):(0,s.Q3)("",!0)]),l.loading?((0,s.uX)(),(0,s.CE)("div",qG," Loading data, please wait... ")):"list"===l.viewMode?((0,s.uX)(),(0,s.CE)("div",KG,[(0,s.Lk)("table",JG,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,[a[23]||(a[23]=(0,s.eW)(" Frame work ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[5]||(a[5]=e=>n.toggleSortDropdown("framework"))},"â–¼")]),(0,s.Lk)("th",null,[a[24]||(a[24]=(0,s.eW)(" Policy ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[6]||(a[6]=e=>n.toggleSortDropdown("policy"))},"â–¼")]),(0,s.Lk)("th",null,[a[25]||(a[25]=(0,s.eW)(" Subpolicy ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[7]||(a[7]=e=>n.toggleSortDropdown("subpolicy"))},"â–¼")]),(0,s.Lk)("th",null,[a[26]||(a[26]=(0,s.eW)(" Auditor ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[8]||(a[8]=e=>n.toggleSortDropdown("auditor"))},"â–¼")]),(0,s.Lk)("th",null,[a[27]||(a[27]=(0,s.eW)(" Duedate ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[9]||(a[9]=e=>n.toggleSortDropdown("duedate"))},"â–¼")]),(0,s.Lk)("th",null,[a[28]||(a[28]=(0,s.eW)(" Frequency ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[10]||(a[10]=e=>n.toggleSortDropdown("frequency"))},"â–¼")]),(0,s.Lk)("th",null,[a[29]||(a[29]=(0,s.eW)(" Review ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[11]||(a[11]=e=>n.toggleSortDropdown("reviewer"))},"â–¼")]),(0,s.Lk)("th",null,[a[30]||(a[30]=(0,s.eW)(" Audit Type ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[12]||(a[12]=e=>n.toggleSortDropdown("audit_type"))},"â–¼")]),(0,s.Lk)("th",null,[a[31]||(a[31]=(0,s.eW)(" Status ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[13]||(a[13]=e=>n.toggleSortDropdown("status"))},"â–¼")]),(0,s.Lk)("th",null,[a[32]||(a[32]=(0,s.eW)(" Report ")),(0,s.Lk)("span",{class:"sort-icon",onClick:a[14]||(a[14]=e=>n.toggleSortDropdown("report"))},"â–¼")])])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredAuditData,(e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t,onClick:a=>e&&e.audit_id?n.viewAuditDetails(e.audit_id):null,class:"audit-row"},[(0,s.Lk)("td",{title:e&&e.framework||"-"},(0,d.v_)(n.formatCellText(e&&e.framework||"-")),9,HG),(0,s.Lk)("td",{title:e&&e.policy||"-"},(0,d.v_)(n.formatCellText(e&&e.policy||"-")),9,YG),(0,s.Lk)("td",{title:e&&e.subpolicy||"-"},(0,d.v_)(n.formatCellText(e&&e.subpolicy||"-")),9,GG),(0,s.Lk)("td",{title:e&&e.auditor||"-"},(0,d.v_)(n.formatCellText(e&&e.auditor||"-")),9,ZG),(0,s.Lk)("td",{title:e&&e.duedate||"-"},(0,d.v_)(n.formatCellText(e&&e.duedate||"-")),9,eZ),(0,s.Lk)("td",{title:e&&e.frequency||"-"},(0,d.v_)(n.formatCellText(e&&e.frequency||"-")),9,aZ),(0,s.Lk)("td",{title:e&&e.reviewer||"-"},(0,d.v_)(n.formatCellText(e&&e.reviewer||"-")),9,tZ),(0,s.Lk)("td",{title:e&&e.audit_type||"-"},(0,d.v_)(n.formatCellText(e&&e.audit_type||"-")),9,iZ),(0,s.Lk)("td",{onClick:a[15]||(a[15]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",sZ,[(0,s.Lk)("span",{class:(0,d.C4)([n.getStatusClass(e&&e.status),"status-badge status-clickable"]),onClick:(0,i.D$)(e=>n.openStatusDropdown(e,t),["stop"])},[(0,s.eW)((0,d.v_)(e&&e.status||"-")+" ",1),a[33]||(a[33]=(0,s.Lk)("i",{class:"fas fa-chevron-down status-dropdown-icon"},null,-1))],10,oZ),l.openStatusIdx===t?((0,s.uX)(),(0,s.CE)("div",lZ,[(0,s.Lk)("div",{class:"status-option",onClick:(0,i.D$)(a=>n.changeStatus(a,e,"Completed"),["stop"])},a[34]||(a[34]=[(0,s.Lk)("span",{class:"status-dot completed"},null,-1),(0,s.eW)(" Completed ")]),8,nZ),(0,s.Lk)("div",{class:"status-option",onClick:(0,i.D$)(a=>n.changeStatus(a,e,"Work in Progress"),["stop"])},a[35]||(a[35]=[(0,s.Lk)("span",{class:"status-dot progress"},null,-1),(0,s.eW)(" Work in Progress ")]),8,rZ),(0,s.Lk)("div",{class:"status-option",onClick:(0,i.D$)(a=>n.changeStatus(a,e,"Yet to Start"),["stop"])},a[36]||(a[36]=[(0,s.Lk)("span",{class:"status-dot start"},null,-1),(0,s.eW)(" Yet to Start ")]),8,cZ)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("td",{title:e&&e.report||"-"},(0,d.v_)(n.formatCellText(e&&e.report||"-")),9,dZ)],8,zG))),128)),l.filteredAuditData&&0!==l.filteredAuditData.length?l.filteredAuditData.length<6?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(6-l.filteredAuditData.length,e=>((0,s.uX)(),(0,s.CE)("tr",{key:"empty-"+e},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(10,e=>(0,s.Lk)("td",{key:e})),64))]))),128)):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("tr",uZ,a[37]||(a[37]=[(0,s.Lk)("td",{colspan:"10",class:"no-data"},"No audit data available",-1)])))])])])):((0,s.uX)(),(0,s.CE)("div",pZ,[l.filteredAuditData&&0!==l.filteredAuditData.length?((0,s.uX)(),(0,s.CE)("div",mZ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredAuditData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"audit-card",onClick:a=>e&&e.audit_id?n.viewAuditDetails(e.audit_id):null},[(0,s.Lk)("div",hZ,[(0,s.Lk)("div",gZ,(0,d.v_)(n.formatCellText(e&&e.framework||"-")),1),(0,s.Lk)("div",{class:"status-dropdown-container",onClick:a[16]||(a[16]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:(0,d.C4)([n.getStatusClass(e&&e.status),"status-badge status-clickable"]),onClick:(0,i.D$)(e=>n.openStatusDropdown(e,"card-"+t),["stop"])},[(0,s.eW)((0,d.v_)(e&&e.status||"-")+" ",1),a[38]||(a[38]=(0,s.Lk)("i",{class:"fas fa-chevron-down status-dropdown-icon"},null,-1))],10,yZ),l.openStatusIdx==="card-"+t?((0,s.uX)(),(0,s.CE)("div",fZ,[(0,s.Lk)("div",{class:"status-option",onClick:(0,i.D$)(a=>n.changeStatus(a,e,"Completed"),["stop"])},a[39]||(a[39]=[(0,s.Lk)("span",{class:"status-dot completed"},null,-1),(0,s.eW)(" Completed ")]),8,bZ),(0,s.Lk)("div",{class:"status-option",onClick:(0,i.D$)(a=>n.changeStatus(a,e,"Work in Progress"),["stop"])},a[40]||(a[40]=[(0,s.Lk)("span",{class:"status-dot progress"},null,-1),(0,s.eW)(" Work in Progress ")]),8,CZ),(0,s.Lk)("div",{class:"status-option",onClick:(0,i.D$)(a=>n.changeStatus(a,e,"Yet to Start"),["stop"])},a[41]||(a[41]=[(0,s.Lk)("span",{class:"status-dot start"},null,-1),(0,s.eW)(" Yet to Start ")]),8,LZ)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",wZ,[(0,s.Lk)("div",EZ,[a[42]||(a[42]=(0,s.Lk)("div",{class:"card-info-icon"},"ðŸ“„",-1)),a[43]||(a[43]=(0,s.Lk)("div",{class:"card-info-label"},"Policy:",-1)),(0,s.Lk)("div",RZ,(0,d.v_)(n.formatCellText(e&&e.policy||"-")),1)]),(0,s.Lk)("div",DZ,[a[44]||(a[44]=(0,s.Lk)("div",{class:"card-info-icon"},"ðŸ“",-1)),a[45]||(a[45]=(0,s.Lk)("div",{class:"card-info-label"},"Subpolicy:",-1)),(0,s.Lk)("div",IZ,(0,d.v_)(n.formatCellText(e&&e.subpolicy||"-")),1)]),(0,s.Lk)("div",PZ,[a[46]||(a[46]=(0,s.Lk)("div",{class:"card-info-icon"},"ðŸ‘¤",-1)),a[47]||(a[47]=(0,s.Lk)("div",{class:"card-info-label"},"Auditor:",-1)),(0,s.Lk)("div",_Z,(0,d.v_)(n.formatCellText(e&&e.auditor||"-")),1)]),(0,s.Lk)("div",SZ,[a[48]||(a[48]=(0,s.Lk)("div",{class:"card-info-icon"},"ðŸ“…",-1)),a[49]||(a[49]=(0,s.Lk)("div",{class:"card-info-label"},"Due Date:",-1)),(0,s.Lk)("div",AZ,(0,d.v_)(n.formatCellText(e&&e.duedate||"-")),1)]),(0,s.Lk)("div",TZ,[a[50]||(a[50]=(0,s.Lk)("div",{class:"card-info-icon"},"ðŸ”„",-1)),a[51]||(a[51]=(0,s.Lk)("div",{class:"card-info-label"},"Frequency:",-1)),(0,s.Lk)("div",xZ,(0,d.v_)(n.formatCellText(e&&e.frequency||"-")),1)]),(0,s.Lk)("div",FZ,[a[52]||(a[52]=(0,s.Lk)("div",{class:"card-info-icon"},"ðŸ‘ï¸",-1)),a[53]||(a[53]=(0,s.Lk)("div",{class:"card-info-label"},"Reviewer:",-1)),(0,s.Lk)("div",VZ,(0,d.v_)(n.formatCellText(e&&e.reviewer||"-")),1)])]),(0,s.Lk)("div",MZ,[(0,s.Lk)("div",XZ,[(0,s.Lk)("span",null,"ðŸ·ï¸ "+(0,d.v_)(n.formatCellText(e&&e.audit_type||"-")),1)]),(0,s.Lk)("div",UZ,[(0,s.Lk)("span",null,"ðŸ“Š "+(0,d.v_)(e&&e.report?"Report Available":"No Report"),1)])])],8,kZ))),128))])):((0,s.uX)(),(0,s.CE)("div",vZ," No audit data available "))])),l.activeDropdown?((0,s.uX)(),(0,s.CE)("div",NZ,[(0,s.Lk)("div",$Z,[(0,s.Lk)("div",OZ,[(0,s.Lk)("span",null,"Filter by "+(0,d.v_)(l.activeDropdown),1),(0,s.Lk)("span",{class:"close-dropdown",onClick:a[17]||(a[17]=e=>l.activeDropdown=null)},"Ã—")]),(0,s.Lk)("div",{class:"dropdown-item",onClick:a[18]||(a[18]=e=>n.applyFilter(l.activeDropdown,""))},"Show All"),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getUniqueValues(l.activeDropdown),e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"dropdown-item",onClick:a=>n.applyFilter(l.activeDropdown,e)},(0,d.v_)(e),9,jZ))),128))])])):(0,s.Q3)("",!0),l.showAuditDetails&&l.currentAudit?((0,s.uX)(),(0,s.CE)("div",BZ,[(0,s.Lk)("div",WZ,[(0,s.Lk)("div",QZ,[a[54]||(a[54]=(0,s.Lk)("h2",null,"Audit Details",-1)),(0,s.Lk)("button",{type:"button",class:"close-btn",onClick:a[19]||(a[19]=(...e)=>n.closeAuditDetails&&n.closeAuditDetails(...e))},"Ã—")]),l.loadingAuditDetails?((0,s.uX)(),(0,s.CE)("div",qZ," Loading audit details... ")):l.currentAudit?((0,s.uX)(),(0,s.CE)("div",KZ,[(0,s.Lk)("div",JZ,[(0,s.Lk)("div",zZ,[a[55]||(a[55]=(0,s.Lk)("strong",null,"Framework:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.framework||"N/A"),1)]),(0,s.Lk)("div",HZ,[a[56]||(a[56]=(0,s.Lk)("strong",null,"Policy:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.policy||"N/A"),1)]),(0,s.Lk)("div",YZ,[a[57]||(a[57]=(0,s.Lk)("strong",null,"Subpolicy:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.subpolicy||"N/A"),1)]),(0,s.Lk)("div",GZ,[a[58]||(a[58]=(0,s.Lk)("strong",null,"Auditor:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.auditor||"N/A"),1)]),(0,s.Lk)("div",ZZ,[a[59]||(a[59]=(0,s.Lk)("strong",null,"Assignee:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.assignee||"N/A"),1)]),(0,s.Lk)("div",e0,[a[60]||(a[60]=(0,s.Lk)("strong",null,"Reviewer:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.reviewer||"N/A"),1)]),(0,s.Lk)("div",a0,[a[61]||(a[61]=(0,s.Lk)("strong",null,"Due Date:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.duedate||"N/A"),1)]),(0,s.Lk)("div",t0,[a[62]||(a[62]=(0,s.Lk)("strong",null,"Status:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.status||"N/A"),1)]),(0,s.Lk)("div",i0,[a[63]||(a[63]=(0,s.Lk)("strong",null,"Completion:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.completed_compliances||0)+"/"+(0,d.v_)(l.currentAudit.total_compliances||0),1)])]),l.currentAudit.compliance_items&&l.currentAudit.compliance_items.length>0?((0,s.uX)(),(0,s.CE)("div",s0,[a[65]||(a[65]=(0,s.Lk)("h3",null,"Compliance Items",-1)),(0,s.Lk)("table",o0,[a[64]||(a[64]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"ID"),(0,s.Lk)("th",null,"Description"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Status")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.currentAudit.compliance_items,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.ComplianceId},[(0,s.Lk)("td",null,(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.ComplianceItemDescription),1),(0,s.Lk)("td",null,(0,d.v_)(n.formatCriticality(e.Criticality)),1),(0,s.Lk)("td",null,(0,d.v_)(e.status_text),1)]))),128))])])])):((0,s.uX)(),(0,s.CE)("div",l0,a[66]||(a[66]=[(0,s.Lk)("p",null,"No compliance items found for this audit.",-1)])))])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])}var r0={name:"AuditsView",data(){return{searchQuery:"",auditData:[],filteredAuditData:[],error:"",loading:!0,showAuditDetails:!1,currentAudit:null,loadingAuditDetails:!1,activeDropdown:null,activeFilters:{},viewMode:"list",openStatusIdx:null}},mounted(){console.log("Audits component mounted, fetching data..."),this.fetchAuditData(),document.addEventListener("click",this.closeDropdownOnClickOutside)},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{retryLoading(){this.fetchAuditData()},fetchAuditData(){console.log("Fetching audit data..."),this.loading=!0,this.error="",JD.FH.getAllAudits().then(e=>{console.log("Audit data received:",e.data),Array.isArray(e.data)?(this.auditData=e.data,this.filteredAuditData=e.data):(console.warn("Received non-array audit data:",e.data),this.auditData=[],this.filteredAuditData=[]),this.loading=!1}).catch(e=>{console.error("Error fetching audit data:",e),this.auditData=[],this.filteredAuditData=[],this.error=`Failed to load data: ${e.message||e}`,this.loading=!1})},handleSearch(){this.applyFilters()},toggleSortDropdown(e){this.activeDropdown===e?this.activeDropdown=null:this.activeDropdown=e},closeDropdownOnClickOutside(e){e.target.closest(".sort-dropdown")||e.target.closest(".sort-icon")||(this.activeDropdown=null)},getUniqueValues(e){return Array.isArray(this.auditData)?[...new Set(this.auditData.map(a=>a[e]).filter(Boolean))].sort():[]},applyFilter(e,a){""===a?this.activeFilters[e]&&delete this.activeFilters[e]:this.activeFilters[e]=a,this.activeDropdown=null,this.applyFilters()},applyFilters(){if(!Array.isArray(this.auditData))return void(this.filteredAuditData=[]);const e=this.searchQuery.toLowerCase();let a=this.auditData;e&&(a=a.filter(a=>a.framework&&a.framework.toLowerCase().includes(e)||a.policy&&a.policy.toLowerCase().includes(e)||a.subpolicy&&a.subpolicy.toLowerCase().includes(e)||a.auditor&&a.auditor.toLowerCase().includes(e)||a.status&&a.status.toLowerCase().includes(e)));for(const[t,i]of Object.entries(this.activeFilters))a=a.filter(e=>e[t]===i);this.filteredAuditData=a},viewAuditDetails(e){e?(this.loadingAuditDetails=!0,this.currentAudit=null,this.showAuditDetails=!0,console.log("Fetching audit details for ID:",e),JD.FH.getAuditDetails(e).then(e=>{console.log("Audit details received:",e.data),this.currentAudit=e.data,this.loadingAuditDetails=!1}).catch(e=>{console.error("Error fetching audit details:",e),this.error=e.response?.data?.error||`Failed to load audit details: ${e.message||e}`,this.loadingAuditDetails=!1,this.showAuditDetails=!1})):this.error="Invalid audit ID"},closeAuditDetails(){this.showAuditDetails=!1,this.currentAudit=null},formatCriticality(e){return 0===e||"0"===e?"Minor":1===e||"1"===e?"Major":2===e||"2"===e?"Not Applicable":"string"===typeof e&&isNaN(parseInt(e))?e:"Not Specified"},getStatusClass(e){return e?e.toLowerCase().includes("complete")?"status-completed":e.toLowerCase().includes("progress")?"status-progress":e.toLowerCase().includes("pending")?"status-pending":e.toLowerCase().includes("start")?"status-start":"":""},formatCellText(e){return"string"!==typeof e?e:e.length>25?e.substring(0,23)+"...":e},openStatusDropdown(e,a){e.stopPropagation(),this.openStatusIdx=this.openStatusIdx===a?null:a},changeStatus(e,a,t){e.stopPropagation(),a&&a.audit_id?(this.loading=!0,this.error="",JD.FH.updateAuditStatus(a.audit_id,t).then(e=>{console.log("Status updated successfully:",e.data),a.status=t,this.loading=!1,this.openStatusIdx=null}).catch(e=>{console.error("Error updating audit status:",e),this.error=`Failed to update status: ${e.message||e}`,this.loading=!1})):this.error="Cannot update status: Invalid audit"}}};const c0=(0,se.A)(r0,[["render",n0],["__scopeId","data-v-6334466c"]]);var d0=c0;const u0={class:"create-compliance-container"},p0={class:"field-group selection-fields"},v0={class:"row-fields"},m0={class:"compliance-field"},k0={class:"compliance-field"},h0={class:"compliance-field"},g0={class:"compliance-list"},y0={class:"compliance-tabs"},f0=["onClick"],b0=["onClick"],C0={class:"item-header"},L0={class:"item-number"},w0={class:"field-group"},E0={class:"row-fields"},R0={class:"compliance-field"},D0=["onUpdate:modelValue"],I0={class:"compliance-field checkbox-container"},P0={style:{"font-weight":"500","font-size":"0.9rem",display:"flex","align-items":"center",gap:"6px"},title:"Check if this compliance item represents a risk"},_0=["onUpdate:modelValue","onChange"],S0={class:"row-fields"},A0={class:"compliance-field"},T0=["onUpdate:modelValue","onInput","maxlength"],x0={key:0,class:"validation-error"},F0={class:"compliance-field"},V0=["onUpdate:modelValue","onInput","maxlength"],M0={key:0,class:"validation-error"},X0={class:"compliance-field full-width"},U0=["onUpdate:modelValue","onInput","placeholder","maxlength"],N0={key:0,class:"validation-error"},$0={class:"compliance-field full-width"},O0=["onUpdate:modelValue","onInput","maxlength"],j0={key:0,class:"validation-error"},B0={class:"compliance-field full-width"},W0=["onUpdate:modelValue","onInput","maxlength"],Q0={key:0,class:"validation-error"},q0={class:"row-fields"},K0={class:"compliance-field full-width"},J0={class:"searchable-dropdown"},z0=["onUpdate:modelValue","onFocus","onInput"],H0={class:"dropdown-options"},Y0={key:0,class:"dropdown-add-option"},G0=["onClick"],Z0=["onClick"],e1={key:0,class:"validation-error"},a1={class:"field-group risk-fields"},t1={class:"compliance-field full-width"},i1=["onUpdate:modelValue","onInput","maxlength"],s1={key:0,class:"validation-error"},o1={class:"compliance-field full-width"},l1={class:"mitigation-steps"},n1={class:"step-header"},r1={class:"step-numberr"},c1=["onClick"],d1=["onUpdate:modelValue","onInput"],u1={class:"add-step-container"},p1=["onClick"],v1={key:0,class:"validation-error"},m1={class:"compliance-field full-width"},k1=["onUpdate:modelValue","onInput","maxlength"],h1={key:0,class:"validation-error"},g1={class:"row-fields"},y1={class:"compliance-field"},f1=["onUpdate:modelValue","maxlength","onChange"],b1={key:0,class:"validation-error"},C1={class:"compliance-field"},L1={class:"searchable-dropdown"},w1=["onUpdate:modelValue","maxlength","onFocus","onInput"],E1={class:"dropdown-options"},R1={key:0,class:"dropdown-add-option"},D1=["onClick"],I1=["onClick"],P1={key:0,class:"validation-error"},_1={class:"compliance-field"},S1={class:"searchable-dropdown"},A1=["onUpdate:modelValue","maxlength","onFocus","onInput"],T1={class:"dropdown-options"},x1={key:0,class:"dropdown-add-option"},F1=["onClick"],V1=["onClick"],M1={key:0,class:"validation-error"},X1={class:"field-group classification-fields"},U1={class:"row-fields"},N1={class:"compliance-field"},$1=["onUpdate:modelValue"],O1={class:"compliance-field"},j1=["onUpdate:modelValue"],B1={class:"row-fields"},W1={class:"compliance-field"},Q1=["onUpdate:modelValue"],q1={class:"compliance-field"},K1=["onUpdate:modelValue"],J1={class:"row-fields"},z1={class:"compliance-field"},H1=["onUpdate:modelValue","onInput"],Y1={key:0,class:"validation-error"},G1={class:"compliance-field"},Z1=["onUpdate:modelValue","onInput"],e2={key:0,class:"validation-error"},a2={class:"field-group approval-fields"},t2={class:"row-fields"},i2={class:"compliance-field"},s2={key:0,class:"validation-error"},o2={class:"compliance-submit-container"},l2=["disabled"],n2={key:0,class:"btn-icon"},r2={key:1},c2={key:2};function d2(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)("div",u0,[a[65]||(a[65]=(0,s.Lk)("div",{class:"compliance-headers"},[(0,s.Lk)("span",null,"Control Management"),(0,s.Lk)("div",{class:"compliance-headers-underline"})],-1)),(0,s.bF)(r),(0,s.Lk)("div",p0,[a[8]||(a[8]=(0,s.Lk)("div",{class:"field-group-title"},"Select Policy Framework",-1)),(0,s.Lk)("div",v0,[(0,s.Lk)("div",m0,[a[5]||(a[5]=(0,s.Lk)("label",{for:"framework"},"Framework",-1)),(0,s.bF)(c,{config:l.frameworkConfig,modelValue:l.selectedFramework,"onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedFramework=e),onChange:n.onFrameworkChange},null,8,["config","modelValue","onChange"])]),(0,s.Lk)("div",k0,[a[6]||(a[6]=(0,s.Lk)("label",{for:"policy"},"Policy",-1)),(0,s.bF)(c,{config:l.policyConfig,modelValue:l.selectedPolicy,"onUpdate:modelValue":a[1]||(a[1]=e=>l.selectedPolicy=e),onChange:n.onPolicyChange},null,8,["config","modelValue","onChange"])]),(0,s.Lk)("div",h0,[a[7]||(a[7]=(0,s.Lk)("label",{for:"subpolicy"},"Sub Policy",-1)),(0,s.bF)(c,{config:l.subPolicyConfig,modelValue:l.selectedSubPolicy,"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedSubPolicy=e),onChange:n.onSubPolicyChange},null,8,["config","modelValue","onChange"])])])]),(0,s.Lk)("div",g0,[(0,s.Lk)("div",y0,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.complianceList,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["compliance-tab",{"active-tab":l.activeTab===t}]),onClick:e=>l.activeTab=t},[(0,s.Lk)("span",null,"Item #"+(0,d.v_)(t+1),1),l.complianceList.length>1?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"tab-remove-btn",onClick:(0,i.D$)(e=>n.removeCompliance(t),["stop"]),title:"Remove this compliance item"},a[9]||(a[9]=[(0,s.Lk)("span",{class:"btn-icon"},"Ã—",-1)]),8,b0)):(0,s.Q3)("",!0)],10,f0))),128)),(0,s.Lk)("button",{class:"add-tab-btn",onClick:a[3]||(a[3]=(...e)=>n.addCompliance&&n.addCompliance(...e)),title:"Add new compliance item"},a[10]||(a[10]=[(0,s.Lk)("span",{class:"btn-icon"},"+",-1)]))]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.complianceList,(e,t)=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",{key:t,class:"compliance-item-form"},[(0,s.Lk)("div",C0,[(0,s.Lk)("span",L0,"Compliance Item #"+(0,d.v_)(t+1),1)]),(0,s.Lk)("div",w0,[a[27]||(a[27]=(0,s.Lk)("div",{class:"field-group-title"},"Basic Information",-1)),(0,s.Lk)("div",E0,[(0,s.Lk)("div",R0,[a[11]||(a[11]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.Identifier=a,class:"compliance-input",placeholder:"Auto-generated if left empty",title:"Unique identifier for this compliance item (auto-generated if left blank)"},null,8,D0),[[i.Jo,e.Identifier]]),a[12]||(a[12]=(0,s.Lk)("small",null,"Leave empty for auto-generated identifier",-1))]),(0,s.Lk)("div",I0,[(0,s.Lk)("label",P0,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a=>e.IsRisk=a,onChange:e=>n.onFieldChange(t,"IsRisk",e),style:{"margin-right":"6px",width:"auto"}},null,40,_0),[[i.lH,e.IsRisk]]),a[13]||(a[13]=(0,s.eW)(" Is Risk "))])])]),(0,s.Lk)("div",S0,[(0,s.Lk)("div",A0,[a[14]||(a[14]=(0,s.Lk)("label",null,"Compliance Title",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.ComplianceTitle=a,onInput:e=>n.onFieldChange(t,"ComplianceTitle",e),class:"compliance-input",placeholder:"Enter compliance title",required:"",maxlength:l.validationRules.maxLengths.ComplianceTitle,title:"Enter the title of the compliance item"},null,40,T0),[[i.Jo,e.ComplianceTitle]]),a[15]||(a[15]=(0,s.Lk)("small",null,"Enter a clear, descriptive title for this compliance requirement (3-145 characters)",-1)),e.validationErrors&&e.validationErrors.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",x0,(0,d.v_)(e.validationErrors.ComplianceTitle.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",F0,[a[16]||(a[16]=(0,s.Lk)("label",null,"Compliance Type",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.ComplianceType=a,onInput:e=>n.onFieldChange(t,"ComplianceType",e),class:"compliance-input",placeholder:"Enter compliance type",required:"",maxlength:l.validationRules.maxLengths.ComplianceType,title:"Type of compliance (e.g. Regulatory, Internal, Security)"},null,40,V0),[[i.Jo,e.ComplianceType]]),a[17]||(a[17]=(0,s.Lk)("small",null,"Specify the type of compliance (e.g., Regulatory, Internal, Security, Operational)",-1)),e.validationErrors&&e.validationErrors.ComplianceType?((0,s.uX)(),(0,s.CE)("div",M0,(0,d.v_)(e.validationErrors.ComplianceType.join(", ")),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",X0,[a[18]||(a[18]=(0,s.Lk)("label",null,"Compliance Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.ComplianceItemDescription=a,onInput:e=>n.onFieldChange(t,"ComplianceItemDescription",e),class:"compliance-input",placeholder:`Compliance Description ${t+1}`,required:"",rows:"3",maxlength:l.validationRules.maxLengths.ComplianceItemDescription,title:"Detailed description of the compliance requirement"},null,40,U0),[[i.Jo,e.ComplianceItemDescription]]),a[19]||(a[19]=(0,s.Lk)("small",null,"Provide a detailed description of the compliance requirement and what it entails",-1)),e.validationErrors&&e.validationErrors.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",N0,(0,d.v_)(e.validationErrors.ComplianceItemDescription.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",$0,[a[20]||(a[20]=(0,s.Lk)("label",null,"Scope",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Scope=a,onInput:e=>n.onFieldChange(t,"Scope",e),class:"compliance-input",placeholder:"Enter scope information",rows:"3",required:"",maxlength:l.validationRules.maxLengths.Scope,title:"Define the boundaries and extent of the compliance requirement"},null,40,O0),[[i.Jo,e.Scope]]),a[21]||(a[21]=(0,s.Lk)("small",null,"Define the boundaries, systems, processes, and areas covered by this compliance requirement",-1)),e.validationErrors&&e.validationErrors.Scope?((0,s.uX)(),(0,s.CE)("div",j0,(0,d.v_)(e.validationErrors.Scope.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",B0,[a[22]||(a[22]=(0,s.Lk)("label",null,"Objective",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.Objective=a,onInput:e=>n.onFieldChange(t,"Objective",e),class:"compliance-input",placeholder:"Enter objective information",rows:"3",required:"",maxlength:l.validationRules.maxLengths.Objective,title:"The goal or purpose of this compliance requirement"},null,40,W0),[[i.Jo,e.Objective]]),a[23]||(a[23]=(0,s.Lk)("small",null,"Describe the goal, purpose, and intended outcome of this compliance requirement",-1)),e.validationErrors&&e.validationErrors.Objective?((0,s.uX)(),(0,s.CE)("div",Q0,(0,d.v_)(e.validationErrors.Objective.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",q0,[(0,s.Lk)("div",K0,[a[25]||(a[25]=(0,s.Lk)("label",null,"Business Units Covered",-1)),(0,s.Lk)("div",J0,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e=>l.businessUnitSearch[t]=e,class:"compliance-input",placeholder:"Search or add business units",title:"Departments or business units affected by this compliance",onFocus:e=>n.showDropdown(t,"BusinessUnitsCovered"),onInput:e=>n.filterOptions(t,"BusinessUnitsCovered")},null,40,z0),[[i.Jo,l.businessUnitSearch[t]]]),(0,s.bo)((0,s.Lk)("div",H0,[0===l.filteredOptions.BusinessUnitsCovered.length&&l.businessUnitSearch[t]?((0,s.uX)(),(0,s.CE)("div",Y0,[a[24]||(a[24]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:e=>n.addNewOption(t,"BusinessUnitsCovered",l.businessUnitSearch[t]),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.businessUnitSearch[t])+'" ',9,G0)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.BusinessUnitsCovered,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption(t,"BusinessUnitsCovered",e.value)},(0,d.v_)(e.value),9,Z0))),128))],512),[[i.aG,l.activeDropdown.index===t&&"BusinessUnitsCovered"===l.activeDropdown.field]])]),a[26]||(a[26]=(0,s.Lk)("small",null,"Select or add the departments, teams, or business units affected by this compliance requirement",-1)),e.validationErrors&&e.validationErrors.BusinessUnitsCovered?((0,s.uX)(),(0,s.CE)("div",e1,(0,d.v_)(e.validationErrors.BusinessUnitsCovered.join(", ")),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",a1,[a[45]||(a[45]=(0,s.Lk)("div",{class:"field-group-title"},"Risk Information",-1)),(0,s.Lk)("div",t1,[a[28]||(a[28]=(0,s.Lk)("label",null,"Possible Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.PossibleDamage=a,onInput:e=>n.onFieldChange(t,"PossibleDamage",e),class:"compliance-input",placeholder:"Possible Damage",rows:"3",required:"",maxlength:l.validationRules.maxLengths.PossibleDamage,title:"Potential damage that could occur if this risk materializes"},null,40,i1),[[i.Jo,e.PossibleDamage]]),a[29]||(a[29]=(0,s.Lk)("small",null,"Describe the potential damage, losses, or negative impacts that could occur if this risk materializes",-1)),e.validationErrors&&e.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",s1,(0,d.v_)(e.validationErrors.PossibleDamage.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",o1,[a[32]||(a[32]=(0,s.Lk)("label",null,"Mitigation Steps",-1)),(0,s.Lk)("div",l1,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.mitigationSteps,(e,o)=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"mitigation-step"},[(0,s.Lk)("div",n1,[(0,s.Lk)("span",r1,"Step "+(0,d.v_)(o+1),1),(0,s.Lk)("button",{type:"button",class:"remove-step-btn",onClick:e=>n.removeStep(t,o),title:"Remove this step"},a[30]||(a[30]=[(0,s.Lk)("span",{class:"btn-icon"},"Ã—",-1)]),8,c1)]),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.description=a,onInput:e=>n.onMitigationStepChange(t),class:"compliance-input",placeholder:"Describe this mitigation step (minimum 10 characters)",rows:"2",required:""},null,40,d1),[[i.Jo,e.description]])]))),128)),(0,s.Lk)("div",u1,[(0,s.Lk)("button",{type:"button",class:"add-step-btn",onClick:e=>n.addStep(t),title:"Add new mitigation step"},a[31]||(a[31]=[(0,s.Lk)("span",{class:"btn-icon"},"+",-1),(0,s.eW)(" Add Step ")]),8,p1)])]),a[33]||(a[33]=(0,s.Lk)("small",null,"Define specific steps or actions to reduce, control, or eliminate the identified risk (minimum 10 characters per step)",-1)),e.validationErrors&&e.validationErrors.mitigation?((0,s.uX)(),(0,s.CE)("div",v1,(0,d.v_)(e.validationErrors.mitigation.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",m1,[a[34]||(a[34]=(0,s.Lk)("label",null,"Potential Risk Scenarios",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.PotentialRiskScenarios=a,onInput:e=>n.onFieldChange(t,"PotentialRiskScenarios",e),class:"compliance-input",placeholder:"Describe potential risk scenarios",rows:"3",required:"",maxlength:l.validationRules.maxLengths.PotentialRiskScenarios,title:"Describe scenarios where this risk could materialize"},null,40,k1),[[i.Jo,e.PotentialRiskScenarios]]),a[35]||(a[35]=(0,s.Lk)("small",null,"Describe specific scenarios or conditions under which this risk could materialize",-1)),e.validationErrors&&e.validationErrors.PotentialRiskScenarios?((0,s.uX)(),(0,s.CE)("div",h1,(0,d.v_)(e.validationErrors.PotentialRiskScenarios.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",g1,[(0,s.Lk)("div",y1,[a[37]||(a[37]=(0,s.Lk)("label",null,"Risk Type",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.RiskType=a,class:"compliance-input",required:"",maxlength:l.validationRules.maxLengths.RiskType,title:"Type of risk",onChange:a=>n.validateComplianceField(e,"RiskType",a.target.value)},a[36]||(a[36]=[(0,s.Fv)('<option value="" data-v-7d89f63f>Select Risk Type</option><option value="Current" data-v-7d89f63f>Current</option><option value="Residual" data-v-7d89f63f>Residual</option><option value="Inherent" data-v-7d89f63f>Inherent</option><option value="Emerging" data-v-7d89f63f>Emerging</option><option value="Accepted" data-v-7d89f63f>Accepted</option>',6)]),40,f1),[[i.u1,e.RiskType]]),a[38]||(a[38]=(0,s.Lk)("small",null,"Select the type of risk: Current (existing), Residual (remaining after controls), Inherent (before controls), Emerging (new), or Accepted (tolerated)",-1)),e.validationErrors&&e.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("div",b1,(0,d.v_)(e.validationErrors.RiskType.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",C1,[a[40]||(a[40]=(0,s.Lk)("label",null,"Risk Category",-1)),(0,s.Lk)("div",L1,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e=>l.riskCategorySearch[t]=e,class:"compliance-input",placeholder:"Search or add risk category",required:"",maxlength:l.validationRules.maxLengths.RiskCategory,title:"Category of risk (e.g. People, Process, Technology, External)",onFocus:e=>n.showDropdown(t,"RiskCategory"),onInput:e=>n.filterOptions(t,"RiskCategory")},null,40,w1),[[i.Jo,l.riskCategorySearch[t]]]),(0,s.bo)((0,s.Lk)("div",E1,[0===l.filteredOptions.RiskCategory.length&&l.riskCategorySearch[t]?((0,s.uX)(),(0,s.CE)("div",R1,[a[39]||(a[39]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:e=>n.addNewOption(t,"RiskCategory",l.riskCategorySearch[t]),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskCategorySearch[t])+'" ',9,D1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskCategory,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption(t,"RiskCategory",e.value)},(0,d.v_)(e.value),9,I1))),128))],512),[[i.aG,l.activeDropdown.index===t&&"RiskCategory"===l.activeDropdown.field]])]),a[41]||(a[41]=(0,s.Lk)("small",null,"Select or add the category of risk (e.g., People, Process, Technology, External, Financial)",-1)),e.validationErrors&&e.validationErrors.RiskCategory?((0,s.uX)(),(0,s.CE)("div",P1,(0,d.v_)(e.validationErrors.RiskCategory.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_1,[a[43]||(a[43]=(0,s.Lk)("label",null,"Risk Business Impact",-1)),(0,s.Lk)("div",S1,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e=>l.riskBusinessImpactSearch[t]=e,class:"compliance-input",placeholder:"Search or add business impact",required:"",maxlength:l.validationRules.maxLengths.RiskBusinessImpact,title:"How this risk impacts business operations",onFocus:e=>n.showDropdown(t,"RiskBusinessImpact"),onInput:e=>n.filterOptions(t,"RiskBusinessImpact")},null,40,A1),[[i.Jo,l.riskBusinessImpactSearch[t]]]),(0,s.bo)((0,s.Lk)("div",T1,[0===l.filteredOptions.RiskBusinessImpact.length&&l.riskBusinessImpactSearch[t]?((0,s.uX)(),(0,s.CE)("div",x1,[a[42]||(a[42]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:e=>n.addNewOption(t,"RiskBusinessImpact",l.riskBusinessImpactSearch[t]),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskBusinessImpactSearch[t])+'" ',9,F1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskBusinessImpact,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption(t,"RiskBusinessImpact",e.value)},(0,d.v_)(e.value),9,V1))),128))],512),[[i.aG,l.activeDropdown.index===t&&"RiskBusinessImpact"===l.activeDropdown.field]])]),a[44]||(a[44]=(0,s.Lk)("small",null,"Select or add how this risk impacts business operations (e.g., Operational Disruption, Financial Loss, Reputation Damage)",-1)),e.validationErrors&&e.validationErrors.RiskBusinessImpact?((0,s.uX)(),(0,s.CE)("div",M1,(0,d.v_)(e.validationErrors.RiskBusinessImpact.join(", ")),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",X1,[a[61]||(a[61]=(0,s.Lk)("div",{class:"field-group-title"},"Classification",-1)),(0,s.Lk)("div",U1,[(0,s.Lk)("div",N1,[a[47]||(a[47]=(0,s.Lk)("label",null,"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.Criticality=a,class:"compliance-select",required:"",title:"How critical this compliance item is to the organization"},a[46]||(a[46]=[(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),8,$1),[[i.u1,e.Criticality]]),a[48]||(a[48]=(0,s.Lk)("small",null,"Select the criticality level based on the importance and impact of this compliance requirement",-1))]),(0,s.Lk)("div",O1,[a[50]||(a[50]=(0,s.Lk)("label",null,"Mandatory/Optional",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.MandatoryOptional=a,class:"compliance-select",required:"",title:"Whether this compliance item is mandatory or optional"},a[49]||(a[49]=[(0,s.Lk)("option",{value:"Mandatory"},"Mandatory",-1),(0,s.Lk)("option",{value:"Optional"},"Optional",-1)]),8,j1),[[i.u1,e.MandatoryOptional]]),a[51]||(a[51]=(0,s.Lk)("small",null,"Indicate whether this compliance requirement is mandatory (required) or optional (recommended)",-1))])]),(0,s.Lk)("div",B1,[(0,s.Lk)("div",W1,[a[53]||(a[53]=(0,s.Lk)("label",null,"Manual/Automatic",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a=>e.ManualAutomatic=a,class:"compliance-select",required:"",title:"Whether this compliance is checked manually or automatically"},a[52]||(a[52]=[(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Automatic"},"Automatic",-1)]),8,Q1),[[i.u1,e.ManualAutomatic]]),a[54]||(a[54]=(0,s.Lk)("small",null,"Specify whether this compliance is monitored manually (human review) or automatically (system/tool)",-1))]),(0,s.Lk)("div",q1,[a[55]||(a[55]=(0,s.Lk)("label",null,"Applicability",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a=>e.Applicability=a,class:"compliance-input",placeholder:"Applicability from policy",title:"Describes where this compliance item applies"},null,8,K1),[[i.Jo,e.Applicability]]),a[56]||(a[56]=(0,s.Lk)("small",null,"Describe where, when, and under what conditions this compliance requirement applies",-1))])]),(0,s.Lk)("div",J1,[(0,s.Lk)("div",z1,[a[57]||(a[57]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a=>e.Impact=a,onInput:e=>n.onFieldChange(t,"Impact",e),class:"compliance-input",step:"0.1",min:"1",max:"10",required:"",title:"Rate the Severity Rating from 1 (lowest) to 10 (highest)"},null,40,H1),[[i.Jo,e.Impact,void 0,{number:!0}]]),a[58]||(a[58]=(0,s.Lk)("small",null,"Rate the severity of non-compliance from 1 (minimal impact) to 10 (critical impact)",-1)),e.validationErrors&&e.validationErrors.Impact?((0,s.uX)(),(0,s.CE)("div",Y1,(0,d.v_)(e.validationErrors.Impact.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",G1,[a[59]||(a[59]=(0,s.Lk)("label",null,"Probability (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a=>e.Probability=a,onInput:e=>n.onFieldChange(t,"Probability",e),class:"compliance-input",step:"0.1",min:"1",max:"10",required:"",title:"Rate the probability from 1 (lowest) to 10 (highest)"},null,40,Z1),[[i.Jo,e.Probability,void 0,{number:!0}]]),a[60]||(a[60]=(0,s.Lk)("small",null,"Rate the likelihood of non-compliance from 1 (very unlikely) to 10 (very likely)",-1)),e.validationErrors&&e.validationErrors.Probability?((0,s.uX)(),(0,s.CE)("div",e2,(0,d.v_)(e.validationErrors.Probability.join(", ")),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",a2,[a[64]||(a[64]=(0,s.Lk)("div",{class:"field-group-title"},"Approval Information",-1)),(0,s.Lk)("div",t2,[(0,s.Lk)("div",i2,[a[62]||(a[62]=(0,s.Lk)("label",null,"Assign Reviewer",-1)),(0,s.bF)(c,{config:l.reviewerConfig,modelValue:e.reviewer_id,"onUpdate:modelValue":a=>e.reviewer_id=a,onChange:n.onReviewerChange},null,8,["config","modelValue","onUpdate:modelValue","onChange"]),a[63]||(a[63]=(0,s.Lk)("small",null,"Select the person responsible for reviewing and approving this compliance item",-1)),l.users.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",s2,"No reviewers available"))])])])])),[[i.aG,l.activeTab===t]])),128))]),(0,s.Lk)("div",o2,[(0,s.Lk)("button",{class:"compliance-submit-btn",onClick:a[4]||(a[4]=(...e)=>n.submitCompliance&&n.submitCompliance(...e)),disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("span",n2,"â³")):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("span",r2,"Saving...")):((0,s.uX)(),(0,s.CE)("span",c2,"Submit Compliance"))],8,l2)])])}const u2={complianceCreated(){const e="Compliance created successfully and sent for review.";pv.OQ.success(e,"Compliance Created")},complianceUpdated(){const e="Compliance updated successfully and sent for review.";pv.OQ.success(e,"Compliance Updated")},complianceCloned(){const e="Compliance  cloned successfully and sent for review.";pv.OQ.success(e,"Compliance Cloned")}};var p2={name:"CreateCompliance",components:{PopupModal:pv.wA,CustomDropdown:mt.A},data(){return{selectedFramework:"",selectedPolicy:"",selectedSubPolicy:"",frameworks:[],policies:[],subPolicies:[],users:[],categoryOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},filteredOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},businessUnitSearch:[],riskTypeSearch:[],riskCategorySearch:[],riskBusinessImpactSearch:[],activeDropdown:{index:null,field:null},complianceList:[{ComplianceTitle:"",ComplianceItemDescription:"",ComplianceType:"",Scope:"",Objective:"",BusinessUnitsCovered:"",Identifier:"",IsRisk:!1,PossibleDamage:"",mitigation:"",PotentialRiskScenarios:"",RiskType:"",RiskCategory:"",RiskBusinessImpact:"",Criticality:"Medium",MandatoryOptional:"Mandatory",ManualAutomatic:"Manual",Impact:5,Probability:5,Status:"Under Review",reviewer_id:2,CreatedByName:"2",Applicability:"",MaturityLevel:"Initial",ActiveInactive:"Active",PermanentTemporary:"Permanent",mitigationSteps:[],validationErrors:{}}],loading:!1,activeTab:0,validationRules:{textPattern:/^[a-zA-Z0-9\s.,!?\-_()[\]{}:;'"&%$#@+=\n\r\t]*$/,alphanumericPattern:/^[a-zA-Z0-9\s.\-_]*$/,identifierPattern:/^[a-zA-Z0-9\-_]*$/,maxLengths:{ComplianceTitle:145,ComplianceItemDescription:5e3,ComplianceType:100,Scope:5e3,Objective:5e3,BusinessUnitsCovered:225,Identifier:45,PossibleDamage:5e3,mitigation:5e3,PotentialRiskScenarios:5e3,RiskType:45,RiskCategory:45,RiskBusinessImpact:45,Applicability:45},minLengths:{ComplianceTitle:3,ComplianceItemDescription:10,ComplianceType:3,Scope:10,Objective:10,BusinessUnitsCovered:3,mitigation:10,PossibleDamage:10,PotentialRiskScenarios:10,RiskType:3,RiskCategory:3,RiskBusinessImpact:3},allowedChoices:{Criticality:["High","Medium","Low"],MandatoryOptional:["Mandatory","Optional"],ManualAutomatic:["Manual","Automatic"]},numericRanges:{Impact:{min:1,max:10},Probability:{min:1,max:10}}},frameworkConfig:{name:"Framework",label:"Framework",values:[],defaultValue:"Select Framework"},policyConfig:{name:"Policy",label:"Policy",values:[],defaultValue:"Select Policy"},subPolicyConfig:{name:"Sub Policy",label:"Sub Policy",values:[],defaultValue:"Select Sub Policy"},reviewerConfig:{name:"Reviewer",label:"Reviewer",values:[],defaultValue:"Select Reviewer"}}},computed:{minDate(){const e=new Date;return e.toISOString().split("T")[0]}},async created(){try{await this.loadFrameworks(),await this.loadUsers(),await this.loadCategoryOptions(),this.businessUnitSearch=[""],this.riskTypeSearch=[""],this.riskCategorySearch=[""],this.riskBusinessImpactSearch=[""],document.addEventListener("click",this.handleClickOutside)}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceCreateDenied();console.error("Error initializing CreateCompliance component:",e)}},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{sanitizeString(e){return"string"!==typeof e?String(e||""):e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"")},sanitizeStringForSubmission(e){return"string"!==typeof e?String(e||""):e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim()},validateRequiredString(e,a,t=null,i=null,s=null){const o=this.sanitizeString(e),l=o.trim(),n=[];return l&&0!==l.length||n.push(`${a} is required and cannot be empty`),i&&l.length>0&&l.length<i&&n.push(`${a} must be at least ${i} characters long`),t&&o.length>t&&n.push(`${a} must not exceed ${t} characters`),s&&o&&!s.test(o)&&n.push(`${a} contains invalid characters`),{value:o,errors:n}},validateOptionalString(e,a,t=null,i=null){const s=this.sanitizeString(e),o=[];return t&&s.length>t&&o.push(`${a} must not exceed ${t} characters`),i&&s&&!i.test(s)&&o.push(`${a} contains invalid characters`),{value:s,errors:o}},validateChoiceField(e,a,t){const i=[];return e&&""!==e?t.includes(e)||i.push(`${a} must be one of: ${t.join(", ")}`):i.push(`${a} is required`),{value:e,errors:i}},validateNumericField(e,a,t=null,i=null){const s=[],o=parseFloat(e);return isNaN(o)?s.push(`${a} must be a valid number`):(null!==t&&o<t&&s.push(`${a} must be at least ${t}`),null!==i&&o>i&&s.push(`${a} must not exceed ${i}`)),{value:o,errors:s}},validateDateField(e,a){const t=[];if(e&&""!==e){const i=/^\d{4}-\d{2}-\d{2}$/;if(i.test(e)){const i=new Date(e);if(isNaN(i.getTime()))t.push(`${a} must be a valid date`);else{const e=new Date;e.setHours(0,0,0,0),i<e&&t.push(`${a} must be a future date`)}}else t.push(`${a} must be in YYYY-MM-DD format`)}else t.push(`${a} is required`);return{value:e,errors:t}},validateComplianceField(e,a,t){const i=this.validationRules;let s={value:t,errors:[]};switch(a){case"ComplianceTitle":s=this.validateRequiredString(t,"Compliance Title",i.maxLengths.ComplianceTitle,i.minLengths.ComplianceTitle,i.textPattern);break;case"ComplianceItemDescription":s=this.validateRequiredString(t,"Compliance Description",i.maxLengths.ComplianceItemDescription,i.minLengths.ComplianceItemDescription,i.textPattern);break;case"ComplianceType":s=this.validateRequiredString(t,"Compliance Type",i.maxLengths.ComplianceType,i.minLengths.ComplianceType,i.textPattern);break;case"Scope":s=this.validateRequiredString(t,"Scope",i.maxLengths.Scope,i.minLengths.Scope,i.textPattern);break;case"Objective":s=this.validateRequiredString(t,"Objective",i.maxLengths.Objective,i.minLengths.Objective,i.textPattern);break;case"BusinessUnitsCovered":s=this.validateRequiredString(t,"Business Units Covered",i.maxLengths.BusinessUnitsCovered,i.minLengths.BusinessUnitsCovered,i.textPattern);break;case"Identifier":t&&t.trim()&&(s=this.validateOptionalString(t,"Identifier",i.maxLengths.Identifier,i.identifierPattern));break;case"PossibleDamage":s=this.validateRequiredString(t,"Possible Damage",i.maxLengths.PossibleDamage,i.minLengths.PossibleDamage,i.textPattern);break;case"PotentialRiskScenarios":s=this.validateRequiredString(t,"Potential Risk Scenarios",i.maxLengths.PotentialRiskScenarios,i.minLengths.PotentialRiskScenarios,i.textPattern);break;case"RiskType":s=this.validateRequiredString(t,"Risk Type",i.maxLengths.RiskType,i.minLengths.RiskType,i.textPattern);break;case"RiskCategory":s=this.validateRequiredString(t,"Risk Category",i.maxLengths.RiskCategory,i.minLengths.RiskCategory,i.textPattern);break;case"RiskBusinessImpact":s=this.validateRequiredString(t,"Risk Business Impact",i.maxLengths.RiskBusinessImpact,i.minLengths.RiskBusinessImpact,i.textPattern);break;case"mitigation":if(e.IsRisk){t&&e.mitigationSteps.length||s.errors.push("At least one mitigation step is required for risks");const a=e.mitigationSteps.filter(e=>{const a=e.description.trim();return!a||a.length<10});a.length>0&&s.errors.push("Each mitigation step must have at least 10 characters")}break;case"Applicability":s=this.validateOptionalString(t,"Applicability",i.maxLengths.Applicability,i.textPattern);break;case"Criticality":s=this.validateChoiceField(t,"Criticality",i.allowedChoices.Criticality);break;case"MandatoryOptional":s=this.validateChoiceField(t,"Mandatory/Optional",i.allowedChoices.MandatoryOptional);break;case"ManualAutomatic":s=this.validateChoiceField(t,"Manual/Automatic",i.allowedChoices.ManualAutomatic);break;case"Impact":s=this.validateNumericField(t,"Severity Rating",i.numericRanges.Impact.min,i.numericRanges.Impact.max);break;case"Probability":s=this.validateNumericField(t,"Probability",i.numericRanges.Probability.min,i.numericRanges.Probability.max);break}return e.validationErrors||(e.validationErrors={}),s.errors.length>0?e.validationErrors[a]=s.errors:delete e.validationErrors[a],s},onFieldChange(e,a,t){const i=this.complianceList[e];let s;"IsRisk"===a?(s=t.target.checked,i[a]=s):(s=t.target.value,i[a]=s,this.validateComplianceField(i,a,s)),this.$forceUpdate()},validateAllFields(){let e=!0;const a=[];return this.selectedFramework&&this.selectedFramework.id||(a.push("Please select a framework"),e=!1),this.selectedPolicy&&this.selectedPolicy.id||(a.push("Please select a policy"),e=!1),this.selectedSubPolicy&&this.selectedSubPolicy.id||(a.push("Please select a sub-policy"),e=!1),this.complianceList.forEach((t,i)=>{t.validationErrors={};const s=["ComplianceTitle","ComplianceItemDescription","ComplianceType","Scope","Objective","BusinessUnitsCovered","mitigation","PossibleDamage","PotentialRiskScenarios","RiskType","RiskCategory","RiskBusinessImpact","Criticality","MandatoryOptional","ManualAutomatic","Impact","Probability"];t.reviewer_id&&""!==t.reviewer_id||(t.validationErrors.reviewer_id=["Please select a reviewer"],a.push(`Please select a reviewer for item ${i+1}`),e=!1),s.forEach(s=>{const o=this.validateComplianceField(t,s,t[s]);o.errors.length>0&&(a.push(`Item ${i+1}: ${o.errors.join(", ")}`),e=!1)});const o=["Identifier","Applicability"];o.forEach(s=>{if(t[s]&&t[s].trim()){const o=this.validateComplianceField(t,s,t[s]);o.errors.length>0&&(a.push(`Item ${i+1}: ${o.errors.join(", ")}`),e=!1)}})}),{isValid:e,errors:a}},async loadFrameworks(){try{this.loading=!0;const e=await bt.fv.getComplianceFrameworks();e.data.success&&Array.isArray(e.data.frameworks)?(this.frameworks=e.data.frameworks.map(e=>({id:e.id,name:e.name})),this.frameworkConfig.values=this.frameworks.map(e=>({value:e,label:e.name}))):(console.error("Unexpected response format:",e.data),pv.OQ.error("Failed to load frameworks. Please refresh the page and try again."))}catch(e){if(console.error("Error loading frameworks:",e),e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceFrameworkDenied();pv.OQ.error("Failed to load frameworks. Please refresh the page and try again.")}finally{this.loading=!1}},async loadPolicies(e){try{this.loading=!0;const a=await bt.fv.getCompliancePolicies(e);a.data.success&&Array.isArray(a.data.policies)?(this.policies=a.data.policies.map(e=>({id:e.id,name:e.name,applicability:e.scope||""})),this.policyConfig.values=this.policies.map(e=>({value:e,label:e.name}))):(console.error("Error in response:",a.data),pv.OQ.error("Failed to load policies. Please try selecting a different framework."))}catch(a){if(console.error("Error loading policies:",a),a.response&&[401,403].includes(a.response.status))return void ht.Ay.showCompliancePolicyDenied();pv.OQ.error("Failed to load policies. Please try selecting a different framework.")}finally{this.loading=!1}},async loadSubPolicies(e){try{this.loading=!0;const a=await bt.fv.getComplianceSubPolicies(e);a.data.success&&Array.isArray(a.data.subpolicies)?(this.subPolicies=a.data.subpolicies.map(e=>({id:e.id,name:e.name})),this.subPolicyConfig.values=this.subPolicies.map(e=>({value:e,label:e.name}))):(console.error("Error in response:",a.data),pv.OQ.error("Failed to load sub-policies. Please try selecting a different policy."))}catch(a){if(console.error("Error loading sub-policies:",a),a.response&&[401,403].includes(a.response.status))return void ht.Ay.showComplianceSubpolicyDenied();pv.OQ.error("Failed to load sub-policies. Please try selecting a different policy.")}finally{this.loading=!1}},async loadUsers(){try{this.loading=!0;const e=await bt.fv.getUsers();if(console.log("Users API response:",e),!e.data.success||!Array.isArray(e.data.users))throw new Error("Invalid users data received");this.users=e.data.users.map(e=>({UserId:e.UserId,UserName:e.UserName||`User ${e.UserId}`,email:e.email||""})),this.reviewerConfig.values=this.users.map(e=>({value:e.UserId,label:`${e.UserName}${e.email?` (${e.email})`:""}`})),this.users.length>0&&this.complianceList.length>0&&(this.complianceList[0].reviewer_id=this.users[0].UserId),console.log("Loaded users:",this.users)}catch(e){console.error("Failed to load users:",e),pv.OQ.error("Failed to load reviewers. Please refresh the page and try again.")}finally{this.loading=!1}},async loadCategoryOptions(){try{this.loading=!0;const e=await bt.fv.getCategoryBusinessUnits("BusinessUnitsCovered");e.data.success&&(this.categoryOptions.BusinessUnitsCovered=e.data.data);const a=await bt.fv.getCategoryBusinessUnits("RiskType");a.data.success&&(this.categoryOptions.RiskType=a.data.data);const t=await bt.fv.getCategoryBusinessUnits("RiskCategory");t.data.success&&(this.categoryOptions.RiskCategory=t.data.data);const i=await bt.fv.getCategoryBusinessUnits("RiskBusinessImpact");i.data.success&&(this.categoryOptions.RiskBusinessImpact=i.data.data)}catch(e){console.error("Failed to load category options:",e),pv.OQ.error("Failed to load dropdown options. Some features may be limited.")}finally{this.loading=!1}},showDropdown(e,a){this.activeDropdown={index:e,field:a},this.filterOptions(e,a),event.stopPropagation()},handleClickOutside(e){const a=document.querySelectorAll(".searchable-dropdown");let t=!0;a.forEach(a=>{a.contains(e.target)&&(t=!1)}),t&&(this.activeDropdown={index:null,field:null})},filterOptions(e,a,t=""){let i=[];switch(a){case"Framework":i=this.frameworks;break;case"Policy":i=this.policies;break;case"SubPolicy":i=this.subPolicies;break;case"BusinessUnitsCovered":i=this.categoryOptions.BusinessUnitsCovered;break;case"RiskType":i=this.categoryOptions.RiskType;break;case"RiskCategory":i=this.categoryOptions.RiskCategory;break;case"RiskBusinessImpact":i=this.categoryOptions.RiskBusinessImpact;break}const s=t.toLowerCase();this.filteredOptions[a]=i.filter(e=>e.value.toLowerCase().includes(s))},selectOption(e,a,t){switch(this.complianceList[e][a]=t,a){case"Framework":this.frameworkConfig.selectedValue=t;break;case"Policy":this.policyConfig.selectedValue=t;break;case"SubPolicy":this.subPolicyConfig.selectedValue=t;break;case"BusinessUnitsCovered":this.businessUnitSearch[e]=t;break;case"RiskType":this.riskTypeSearch[e]=t;break;case"RiskCategory":this.riskCategorySearch[e]=t;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch[e]=t;break}this.activeDropdown={index:null,field:null},this.validateComplianceField(this.complianceList[e],a,t)},async addNewOption(e,a,t){if(t&&t.trim())try{this.loading=!0;const i=await bt.fv.addCategoryBusinessUnit({source:a,value:t.trim()});if(!i.data.success)throw new Error(i.data.error||"Failed to add new option");{const t=i.data.data;this.categoryOptions[a].push({id:t.id,value:t.value}),this.selectOption(e,a,t.value),pv.OQ.success(`Added new ${a} option: ${t.value}`)}}catch(i){console.error(`Failed to add new ${a} option:`,i),pv.OQ.error(`Failed to add new option: ${i.message||i}`)}finally{this.loading=!1}},addCompliance(){const e=this.selectedPolicy&&this.selectedPolicy.applicability||"";this.complianceList.push({ComplianceTitle:"",ComplianceItemDescription:"",ComplianceType:"",Scope:"",Objective:"",BusinessUnitsCovered:"",Identifier:"",IsRisk:!1,PossibleDamage:"",mitigation:"",PotentialRiskScenarios:"",RiskType:"",RiskCategory:"",RiskBusinessImpact:"",Criticality:"Medium",MandatoryOptional:"Mandatory",ManualAutomatic:"Manual",Impact:5,Probability:5,Status:"Under Review",reviewer_id:this.users.length>0?this.users[0].UserId:2,CreatedByName:this.users.length>0?this.users[0].UserName:"2",Applicability:e,MaturityLevel:"Initial",ActiveInactive:"Active",PermanentTemporary:"Permanent",mitigationSteps:[],validationErrors:{}}),this.businessUnitSearch.push(""),this.riskTypeSearch.push(""),this.riskCategorySearch.push(""),this.riskBusinessImpactSearch.push(""),this.activeTab=this.complianceList.length-1},removeCompliance(e){this.complianceList.length>1&&(e<=this.activeTab&&(e===this.complianceList.length-1&&e===this.activeTab?this.activeTab=Math.max(0,e-1):e<this.activeTab&&this.activeTab--),this.complianceList.splice(e,1),this.businessUnitSearch.splice(e,1),this.riskTypeSearch.splice(e,1),this.riskCategorySearch.splice(e,1),this.riskBusinessImpactSearch.splice(e,1),this.activeDropdown={index:null,field:null})},async submitCompliance(){try{const e=this.validateAllFields();if(!e.isValid)return void pv.OQ.error(`Validation failed: ${e.errors.join(", ")}`);this.loading=!0,console.log("Submitting compliance list:",this.complianceList);for(const a of this.complianceList){if(!this.selectedSubPolicy?.id)throw new Error("SubPolicy is required");const e={SubPolicy:this.selectedSubPolicy.id,ComplianceTitle:a.ComplianceTitle?.trim(),ComplianceItemDescription:a.ComplianceItemDescription?.trim(),ComplianceType:a.ComplianceType?.trim(),Scope:a.Scope?.trim(),Objective:a.Objective?.trim(),BusinessUnitsCovered:a.BusinessUnitsCovered?.trim(),Identifier:a.Identifier?.trim()||"",IsRisk:Boolean(a.IsRisk),PossibleDamage:a.PossibleDamage?.trim(),mitigation:a.mitigation?.trim(),PotentialRiskScenarios:a.PotentialRiskScenarios?.trim(),RiskType:a.RiskType?.trim(),RiskCategory:a.RiskCategory?.trim(),RiskBusinessImpact:a.RiskBusinessImpact?.trim(),Criticality:a.Criticality||"Medium",MandatoryOptional:a.MandatoryOptional||"Mandatory",ManualAutomatic:a.ManualAutomatic||"Manual",Impact:parseFloat(a.Impact)||5,Probability:parseFloat(a.Probability)||5,Status:"Under Review",ComplianceVersion:"1.0",reviewer:parseInt(a.reviewer_id),CreatedByName:a.CreatedByName||a.reviewer_id?.toString(),Applicability:a.Applicability?.trim(),MaturityLevel:a.MaturityLevel||"Initial",ActiveInactive:a.ActiveInactive||"Active",PermanentTemporary:a.PermanentTemporary||"Permanent",ApprovalDueDate:new Date(Date.now()+6048e5).toISOString().split("T")[0]},t=["SubPolicy","ComplianceTitle","ComplianceItemDescription","reviewer"],i=t.filter(a=>!e[a]);if(i.length>0)throw new Error(`Missing required fields: ${i.join(", ")}`);console.log("Submitting compliance data:",e);const s=await bt.fv.createCompliance(e);if(console.log("Compliance creation response:",s),console.log("Response data:",s.data),!s.data.success)throw new Error(s.data.message||"Failed to create compliance");const o={ComplianceId:e.ComplianceId,ComplianceItemDescription:e.ComplianceItemDescription,Identifier:s.data.Identifier};console.log("Popup data:",o),u2.complianceCreated(o),this.resetForm()}}catch(e){if(console.error("Error creating compliance:",e),e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceCreateDenied();this.$toast?.error(e.response?.data?.message||e.message||"Failed to create compliance items")}finally{this.loading=!1}},addStep(e){this.complianceList[e].mitigationSteps.push({stepNumber:this.complianceList[e].mitigationSteps.length+1,description:""}),this.onMitigationStepChange(e)},removeStep(e,a){this.complianceList[e].mitigationSteps.splice(a,1),this.complianceList[e].mitigationSteps.forEach((e,a)=>{e.stepNumber=a+1}),this.onMitigationStepChange(e)},onMitigationStepChange(e){const a=this.complianceList[e];let t={};a.mitigationSteps.forEach((e,a)=>{const i=e.description.trim();i&&(t[a+1]=i)}),a.mitigation=JSON.stringify(t).replace(/\\"/g,'"').replace(/\\\\/g,"\\").replace(/\\n/g,"\n").replace(/\\t/g,"\t"),this.validateComplianceField(a,"mitigation",a.mitigation)},resetForm(){this.complianceList=[{ComplianceTitle:"",ComplianceItemDescription:"",ComplianceType:"",Scope:"",Objective:"",BusinessUnitsCovered:"",Identifier:"",IsRisk:!1,PossibleDamage:"",mitigation:"",PotentialRiskScenarios:"",RiskType:"",RiskCategory:"",RiskBusinessImpact:"",Criticality:"Medium",MandatoryOptional:"Mandatory",ManualAutomatic:"Manual",Impact:5,Probability:5,Status:"Under Review",reviewer_id:this.users.length>0?this.users[0].UserId:2,CreatedByName:this.users.length>0?this.users[0].UserName:"2",Applicability:"",MaturityLevel:"Initial",ActiveInactive:"Active",PermanentTemporary:"Permanent",mitigationSteps:[],validationErrors:{}}],this.selectedFramework="",this.selectedPolicy="",this.selectedSubPolicy="",this.policies=[],this.subPolicies=[],this.businessUnitSearch=[""],this.riskTypeSearch=[""],this.riskCategorySearch=[""],this.riskBusinessImpactSearch=[""],this.activeTab=0,this.error=null,this.loading=!1},onFrameworkChange(e){this.selectedFramework=e.value,e.value&&e.value.id&&(this.loadPolicies(e.value.id),this.selectedPolicy="",this.selectedSubPolicy="",this.policies=[],this.subPolicies=[])},onPolicyChange(e){this.selectedPolicy=e.value,e.value&&e.value.id&&(this.loadSubPolicies(e.value.id),this.selectedSubPolicy="",this.subPolicies=[],e.value.applicability&&this.complianceList.forEach(a=>{a.Applicability=e.value.applicability}))},onSubPolicyChange(e){this.selectedSubPolicy=e.value,e.value&&e.value.applicability&&this.complianceList.forEach(a=>{a.Applicability=e.value.applicability})},onReviewerChange(e){console.log("Reviewer changed to:",e.value)}}};const v2=(0,se.A)(p2,[["render",d2],["__scopeId","data-v-7d89f63f"]]);var m2=v2;const k2={class:"create-compliance-container"},h2={class:"compliance-header"},g2={class:"header-content"},y2={key:0,class:"message error-message"},f2={key:1,class:"message success-message"},b2={key:2,class:"loading-overlay"},C2={key:3,class:"compliance-item-form"},L2={class:"field-group"},w2={class:"row-fields"},E2={class:"compliance-field"},R2={class:"input-wrapper"},D2={key:0,class:"validation-indicator"},I2={key:0,class:"valid-icon"},P2={key:1,class:"invalid-icon"},_2={key:0,class:"field-error-message"},S2={class:"compliance-field"},A2={class:"input-wrapper"},T2={key:0,class:"validation-indicator"},x2={key:0,class:"valid-icon"},F2={key:1,class:"invalid-icon"},V2={key:0,class:"field-error-message"},M2={class:"compliance-field full-width"},X2={class:"input-wrapper"},U2={key:0,class:"field-error-message"},N2={key:0,class:"validation-feedback"},$2={class:"validation-progress"},O2={class:"compliance-field full-width"},j2={class:"input-wrapper"},B2={key:0,class:"field-error-message"},W2={key:0,class:"validation-feedback"},Q2={class:"validation-progress"},q2={class:"compliance-field full-width"},K2={class:"input-wrapper"},J2={key:0,class:"field-error-message"},z2={key:0,class:"validation-feedback"},H2={class:"validation-progress"},Y2={class:"row-fields"},G2={class:"compliance-field"},Z2={class:"searchable-dropdown"},e3={class:"dropdown-options"},a3={key:0,class:"dropdown-add-option"},t3=["onClick"],i3={key:0,class:"field-error-message"},s3={class:"compliance-field"},o3={key:0,class:"field-error-message"},l3={class:"compliance-field checkbox-container"},n3={style:{"font-weight":"500","font-size":"1rem",display:"flex","align-items":"center",gap:"8px"},title:"Check if this compliance item represents a risk"},r3={key:0,class:"field-group risk-fields"},c3={class:"compliance-field full-width"},d3={class:"input-wrapper"},u3=["required"],p3={key:0,class:"field-error-message"},v3={class:"compliance-field full-width"},m3={key:0,class:"required"},k3={class:"mitigation-steps"},h3={class:"step-header"},g3={class:"step-numberr"},y3=["onClick"],f3=["onUpdate:modelValue"],b3={key:0,class:"error-message"},C3={class:"compliance-field full-width"},L3={class:"input-wrapper"},w3={class:"char-count"},E3={key:0,class:"field-error-message"},R3={class:"row-fields"},D3={class:"compliance-field"},I3={class:"input-wrapper"},P3={key:0,class:"validation-indicator"},_3={key:0,class:"valid-icon"},S3={key:1,class:"invalid-icon"},A3={key:0,class:"field-error-message"},T3={class:"compliance-field"},x3={class:"input-wrapper"},F3={class:"searchable-dropdown"},V3={key:0,class:"validation-indicator"},M3={key:0,class:"valid-icon"},X3={key:1,class:"invalid-icon"},U3={key:0,class:"field-error-message"},N3={class:"compliance-field"},$3={class:"input-wrapper"},O3={class:"searchable-dropdown"},j3={key:0,class:"validation-indicator"},B3={key:0,class:"valid-icon"},W3={key:1,class:"invalid-icon"},Q3={key:0,class:"field-error-message"},q3={class:"field-group classification-fields"},K3={class:"row-fields"},J3={class:"compliance-field"},z3={class:"input-wrapper"},H3={key:0,class:"validation-indicator"},Y3={key:0,class:"valid-icon"},G3={key:1,class:"invalid-icon"},Z3={key:0,class:"field-error-message"},e4={class:"compliance-field"},a4={key:0,class:"field-error-message"},t4={class:"row-fields"},i4={class:"compliance-field"},s4={key:0,class:"field-error-message"},o4={class:"compliance-field"},l4={key:0,class:"field-error-message"},n4={class:"row-fields"},r4={class:"compliance-field"},c4={key:0,class:"field-error-message"},d4={class:"compliance-field"},u4={key:0,class:"field-error-message"},p4={class:"row-fields"},v4={class:"compliance-field"},m4={key:0,class:"field-error-message"},k4={class:"compliance-field"},h4={key:0,class:"field-error-message"},g4={class:"field-group approval-fields"},y4={class:"row-fields"},f4={class:"compliance-field"},b4=["value"],C4={key:0,class:"field-error-message"},L4={class:"compliance-submit-container"},w4=["disabled"],E4={key:0},R4={key:1},D4=["disabled"];function I4(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",k2,[(0,s.Lk)("div",h2,[(0,s.Lk)("div",g2,[a[58]||(a[58]=(0,s.Lk)("div",{class:"header-text"},[(0,s.Lk)("h2",null,"Edit Compliance Record"),(0,s.Lk)("p",null,"Update compliance item details")],-1)),(0,s.Lk)("button",{class:"back-button",onClick:a[0]||(a[0]=(...e)=>n.goBack&&n.goBack(...e)),title:"Go back to previous page"},a[57]||(a[57]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])]),l.error?((0,s.uX)(),(0,s.CE)("div",y2,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),l.successMessage?((0,s.uX)(),(0,s.CE)("div",f2,(0,d.v_)(l.successMessage),1)):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("div",b2,a[59]||(a[59]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("div",{class:"loading-text"},"Loading data...",-1)]))):(0,s.Q3)("",!0),l.compliance?((0,s.uX)(),(0,s.CE)("div",C2,[(0,s.Lk)("div",L2,[a[69]||(a[69]=(0,s.Lk)("div",{class:"field-group-title"},"Basic Information",-1)),(0,s.Lk)("div",w2,[(0,s.Lk)("div",E2,[a[60]||(a[60]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Title "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(3-145 characters)")],-1)),(0,s.Lk)("div",R2,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>l.compliance.ComplianceTitle=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceTitle,warning:n.showWarning("ComplianceTitle"),valid:n.isFieldValid("ComplianceTitle")}]),placeholder:"Enter compliance title",required:"",onInput:a[2]||(a[2]=e=>n.validateFieldRealTime("ComplianceTitle")),onBlur:a[3]||(a[3]=e=>n.validateField("ComplianceTitle")),title:"Enter the title of the compliance item",ref:"field_ComplianceTitle"},null,34),[[i.Jo,l.compliance.ComplianceTitle]]),l.compliance.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",D2,[n.isFieldValid("ComplianceTitle")?((0,s.uX)(),(0,s.CE)("span",I2,"âœ“")):((0,s.uX)(),(0,s.CE)("span",P2,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",_2,(0,d.v_)(l.validationErrors.ComplianceTitle),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",S2,[a[61]||(a[61]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Type "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Required)")],-1)),(0,s.Lk)("div",A2,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>l.compliance.ComplianceType=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceType,valid:n.isFieldValid("ComplianceType")}]),placeholder:"Enter compliance type",onInput:a[5]||(a[5]=e=>n.validateFieldRealTime("ComplianceType")),onBlur:a[6]||(a[6]=e=>n.validateField("ComplianceType")),title:"Type of compliance (e.g. Regulatory, Internal, Security)",ref:"field_ComplianceType"},null,34),[[i.Jo,l.compliance.ComplianceType]]),l.compliance.ComplianceType?((0,s.uX)(),(0,s.CE)("div",T2,[n.isFieldValid("ComplianceType")?((0,s.uX)(),(0,s.CE)("span",x2,"âœ“")):((0,s.uX)(),(0,s.CE)("span",F2,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.ComplianceType?((0,s.uX)(),(0,s.CE)("div",V2,(0,d.v_)(l.validationErrors.ComplianceType),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",M2,[a[62]||(a[62]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Description "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 10 characters)")],-1)),(0,s.Lk)("div",X2,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>l.compliance.ComplianceItemDescription=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceItemDescription,warning:n.showWarning("ComplianceItemDescription"),valid:n.isFieldValid("ComplianceItemDescription")}]),placeholder:"Compliance Description",onInput:a[8]||(a[8]=e=>n.validateFieldRealTime("ComplianceItemDescription")),onBlur:a[9]||(a[9]=e=>n.validateField("ComplianceItemDescription")),required:"",rows:"3",title:"Detailed description of the compliance requirement",ref:"field_ComplianceItemDescription"},null,34),[[i.Jo,l.compliance.ComplianceItemDescription]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.ComplianceItemDescription}])},(0,d.v_)(l.compliance.ComplianceItemDescription?.length||0)+"/10 min characters ",3),l.validationErrors.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",U2,(0,d.v_)(l.validationErrors.ComplianceItemDescription),1)):(0,s.Q3)("",!0)]),l.compliance.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",N2,[(0,s.Lk)("div",$2,[(0,s.Lk)("div",{class:"progress-bar",style:(0,d.Tr)({width:n.getValidationProgress("ComplianceItemDescription")+"%",backgroundColor:n.getValidationColor("ComplianceItemDescription")})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["validation-message",{warning:n.showWarning("ComplianceItemDescription"),error:l.validationErrors.ComplianceItemDescription,success:n.isFieldValid("ComplianceItemDescription")}])},(0,d.v_)(n.getValidationMessage("ComplianceItemDescription")),3)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",O2,[a[63]||(a[63]=(0,s.Lk)("label",null,[(0,s.eW)(" Scope "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.Lk)("div",j2,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[10]||(a[10]=e=>l.compliance.Scope=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Scope,warning:n.showWarning("Scope"),valid:n.isFieldValid("Scope")}]),placeholder:"Define the scope of this compliance requirement",onInput:a[11]||(a[11]=e=>n.validateFieldRealTime("Scope")),onBlur:a[12]||(a[12]=e=>n.validateField("Scope")),rows:"3","data-field":"Scope",required:"",ref:"field_Scope"},null,34),[[i.Jo,l.compliance.Scope]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Scope,warning:n.showWarning("Scope")}])},(0,d.v_)(l.compliance.Scope?.length||0)+"/15 min characters ",3),l.validationErrors.Scope?((0,s.uX)(),(0,s.CE)("div",B2,(0,d.v_)(l.validationErrors.Scope),1)):(0,s.Q3)("",!0)]),l.compliance.Scope?((0,s.uX)(),(0,s.CE)("div",W2,[(0,s.Lk)("div",Q2,[(0,s.Lk)("div",{class:"progress-bar",style:(0,d.Tr)({width:n.getValidationProgress("Scope")+"%",backgroundColor:n.getValidationColor("Scope")})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["validation-message",{warning:n.showWarning("Scope"),error:l.validationErrors.Scope,success:n.isFieldValid("Scope")}])},(0,d.v_)(n.getValidationMessage("Scope")),3)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",q2,[a[64]||(a[64]=(0,s.Lk)("label",null,[(0,s.eW)(" Objective "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.Lk)("div",K2,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[13]||(a[13]=e=>l.compliance.Objective=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Objective,warning:n.showWarning("Objective"),valid:n.isFieldValid("Objective")}]),placeholder:"Define the objective of this compliance requirement",onInput:a[14]||(a[14]=e=>n.validateFieldRealTime("Objective")),onBlur:a[15]||(a[15]=e=>n.validateField("Objective")),rows:"3","data-field":"Objective",required:"",ref:"field_Objective"},null,34),[[i.Jo,l.compliance.Objective]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Objective,warning:n.showWarning("Objective")}])},(0,d.v_)(l.compliance.Objective?.length||0)+"/15 min characters ",3),l.validationErrors.Objective?((0,s.uX)(),(0,s.CE)("div",J2,(0,d.v_)(l.validationErrors.Objective),1)):(0,s.Q3)("",!0)]),l.compliance.Objective?((0,s.uX)(),(0,s.CE)("div",z2,[(0,s.Lk)("div",H2,[(0,s.Lk)("div",{class:"progress-bar",style:(0,d.Tr)({width:n.getValidationProgress("Objective")+"%",backgroundColor:n.getValidationColor("Objective")})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["validation-message",{warning:n.showWarning("Objective"),error:l.validationErrors.Objective,success:n.isFieldValid("Objective")}])},(0,d.v_)(n.getValidationMessage("Objective")),3)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Y2,[(0,s.Lk)("div",G2,[a[66]||(a[66]=(0,s.Lk)("label",null,"Business Units Covered",-1)),(0,s.Lk)("div",Z2,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[16]||(a[16]=e=>l.businessUnitSearch=e),class:"compliance-input",placeholder:"Search or add business units",title:"Departments or business units affected by this compliance",onFocus:a[17]||(a[17]=e=>n.showDropdown("BusinessUnitsCovered")),onInput:a[18]||(a[18]=e=>n.filterOptions("BusinessUnitsCovered")),ref:"field_BusinessUnitsCovered"},null,544),[[i.Jo,l.businessUnitSearch]]),(0,s.bo)((0,s.Lk)("div",e3,[0===l.filteredOptions.BusinessUnitsCovered.length&&l.businessUnitSearch?((0,s.uX)(),(0,s.CE)("div",a3,[a[65]||(a[65]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:a[19]||(a[19]=e=>n.addNewOption("BusinessUnitsCovered",l.businessUnitSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.businessUnitSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.BusinessUnitsCovered,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption("BusinessUnitsCovered",e.value)},(0,d.v_)(e.value),9,t3))),128))],512),[[i.aG,"BusinessUnitsCovered"===l.activeDropdown]])]),l.validationErrors.BusinessUnitsCovered?((0,s.uX)(),(0,s.CE)("div",i3,(0,d.v_)(l.validationErrors.BusinessUnitsCovered),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",s3,[a[67]||(a[67]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[20]||(a[20]=e=>l.compliance.Identifier=e),class:"compliance-input",placeholder:"Auto-generated if left empty",title:"Unique identifier for this compliance item",disabled:"",ref:"field_Identifier"},null,512),[[i.Jo,l.compliance.Identifier]]),l.validationErrors.Identifier?((0,s.uX)(),(0,s.CE)("div",o3,(0,d.v_)(l.validationErrors.Identifier),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",l3,[(0,s.Lk)("label",n3,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[21]||(a[21]=e=>l.compliance.IsRisk=e),style:{"margin-right":"8px",width:"auto"}},null,512),[[i.lH,l.compliance.IsRisk]]),a[68]||(a[68]=(0,s.eW)(" Is Risk "))])])])]),l.compliance.IsRisk?((0,s.uX)(),(0,s.CE)("div",r3,[a[79]||(a[79]=(0,s.Lk)("div",{class:"field-group-title"},"Risk Information",-1)),(0,s.Lk)("div",c3,[a[70]||(a[70]=(0,s.Lk)("label",null,[(0,s.eW)(" Possible Damage "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 10 characters)")],-1)),(0,s.Lk)("div",d3,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[22]||(a[22]=e=>l.compliance.PossibleDamage=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.PossibleDamage,warning:n.showWarning("PossibleDamage"),valid:n.isFieldValid("PossibleDamage")}]),placeholder:"Describe possible damage",onInput:a[23]||(a[23]=e=>n.validateFieldRealTime("PossibleDamage")),onBlur:a[24]||(a[24]=e=>n.validateField("PossibleDamage")),rows:"3",required:l.compliance.IsRisk,ref:"field_PossibleDamage"},null,42,u3),[[i.Jo,l.compliance.PossibleDamage]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.PossibleDamage}])},(0,d.v_)(l.compliance.PossibleDamage?.length||0)+"/10 min characters ",3),l.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",p3,(0,d.v_)(l.validationErrors.PossibleDamage),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",v3,[(0,s.Lk)("label",null,[a[71]||(a[71]=(0,s.eW)(" Mitigation Steps ")),l.compliance.IsRisk?((0,s.uX)(),(0,s.CE)("span",m3,"*")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",k3,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"mitigation-step"},[(0,s.Lk)("div",h3,[(0,s.Lk)("span",g3,"Step "+(0,d.v_)(t+1),1),(0,s.Lk)("button",{type:"button",class:"remove-step-btn",onClick:e=>n.removeStep(t),title:"Remove this step"},a[72]||(a[72]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,y3)]),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.description=a,onInput:a[25]||(a[25]=(...e)=>n.onMitigationStepChange&&n.onMitigationStepChange(...e)),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.mitigation,valid:n.isFieldValid("mitigation")}]),placeholder:"Describe this mitigation step",rows:"2",required:""},null,42,f3),[[i.Jo,e.description]])]))),128)),(0,s.Lk)("button",{type:"button",class:"add-step-btn",onClick:a[26]||(a[26]=(...e)=>n.addStep&&n.addStep(...e)),title:"Add new mitigation step"},a[73]||(a[73]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Step ")]))]),l.validationErrors.mitigation?((0,s.uX)(),(0,s.CE)("div",b3,(0,d.v_)(l.validationErrors.mitigation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",C3,[a[74]||(a[74]=(0,s.Lk)("label",null,[(0,s.eW)(" Potential Risk Scenarios "),(0,s.Lk)("span",{class:"field-requirements"},"(Recommended: 20+ characters)")],-1)),(0,s.Lk)("div",L3,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[27]||(a[27]=e=>l.compliance.PotentialRiskScenarios=e),class:(0,d.C4)(["compliance-input",{warning:n.showWarning("PotentialRiskScenarios"),valid:n.isFieldValid("PotentialRiskScenarios")}]),placeholder:"Describe potential risk scenarios",onInput:a[28]||(a[28]=e=>n.validateFieldRealTime("PotentialRiskScenarios")),onBlur:a[29]||(a[29]=e=>n.validateField("PotentialRiskScenarios")),rows:"3",ref:"field_PotentialRiskScenarios"},null,34),[[i.Jo,l.compliance.PotentialRiskScenarios]]),(0,s.Lk)("div",w3,(0,d.v_)(l.compliance.PotentialRiskScenarios?.length||0)+" characters ",1),l.validationErrors.PotentialRiskScenarios?((0,s.uX)(),(0,s.CE)("div",E3,(0,d.v_)(l.validationErrors.PotentialRiskScenarios),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",R3,[(0,s.Lk)("div",D3,[a[76]||(a[76]=(0,s.Lk)("label",null,[(0,s.eW)(" Risk Type "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",I3,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[30]||(a[30]=e=>l.compliance.RiskType=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.RiskType,valid:n.isFieldValid("RiskType")}]),onChange:a[31]||(a[31]=e=>n.validateFieldRealTime("RiskType")),onBlur:a[32]||(a[32]=e=>n.validateField("RiskType")),ref:"field_RiskType"},a[75]||(a[75]=[(0,s.Fv)('<option value="" data-v-de09638c>Select Risk Type</option><option value="Current" data-v-de09638c>Current</option><option value="Residual" data-v-de09638c>Residual</option><option value="Inherent" data-v-de09638c>Inherent</option><option value="Emerging" data-v-de09638c>Emerging</option><option value="Accepted" data-v-de09638c>Accepted</option>',6)]),34),[[i.u1,l.compliance.RiskType]]),l.compliance.RiskType?((0,s.uX)(),(0,s.CE)("div",P3,[n.isFieldValid("RiskType")?((0,s.uX)(),(0,s.CE)("span",_3,"âœ“")):((0,s.uX)(),(0,s.CE)("span",S3,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("div",A3,(0,d.v_)(l.validationErrors.RiskType),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",T3,[a[77]||(a[77]=(0,s.Lk)("label",null,[(0,s.eW)(" Risk Category "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",x3,[(0,s.Lk)("div",F3,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[33]||(a[33]=e=>l.riskCategorySearch=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.RiskCategory,valid:n.isFieldValid("RiskCategory")}]),placeholder:"Search or add risk category",onInput:a[34]||(a[34]=e=>n.validateFieldRealTime("RiskCategory")),onBlur:a[35]||(a[35]=e=>n.validateField("RiskCategory")),ref:"field_RiskCategory"},null,34),[[i.Jo,l.riskCategorySearch]]),l.compliance.RiskCategory?((0,s.uX)(),(0,s.CE)("div",V3,[n.isFieldValid("RiskCategory")?((0,s.uX)(),(0,s.CE)("span",M3,"âœ“")):((0,s.uX)(),(0,s.CE)("span",X3,"!"))])):(0,s.Q3)("",!0)])]),l.validationErrors.RiskCategory?((0,s.uX)(),(0,s.CE)("div",U3,(0,d.v_)(l.validationErrors.RiskCategory),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",N3,[a[78]||(a[78]=(0,s.Lk)("label",null,[(0,s.eW)(" Risk Business Impact "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",$3,[(0,s.Lk)("div",O3,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[36]||(a[36]=e=>l.riskBusinessImpactSearch=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.RiskBusinessImpact,valid:n.isFieldValid("RiskBusinessImpact")}]),placeholder:"Search or add business impact",onInput:a[37]||(a[37]=e=>n.validateFieldRealTime("RiskBusinessImpact")),onBlur:a[38]||(a[38]=e=>n.validateField("RiskBusinessImpact")),ref:"field_RiskBusinessImpact"},null,34),[[i.Jo,l.riskBusinessImpactSearch]]),l.compliance.RiskBusinessImpact?((0,s.uX)(),(0,s.CE)("div",j3,[n.isFieldValid("RiskBusinessImpact")?((0,s.uX)(),(0,s.CE)("span",B3,"âœ“")):((0,s.uX)(),(0,s.CE)("span",W3,"!"))])):(0,s.Q3)("",!0)])]),l.validationErrors.RiskBusinessImpact?((0,s.uX)(),(0,s.CE)("div",Q3,(0,d.v_)(l.validationErrors.RiskBusinessImpact),1)):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",q3,[a[93]||(a[93]=(0,s.Lk)("div",{class:"field-group-title"},"Classification",-1)),(0,s.Lk)("div",K3,[(0,s.Lk)("div",J3,[a[81]||(a[81]=(0,s.Lk)("label",null,[(0,s.eW)(" Criticality "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",z3,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[39]||(a[39]=e=>l.compliance.Criticality=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.Criticality,valid:n.isFieldValid("Criticality")}]),onChange:a[40]||(a[40]=e=>n.validateFieldRealTime("Criticality")),onBlur:a[41]||(a[41]=e=>n.validateField("Criticality")),required:"",ref:"field_Criticality"},a[80]||(a[80]=[(0,s.Lk)("option",{value:""},"Select Criticality",-1),(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),34),[[i.u1,l.compliance.Criticality]]),l.compliance.Criticality?((0,s.uX)(),(0,s.CE)("div",H3,[n.isFieldValid("Criticality")?((0,s.uX)(),(0,s.CE)("span",Y3,"âœ“")):((0,s.uX)(),(0,s.CE)("span",G3,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("div",Z3,(0,d.v_)(l.validationErrors.Criticality),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",e4,[a[83]||(a[83]=(0,s.Lk)("label",null," Mandatory/Optional ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[42]||(a[42]=e=>l.compliance.MandatoryOptional=e),class:"compliance-select",required:"",title:"Whether this compliance item is mandatory or optional",ref:"field_MandatoryOptional"},a[82]||(a[82]=[(0,s.Lk)("option",{value:"Mandatory"},"Mandatory",-1),(0,s.Lk)("option",{value:"Optional"},"Optional",-1)]),512),[[i.u1,l.compliance.MandatoryOptional]]),l.validationErrors.MandatoryOptional?((0,s.uX)(),(0,s.CE)("div",a4,(0,d.v_)(l.validationErrors.MandatoryOptional),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",t4,[(0,s.Lk)("div",i4,[a[85]||(a[85]=(0,s.Lk)("label",null," Manual/Automatic ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[43]||(a[43]=e=>l.compliance.ManualAutomatic=e),class:"compliance-select",required:"",title:"Whether this compliance is checked manually or automatically",ref:"field_ManualAutomatic"},a[84]||(a[84]=[(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Automatic"},"Automatic",-1)]),512),[[i.u1,l.compliance.ManualAutomatic]]),l.validationErrors.ManualAutomatic?((0,s.uX)(),(0,s.CE)("div",s4,(0,d.v_)(l.validationErrors.ManualAutomatic),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",o4,[a[86]||(a[86]=(0,s.Lk)("label",null," Applicability ",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[44]||(a[44]=e=>l.compliance.Applicability=e),class:"compliance-input",placeholder:"Applicability from policy",title:"Describes where this compliance item applies",ref:"field_Applicability"},null,512),[[i.Jo,l.compliance.Applicability]]),l.validationErrors.Applicability?((0,s.uX)(),(0,s.CE)("div",l4,(0,d.v_)(l.validationErrors.Applicability),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",n4,[(0,s.Lk)("div",r4,[a[87]||(a[87]=(0,s.Lk)("label",null,[(0,s.eW)(" Impact "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(0-10)")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[45]||(a[45]=e=>l.compliance.Impact=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Impact}]),step:"0.1",min:"0",max:"10",onInput:a[46]||(a[46]=e=>n.validateFieldRealTime("Impact")),onBlur:a[47]||(a[47]=e=>n.validateField("Impact")),required:"",ref:"field_Impact"},null,34),[[i.Jo,l.compliance.Impact]]),l.validationErrors.Impact?((0,s.uX)(),(0,s.CE)("div",c4,(0,d.v_)(l.validationErrors.Impact),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",d4,[a[88]||(a[88]=(0,s.Lk)("label",null,[(0,s.eW)(" Probability "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(0-10)")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[48]||(a[48]=e=>l.compliance.Probability=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Probability}]),step:"0.1",min:"0",max:"10",onInput:a[49]||(a[49]=e=>n.validateFieldRealTime("Probability")),onBlur:a[50]||(a[50]=e=>n.validateField("Probability")),required:"",ref:"field_Probability"},null,34),[[i.Jo,l.compliance.Probability]]),l.validationErrors.Probability?((0,s.uX)(),(0,s.CE)("div",u4,(0,d.v_)(l.validationErrors.Probability),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",p4,[(0,s.Lk)("div",v4,[a[90]||(a[90]=(0,s.Lk)("label",null," Maturity Level ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[51]||(a[51]=e=>l.compliance.MaturityLevel=e),class:"compliance-select",title:"Current maturity level of this compliance item",ref:"field_MaturityLevel"},a[89]||(a[89]=[(0,s.Lk)("option",null,"Initial",-1),(0,s.Lk)("option",null,"Developing",-1),(0,s.Lk)("option",null,"Defined",-1),(0,s.Lk)("option",null,"Managed",-1),(0,s.Lk)("option",null,"Optimizing",-1)]),512),[[i.u1,l.compliance.MaturityLevel]]),l.validationErrors.MaturityLevel?((0,s.uX)(),(0,s.CE)("div",m4,(0,d.v_)(l.validationErrors.MaturityLevel),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",k4,[a[92]||(a[92]=(0,s.Lk)("label",null," Version Type ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[52]||(a[52]=e=>l.compliance.versionType=e),class:"compliance-select",required:"",title:"Type of version change",ref:"field_versionType"},a[91]||(a[91]=[(0,s.Lk)("option",{value:"Major"},"Major",-1),(0,s.Lk)("option",{value:"Minor"},"Minor",-1)]),512),[[i.u1,l.compliance.versionType]]),l.validationErrors.versionType?((0,s.uX)(),(0,s.CE)("div",h4,(0,d.v_)(l.validationErrors.versionType),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",g4,[a[96]||(a[96]=(0,s.Lk)("div",{class:"field-group-title"},"Approval Information",-1)),(0,s.Lk)("div",y4,[(0,s.Lk)("div",f4,[a[95]||(a[95]=(0,s.Lk)("label",null,[(0,s.eW)("Assign Reviewer "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[53]||(a[53]=e=>l.compliance.reviewer_id=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.reviewer_id}]),onChange:a[54]||(a[54]=e=>n.validateField("reviewer_id")),required:"",title:"Person responsible for reviewing this compliance item",ref:"field_reviewer_id"},[a[94]||(a[94]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName)+" "+(0,d.v_)(e.email?`(${e.email})`:""),9,b4))),128))],34),[[i.u1,l.compliance.reviewer_id]]),l.validationErrors.reviewer_id?((0,s.uX)(),(0,s.CE)("div",C4,(0,d.v_)(l.validationErrors.reviewer_id),1)):(0,s.Q3)("",!0)])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",L4,[(0,s.Lk)("button",{class:"compliance-submit-btn",onClick:a[55]||(a[55]=(...e)=>n.validateAndSubmit&&n.validateAndSubmit(...e)),disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("span",E4,"Saving...")):((0,s.uX)(),(0,s.CE)("span",R4,"Save as New Version"))],8,w4),(0,s.Lk)("button",{class:"compliance-cancel-btn",onClick:a[56]||(a[56]=(...e)=>n.cancelEdit&&n.cancelEdit(...e)),disabled:l.loading}," Cancel ",8,D4)])])}var P4={name:"EditCompliance",data(){return{compliance:null,users:[],loading:!1,error:null,successMessage:null,impactError:!1,probabilityError:!1,originalComplianceId:null,categoryOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},filteredOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},businessUnitSearch:"",riskTypeSearch:"",riskCategorySearch:"",riskBusinessImpactSearch:"",activeDropdown:null,validationErrors:{},validationRules:{ComplianceTitle:[{required:!0,message:"Compliance Title is required"},{minLength:3,message:"Title must be at least 3 characters"},{maxLength:145,message:"Title cannot exceed 145 characters"}],ComplianceType:[{required:!0,message:"Compliance Type is required"}],ComplianceItemDescription:[{required:!0,message:"Description is required"},{minLength:10,message:"Description must be at least 10 characters"}],Scope:[{required:!0,message:"Scope is required"},{minLength:15,message:"Scope must be at least 15 characters"}],Objective:[{required:!0,message:"Objective is required"},{minLength:15,message:"Objective must be at least 15 characters"}],BusinessUnitsCovered:[{required:!0,message:"Business Units Covered is required"}],Criticality:[{required:!0,message:"Criticality is required"}],Impact:[{required:!0,message:"Impact is required"},{min:0,max:10,message:"Impact must be between 0 and 10"}],Probability:[{required:!0,message:"Probability is required"},{min:0,max:10,message:"Probability must be between 0 and 10"}],reviewer_id:[{required:!0,message:"Reviewer is required"}],PossibleDamage:[{required:!0,message:"Possible Damage is required for risks"},{minLength:10,message:"Possible Damage must be at least 10 characters"}],RiskType:[{required:!0,message:"Risk Type is required for risks"}],RiskCategory:[{required:!0,message:"Risk Category is required for risks"}],RiskBusinessImpact:[{required:!0,message:"Risk Business Impact is required for risks"}],mitigation:[{required:!0,message:"At least one mitigation step is required for risks",validate:e=>!!e&&("object"===typeof e?Object.values(e).some(e=>e&&e.trim().length>0):e.trim().length>0)}]},fieldStates:{},mitigationSteps:[{description:""}]}},async created(){const e=this.$route.params.id;e?(this.originalComplianceId=e,await this.loadUsers(),await this.loadComplianceData(e),await this.loadCategoryOptions(),document.addEventListener("click",this.handleClickOutside)):this.error="No compliance ID provided"},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{async loadComplianceData(e){try{this.loading=!0;const a=await bt.fv.getComplianceById(e);a.data&&a.data.success?(this.compliance={...a.data.data,versionType:"minor"},!this.compliance.reviewer_id&&this.users.length>0&&(this.compliance.reviewer_id=this.users[0].UserId),this.businessUnitSearch=this.compliance.BusinessUnitsCovered||"",this.riskTypeSearch=this.compliance.RiskType||"",this.riskCategorySearch=this.compliance.RiskCategory||"",this.riskBusinessImpactSearch=this.compliance.RiskBusinessImpact||"",this.mitigationSteps=this.parseMitigationSteps(this.compliance.mitigation)):this.error="Failed to load compliance data"}catch(a){if(a.response&&[401,403].includes(a.response.status))return void ht.Ay.showEditComplianceDenied();console.error("Error loading compliance:",a),this.error="Failed to load compliance data. Please try again."}finally{this.loading=!1}},async loadUsers(){try{this.loading=!0;const e=await bt.fv.getUsers();e.data.success&&Array.isArray(e.data.users)?this.users=e.data.users:(console.error("Invalid users data received:",e.data),this.error="Failed to load approvers")}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showEditComplianceDenied();console.error("Failed to load users:",e),this.error="Failed to load approvers. Please try again."}finally{this.loading=!1}},validateImpact(e){const a=parseFloat(e.target.value);this.impactError=a<1||a>10},validateProbability(e){const a=parseFloat(e.target.value);this.probabilityError=a<1||a>10},getDefaultDueDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},validateField(e){const a=this.compliance[e],t=this.validationRules[e];if(this.validationErrors[e]="",!t.find(e=>e.required)&&!a)return!0;if("PossibleDamage"===e&&!this.compliance.IsRisk)return!0;for(const i of t){if(i.required&&(!a||""===a.toString().trim()))return this.validationErrors[e]=i.message,!1;if(i.minLength&&a&&a.length<i.minLength)return this.validationErrors[e]=i.message,!1;if(i.maxLength&&a&&a.length>i.maxLength)return this.validationErrors[e]=i.message,!1;if((void 0!==i.min||void 0!==i.max)&&a){const t=parseFloat(a);if(isNaN(t)||t<i.min||t>i.max)return this.validationErrors[e]=i.message,!1}}return!0},validateAllFields(){let e=!0,a=null;for(const t in this.validationRules)!this.compliance.IsRisk&&["PossibleDamage","RiskType","RiskCategory","RiskBusinessImpact","mitigation","PotentialRiskScenarios"].includes(t)||this.validateField(t)||(e=!1,a||(a=t));if(a){const e=document.querySelector(`[data-field="${a}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}return e},async submitEdit(){if(this.error=null,this.successMessage=null,this.validateAllFields())try{this.loading=!0;const e=parseFloat(this.compliance.ComplianceVersion)||1;let a;if("Major"===this.compliance.versionType)a=Math.floor(e)+1+".0";else{const[t,i]=e.toString().split(".");a=`${t}.${(parseInt(i)||0)+1}`}const t={...this.compliance,ComplianceVersion:a,Status:"Under Review",ActiveInactive:"Active",PreviousComplianceVersionId:this.originalComplianceId},i=await bt.fv.updateCompliance(this.originalComplianceId,t);i.data&&i.data.success?(u2.complianceUpdated({ComplianceId:i.data.compliance_id||this.originalComplianceId,ComplianceVersion:a,ComplianceItemDescription:this.compliance.ComplianceItemDescription}),setTimeout(()=>{this.$router.push("/compliance/tailoring")},1500)):this.error=i.data.message||"Failed to update compliance"}catch(e){console.error("Error updating compliance:",e),this.error="Failed to update compliance. Please try again."}finally{this.loading=!1}else this.error="Please fill in all required fields with valid information"},goBack(){this.$router.go(-1)},cancelEdit(){confirm("Are you sure you want to cancel editing? Any unsaved changes will be lost.")&&this.$router.push("/compliance/tailoring")},async loadCategoryOptions(){try{this.loading=!0;const e=await bt.fv.getCategoryBusinessUnits("BusinessUnitsCovered");e.data.success&&(this.categoryOptions.BusinessUnitsCovered=e.data.data);const a=await bt.fv.getCategoryBusinessUnits("RiskType");a.data.success&&(this.categoryOptions.RiskType=a.data.data);const t=await bt.fv.getCategoryBusinessUnits("RiskCategory");t.data.success&&(this.categoryOptions.RiskCategory=t.data.data);const i=await bt.fv.getCategoryBusinessUnits("RiskBusinessImpact");i.data.success&&(this.categoryOptions.RiskBusinessImpact=i.data.data)}catch(e){console.error("Failed to load category options:",e),this.error="Failed to load dropdown options. Some features may be limited."}finally{this.loading=!1}},showDropdown(e){this.activeDropdown=e,this.filterOptions(e),event.stopPropagation()},handleClickOutside(e){const a=document.querySelectorAll(".searchable-dropdown");let t=!0;a.forEach(a=>{a.contains(e.target)&&(t=!1)}),t&&(this.activeDropdown=null)},filterOptions(e){let a="";switch(e){case"BusinessUnitsCovered":a=this.businessUnitSearch||"";break;case"RiskType":a=this.riskTypeSearch||"";break;case"RiskCategory":a=this.riskCategorySearch||"";break;case"RiskBusinessImpact":a=this.riskBusinessImpactSearch||"";break}const t=a.toLowerCase();this.filteredOptions[e]=this.categoryOptions[e].filter(e=>e.value.toLowerCase().includes(t))},selectOption(e,a){switch(this.compliance[e]=a,e){case"BusinessUnitsCovered":this.businessUnitSearch=a;break;case"RiskType":this.riskTypeSearch=a;break;case"RiskCategory":this.riskCategorySearch=a;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch=a;break}this.activeDropdown=null},async addNewOption(e,a){if(a&&a.trim())try{const t=await bt.fv.addCategoryBusinessUnit({source:e,value:a.trim()});if(!t.data.success)throw new Error(t.data.error||"Failed to add new option");{const i=t.data.data;this.categoryOptions[e].push({id:i.id,value:i.value}),this.selectOption(e,a),this.successMessage=`Added new ${e} option: ${a}`,await this.loadCategoryOptions()}}catch(t){console.error(`Failed to add new ${e} option:`,t),this.error=`Failed to add new option: ${t.message||t}`}},validateFieldRealTime(e){if(!this.compliance.IsRisk&&["PossibleDamage","mitigation","RiskType","RiskCategory","RiskBusinessImpact"].includes(e))return this.validationErrors[e]="",this.fieldStates[e]={valid:!0,warning:!1,dirty:!0},!0;const a=this.compliance[e],t=this.validationRules[e];if(!t)return!0;if(this.fieldStates[e]||(this.fieldStates[e]={dirty:!1,valid:!1,warning:!1}),this.fieldStates[e].dirty=!0,!t.find(e=>e.required)&&!a)return this.validationErrors[e]="",this.fieldStates[e].valid=!0,this.fieldStates[e].warning=!1,!0;let i=!0,s=!1;for(const o of t){if(o.required&&(!a||""===a.toString().trim())){i=!1,this.validationErrors[e]=o.message;break}if(o.minLength&&a&&a.length<o.minLength&&(i=!1,a.length>0&&(s=!0,this.validationErrors[e]=`Need ${o.minLength-a.length} more characters`)),("Impact"===e||"Probability"===e)&&""!==a){const t=parseFloat(a);isNaN(t)?(i=!1,this.validationErrors[e]="Must be a valid number"):(t<o.min||t>o.max)&&(i=!1,this.validationErrors[e]=`Must be between ${o.min} and ${o.max}`)}}return this.fieldStates[e].valid=i,this.fieldStates[e].warning=s,i&&(this.validationErrors[e]=""),i},isFieldValid(e){return this.fieldStates[e]?.valid||!1},showWarning(e){return this.fieldStates[e]?.warning||!1},getValidationProgress(e){const a=this.compliance[e],t=this.validationRules[e];if(!a||!t)return 0;if(["Impact","Probability"].includes(e)){const e=parseFloat(a);return isNaN(e)?0:(e-1)/9*100}if(["Criticality","MaturityLevel","MandatoryOptional","ManualAutomatic"].includes(e))return a?100:0;const i=t.find(e=>e.minLength);if(i){const e=a.length/i.minLength*100;return Math.min(e,100)}return a?100:0},getValidationColor(e){const a=this.getValidationProgress(e);return a<50?"#dc2626":a<100?"#f59e0b":"#10b981"},getValidationMessage(e){const a=this.compliance[e],t=this.validationRules[e];if(!a){const e=t.find(e=>e.required);return e?e.message:""}if(this.validationErrors[e])return this.validationErrors[e];const i=t.find(e=>e.minLength);if(i&&a.length<i.minLength){const e=i.minLength-a.length;return`Need ${e} more character${1===e?"":"s"}`}const s=t.find(e=>e.maxLength);if(s&&a.length>s.maxLength){const e=a.length-s.maxLength;return`Exceeds maximum length by ${e} character${1===e?"":"s"}`}const o=t.find(e=>void 0!==e.min||void 0!==e.max);if(o){const e=parseFloat(a);if(isNaN(e))return"Please enter a valid number";if(e<o.min)return`Minimum value is ${o.min}`;if(e>o.max)return`Maximum value is ${o.max}`}return this.isFieldValid(e)?"Looks good!":""},scrollToError(){const e=Object.keys(this.validationErrors);if(e.length>0){const a=e[0],t=this.$refs[`field_${a}`];t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus())}},validateAndSubmit(){this.validationErrors={};let e=!0;Object.keys(this.validationRules).forEach(a=>{this.validateField(a)||(e=!1)}),e?this.submitForm():this.$nextTick(()=>{this.scrollToError()})},submitForm(){this.submitEdit()},addStep(){this.mitigationSteps.push({description:""}),this.onMitigationStepChange()},removeStep(e){this.mitigationSteps.length>1&&(this.mitigationSteps.splice(e,1),this.onMitigationStepChange())},onMitigationStepChange(){this.compliance.mitigation=this.mitigationSteps.reduce((e,a,t)=>(a.description.trim()&&(e[`step${t+1}`]=a.description),e),{}),this.validateField("mitigation")},parseMitigationSteps(e){if(!e)return[{description:""}];try{if("string"===typeof e)return[{description:e}];if(Array.isArray(e))return e.map(e=>({description:"string"===typeof e?e:e.description||""}));if("object"===typeof e)return Object.values(e).map(e=>({description:"string"===typeof e?e:e.description||""}))}catch(a){console.error("Error parsing mitigation steps:",a)}return[{description:""}]}}};const _4=(0,se.A)(P4,[["render",I4],["__scopeId","data-v-de09638c"]]);var S4=_4;const A4={class:"copy-compliance-page"},T4={class:"page-header"},x4={class:"header-content"},F4={class:"header-main"},V4={class:"page-content"},M4={class:"content-container"},X4={key:0,class:"message success-message"},U4={key:1,class:"loading-overlay"},N4={key:2,class:"message error-message"},$4={class:"field-group selection-fields"},O4={class:"row-fields"},j4={class:"compliance-field"},B4=["value"],W4={key:0,class:"field-error-message"},Q4={class:"compliance-field"},q4=["disabled"],K4=["value"],J4={key:0,class:"field-error-message"},z4={class:"compliance-field"},H4=["disabled"],Y4=["value"],G4={key:0,class:"field-error-message"},Z4={key:3,class:"compliance-item-form"},e5={class:"field-group"},a5={class:"row-fields"},t5={class:"compliance-field"},i5={key:0,class:"field-error-message"},s5={class:"compliance-field"},o5={class:"compliance-field full-width"},l5={key:0,class:"field-error-message"},n5={class:"compliance-field full-width"},r5={key:0,class:"field-error-message"},c5={class:"compliance-field full-width"},d5={key:0,class:"field-error-message"},u5={class:"row-fields"},p5={class:"compliance-field"},v5={class:"searchable-dropdown"},m5={class:"dropdown-options"},k5={key:0,class:"dropdown-add-option"},h5=["onClick"],g5={class:"compliance-field"},y5={class:"compliance-field checkbox-container"},f5={style:{"font-weight":"500","font-size":"1rem",display:"flex","align-items":"center",gap:"8px"},title:"Check if this compliance item represents a risk"},b5={key:0,class:"field-group risk-fields"},C5={class:"compliance-field full-width"},L5={key:0,class:"field-error-message"},w5={class:"compliance-field full-width"},E5={key:0,class:"field-error-message"},R5={class:"compliance-field full-width"},D5={key:0,class:"field-error-message"},I5={class:"row-fields"},P5={class:"compliance-field"},_5={class:"searchable-dropdown"},S5={class:"dropdown-options"},A5={key:0,class:"dropdown-add-option"},T5=["onClick"],x5={class:"compliance-field"},F5={class:"searchable-dropdown"},V5={class:"dropdown-options"},M5={key:0,class:"dropdown-add-option"},X5=["onClick"],U5={class:"compliance-field"},N5={class:"searchable-dropdown"},$5={class:"dropdown-options"},O5={key:0,class:"dropdown-add-option"},j5=["onClick"],B5={class:"field-group classification-fields"},W5={class:"row-fields"},Q5={class:"compliance-field"},q5={class:"compliance-field"},K5={class:"row-fields"},J5={class:"compliance-field"},z5={class:"compliance-field"},H5={class:"row-fields"},Y5={class:"compliance-field"},G5={key:0,class:"validation-error"},Z5={class:"compliance-field"},e8={key:0,class:"validation-error"},a8={class:"row-fields"},t8={class:"compliance-field"},i8={class:"field-group approval-fields"},s8={class:"row-fields"},o8={class:"compliance-field"},l8=["value"],n8={key:0,class:"validation-error"},r8={class:"compliance-submit-container"},c8=["disabled"],d8={key:0},u8={key:1},p8=["disabled"];function v8(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",A4,[(0,s.Lk)("div",T4,[(0,s.Lk)("div",x4,[(0,s.Lk)("div",F4,[a[57]||(a[57]=(0,s.Lk)("div",{class:"header-text"},[(0,s.Lk)("h1",null,"Copy Compliance Record"),(0,s.Lk)("p",null,"Create a new compliance item based on the selected one. Target location is auto-populated from current context.")],-1)),(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>n.goBack&&n.goBack(...e)),class:"back-button"},a[56]||(a[56]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])])]),(0,s.Lk)("div",V4,[(0,s.Lk)("div",M4,[l.successMessage?((0,s.uX)(),(0,s.CE)("div",X4,(0,d.v_)(l.successMessage),1)):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("div",U4,a[58]||(a[58]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("div",{class:"loading-text"},"Loading compliance data...",-1)]))):(0,s.Q3)("",!0),l.error?((0,s.uX)(),(0,s.CE)("div",N4,[a[59]||(a[59]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.error),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",$4,[a[66]||(a[66]=(0,s.Lk)("div",{class:"field-group-title"},"Target Location",-1)),a[67]||(a[67]=(0,s.Lk)("div",{class:"selection-info"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Framework is auto-selected from your current context. You can choose different Policy and Sub Policy as the target location. ")],-1)),(0,s.Lk)("div",O4,[(0,s.Lk)("div",j4,[a[61]||(a[61]=(0,s.Lk)("label",{for:"framework"},[(0,s.eW)(" Framework "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-status auto-selected"},"Auto-selected")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"framework","onUpdate:modelValue":a[1]||(a[1]=e=>l.targetFrameworkId=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.targetFrameworkId}]),ref:"field_targetFrameworkId",required:"",title:"Target framework (auto-selected)",disabled:""},[a[60]||(a[60]=(0,s.Lk)("option",{value:"",disabled:""},"Select Framework",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.frameworks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,B4))),128))],2),[[i.u1,l.targetFrameworkId]]),l.validationErrors.targetFrameworkId?((0,s.uX)(),(0,s.CE)("div",W4,(0,d.v_)(l.validationErrors.targetFrameworkId),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Q4,[a[63]||(a[63]=(0,s.Lk)("label",{for:"policy"},[(0,s.eW)(" Policy "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-status selectable"},"Selectable")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"policy","onUpdate:modelValue":a[2]||(a[2]=e=>l.targetPolicyId=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.targetPolicyId}]),ref:"field_targetPolicyId",required:"",title:"Select target policy",disabled:!l.targetFrameworkId},[a[62]||(a[62]=(0,s.Lk)("option",{value:"",disabled:""},"Select Policy",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,K4))),128))],10,q4),[[i.u1,l.targetPolicyId]]),l.validationErrors.targetPolicyId?((0,s.uX)(),(0,s.CE)("div",J4,(0,d.v_)(l.validationErrors.targetPolicyId),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",z4,[a[65]||(a[65]=(0,s.Lk)("label",{for:"subpolicy"},[(0,s.eW)(" Sub Policy "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-status selectable"},"Selectable")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"subpolicy","onUpdate:modelValue":a[3]||(a[3]=e=>l.targetSubPolicyId=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.targetSubPolicyId}]),ref:"field_targetSubPolicyId",required:"",title:"Select target sub-policy",disabled:!l.targetPolicyId},[a[64]||(a[64]=(0,s.Lk)("option",{value:"",disabled:""},"Select Sub Policy",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.subPolicies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,Y4))),128))],10,H4),[[i.u1,l.targetSubPolicyId]]),l.validationErrors.targetSubPolicyId?((0,s.uX)(),(0,s.CE)("div",G4,(0,d.v_)(l.validationErrors.targetSubPolicyId),1)):(0,s.Q3)("",!0)])])]),l.compliance?((0,s.uX)(),(0,s.CE)("div",Z4,[(0,s.Lk)("div",e5,[a[78]||(a[78]=(0,s.Lk)("div",{class:"field-group-title"},"Basic Information",-1)),(0,s.Lk)("div",a5,[(0,s.Lk)("div",t5,[a[68]||(a[68]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Title "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 5 characters)")],-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>l.compliance.ComplianceTitle=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceTitle}]),ref:"field_ComplianceTitle",placeholder:"Enter compliance title",onInput:a[5]||(a[5]=e=>n.validateFieldRealTime("ComplianceTitle")),onBlur:a[6]||(a[6]=e=>n.validateField("ComplianceTitle")),required:""},null,34),[[i.Jo,l.compliance.ComplianceTitle]]),l.validationErrors.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",i5,(0,d.v_)(l.validationErrors.ComplianceTitle),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",s5,[a[69]||(a[69]=(0,s.Lk)("label",null,"Compliance Type",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[7]||(a[7]=e=>l.compliance.ComplianceType=e),class:"compliance-input",placeholder:"Enter compliance type",title:"Type of compliance (e.g. Regulatory, Internal, Security)"},null,512),[[i.Jo,l.compliance.ComplianceType]])])]),(0,s.Lk)("div",o5,[a[70]||(a[70]=(0,s.Lk)("label",null,[(0,s.eW)(" Description "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[8]||(a[8]=e=>l.compliance.ComplianceItemDescription=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceItemDescription}]),ref:"field_ComplianceItemDescription",placeholder:"Detailed description of the compliance requirement",onInput:a[9]||(a[9]=e=>n.validateFieldRealTime("ComplianceItemDescription")),onBlur:a[10]||(a[10]=e=>n.validateField("ComplianceItemDescription")),rows:"3",required:""},null,34),[[i.Jo,l.compliance.ComplianceItemDescription]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.ComplianceItemDescription}])},(0,d.v_)(l.compliance.ComplianceItemDescription?.length||0)+"/20 min characters ",3),l.validationErrors.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",l5,(0,d.v_)(l.validationErrors.ComplianceItemDescription),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",n5,[a[71]||(a[71]=(0,s.Lk)("label",null,[(0,s.eW)(" Scope "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[11]||(a[11]=e=>l.compliance.Scope=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Scope}]),ref:"field_Scope",placeholder:"Define the boundaries and extent of the compliance requirement",onInput:a[12]||(a[12]=e=>n.validateFieldRealTime("Scope")),onBlur:a[13]||(a[13]=e=>n.validateField("Scope")),rows:"3",required:""},null,34),[[i.Jo,l.compliance.Scope]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Scope}])},(0,d.v_)(l.compliance.Scope?.length||0)+"/15 min characters ",3),l.validationErrors.Scope?((0,s.uX)(),(0,s.CE)("div",r5,(0,d.v_)(l.validationErrors.Scope),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",c5,[a[72]||(a[72]=(0,s.Lk)("label",null,[(0,s.eW)(" Objective "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[14]||(a[14]=e=>l.compliance.Objective=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Objective}]),ref:"field_Objective",placeholder:"Define the goal or purpose of this compliance requirement",onInput:a[15]||(a[15]=e=>n.validateFieldRealTime("Objective")),onBlur:a[16]||(a[16]=e=>n.validateField("Objective")),rows:"3",required:""},null,34),[[i.Jo,l.compliance.Objective]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Objective}])},(0,d.v_)(l.compliance.Objective?.length||0)+"/15 min characters ",3),l.validationErrors.Objective?((0,s.uX)(),(0,s.CE)("div",d5,(0,d.v_)(l.validationErrors.Objective),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",u5,[(0,s.Lk)("div",p5,[a[74]||(a[74]=(0,s.Lk)("label",null,"Business Units Covered",-1)),(0,s.Lk)("div",v5,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[17]||(a[17]=e=>l.businessUnitSearch=e),class:"compliance-input",placeholder:"Search or add business units",title:"Departments or business units affected by this compliance",onFocus:a[18]||(a[18]=e=>n.showDropdown("BusinessUnitsCovered")),onInput:a[19]||(a[19]=e=>n.filterOptions("BusinessUnitsCovered"))},null,544),[[i.Jo,l.businessUnitSearch]]),(0,s.bo)((0,s.Lk)("div",m5,[0===l.filteredOptions.BusinessUnitsCovered.length&&l.businessUnitSearch?((0,s.uX)(),(0,s.CE)("div",k5,[a[73]||(a[73]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:a[20]||(a[20]=e=>n.addNewOption("BusinessUnitsCovered",l.businessUnitSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.businessUnitSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.BusinessUnitsCovered,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption("BusinessUnitsCovered",e.value)},(0,d.v_)(e.value),9,h5))),128))],512),[[i.aG,"BusinessUnitsCovered"===l.activeDropdown]])])]),(0,s.Lk)("div",g5,[a[75]||(a[75]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[21]||(a[21]=e=>l.compliance.Identifier=e),class:"compliance-input",placeholder:"Auto-generated if left empty",title:"A new identifier will be generated",disabled:""},null,512),[[i.Jo,l.compliance.Identifier]]),a[76]||(a[76]=(0,s.Lk)("small",null,"A new identifier will be generated",-1))]),(0,s.Lk)("div",y5,[(0,s.Lk)("label",f5,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[22]||(a[22]=e=>l.compliance.IsRisk=e),style:{"margin-right":"8px",width:"auto"}},null,512),[[i.lH,l.compliance.IsRisk]]),a[77]||(a[77]=(0,s.eW)(" Is Risk "))])])])]),l.compliance.IsRisk?((0,s.uX)(),(0,s.CE)("div",b5,[a[88]||(a[88]=(0,s.Lk)("div",{class:"field-group-title"},"Risk Information",-1)),(0,s.Lk)("div",C5,[a[79]||(a[79]=(0,s.Lk)("label",null,[(0,s.eW)(" Possible Impact "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[23]||(a[23]=e=>l.compliance.PossibleDamage=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.PossibleDamage}]),ref:"field_PossibleDamage",placeholder:"Describe potential damage that could occur if this risk materializes",onInput:a[24]||(a[24]=e=>n.validateFieldRealTime("PossibleDamage")),onBlur:a[25]||(a[25]=e=>n.validateField("PossibleDamage")),rows:"3",required:""},null,34),[[i.Jo,l.compliance.PossibleDamage]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.PossibleDamage}])},(0,d.v_)(l.compliance.PossibleDamage?.length||0)+"/20 min characters ",3),l.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",L5,(0,d.v_)(l.validationErrors.PossibleDamage),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",w5,[a[80]||(a[80]=(0,s.Lk)("label",null,[(0,s.eW)(" Mitigation "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[26]||(a[26]=e=>l.compliance.mitigation=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.mitigation}]),ref:"field_mitigation",placeholder:"Describe the mitigation measures for this risk",onInput:a[27]||(a[27]=e=>n.validateFieldRealTime("mitigation")),onBlur:a[28]||(a[28]=e=>n.validateField("mitigation")),rows:"3",required:""},null,34),[[i.Jo,l.compliance.mitigation]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.mitigation}])},(0,d.v_)(l.compliance.mitigation?.length||0)+"/20 min characters ",3),l.validationErrors.mitigation?((0,s.uX)(),(0,s.CE)("div",E5,(0,d.v_)(l.validationErrors.mitigation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",R5,[a[81]||(a[81]=(0,s.Lk)("label",null,[(0,s.eW)(" Potential Risk Scenarios "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[29]||(a[29]=e=>l.compliance.PotentialRiskScenarios=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.PotentialRiskScenarios}]),ref:"field_PotentialRiskScenarios",placeholder:"Describe scenarios where this risk could materialize",onInput:a[30]||(a[30]=e=>n.validateFieldRealTime("PotentialRiskScenarios")),onBlur:a[31]||(a[31]=e=>n.validateField("PotentialRiskScenarios")),rows:"3",required:""},null,34),[[i.Jo,l.compliance.PotentialRiskScenarios]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.PotentialRiskScenarios}])},(0,d.v_)(l.compliance.PotentialRiskScenarios?.length||0)+"/20 min characters ",3),l.validationErrors.PotentialRiskScenarios?((0,s.uX)(),(0,s.CE)("div",D5,(0,d.v_)(l.validationErrors.PotentialRiskScenarios),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",I5,[(0,s.Lk)("div",P5,[a[83]||(a[83]=(0,s.Lk)("label",null,"Risk Type",-1)),(0,s.Lk)("div",_5,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[32]||(a[32]=e=>l.riskTypeSearch=e),class:"compliance-input",placeholder:"Search or add risk type",title:"Type of risk (e.g. Operational, Financial, Strategic)",onFocus:a[33]||(a[33]=e=>n.showDropdown("RiskType")),onInput:a[34]||(a[34]=e=>n.filterOptions("RiskType"))},null,544),[[i.Jo,l.riskTypeSearch]]),(0,s.bo)((0,s.Lk)("div",S5,[0===l.filteredOptions.RiskType.length&&l.riskTypeSearch?((0,s.uX)(),(0,s.CE)("div",A5,[a[82]||(a[82]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:a[35]||(a[35]=e=>n.addNewOption("RiskType",l.riskTypeSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskTypeSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskType,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption("RiskType",e.value)},(0,d.v_)(e.value),9,T5))),128))],512),[[i.aG,"RiskType"===l.activeDropdown]])])]),(0,s.Lk)("div",x5,[a[85]||(a[85]=(0,s.Lk)("label",null,"Risk Category",-1)),(0,s.Lk)("div",F5,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[36]||(a[36]=e=>l.riskCategorySearch=e),class:"compliance-input",placeholder:"Search or add risk category",title:"Category of risk (e.g. People, Process, Technology)",onFocus:a[37]||(a[37]=e=>n.showDropdown("RiskCategory")),onInput:a[38]||(a[38]=e=>n.filterOptions("RiskCategory"))},null,544),[[i.Jo,l.riskCategorySearch]]),(0,s.bo)((0,s.Lk)("div",V5,[0===l.filteredOptions.RiskCategory.length&&l.riskCategorySearch?((0,s.uX)(),(0,s.CE)("div",M5,[a[84]||(a[84]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:a[39]||(a[39]=e=>n.addNewOption("RiskCategory",l.riskCategorySearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskCategorySearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskCategory,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption("RiskCategory",e.value)},(0,d.v_)(e.value),9,X5))),128))],512),[[i.aG,"RiskCategory"===l.activeDropdown]])])]),(0,s.Lk)("div",U5,[a[87]||(a[87]=(0,s.Lk)("label",null,"Risk Business Impact",-1)),(0,s.Lk)("div",N5,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[40]||(a[40]=e=>l.riskBusinessImpactSearch=e),class:"compliance-input",placeholder:"Search or add business impact",title:"How this risk impacts business operations",onFocus:a[41]||(a[41]=e=>n.showDropdown("RiskBusinessImpact")),onInput:a[42]||(a[42]=e=>n.filterOptions("RiskBusinessImpact"))},null,544),[[i.Jo,l.riskBusinessImpactSearch]]),(0,s.bo)((0,s.Lk)("div",$5,[0===l.filteredOptions.RiskBusinessImpact.length&&l.riskBusinessImpactSearch?((0,s.uX)(),(0,s.CE)("div",O5,[a[86]||(a[86]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:a[43]||(a[43]=e=>n.addNewOption("RiskBusinessImpact",l.riskBusinessImpactSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskBusinessImpactSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskBusinessImpact,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:a=>n.selectOption("RiskBusinessImpact",e.value)},(0,d.v_)(e.value),9,j5))),128))],512),[[i.aG,"RiskBusinessImpact"===l.activeDropdown]])])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",B5,[a[100]||(a[100]=(0,s.Lk)("div",{class:"field-group-title"},"Classification",-1)),(0,s.Lk)("div",W5,[(0,s.Lk)("div",Q5,[a[90]||(a[90]=(0,s.Lk)("label",null,"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[44]||(a[44]=e=>l.compliance.Criticality=e),class:"compliance-select",required:"",title:"How critical this compliance item is to the organization"},a[89]||(a[89]=[(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),512),[[i.u1,l.compliance.Criticality]])]),(0,s.Lk)("div",q5,[a[92]||(a[92]=(0,s.Lk)("label",null,"Mandatory/Optional",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[45]||(a[45]=e=>l.compliance.MandatoryOptional=e),class:"compliance-select",required:"",title:"Whether this compliance item is mandatory or optional"},a[91]||(a[91]=[(0,s.Lk)("option",{value:"Mandatory"},"Mandatory",-1),(0,s.Lk)("option",{value:"Optional"},"Optional",-1)]),512),[[i.u1,l.compliance.MandatoryOptional]])])]),(0,s.Lk)("div",K5,[(0,s.Lk)("div",J5,[a[94]||(a[94]=(0,s.Lk)("label",null,"Manual/Automatic",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[46]||(a[46]=e=>l.compliance.ManualAutomatic=e),class:"compliance-select",required:"",title:"Whether this compliance is checked manually or automatically"},a[93]||(a[93]=[(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Automatic"},"Automatic",-1)]),512),[[i.u1,l.compliance.ManualAutomatic]])]),(0,s.Lk)("div",z5,[a[95]||(a[95]=(0,s.Lk)("label",null,"Applicability",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[47]||(a[47]=e=>l.compliance.Applicability=e),class:"compliance-input",placeholder:"Applicability from policy",title:"Describes where this compliance item applies"},null,512),[[i.Jo,l.compliance.Applicability]])])]),(0,s.Lk)("div",H5,[(0,s.Lk)("div",Y5,[a[96]||(a[96]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[48]||(a[48]=e=>l.compliance.Impact=e),onInput:a[49]||(a[49]=(...e)=>n.validateImpact&&n.validateImpact(...e)),class:"compliance-input",step:"0.1",min:"1",max:"10",title:"Rate the Severity Rating from 1 (lowest) to 10 (highest)"},null,544),[[i.Jo,l.compliance.Impact,void 0,{number:!0}]]),l.impactError?((0,s.uX)(),(0,s.CE)("span",G5," Severity Rating must be between 1 and 10 ")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Z5,[a[97]||(a[97]=(0,s.Lk)("label",null,"Probability (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[50]||(a[50]=e=>l.compliance.Probability=e),onInput:a[51]||(a[51]=(...e)=>n.validateProbability&&n.validateProbability(...e)),class:"compliance-input",step:"0.1",min:"1",max:"10",title:"Rate the probability from 1 (lowest) to 10 (highest)"},null,544),[[i.Jo,l.compliance.Probability,void 0,{number:!0}]]),l.probabilityError?((0,s.uX)(),(0,s.CE)("span",e8," Probability must be between 1 and 10 ")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",a8,[(0,s.Lk)("div",t8,[a[99]||(a[99]=(0,s.Lk)("label",null,"Maturity Level",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[52]||(a[52]=e=>l.compliance.MaturityLevel=e),class:"compliance-select",title:"Current maturity level of this compliance item"},a[98]||(a[98]=[(0,s.Lk)("option",null,"Initial",-1),(0,s.Lk)("option",null,"Developing",-1),(0,s.Lk)("option",null,"Defined",-1),(0,s.Lk)("option",null,"Managed",-1),(0,s.Lk)("option",null,"Optimizing",-1)]),512),[[i.u1,l.compliance.MaturityLevel]])])])]),(0,s.Lk)("div",i8,[a[103]||(a[103]=(0,s.Lk)("div",{class:"field-group-title"},"Approval Information",-1)),(0,s.Lk)("div",s8,[(0,s.Lk)("div",o8,[a[102]||(a[102]=(0,s.Lk)("label",null,"Assign Reviewer",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[53]||(a[53]=e=>l.compliance.reviewer_id=e),class:"compliance-select",required:"",title:"Person responsible for reviewing this compliance item"},[a[101]||(a[101]=(0,s.Lk)("option",{value:"",disabled:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName)+" "+(0,d.v_)(e.email?`(${e.email})`:""),9,l8))),128))],512),[[i.u1,l.compliance.reviewer_id]]),l.users.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",n8,"No reviewers available"))])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",r8,[(0,s.Lk)("button",{class:"compliance-submit-btn",onClick:a[54]||(a[54]=(...e)=>n.validateAndSubmit&&n.validateAndSubmit(...e)),disabled:l.loading||!n.canSaveCopy},[l.loading?((0,s.uX)(),(0,s.CE)("span",d8,"Saving...")):((0,s.uX)(),(0,s.CE)("span",u8,"Save Copy"))],8,c8),(0,s.Lk)("button",{class:"compliance-cancel-btn",onClick:a[55]||(a[55]=(...e)=>n.cancelCopy&&n.cancelCopy(...e)),disabled:l.loading}," Cancel ",8,p8)])])])])}var m8={name:"CopyCompliance",data(){return{compliance:null,users:[],frameworks:[],policies:[],subPolicies:[],targetFrameworkId:"",targetPolicyId:"",targetSubPolicyId:"",loading:!1,error:null,successMessage:null,impactError:!1,probabilityError:!1,originalComplianceId:null,localSourceSubPolicyId:null,categoryOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},filteredOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},businessUnitSearch:"",riskTypeSearch:"",riskCategorySearch:"",riskBusinessImpactSearch:"",activeDropdown:null,validationErrors:{},validationRules:{ComplianceTitle:[{required:!0,message:"Title is required"},{minLength:5,message:"Title must be at least 5 characters long"}],ComplianceItemDescription:[{required:!0,message:"Description is required"},{minLength:20,message:"Description must be at least 20 characters long"}],Scope:[{required:!0,message:"Scope is required"},{minLength:15,message:"Scope must be at least 15 characters long"}],Objective:[{required:!0,message:"Objective is required"},{minLength:15,message:"Objective must be at least 15 characters long"}],PossibleDamage:[{required:!0,message:"Possible Damage is required for risks"},{minLength:20,message:"Possible Damage must be at least 20 characters long"}],PotentialRiskScenarios:[{required:!0,message:"Risk Scenarios are required for risks"},{minLength:20,message:"Risk Scenarios must be at least 20 characters long"}],ComplianceType:[{required:!0,message:"Compliance Type is required"}],BusinessUnitsCovered:[{required:!0,message:"Business Units are required"}],RiskType:[{required:!0,message:"Risk Type is required for risks"}],RiskCategory:[{required:!0,message:"Risk Category is required for risks"}],RiskBusinessImpact:[{required:!0,message:"Risk Business Impact is required for risks"}],Criticality:[{required:!0,message:"Criticality is required"}],MandatoryOptional:[{required:!0,message:"Mandatory/Optional selection is required"}],ManualAutomatic:[{required:!0,message:"Manual/Automatic selection is required"}],MaturityLevel:[{required:!0,message:"Maturity Level is required"}],mitigation:[{required:!0,message:"Mitigation is required for risks"},{minLength:20,message:"Mitigation must be at least 20 characters long"}],Impact:[{required:!0,message:"Impact is required"},{min:0,max:10,message:"Impact must be between 0 and 10"}],Probability:[{required:!0,message:"Probability is required"},{min:0,max:10,message:"Probability must be between 0 and 10"}],reviewer_id:[{required:!0,message:"Reviewer is required"}]},fieldStates:{}}},computed:{canSaveCopy(){const e=this.compliance&&this.compliance.ComplianceItemDescription&&this.targetFrameworkId&&this.targetPolicyId&&this.targetSubPolicyId&&this.compliance.Criticality&&this.compliance.MandatoryOptional&&this.compliance.ManualAutomatic&&this.compliance.Impact&&this.compliance.Probability&&this.compliance.MaturityLevel&&this.compliance.reviewer_id;return Math.random()<.1&&console.log("ðŸ” canSaveCopy check:",{isValid:e,targetFrameworkId:this.targetFrameworkId,targetPolicyId:this.targetPolicyId,targetSubPolicyId:this.targetSubPolicyId,hasCompliance:!!this.compliance,hasDescription:!!this.compliance?.ComplianceItemDescription,hasCriticality:!!this.compliance?.Criticality,hasReviewer:!!this.compliance?.reviewer_id}),e}},async created(){const e=this.$route.params.id;e?(this.originalComplianceId=e,await this.loadComplianceData(e),await this.loadUsers(),await this.loadCategoryOptions(),await this.initializeFromContext(),this.compliance&&!this.compliance.reviewer_id&&this.users.length>0&&(this.compliance.reviewer_id=this.users[0].UserId),document.addEventListener("click",this.handleClickOutside)):this.error="No compliance ID provided"},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},watch:{targetFrameworkId(e){e&&(console.log("Framework changed to:",e),this.validationErrors.targetFrameworkId="",this.loadPolicies(e),this.targetPolicyId="",this.targetSubPolicyId="",this.policies=[],this.subPolicies=[])},targetPolicyId(e){if(e){console.log("Policy changed to:",e),this.validationErrors.targetPolicyId="",this.loadSubPolicies(e),this.targetSubPolicyId="",this.subPolicies=[];const a=this.policies.find(a=>a.id===e);a&&a.applicability&&this.compliance&&(this.compliance.Applicability=a.applicability,console.log("Updated applicability:",this.compliance.Applicability))}},targetSubPolicyId(e){e&&(console.log("Sub-policy changed to:",e),this.validationErrors.targetSubPolicyId="")}},methods:{async loadComplianceData(e){try{this.loading=!0;const a=await bt.fv.getComplianceById(e);a.data&&a.data.success?(this.compliance=a.data.data,this.localSourceSubPolicyId=this.compliance.SubPolicy,console.log("Loaded compliance data:",this.compliance),this.compliance.FrameworkId=a.data.data.FrameworkId,this.compliance.PolicyId=a.data.data.PolicyId,console.log("Framework ID:",this.compliance.FrameworkId,"Policy ID:",this.compliance.PolicyId),!this.compliance.reviewer_id&&this.users.length>0&&(this.compliance.reviewer_id=this.users[0].UserId),this.compliance.Identifier="",this.compliance.mitigation=this.formatMitigationData(this.compliance.mitigation)):this.error="Failed to load compliance data"}catch(a){console.error("Error loading compliance data:",a),this.error="Failed to load compliance data. Please try again."}finally{this.loading=!1}},formatMitigationData(e){if(console.log("Formatting mitigation data:",e),!e)return{};if("object"===typeof e&&null!==e){if(Object.keys(e).some(e=>!isNaN(parseInt(e))))return console.log("Mitigation is already in numbered format"),e;const a={};return Object.values(e).forEach((e,t)=>{a[(t+1).toString()]=e}),console.log("Converted object mitigation to numbered format:",a),a}if("string"===typeof e){try{if(e.trim().startsWith("{")){const a=JSON.parse(e);if(console.log("Parsed mitigation JSON:",a),"object"===typeof a&&null!==a)return this.formatMitigationData(a)}}catch(a){console.log("Failed to parse mitigation as JSON:",a)}if(e.trim())return console.log("Using mitigation string as single step"),{1:e.trim()}}return{}},async initializeFromContext(){try{const e=this.$route.query;console.log("=== INITIALIZING FROM CONTEXT ==="),console.log("Route query:",e),console.log("Current route params:",this.$route.params),e.frameworkId&&e.frameworkName?(console.log("âœ“ Using context from parent page"),console.log("Framework context:",{id:e.frameworkId,name:e.frameworkName}),this.frameworks=[{id:parseInt(e.frameworkId),name:e.frameworkName}],this.targetFrameworkId=parseInt(e.frameworkId),console.log("Set targetFrameworkId:",this.targetFrameworkId,typeof this.targetFrameworkId),await this.loadPolicies(parseInt(e.frameworkId)),e.policyId&&e.policyName&&(this.targetPolicyId=parseInt(e.policyId),console.log("Set targetPolicyId:",this.targetPolicyId,typeof this.targetPolicyId)),e.policyId&&(await this.loadSubPolicies(parseInt(e.policyId)),e.subPolicyId&&e.subPolicyName&&(this.targetSubPolicyId=parseInt(e.subPolicyId),console.log("Set targetSubPolicyId:",this.targetSubPolicyId,typeof this.targetSubPolicyId))),console.log("Context initialized:",{framework:this.targetFrameworkId,policy:this.targetPolicyId,subPolicy:this.targetSubPolicyId}),this.$forceUpdate(),this.validationErrors.targetFrameworkId="",this.validationErrors.targetPolicyId="",this.validationErrors.targetSubPolicyId="",console.log("Cleared validation errors for target fields")):(console.log("âœ— No context provided, loading all frameworks"),console.log("Missing context items:",{frameworkId:!!e.frameworkId,frameworkName:!!e.frameworkName,policyId:!!e.policyId,subPolicyId:!!e.subPolicyId}),await this.loadFrameworks(),await this.autoPopulateTargetFields())}catch(e){console.error("Error initializing from context:",e),this.error="Failed to initialize page context. Please try again."}},async autoPopulateTargetFields(){if(this.compliance)try{console.log("Auto-populating target fields..."),this.compliance.FrameworkId&&(this.targetFrameworkId=this.compliance.FrameworkId,console.log("Set target framework ID:",this.targetFrameworkId),await this.loadPolicies(this.compliance.FrameworkId),this.compliance.PolicyId&&(this.targetPolicyId=this.compliance.PolicyId,console.log("Set target policy ID:",this.targetPolicyId),await this.loadSubPolicies(this.compliance.PolicyId),this.compliance.SubPolicy&&(this.targetSubPolicyId=this.compliance.SubPolicy,console.log("Set target sub-policy ID:",this.targetSubPolicyId))))}catch(e){console.error("Error auto-populating target fields:",e),this.error="Failed to auto-populate target fields. Please select manually."}},async loadUsers(){try{this.loading=!0;const e=await bt.fv.getUsers();e.data.success&&Array.isArray(e.data.users)?this.users=e.data.users:(console.error("Invalid users data received:",e.data),this.error="Failed to load approvers")}catch(e){console.error("Failed to load users:",e),this.error="Failed to load approvers. Please try again."}finally{this.loading=!1}},async loadFrameworks(){try{this.loading=!0,this.error=null;const e=await bt.fv.getComplianceFrameworks();let a;if(console.log("Frameworks API URL: /api/compliance/frameworks/"),console.log("Frameworks response:",e.data),e.data.success&&e.data.frameworks)a=e.data.frameworks;else{if(!Array.isArray(e.data))return console.error("Unexpected response format:",e.data),this.error="Failed to load frameworks - invalid response format",void(this.frameworks=[]);a=e.data}this.frameworks=a.map(e=>({id:e.id,name:e.name})),console.log("Processed frameworks:",this.frameworks),0===this.frameworks.length&&(console.warn("No frameworks found"),this.error="No frameworks available")}catch(e){this.error=`Failed to load frameworks: ${e.response?.data?.message||e.message||"Unknown error"}`,console.error("Framework loading error:",e),console.error("Error response:",e.response),this.frameworks=[]}finally{this.loading=!1}},async loadPolicies(e){try{this.loading=!0,this.error=null;const a=await bt.fv.getCompliancePolicies(e);console.log(`Policies API URL: /api/compliance/frameworks/${e}/policies/list/`),console.log("Policies response for framework",e,":",a.data),a.data.success&&a.data.policies?(this.policies=a.data.policies.map(e=>({id:e.id,name:e.name,applicability:e.scope||e.Applicability||""})),console.log("Processed policies:",this.policies),0===this.policies.length&&console.warn("No policies found for framework:",e)):(console.error("Error in response:",a.data),this.error="Failed to load policies for the selected framework",this.policies=[])}catch(a){this.error=`Failed to load policies: ${a.response?.data?.message||a.message||"Unknown error"}`,console.error("Policy loading error:",a),console.error("Error response:",a.response),this.policies=[]}finally{this.loading=!1}},async loadSubPolicies(e){try{this.loading=!0,this.error=null;const a=await bt.fv.getComplianceSubPolicies(e);console.log(`Sub-policies API URL: /api/compliance/policies/${e}/subpolicies/`),console.log("Sub-policies response for policy",e,":",a.data),a.data.success&&a.data.subpolicies?(this.subPolicies=a.data.subpolicies.map(e=>({id:e.id,name:e.name})),console.log("Processed sub-policies:",this.subPolicies),0===this.subPolicies.length&&console.warn("No sub-policies found for policy:",e)):(console.error("Error in response:",a.data),this.error="Failed to load sub-policies for the selected policy",this.subPolicies=[])}catch(a){this.error=`Failed to load sub-policies: ${a.response?.data?.message||a.message||"Unknown error"}`,console.error("Sub-policy loading error:",a),console.error("Error response:",a.response),this.subPolicies=[]}finally{this.loading=!1}},validateImpact(e){const a=parseFloat(e.target.value);this.impactError=a<1||a>10},validateProbability(e){const a=parseFloat(e.target.value);this.probabilityError=a<1||a>10},getDefaultDueDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},async submitCopy(){if(this.canSaveCopy)try{this.loading=!0,this.error=null,this.successMessage=null,console.log("ðŸš€ Preparing clone data..."),console.log("Original compliance:",this.compliance),console.log("Target SubPolicy ID:",this.targetSubPolicyId);const e=this.formatMitigationData(this.compliance.mitigation);console.log("ðŸ“‹ Formatted mitigation:",e);const a={ComplianceTitle:this.compliance.ComplianceTitle||"",ComplianceItemDescription:this.compliance.ComplianceItemDescription||"",ComplianceType:this.compliance.ComplianceType||"",Scope:this.compliance.Scope||"",Objective:this.compliance.Objective||"",BusinessUnitsCovered:this.compliance.BusinessUnitsCovered||"",IsRisk:Boolean(this.compliance.IsRisk),PossibleDamage:this.compliance.PossibleDamage||"",mitigation:e,PotentialRiskScenarios:this.compliance.PotentialRiskScenarios||"",RiskType:this.compliance.RiskType||"",RiskCategory:this.compliance.RiskCategory||"",RiskBusinessImpact:this.compliance.RiskBusinessImpact||"",Criticality:this.compliance.Criticality||"Medium",MandatoryOptional:this.compliance.MandatoryOptional||"Mandatory",ManualAutomatic:this.compliance.ManualAutomatic||"Manual",Impact:String(this.compliance.Impact||5),Probability:String(this.compliance.Probability||5),MaturityLevel:this.compliance.MaturityLevel||"Initial",SubPolicy:this.targetSubPolicyId,target_subpolicy_id:this.targetSubPolicyId,Status:"Under Review",ActiveInactive:"Inactive",ComplianceVersion:"1.0",PermanentTemporary:this.compliance.PermanentTemporary||"Permanent",reviewer_id:this.compliance.reviewer_id,reviewer:this.compliance.reviewer_id,Applicability:this.compliance.Applicability||"",Identifier:"",CreatedByName:(this.compliance.reviewer_id||this.compliance.reviewer).toString(),ApprovalDueDate:this.getDefaultDueDate(),ComplianceId:null,FrameworkId:null,PolicyId:null};console.log("ðŸ“¦ Clone data prepared:",a),console.log("ðŸ”‘ Key fields check:"),console.log("- SubPolicy:",a.SubPolicy),console.log("- target_subpolicy_id:",a.target_subpolicy_id),console.log("- reviewer_id:",a.reviewer_id),console.log("- ApprovalDueDate:",a.ApprovalDueDate);const t=await bt.fv.cloneCompliance(this.originalComplianceId,a);console.log("ðŸ“¬ Clone response:",t.data),t.data.success?(u2.complianceCloned({ComplianceId:t.data.compliance_id}),this.successMessage="Compliance copied successfully!",setTimeout(()=>{this.$router.push("/compliance/tailoring")},1500)):this.error=t.data.message||"Failed to copy compliance"}catch(e){console.error("Copy error:",e),console.error("Error response:",e.response),this.error="Failed to copy compliance: "+(e.response?.data?.message||e.message)}finally{this.loading=!1}else this.error="Please fill all required fields and select a destination."},cancelCopy(){this.$router.push("/compliance/tailoring")},goBack(){const e=this.$route.query;e.frameworkId&&e.policyId&&e.subPolicyId?this.$router.push("/compliance/tailoring"):window.history.length>1?this.$router.go(-1):this.$router.push("/compliance/tailoring")},async loadCategoryOptions(){try{this.loading=!0;const e=await bt.fv.getCategoryBusinessUnits("BusinessUnitsCovered");e.data.success&&(this.categoryOptions.BusinessUnitsCovered=e.data.data);const a=await bt.fv.getCategoryBusinessUnits("RiskType");a.data.success&&(this.categoryOptions.RiskType=a.data.data);const t=await bt.fv.getCategoryBusinessUnits("RiskCategory");t.data.success&&(this.categoryOptions.RiskCategory=t.data.data);const i=await bt.fv.getCategoryBusinessUnits("RiskBusinessImpact");i.data.success&&(this.categoryOptions.RiskBusinessImpact=i.data.data)}catch(e){console.error("Failed to load category options:",e),u2.error("Failed to load dropdown options. Some features may be limited.")}finally{this.loading=!1}},showDropdown(e){this.activeDropdown=e,this.filterOptions(e),event.stopPropagation()},handleClickOutside(e){const a=document.querySelectorAll(".searchable-dropdown");let t=!0;a.forEach(a=>{a.contains(e.target)&&(t=!1)}),t&&(this.activeDropdown=null)},filterOptions(e){let a="";switch(e){case"BusinessUnitsCovered":a=this.businessUnitSearch||"";break;case"RiskType":a=this.riskTypeSearch||"";break;case"RiskCategory":a=this.riskCategorySearch||"";break;case"RiskBusinessImpact":a=this.riskBusinessImpactSearch||"";break}const t=a.toLowerCase();this.filteredOptions[e]=this.categoryOptions[e].filter(e=>e.value.toLowerCase().includes(t))},selectOption(e,a){switch(this.compliance[e]=a,e){case"BusinessUnitsCovered":this.businessUnitSearch=a;break;case"RiskType":this.riskTypeSearch=a;break;case"RiskCategory":this.riskCategorySearch=a;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch=a;break}this.activeDropdown=null},async addNewOption(e,a){try{const t=await bt.fv.addCategoryBusinessUnit({source:e,value:a});t.data.success&&(this.categoryOptions[e].push(t.data.data),this.selectOption(e,a),u2.success(`Added new ${e} option: ${a}`))}catch(t){console.error(`Failed to add new ${e} option:`,t),u2.error(`Failed to add new option: ${t.message||t}`)}},scrollToError(){const e=Object.keys(this.validationErrors).filter(e=>this.validationErrors[e]);if(console.log("ðŸ“ Scrolling to error for fields:",e),e.length>0){const a=e[0];let t;if(console.log("ðŸŽ¯ First error field:",a),a.startsWith("target")){const e={targetFrameworkId:"framework",targetPolicyId:"policy",targetSubPolicyId:"subpolicy"};t=document.getElementById(e[a])}else t=this.$refs[`field_${a}`];if(t)console.log("âœ… Found error element, scrolling..."),t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus&&t.focus();else{console.log("âŒ Error element not found for:",a);const e=document.querySelector(".selection-fields");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}},validateFieldRealTime(e){if(!this.compliance.IsRisk&&["PossibleDamage","mitigation","PotentialRiskScenarios","RiskType","RiskCategory","RiskBusinessImpact"].includes(e))return this.validationErrors[e]="",this.fieldStates[e]={valid:!0,warning:!1,dirty:!0},!0;const a=this.compliance[e],t=this.validationRules[e];if(!t)return!0;this.fieldStates[e]||(this.fieldStates[e]={dirty:!1,valid:!1,warning:!1}),this.fieldStates[e].dirty=!0;let i=!0,s=!1;for(const o of t){if(o.required&&(!a||""===a.toString().trim())){i=!1,this.validationErrors[e]=o.message;break}if(o.minLength&&a&&a.length<o.minLength&&(i=!1,a.length>0&&(s=!0,this.validationErrors[e]=`Need ${o.minLength-a.length} more characters`)),("Impact"===e||"Probability"===e)&&""!==a){const t=parseFloat(a);isNaN(t)?(i=!1,this.validationErrors[e]="Must be a valid number"):(t<o.min||t>o.max)&&(i=!1,this.validationErrors[e]=`Must be between ${o.min} and ${o.max}`)}}return this.fieldStates[e].valid=i,this.fieldStates[e].warning=s,i&&(this.validationErrors[e]=""),i},validateField(e){const a=this.validateFieldRealTime(e);return a||this.$nextTick(()=>{this.scrollToError()}),a},validateAndSubmit(){console.log("ðŸš€ Starting validation and submit"),console.log("Current target values:",{framework:this.targetFrameworkId,policy:this.targetPolicyId,subPolicy:this.targetSubPolicyId}),this.validationErrors={};let e=!0;if(this.targetFrameworkId||(this.validationErrors.targetFrameworkId="Framework is required",e=!1),this.targetPolicyId||(this.validationErrors.targetPolicyId="Policy is required",e=!1),this.targetSubPolicyId||(this.validationErrors.targetSubPolicyId="Sub Policy is required",e=!1),Object.keys(this.validationRules).forEach(a=>{a.startsWith("target")||this.validateField(a)||(e=!1)}),console.log("ðŸ“‹ Validation result:",{isValid:e,validationErrors:this.validationErrors}),!e)return console.log("âŒ Validation failed, scrolling to error"),void this.$nextTick(()=>{this.scrollToError()});console.log("âœ… Validation passed, submitting..."),this.submitCopy()}}};const k8=(0,se.A)(m8,[["render",v8],["__scopeId","data-v-36eb787c"]]);var h8=k8;const g8={class:"dashboard-container"},y8={class:"dashboard-header"},f8={class:"dashboard-actions"},b8=["disabled"],C8={key:0,class:"error-message"},L8={class:"performance-summary"},w8={class:"summary-card growth"},E8={class:"summary-content"},R8={class:"summary-value"},D8={class:"summary-card"},I8={class:"summary-content"},P8={class:"summary-value"},_8={class:"summary-card"},S8={class:"summary-content"},A8={class:"summary-value"},T8={key:1,class:"loading-state"},x8={key:2,class:"no-data-state"},F8={class:"compliance-approval-container"},V8={key:0},M8={key:1},X8={key:3,class:"edit-policy-modal"},U8={class:"edit-policy-content"},N8={class:"rejection-reason"},$8={class:"compliance-details-header"},O8={key:0},j8={key:1},B8={class:"policy-details-content"},W8={class:"policy-approval-section"},Q8={key:0},q8={key:1},K8={class:"policy-actions"},J8={key:0,class:"policy-approval-status"},z8={class:"status-container"},H8={key:0,class:"approval-date"},Y8={class:"date-value"},G8={key:1,class:"policy-rejection-remarks"},Z8={class:"remarks-value"},e6={key:0,class:"compliance-details"},a6={key:0,class:"deactivation-request-details"},t6={class:"compliance-detail-row"},i6={class:"compliance-detail-row"},s6={class:"status-badge current"},o6={class:"compliance-detail-row"},l6={class:"status-badge requested"},n6={class:"compliance-detail-row"},r6={key:0,class:"compliance-detail-row"},c6={class:"policy-count"},d6={class:"warning-message"},u6={key:1},p6={class:"compliance-detail-row"},v6={class:"compliance-detail-row"},m6={class:"compliance-detail-row"},k6={class:"severity-rating"},h6={class:"compliance-detail-row"},g6={class:"probability-value"},y6={class:"compliance-detail-row"},f6={class:"policy-actions"},b6={key:5,class:"reject-modal"},C6={class:"reject-modal-content"},L6={class:"reject-modal-actions"};function w6(e,a,t,o,l,n){const r=(0,s.g2)("CollapsibleTable"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",g8,[(0,s.Lk)("div",y8,[a[23]||(a[23]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Compliance Approver",-1)),(0,s.Lk)("div",f8,[(0,s.Lk)("button",{class:"action-btn",onClick:a[0]||(a[0]=(...e)=>n.refreshData&&n.refreshData(...e)),disabled:l.isLoading},[(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-sync-alt",{"fa-spin":l.isLoading}])},null,2)],8,b8),(0,s.Lk)("button",{class:"action-btn",onClick:a[1]||(a[1]=(...e)=>n.testPagination&&n.testPagination(...e))},a[21]||(a[21]=[(0,s.Lk)("i",{class:"fas fa-cog"},null,-1)])),a[22]||(a[22]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),l.error?((0,s.uX)(),(0,s.CE)("div",C8,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>n.refreshData&&n.refreshData(...e)),class:"retry-btn"},"Retry")])):(0,s.Q3)("",!0),(0,s.Lk)("div",L8,[(0,s.Lk)("div",w8,[a[25]||(a[25]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",E8,[a[24]||(a[24]=(0,s.Lk)("div",{class:"summary-label"},"Pending Approvals",-1)),(0,s.Lk)("div",R8,(0,d.v_)(n.pendingApprovalsCount),1)])]),(0,s.Lk)("div",D8,[a[27]||(a[27]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",I8,[a[26]||(a[26]=(0,s.Lk)("div",{class:"summary-label"},"Approved",-1)),(0,s.Lk)("div",P8,(0,d.v_)(n.approvedApprovalsCount),1)])]),(0,s.Lk)("div",_8,[a[29]||(a[29]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",S8,[a[28]||(a[28]=(0,s.Lk)("div",{class:"summary-label"},"Rejected",-1)),(0,s.Lk)("div",A8,(0,d.v_)(n.rejectedApprovalsCount),1)])])]),l.isLoading&&!l.approvals.length?((0,s.uX)(),(0,s.CE)("div",T8,a[30]||(a[30]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading approvals... ")]))):l.isLoading||0!==n.complianceApprovals.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",x8,a[31]||(a[31]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No pending approvals found.",-1),(0,s.Lk)("small",null,'Any compliance items with "Under Review" status will appear here.',-1)]))),(0,s.Lk)("div",F8,[a[32]||(a[32]=(0,s.Lk)("h2",{class:"compliance-approval-title"},"My Compliance Approval Tasks",-1)),(0,s.Lk)("div",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.groupedApprovals,(e,a)=>((0,s.uX)(),(0,s.Wv)(r,{key:a,sectionConfig:{name:a,statusClass:a.toLowerCase().replace(" ","-"),tasks:n.getPaginatedTasks(e.map(n.mapApprovalToRow),a)},tableHeaders:n.approvalTableHeaders,isExpanded:l.collapsibleStates[a],onToggle:e=>n.toggleSection(a),onTaskClick:n.handleApprovalAction,pagination:{currentPage:l.pagination[a].currentPage,totalPages:Math.ceil(l.pagination[a].totalCount/l.pagination[a].pageSize),pageSize:l.pagination[a].pageSize,totalCount:l.pagination[a].totalCount,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>n.handlePaginationChange(a,{...l.pagination[a],pageSize:e,currentPage:1})},onNextPage:()=>n.handlePaginationChange(a,{...l.pagination[a],currentPage:l.pagination[a].currentPage+1}),onPrevPage:()=>n.handlePaginationChange(a,{...l.pagination[a],currentPage:l.pagination[a].currentPage-1})},null,8,["sectionConfig","tableHeaders","isExpanded","onToggle","onTaskClick","pagination","onNextPage","onPrevPage"]))),128))]),n.approvedComplianceItems.length>0?((0,s.uX)(),(0,s.CE)("div",V8,[(0,s.bF)(r,{sectionConfig:{name:"Recently Approved",statusClass:"approved",tasks:n.getPaginatedTasks(n.approvedComplianceItems.map(n.mapApprovalToRow),"Recently Approved")},tableHeaders:n.approvalTableHeaders,isExpanded:l.collapsibleStates["Recently Approved"],onToggle:a[3]||(a[3]=e=>n.toggleSection("Recently Approved")),onTaskClick:n.handleApprovalAction,pagination:{currentPage:l.pagination["Recently Approved"].currentPage,totalPages:Math.ceil(l.pagination["Recently Approved"].totalCount/l.pagination["Recently Approved"].pageSize),pageSize:l.pagination["Recently Approved"].pageSize,totalCount:l.pagination["Recently Approved"].totalCount,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>n.handlePaginationChange("Recently Approved",{...l.pagination["Recently Approved"],pageSize:e,currentPage:1})},onNextPage:()=>n.handlePaginationChange("Recently Approved",{...l.pagination["Recently Approved"],currentPage:l.pagination["Recently Approved"].currentPage+1}),onPrevPage:()=>n.handlePaginationChange("Recently Approved",{...l.pagination["Recently Approved"],currentPage:l.pagination["Recently Approved"].currentPage-1})},null,8,["sectionConfig","tableHeaders","isExpanded","onTaskClick","pagination","onNextPage","onPrevPage"])])):(0,s.Q3)("",!0),l.rejectedCompliances.length?((0,s.uX)(),(0,s.CE)("div",M8,[(0,s.bF)(r,{sectionConfig:{name:"Rejected",statusClass:"rejected",tasks:n.getPaginatedTasks(l.rejectedCompliances.map(n.mapRejectedToRow),"Rejected")},tableHeaders:n.rejectedTableHeaders,isExpanded:l.collapsibleStates["Rejected"],onToggle:a[4]||(a[4]=e=>n.toggleSection("Rejected")),onTaskClick:n.handleRejectedAction,pagination:{currentPage:l.pagination["Rejected"].currentPage,totalPages:Math.ceil(l.pagination["Rejected"].totalCount/l.pagination["Rejected"].pageSize),pageSize:l.pagination["Rejected"].pageSize,totalCount:l.pagination["Rejected"].totalCount,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>n.handlePaginationChange("Rejected",{...l.pagination["Rejected"],pageSize:e,currentPage:1})},onNextPage:()=>n.handlePaginationChange("Rejected",{...l.pagination["Rejected"],currentPage:l.pagination["Rejected"].currentPage+1}),onPrevPage:()=>n.handlePaginationChange("Rejected",{...l.pagination["Rejected"],currentPage:l.pagination["Rejected"].currentPage-1})},null,8,["sectionConfig","tableHeaders","isExpanded","onTaskClick","pagination","onNextPage","onPrevPage"])])):(0,s.Q3)("",!0)]),l.showEditComplianceModal&&l.editingCompliance?((0,s.uX)(),(0,s.CE)("div",X8,[(0,s.Lk)("div",U8,[(0,s.Lk)("h3",null,"Edit & Resubmit Compliance: "+(0,d.v_)(l.editingCompliance.Identifier),1),(0,s.Lk)("button",{class:"close-btn",onClick:a[5]||(a[5]=(...e)=>n.closeEditComplianceModal&&n.closeEditComplianceModal(...e))},"Close"),(0,s.Lk)("div",null,[a[33]||(a[33]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[6]||(a[6]=e=>l.editingCompliance.ExtractedData.ComplianceItemDescription=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.ComplianceItemDescription]])]),(0,s.Lk)("div",null,[a[35]||(a[35]=(0,s.Lk)("label",null,"Criticality:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>l.editingCompliance.ExtractedData.Criticality=e)},a[34]||(a[34]=[(0,s.Lk)("option",null,"High",-1),(0,s.Lk)("option",null,"Medium",-1),(0,s.Lk)("option",null,"Low",-1)]),512),[[i.u1,l.editingCompliance.ExtractedData.Criticality]])]),(0,s.Lk)("div",null,[a[36]||(a[36]=(0,s.Lk)("label",null,"Severity Rating:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[8]||(a[8]=e=>l.editingCompliance.ExtractedData.Impact=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.Impact]])]),(0,s.Lk)("div",null,[a[37]||(a[37]=(0,s.Lk)("label",null,"Probability:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":a[9]||(a[9]=e=>l.editingCompliance.ExtractedData.Probability=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.Probability]])]),(0,s.Lk)("div",null,[a[38]||(a[38]=(0,s.Lk)("label",null,"Mitigation:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[10]||(a[10]=e=>l.editingCompliance.ExtractedData.mitigation=e)},null,512),[[i.Jo,l.editingCompliance.ExtractedData.mitigation]])]),(0,s.Lk)("div",null,[a[39]||(a[39]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",N8,(0,d.v_)(l.editingCompliance.ExtractedData.compliance_approval?.remarks),1)]),(0,s.Lk)("button",{class:"resubmit-btn",onClick:a[11]||(a[11]=e=>n.resubmitCompliance(l.editingCompliance))},"Resubmit for Review")])])):(0,s.Q3)("",!0),l.showDetailsModal&&l.selectedApproval?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"compliance-details-modal",onClick:a[17]||(a[17]=(...e)=>n.closeDetailsModal&&n.closeDetailsModal(...e))},[(0,s.Lk)("div",{class:"compliance-details-modal-content",onClick:a[16]||(a[16]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",$8,[(0,s.Lk)("button",{class:"close-btn",onClick:a[12]||(a[12]=(...e)=>n.closeDetailsModal&&n.closeDetailsModal(...e))},a[40]||(a[40]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)])),(0,s.Lk)("h3",null,[a[41]||(a[41]=(0,s.Lk)("span",{class:"detail-type-indicator"},"Compliance",-1)),"Change Status to Inactive"===l.selectedApproval.ExtractedData?.RequestType||"compliance_deactivation"===l.selectedApproval.ExtractedData?.type?((0,s.uX)(),(0,s.CE)("span",O8," Deactivation Request: "+(0,d.v_)(l.selectedApproval.Identifier),1)):((0,s.uX)(),(0,s.CE)("span",j8," Details: "+(0,d.v_)(l.selectedApproval.Identifier),1))])]),(0,s.Lk)("div",B8,[(0,s.Lk)("div",W8,[(0,s.Lk)("h4",null,["Change Status to Inactive"===l.selectedApproval.ExtractedData?.RequestType||"compliance_deactivation"===l.selectedApproval.ExtractedData?.type?((0,s.uX)(),(0,s.CE)("span",Q8," Compliance Deactivation Approval ")):((0,s.uX)(),(0,s.CE)("span",q8," Compliance Approval "))]),(0,s.Lk)("div",K8,[(0,s.Lk)("button",{class:"submit-btn",onClick:a[13]||(a[13]=e=>n.submitReview())},a[42]||(a[42]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.Lk)("span",null,"Submit Review",-1)]))]),n.approvalStatus?((0,s.uX)(),(0,s.CE)("div",J8,[(0,s.Lk)("div",z8,[a[43]||(a[43]=(0,s.Lk)("div",{class:"status-label"},"Current Status:",-1)),(0,s.Lk)("div",{class:(0,d.C4)(["status-value",{approved:!0===n.approvalStatus.approved,rejected:!1===n.approvalStatus.approved,pending:null===n.approvalStatus.approved}])},(0,d.v_)(!0===n.approvalStatus.approved?"Approved":!1===n.approvalStatus.approved?"Rejected":"Pending Review"),3)]),l.selectedApproval.ApprovedDate?((0,s.uX)(),(0,s.CE)("div",H8,[a[44]||(a[44]=(0,s.Lk)("div",{class:"date-label"},[(0,s.Lk)("i",{class:"fas fa-calendar-check"}),(0,s.eW)(" Approved on: ")],-1)),(0,s.Lk)("div",Y8,(0,d.v_)(n.formatDate(l.selectedApproval.ApprovedDate)),1)])):(0,s.Q3)("",!0),!1===n.approvalStatus.approved&&n.approvalStatus.remarks?((0,s.uX)(),(0,s.CE)("div",G8,[a[45]||(a[45]=(0,s.Lk)("div",{class:"remarks-label"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Rejection Reason: ")],-1)),(0,s.Lk)("div",Z8,(0,d.v_)(n.approvalStatus.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",e6,["Change Status to Inactive"===l.selectedApproval.ExtractedData?.RequestType||"compliance_deactivation"===l.selectedApproval.ExtractedData?.type?((0,s.uX)(),(0,s.CE)("div",a6,[(0,s.Lk)("div",t6,[a[46]||(a[46]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-question-circle"}),(0,s.eW)(" Reason for Deactivation: ")],-1)),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.reason||"No reason provided"),1)]),(0,s.Lk)("div",i6,[a[47]||(a[47]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Current Status: ")],-1)),(0,s.Lk)("span",s6,(0,d.v_)(l.selectedApproval.ExtractedData.current_status),1)]),(0,s.Lk)("div",o6,[a[48]||(a[48]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-arrow-right"}),(0,s.eW)(" Requested Status: ")],-1)),(0,s.Lk)("span",l6,(0,d.v_)(l.selectedApproval.ExtractedData.requested_status),1)]),(0,s.Lk)("div",n6,[a[49]||(a[49]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-sitemap"}),(0,s.eW)(" Cascade to Policies: ")],-1)),(0,s.Lk)("span",{class:(0,d.C4)(["cascade-indicator",{warning:"Yes"===l.selectedApproval.ExtractedData.cascade_to_policies}])},(0,d.v_)(l.selectedApproval.ExtractedData.cascade_to_policies),3)]),l.selectedApproval.ExtractedData.affected_policies_count>0?((0,s.uX)(),(0,s.CE)("div",r6,[a[50]||(a[50]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Affected Policies: ")],-1)),(0,s.Lk)("span",c6,(0,d.v_)(l.selectedApproval.ExtractedData.affected_policies_count)+" policies",1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",d6,[a[52]||(a[52]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("span",null,[a[51]||(a[51]=(0,s.Lk)("strong",null,"Warning:",-1)),(0,s.eW)(" Deactivating this compliance will make it inactive. "+(0,d.v_)("Yes"===l.selectedApproval.ExtractedData.cascade_to_policies?"All related policies will also be deactivated.":"Related policies will not be affected."),1)])])])):((0,s.uX)(),(0,s.CE)("div",u6,[(0,s.Lk)("div",p6,[a[53]||(a[53]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-file-text"}),(0,s.eW)(" Description: ")],-1)),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.ComplianceItemDescription),1)]),(0,s.Lk)("div",v6,[a[54]||(a[54]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-exclamation"}),(0,s.eW)(" Criticality: ")],-1)),(0,s.Lk)("span",{class:(0,d.C4)(["criticality-badge",l.selectedApproval.ExtractedData.Criticality?.toLowerCase()])},(0,d.v_)(l.selectedApproval.ExtractedData.Criticality),3)]),(0,s.Lk)("div",m6,[a[55]||(a[55]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)(" Severity Rating: ")],-1)),(0,s.Lk)("span",k6,(0,d.v_)(l.selectedApproval.ExtractedData.Impact),1)]),(0,s.Lk)("div",h6,[a[56]||(a[56]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-percentage"}),(0,s.eW)(" Probability: ")],-1)),(0,s.Lk)("span",g6,(0,d.v_)(l.selectedApproval.ExtractedData.Probability),1)]),(0,s.Lk)("div",y6,[a[57]||(a[57]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Mitigation: ")],-1)),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.mitigation),1)])])),(0,s.Lk)("div",f6,[(0,s.Lk)("button",{class:"approve-btn",onClick:a[14]||(a[14]=e=>n.approveCompliance())},a[58]||(a[58]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.Lk)("span",null,"Approve",-1)])),(0,s.Lk)("button",{class:"reject-btn",onClick:a[15]||(a[15]=e=>n.rejectCompliance())},a[59]||(a[59]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.Lk)("span",null,"Reject",-1)]))])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",b6,[(0,s.Lk)("div",C6,[a[62]||(a[62]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-times-circle"}),(0,s.eW)(" Rejection Reason Required ")],-1)),a[63]||(a[63]=(0,s.Lk)("p",null,"Please provide a detailed reason for rejecting this compliance item. This information will be used to improve future submissions.",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[18]||(a[18]=e=>l.rejectionComment=e),class:"rejection-comment",placeholder:"Enter your detailed comments here..."},"        ",512),[[i.Jo,l.rejectionComment]]),(0,s.Lk)("div",L6,[(0,s.Lk)("button",{class:"cancel-btn",onClick:a[19]||(a[19]=(...e)=>n.cancelRejection&&n.cancelRejection(...e))},a[60]||(a[60]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Cancel ")])),(0,s.Lk)("button",{class:"confirm-btn",onClick:a[20]||(a[20]=(...e)=>n.confirmRejection&&n.confirmRejection(...e))},a[61]||(a[61]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Confirm Rejection ")]))])])])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var E6={methods:{showSuccessPopup(e,a="Success"){pv.OQ.success(e,a)},showErrorPopup(e,a="Error"){pv.OQ.error(e,a)},showWarningPopup(e,a="Warning"){pv.OQ.warning(e,a)},showInfoPopup(e,a="Information"){pv.OQ.show({type:"info",heading:a,message:e,buttons:[{label:"OK",action:"ok"}]})},showConfirmPopup(e,a="Confirm",t,i){pv.OQ.confirm(e,a,t,i)},showCommentPopup(e,a="Comment",t){pv.OQ.comment(e,a,t)},showAutoClosePopup(e,a,t="info",i=3e3){pv.OQ.show({type:t,heading:a,message:e,buttons:[{label:"OK",action:"ok"}],autoClose:i})},confirmDeactivateCompliance(e,a){const t=`Are you sure you want to deactivate "${e.ComplianceItemDescription||"this compliance"}"?`;this.showConfirmPopup(t,"Deactivate Compliance",a)},confirmEditCompliance(e,a){const t=`Are you sure you want to edit "${e.ComplianceItemDescription||"this compliance"}"? This will create a new version.`;this.showConfirmPopup(t,"Edit Compliance",a)},confirmCloneCompliance(e,a){const t=`Are you sure you want to clone "${e.ComplianceItemDescription||"this compliance"}"?`;this.showConfirmPopup(t,"Clone Compliance",a)},confirmDeleteCompliance(e,a){const t=`Are you sure you want to delete "${e.ComplianceItemDescription||"this compliance"}"? This action cannot be undone.`;this.showConfirmPopup(t,"Delete Compliance",a)},confirmActivateVersion(e,a){const t=`Are you sure you want to activate version ${e.ComplianceVersion||"this version"} of this compliance?`;this.showConfirmPopup(t,"Activate Version",a)},getRejectComments(e,a){const t=`Please provide a reason for rejecting "${e.ComplianceItemDescription||"this compliance"}":`;this.showCommentPopup(t,"Reject Compliance",a)},getDeactivationReason(e,a){const t=`Please provide a reason for deactivating "${e.ComplianceItemDescription||"this compliance"}":`;this.showCommentPopup(t,"Deactivation Reason",a)},showComplianceInfo(e){const a=e.ComplianceItemDescription||"No description available",t=e.Status||"Unknown",i=e.ComplianceVersion||"Unknown",s=`Status: ${t}\nVersion: ${i}\nDescription: ${a}`;this.showInfoPopup(s,"Compliance Information")},showAuditInfo(e){if(!e)return void this.showInfoPopup("No audit information available for this compliance.","Audit Information");const a=e.audit_performer_name||"Unknown",t=e.audit_approver_name||"Unknown",i=e.audit_date||"Unknown",s=e.audit_findings_status||"Unknown",o=`Performed by: ${a}\nApproved by: ${t}\nDate: ${i}\nStatus: ${s}`;this.showInfoPopup(o,"Audit Information")}}},R6={name:"ComplianceApprover",components:{PopupModal:pv.wA,CollapsibleTable:Cl},mixins:[E6],data(){return{approvals:[],selectedApproval:null,showRejectModal:!1,rejectionComment:"",rejectedCompliances:[],showEditComplianceModal:!1,editingCompliance:null,userId:2,isLoading:!1,error:null,counts:{pending:0,approved:0,rejected:0},refreshInterval:null,isLoadingRejected:!1,isDeactivationRequest:!1,collapsibleStates:{Pending:!0,Approved:!1,Rejected:!1,"Recently Approved":!1},pagination:{Pending:{currentPage:1,pageSize:10,totalCount:0},Approved:{currentPage:1,pageSize:10,totalCount:0},Rejected:{currentPage:1,pageSize:10,totalCount:0},"Recently Approved":{currentPage:1,pageSize:10,totalCount:0}},showDetailsModal:!1}},async mounted(){console.log("ComplianceApprover mounted"),await this.refreshData(),this.refreshInterval=setInterval(()=>{this.refreshData()},3e4),document.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval),document.removeEventListener("keydown",this.handleKeydown)},watch:{complianceApprovals:{handler(){this.updatePaginationCounts()},deep:!0},approvedComplianceItems:{handler(){this.updatePaginationCounts()},deep:!0},rejectedCompliances:{handler(){this.updatePaginationCounts()},deep:!0}},methods:{async refreshData(){if(!this.isLoading){this.isLoading=!0,this.error=null,console.log("Refreshing data...");try{const e=await bt.fv.getCompliancePolicyApprovals({reviewer_id:this.userId});if(console.log("Approvals response:",e),!e.data.success)throw new Error(e.data.message||"Failed to fetch approvals");{console.log("Raw approvals data:",e.data.data);const a=(e.data.data||[]).filter(e=>"compliance_deactivation"===e.ExtractedData?.type||"Change Status to Inactive"===e.ExtractedData?.RequestType||e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE"));console.log(`Found ${a.length} deactivation requests in the response:`,a),this.approvals=(e.data.data||[]).map(e=>({...e,ExtractedData:{...e.ExtractedData,type:e.ExtractedData?.type||"compliance",compliance_approval:e.ExtractedData?.compliance_approval||{approved:null,remarks:""}}})),this.counts=e.data.counts||{pending:0,approved:0,rejected:0};const t=this.approvals.filter(e=>!0===e.ApprovedNot);console.log(`Found ${t.length} approved compliances:`,t),console.log("Updated approvals:",this.approvals),console.log("Updated counts:",this.counts)}await this.loadRejectedCompliances(),this.updatePaginationCounts()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showApproveComplianceDenied();console.error("Error refreshing data:",e),this.error=e.response?.data?.message||e.message||"Failed to load approvals"}finally{this.isLoading=!1}}},openApprovalDetails(e){console.log("Opening approval details:",e),this.selectedApproval=e,this.showDetailsModal=!0},async submitReview(){this.showConfirmPopup("Do you want to approve this compliance item?","Compliance Review",()=>this.processApproval(!0),()=>this.showRejectPopup())},showRejectPopup(){this.showCommentPopup("Please provide a reason for rejecting this compliance:","Reject Compliance",e=>this.processApproval(!1,e))},async processApproval(e,a=""){try{if(!this.selectedApproval)return;this.isSubmitting=!0;let t=this.selectedApproval.ApprovalId;if("compliance_deactivation"===this.selectedApproval.ExtractedData?.type||"Change Status to Inactive"===this.selectedApproval.ExtractedData?.RequestType)e?await bt.fv.approveComplianceDeactivation(t,{user_id:this.userId}):await bt.fv.rejectComplianceDeactivation(t,{user_id:this.userId,remarks:a});else{let i=this.selectedApproval.ExtractedData;i.compliance_approval||(i.compliance_approval={}),i.compliance_approval.approved=e,i.compliance_approval.remarks=a,await bt.fv.submitComplianceReview(t,{ExtractedData:i,ApprovedNot:e})}u2.reviewSubmitted(e),this.approvalStatus={approved:e,remarks:a},this.refreshData()}catch(t){console.error("Error submitting review:",t),this.showErrorPopup(`Error submitting review: ${t.message||"Unknown error"}`)}finally{this.isSubmitting=!1}},async approveCompliance(){if(this.selectedApproval)try{this.isLoading=!0,console.log("Starting approval process for compliance ID:",this.selectedApproval.ApprovalId);const a="compliance_deactivation"===this.selectedApproval.ExtractedData?.type||"Change Status to Inactive"===this.selectedApproval.ExtractedData?.RequestType||this.selectedApproval.Identifier&&this.selectedApproval.Identifier.includes("COMP-DEACTIVATE");let t;if(console.log(`This is ${a?"a":"not a"} deactivation request`),a)console.log("Processing deactivation approval..."),t=await bt.fv.approveComplianceDeactivation(this.selectedApproval.ApprovalId,{user_id:this.userId}),this.selectedApproval.ExtractedData&&(this.selectedApproval.ExtractedData.current_status="Inactive",this.selectedApproval.ExtractedData.compliance_approval&&(this.selectedApproval.ExtractedData.compliance_approval.approved=!0));else{this.selectedApproval.ExtractedData.compliance_approval||(this.selectedApproval.ExtractedData.compliance_approval={}),this.selectedApproval.ExtractedData.compliance_approval.approved=!0,this.selectedApproval.ExtractedData.compliance_approval.remarks="",this.selectedApproval.ApprovedNot=!0,this.selectedApproval.ExtractedData.Status="Approved",this.selectedApproval.ExtractedData.ActiveInactive="Active",console.log("Approving compliance with data:",JSON.stringify(this.selectedApproval.ExtractedData));const a={ExtractedData:this.selectedApproval.ExtractedData,ApprovedNot:!0};try{t=await bt.fv.submitComplianceReview(this.selectedApproval.ApprovalId,a)}catch(e){if(console.error("API call failed:",e),"Network Error"!==e.message&&"ERR_NETWORK"!==e.code)throw e;{console.log("Retrying with simplified payload due to network error");const e={approved:!0,remarks:""};t=await bt.fv.submitComplianceReview(this.selectedApproval.ApprovalId,e)}}}if(console.log("Approval response:",t?.data),this.selectedApproval.Identifier){console.log(`Checking if identifier ${this.selectedApproval.Identifier} exists in rejected list...`);const e=this.rejectedCompliances.length;this.rejectedCompliances=this.rejectedCompliances.filter(e=>e.Identifier!==this.selectedApproval.Identifier);const a=this.rejectedCompliances.length;e>a&&console.log(`Removed ${e-a} item(s) with identifier ${this.selectedApproval.Identifier} from rejected list`)}this.showSuccessPopup(a?"Compliance has been deactivated successfully!":"Compliance has been approved successfully!",a?"Deactivation Complete":"Approval Complete"),this.closeDetailsModal(),setTimeout(()=>{this.refreshData()},1e3)}catch(a){console.error("Error approving compliance:",a),this.showErrorPopup("Error approving compliance: "+(a.response?.data?.message||a.message||"Network error - please check server connection"),"Approval Error")}finally{this.isLoading=!1}},rejectCompliance(){const e="compliance_deactivation"===this.selectedApproval?.ExtractedData?.type||"Change Status to Inactive"===this.selectedApproval?.ExtractedData?.RequestType||this.selectedApproval?.Identifier&&this.selectedApproval?.Identifier.includes("COMP-DEACTIVATE");this.isDeactivationRequest=e,this.showRejectModal=!0},async confirmRejection(){if(this.rejectionComment.trim())try{let e;this.isLoading=!0,console.log("Starting rejection process for compliance ID:",this.selectedApproval.ApprovalId),this.isDeactivationRequest?(console.log("Processing deactivation rejection..."),e=await bt.fv.rejectComplianceDeactivation(this.selectedApproval.ApprovalId,{user_id:this.userId,remarks:this.rejectionComment}),this.selectedApproval.ExtractedData&&(this.selectedApproval.ExtractedData.current_status="Active",this.selectedApproval.ExtractedData.compliance_approval&&(this.selectedApproval.ExtractedData.compliance_approval.approved=!1,this.selectedApproval.ExtractedData.compliance_approval.remarks=this.rejectionComment))):(this.selectedApproval.ExtractedData.compliance_approval||(this.selectedApproval.ExtractedData.compliance_approval={}),this.selectedApproval.ExtractedData.compliance_approval.approved=!1,this.selectedApproval.ExtractedData.compliance_approval.remarks=this.rejectionComment,this.selectedApproval.ApprovedNot=!1,this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ExtractedData.ActiveInactive="Inactive",console.log("Rejecting compliance with data:",JSON.stringify(this.selectedApproval.ExtractedData)),e=await bt.fv.submitComplianceReview(this.selectedApproval.ApprovalId,{ExtractedData:this.selectedApproval.ExtractedData,ApprovedNot:!1})),console.log("Rejection response:",e.data),this.showSuccessPopup(this.isDeactivationRequest?"Deactivation request has been rejected successfully!":"Compliance has been rejected successfully!","Rejection Complete"),this.showRejectModal=!1,this.rejectionComment="",this.closeDetailsModal(),setTimeout(()=>{this.refreshData()},1e3)}catch(e){console.error("Error rejecting compliance:",e),this.showErrorPopup("Error rejecting compliance: "+(e.response?.data?.message||e.message),"Rejection Error")}finally{this.isLoading=!1}else alert("Please provide a reason for rejection")},cancelRejection(){this.showRejectModal=!1,this.rejectionComment=""},openRejectedItem(e){console.log("Opening rejected item:",e),this.editingCompliance=JSON.parse(JSON.stringify(e)),this.showEditComplianceModal=!0,console.log("Opened rejected item in edit modal:",{ApprovalId:this.editingCompliance.ApprovalId,Identifier:this.editingCompliance.Identifier,ApprovedNot:this.editingCompliance.ApprovedNot,remarks:this.editingCompliance.ExtractedData?.compliance_approval?.remarks})},closeEditComplianceModal(){this.showEditComplianceModal=!1,this.editingCompliance=null},async resubmitCompliance(e){try{e.ExtractedData.compliance_approval?(e.ExtractedData.compliance_approval.approved=null,e.ExtractedData.compliance_approval.remarks="",e.ExtractedData.compliance_approval.inResubmission=!0):e.ExtractedData.compliance_approval={approved:null,remarks:"",inResubmission:!0},this.isLoading=!0,console.log("Resubmitting compliance with ID:",e.ApprovalId),console.log("Resubmitting with data:",JSON.stringify(e.ExtractedData));const a=await bt.fv.resubmitComplianceApproval(e.ApprovalId,{ExtractedData:e.ExtractedData});if(console.log("Resubmission response:",a),!a.data||!a.data.ApprovalId&&!a.data.success)throw new Error("Failed to get confirmation from server");this.rejectedCompliances=this.rejectedCompliances.filter(a=>a.ApprovalId!==e.ApprovalId),this.showEditComplianceModal=!1,this.editingCompliance=null,this.showSuccessPopup("Compliance resubmitted for review successfully!","Resubmission Complete"),console.log(`Resubmitted compliance with ID ${e.ApprovalId}. New version: ${a.data.Version}`),setTimeout(()=>{this.refreshData()},1e3)}catch(a){console.error("Error resubmitting compliance:",a),this.showErrorPopup("Error resubmitting compliance: "+(a.response?.data?.message||a.message),"Resubmission Error")}finally{this.isLoading=!1}},formatDate(e){if(!e)return"";try{let a;if("string"===typeof e)if(e.includes("T"))a=new Date(e);else if(e.includes("-")){const t=e.split(" ")[0].split("-");a=new Date(t[0],t[1]-1,t[2])}else if(e.includes("/")){const t=e.split(" ")[0].split("/");a=new Date(t[2],t[0]-1,t[1])}else a=new Date(e);else a=new Date(e);return a.toLocaleString()}catch(a){return console.error("Error formatting date:",a),e}},async checkForApprovedIdentifiers(){if(0===this.rejectedCompliances.length)return;const e=this.rejectedCompliances.map(e=>e.Identifier);console.log("Checking rejected identifiers for approved status:",e),this.rejectedCompliances=this.rejectedCompliances.filter(e=>{const a=this.isCompliantIdentifierApproved(e.Identifier);return a&&console.log(`Found approved item with identifier ${e.Identifier}, removing from rejected list`),!a})},isCompliantIdentifierApproved(e){return this.approvals.some(a=>a.Identifier===e&&!0===a.ApprovedNot)},async loadRejectedCompliances(){try{this.isLoadingRejected=!0,console.log(`Loading rejected compliances for reviewer_id: ${this.userId}`);const e=await bt.fv.getComplianceRejectedApprovals(this.userId);if(console.log("Rejected compliances response:",e),e.data){let a=e.data.filter(e=>!1===e.ApprovedNot&&e.Identifier&&!e.ExtractedData?.compliance_approval?.inResubmission).sort((e,a)=>e.ApprovalId&&a.ApprovalId?a.ApprovalId-e.ApprovalId:0);console.log("Filtered rejected compliances:",a);const t=new Set;this.rejectedCompliances=a.filter(e=>{if(!t.has(e.Identifier)){t.add(e.Identifier);const a=this.approvals.some(a=>a.Identifier===e.Identifier&&!0===a.ApprovedNot);return!a}return!1}),console.log("Final rejected compliances list:",this.rejectedCompliances)}}catch(e){console.error("Error fetching rejected compliances:",e)}finally{this.isLoadingRejected=!1,this.updatePaginationCounts()}},mapApprovalToRow(e){return{...e,Identifier:e.Identifier,Description:e.ExtractedData?.ComplianceItemDescription||e.ExtractedData?.reason||"No Description",Criticality:e.ExtractedData?.Criticality||"N/A",CreatedBy:e.ExtractedData?.CreatedByName||"System",Version:e.ExtractedData?.ComplianceVersion||e.ExtractedData?.version||"1.0",actions:e}},mapRejectedToRow(e){return{...e,Identifier:e.Identifier,Description:e.ExtractedData?.ComplianceItemDescription||"No Description",Criticality:e.ExtractedData?.Criticality||"N/A",CreatedBy:e.ExtractedData?.CreatedByName||"System",Version:e.ExtractedData?.ComplianceVersion||e.ExtractedData?.version||"1.0",actions:e}},handleApprovalAction(e){this.selectedApproval=e,this.showDetailsModal=!0},handleRejectedAction(e){this.openRejectedItem(e)},toggleSection(e){this.collapsibleStates={...this.collapsibleStates,[e]:!this.collapsibleStates[e]}},handlePaginationChange(e,a){console.log(`Pagination change for section "${e}":`,{old:this.pagination[e],new:a}),this.pagination[e]=a,console.log(`Updated pagination for section "${e}":`,this.pagination[e])},getPaginatedTasks(e,a){const t=this.pagination[a],i=(t.currentPage-1)*t.pageSize,s=i+t.pageSize;return e.slice(i,s)},updatePaginationCounts(){const e=this.complianceApprovals.length,a=this.approvedComplianceItems.length,t=this.rejectedCompliances.length;this.pagination.Pending.totalCount=Math.max(e,1),this.pagination.Approved.totalCount=Math.max(a,1),this.pagination.Rejected.totalCount=Math.max(t,1),this.pagination["Recently Approved"].totalCount=Math.max(a,1),console.log("Updated pagination counts:",{Pending:this.pagination.Pending.totalCount,Approved:this.pagination.Approved.totalCount,Rejected:this.pagination.Rejected.totalCount,"Recently Approved":this.pagination["Recently Approved"].totalCount}),console.log("Current pagination state:",this.pagination)},resetPagination(){Object.keys(this.pagination).forEach(e=>{this.pagination[e].currentPage=1})},testPagination(){console.log("Testing pagination..."),console.log("Current pagination state:",this.pagination),console.log("Compliance approvals count:",this.complianceApprovals.length),console.log("Approved items count:",this.approvedComplianceItems.length),console.log("Rejected compliances count:",this.rejectedCompliances.length),this.updatePaginationCounts()},closeDetailsModal(){this.showDetailsModal=!1,this.selectedApproval=null},handleKeydown(e){"Escape"===e.key&&this.showDetailsModal&&this.closeDetailsModal()}},computed:{pendingApprovalsCount(){return this.counts.pending||0},approvedApprovalsCount(){return this.counts.approved||0},rejectedApprovalsCount(){return this.counts.rejected||0},complianceApprovals(){console.log("Computing complianceApprovals from",this.approvals.length,"total approvals"),console.log("All approvals:"),this.approvals.forEach((e,a)=>{if(!e)return void console.log(`[${a}] Approval is null or undefined`);if(console.log(`[${a}] ID: ${e.ApprovalId}, Identifier: ${e.Identifier}`),!e.ExtractedData)return void console.log("    WARNING: ExtractedData is null or undefined");console.log(`    Type: ${e.ExtractedData?.type}, RequestType: ${e.ExtractedData?.RequestType}`),console.log(`    ApprovedNot: ${e.ApprovedNot}`);const t="compliance_deactivation"===e.ExtractedData?.type||"Change Status to Inactive"===e.ExtractedData?.RequestType||e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE");console.log(`    Is deactivation request: ${t}`),t&&console.log("    Deactivation request details:",JSON.stringify({reason:e.ExtractedData?.reason,compliance_id:e.ExtractedData?.compliance_id,current_status:e.ExtractedData?.current_status,requested_status:e.ExtractedData?.requested_status}))});const e=this.approvals.filter(e=>{if(!e)return console.log("Skipping null approval"),!1;if(!e.ExtractedData)return console.log(`Approval ${e.ApprovalId||"unknown"}: ExtractedData is missing`),!1;const a="compliance"===e.ExtractedData?.type||"compliance_deactivation"===e.ExtractedData?.type||e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE"),t=null===e.ApprovedNot;return"compliance_deactivation"===e.ExtractedData?.type&&console.log(`Found deactivation by type: ${e.Identifier}`),"Change Status to Inactive"===e.ExtractedData?.RequestType&&console.log(`Found deactivation by RequestType: ${e.Identifier}`),e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE")&&console.log(`Found deactivation by Identifier: ${e.Identifier}`),console.log(`Approval ${e.ApprovalId}: isCompliance=${a}, isPending=${t}`),a&&t});console.log(`Filtered to ${e.length} pending compliance approvals`);const a=this.approvals.filter(e=>"compliance_deactivation"===e?.ExtractedData?.type||"Change Status to Inactive"===e?.ExtractedData?.RequestType||e?.Identifier&&e?.Identifier.includes("COMP-DEACTIVATE"));return a.length>0&&!e.some(e=>"compliance_deactivation"===e?.ExtractedData?.type||"Change Status to Inactive"===e?.ExtractedData?.RequestType||e?.Identifier&&e?.Identifier.includes("COMP-DEACTIVATE"))&&(console.warn("WARNING: Deactivation requests exist but none passed the filter!"),a.forEach(e=>{console.log(`Deactivation request ${e.ApprovalId} with ApprovedNot=${e.ApprovedNot}`),null!==e.ApprovedNot&&console.log(`This request was filtered because ApprovedNot=${e.ApprovedNot}`)})),e},approvalStatus(){return this.selectedApproval&&this.selectedApproval.ExtractedData?this.selectedApproval.ExtractedData.compliance_approval||{approved:null,remarks:""}:null},approvedComplianceItems(){console.log("Computing approvedComplianceItems from approvals:",this.approvals);const e=this.approvals.filter(e=>{const a=!0===e.ApprovedNot,t="compliance"===e.ExtractedData?.type;return a&&console.log(`Approval ${e.ApprovalId} is approved:`,{isCompliance:t,type:e.ExtractedData?.type,ApprovedNot:e.ApprovedNot}),a&&t});return console.log(`Found ${e.length} approved compliance items`),e},groupedApprovals(){const e={Pending:[],Approved:[],Rejected:[]};return this.approvals.forEach(a=>{null===a.ApprovedNot?e.Pending.push(a):!0===a.ApprovedNot?e.Approved.push(a):!1===a.ApprovedNot&&e.Rejected.push(a)}),e},approvalTableHeaders(){return[{key:"Identifier",label:"Identifier"},{key:"Description",label:"Description"},{key:"Criticality",label:"Criticality"},{key:"CreatedBy",label:"Created By"},{key:"Version",label:"Version"},{key:"actions",label:"Actions"}]},rejectedTableHeaders(){return[{key:"Identifier",label:"Identifier"},{key:"Description",label:"Description"},{key:"Criticality",label:"Criticality"},{key:"CreatedBy",label:"Created By"},{key:"Version",label:"Version"},{key:"actions",label:"Actions"}]}}};const D6=(0,se.A)(R6,[["render",w6],["__scopeId","data-v-4d673b73"]]);var I6=D6;const P6={class:"compliance-container"},_6={key:0,class:"compliance-loading-spinner"},S6={key:1,class:"breadcrumbs"},A6=["onClick"],T6={class:"compliance-content-wrapper"},x6={class:"compliance-card-grid"},F6=["onClick"],V6={class:"compliance-card-icon"},M6={class:"compliance-card-content"},X6={class:"compliance-card-title"},U6={class:"compliance-card-category"},N6={class:"compliance-card-desc"},$6={class:"compliance-version-info"},O6={class:"compliance-card-actions"},j6=["onClick"],B6={class:"compliance-section-header"},W6={class:"compliance-card-grid"},Q6=["onClick"],q6={class:"compliance-card-icon"},K6={class:"compliance-card-content"},J6={class:"compliance-card-title"},z6={class:"compliance-card-category"},H6={class:"compliance-card-desc"},Y6={class:"compliance-version-info"},G6={class:"compliance-card-actions"},Z6=["onClick"],e7={class:"compliance-section-header"},a7={class:"compliance-card-grid"},t7=["onClick"],i7={class:"compliance-card-icon"},s7={class:"compliance-card-content"},o7={class:"compliance-card-title"},l7={class:"compliance-card-category"},n7={class:"compliance-card-desc"},r7={class:"compliance-metadata"},c7={class:"compliance-card-actions"},d7=["onClick"],u7={class:"compliance-section-header"},p7={class:"compliance-section-actions"},v7={class:"compliance-inline-export-controls"},m7={key:0,class:"compliance-loading-spinner"},k7={key:1,class:"compliance-no-data"},h7={key:2,class:"compliance-grid"},g7=["onClick"],y7={class:"compliance-header"},f7={class:"compliance-body"},b7={class:"compliance-details"},C7={class:"compliance-detail-row"},L7={class:"compliance-value"},w7={class:"compliance-detail-row"},E7={class:"compliance-value"},R7={class:"compliance-detail-row"},D7={class:"compliance-value"},I7={key:0,class:"compliance-detail-row"},P7={key:0,class:"expanded-details"},_7={class:"expanded-details-grid"},S7={class:"expanded-section-box"},A7={class:"expanded-content-box"},T7={key:1,class:"empty-value"},x7={class:"expanded-section-box"},F7={class:"expanded-content-box"},V7={key:1,class:"empty-value"},M7={class:"expanded-section-box"},X7={class:"expanded-content-box"},U7={key:1,class:"empty-value"},N7={class:"expanded-section-box"},$7={class:"expanded-content-box"},O7={key:1,class:"empty-value"},j7={class:"expanded-section-box"},B7={class:"expanded-content-box"},W7={key:1,class:"empty-value"},Q7={class:"expanded-section-box"},q7={class:"expanded-content-box"},K7={class:"expanded-section-box"},J7={class:"expanded-content-box"},z7={class:"expanded-section-box"},H7={class:"expanded-content-box"},Y7={key:1,class:"empty-value"},G7={class:"expanded-section-box"},Z7={class:"expanded-content-box"},e9={key:1,class:"empty-value"},a9={class:"expanded-section-box"},t9={class:"expanded-content-box"},i9={key:1,class:"empty-value"},s9={class:"expanded-section-box"},o9={class:"expanded-content-box"},l9={key:0,class:"mitigation-text"},n9={key:1,class:"empty-value"},r9={class:"expanded-section-box"},c9={class:"expanded-content-box"},d9={key:1,class:"empty-value"},u9={class:"expanded-section-box"},p9={class:"expanded-content-box"},v9={key:1,class:"empty-value"},m9={class:"expanded-section-box"},k9={class:"expanded-content-box"},h9={key:1,class:"empty-value"},g9={class:"expanded-section-box"},y9={class:"expanded-content-box"},f9={key:1,class:"empty-value"},b9={class:"expanded-section-box"},C9={class:"expanded-content-box"},L9={key:1,class:"empty-value"},w9={class:"expanded-section-box"},E9={class:"expanded-content-box"},R9={class:"expanded-section-box"},D9={class:"expanded-content-box"},I9={class:"compliance-footer"},P9={class:"created-info"},_9={class:"identifier"},S9={key:3,class:"compliance-list-view"},A9={class:"compliance-dynamic-table-wrapper"},T9=["onClick"],x9=["onClick"],F9={key:2,class:"modal"},V9={class:"modal-content"},M9={class:"modal-header"},X9={class:"modal-body"},U9={key:0,class:"no-versions"},N9={key:1,class:"version-grid"},$9={class:"version-header"},O9={class:"version-number"},j9={class:"version-badges"},B9={class:"version-details"},W9={class:"version-desc"},Q9={class:"version-info-grid"},q9={class:"info-group"},K9={class:"info-value"},J9={class:"info-group"},z9={class:"info-value"},H9={class:"info-group"},Y9={key:0,class:"info-group"},G9={class:"version-metadata"};var Z9={__name:"AllCompliance",setup(e){const a=(0,ee.KR)([]),t=(0,ee.KR)(null),o=(0,ee.KR)(null),l=(0,ee.KR)(null),n=(0,ee.KR)(!1),r=(0,ee.KR)([]),c=(0,ee.KR)([]),u=(0,ee.KR)([]),p=(0,ee.KR)(!1),v=(0,ee.KR)(null),m=(0,ee.KR)(""),k=(0,ee.KR)("xlsx"),h=(0,ee.KR)("list"),g=(0,ee.KR)(null),y=(0,ae.rd)(),f=[{key:"identifier",label:"ID",sortable:!0},{key:"name",label:"Control",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"category",label:"Criticality",sortable:!0},{key:"maturityLevel",label:"Maturity Level",sortable:!0},{key:"mandatoryOptional",label:"Type",sortable:!0},{key:"version",label:"Version",sortable:!0},{key:"createdBy",label:"Created By",sortable:!0},{key:"createdDate",label:"Created Date",sortable:!0}],b=(0,s.EW)(()=>{const e=[];return t.value&&e.push({id:0,name:t.value.name}),o.value&&e.push({id:1,name:o.value.name}),l.value&&e.push({id:2,name:l.value.name}),e}),C=(0,s.EW)(()=>!t.value),L=(0,s.EW)(()=>t.value&&!o.value),w=(0,s.EW)(()=>o.value&&!l.value),E=(0,s.EW)(()=>l.value&&l.value.compliances&&l.value.compliances.length>0),R=(0,s.EW)(()=>l.value&&l.value.compliances?l.value.compliances:[]);async function D(e){try{p.value=!0,t.value=e,o.value=null,l.value=null;const a=await qe.A.get("/api/compliance/all-policies/policies/",{params:{framework_id:e.id}});a.data&&Array.isArray(a.data)?c.value=a.data.map(e=>({...e,versions:e.versions||[]})):c.value=[]}catch(a){if(a.response&&[401,403].includes(a.response.status))return void ht.Ay.showViewAllComplianceDenied();v.value="Failed to load policies",console.error("Error fetching policies:",a),c.value=[],pv.OQ.error("Failed to load policies. Please try selecting a different framework.","Loading Error")}finally{p.value=!1}}async function I(e){try{p.value=!0,o.value=e,l.value=null;const a=await qe.A.get("/api/compliance/all-policies/subpolicies/",{params:{policy_id:e.id}});a.data&&Array.isArray(a.data)?u.value=a.data:u.value=[]}catch(a){if(a.response&&[401,403].includes(a.response.status))return void ht.Ay.showViewAllComplianceDenied();v.value="Failed to load subpolicies",console.error("Error fetching subpolicies:",a),u.value=[],pv.OQ.error("Failed to load subpolicies. Please try selecting a different policy.","Loading Error")}finally{p.value=!1}}async function P(e){try{p.value=!0,l.value=e;const a=await qe.A.get(`/api/compliance/all-policies/subpolicies/${e.id}/compliances/`);if(console.log("Subpolicy compliances response:",a.data),a.data&&a.data.success){if(a.data.compliances.length>0){const e=a.data.compliances[0];console.log("DETAILED COMPLIANCE OBJECT:",JSON.stringify(e,null,2)),console.log("COMPLIANCE FIELD VALUES:"),Object.keys(e).forEach(a=>{console.log(`- ${a}: ${JSON.stringify(e[a])}`)})}l.value={...e,compliances:a.data.compliances.map(e=>({id:e.ComplianceId,name:e.ComplianceItemDescription,description:e.ComplianceItemDescription,status:e.Status,category:e.Criticality,maturityLevel:e.MaturityLevel,mandatoryOptional:e.MandatoryOptional,manualAutomatic:e.ManualAutomatic,createdBy:e.CreatedByName,createdDate:e.CreatedByDate,identifier:e.Identifier,version:e.ComplianceVersion,isRisk:e.IsRisk,PossibleDamage:e.PossibleDamage,mitigation:e.mitigation,SeverityRating:e.Impact,Probability:e.Probability,PermanentTemporary:e.PermanentTemporary,ActiveInactive:e.ActiveInactive,originalData:e}))}}else l.value.compliances=[]}catch(a){if(a.response&&[401,403].includes(a.response.status))return void ht.Ay.showViewAllComplianceDenied();console.error("Error fetching subpolicy compliances:",a),v.value="Failed to load compliances",l.value.compliances=[]}finally{p.value=!1}}function _(){n.value=!1,r.value=[],m.value=""}function S(e){e<=0?(t.value=null,o.value=null,l.value=null):1===e?(o.value=null,l.value=null):2===e&&(l.value=null)}function A(e){return e?new Date(e).toLocaleDateString():"N/A"}function T(e){switch((e||"").toLowerCase()){case"governance":return"fas fa-shield-alt";case"access control":return"fas fa-user-shield";case"asset management":return"fas fa-boxes";case"cryptography":return"fas fa-key";case"data management":return"fas fa-database";case"device management":return"fas fa-mobile-alt";case"risk management":return"fas fa-exclamation-triangle";case"supplier management":return"fas fa-handshake";case"business continuity":return"fas fa-business-time";case"privacy":return"fas fa-user-secret";case"system protection":return"fas fa-shield-virus";case"incident response":return"fas fa-ambulance";default:return"fas fa-file-alt"}}function x(e){if(!e)return"";const a=e.toLowerCase();return a.includes("active")?"active":a.includes("inactive")?"inactive":a.includes("pending")?"pending":""}(0,s.sV)(async()=>{try{p.value=!0,console.log("Fetching frameworks...");const e=await qe.A.get("/api/compliance/all-policies/frameworks/");console.log("Frameworks response:",e.data),e.data&&Array.isArray(e.data)?(a.value=e.data.map(e=>({id:e.id,name:e.name,category:e.category||"General",status:e.status||"Active",description:e.description||"",versions:e.versions||[]})),console.log("Processed frameworks:",a.value)):(console.error("Invalid frameworks response format:",e.data),a.value=[],v.value="Invalid response format from server")}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showViewAllComplianceDenied();v.value="Failed to load frameworks",console.error("Error fetching frameworks:",e.response?.data||e.message),a.value=[],pv.OQ.error("Failed to load frameworks. Please refresh the page and try again.","Loading Error")}finally{p.value=!1}});const F=(e,a,t)=>{y.push({name:"ComplianceView",params:{type:e,id:a,name:encodeURIComponent(t)}})};async function V(e){try{if(!l.value)return void pv.OQ.warning("No subpolicy selected for export","Export Warning");const a="subpolicy",t=l.value.SubPolicyId;pv.OQ.confirm(`Do you want to export ${l.value.name} controls to ${e.toUpperCase()} format?`,"Confirm Export",async()=>{console.log(`Attempting export for ${a} ${t} in ${e} format`),pv.OQ.success("Export is being processed. This may take a few moments...","Processing Export");try{const i=await(0,qe.A)({url:`/api/compliance/export/all-compliances/${e}/${a}/${t}/`,method:"GET",responseType:"blob",timeout:3e4,headers:{Accept:"application/json, application/pdf, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, application/xml"}}),s=i.headers["content-type"],o=new Blob([i.data],{type:s});let l=`compliances_${a}_${t}.${e}`;const n=i.headers["content-disposition"];n&&n.includes("filename=")&&(l=n.split("filename=")[1].replace(/"/g,""));const r=document.createElement("a");r.href=URL.createObjectURL(o),r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),pv.OQ.success(`Export completed successfully! File: ${l}`,"Export Complete")}catch(i){if(i.response&&[401,403].includes(i.response.status))return void ht.Ay.showViewAllComplianceDenied();console.error("Export error:",i);const e=i.response?.data?.message||i.message||"Failed to export compliances";pv.OQ.error(`Export failed: ${e}`,"Export Error")}},()=>{pv.OQ.success("Export cancelled","Cancelled")})}catch(v){console.error("Export error:",v);const a=v.response?.data?.message||v.message||"Failed to export compliances";pv.OQ.error(`Export failed: ${a}`,"Export Error")}}const M=()=>{h.value="card"===h.value?"list":"card"},X=e=>{g.value===e.id?g.value=null:g.value=e.id},U=e=>{if(!e)return"Not specified";if("string"===typeof e&&(e.startsWith("[")||e.startsWith("{")))try{const a=JSON.parse(e);return Array.isArray(a)?a.map((e,a)=>`${a+1}. ${e}`).join("\n"):"object"===typeof a?a.steps&&Array.isArray(a.steps)?a.steps.map((e,a)=>`${a+1}. ${e}`).join("\n"):a.description?a.description:Object.entries(a).map(([e,a])=>`${e}: ${a}`).join("\n"):String(a)}catch(a){return e}return e};function N(e){pv.OQ.info(`View compliance: ${e.name}`,"View Compliance")}function $(e){pv.OQ.info(`Edit compliance: ${e.name}`,"Edit Compliance")}return(e,v)=>((0,s.uX)(),(0,s.CE)("div",P6,[v[42]||(v[42]=(0,s.Lk)("div",{class:"custom-header"},[(0,s.Lk)("span",null,"Control Management"),(0,s.Lk)("div",{class:"custom-header-underline"})],-1)),p.value?((0,s.uX)(),(0,s.CE)("div",_6,v[2]||(v[2]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading...",-1)]))):(0,s.Q3)("",!0),b.value.length>0?((0,s.uX)(),(0,s.CE)("div",S6,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.value,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"breadcrumb-chip"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",{class:"breadcrumb-close",onClick:e=>S(a)},"Ã—",8,A6)]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",T6,[C.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[v[4]||(v[4]=(0,s.Lk)("div",{class:"compliance-section-header"},"Frameworks",-1)),(0,s.Lk)("div",x6,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(a.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>D(e)},[(0,s.Lk)("div",V6,[(0,s.Lk)("i",{class:(0,d.C4)(T(e.category))},null,2)]),(0,s.Lk)("div",M6,[(0,s.Lk)("div",X6,(0,d.v_)(e.name),1),(0,s.Lk)("div",U6,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",N6,(0,d.v_)(e.description),1),(0,s.Lk)("div",$6,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",O6,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,i.D$)(a=>F("framework",e.id,e.name),["stop"])},v[3]||(v[3]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Controls ")]),8,j6)])])],8,F6))),128))])],64)):L.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",B6,"Policies in "+(0,d.v_)(t.value.name),1),(0,s.Lk)("div",W6,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>I(e)},[(0,s.Lk)("div",q6,[(0,s.Lk)("i",{class:(0,d.C4)(T(e.category))},null,2)]),(0,s.Lk)("div",K6,[(0,s.Lk)("div",J6,(0,d.v_)(e.name),1),(0,s.Lk)("div",z6,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",H6,(0,d.v_)(e.description),1),(0,s.Lk)("div",Y6,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",G6,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,i.D$)(a=>F("policy",e.id,e.name),["stop"])},v[5]||(v[5]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Controls ")]),8,Z6)])])],8,Q6))),128))])],64)):w.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",e7,"Subpolicies in "+(0,d.v_)(o.value.name),1),(0,s.Lk)("div",a7,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(u.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>P(e)},[(0,s.Lk)("div",i7,[(0,s.Lk)("i",{class:(0,d.C4)(T(e.category))},null,2)]),(0,s.Lk)("div",s7,[(0,s.Lk)("div",o7,(0,d.v_)(e.name),1),(0,s.Lk)("div",l7,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",n7,(0,d.v_)(e.description),1),(0,s.Lk)("div",r7,[(0,s.Lk)("span",null,"Control: "+(0,d.v_)(e.control),1),(0,s.Lk)("span",null,(0,d.v_)(e.permanent_temporary),1)]),(0,s.Lk)("div",c7,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,i.D$)(a=>F("subpolicy",e.id,e.name),["stop"])},v[6]||(v[6]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Controls ")]),8,d7)])])],8,t7))),128))])],64)):l.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:3},[(0,s.Lk)("div",u7,[(0,s.Lk)("span",null,"Compliances in "+(0,d.v_)(l.value.name),1),(0,s.Lk)("div",p7,[(0,s.Lk)("div",v7,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":v[0]||(v[0]=e=>k.value=e),class:"compliance-format-select"},v[7]||(v[7]=[(0,s.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option>',5)]),512),[[i.u1,k.value]]),(0,s.Lk)("button",{class:"compliance-export-btn",onClick:v[1]||(v[1]=e=>V(k.value))},v[8]||(v[8]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")]))]),(0,s.Lk)("button",{class:"compliance-view-toggle-btn small-view-toggle",onClick:M},[(0,s.Lk)("i",{class:(0,d.C4)("card"===h.value?"fas fa-list":"fas fa-th-large")},null,2),(0,s.eW)(" "+(0,d.v_)("card"===h.value?"List View":"Card View"),1)])])]),p.value?((0,s.uX)(),(0,s.CE)("div",m7,v[9]||(v[9]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading controls...",-1)]))):E.value?"card"===h.value?((0,s.uX)(),(0,s.CE)("div",h7,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>X(e)},[(0,s.Lk)("div",y7,[(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality-badge","compliance-criticality-"+e.category.toLowerCase()])},(0,d.v_)(e.category),3)]),(0,s.Lk)("div",f7,[(0,s.Lk)("h3",null,(0,d.v_)(e.name),1),(0,s.Lk)("div",b7,[(0,s.Lk)("div",C7,[v[11]||(v[11]=(0,s.Lk)("span",{class:"compliance-label"},"Maturity Level:",-1)),(0,s.Lk)("span",L7,(0,d.v_)(e.maturityLevel),1)]),(0,s.Lk)("div",w7,[v[12]||(v[12]=(0,s.Lk)("span",{class:"compliance-label"},"Type:",-1)),(0,s.Lk)("span",E7,(0,d.v_)(e.mandatoryOptional)+" | "+(0,d.v_)(e.manualAutomatic),1)]),(0,s.Lk)("div",R7,[v[13]||(v[13]=(0,s.Lk)("span",{class:"compliance-label"},"Version:",-1)),(0,s.Lk)("span",D7,(0,d.v_)(e.version),1)]),e.isRisk?((0,s.uX)(),(0,s.CE)("div",I7,v[14]||(v[14]=[(0,s.Lk)("span",{class:"compliance-label"},"Risk Status:",-1),(0,s.Lk)("span",{class:"compliance-value compliance-risk"},"Risk Identified",-1)]))):(0,s.Q3)("",!0)]),g.value===e.id?((0,s.uX)(),(0,s.CE)("div",P7,[v[33]||(v[33]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Complete Control Details")],-1)),(0,s.Lk)("div",_7,[(0,s.Lk)("div",S7,[v[15]||(v[15]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("div",A7,[e.description?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.description),1)],64)):((0,s.uX)(),(0,s.CE)("span",T7,"No description available"))])]),(0,s.Lk)("div",x7,[v[16]||(v[16]=(0,s.Lk)("h5",null,"Control Title",-1)),(0,s.Lk)("div",F7,[e.title?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.title),1)],64)):((0,s.uX)(),(0,s.CE)("span",V7,"Not specified"))])]),(0,s.Lk)("div",M7,[v[17]||(v[17]=(0,s.Lk)("h5",null,"Scope",-1)),(0,s.Lk)("div",X7,[e.scope?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.scope),1)],64)):((0,s.uX)(),(0,s.CE)("span",U7,"Not specified"))])]),(0,s.Lk)("div",N7,[v[18]||(v[18]=(0,s.Lk)("h5",null,"Objective",-1)),(0,s.Lk)("div",$7,[e.objective?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.objective),1)],64)):((0,s.uX)(),(0,s.CE)("span",O7,"Not specified"))])]),(0,s.Lk)("div",j7,[v[19]||(v[19]=(0,s.Lk)("h5",null,"Control Type",-1)),(0,s.Lk)("div",B7,[e.complianceType?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.complianceType),1)],64)):((0,s.uX)(),(0,s.CE)("span",W7,"Not specified"))])]),(0,s.Lk)("div",Q7,[v[20]||(v[20]=(0,s.Lk)("h5",null,"Implementation Type",-1)),(0,s.Lk)("div",q7,(0,d.v_)(e.manualAutomatic||"Not specified"),1)]),(0,s.Lk)("div",K7,[v[21]||(v[21]=(0,s.Lk)("h5",null,"Requirement Level",-1)),(0,s.Lk)("div",J7,(0,d.v_)(e.mandatoryOptional||"Not specified"),1)]),(0,s.Lk)("div",z7,[v[22]||(v[22]=(0,s.Lk)("h5",null,"Duration",-1)),(0,s.Lk)("div",H7,[e.permanentTemporary?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.permanentTemporary),1)],64)):((0,s.uX)(),(0,s.CE)("span",Y7,"Not specified"))])]),(0,s.Lk)("div",G7,[v[23]||(v[23]=(0,s.Lk)("h5",null,"Risk Status",-1)),(0,s.Lk)("div",Z7,[void 0!==e.isRisk?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)(e.isRisk?"risk-identified":"no-risk")},(0,d.v_)(e.isRisk?"Risk Identified":"No Risk"),3)):((0,s.uX)(),(0,s.CE)("span",e9,"Not specified"))])]),(0,s.Lk)("div",a9,[v[24]||(v[24]=(0,s.Lk)("h5",null,"Possible Damage",-1)),(0,s.Lk)("div",t9,[e.possibleDamage?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.possibleDamage),1)],64)):((0,s.uX)(),(0,s.CE)("span",i9,"Not specified"))])]),(0,s.Lk)("div",s9,[v[25]||(v[25]=(0,s.Lk)("h5",null,"Mitigation Strategy",-1)),(0,s.Lk)("div",o9,[e.mitigation?((0,s.uX)(),(0,s.CE)("pre",l9,(0,d.v_)(U(e.mitigation)),1)):((0,s.uX)(),(0,s.CE)("span",n9,"Not specified"))])]),(0,s.Lk)("div",r9,[v[26]||(v[26]=(0,s.Lk)("h5",null,"Severity Rating",-1)),(0,s.Lk)("div",c9,[e.impact?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)("severity-"+e.impact.toLowerCase())},(0,d.v_)(e.impact),3)):((0,s.uX)(),(0,s.CE)("span",d9,"Not specified"))])]),(0,s.Lk)("div",u9,[v[27]||(v[27]=(0,s.Lk)("h5",null,"Probability",-1)),(0,s.Lk)("div",p9,[e.probability?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.probability),1)],64)):((0,s.uX)(),(0,s.CE)("span",v9,"Not specified"))])]),(0,s.Lk)("div",m9,[v[28]||(v[28]=(0,s.Lk)("h5",null,"Applicability",-1)),(0,s.Lk)("div",k9,[e.applicability?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.applicability),1)],64)):((0,s.uX)(),(0,s.CE)("span",h9,"Not specified"))])]),(0,s.Lk)("div",g9,[v[29]||(v[29]=(0,s.Lk)("h5",null,"Business Units Covered",-1)),(0,s.Lk)("div",y9,[e.businessUnitsCovered?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.businessUnitsCovered),1)],64)):((0,s.uX)(),(0,s.CE)("span",f9,"Not specified"))])]),(0,s.Lk)("div",b9,[v[30]||(v[30]=(0,s.Lk)("h5",null,"Risk Scenarios",-1)),(0,s.Lk)("div",C9,[e.potentialRiskScenarios?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.potentialRiskScenarios),1)],64)):((0,s.uX)(),(0,s.CE)("span",L9,"Not specified"))])]),(0,s.Lk)("div",w9,[v[31]||(v[31]=(0,s.Lk)("h5",null,"Control Status",-1)),(0,s.Lk)("div",E9,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",e.status?.toLowerCase()])},(0,d.v_)(e.status||"Not specified"),3)])]),(0,s.Lk)("div",R9,[v[32]||(v[32]=(0,s.Lk)("h5",null,"Active Status",-1)),(0,s.Lk)("div",D9,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",e.activeInactive?.toLowerCase()])},(0,d.v_)(e.activeInactive||"Not specified"),3)])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",I9,[(0,s.Lk)("div",P9,[(0,s.Lk)("span",null,"Created by "+(0,d.v_)(e.createdBy),1),(0,s.Lk)("span",null,(0,d.v_)(A(e.createdDate)),1)]),(0,s.Lk)("div",_9,"ID: "+(0,d.v_)(e.identifier),1)])])],8,g7))),128))])):((0,s.uX)(),(0,s.CE)("div",S9,[(0,s.Lk)("div",A9,[(0,s.bF)(Ll.A,{data:R.value,columns:f,uniqueKey:"id",showPagination:!0,showActions:!0},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"compliance-action-btn",onClick:a=>N(e)},v[34]||(v[34]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,T9),(0,s.Lk)("button",{class:"compliance-action-btn",onClick:a=>$(e)},v[35]||(v[35]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,x9)]),_:1},8,["data"])])])):((0,s.uX)(),(0,s.CE)("div",k7,v[10]||(v[10]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No controls found for this subpolicy",-1)])))],64)):(0,s.Q3)("",!0)]),n.value?((0,s.uX)(),(0,s.CE)("div",F9,[(0,s.Lk)("div",V9,[(0,s.Lk)("div",M9,[(0,s.Lk)("h3",null,(0,d.v_)(m.value),1),(0,s.Lk)("button",{class:"close-btn",onClick:_},"Ã—")]),(0,s.Lk)("div",X9,[0===r.value.length?((0,s.uX)(),(0,s.CE)("div",U9," No versions found. ")):((0,s.uX)(),(0,s.CE)("div",N9,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"version-card"},[(0,s.Lk)("div",$9,[(0,s.Lk)("span",O9,"Version "+(0,d.v_)(e.version),1),(0,s.Lk)("div",j9,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",x(e.activeInactive)])},(0,d.v_)(e.activeInactive),3)])]),(0,s.Lk)("div",B9,[(0,s.Lk)("p",W9,(0,d.v_)(e.description),1),(0,s.Lk)("div",Q9,[(0,s.Lk)("div",q9,[v[36]||(v[36]=(0,s.Lk)("span",{class:"info-label"},"Maturity Level:",-1)),(0,s.Lk)("span",K9,(0,d.v_)(e.maturityLevel),1)]),(0,s.Lk)("div",J9,[v[37]||(v[37]=(0,s.Lk)("span",{class:"info-label"},"Type:",-1)),(0,s.Lk)("span",z9,(0,d.v_)(e.mandatoryOptional)+" | "+(0,d.v_)(e.manualAutomatic),1)]),(0,s.Lk)("div",H9,[v[38]||(v[38]=(0,s.Lk)("span",{class:"info-label"},"Criticality:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["info-value","criticality-"+e.criticality.toLowerCase()])},(0,d.v_)(e.criticality),3)]),e.isRisk?((0,s.uX)(),(0,s.CE)("div",Y9,v[39]||(v[39]=[(0,s.Lk)("span",{class:"info-label"},"Risk Status:",-1),(0,s.Lk)("span",{class:"info-value risk"},"Risk Identified",-1)]))):(0,s.Q3)("",!0)]),(0,s.Lk)("div",G9,[(0,s.Lk)("span",null,[v[40]||(v[40]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.createdBy),1)]),(0,s.Lk)("span",null,[v[41]||(v[41]=(0,s.Lk)("i",{class:"fas fa-calendar"},null,-1)),(0,s.eW)(" "+(0,d.v_)(A(e.createdDate)),1)])])])]))),128))]))])])])):(0,s.Q3)("",!0)]))}};const eee=Z9;var aee=eee;const tee={class:"compliance-all-compliances-container"},iee={key:0,class:"compliance-error-message"},see={key:1,class:"compliance-loading-spinner"},oee={key:2,class:"compliance-breadcrumbs"},lee=["onClick"],nee={class:"compliance-content-wrapper"},ree={class:"compliance-card-grid"},cee=["onClick"],dee={class:"compliance-card-icon"},uee={class:"compliance-card-content"},pee={class:"compliance-card-title"},vee={class:"compliance-card-category"},mee={class:"compliance-card-desc"},kee={class:"compliance-version-info"},hee={class:"compliance-card-actions"},gee=["onClick"],yee={class:"compliance-section-header"},fee={class:"compliance-card-grid"},bee=["onClick"],Cee={class:"compliance-card-icon"},Lee={class:"compliance-card-content"},wee={class:"compliance-card-title"},Eee={class:"compliance-card-category"},Ree={class:"compliance-card-desc"},Dee={class:"compliance-version-info"},Iee={class:"compliance-card-actions"},Pee=["onClick"],_ee={class:"compliance-section-header"},See={class:"compliance-card-grid"},Aee=["onClick"],Tee={class:"compliance-card-icon"},xee={class:"compliance-card-content"},Fee={class:"compliance-card-title"},Vee={class:"compliance-card-category"},Mee={class:"compliance-card-desc"},Xee={class:"compliance-metadata"},Uee={class:"compliance-card-actions"},Nee=["onClick"],$ee={class:"compliance-section-header"},Oee={class:"compliance-section-actions compliance-section-actions-right"},jee={class:"compliance-inline-export-controls"},Bee={key:0,class:"compliance-loading-spinner"},Wee={key:1,class:"compliance-no-data"},Qee={key:2,class:"compliance-no-data"},qee={key:3,class:"compliance-card-grid"},Kee={class:"compliance-header"},Jee={class:"compliance-body"},zee={class:"compliance-clean-details-grid"},Hee={key:0,class:"compliance-fetch-audit-actions"},Yee=["onClick"],Gee={class:"compliance-detail-row"},Zee={class:"compliance-detail-value"},eae={class:"compliance-detail-row"},aae={class:"compliance-detail-value"},tae={class:"compliance-detail-row"},iae={class:"compliance-detail-value"},sae={class:"compliance-detail-row"},oae={class:"compliance-footer"},lae={class:"compliance-identifier"},nae={key:4},rae={key:3,class:"compliance-modal"},cae={class:"compliance-modal-content"},dae={class:"compliance-modal-header"},uae={class:"compliance-modal-body"},pae={key:0,class:"compliance-no-versions"},vae={key:1,class:"compliance-version-grid"},mae={class:"compliance-version-header"},kae={class:"compliance-version-number"},hae={class:"compliance-version-badges"},gae={class:"compliance-version-details"},yae={class:"compliance-version-desc"},fae={class:"compliance-version-info-grid"},bae={class:"compliance-info-group"},Cae={class:"compliance-info-value"},Lae={class:"compliance-info-group"},wae={class:"compliance-info-value"},Eae={class:"compliance-info-group"},Rae={key:0,class:"compliance-info-group"},Dae={class:"compliance-version-metadata"};function Iae(e,a,t,o,l,n){const r=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",tee,[a[26]||(a[26]=(0,s.Lk)("div",{class:"compliance-custom-header"},[(0,s.Lk)("span",null,"Compliance Audit Status"),(0,s.Lk)("div",{class:"compliance-custom-header-underline"})],-1)),o.error?((0,s.uX)(),(0,s.CE)("div",iee,[a[4]||(a[4]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(o.error),1)])):(0,s.Q3)("",!0),o.loading?((0,s.uX)(),(0,s.CE)("div",see,a[5]||(a[5]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading...",-1)]))):(0,s.Q3)("",!0),o.breadcrumbs.length>0?((0,s.uX)(),(0,s.CE)("div",oee,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.breadcrumbs,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-breadcrumb-chip"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",{class:"compliance-breadcrumb-close",onClick:e=>o.goToStep(a)},"Ã—",8,lee)]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",nee,[o.showFrameworks?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[a[7]||(a[7]=(0,s.Lk)("div",{class:"compliance-section-header"},"Frameworks",-1)),(0,s.Lk)("div",ree,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.frameworks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>o.selectFramework(e)},[(0,s.Lk)("div",dee,[(0,s.Lk)("i",{class:(0,d.C4)(o.categoryIcon(e.category))},null,2)]),(0,s.Lk)("div",uee,[(0,s.Lk)("div",pee,(0,d.v_)(e.name),1),(0,s.Lk)("div",vee,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",mee,(0,d.v_)(e.description),1),(0,s.Lk)("div",kee,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",hee,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,i.D$)(a=>o.viewAllCompliances("framework",e.id,e.name),["stop"])},a[6]||(a[6]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Compliances ")]),8,gee)])])],8,cee))),128))])],64)):o.showPolicies?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",yee,"Policies in "+(0,d.v_)(o.selectedFramework.name),1),(0,s.Lk)("div",fee,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>o.selectPolicy(e)},[(0,s.Lk)("div",Cee,[(0,s.Lk)("i",{class:(0,d.C4)(o.categoryIcon(e.category))},null,2)]),(0,s.Lk)("div",Lee,[(0,s.Lk)("div",wee,(0,d.v_)(e.name),1),(0,s.Lk)("div",Eee,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",Ree,(0,d.v_)(e.description),1),(0,s.Lk)("div",Dee,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",Iee,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,i.D$)(a=>o.viewAllCompliances("policy",e.id,e.name),["stop"])},a[8]||(a[8]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Compliances ")]),8,Pee)])])],8,bee))),128))])],64)):o.showSubpolicies?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",_ee,"Subpolicies in "+(0,d.v_)(o.selectedPolicy.name),1),(0,s.Lk)("div",See,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.subpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:a=>o.selectSubpolicy(e)},[(0,s.Lk)("div",Tee,[(0,s.Lk)("i",{class:(0,d.C4)(o.categoryIcon(e.category))},null,2)]),(0,s.Lk)("div",xee,[(0,s.Lk)("div",Fee,(0,d.v_)(e.name),1),(0,s.Lk)("div",Vee,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",Mee,(0,d.v_)(e.description),1),(0,s.Lk)("div",Xee,[(0,s.Lk)("span",null,"Control: "+(0,d.v_)(e.control),1),(0,s.Lk)("span",null,(0,d.v_)(e.permanent_temporary),1)]),(0,s.Lk)("div",Uee,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,i.D$)(a=>o.viewAllCompliances("subpolicy",e.id,e.name),["stop"])},a[9]||(a[9]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Compliances ")]),8,Nee)])])],8,Aee))),128))])],64)):o.selectedSubpolicy?((0,s.uX)(),(0,s.CE)(s.FK,{key:3},[(0,s.Lk)("div",$ee,[(0,s.Lk)("span",null,"Compliances in "+(0,d.v_)(o.selectedSubpolicy.name),1),(0,s.Lk)("div",Oee,[(0,s.Lk)("div",jee,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.selectedFormat=e),class:"compliance-format-select"},a[10]||(a[10]=[(0,s.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option>',5)]),512),[[i.u1,o.selectedFormat]]),(0,s.Lk)("button",{class:"compliance-export-btn",onClick:a[1]||(a[1]=e=>o.handleExport(o.selectedFormat))},a[11]||(a[11]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")]))]),(0,s.Lk)("button",{class:"compliance-view-toggle-btn",onClick:a[2]||(a[2]=(...e)=>o.toggleViewMode&&o.toggleViewMode(...e))},[(0,s.Lk)("i",{class:(0,d.C4)("card"===o.viewMode?"fas fa-list":"fas fa-th-large")},null,2),(0,s.eW)(" "+(0,d.v_)("card"===o.viewMode?"List View":"Card View"),1)])])]),o.loading?((0,s.uX)(),(0,s.CE)("div",Bee,a[12]||(a[12]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading compliances...",-1)]))):o.hasCompliances?0===o.filteredCompliances.length?((0,s.uX)(),(0,s.CE)("div",Qee,a[14]||(a[14]=[(0,s.Lk)("i",{class:"fas fa-filter"},null,-1),(0,s.Lk)("p",null,"No approved compliances found for this subpolicy",-1)]))):"card"===o.viewMode?((0,s.uX)(),(0,s.CE)("div",qee,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card"},[(0,s.Lk)("div",Kee,[(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality-badge","compliance-criticality-"+e.category.toLowerCase()])},(0,d.v_)(e.category),3)]),(0,s.Lk)("div",Jee,[(0,s.Lk)("h3",null,(0,d.v_)(e.name),1),(0,s.Lk)("div",zee,[o.complianceAudits[e.id]?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Hee,[(0,s.Lk)("button",{class:"compliance-fetch-audit-btn",onClick:a=>o.fetchAuditInfo(e.id)},a[15]||(a[15]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1),(0,s.eW)(" Load Compliance Information ")]),8,Yee)])),(0,s.Lk)("div",Gee,[a[16]||(a[16]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Compliance Performed By:",-1)),(0,s.Lk)("span",Zee,(0,d.v_)(o.complianceAudits[e.id]?.audit_performer_name||"N/A"),1)]),(0,s.Lk)("div",eae,[a[17]||(a[17]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Compliance Approved By:",-1)),(0,s.Lk)("span",aae,(0,d.v_)(o.complianceAudits[e.id]?.audit_approver_name||"N/A"),1)]),(0,s.Lk)("div",tae,[a[18]||(a[18]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Completion Date:",-1)),(0,s.Lk)("span",iae,(0,d.v_)(o.complianceAudits[e.id]?.audit_date||"N/A"),1)]),(0,s.Lk)("div",sae,[a[19]||(a[19]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Completion Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-detail-value",o.getAuditStatusClass(o.complianceAudits[e.id]?.audit_findings_status)])},[(0,s.Lk)("i",{class:(0,d.C4)(o.getAuditStatusIcon(o.complianceAudits[e.id]?.audit_findings_status))},null,2),(0,s.eW)(" "+(0,d.v_)(o.formatAuditStatus(o.complianceAudits[e.id]?.audit_findings_status)),1)],2)])]),(0,s.Lk)("div",oae,[(0,s.Lk)("div",lae,"ID: "+(0,d.v_)(e.identifier),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",nae,[(0,s.bF)(r,{data:o.complianceTableData,columns:o.complianceTableColumns,"show-pagination":!0,"show-actions":!1,"unique-key":"id"},null,8,["data","columns"])])):((0,s.uX)(),(0,s.CE)("div",Wee,a[13]||(a[13]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No compliances found for this subpolicy",-1)])))],64)):(0,s.Q3)("",!0)]),o.showVersionsModal?((0,s.uX)(),(0,s.CE)("div",rae,[(0,s.Lk)("div",cae,[(0,s.Lk)("div",dae,[(0,s.Lk)("h3",null,(0,d.v_)(o.versionModalTitle),1),(0,s.Lk)("button",{class:"compliance-close-btn",onClick:a[3]||(a[3]=(...e)=>o.closeVersionsModal&&o.closeVersionsModal(...e))},"Ã—")]),(0,s.Lk)("div",uae,[0===o.versions.length?((0,s.uX)(),(0,s.CE)("div",pae," No versions found. ")):((0,s.uX)(),(0,s.CE)("div",vae,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-version-card"},[(0,s.Lk)("div",mae,[(0,s.Lk)("span",kae,"Version "+(0,d.v_)(e.version),1),(0,s.Lk)("div",hae,[(0,s.Lk)("span",{class:(0,d.C4)(["compliance-status-badge",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-status-badge",o.statusClass(e.activeInactive)])},(0,d.v_)(e.activeInactive),3)])]),(0,s.Lk)("div",gae,[(0,s.Lk)("p",yae,(0,d.v_)(e.description),1),(0,s.Lk)("div",fae,[(0,s.Lk)("div",bae,[a[20]||(a[20]=(0,s.Lk)("span",{class:"compliance-info-label"},"Maturity Level:",-1)),(0,s.Lk)("span",Cae,(0,d.v_)(e.maturityLevel),1)]),(0,s.Lk)("div",Lae,[a[21]||(a[21]=(0,s.Lk)("span",{class:"compliance-info-label"},"Type:",-1)),(0,s.Lk)("span",wae,(0,d.v_)(e.mandatoryOptional)+" | "+(0,d.v_)(e.manualAutomatic),1)]),(0,s.Lk)("div",Eae,[a[22]||(a[22]=(0,s.Lk)("span",{class:"compliance-info-label"},"Criticality:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-info-value","compliance-criticality-"+e.criticality.toLowerCase()])},(0,d.v_)(e.criticality),3)]),e.isRisk?((0,s.uX)(),(0,s.CE)("div",Rae,a[23]||(a[23]=[(0,s.Lk)("span",{class:"compliance-info-label"},"Risk Status:",-1),(0,s.Lk)("span",{class:"compliance-info-value risk"},"Risk Identified",-1)]))):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Dae,[(0,s.Lk)("span",null,[a[24]||(a[24]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.createdBy),1)]),(0,s.Lk)("span",null,[a[25]||(a[25]=(0,s.Lk)("i",{class:"fas fa-calendar"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.formatDate(e.createdDate)),1)])])])]))),128))]))])])])):(0,s.Q3)("",!0)])}var Pae=t(1219),_ae={name:"ComplianceManagement",components:{DynamicTable:Ll.A},setup(){const e=(0,ee.KR)([]),a=(0,ee.KR)(null),t=(0,ee.KR)(null),i=(0,ee.KR)(null),o=(0,ee.KR)(!1),l=(0,ee.KR)([]),n=(0,ee.KR)([]),r=(0,ee.KR)([]),c=(0,ee.KR)(!1),d=(0,ee.KR)(null),u=(0,ee.KR)(""),p=(0,ee.KR)("xlsx"),v=(0,ee.KR)(!1),m=(0,ee.KR)(null),k=(0,ee.KR)({}),h=(0,ee.KR)("list"),g=(0,ae.rd)(),y=[{key:"audit_findings_id",label:"Audit Findings ID",sortable:!0},{key:"name",label:"Compliance",sortable:!0},{key:"category",label:"Criticality",sortable:!0},{key:"audit_findings_status",label:"Completion Status",sortable:!0},{key:"audit_performer_name",label:"Compliance Performed By",sortable:!0},{key:"audit_approver_name",label:"Compliance Approved By",sortable:!0},{key:"audit_date",label:"Completion Date",sortable:!0}],f=(0,s.EW)(()=>i.value&&i.value.compliances?X.value.map(e=>{const a=k.value[e.id]||{};return{audit_findings_id:a.audit_findings_id||"N/A",name:e.name,category:e.category,audit_findings_status:a.audit_findings_status||"Not Audited",audit_performer_name:a.audit_performer_name||"N/A",audit_approver_name:a.audit_approver_name||"N/A",audit_date:a.audit_date||"N/A",id:e.id}}):[]),b=(0,s.EW)(()=>{const e=[];return a.value&&e.push({id:0,name:a.value.name}),t.value&&e.push({id:1,name:t.value.name}),i.value&&e.push({id:2,name:i.value.name}),e}),C=(0,s.EW)(()=>!a.value),L=(0,s.EW)(()=>a.value&&!t.value),w=(0,s.EW)(()=>t.value&&!i.value),E=(0,s.EW)(()=>i.value&&i.value.compliances&&i.value.compliances.length>0);async function R(e){try{c.value=!0,a.value=e,t.value=null,i.value=null;const s=await qe.A.get("/api/compliance/all-policies/policies/",{params:{framework_id:e.id}});s.data&&Array.isArray(s.data)?n.value=s.data.map(e=>({...e,versions:e.versions||[]})):n.value=[]}catch(s){d.value="Failed to load policies",console.error("Error fetching policies:",s),n.value=[]}finally{c.value=!1}}async function D(e){try{c.value=!0,t.value=e,i.value=null;const a=await qe.A.get("/api/compliance/all-policies/subpolicies/",{params:{policy_id:e.id}});a.data&&Array.isArray(a.data)?r.value=a.data:r.value=[]}catch(a){d.value="Failed to load subpolicies",console.error("Error fetching subpolicies:",a),r.value=[]}finally{c.value=!1}}async function I(e){try{c.value=!0,i.value=e,k.value={},console.log(`Selecting subpolicy: ${e.id} - ${e.name}`);const t=await qe.A.get(`/api/compliance/all-policies/subpolicies/${e.id}/compliances/`);if(console.log("Subpolicy compliances response:",t.data),t.data&&t.data.success){const s=t.data.compliances.map(e=>({id:e.ComplianceId,name:e.ComplianceItemDescription,status:e.Status,description:e.ComplianceItemDescription,category:e.Criticality,maturityLevel:e.MaturityLevel,mandatoryOptional:e.MandatoryOptional,manualAutomatic:e.ManualAutomatic,createdBy:e.CreatedByName,createdDate:e.CreatedByDate,isRisk:e.IsRisk,activeInactive:e.ActiveInactive,identifier:e.Identifier,version:e.ComplianceVersion}));if(i.value={...e,compliances:s},console.log(`Found ${s.length} compliances for subpolicy ${e.id}`),s.length>0){for(const e of s)try{await U(e.id),await new Promise(e=>setTimeout(e,100))}catch(a){console.error(`Error fetching audit info for compliance ${e.id}:`,a)}console.log("All audit information fetched:",k.value)}}else i.value={...e,compliances:[]},console.log("No compliances found or API returned error")}catch(t){console.error("Error fetching subpolicy compliances:",t),d.value="Failed to load compliances",i.value={...e,compliances:[]}}finally{c.value=!1}}async function P(e,a){try{c.value=!0;let t="";switch(e){case"policy":u.value=`Versions of ${a.name}`,t=`/api/compliance/all-policies/policies/${a.id}/versions/`;break;case"compliance":u.value=`Versions of Compliance ${a.name}`,t=`/api/compliance/all-policies/compliances/${a.id}/versions/`;break}const i=await qe.A.get(t);i.data&&Array.isArray(i.data)?l.value=i.data.map(e=>({id:e.ComplianceId,version:e.ComplianceVersion,name:e.ComplianceItemDescription,status:e.Status,description:e.ComplianceItemDescription,criticality:e.Criticality,maturityLevel:e.MaturityLevel,mandatoryOptional:e.MandatoryOptional,manualAutomatic:e.ManualAutomatic,createdBy:e.CreatedByName,createdDate:e.CreatedByDate,isRisk:e.IsRisk,activeInactive:e.ActiveInactive,identifier:e.Identifier})):l.value=[],o.value=!0}catch(t){d.value=`Failed to load ${e} versions`,console.error(`Error fetching ${e} versions:`,t),l.value=[]}finally{c.value=!1}}function _(){o.value=!1,l.value=[],u.value=""}function S(e){e<=0?(a.value=null,t.value=null,i.value=null):1===e?(t.value=null,i.value=null):2===e&&(i.value=null)}function A(e){return e?new Date(e).toLocaleDateString():"N/A"}function T(e){switch((e||"").toLowerCase()){case"governance":return"fas fa-shield-alt";case"access control":return"fas fa-user-shield";case"asset management":return"fas fa-boxes";case"cryptography":return"fas fa-key";case"data management":return"fas fa-database";case"device management":return"fas fa-mobile-alt";case"risk management":return"fas fa-exclamation-triangle";case"supplier management":return"fas fa-handshake";case"business continuity":return"fas fa-business-time";case"privacy":return"fas fa-user-secret";case"system protection":return"fas fa-shield-virus";case"incident response":return"fas fa-ambulance";default:return"fas fa-file-alt"}}function x(e){if(!e)return"";const a=e.toLowerCase();return a.includes("active")?"active":a.includes("inactive")?"inactive":a.includes("pending")?"pending":""}(0,s.sV)(async()=>{try{c.value=!0;const a=await qe.A.get("/api/compliance/all-policies/frameworks/");a.data&&Array.isArray(a.data)?e.value=a.data.map(e=>({...e,versions:e.versions||[]})):e.value=[]}catch(a){d.value="Failed to load frameworks",console.error("Error fetching frameworks:",a),e.value=[]}finally{c.value=!1}});const F=async(e,a,t)=>{try{g.push({name:"ComplianceAuditView",params:{type:e,id:a,name:encodeURIComponent(t)}})}catch(d){console.error("Error navigating to audit view:",d),d.value="Failed to navigate to audit view. Please try again."}};async function V(e){try{v.value=!0,m.value=null;let s="",o=null;if(i.value)s="subpolicy",o=i.value.id;else if(t.value)s="policy",o=t.value.id;else{if(!a.value)throw new Error("No item selected for export");s="framework",o=a.value.id}console.log(`Attempting export for ${s} ${o} in ${e} format`);const l=await(0,qe.A)({url:`/api/compliance/export/all-compliances/${e}/${s}/${o}/`,method:"GET",responseType:"blob",timeout:3e4,headers:{Accept:"application/json, application/pdf, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, application/xml"}}),n=l.headers["content-type"],r=new Blob([l.data],{type:n});let c=`compliances_${s}_${o}.${e}`;const d=l.headers["content-disposition"];d&&d.includes("filename=")&&(c=d.split("filename=")[1].replace(/"/g,""));const u=document.createElement("a");u.href=URL.createObjectURL(r),u.download=c,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(u.href),(0,Pae.nk)({message:"Export completed successfully",type:"success",duration:3e3})}catch(d){console.error("Export error:",d);const a=d.response?.data?.message||d.message||"Failed to export compliances";m.value=a,(0,Pae.nk)({message:a,type:"error",duration:5e3})}finally{v.value=!1}}const M=()=>{h.value="card"===h.value?"list":"card"},X=(0,s.EW)(()=>i.value&&i.value.compliances?i.value.compliances.filter(e=>"Approved"===e.status):[]);async function U(e){try{if(console.log(`Fetching audit info for compliance ID: ${e}`),k.value[e]&&"Not Audited"!==k.value[e].audit_findings_status)return void console.log(`Using cached audit data for compliance ID: ${e}`);k.value={...k.value,[e]:{audit_findings_status:"Loading...",isLoading:!0}};const a=await qe.A.get(`/api/compliance/compliance/${e}/audit-info/`);if(console.log(`Audit info response for compliance ID ${e}:`,a.data),!a.data||!a.data.success)throw new Error(a.data.message||"Failed to fetch audit data");k.value={...k.value,[e]:{...a.data.data,isLoading:!1}},console.log(`Updated audit data for compliance ID ${e}:`,k.value[e])}catch(a){console.error(`Error fetching audit info for compliance ${e}:`,a),k.value={...k.value,[e]:{audit_findings_status:"Not Audited",isLoading:!1,error:a.message}}}}function N(e){if(!e)return"not-audited";const a=e.toLowerCase();return a.includes("non")||a.includes("not compliant")?"non-compliant":a.includes("partially")?"partially-compliant":a.includes("fully")?"fully-compliant":a.includes("not applicable")?"not-applicable":"not-audited"}function $(e){if(!e)return"fas fa-question-circle";const a=e.toLowerCase();return a.includes("non")||a.includes("not compliant")?"fas fa-times-circle":a.includes("partially")?"fas fa-exclamation-circle":a.includes("fully")?"fas fa-check-circle":a.includes("not applicable")?"fas fa-ban":"fas fa-question-circle"}function O(e){if(!e)return"Not Audited";const a=e.toLowerCase();return a.includes("non")||a.includes("not compliant")?"Non Conformity":a.includes("partially")?"Control Gap":e}const j=e=>{e&&console.log(`Clicked on audit findings ID: ${e}`)};return{frameworks:e,selectedFramework:a,selectedPolicy:t,selectedSubpolicy:i,showVersionsModal:o,versions:l,policies:n,subpolicies:r,loading:c,error:d,versionModalTitle:u,selectedFormat:p,isExporting:v,exportError:m,complianceAudits:k,viewMode:h,router:g,breadcrumbs:b,showFrameworks:C,showPolicies:L,showSubpolicies:w,hasCompliances:E,selectFramework:R,selectPolicy:D,selectSubpolicy:I,showVersions:P,closeVersionsModal:_,goToStep:S,formatDate:A,categoryIcon:T,statusClass:x,viewAllCompliances:F,handleExport:V,fetchAuditInfo:U,getAuditStatusClass:N,getAuditStatusIcon:$,formatAuditStatus:O,handleAuditLinkClick:j,toggleViewMode:M,filteredCompliances:X,complianceTableColumns:y,complianceTableData:f,DynamicTable:Ll.A}}};const Sae=(0,se.A)(_ae,[["render",Iae]]);var Aae=Sae;const Tae={class:"compliance-view-container"},xae={class:"compliance-header"},Fae={key:0,class:"compliance-loading"},Vae={key:1,class:"compliance-error"},Mae={key:2},Xae={class:"controls-filter-section"},Uae={class:"dropdowns-row"},Nae={class:"controls-table-container"},$ae=["onClick"],Oae={class:"modal-body"},jae={class:"detail-section"},Bae={class:"detail-grid"},Wae={class:"detail-item"},Qae={class:"detail-item"},qae={class:"detail-item"},Kae={class:"detail-item"},Jae={class:"detail-section"},zae={class:"detail-section"},Hae={class:"detail-grid"},Yae={class:"detail-item"},Gae={class:"detail-item"},Zae={class:"detail-item"},ete={key:0,class:"detail-section risk-section"},ate={class:"detail-grid"},tte={class:"detail-item"},ite={class:"detail-item"},ste={class:"detail-section"},ote={class:"detail-grid"},lte={class:"detail-item"},nte={class:"detail-item"},rte={class:"detail-item"};var cte={__name:"ComplianceView",setup(e){const a=(0,ae.lq)(),t=(0,ae.rd)(),o=(0,ee.KR)(!1),l=(0,ee.KR)(null),n=(0,ee.KR)([]),r=(0,ee.KR)(null),c=(0,ee.KR)(""),u=(0,ee.KR)(""),p=(0,ee.KR)(""),v=(0,ee.KR)(""),m=(0,ee.KR)("Identifier"),k=(0,ee.KR)("asc"),h=(0,s.EW)(()=>{const e=decodeURIComponent(a.params.name||""),t=a.params.type.charAt(0).toUpperCase()+a.params.type.slice(1);return`Controls for ${t}: ${e}`}),g={name:"Status",label:"Status",values:[{value:"",label:"All Statuses"},{value:"Under Review",label:"Under Review"},{value:"Approved",label:"Approved"},{value:"Rejected",label:"Rejected"}]},y={name:"Criticality",label:"Criticality",values:[{value:"",label:"All Criticality"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}]},f={name:"MaturityLevel",label:"Maturity Level",values:[{value:"",label:"All Maturity Levels"},{value:"Initial",label:"Initial"},{value:"Developing",label:"Developing"},{value:"Defined",label:"Defined"},{value:"Managed",label:"Managed"},{value:"Optimizing",label:"Optimizing"}]},b=[{key:"Identifier",label:"ID",sortable:!0},{key:"ComplianceTitle",label:"Title",sortable:!0},{key:"Status",label:"Status",sortable:!0},{key:"Criticality",label:"Criticality",sortable:!0},{key:"MaturityLevel",label:"Maturity Level",sortable:!0},{key:"MandatoryOptional",label:"Type",sortable:!0},{key:"ManualAutomatic",label:"Implementation",sortable:!0},{key:"CreatedByDate",label:"Created Date",sortable:!0}],C=(0,s.EW)(()=>{let e=[...n.value];if(c.value){const a=c.value.toLowerCase();e=e.filter(e=>e.ComplianceTitle?.toLowerCase().includes(a)||e.ComplianceItemDescription?.toLowerCase().includes(a)||e.Identifier?.toLowerCase().includes(a))}return u.value&&(e=e.filter(e=>e.Status===u.value)),p.value&&(e=e.filter(e=>e.Criticality===p.value)),v.value&&(e=e.filter(e=>e.MaturityLevel===v.value)),e.sort((e,a)=>{let t=e[m.value]||"",i=a[m.value]||"";return"CreatedByDate"===m.value?(t=new Date(t),i=new Date(i)):(t="string"===typeof t?t.toLowerCase():t,i="string"===typeof i?i.toLowerCase():i),t<i?"asc"===k.value?-1:1:t>i?"asc"===k.value?1:-1:0}),e}),L=()=>{},w=e=>{const a=e?.toLowerCase()||"";return a.includes("review")?"status-review":a.includes("approved")?"status-approved":a.includes("rejected")?"status-rejected":"status-default"},E=e=>{const a=e?.toLowerCase()||"";return`criticality-${a}`},R=e=>{r.value=e},D=()=>{r.value=null},I=()=>{S()},P=()=>{t.back()},_=()=>{console.log("Export functionality to be implemented")},S=async()=>{try{o.value=!0,l.value=null;const e=await bt.fv.getCompliancesByType(a.params.type,a.params.id);e.data.success?n.value=e.data.compliances.map(e=>({...e,CreatedByDate:e.CreatedByDate?new Date(e.CreatedByDate).toLocaleDateString():"N/A",category:e.Criticality||"Not Specified",name:e.ComplianceTitle||e.ComplianceItemDescription,description:e.ComplianceItemDescription,title:e.ComplianceTitle,maturityLevel:e.MaturityLevel||"Not Specified",version:e.ComplianceVersion,mandatoryOptional:e.MandatoryOptional||"Not Specified",manualAutomatic:e.ManualAutomatic||"Not Specified"})):l.value=e.data.message||"Failed to load controls"}catch(e){l.value=e.response?.data?.message||"Failed to load controls. Please try again."}finally{o.value=!1}};return(0,s.sV)(()=>{S()}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",Tae,[(0,s.Lk)("div",xae,[(0,s.Lk)("h2",null,(0,d.v_)(h.value),1),(0,s.Lk)("div",{class:"compliance-actions"},[(0,s.Lk)("button",{class:"compliance-export-btn",onClick:_},a[5]||(a[5]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")])),(0,s.Lk)("button",{onClick:P,class:"compliance-back-btn"},a[6]||(a[6]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])]),o.value?((0,s.uX)(),(0,s.CE)("div",Fae,a[7]||(a[7]=[(0,s.Lk)("div",{class:"compliance-spinner"},null,-1),(0,s.Lk)("p",null,"Loading controls...",-1)]))):l.value?((0,s.uX)(),(0,s.CE)("div",Vae,[(0,s.Lk)("p",null,(0,d.v_)(l.value),1),(0,s.Lk)("button",{onClick:I,class:"compliance-retry-btn"},"Retry")])):((0,s.uX)(),(0,s.CE)("div",Mae,[(0,s.Lk)("div",Xae,[(0,s.bF)(JK.A,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),placeholder:"Search controls...",onSearch:L},null,8,["modelValue"]),(0,s.Lk)("div",Uae,[(0,s.bF)(mt.A,{config:g,modelValue:u.value,"onUpdate:modelValue":a[1]||(a[1]=e=>u.value=e),onChange:L,class:"filter-dropdown"},null,8,["modelValue"]),(0,s.bF)(mt.A,{config:y,modelValue:p.value,"onUpdate:modelValue":a[2]||(a[2]=e=>p.value=e),onChange:L,class:"filter-dropdown"},null,8,["modelValue"]),(0,s.bF)(mt.A,{config:f,modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=e=>v.value=e),onChange:L,class:"filter-dropdown"},null,8,["modelValue"])])]),(0,s.Lk)("div",Nae,[(0,s.bF)(Ll.A,{data:C.value,columns:b,uniqueKey:"ComplianceId",showPagination:!0,showActions:!0},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"action-btn view",onClick:a=>R(e)},a[8]||(a[8]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,$ae)]),_:1},8,["data"])]),r.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:D},[(0,s.Lk)("div",{class:"modal-content",onClick:a[4]||(a[4]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:"modal-header"},[a[9]||(a[9]=(0,s.Lk)("h3",null,"Control Details",-1)),(0,s.Lk)("button",{class:"modal-close",onClick:D},"Ã—")]),(0,s.Lk)("div",Oae,[(0,s.Lk)("div",jae,[a[14]||(a[14]=(0,s.Lk)("h4",null,"Basic Information",-1)),(0,s.Lk)("div",Bae,[(0,s.Lk)("div",Wae,[a[10]||(a[10]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.ComplianceTitle),1)]),(0,s.Lk)("div",Qae,[a[11]||(a[11]=(0,s.Lk)("label",null,"ID:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.Identifier),1)]),(0,s.Lk)("div",qae,[a[12]||(a[12]=(0,s.Lk)("label",null,"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",w(r.value.Status)])},(0,d.v_)(r.value.Status),3)]),(0,s.Lk)("div",Kae,[a[13]||(a[13]=(0,s.Lk)("label",null,"Criticality:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["criticality-badge",E(r.value.Criticality)])},(0,d.v_)(r.value.Criticality),3)])])]),(0,s.Lk)("div",Jae,[a[15]||(a[15]=(0,s.Lk)("h4",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(r.value.ComplianceItemDescription),1)]),(0,s.Lk)("div",zae,[a[19]||(a[19]=(0,s.Lk)("h4",null,"Implementation Details",-1)),(0,s.Lk)("div",Hae,[(0,s.Lk)("div",Yae,[a[16]||(a[16]=(0,s.Lk)("label",null,"Type:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.MandatoryOptional),1)]),(0,s.Lk)("div",Gae,[a[17]||(a[17]=(0,s.Lk)("label",null,"Implementation:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.ManualAutomatic),1)]),(0,s.Lk)("div",Zae,[a[18]||(a[18]=(0,s.Lk)("label",null,"Maturity Level:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.MaturityLevel),1)])])]),r.value.IsRisk?((0,s.uX)(),(0,s.CE)("div",ete,[a[22]||(a[22]=(0,s.Lk)("h4",null,"Risk Information",-1)),(0,s.Lk)("div",ate,[(0,s.Lk)("div",tte,[a[20]||(a[20]=(0,s.Lk)("label",null,"Possible Damage:",-1)),(0,s.Lk)("p",null,(0,d.v_)(r.value.PossibleDamage),1)]),(0,s.Lk)("div",ite,[a[21]||(a[21]=(0,s.Lk)("label",null,"Mitigation:",-1)),(0,s.Lk)("p",null,(0,d.v_)(r.value.mitigation),1)])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",ste,[a[26]||(a[26]=(0,s.Lk)("h4",null,"Hierarchy",-1)),(0,s.Lk)("div",ote,[(0,s.Lk)("div",lte,[a[23]||(a[23]=(0,s.Lk)("label",null,"Framework:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.FrameworkName),1)]),(0,s.Lk)("div",nte,[a[24]||(a[24]=(0,s.Lk)("label",null,"Policy:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.PolicyName),1)]),(0,s.Lk)("div",rte,[a[25]||(a[25]=(0,s.Lk)("label",null,"SubPolicy:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.SubPolicyName),1)])])])])])])):(0,s.Q3)("",!0)]))]))}};const dte=(0,se.A)(cte,[["__scopeId","data-v-5429f7a0"]]);var ute=dte;const pte={class:"compliance-view-container"},vte={class:"action-bar"},mte={class:"action-buttons"},kte={class:"export-section"},hte={key:0,class:"error-message"},gte={key:1,class:"loading-spinner"},yte={class:"content-wrapper"},fte={key:0,class:"loading-spinner"},bte={key:1,class:"no-data"},Cte={key:2,class:"compliances-grid"},Lte={class:"compliance-header"},wte={class:"compliance-body"},Ete={class:"clean-details-grid"},Rte={class:"detail-row"},Dte={class:"detail-value"},Ite={class:"detail-row"},Pte={class:"detail-value"},_te={class:"detail-row"},Ste={class:"detail-value"},Ate={class:"detail-row"},Tte={class:"compliance-footer"},xte={class:"identifier"},Fte={key:3,class:"compliances-list-view"},Vte=["onClick"],Mte={key:1};var Xte={__name:"ComplianceAuditView",setup(e){const a=(0,ae.lq)(),t=(0,ae.rd)(),o=(0,ee.KR)(a.params.type),l=(0,ee.KR)(a.params.id),n=(0,ee.KR)(decodeURIComponent(a.params.name)),r=(0,ee.KR)([]),c=(0,ee.KR)(!1),u=(0,ee.KR)(null),p=(0,ee.KR)("xlsx"),v=(0,ee.KR)("list"),m=(0,s.EW)(()=>`Compliance Audit Status - ${n.value}`),k=[{key:"audit_findings_id",label:"Audit Findings ID",sortable:!0},{key:"ComplianceItemDescription",label:"Compliance",sortable:!0},{key:"Criticality",label:"Criticality",sortable:!0},{key:"audit_findings_status",label:"Completion Status",sortable:!0},{key:"audit_performer_name",label:"Compliance Performed By",sortable:!0},{key:"audit_approver_name",label:"Compliance Approved By",sortable:!0},{key:"audit_date",label:"Completion Date",sortable:!0}],h=(0,s.EW)(()=>r.value.map(e=>({audit_findings_id:e.audit_findings_id||"N/A",ComplianceItemDescription:e.ComplianceItemDescription,Criticality:e.Criticality,audit_findings_status:e.audit_findings_status||"Not Audited",audit_performer_name:e.audit_performer_name||"N/A",audit_approver_name:e.audit_approver_name||"N/A",audit_date:y(e.audit_date),ComplianceId:e.ComplianceId})));async function g(){try{c.value=!0,u.value=null;let e="";switch(o.value){case"framework":e=`/api/compliance/view/framework/${l.value}/`;break;case"policy":e=`/api/compliance/view/policy/${l.value}/`;break;case"subpolicy":e=`/api/compliance/view/subpolicy/${l.value}/`;break;default:throw new Error("Invalid type specified")}const a=await qe.A.get(e);if(console.log("API Response:",a.data),!a.data||!a.data.success)throw new Error(a.data.message||"Failed to fetch compliances");{const e=a.data.compliances,t=await Promise.all(e.map(async e=>{try{const a=await bt.Hi.getComplianceAuditInfo(e.ComplianceId);return a.data&&a.data.success?{...e,...a.data.data}:e}catch(a){return console.error(`Error fetching audit info for compliance ${e.ComplianceId}:`,a),e}}));r.value=t}}catch(e){console.error("Error fetching compliances:",e),u.value="Failed to fetch compliances. Please try again.",r.value=[]}finally{c.value=!1}}function y(e){return e?new Date(e).toLocaleDateString():"N/A"}function f(e){if(!e)return"not-audited";const a=e.toLowerCase();return a.includes("non")||a.includes("not compliant")?"non-compliant":a.includes("partially")?"partially-compliant":a.includes("fully")?"fully-compliant":a.includes("not applicable")?"not-applicable":"not-audited"}function b(e){if(!e)return"fas fa-question-circle";const a=e.toLowerCase();return a.includes("non")||a.includes("not compliant")?"fas fa-times-circle":a.includes("partially")?"fas fa-exclamation-circle":a.includes("fully")?"fas fa-check-circle":a.includes("not applicable")?"fas fa-ban":"fas fa-question-circle"}function C(e){if(!e)return"Not Audited";const a=e.toLowerCase();return a.includes("non")||a.includes("not compliant")?"Non Conformity":a.includes("partially")?"Control Gap":e}function L(){t.back()}function w(e){e&&t.push(`/audit-findings/${e}`)}async function E(e){try{console.log(`Attempting export for ${o.value} ${l.value} in ${e} format`);const a=await(0,qe.A)({url:`/api/export/audit-compliances/${e}/${o.value}/${l.value}/`,method:"GET",responseType:"blob",timeout:3e4,headers:{Accept:"application/json, application/pdf, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, application/xml"}}),t=a.headers["content-type"],i=new Blob([a.data],{type:t});let s=`audit_compliances_${o.value}_${l.value}.${e}`;const n=a.headers["content-disposition"];n&&n.includes("filename=")&&(s=n.split("filename=")[1].replace(/"/g,""));const r=document.createElement("a");r.href=URL.createObjectURL(i),r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),(0,Pae.nk)({message:"Export completed successfully",type:"success",duration:3e3})}catch(u){console.error("Export error:",u);const a=u.response?.data?.message||u.message||"Failed to export compliances";(0,Pae.nk)({message:a,type:"error",duration:5e3})}}return(0,s.sV)(async()=>{await g()}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",pte,[(0,s.Lk)("div",vte,[(0,s.Lk)("div",mte,[(0,s.Lk)("div",kte,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>p.value=e),class:"format-select"},a[2]||(a[2]=[(0,s.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option>',5)]),512),[[i.u1,p.value]]),(0,s.Lk)("button",{class:"btn btn-primary",onClick:a[1]||(a[1]=e=>E(p.value))},a[3]||(a[3]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")]))]),(0,s.Lk)("button",{class:"btn btn-outline",onClick:L},a[4]||(a[4]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])]),(0,s.Lk)("h1",null,(0,d.v_)(m.value),1),u.value?((0,s.uX)(),(0,s.CE)("div",hte,[a[5]||(a[5]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(u.value),1)])):(0,s.Q3)("",!0),c.value?((0,s.uX)(),(0,s.CE)("div",gte,a[6]||(a[6]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading...",-1)]))):(0,s.Q3)("",!0),(0,s.Lk)("div",yte,[c.value?((0,s.uX)(),(0,s.CE)("div",fte,a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading compliances...",-1)]))):r.value.length?"card"===v.value?((0,s.uX)(),(0,s.CE)("div",Cte,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,class:"compliance-card"},[(0,s.Lk)("div",Lte,[(0,s.Lk)("span",{class:(0,d.C4)(["criticality-badge","criticality-"+e.Criticality.toLowerCase()])},(0,d.v_)(e.Criticality),3)]),(0,s.Lk)("div",wte,[(0,s.Lk)("h3",null,(0,d.v_)(e.ComplianceItemDescription),1),(0,s.Lk)("div",Ete,[(0,s.Lk)("div",Rte,[a[9]||(a[9]=(0,s.Lk)("span",{class:"detail-label"},"Compliance Performed By:",-1)),(0,s.Lk)("span",Dte,(0,d.v_)(e.audit_performer_name||"N/A"),1)]),(0,s.Lk)("div",Ite,[a[10]||(a[10]=(0,s.Lk)("span",{class:"detail-label"},"Compliance Approved By:",-1)),(0,s.Lk)("span",Pte,(0,d.v_)(e.audit_approver_name||"N/A"),1)]),(0,s.Lk)("div",_te,[a[11]||(a[11]=(0,s.Lk)("span",{class:"detail-label"},"Completion Date:",-1)),(0,s.Lk)("span",Ste,(0,d.v_)(y(e.audit_date)),1)]),(0,s.Lk)("div",Ate,[a[12]||(a[12]=(0,s.Lk)("span",{class:"detail-label"},"Completion Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["detail-value",f(e.audit_findings_status)])},[(0,s.Lk)("i",{class:(0,d.C4)(b(e.audit_findings_status))},null,2),(0,s.eW)(" "+(0,d.v_)(C(e.audit_findings_status)),1)],2)])]),(0,s.Lk)("div",Tte,[(0,s.Lk)("div",xte,"ID: "+(0,d.v_)(e.Identifier),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",Fte,[(0,s.bF)(Ll.A,{data:h.value,columns:k,"show-pagination":!0,"show-actions":!1,"unique-key":"ComplianceId"},{"cell-audit_findings_id":(0,s.k6)(({value:e})=>[e&&"N/A"!==e?((0,s.uX)(),(0,s.CE)("a",{key:0,href:"#",class:"audit-id-link",onClick:(0,i.D$)(a=>w(e),["prevent"])},(0,d.v_)(e),9,Vte)):((0,s.uX)(),(0,s.CE)("span",Mte,"N/A"))]),_:1},8,["data"])])):((0,s.uX)(),(0,s.CE)("div",bte,a[8]||(a[8]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No compliances found",-1)])))])]))}};const Ute=Xte;var Nte=Ute;const $te={class:"dashboard-container"},Ote={class:"dashboard-header"},jte={class:"header-actions"},Bte={class:"metrics-grid"},Wte={class:"metric-card"},Qte={class:"metric-content"},qte={class:"metric-value"},Kte={class:"percentage"},Jte={class:"metric-change"},zte={class:"metric-card"},Hte={class:"metric-content"},Yte={class:"metric-value"},Gte={class:"number"},Zte={class:"metric-card"},eie={class:"metric-content"},aie={class:"metric-value"},tie={class:"number"},iie={class:"metric-card"},sie={class:"metric-content"},oie={class:"metric-value"},lie={class:"number"},nie={class:"dashboard-content"},rie={class:"performance-chart"},cie={class:"chart-header"},die={class:"chart-controls"},uie={class:"chart-type-icons"},pie={class:"axis-controls"},vie={class:"axis-select"},mie={class:"axis-select"},kie={class:"recent-activity"},hie={class:"activity-header"},gie={class:"activity-list"},yie={key:0,class:"activity-loading"},fie={key:1,class:"activity-empty"},bie={class:"activity-details"},Cie={class:"activity-time"};function Lie(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",$te,[(0,s.Lk)("div",Ote,[a[12]||(a[12]=(0,s.Lk)("h1",null,"Compliance Dashboard",-1)),(0,s.Lk)("div",jte,[(0,s.Lk)("button",{class:"refresh-btn",onClick:a[0]||(a[0]=(...e)=>n.refreshData&&n.refreshData(...e))},a[10]||(a[10]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1)])),a[11]||(a[11]=(0,s.Lk)("button",{class:"download-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",Bte,[(0,s.Lk)("div",Wte,[a[14]||(a[14]=(0,s.Lk)("div",{class:"metric-icon compliance-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",Qte,[a[13]||(a[13]=(0,s.Lk)("h3",null,"Approval Rate",-1)),(0,s.Lk)("div",qte,[(0,s.Lk)("span",Kte,(0,d.v_)(l.dashboardData.approval_rate)+"%",1)]),(0,s.Lk)("div",Jte," Based on "+(0,d.v_)(l.dashboardData.total_count)+" compliances ",1)])]),(0,s.Lk)("div",zte,[a[17]||(a[17]=(0,s.Lk)("div",{class:"metric-icon policies-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("div",Hte,[a[15]||(a[15]=(0,s.Lk)("h3",null,"Active Compliances",-1)),(0,s.Lk)("div",Yte,[(0,s.Lk)("span",Gte,(0,d.v_)(l.dashboardData.status_counts.active_compliance||0),1)]),a[16]||(a[16]=(0,s.Lk)("div",{class:"metric-change"}," Active and Approved ",-1))])]),(0,s.Lk)("div",Zte,[a[20]||(a[20]=(0,s.Lk)("div",{class:"metric-icon risk-icon"},[(0,s.Lk)("i",{class:"fas fa-list"})],-1)),(0,s.Lk)("div",eie,[a[18]||(a[18]=(0,s.Lk)("h3",null,"Total Findings",-1)),(0,s.Lk)("div",aie,[(0,s.Lk)("span",tie,(0,d.v_)(l.dashboardData.total_findings),1)]),a[19]||(a[19]=(0,s.Lk)("div",{class:"metric-change"}," Across all compliances ",-1))])]),(0,s.Lk)("div",iie,[a[23]||(a[23]=(0,s.Lk)("div",{class:"metric-icon review-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})],-1)),(0,s.Lk)("div",sie,[a[21]||(a[21]=(0,s.Lk)("h3",null,"Under Review",-1)),(0,s.Lk)("div",oie,[(0,s.Lk)("span",lie,(0,d.v_)(l.dashboardData.status_counts.under_review),1)]),a[22]||(a[22]=(0,s.Lk)("div",{class:"metric-change"}," Pending review ",-1))])])]),(0,s.Lk)("div",nie,[(0,s.Lk)("div",rie,[(0,s.Lk)("div",cie,[a[32]||(a[32]=(0,s.Lk)("h2",null,"Compliance Analytics",-1)),(0,s.Lk)("div",die,[(0,s.Lk)("div",uie,[(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"bar"===l.selectedChartType}]),onClick:a[1]||(a[1]=e=>n.changeChartType("bar")),title:"Bar Chart"},a[24]||(a[24]=[(0,s.Lk)("i",{class:"fas fa-chart-bar"},null,-1)]),2),(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"line"===l.selectedChartType}]),onClick:a[2]||(a[2]=e=>n.changeChartType("line")),title:"Line Chart"},a[25]||(a[25]=[(0,s.Lk)("i",{class:"fas fa-chart-line"},null,-1)]),2),(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"pie"===l.selectedChartType}]),onClick:a[3]||(a[3]=e=>n.changeChartType("pie")),title:"Pie Chart"},a[26]||(a[26]=[(0,s.Lk)("i",{class:"fas fa-chart-pie"},null,-1)]),2),(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"doughnut"===l.selectedChartType}]),onClick:a[4]||(a[4]=e=>n.changeChartType("doughnut")),title:"Doughnut Chart"},a[27]||(a[27]=[(0,s.Lk)("i",{class:"fas fa-circle-notch"},null,-1)]),2)]),(0,s.Lk)("div",pie,[(0,s.Lk)("div",vie,[a[29]||(a[29]=(0,s.Lk)("label",null,"X Axis:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[5]||(a[5]=e=>l.selectedXAxis=e),onChange:a[6]||(a[6]=(...e)=>n.fetchDashboardData&&n.fetchDashboardData(...e))},a[28]||(a[28]=[(0,s.Lk)("option",{value:"Compliance"},"Compliance",-1)]),544),[[i.u1,l.selectedXAxis]])]),(0,s.Lk)("div",mie,[a[31]||(a[31]=(0,s.Lk)("label",null,"Y Axis:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>l.selectedYAxis=e),onChange:a[8]||(a[8]=(...e)=>n.fetchDashboardData&&n.fetchDashboardData(...e))},a[30]||(a[30]=[(0,s.Fv)('<option value="Criticality">By Criticality</option><option value="Status">By Status</option><option value="ActiveInactive">By Active/Inactive</option><option value="ManualAutomatic">By Manual/Automatic</option><option value="MandatoryOptional">By Mandatory/Optional</option><option value="MaturityLevel">By Maturity Level</option>',6)]),544),[[i.u1,l.selectedYAxis]])])])])]),a[33]||(a[33]=(0,s.Lk)("div",{class:"chart-container"},[(0,s.Lk)("canvas",{id:"myChart"})],-1))]),(0,s.Lk)("div",kie,[(0,s.Lk)("div",hie,[a[34]||(a[34]=(0,s.Lk)("h2",null,"Recent Activity",-1)),(0,s.Lk)("button",{class:"more-options",onClick:a[9]||(a[9]=(...e)=>n.refreshRecentActivities&&n.refreshRecentActivities(...e))},[(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-sync",{"fa-spin":l.loadingActivities}])},null,2)])]),(0,s.Lk)("div",gie,[l.loadingActivities?((0,s.uX)(),(0,s.CE)("div",yie,a[35]||(a[35]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading recent activities...",-1)]))):0===l.recentActivities.length?((0,s.uX)(),(0,s.CE)("div",fie,a[36]||(a[36]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("span",null,"No recent activities found",-1)]))):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.recentActivities,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"activity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["activity-icon",e.type])},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon)},null,2)],2),(0,s.Lk)("div",bie,[(0,s.Lk)("h4",null,(0,d.v_)(e.title),1),(0,s.Lk)("p",null,(0,d.v_)(e.description),1),(0,s.Lk)("span",Cie,(0,d.v_)(e.time),1)])]))),128))])])])])}ze.t1.register(ze.PP,ze.kc,ze.E8,ze.FN,ze.No,ze.Bs,ze.pr,ze.hE,ze.m_,ze.s$);var wie={name:"ComplianceDashboard",data(){return{selectedChartType:"bar",selectedXAxis:"Compliance",selectedYAxis:"Criticality",chart:null,chartId:"myChart",api:{complianceService:bt.fv},dashboardData:{status_counts:{approved:0,active:0,under_review:0},total_count:0,total_findings:0,approval_rate:0},chartData:null,recentActivities:[],loadingActivities:!1,activityRefreshInterval:null}},mounted(){if(!ht.G4.isLoggedIn())return console.warn("[COMPLIANCE_DASHBOARD] User not logged in, redirecting to login"),void this.$router.push("/login");console.log("[COMPLIANCE_DASHBOARD] User session:",ht.G4.getUserSession()),this.fetchDashboardData().then(()=>{this.$nextTick(()=>{setTimeout(()=>{this.chart||this.updateChart()},200)})}),this.fetchRecentActivities(),this.activityRefreshInterval=setInterval(()=>{this.fetchRecentActivities()},3e5)},beforeUnmount(){this.destroyChart(),this.activityRefreshInterval&&clearInterval(this.activityRefreshInterval)},beforeRouteLeave(e,a,t){this.destroyChart(),this.activityRefreshInterval&&clearInterval(this.activityRefreshInterval),t()},methods:{destroyChart(){try{this.chart&&(console.log("Destroying existing chart"),this.chart.destroy(),this.chart=null);const e=document.getElementById(this.chartId);if(e){const a=e.getContext("2d");a&&a.clearRect(0,0,e.width,e.height)}}catch(e){console.error("Error destroying chart:",e),this.chart=null}},async fetchRecentActivities(){try{this.loadingActivities=!0,console.log("Fetching recent activities...");const[a,t]=await Promise.all([this.api.complianceService.getCompliancePolicyApprovals({reviewer_id:2}),this.api.complianceService.getComplianceFrameworks()]);let i=[];if(a.data.success&&a.data.data){const e=a.data.data,t=e.sort((e,a)=>{const t=new Date(e.ApprovedDate||e.ExtractedData?.CreatedByDate||"1970-01-01"),i=new Date(a.ApprovedDate||a.ExtractedData?.CreatedByDate||"1970-01-01");return i-t});t.slice(0,10).forEach(e=>{const a=e.ExtractedData||{},t=a.ComplianceTitle||a.ComplianceItemDescription||"Unknown Compliance",s=a.CreatedByName||"Unknown User",o=a.ComplianceVersion||"1.0";!0===e.ApprovedNot?i.push({type:"approved",icon:"fas fa-check-circle",title:"Compliance Approved",description:`"${this.truncateText(t,50)}" approved by reviewer`,time:this.formatRelativeTime(e.ApprovedDate),metadata:{complianceId:a.compliance_id,version:o,approver:"Reviewer"}}):!1===e.ApprovedNot?i.push({type:"rejected",icon:"fas fa-times-circle",title:"Compliance Rejected",description:`"${this.truncateText(t,50)}" needs revision`,time:this.formatRelativeTime(e.ApprovedDate),metadata:{complianceId:a.compliance_id,version:o,reviewer:"Reviewer"}}):null===e.ApprovedNot&&("compliance_deactivation"===a.type||"Change Status to Inactive"===a.RequestType?i.push({type:"deactivation",icon:"fas fa-power-off",title:"Deactivation Request",description:`Deactivation requested for compliance ID ${a.compliance_id}`,time:this.formatRelativeTime(a.CreatedByDate),metadata:{complianceId:a.compliance_id,reason:a.reason||"No reason provided"}}):parseFloat(o)>1?i.push({type:"version",icon:"fas fa-code-branch",title:"New Version Created",description:`Version ${o} of "${this.truncateText(t,40)}" by ${s}`,time:this.formatRelativeTime(a.CreatedByDate),metadata:{complianceId:a.compliance_id,version:o,creator:s}}):i.push({type:"created",icon:"fas fa-plus-circle",title:"New Compliance Created",description:`"${this.truncateText(t,50)}" created by ${s}`,time:this.formatRelativeTime(a.CreatedByDate),metadata:{complianceId:a.compliance_id,version:o,creator:s}}))})}if(t.data&&Array.isArray(t.data))try{const e=t.data[0];if(e){const a=await this.api.complianceService.getCompliancePolicies(e.id);if(a.data&&Array.isArray(a.data)){const e=a.data[0];if(e){const a=await this.api.complianceService.getComplianceSubPolicies(e.id);if(a.data&&Array.isArray(a.data)){const e=a.data[0];if(e){const a=await this.api.complianceService.getCompliancesBySubPolicy(e.id);if(a.data.success&&a.data.data){const e=a.data.data;e.slice(0,3).forEach(e=>{if(e&&e.length>0){const a=e[0],t=i.find(e=>e.metadata?.complianceId===a.ComplianceId);if(!t&&a.CreatedByDate){const e=new Date(a.CreatedByDate),t=new Date,s=(t-e)/864e5;s<=30&&i.push({type:"updated",icon:"fas fa-edit",title:"Compliance Updated",description:`"${this.truncateText(a.ComplianceItemDescription||"Compliance item",50)}" modified`,time:this.formatRelativeTime(a.CreatedByDate),metadata:{complianceId:a.ComplianceId,version:a.ComplianceVersion,creator:a.CreatedByName}})}}})}}}}}}}catch(e){console.log("Could not fetch additional compliance data:",e.message)}i.sort((e,a)=>{const t=this.parseRelativeTime(e.time),i=this.parseRelativeTime(a.time);return t-i});const s=i.filter((e,a,t)=>a===t.findIndex(a=>a.description===e.description)).slice(0,8);this.recentActivities=s,console.log(`Loaded ${this.recentActivities.length} recent activities`)}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showViewAllComplianceDenied();console.error("Error fetching recent activities:",e),this.recentActivities=[{type:"error",icon:"fas fa-exclamation-triangle",title:"Unable to Load Activities",description:"Please check your connection and try again",time:"now"}]}finally{this.loadingActivities=!1}},truncateText(e,a){return e?e.length>a?e.substring(0,a)+"...":e:"Unknown"},formatRelativeTime(e){if(!e)return"Unknown time";try{const a=new Date(e),t=new Date,i=Math.floor((t-a)/1e3);if(i<60)return"Just now";if(i<3600){const e=Math.floor(i/60);return`${e} minute${1===e?"":"s"} ago`}if(i<86400){const e=Math.floor(i/3600);return`${e} hour${1===e?"":"s"} ago`}if(i<604800){const e=Math.floor(i/86400);return`${e} day${1===e?"":"s"} ago`}{const e=Math.floor(i/604800);return`${e} week${1===e?"":"s"} ago`}}catch(a){return console.error("Error formatting date:",a),"Unknown time"}},parseRelativeTime(e){if("Just now"===e)return 0;const a=e.match(/(\d+)\s+(minute|hour|day|week)s?\s+ago/);if(a){const e=parseInt(a[1]),t=a[2];switch(t){case"minute":return 60*e;case"hour":return 3600*e;case"day":return 86400*e;case"week":return 604800*e;default:return 999999}}return 999999},refreshRecentActivities(){this.fetchRecentActivities()},async fetchDashboardData(){try{console.log("Starting fetchDashboardData..."),console.log("Request payload:",{xAxis:this.selectedXAxis,yAxis:this.selectedYAxis});const[e,a]=await Promise.all([this.api.complianceService.getComplianceDashboard(),this.api.complianceService.getComplianceAnalytics({xAxis:this.selectedXAxis,yAxis:this.selectedYAxis})]);if(console.log("Dashboard API Response:",e.data),console.log("Analytics API Response:",a.data),!e.data.success||!a.data.success)throw new Error(e.data.message||a.data.message||"API request failed");this.dashboardData={status_counts:e.data.data.summary.status_counts||{},total_count:e.data.data.summary.total_count||0,total_findings:e.data.data.summary.total_findings||0,approval_rate:a.data.dashboardData.approval_rate||0},this.chartData=a.data.chartData,console.log("Chart data updated:",this.chartData),await this.$nextTick(),this.updateChart()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showViewAllComplianceDenied();console.error("Error in fetchDashboardData:",e),this.dashboardData={status_counts:{approved:0,active:0,under_review:0},total_count:0,total_findings:0,approval_rate:0},this.chartData={labels:["High","Medium","Low"],datasets:[{label:"Sample Data",data:[10,12,5],backgroundColor:["rgba(244, 67, 54, 0.6)","rgba(255, 152, 0, 0.6)","rgba(76, 175, 80, 0.6)"],borderColor:["#F44336","#FF9800","#4CAF50"],borderWidth:1}]},await this.$nextTick(),this.updateChart()}},updateChart(){try{console.log("Updating chart with type:",this.selectedChartType),console.log("Chart data:",this.chartData),this.destroyChart(),setTimeout(()=>{try{const e=document.getElementById(this.chartId);if(!e)return void console.error("Chart canvas not found");const a=e.getContext("2d");a&&a.clearRect(0,0,e.width,e.height);const t=this.createChartConfig();console.log("Chart config:",t),this.chart=new ze.t1(e,t),console.log("Chart created successfully")}catch(e){console.error("Error in inner chart creation:",e)}},100)}catch(e){console.error("Error in updateChart:",e),this.chart=null}},createChartConfig(){if(!this.chartData||!this.chartData.labels||0===this.chartData.labels.length)return console.log("No chart data available, using fallback"),{type:this.selectedChartType,data:{labels:["High","Medium","Low"],datasets:[{label:"Sample Data",data:[10,12,5],backgroundColor:"bar"===this.selectedChartType?["rgba(244, 67, 54, 0.6)","rgba(255, 152, 0, 0.6)","rgba(76, 175, 80, 0.6)"]:["rgba(244, 67, 54, 0.8)","rgba(255, 152, 0, 0.8)","rgba(76, 175, 80, 0.8)"],borderColor:["#F44336","#FF9800","#4CAF50"],borderWidth:1}]},options:this.getChartOptions()};const e={label:this.chartData.datasets[0]?.label||`Compliance by ${this.selectedYAxis.replace("By ","")}`,data:this.chartData.datasets[0]?.data||[],backgroundColor:this.getBackgroundColors(),borderColor:this.getBorderColors(),borderWidth:1};return"line"===this.selectedChartType&&(e.tension=.1,e.fill=!1,e.pointBackgroundColor=this.getBorderColors(),e.pointBorderColor=this.getBorderColors(),e.pointRadius=4,e.pointHoverRadius=6),["pie","doughnut"].includes(this.selectedChartType)&&(e.backgroundColor=this.getBackgroundColors().map(e=>e.replace("0.6","0.8"))),{type:this.selectedChartType,data:{labels:this.chartData.labels,datasets:[e]},options:this.getChartOptions()}},getChartOptions(){const e={responsive:!0,maintainAspectRatio:!1,animation:{duration:800,easing:"easeInOutQuad"},plugins:{legend:{display:!0,position:["pie","doughnut"].includes(this.selectedChartType)?"right":"top",labels:{padding:20,usePointStyle:!0,font:{size:12}}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:6,displayColors:!0,callbacks:{label:e=>{if(["pie","doughnut"].includes(this.selectedChartType)){const a=e.label||"",t=e.raw||0,i=e.chart.data.datasets[0].data.reduce((e,a)=>e+a,0),s=(t/i*100).toFixed(1);return`${a}: ${t} (${s}%)`}return`${e.dataset.label}: ${e.raw}`}}}},layout:{padding:{top:10,bottom:10,left:10,right:10}}};return["bar","line"].includes(this.selectedChartType)&&(e.scales={x:{grid:{display:!1},ticks:{font:{size:11}}},y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{stepSize:1,precision:0,font:{size:11}}}}),"doughnut"===this.selectedChartType&&(e.cutout="60%"),e},changeChartType(e){console.log("Changing chart type from",this.selectedChartType,"to",e),this.selectedChartType!==e&&(this.selectedChartType=e,this.$nextTick(()=>{setTimeout(()=>{this.updateChart()},50)}))},getBackgroundColors(){const e={Criticality:{High:"rgba(244, 67, 54, 0.6)",Medium:"rgba(255, 152, 0, 0.6)",Low:"rgba(76, 175, 80, 0.6)"},Status:{Approved:"rgba(76, 175, 80, 0.6)","Under Review":"rgba(255, 152, 0, 0.6)",Rejected:"rgba(244, 67, 54, 0.6)",Active:"rgba(33, 150, 243, 0.6)"},ActiveInactive:{Active:"rgba(76, 175, 80, 0.6)",Inactive:"rgba(158, 158, 158, 0.6)"},ManualAutomatic:{Manual:"rgba(33, 150, 243, 0.6)",Automatic:"rgba(156, 39, 176, 0.6)"},MandatoryOptional:{Mandatory:"rgba(244, 67, 54, 0.6)",Optional:"rgba(255, 152, 0, 0.6)"},MaturityLevel:{Initial:"rgba(244, 67, 54, 0.6)",Developing:"rgba(255, 152, 0, 0.6)",Defined:"rgba(255, 235, 59, 0.6)",Managed:"rgba(76, 175, 80, 0.6)",Optimizing:"rgba(33, 150, 243, 0.6)"}};return this.chartData?.labels?.map(a=>e[this.selectedYAxis.replace("By ","")][a]||"rgba(158, 158, 158, 0.6)")||[]},getBorderColors(){const e={Criticality:{High:"#F44336",Medium:"#FF9800",Low:"#4CAF50"},Status:{Approved:"#4CAF50","Under Review":"#FF9800",Rejected:"#F44336",Active:"#2196F3"},ActiveInactive:{Active:"#4CAF50",Inactive:"#9E9E9E"},ManualAutomatic:{Manual:"#2196F3",Automatic:"#9C27B0"},MandatoryOptional:{Mandatory:"#F44336",Optional:"#FF9800"},MaturityLevel:{Initial:"#F44336",Developing:"#FF9800",Defined:"#FFEB3B",Managed:"#4CAF50",Optimizing:"#2196F3"}};return this.chartData?.labels?.map(a=>e[this.selectedYAxis.replace("By ","")][a]||"#9E9E9E")||[]},refreshData(){this.fetchDashboardData(),this.fetchRecentActivities()}}};const Eie=(0,se.A)(wie,[["render",Lie]]);var Rie=Eie;const Die={class:"compliance-versioning-container"},Iie={class:"compliance-selection-row"},Pie={class:"compliance-selection-group"},_ie={class:"compliance-selection-group"},Sie={class:"compliance-selection-group"},Aie={key:0,class:"compliance-loading-overlay"},Tie={key:1,class:"compliance-error-message"},xie={key:2,class:"compliance-table-container"},Fie={key:0,class:"loading"},Vie={key:1,class:"no-compliances"},Mie={class:"compliance-action-btn-group"},Xie=["onClick"],Uie=["onClick"];function Nie(e,a,t,i,o,l){const n=(0,s.g2)("CustomDropdown"),r=(0,s.g2)("DynamicTable"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Die,[a[9]||(a[9]=(0,s.Lk)("div",{class:"compliance-heading"},[(0,s.Lk)("h1",null,"Compliance Tailoring & Templating"),(0,s.Lk)("div",{class:"compliance-heading-underline"})],-1)),(0,s.Lk)("div",Iie,[(0,s.Lk)("div",Pie,[(0,s.bF)(n,{config:o.frameworkDropdownConfig,modelValue:o.selectedFrameworkId,"onUpdate:modelValue":a[0]||(a[0]=e=>o.selectedFrameworkId=e),disabled:o.loading,onChange:l.onFrameworkChange},null,8,["config","modelValue","disabled","onChange"])]),(0,s.Lk)("div",_ie,[(0,s.bF)(n,{config:o.policyDropdownConfig,modelValue:o.selectedPolicyId,"onUpdate:modelValue":a[1]||(a[1]=e=>o.selectedPolicyId=e),disabled:!o.selectedFrameworkId||o.loading,onChange:l.onPolicyChange},null,8,["config","modelValue","disabled","onChange"])]),(0,s.Lk)("div",Sie,[(0,s.bF)(n,{config:o.subPolicyDropdownConfig,modelValue:o.selectedSubPolicyId,"onUpdate:modelValue":a[2]||(a[2]=e=>o.selectedSubPolicyId=e),disabled:!o.selectedPolicyId||o.loading,onChange:l.onSubPolicyChange},null,8,["config","modelValue","disabled","onChange"])])]),o.loading?((0,s.uX)(),(0,s.CE)("div",Aie,a[4]||(a[4]=[(0,s.Lk)("div",{class:"compliance-spinner"},null,-1),(0,s.Lk)("div",{class:"compliance-loading-text"},"Loading data...",-1)]))):(0,s.Q3)("",!0),o.error?((0,s.uX)(),(0,s.CE)("div",Tie,[a[5]||(a[5]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{onClick:a[3]||(a[3]=(...a)=>e.refreshCurrentData&&e.refreshCurrentData(...a)),class:"compliance-retry-btn"},"Retry")])):(0,s.Q3)("",!0),o.selectedSubPolicy?((0,s.uX)(),(0,s.CE)("div",xie,[a[8]||(a[8]=(0,s.Lk)("h3",null,"Compliances for Selected Subpolicy",-1)),o.loading?((0,s.uX)(),(0,s.CE)("div",Fie,"Loading compliances...")):0===o.complianceList.length?((0,s.uX)(),(0,s.CE)("div",Vie,"No compliances found for this subpolicy.")):((0,s.uX)(),(0,s.Wv)(r,{key:2,data:o.complianceList,columns:o.tableColumns,showActions:!0},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("div",Mie,[(0,s.Lk)("button",{onClick:a=>l.navigateToEdit(e),title:"Edit",class:"compliance-action-btn compliance-edit-btnn"},a[6]||(a[6]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,Xie),(0,s.Lk)("button",{onClick:a=>l.startCopy(e),title:"Copy",class:"compliance-action-btn compliance-copy-btnn"},a[7]||(a[7]=[(0,s.Lk)("i",{class:"fas fa-copy"},null,-1)]),8,Uie)])]),_:1},8,["data","columns"]))])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var $ie={name:"ComplianceTailoring",components:{PopupModal:pv.wA,CustomDropdown:mt.A,DynamicTable:Ll.A},mixins:[E6],data(){return{frameworks:[],selectedFramework:"",selectedFrameworkId:"",policies:[],selectedPolicy:"",selectedPolicyId:"",complianceSubPolicies:[],selectedSubPolicy:"",selectedSubPolicyId:"",complianceList:[],loading:!1,error:null,frameworkDropdownConfig:{label:"Framework",values:[]},policyDropdownConfig:{label:"Policy",values:[]},subPolicyDropdownConfig:{label:"Sub Policy",values:[]},categoryOptions:{RiskCategory:[],RiskType:[],BusinessUnitsCovered:[],RiskBusinessImpact:[]},tableColumns:[{key:"ComplianceTitle",label:"Title"},{key:"ComplianceItemDescription",label:"Description"},{key:"Status",label:"Status"},{key:"ComplianceVersion",label:"Version"}]}},async created(){await this.loadFrameworks(),await this.loadUsers(),await this.loadCategoryOptions(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},watch:{selectedFrameworkId(e){const a=this.frameworks.find(a=>a.id===e);this.selectedFramework=a||"",a&&(this.loadPolicies(a.id),this.selectedPolicy="",this.selectedPolicyId="",this.selectedSubPolicy="",this.selectedSubPolicyId="",this.policies=[],this.complianceSubPolicies=[],this.complianceList=[])},selectedPolicyId(e){const a=this.policies.find(a=>a.id===e);this.selectedPolicy=a||"",a&&(this.loadSubPolicies(a.id),this.selectedSubPolicy="",this.selectedSubPolicyId="",this.complianceSubPolicies=[],this.complianceList=[])},selectedSubPolicyId(e){const a=this.complianceSubPolicies.find(a=>a.id===e);this.selectedSubPolicy=a||"",a?this.loadCompliances():this.complianceList=[]}},computed:{},methods:{async loadFrameworks(){try{this.loading=!0;const e=await bt.fv.getComplianceFrameworks();let a;if(console.log("Frameworks response:",e.data),e.data.success&&e.data.frameworks)a=e.data.frameworks;else{if(!Array.isArray(e.data))return console.error("Unexpected response format:",e.data),void(this.error="Failed to load frameworks");a=e.data}this.frameworks=a.map(e=>({id:e.id,name:e.name})),console.log("Loaded frameworks:",this.frameworks),this.frameworkDropdownConfig.values=this.frameworks.map(e=>({value:e.id,label:e.name}))}catch(e){this.error="Failed to load frameworks",console.error("Error loading frameworks:",e)}finally{this.loading=!1}},async loadPolicies(e){try{this.loading=!0;const a=await bt.fv.getCompliancePolicies(e);a.data.success&&a.data.policies?(this.policies=a.data.policies.map(e=>({id:e.id,name:e.name,applicability:e.scope||""})),this.policyDropdownConfig.values=this.policies.map(e=>({value:e.id,label:e.name}))):(console.error("Error in response:",a.data),this.error="Failed to load policies")}catch(a){this.error="Failed to load policies",console.error(a)}finally{this.loading=!1}},async loadSubPolicies(e){try{this.loading=!0;const a=await bt.fv.getComplianceSubPolicies(e);console.log("SubPolicies response:",a),a.data.success&&a.data.subpolicies?(console.log("SubPolicies data:",a.data.subpolicies),this.complianceSubPolicies=a.data.subpolicies.map(e=>({id:e.id,name:e.name})),console.log("Mapped complianceSubPolicies:",this.complianceSubPolicies),this.subPolicyDropdownConfig.values=this.complianceSubPolicies.map(e=>({value:e.id,label:e.name}))):(console.error("Error in response:",a.data),this.error="Failed to load sub-policies")}catch(a){this.error="Failed to load sub-policies",console.error("SubPolicies error:",a)}finally{this.loading=!1}},async loadUsers(){try{this.loading=!0;const e=await bt.fv.getUsers();console.log("Users API response:",e),e.data.success&&Array.isArray(e.data.users)?(this.users=e.data.users,console.log("Loaded users:",this.users)):(console.error("Invalid users data received:",e.data),this.error="Failed to load approvers")}catch(e){console.error("Failed to load users:",e),this.error="Failed to load approvers. Please try again."}finally{this.loading=!1}},async loadCategoryOptions(){try{this.loading=!0;const e=await bt.fv.getCategoryBusinessUnits("RiskCategory");e.data.success&&(this.categoryOptions.RiskCategory=e.data.data);const a=await bt.fv.getCategoryBusinessUnits("RiskType");a.data.success&&(this.categoryOptions.RiskType=a.data.data);const t=await bt.fv.getCategoryBusinessUnits("BusinessUnitsCovered");t.data.success&&(this.categoryOptions.BusinessUnitsCovered=t.data.data);const i=await bt.fv.getCategoryBusinessUnits("RiskBusinessImpact");i.data.success&&(this.categoryOptions.RiskBusinessImpact=i.data.data)}catch(e){console.error("Failed to load category options:",e),pv.OQ.error("Failed to load dropdown options. Some features may be limited.")}finally{this.loading=!1}},showDropdown(e){this.activeDropdown=e,this.filterOptions(e),event.stopPropagation()},handleClickOutside(e){const a=document.querySelectorAll(".searchable-dropdown");let t=!0;a.forEach(a=>{a.contains(e.target)&&(t=!1)}),t&&(this.activeDropdown=null)},filterOptions(e){let a="";switch(e){case"BusinessUnitsCovered":a=this.businessUnitSearch||"";break;case"RiskType":a=this.riskTypeSearch||"";break;case"RiskCategory":a=this.riskCategorySearch||"";break;case"RiskBusinessImpact":a=this.riskBusinessImpactSearch||"";break}const t=a.toLowerCase();this.filteredOptions[e]=this.categoryOptions[e].filter(e=>e.value.toLowerCase().includes(t))},selectOption(e,a){switch(this.editRow[e]=a,e){case"BusinessUnitsCovered":this.businessUnitSearch=a;break;case"RiskType":this.riskTypeSearch=a;break;case"RiskCategory":this.riskCategorySearch=a;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch=a;break}this.activeDropdown=null},async addNewOption(e,a){if(a&&a.trim())try{this.loading=!0;const t=await bt.fv.addCategoryBusinessUnit({source:e,value:a.trim()});if(!t.data.success)throw new Error(t.data.error||"Failed to add new option");{const a={id:t.data.data.id,value:t.data.data.value};this.categoryOptions[e]=[...this.categoryOptions[e],a],this.filteredOptions[e]=[...this.filteredOptions[e],a],this.selectOption(e,a.value),this.editRow[e]=a.value,u2.complianceCreated({message:`Added new ${e} option: ${a.value}`}),await this.loadCategoryOptions()}}catch(t){console.error(`Failed to add new ${e} option:`,t),this.error=`Failed to add new option: ${t.message||t}`}finally{this.loading=!1}},async loadCompliances(){if(this.selectedSubPolicy)try{this.loading=!0;const e=await bt.fv.getCompliancesByType("subpolicy",this.selectedSubPolicy.id);console.log("Compliances response:",e),e.data.success&&e.data.compliances?(this.complianceList=e.data.compliances.map(e=>{const a=this.parseMitigationSteps(e.mitigation);return{...e,mitigationSteps:a}}),console.log("Loaded compliances with mitigation steps:",this.complianceList)):(console.error("Error in response:",e.data),this.error="Failed to load compliances")}catch(e){this.error="Failed to load compliances",console.error("Compliances error:",e)}finally{this.loading=!1}},formatDate(e){if(!e)return"";try{let a;if("string"===typeof e)if(e.includes("T"))a=new Date(e);else if(e.includes("-")){const t=e.split(" ")[0].split("-");a=new Date(t[0],t[1]-1,t[2])}else if(e.includes("/")){const t=e.split(" ")[0].split("/");a=new Date(t[2],t[0]-1,t[1])}else a=new Date(e);else a=new Date(e);return a.toLocaleString()}catch(a){return console.error("Error formatting date:",a),e}},viewComplianceDetails(e){u2.showComplianceInfo(e)},getDefaultDueDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},navigateToEdit(e){e.mitigation?(console.log("Original mitigation data:",e.mitigation),e.mitigationSteps=Object.entries(e.mitigation).map(e=>({description:e[1]}))):e.mitigationSteps=[{description:""}],console.log("Initialized mitigation steps:",e.mitigationSteps),this.$router.push(`/compliance/edit/${e.ComplianceId}`)},parseMitigationSteps(e){if(console.log("Parsing mitigation:",e),!e)return[{description:""}];try{if("string"===typeof e)return[{description:e}];if(Array.isArray(e))return e.map(e=>({description:"string"===typeof e?e:e.description||""}));if("object"===typeof e)return Object.values(e).map(e=>({description:"string"===typeof e?e:e.description||""}))}catch(a){console.error("Error parsing mitigation steps:",a)}return[{description:""}]},addStep(e){console.log("Adding step to row:",e),e.mitigationSteps||(e.mitigationSteps=[]),e.mitigationSteps.push({description:""}),this.onMitigationStepChange(e)},removeStep(e,a){console.log("Removing step at index:",a,"from row:",e),e.mitigationSteps.splice(a,1),0===e.mitigationSteps.length&&e.mitigationSteps.push({description:""}),this.onMitigationStepChange(e)},onMitigationStepChange(e){console.log("Mitigation step change triggered for row:",e),console.log("Current mitigation steps:",e.mitigationSteps);const a=e.mitigationSteps.every(e=>e.description.length>=10);if(!a)return void u2.error({message:"Each mitigation step must be at least 10 characters long"});const t={};e.mitigationSteps.forEach((e,a)=>{const i=e.description.trim();i&&(t[`${a+1}`]=i)}),Object.keys(t).length>0?(e.mitigation=t,console.log("Updated mitigation data:",e.mitigation)):(e.mitigation=null,console.log("No valid mitigation steps found, setting to null"))},startCopy(e){this.$router.push({name:"CopyCompliance",params:{id:e.ComplianceId},query:{frameworkId:this.selectedFramework?.id||"",frameworkName:this.selectedFramework?.name||"",policyId:this.selectedPolicy?.id||"",policyName:this.selectedPolicy?.name||"",subPolicyId:this.selectedSubPolicy?.id||"",subPolicyName:this.selectedSubPolicy?.name||""}})},async handleCopySuccess(){await this.loadCompliances(),u2.complianceCreated({message:"Compliance copied successfully"})},onFrameworkChange(e){this.selectedFrameworkId=e.value},onPolicyChange(e){this.selectedPolicyId=e.value},onSubPolicyChange(e){this.selectedSubPolicyId=e.value},async handleSubmit(e){try{if(e.mitigationSteps&&e.mitigationSteps.length>0){const a={};e.mitigationSteps.forEach((e,t)=>{e.description.trim()&&(a[`${t+1}`]=e.description.trim())}),Object.keys(a).length>0&&(e.mitigation=a)}console.log("Submitting form data with mitigation:",e.mitigation),await bt.fv.updateCompliance(e),u2.complianceUpdated(e)}catch(a){console.error("Error submitting form:",a),u2.error({message:`Failed to update compliance: ${a.message||a}`})}}}};const Oie=(0,se.A)($ie,[["render",Nie],["__scopeId","data-v-8aa8a78c"]]);var jie=Oie;const Bie={class:"version-list-container"},Wie={class:"filter-section"},Qie={class:"filter-group"},qie={class:"filter-group"},Kie={class:"filter-group"},Jie={key:0,class:"table-container"},zie={class:"group-header"},Hie={class:"group-description"},Yie={class:"table-wrapper"},Gie={class:"toggle-switch"},Zie=["id","checked","onChange","disabled"],ese=["for"],ase={key:1,class:"no-data"},tse={key:2,class:"error-message"},ise={class:"error-text"},sse={key:3,class:"deactivation-dialog-overlay"},ose={class:"deactivation-dialog"},lse={class:"deactivation-options"},nse={key:0,class:"affected-count"},rse={class:"deactivation-actions"},cse={key:4,class:"deactivation-dialog-overlay"},dse={class:"deactivation-dialog"},use={class:"deactivation-actions"};function pse(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",Bie,[a[17]||(a[17]=(0,s.Lk)("div",{class:"version-list-header"},[(0,s.Lk)("h2",{class:"version-list-heading"},"Compliance Version List")],-1)),(0,s.Lk)("div",Wie,[(0,s.Lk)("div",Qie,[(0,s.bF)(r,{config:l.frameworkDropdownConfig,modelValue:l.selectedFramework,"onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedFramework=e),onChange:n.onFrameworkChange},null,8,["config","modelValue","onChange"])]),(0,s.Lk)("div",qie,[(0,s.bF)(r,{config:l.policyDropdownConfig,modelValue:l.selectedPolicy,"onUpdate:modelValue":a[1]||(a[1]=e=>l.selectedPolicy=e),onChange:n.onPolicyChange,disabled:!l.selectedFramework},null,8,["config","modelValue","onChange","disabled"])]),(0,s.Lk)("div",Kie,[(0,s.bF)(r,{config:l.subPolicyDropdownConfig,modelValue:l.selectedSubPolicy,"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedSubPolicy=e),onChange:n.onSubPolicyChange,disabled:!l.selectedPolicy},null,8,["config","modelValue","onChange","disabled"])])]),n.groupedCompliances.length>0?((0,s.uX)(),(0,s.CE)("div",Jie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.groupedCompliances,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"compliance-group"},[(0,s.Lk)("div",zie,[(0,s.Lk)("h3",null,"Compliance ID: "+(0,d.v_)(e[0].Identifier),1),(0,s.Lk)("div",Hie,(0,d.v_)(e[0].ComplianceItemDescription),1)]),(0,s.Lk)("div",Yie,[(0,s.bF)(c,{data:e,columns:l.tableColumns,showPagination:!1},{"cell-ActiveInactive":(0,s.k6)(({row:e})=>[(0,s.Lk)("div",Gie,[(0,s.Lk)("input",{type:"checkbox",id:"toggle-"+e.ComplianceId,checked:"Active"===e.ActiveInactive,onChange:a=>n.toggleActiveStatus(e),disabled:"Approved"!==e.Status},null,40,Zie),(0,s.Lk)("label",{for:"toggle-"+e.ComplianceId},null,8,ese)])]),"cell-CreatedByDate":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(n.formatDate(e.CreatedByDate)),1)]),"cell-PreviousComplianceVersionId":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(n.getPreviousVersionDisplay(e)),1)]),_:2},1032,["data","columns"])])]))),128))])):l.selectedSubPolicy?((0,s.uX)(),(0,s.CE)("div",ase," No compliances found for the selected criteria ")):(0,s.Q3)("",!0),l.error?((0,s.uX)(),(0,s.CE)("div",tse,[a[9]||(a[9]=(0,s.Lk)("div",{class:"error-icon"},"âš ï¸",-1)),(0,s.Lk)("div",ise,(0,d.v_)(l.error),1),(0,s.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>n.refreshCurrentData&&n.refreshCurrentData(...e)),class:"retry-button"},"Retry")])):(0,s.Q3)("",!0),l.showDeactivationDialog?((0,s.uX)(),(0,s.CE)("div",sse,[(0,s.Lk)("div",ose,[a[11]||(a[11]=(0,s.Lk)("h3",null,"Deactivate Compliance",-1)),a[12]||(a[12]=(0,s.Lk)("p",null,"Please provide a reason for deactivating this compliance:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[4]||(a[4]=e=>l.deactivationReason=e),class:"deactivation-reason-input",placeholder:"Enter reason for deactivation"},"        ",512),[[i.Jo,l.deactivationReason]]),(0,s.Lk)("div",lse,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[5]||(a[5]=e=>l.cascadeToPolicies=e)},null,512),[[i.lH,l.cascadeToPolicies]]),a[10]||(a[10]=(0,s.eW)(" Apply to related policies "))]),l.cascadeToPolicies?((0,s.uX)(),(0,s.CE)("div",nse,(0,d.v_)(l.affectedPoliciesCount||0)+" policies will be affected ",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",rse,[(0,s.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>n.cancelDeactivation&&n.cancelDeactivation(...e)),class:"cancel-btn"},"Cancel"),(0,s.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>n.submitDeactivation&&n.submitDeactivation(...e)),class:"submit-btn"},"OK")])])])):(0,s.Q3)("",!0),l.showDeactivationConfirmation?((0,s.uX)(),(0,s.CE)("div",cse,[(0,s.Lk)("div",dse,[a[13]||(a[13]=(0,s.Lk)("h3",null,"Deactivation Request Submitted",-1)),a[14]||(a[14]=(0,s.Lk)("p",null,"Your request to deactivate this compliance item has been submitted successfully and is awaiting approval.",-1)),a[15]||(a[15]=(0,s.Lk)("p",null,"The compliance will remain active until an approver reviews and accepts this request.",-1)),a[16]||(a[16]=(0,s.Lk)("div",{class:"approval-info"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("span",null,"You can check the status of this request in the Compliance Approver interface.")],-1)),(0,s.Lk)("div",use,[(0,s.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>n.closeDeactivationConfirmation&&n.closeDeactivationConfirmation(...e)),class:"submit-btn"},"OK")])])])):(0,s.Q3)("",!0)])}var vse={name:"ComplianceVersionList",components:{CustomDropdown:mt.A,DynamicTable:Ll.A},data(){return{frameworks:[],policies:[],subPolicies:[],compliances:[],selectedFramework:"",selectedPolicy:"",selectedSubPolicy:"",loading:!1,searchQuery:"",showDeactivationDialog:!1,deactivationReason:"",cascadeToPolicies:!0,affectedPoliciesCount:0,complianceToDeactivate:null,showDeactivationConfirmation:!1,error:null,frameworkDropdownConfig:{values:[],defaultLabel:"Select Framework",name:"Framework"},policyDropdownConfig:{values:[],defaultLabel:"Select Policy",name:"Policy"},subPolicyDropdownConfig:{values:[],defaultLabel:"Select Sub Policy",name:"Sub Policy"},tableColumns:[{key:"ComplianceVersion",label:"Version"},{key:"Status",label:"Status"},{key:"ActiveInactive",label:"Active/Inactive",slot:!0},{key:"CreatedByName",label:"Created By"},{key:"CreatedByDate",label:"Created Date",slot:!0},{key:"PreviousComplianceVersionId",label:"Previous Version",slot:!0}]}},computed:{groupedCompliances(){let e=this.compliances;if(this.searchQuery){const a=this.searchQuery.toLowerCase();e=e.filter(e=>e.Identifier&&e.Identifier.toLowerCase().includes(a)||e.ComplianceItemDescription&&e.ComplianceItemDescription.toLowerCase().includes(a))}const a={};return e.forEach(e=>{a[e.Identifier]||(a[e.Identifier]=[]),a[e.Identifier].push(e)}),Object.values(a).map(e=>e.sort((e,a)=>{const t=parseFloat(e.ComplianceVersion),i=parseFloat(a.ComplianceVersion);return i-t}))}},mounted(){try{this.loadFrameworks()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceVersioningDenied();throw e}},methods:{async loadFrameworks(){try{this.loading=!0;const e=await bt.fv.getComplianceFrameworks();console.log("Frameworks API response:",e.data);let a=[];e.data.success&&e.data.frameworks?a=e.data.frameworks:e.data.success&&Array.isArray(e.data.data)?a=e.data.data:Array.isArray(e.data)?a=e.data:console.error("Unexpected response format:",e.data),this.frameworks=a.map(e=>({FrameworkId:e.id,FrameworkName:e.name,Category:e.category||"",Status:e.status||"",Description:e.description||""})),console.log("Mapped frameworks:",this.frameworks),this.frameworkDropdownConfig.values=this.frameworks.map(e=>({value:e.FrameworkId,label:e.FrameworkName}))}catch(e){if(console.error("Error loading frameworks:",e),e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceFrameworkDenied();this.error="Failed to load frameworks"}finally{this.loading=!1}},async loadPolicies(){if(!this.selectedFramework)return this.policies=[],void(this.selectedPolicy="");console.log("Calling getCompliancePolicies with ID:",this.selectedFramework);try{this.loading=!0;const e=await bt.fv.getCompliancePolicies(this.selectedFramework);console.log("Policies API response:",e.data);let a=[];e.data.success&&e.data.policies?a=e.data.policies:e.data.success&&Array.isArray(e.data.data)?a=e.data.data:Array.isArray(e.data)?a=e.data:console.error("Unexpected response format:",e.data),this.policies=a.map(e=>({PolicyId:e.id,PolicyName:e.name,Applicability:e.applicability||e.scope||"",Status:e.status||""})),console.log("Mapped policies:",this.policies),this.policyDropdownConfig.values=this.policies.map(e=>({value:e.PolicyId,label:e.PolicyName})),this.selectedPolicy="",this.selectedSubPolicy=""}catch(e){if(console.error("Error loading policies:",e),e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePolicyDenied();this.error="Failed to load policies"}finally{this.loading=!1}},async loadSubPolicies(){if(!this.selectedPolicy)return this.subPolicies=[],void(this.selectedSubPolicy="");try{this.loading=!0;const e=await bt.fv.getComplianceSubPolicies(this.selectedPolicy);console.log("SubPolicies API response:",e.data);let a=[];e.data.success&&e.data.subpolicies?a=e.data.subpolicies:e.data.success&&Array.isArray(e.data.data)?a=e.data.data:Array.isArray(e.data)?a=e.data:console.error("Unexpected response format:",e.data),this.subPolicies=a.map(e=>({SubPolicyId:e.id,SubPolicyName:e.name,Status:e.status||"",Description:e.description||"",Control:e.control||"",Identifier:e.identifier||""})),console.log("Mapped subpolicies:",this.subPolicies),this.subPolicyDropdownConfig.values=this.subPolicies.map(e=>({value:e.SubPolicyId,label:e.SubPolicyName})),this.selectedSubPolicy=""}catch(e){if(console.error("Error loading subpolicies:",e),e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceSubpolicyDenied();this.error="Failed to load subpolicies"}finally{this.loading=!1}},async loadCompliances(){if(this.selectedSubPolicy)try{this.loading=!0,console.log(`Loading compliances for subpolicy ID: ${this.selectedSubPolicy}`);const e=await bt.fv.getCompliancesBySubPolicy(this.selectedSubPolicy);console.log("Compliance API response:",e.data),e.data.success?(Array.isArray(e.data.data)?this.compliances=e.data.data.flat():e.data.compliances&&Array.isArray(e.data.compliances)?this.compliances=e.data.compliances:(console.error("Unexpected data structure:",e.data),this.compliances=[]),this.compliances.length>0?(console.log("First compliance record:",this.compliances[0]),console.log("PreviousComplianceVersionId exists:",this.compliances.some(e=>void 0!==e.PreviousComplianceVersionId)),console.log("Compliance record keys:",Object.keys(this.compliances[0])),this.compliances=this.compliances.map(e=>void 0!==e.PreviousVersionId&&void 0===e.PreviousComplianceVersionId?{...e,PreviousComplianceVersionId:e.PreviousVersionId}:e)):console.log("No compliances returned from API")):(console.error("Error in response:",e.data),this.error=e.data.message||"Failed to load compliances")}catch(e){if(console.error("Error loading compliances:",e),e.response&&[401,403].includes(e.response.status))return void ht.Ay.showComplianceViewDenied();if(e.response&&500===e.response.status){console.error("Server error (500):",e.response.data),this.error="Server error: The compliance data could not be loaded. Please try again later or contact support.";try{console.log("Attempting to use alternative endpoint...");const e=await bt.fv.getCompliancesByType("subpolicy",this.selectedSubPolicy);e.data.success&&e.data.compliances&&(this.compliances=e.data.compliances,this.error=null,console.log("Successfully loaded compliances from alternative endpoint"))}catch(a){if(console.error("Alternative endpoint also failed:",a),a.response&&[401,403].includes(a.response.status))return void ht.Ay.showComplianceViewDenied()}}else this.error=e.message||"Failed to load compliances"}finally{this.loading=!1}else this.compliances=[]},async toggleActiveStatus(e){if("Approved"===e.Status){if("Active"===e.ActiveInactive)return this.complianceToDeactivate=e,this.deactivationReason="",this.cascadeToPolicies=!0,this.showDeactivationDialog=!0,void(document.getElementById(`toggle-${e.ComplianceId}`).checked=!0);try{let i;this.loading=!0,this.error=null,console.log(`Toggling compliance ${e.ComplianceId} to Active`);try{i=await bt.fv.toggleComplianceVersion(e.ComplianceId),console.log("Toggle response from primary endpoint:",i.data)}catch(a){if(console.error("Primary endpoint failed:",a),!a.response||404!==a.response.status)throw a;{console.log("Trying alternative toggle endpoint...");const a={compliance_id:e.ComplianceId,new_status:"Active"===e.ActiveInactive?"Inactive":"Active"};try{i=await qe.A.post(`/api/compliance/${e.ComplianceId}/toggle/`,a),console.log("Toggle response from alternative endpoint:",i.data)}catch(t){throw console.error("Alternative endpoint also failed:",t),t}}}if(i&&i.data&&i.data.success)console.log(`Successfully toggled compliance to ${i.data.new_status}`),await this.loadCompliances();else{const a=i&&i.data&&i.data.message||"Error toggling compliance status";console.error("Error in toggle response:",a),this.error=`Failed to toggle compliance status: ${a}`;const t=document.getElementById(`toggle-${e.ComplianceId}`);t&&(t.checked="Active"===e.ActiveInactive)}}catch(i){if(console.error("Error toggling compliance status:",i),i.response&&[401,403].includes(i.response.status)){ht.Ay.showComplianceToggleDenied();const a=document.getElementById(`toggle-${e.ComplianceId}`);return void(a&&(a.checked="Active"===e.ActiveInactive))}let a="Error toggling compliance status";i.response?(console.error("Error response:",i.response.data),a+=`: ${i.response.data.message||i.response.statusText}`):i.request?(console.error("Error request:",i.request),a+=" - No response received from server"):a+=`: ${i.message}`,this.error=a;const t=document.getElementById(`toggle-${e.ComplianceId}`);t&&(t.checked="Active"===e.ActiveInactive)}finally{this.loading=!1}}else alert("Only approved compliances can be toggled")},async submitDeactivation(){if(this.complianceToDeactivate)if(this.deactivationReason.trim())try{this.loading=!0,console.log("Submitting deactivation request for compliance:",this.complianceToDeactivate.ComplianceId);const e=await bt.fv.deactivateCompliance(this.complianceToDeactivate.ComplianceId,{reason:this.deactivationReason,cascade_to_policies:this.cascadeToPolicies,user_id:1,reviewer_id:2});e.data.success?(this.showDeactivationDialog=!1,this.showDeactivationConfirmation=!0,await this.loadCompliances(),console.log("Deactivation request submitted successfully with approval ID:",e.data.approval_id)):alert(e.data.message||"Error submitting deactivation request")}catch(e){if(console.error("Error submitting deactivation request:",e),e.response&&[401,403].includes(e.response.status))return ht.Ay.showComplianceDeactivateDenied(),this.showDeactivationDialog=!1,void(this.complianceToDeactivate=null);const a=e.response?.data?.message||e.message||"Error submitting deactivation request";alert(`Error: ${a}`)}finally{this.loading=!1}else alert("Please provide a reason for deactivation")},cancelDeactivation(){this.showDeactivationDialog=!1,this.complianceToDeactivate=null},closeDeactivationConfirmation(){this.showDeactivationConfirmation=!1},formatDate(e){return e?new Date(e).toLocaleDateString():"N/A"},getPreviousVersionDisplay(e){if(!e.PreviousComplianceVersionId)return"None";const a=this.compliances.find(a=>a.ComplianceId===e.PreviousComplianceVersionId);return a?`v${a.ComplianceVersion}`:`ID: ${e.PreviousComplianceVersionId}`},handleSearch(){},refreshCurrentData(){this.error=null,this.selectedSubPolicy?this.loadCompliances():this.selectedPolicy?this.loadSubPolicies():this.selectedFramework?this.loadPolicies():this.loadFrameworks()},onFrameworkChange(e){this.selectedFramework=e.value,this.loadPolicies()},onPolicyChange(e){this.selectedPolicy=e.value,this.loadSubPolicies()},onSubPolicyChange(e){this.selectedSubPolicy=e.value,this.loadCompliances()}}};const mse=(0,se.A)(vse,[["render",pse],["__scopeId","data-v-728381e2"]]);var kse=mse;const hse={class:"kpi-dashboard"},gse={class:"kpi-card"},yse={key:0,class:"error-message"},fse={key:1,class:"loading-overlay"},bse={key:2},Cse={class:"kpi-chart"},Lse={class:"maturity-grid"},wse={class:"maturity-label"},Ese={class:"maturity-count"},Rse={class:"total-count"},Dse={class:"kpi-card status-overview-card"},Ise={key:0,class:"error-message"},Pse={key:1,class:"loading-overlay"},_se={key:2,class:"status-overview-content"},Sse={class:"status-chart-container"},Ase={class:"status-stats"},Tse={class:"status-stat-value"},xse={class:"status-stat-label"},Fse={class:"status-stat-percentage"},Vse={class:"kpi-card non-compliance-card"},Mse={key:0,class:"error-message"},Xse={key:1,class:"loading-overlay"},Use={key:2},Nse={class:"non-compliance-badge"},$se={class:"kpi-card mitigated-risks-card"},Ose={key:0,class:"error-message"},jse={key:1,class:"loading-overlay"},Bse={key:2},Wse={class:"mitigated-badge"},Qse={class:"kpi-card automated-controls-card"},qse={key:0,class:"error-message"},Kse={key:1,class:"loading-overlay"},Jse={key:2},zse={class:"automated-chart-container"},Hse={class:"automated-stats"},Yse={class:"stat-item"},Gse={class:"stat-value automated-stat"},Zse={class:"stat-item"},eoe={class:"stat-value manual-stat"},aoe={class:"kpi-card repetitions-card"},toe={key:0,class:"error-message"},ioe={key:1,class:"loading-overlay"},soe={key:2},ooe={class:"repetitions-chart-container"},loe={class:"repetitions-stats"},noe={class:"repetition-stat-item"},roe={class:"repetition-stat-value"},coe={class:"repetition-stat-item"},doe={class:"repetition-stat-value"},uoe={class:"repetition-stat-item"},poe={class:"repetition-stat-value"},voe={class:"kpi-card ontime-mitigation-card"},moe={key:0,class:"error-message"},koe={key:1,class:"loading-overlay"},hoe={key:2,class:"ontime-mitigation-content"},goe={class:"percentage-value"},yoe={class:"ontime-stats"},foe={class:"ontime-stat-item"},boe={class:"stat-value"},Coe={class:"ontime-stat-item"},Loe={class:"stat-value"},woe={class:"ontime-stat-item"},Eoe={class:"stat-value"},Roe={class:"kpi-card reputational-impact-card"},Doe={key:0,class:"error-message"},Ioe={key:1,class:"loading-overlay"},Poe={key:2,class:"reputational-impact-content"},_oe={class:"reputational-chart-container"},Soe={class:"impact-stats"},Aoe={class:"impact-stat-value"},Toe={class:"impact-stat-label"},xoe={class:"impact-stat-percentage"},Foe={class:"kpi-card remediation-cost-card"},Voe={key:0,class:"error-message"},Moe={key:1,class:"loading-overlay"},Xoe={key:2,class:"remediation-cost-content"},Uoe={class:"cost-summary"},Noe={class:"total-cost"},$oe={class:"cost-value"},Ooe={class:"avg-cost"},joe={class:"cost-value"},Boe={class:"remediation-chart-container"},Woe={key:0,class:"cost-categories"},Qoe={class:"category-name"},qoe={class:"category-cost"},Koe={class:"kpi-card non-compliant-incidents-card"},Joe={class:"kpi-header"},zoe={class:"period-selector"},Hoe={key:0,class:"error-message"},Yoe={key:1,class:"loading-overlay"},Goe={key:2,class:"non-compliant-incidents-content"},Zoe={class:"incidents-summary"},ele={class:"incidents-count"},ale={class:"count-value"},tle={class:"count-period"},ile={class:"unique-incidents"},sle={class:"unique-value"},ole={class:"incidents-chart-container"},lle={key:0,class:"top-incidents"},nle={class:"incident-rank"},rle={class:"incident-details"},cle={class:"incident-description"},dle={class:"incident-meta"},ule={class:"incident-criticality"},ple={class:"incident-count"};function vle(e,a,t,o,l,n){const r=(0,s.g2)("Bar"),c=(0,s.g2)("Doughnut"),u=(0,s.g2)("Pie"),p=(0,s.g2)("LineChart");return(0,s.uX)(),(0,s.CE)("div",hse,[(0,s.Lk)("div",gse,[a[13]||(a[13]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Maturity Level Distribution")],-1)),l.error?((0,s.uX)(),(0,s.CE)("div",yse,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>n.fetchMaturityData&&n.fetchMaturityData(...e))},"Retry")])):l.loading?((0,s.uX)(),(0,s.CE)("div",fse,a[12]||(a[12]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",bse,[(0,s.Lk)("div",Cse,[l.chartData?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:l.chartData,options:l.chartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Lse,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.maturityLevels,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"maturity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["maturity-color",e.toLowerCase()])},null,2),(0,s.Lk)("span",wse,(0,d.v_)(e),1),(0,s.Lk)("span",Ese,(0,d.v_)(n.getMaturityCount(e)),1)]))),128))]),(0,s.Lk)("div",Rse," Total Active & Approved: "+(0,d.v_)(n.getTotalCompliances()),1)]))]),(0,s.Lk)("div",Dse,[a[15]||(a[15]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Compliance Status Overview")],-1)),l.statusOverviewError?((0,s.uX)(),(0,s.CE)("div",Ise,[(0,s.eW)((0,d.v_)(l.statusOverviewError)+" ",1),(0,s.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>n.fetchStatusOverview&&n.fetchStatusOverview(...e))},"Retry")])):l.statusOverviewLoading?((0,s.uX)(),(0,s.CE)("div",Pse,a[14]||(a[14]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",_se,[(0,s.Lk)("div",Sse,[l.statusOverviewChartData?((0,s.uX)(),(0,s.Wv)(c,{key:0,data:l.statusOverviewChartData,options:l.statusOverviewChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Ase,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.statusOverviewData.counts,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["status-stat-item",a.toLowerCase().replace(" ","-")])},[(0,s.Lk)("div",Tse,(0,d.v_)(e),1),(0,s.Lk)("div",xse,(0,d.v_)(a),1),(0,s.Lk)("div",Fse,(0,d.v_)(l.statusOverviewData.percentages[a])+"%",1)],2))),128))])]))]),(0,s.Lk)("div",Vse,[a[18]||(a[18]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Non-Compliance Count")],-1)),l.nonComplianceError?((0,s.uX)(),(0,s.CE)("div",Mse,[(0,s.eW)((0,d.v_)(l.nonComplianceError)+" ",1),(0,s.Lk)("button",{onClick:a[2]||(a[2]=(...e)=>n.fetchNonComplianceCount&&n.fetchNonComplianceCount(...e))},"Retry")])):l.nonComplianceLoading?((0,s.uX)(),(0,s.CE)("div",Xse,a[16]||(a[16]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Use,[(0,s.Lk)("div",Nse,(0,d.v_)(l.nonComplianceCount),1),a[17]||(a[17]=(0,s.Lk)("div",{class:"non-compliance-label"}," Total Non-Compliant Items ",-1))]))]),(0,s.Lk)("div",$se,[a[21]||(a[21]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Mitigated Risks")],-1)),l.mitigatedError?((0,s.uX)(),(0,s.CE)("div",Ose,[(0,s.eW)((0,d.v_)(l.mitigatedError)+" ",1),(0,s.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>n.fetchMitigatedCount&&n.fetchMitigatedCount(...e))},"Retry")])):l.mitigatedLoading?((0,s.uX)(),(0,s.CE)("div",jse,a[19]||(a[19]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Bse,[(0,s.Lk)("div",Wse,(0,d.v_)(l.mitigatedCount),1),a[20]||(a[20]=(0,s.Lk)("div",{class:"mitigated-label"}," Total Mitigated Risks ",-1))]))]),(0,s.Lk)("div",Qse,[a[25]||(a[25]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Controls Distribution")],-1)),l.automatedError?((0,s.uX)(),(0,s.CE)("div",qse,[(0,s.eW)((0,d.v_)(l.automatedError)+" ",1),(0,s.Lk)("button",{onClick:a[4]||(a[4]=(...e)=>n.fetchAutomatedCount&&n.fetchAutomatedCount(...e))},"Retry")])):l.automatedLoading?((0,s.uX)(),(0,s.CE)("div",Kse,a[22]||(a[22]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Jse,[(0,s.Lk)("div",zse,[l.automatedChartData?((0,s.uX)(),(0,s.Wv)(u,{key:0,data:l.automatedChartData,options:l.automatedChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Hse,[(0,s.Lk)("div",Yse,[(0,s.Lk)("div",Gse,(0,d.v_)(l.automatedData.automated_percentage)+"% ",1),a[23]||(a[23]=(0,s.Lk)("div",{class:"stat-label"}," Automated ",-1))]),(0,s.Lk)("div",Zse,[(0,s.Lk)("div",eoe,(0,d.v_)(l.automatedData.manual_percentage)+"% ",1),a[24]||(a[24]=(0,s.Lk)("div",{class:"stat-label"}," Manual ",-1))])])]))]),(0,s.Lk)("div",aoe,[a[30]||(a[30]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Non-Compliance Repetitions")],-1)),l.repetitionsError?((0,s.uX)(),(0,s.CE)("div",toe,[(0,s.eW)((0,d.v_)(l.repetitionsError)+" ",1),(0,s.Lk)("button",{onClick:a[5]||(a[5]=(...e)=>n.fetchRepetitionsData&&n.fetchRepetitionsData(...e))},"Retry")])):l.repetitionsLoading?((0,s.uX)(),(0,s.CE)("div",ioe,a[26]||(a[26]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",soe,[(0,s.Lk)("div",ooe,[l.repetitionsChartData?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:l.repetitionsChartData,options:l.repetitionsChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",loe,[(0,s.Lk)("div",noe,[(0,s.Lk)("div",roe,(0,d.v_)(l.repetitionsData.total_items),1),a[27]||(a[27]=(0,s.Lk)("div",{class:"repetition-stat-label"}," Total Items ",-1))]),(0,s.Lk)("div",coe,[(0,s.Lk)("div",doe,(0,d.v_)(l.repetitionsData.max_repetitions),1),a[28]||(a[28]=(0,s.Lk)("div",{class:"repetition-stat-label"}," Max Repetitions ",-1))]),(0,s.Lk)("div",uoe,[(0,s.Lk)("div",poe,(0,d.v_)(l.repetitionsData.avg_repetitions),1),a[29]||(a[29]=(0,s.Lk)("div",{class:"repetition-stat-label"}," Avg Repetitions ",-1))])])]))]),(0,s.Lk)("div",voe,[a[36]||(a[36]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"On-Time Mitigation Rate")],-1)),l.ontimeMitigationError?((0,s.uX)(),(0,s.CE)("div",moe,[(0,s.eW)((0,d.v_)(l.ontimeMitigationError)+" ",1),(0,s.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>n.fetchOntimeMitigationData&&n.fetchOntimeMitigationData(...e))},"Retry")])):l.ontimeMitigationLoading?((0,s.uX)(),(0,s.CE)("div",koe,a[31]||(a[31]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",hoe,[(0,s.Lk)("div",{class:(0,d.C4)(["ontime-percentage-circle",{"high-rate":l.ontimeMitigationData.on_time_percentage>=70}])},[(0,s.Lk)("div",goe,(0,d.v_)(Math.round(l.ontimeMitigationData.on_time_percentage))+"%",1),a[32]||(a[32]=(0,s.Lk)("div",{class:"percentage-label"},"On Time",-1))],2),(0,s.Lk)("div",yoe,[(0,s.Lk)("div",foe,[(0,s.Lk)("div",boe,(0,d.v_)(l.ontimeMitigationData.completed_on_time),1),a[33]||(a[33]=(0,s.Lk)("div",{class:"stat-label"},"On Time",-1))]),(0,s.Lk)("div",Coe,[(0,s.Lk)("div",Loe,(0,d.v_)(l.ontimeMitigationData.completed_late),1),a[34]||(a[34]=(0,s.Lk)("div",{class:"stat-label"},"Late",-1))]),(0,s.Lk)("div",woe,[(0,s.Lk)("div",Eoe,(0,d.v_)(l.ontimeMitigationData.total_completed),1),a[35]||(a[35]=(0,s.Lk)("div",{class:"stat-label"},"Total",-1))])])]))]),(0,s.Lk)("div",Roe,[a[38]||(a[38]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Reputational Impact Assessment")],-1)),l.reputationalError?((0,s.uX)(),(0,s.CE)("div",Doe,[(0,s.eW)((0,d.v_)(l.reputationalError)+" ",1),(0,s.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>n.fetchReputationalData&&n.fetchReputationalData(...e))},"Retry")])):l.reputationalLoading?((0,s.uX)(),(0,s.CE)("div",Ioe,a[37]||(a[37]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Poe,[(0,s.Lk)("div",_oe,[l.reputationalChartData?((0,s.uX)(),(0,s.Wv)(p,{key:0,data:l.reputationalChartData,options:l.reputationalChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Soe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.reputationalData.impact_counts,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,d.C4)(["impact-stat-item",a])},[(0,s.Lk)("div",Aoe,(0,d.v_)(e),1),(0,s.Lk)("div",Toe,(0,d.v_)(a.charAt(0).toUpperCase()+a.slice(1)),1),(0,s.Lk)("div",xoe,(0,d.v_)(Math.round(l.reputationalData.impact_percentages[a]))+"%",1)],2))),128))])]))]),(0,s.Lk)("div",Foe,[a[43]||(a[43]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Remediation Cost Analysis")],-1)),l.remediationCostError?((0,s.uX)(),(0,s.CE)("div",Voe,[(0,s.eW)((0,d.v_)(l.remediationCostError)+" ",1),(0,s.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>n.fetchRemediationCost&&n.fetchRemediationCost(...e))},"Retry")])):l.remediationCostLoading?((0,s.uX)(),(0,s.CE)("div",Moe,a[39]||(a[39]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Xoe,[(0,s.Lk)("div",Uoe,[(0,s.Lk)("div",Noe,[(0,s.Lk)("div",$oe,"$"+(0,d.v_)(n.formatNumber(l.remediationCostData.cost_summary.total_cost)),1),a[40]||(a[40]=(0,s.Lk)("div",{class:"cost-label"},"Total Cost",-1))]),(0,s.Lk)("div",Ooe,[(0,s.Lk)("div",joe,"$"+(0,d.v_)(n.formatNumber(l.remediationCostData.cost_summary.average_cost)),1),a[41]||(a[41]=(0,s.Lk)("div",{class:"cost-label"},"Average Cost",-1))])]),(0,s.Lk)("div",Boe,[l.remediationCostChartData?((0,s.uX)(),(0,s.Wv)(p,{key:0,data:l.remediationCostChartData,options:l.remediationCostChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),l.remediationCostData.category_chart.labels.length>0?((0,s.uX)(),(0,s.CE)("div",Woe,[a[42]||(a[42]=(0,s.Lk)("div",{class:"category-label"},"Top Categories:",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.remediationCostData.category_chart.labels.slice(0,3),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"category-item"},[(0,s.Lk)("span",Qoe,(0,d.v_)(e),1),(0,s.Lk)("span",qoe,"$"+(0,d.v_)(n.formatNumber(l.remediationCostData.category_chart.values[a])),1)]))),128))])):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",Koe,[(0,s.Lk)("div",Joe,[a[45]||(a[45]=(0,s.Lk)("h3",{class:"kpi-title"},"Non-Compliant Incidents",-1)),(0,s.Lk)("div",zoe,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[9]||(a[9]=e=>l.selectedPeriod=e),onChange:a[10]||(a[10]=(...e)=>n.fetchNonCompliantIncidents&&n.fetchNonCompliantIncidents(...e)),class:"period-dropdown"},a[44]||(a[44]=[(0,s.Lk)("option",{value:"week"},"Last 7 Days",-1),(0,s.Lk)("option",{value:"month"},"Last 30 Days",-1),(0,s.Lk)("option",{value:"quarter"},"Last 3 Months",-1),(0,s.Lk)("option",{value:"year"},"Last 12 Months",-1)]),544),[[i.u1,l.selectedPeriod]])])]),l.nonCompliantIncidentsError?((0,s.uX)(),(0,s.CE)("div",Hoe,[(0,s.eW)((0,d.v_)(l.nonCompliantIncidentsError)+" ",1),(0,s.Lk)("button",{onClick:a[11]||(a[11]=(...e)=>n.fetchNonCompliantIncidents&&n.fetchNonCompliantIncidents(...e))},"Retry")])):l.nonCompliantIncidentsLoading?((0,s.uX)(),(0,s.CE)("div",Yoe,a[46]||(a[46]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Goe,[(0,s.Lk)("div",Zoe,[(0,s.Lk)("div",ele,[(0,s.Lk)("div",ale,(0,d.v_)(l.nonCompliantIncidentsData.non_compliant_count),1),a[48]||(a[48]=(0,s.Lk)("div",{class:"count-label"},"Non-Compliant Incidents",-1)),(0,s.Lk)("div",tle,(0,d.v_)(l.nonCompliantIncidentsData.period),1),(0,s.Lk)("div",{class:(0,d.C4)(["count-change",{positive:l.nonCompliantIncidentsData.percentage_change.startsWith("+"),negative:!l.nonCompliantIncidentsData.percentage_change.startsWith("+")}])},[(0,s.eW)((0,d.v_)(l.nonCompliantIncidentsData.percentage_change)+" ",1),a[47]||(a[47]=(0,s.Lk)("span",{class:"change-label"},"vs previous period",-1))],2)]),(0,s.Lk)("div",ile,[(0,s.Lk)("div",sle,(0,d.v_)(l.nonCompliantIncidentsData.unique_compliance_items),1),a[49]||(a[49]=(0,s.Lk)("div",{class:"unique-label"},"Unique Items",-1))])]),(0,s.Lk)("div",ole,[l.nonCompliantIncidentsChartData?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:l.nonCompliantIncidentsChartData,options:l.nonCompliantIncidentsChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),l.nonCompliantIncidentsData.top_non_compliant_items.length>0?((0,s.uX)(),(0,s.CE)("div",lle,[a[50]||(a[50]=(0,s.Lk)("div",{class:"top-incidents-header"},"Top Non-Compliant Items",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.nonCompliantIncidentsData.top_non_compliant_items.slice(0,3),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["top-incident-item",n.getCriticalityClass(e.criticality)]),key:e.compliance_id},[(0,s.Lk)("div",nle,(0,d.v_)(a+1),1),(0,s.Lk)("div",rle,[(0,s.Lk)("div",cle,(0,d.v_)(n.truncateText(e.description,50)),1),(0,s.Lk)("div",dle,[(0,s.Lk)("span",ule,(0,d.v_)(e.criticality),1),(0,s.Lk)("span",ple,(0,d.v_)(e.count)+" occurrences",1)])])],2))),128))])):(0,s.Q3)("",!0)]))])])}ze.t1.register(ze.hE,ze.m_,ze.s$,ze.E8,ze.PP,ze.kc,ze.Bs,ze.FN,ze.No);var mle={name:"ComplianceKPI",components:{Bar:He.yP,Pie:He.Fq,Doughnut:He.nu,LineChart:He.N1},data(){return{loading:!0,error:null,maturityLevels:["Initial","Developing","Defined","Managed","Optimizing"],maturityData:null,chartData:null,chartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:8,titleFont:{size:13},bodyFont:{size:12},callbacks:{label:function(e){return`Count: ${e.raw}`}}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"#f1f5f9",drawBorder:!1},ticks:{precision:0,color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:10}}}}},nonComplianceLoading:!0,nonComplianceError:null,nonComplianceCount:0,mitigatedLoading:!0,mitigatedError:null,mitigatedCount:0,automatedLoading:!0,automatedError:null,automatedData:null,automatedChartData:null,automatedChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:8,callbacks:{label:function(e){return`${e.label}: ${e.raw}%`}}}}},repetitionsLoading:!0,repetitionsError:null,repetitionsData:null,repetitionsChartData:null,repetitionsChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:8,callbacks:{label:function(e){return`Occurrences: ${e.raw}`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Items",color:"#64748b"},ticks:{precision:0,color:"#64748b"}},x:{title:{display:!0,text:"Number of Repetitions",color:"#64748b"},ticks:{color:"#64748b"}}}},ontimeMitigationLoading:!0,ontimeMitigationError:null,ontimeMitigationData:{on_time_percentage:0,total_completed:0,completed_on_time:0,completed_late:0},statusOverviewLoading:!0,statusOverviewError:null,statusOverviewData:{counts:{},percentages:{},total:0},statusOverviewChartData:null,statusOverviewChartOptions:{responsive:!0,maintainAspectRatio:!1,cutout:"75%",radius:"90%",plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,boxPadding:6,usePointStyle:!0,callbacks:{label:function(e){const a=e.raw,t=e.dataset,i=e.label;return[`${i}: ${a.toFixed(1)}%`,`Count: ${t.data[e.dataIndex]}`]}}}},animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeOutQuart"}},reputationalLoading:!0,reputationalError:null,reputationalData:{impact_counts:{},impact_percentages:{},timeline_data:{dates:[],low:[],medium:[],high:[]},total_risks:0},reputationalChartData:null,reputationalChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,usePointStyle:!0,callbacks:{label:function(e){return`${e.dataset.label}: ${e.raw}`}}}},scales:{x:{grid:{display:!1},ticks:{font:{size:12},color:"#64748b"}},y:{beginAtZero:!0,grid:{color:"#f1f5f9"},ticks:{precision:0,stepSize:1,font:{size:12},color:"#64748b"},title:{display:!0,text:"Number of Risks",color:"#64748b",font:{size:12,weight:"normal"}}}}},remediationCostLoading:!0,remediationCostError:null,remediationCostData:{cost_summary:{total_cost:0,average_cost:0},category_chart:{labels:[],values:[]}},remediationCostChartData:null,remediationCostChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,usePointStyle:!0,callbacks:{label:function(e){return`$${e.raw.toLocaleString("en-US")}`}}}},scales:{x:{grid:{display:!1},ticks:{font:{size:12},color:"#64748b"}},y:{beginAtZero:!0,grid:{color:"#f1f5f9"},ticks:{callback:function(e){return"$"+e.toLocaleString("en-US")},font:{size:12},color:"#64748b"},title:{display:!0,text:"Remediation Cost ($)",color:"#64748b",font:{size:12,weight:"normal"}}}}},selectedPeriod:"month",nonCompliantIncidentsLoading:!0,nonCompliantIncidentsError:null,nonCompliantIncidentsData:{non_compliant_count:0,period:"Last 30 Days",percentage_change:"0%",unique_compliance_items:0,top_non_compliant_items:[],trend_data:{labels:[],values:[]}},nonCompliantIncidentsChartData:null,nonCompliantIncidentsChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,usePointStyle:!0,callbacks:{label:function(e){return`Incidents: ${e.raw}`}}}},scales:{x:{grid:{display:!1},ticks:{maxRotation:45,minRotation:45,callback:function(e){const a=new Date(this.getLabelForValue(e));return a.toLocaleDateString("en-US",{month:"short",day:"numeric"})},font:{size:10},color:"#64748b"}},y:{beginAtZero:!0,grid:{color:"#f1f5f9"},ticks:{precision:0,font:{size:11},color:"#64748b"},title:{display:!0,text:"Number of Incidents",color:"#64748b",font:{size:12,weight:"normal"}}}}}}},methods:{async fetchMaturityData(){this.loading=!0,this.error=null;try{const e=await bt.fv.getMaturityLevelKPI();if(console.log("Maturity Level Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch data");this.maturityData=e.data.data,this.updateChartData()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching maturity data:",e),this.error=e.response?.data?.message||e.message||"Failed to load data"}finally{this.loading=!1}},updateChartData(){if(!this.maturityData)return;const e=this.maturityData.summary.total_by_maturity;this.chartData={labels:this.maturityLevels,datasets:[{data:this.maturityLevels.map(a=>e[a]||0),backgroundColor:["#f43f5e","#3b82f6","#f59e0b","#10b981","#8b5cf6"],borderRadius:4,maxBarThickness:32,borderSkipped:!1}]}},getMaturityCount(e){return this.maturityData&&this.maturityData.summary.total_by_maturity[e]||0},getTotalCompliances(){return this.maturityData&&this.maturityData.summary.total_compliances||0},async fetchNonComplianceCount(){this.nonComplianceLoading=!0,this.nonComplianceError=null;try{const e=await bt.fv.getNonComplianceCount();if(console.log("Non-Compliance Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch non-compliance count");this.nonComplianceCount=e.data.data.non_compliance_count}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching non-compliance count:",e),this.nonComplianceError=e.response?.data?.message||e.message||"Failed to load non-compliance data"}finally{this.nonComplianceLoading=!1}},async fetchMitigatedCount(){this.mitigatedLoading=!0,this.mitigatedError=null;try{const e=await bt.fv.getMitigatedRisksCount();if(console.log("Mitigated Risks Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch mitigated risks count");this.mitigatedCount=e.data.data.mitigated_count}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching mitigated risks count:",e),this.mitigatedError=e.response?.data?.message||e.message||"Failed to load mitigated risks data"}finally{this.mitigatedLoading=!1}},async fetchAutomatedCount(){this.automatedLoading=!0,this.automatedError=null;try{const e=await bt.fv.getAutomatedControlsCount();if(console.log("Automated Controls Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch automated controls data");this.automatedData=e.data.data,this.updateAutomatedChartData()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching automated controls data:",e),this.automatedError=e.response?.data?.message||e.message||"Failed to load automated controls data"}finally{this.automatedLoading=!1}},updateAutomatedChartData(){if(!this.automatedData)return;const e=this.automatedData.automated_percentage||0,a=this.automatedData.manual_percentage||0;this.automatedChartData={labels:["Automated","Manual"],datasets:[{data:[e,a],backgroundColor:["#3b82f6","#94a3b8"],borderWidth:0}]}},async fetchRepetitionsData(){this.repetitionsLoading=!0,this.repetitionsError=null;try{const e=await bt.fv.getNonComplianceRepetitions();if(console.log("Repetitions Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch repetitions data");this.repetitionsData=e.data.data,this.updateRepetitionsChartData()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching repetitions data:",e),this.repetitionsError=e.response?.data?.message||e.message||"Failed to load repetitions data"}finally{this.repetitionsLoading=!1}},updateRepetitionsChartData(){if(!this.repetitionsData||!this.repetitionsData.distribution)return;const e=this.repetitionsData.distribution;Array.isArray(e)&&0!==e.length&&(this.repetitionsChartData={labels:e.map(e=>e?.repetitions||0),datasets:[{data:e.map(e=>e?.occurrences||0),backgroundColor:"#dc2626",borderRadius:4,maxBarThickness:32}]})},async fetchOntimeMitigationData(){this.ontimeMitigationLoading=!0,this.ontimeMitigationError=null;try{const e=await bt.fv.getOntimeMitigationPercentage();if(console.log("On-time Mitigation Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch on-time mitigation data");this.ontimeMitigationData={on_time_percentage:e.data.data.on_time_percentage||0,total_completed:e.data.data.total_completed||0,completed_on_time:e.data.data.completed_on_time||0,completed_late:e.data.data.completed_late||0}}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching on-time mitigation data:",e),this.ontimeMitigationError=e.response?.data?.message||e.message||"Failed to load on-time mitigation data"}finally{this.ontimeMitigationLoading=!1}},async fetchStatusOverview(){this.statusOverviewLoading=!0,this.statusOverviewError=null;try{const e=await bt.fv.getComplianceStatusOverview();if(!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch status overview data");this.statusOverviewData=e.data.data,this.updateStatusOverviewChart()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void ht.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching status overview:",e),this.statusOverviewError=e.response?.data?.message||e.message||"Failed to load status overview"}finally{this.statusOverviewLoading=!1}},updateStatusOverviewChart(){if(!this.statusOverviewData)return;const e={Approved:"#10B981","Under Review":"#3B82F6",Active:"#F59E0B",Rejected:"#EF4444"},a={Approved:"#059669","Under Review":"#2563EB",Active:"#D97706",Rejected:"#DC2626"},t=Object.keys(this.statusOverviewData.percentages);this.statusOverviewChartData={labels:t,datasets:[{data:Object.values(this.statusOverviewData.percentages),backgroundColor:t.map(a=>e[a]),hoverBackgroundColor:t.map(e=>a[e]),borderWidth:0,borderRadius:4}]}},async fetchReputationalData(){this.reputationalLoading=!0,this.reputationalError=null;try{const e=await bt.fv.getReputationalImpact();if(console.log("Reputational Impact Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch reputational impact data");this.reputationalData=e.data.data,this.updateReputationalChart()}catch(e){console.error("Error fetching reputational impact:",e),this.reputationalError=e.response?.data?.message||e.message||"Failed to load reputational impact data",this.reputationalData={impact_counts:{low:0,medium:0,high:0},impact_percentages:{low:0,medium:0,high:0},timeline_data:{dates:[],low:[],medium:[],high:[]},total_risks:0}}finally{this.reputationalLoading=!1}},updateReputationalChart(){if(!this.reputationalData?.impact_counts)return void(this.reputationalChartData={labels:["Low","Medium","High"],datasets:[{label:"Impact Count",data:[0,0,0],borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0,pointBackgroundColor:"#3b82f6",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7}]});const{low:e,medium:a,high:t}=this.reputationalData.impact_counts;this.reputationalChartData={labels:["Low","Medium","High"],datasets:[{label:"Impact Count",data:[e,a,t],borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0,pointBackgroundColor:["#10b981","#f59e0b","#ef4444"],pointBorderColor:"#fff",pointRadius:6,pointHoverRadius:8}]}},async fetchRemediationCost(){this.remediationCostLoading=!0,this.remediationCostError=null;try{const e=await bt.fv.getRemediationCost();if(console.log("Remediation Cost Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch remediation cost data");this.remediationCostData=e.data.data,this.updateRemediationCostChart()}catch(e){console.error("Error fetching remediation cost:",e),this.remediationCostError=e.response?.data?.message||e.message||"Failed to load remediation cost data"}finally{this.remediationCostLoading=!1}},updateRemediationCostChart(){if(!this.remediationCostData||!this.remediationCostData.time_series_chart)return;const e=this.remediationCostData.time_series_chart;this.remediationCostChartData={labels:e.labels,datasets:[{label:"Remediation Cost",data:e.values,borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",borderWidth:2,fill:!0,tension:.4,pointBackgroundColor:"#ef4444",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}},async fetchNonCompliantIncidents(){this.nonCompliantIncidentsLoading=!0,this.nonCompliantIncidentsError=null;try{const e=await bt.fv.getNonCompliantIncidents(this.selectedPeriod);if(console.log("Non-Compliant Incidents Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch non-compliant incidents data");this.nonCompliantIncidentsData=e.data.data,this.updateNonCompliantIncidentsChart()}catch(e){console.error("Error fetching non-compliant incidents:",e),this.nonCompliantIncidentsError=e.response?.data?.message||e.message||"Failed to load non-compliant incidents data"}finally{this.nonCompliantIncidentsLoading=!1}},updateNonCompliantIncidentsChart(){if(!this.nonCompliantIncidentsData||!this.nonCompliantIncidentsData.trend_data)return;const e=this.nonCompliantIncidentsData.trend_data;this.nonCompliantIncidentsChartData={labels:e.labels,datasets:[{label:"Non-Compliant Incidents",data:e.values,backgroundColor:"#dc2626",borderRadius:4,maxBarThickness:32,borderSkipped:!1}]}},getCriticalityClass(e){if(!e)return"";const a=e.toLowerCase();return"high"===a?"high-criticality":"medium"===a?"medium-criticality":"low"===a?"low-criticality":""},truncateText(e,a){return e?e.length>a?e.substring(0,a)+"...":e:""},formatNumber(e){return e.toLocaleString("en-US")}},mounted(){this.fetchMaturityData(),this.fetchNonComplianceCount(),this.fetchMitigatedCount(),this.fetchAutomatedCount(),this.fetchRepetitionsData(),this.fetchOntimeMitigationData(),this.fetchStatusOverview(),this.fetchReputationalData(),this.fetchRemediationCost(),this.fetchNonCompliantIncidents()}};const kle=(0,se.A)(mle,[["render",vle]]);var hle=kle;const gle={class:"popup-demo-container"},yle={class:"popup-categories"},fle={class:"popup-category"},ble={class:"demo-buttons"},Cle={class:"popup-category"},Lle={class:"demo-buttons"},wle={class:"popup-category"},Ele={class:"demo-buttons"},Rle={class:"popup-category"},Dle={class:"demo-buttons"},Ile={class:"popup-category"},Ple={class:"demo-buttons"};function _le(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",gle,[a[28]||(a[28]=(0,s.Lk)("h1",null,"Popup System Demo",-1)),a[29]||(a[29]=(0,s.Lk)("p",{class:"demo-description"}," This page demonstrates all the popup types available in the Compliance module. Click on the buttons below to see each popup type in action. ",-1)),(0,s.Lk)("div",yle,[(0,s.Lk)("div",fle,[a[23]||(a[23]=(0,s.Lk)("h2",null,"Basic Popup Types",-1)),(0,s.Lk)("div",ble,[(0,s.Lk)("button",{onClick:a[0]||(a[0]=a=>e.showSuccessPopup("Operation completed successfully!")),class:"success-btn"}," Success Popup "),(0,s.Lk)("button",{onClick:a[1]||(a[1]=a=>e.showErrorPopup("An error occurred while processing your request.")),class:"error-btn"}," Error Popup "),(0,s.Lk)("button",{onClick:a[2]||(a[2]=a=>e.showWarningPopup("This action may have consequences.")),class:"warning-btn"}," Warning Popup "),(0,s.Lk)("button",{onClick:a[3]||(a[3]=a=>e.showInfoPopup("This is some helpful information.")),class:"info-btn"}," Info Popup "),(0,s.Lk)("button",{onClick:a[4]||(a[4]=a=>e.showAutoClosePopup("This popup will close automatically in 3 seconds.","Auto-Close Demo","info",3e3)),class:"auto-close-btn"}," Auto-Close Popup ")])]),(0,s.Lk)("div",Cle,[a[24]||(a[24]=(0,s.Lk)("h2",null,"Interactive Popups",-1)),(0,s.Lk)("div",Lle,[(0,s.Lk)("button",{onClick:a[5]||(a[5]=e=>l.showConfirmationDemo()),class:"confirm-btn"}," Confirmation Popup "),(0,s.Lk)("button",{onClick:a[6]||(a[6]=e=>l.showCommentDemo()),class:"comment-btn"}," Comment Popup ")])]),(0,s.Lk)("div",wle,[a[25]||(a[25]=(0,s.Lk)("h2",null,"Compliance-Specific Popups",-1)),(0,s.Lk)("div",Ele,[(0,s.Lk)("button",{onClick:a[7]||(a[7]=e=>l.showComplianceCreated()),class:"compliance-btn"}," Compliance Created "),(0,s.Lk)("button",{onClick:a[8]||(a[8]=e=>l.showComplianceUpdated()),class:"compliance-btn"}," Compliance Updated "),(0,s.Lk)("button",{onClick:a[9]||(a[9]=e=>l.showComplianceCloned()),class:"compliance-btn"}," Compliance Cloned "),(0,s.Lk)("button",{onClick:a[10]||(a[10]=e=>l.showComplianceStatusChanged()),class:"compliance-btn"}," Status Changed "),(0,s.Lk)("button",{onClick:a[11]||(a[11]=e=>l.showReviewSubmitted()),class:"compliance-btn"}," Review Submitted "),(0,s.Lk)("button",{onClick:a[12]||(a[12]=e=>l.showOperationFailed()),class:"compliance-btn"}," Operation Failed "),(0,s.Lk)("button",{onClick:a[13]||(a[13]=e=>l.showValidationFailed()),class:"compliance-btn"}," Validation Failed ")])]),(0,s.Lk)("div",Rle,[a[26]||(a[26]=(0,s.Lk)("h2",null,"Compliance Confirmation Popups",-1)),(0,s.Lk)("div",Dle,[(0,s.Lk)("button",{onClick:a[14]||(a[14]=e=>l.showDeactivationConfirm()),class:"compliance-btn"}," Confirm Deactivation "),(0,s.Lk)("button",{onClick:a[15]||(a[15]=e=>l.showEditConfirm()),class:"compliance-btn"}," Confirm Edit "),(0,s.Lk)("button",{onClick:a[16]||(a[16]=e=>l.showCloneConfirm()),class:"compliance-btn"}," Confirm Clone "),(0,s.Lk)("button",{onClick:a[17]||(a[17]=e=>l.showDeleteConfirm()),class:"compliance-btn"}," Confirm Delete "),(0,s.Lk)("button",{onClick:a[18]||(a[18]=e=>l.showActivateVersionConfirm()),class:"compliance-btn"}," Confirm Activate Version ")])]),(0,s.Lk)("div",Ile,[a[27]||(a[27]=(0,s.Lk)("h2",null,"Compliance Info Popups",-1)),(0,s.Lk)("div",Ple,[(0,s.Lk)("button",{onClick:a[19]||(a[19]=e=>l.showComplianceInfo()),class:"compliance-btn"}," Compliance Info "),(0,s.Lk)("button",{onClick:a[20]||(a[20]=e=>l.showAuditInfo()),class:"compliance-btn"}," Audit Info "),(0,s.Lk)("button",{onClick:a[21]||(a[21]=e=>l.showExportCompleted()),class:"compliance-btn"}," Export Completed "),(0,s.Lk)("button",{onClick:a[22]||(a[22]=e=>l.showSessionTimeout()),class:"compliance-btn"}," Session Timeout ")])])]),(0,s.bF)(n)])}var Sle={name:"PopupDemo",components:{PopupModal:pv.wA},mixins:[E6],data(){return{demoCompliance:{ComplianceId:12345,ComplianceItemDescription:"Sample Compliance Item",ComplianceVersion:"2.0",Status:"Approved",Criticality:"High",CreatedByName:"John Doe",CreatedByDate:"2023-06-15"},demoAuditInfo:{audit_performer_name:"Jane Smith",audit_approver_name:"Robert Johnson",audit_date:"2023-06-20",audit_time:"14:30:00",audit_findings_status:"Fully Compliant",comments:"All criteria successfully met."}}},methods:{showConfirmationDemo(){this.showConfirmPopup("Are you sure you want to proceed with this action?","Confirmation Required",()=>{this.showSuccessPopup("Action confirmed!","Success")},()=>{this.showInfoPopup("Action cancelled.","Cancelled")})},showCommentDemo(){this.showCommentPopup("Please provide your feedback:","Feedback Requested",e=>{this.showSuccessPopup(`Thank you for your feedback: "${e}"`,"Feedback Received")})},showComplianceCreated(){u2.complianceCreated(this.demoCompliance)},showComplianceUpdated(){u2.complianceUpdated(this.demoCompliance)},showComplianceCloned(){u2.complianceCloned(this.demoCompliance)},showComplianceStatusChanged(){u2.complianceStatusChanged("Active",this.demoCompliance.ComplianceVersion)},showReviewSubmitted(){const e=Math.random()>.5;u2.reviewSubmitted(e)},showOperationFailed(){u2.operationFailed("save compliance","Server returned a 500 error")},showValidationFailed(){u2.validationFailed({ComplianceItemDescription:"Description is required",Criticality:"Criticality must be High, Medium, or Low"})},showDeactivationConfirm(){this.confirmDeactivateCompliance(this.demoCompliance,()=>{this.showSuccessPopup("Compliance deactivated successfully!","Deactivation Complete")})},showEditConfirm(){this.confirmEditCompliance(this.demoCompliance,()=>{this.showSuccessPopup("New compliance version created successfully!","Edit Complete")})},showCloneConfirm(){this.confirmCloneCompliance(this.demoCompliance,()=>{this.showSuccessPopup("Compliance cloned successfully!","Clone Complete")})},showDeleteConfirm(){this.confirmDeleteCompliance(this.demoCompliance,()=>{this.showSuccessPopup("Compliance deleted successfully!","Deletion Complete")})},showActivateVersionConfirm(){this.confirmActivateVersion(this.demoCompliance,()=>{this.showSuccessPopup(`Version ${this.demoCompliance.ComplianceVersion} activated successfully!`,"Activation Complete")})},showComplianceInfo(){u2.showComplianceInfo(this.demoCompliance)},showAuditInfo(){u2.showAuditInfo(this.demoAuditInfo)},showExportCompleted(){const e=["xlsx","csv","pdf","json","xml"],a=e[Math.floor(Math.random()*e.length)];u2.exportCompleted(a)},showSessionTimeout(){u2.sessionTimeout(()=>{this.showSuccessPopup("Session extended successfully!","Session Extended")},()=>{this.showInfoPopup("You have been logged out.","Session Ended")})}}};const Ale=(0,se.A)(Sle,[["render",_le],["__scopeId","data-v-0d4bf12e"]]);var Tle=Ale;const xle={class:"notifications-page large"},Fle={class:"header-row"},Vle=["disabled"],Mle={class:"search-filter-row"},Xle={class:"filters"},Ule=["value"],Nle=["value"],$le={width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"6px"}},Ole={key:0,class:"loading-state"},jle={key:1,class:"error-state"},Ble={key:2,class:"notifications-table"},Wle={class:"notification-main"},Qle={class:"notification-text"},qle={class:"notification-title"},Kle={class:"notification-description"},Jle=["onClick"],zle={key:3,class:"empty-state"},Hle={class:"modal-content"},Yle={class:"modal-header"},Gle={class:"modal-body"},Zle={key:0,class:"notification-popup"},ene={class:"popup-type"},ane={class:"popup-title"},tne={class:"popup-message"};var ine=Object.assign({name:"NotificationsPage"},{__name:"Notifications",setup(e){ze.t1.register(ze.E8,ze.PP,ze.kc,ze.m_,ze.s$);const a=(0,ee.KR)(!1),t=(0,ee.KR)(!1),o=(0,ee.KR)(null),l=(0,ee.KR)([]),n=(0,ee.KR)({}),r=["policy","compliance","audit","risk","incident","common","account"],c=["urgent","high","medium","low"],u=(0,ee.KR)(""),p=(0,ee.KR)(""),v=(0,ee.KR)(""),m=(0,s.EW)(()=>l.value.filter(e=>{const a=e.title.toLowerCase().includes(u.value.toLowerCase())||e.message.toLowerCase().includes(u.value.toLowerCase()),t=!p.value||e.category===p.value,i=!v.value||e.priority===v.value;return a&&t&&i})),k=async()=>{t.value=!0,o.value=null;try{const e=await fetch("http://localhost:8000/api/get-notifications/?user_id=default_user");if(!e.ok)throw new Error("Backend not available");{const a=await e.json();if("success"!==a.status)throw new Error("Failed to load notifications from backend");l.value=a.notifications}}catch(e){console.error("Error loading notifications:",e),l.value=[],o.value="Failed to load notifications"}finally{t.value=!1}},h=async()=>{try{n.value={total:l.value.length,unread:l.value.filter(e=>!e.status.isRead).length}}catch(e){console.error("Error loading stats:",e)}},g=(0,ee.KR)(!1),y=(0,ee.KR)({}),f=async e=>{const a=l.value.find(a=>a.id===e);a&&!a.status.isRead&&(a.status.isRead=!0,a.status.readAt=new Date);try{await fetch("http://localhost:8000/api/mark-as-read/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notification_id:e})}),await k()}catch(o){console.error("Error marking notification as read:",o)}},b=async()=>{l.value.forEach(e=>{e.status.isRead||(e.status.isRead=!0,e.status.readAt=new Date)});try{await fetch("http://localhost:8000/mark-all-as-read/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:"default_user"})})}catch(o){console.error("Error marking all notifications as read:",o)}},C=e=>{const a=new Date(e),t=new Date,i=Math.floor((t-a)/6e4);if(i<1)return"Just now";if(i<60)return`${i} minutes ago`;const s=Math.floor(i/60);if(s<24)return`${s} hours ago`;const o=Math.floor(s/24);return o<7?`${o} days ago`:a.toLocaleDateString()};function L(e){return e.charAt(0).toUpperCase()}const w=(0,s.EW)(()=>{const e={};return r.forEach(a=>{e[a]={urgent:0,high:0,medium:0,low:0}}),l.value.forEach(a=>{e[a.category]&&e[a.category][a.priority]++}),{labels:r.map(e=>e.charAt(0).toUpperCase()+e.slice(1)),datasets:[{label:"Urgent",backgroundColor:"#b71c1c",borderColor:"#b71c1c",data:r.map(a=>e[a].urgent)},{label:"High",backgroundColor:"#ff6f00",borderColor:"#ff6f00",data:r.map(a=>e[a].high)},{label:"Medium",backgroundColor:"#1565c0",borderColor:"#1565c0",data:r.map(a=>e[a].medium)},{label:"Low",backgroundColor:"#37474f",borderColor:"#37474f",data:r.map(a=>e[a].low)}]}}),E={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Notifications by Module and Priority"}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0,precision:0}}};return(0,s.sV)(async()=>{await k(),await h()}),(e,l)=>((0,s.uX)(),(0,s.CE)("div",xle,[(0,s.Lk)("div",Fle,[l[6]||(l[6]=(0,s.Lk)("h1",null,"Notifications",-1)),(0,s.Lk)("button",{class:"mark-all",onClick:b,disabled:t.value},"Mark All as Read",8,Vle)]),(0,s.Lk)("div",Mle,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),placeholder:"Search notifications...",class:"search-input"},null,512),[[i.Jo,u.value]]),(0,s.Lk)("div",Xle,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>p.value=e)},[l[7]||(l[7]=(0,s.Lk)("option",{value:""},"All Types",-1)),((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(r,e=>(0,s.Lk)("option",{key:e,value:e},(0,d.v_)(e),9,Ule)),64))],512),[[i.u1,p.value]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>v.value=e)},[l[8]||(l[8]=(0,s.Lk)("option",{value:""},"All Priorities",-1)),((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(c,e=>(0,s.Lk)("option",{key:e,value:e},(0,d.v_)(e),9,Nle)),64))],512),[[i.u1,v.value]]),(0,s.Lk)("button",{class:"analytics-btn",onClick:l[3]||(l[3]=e=>a.value=!0)},[((0,s.uX)(),(0,s.CE)("svg",$le,l[9]||(l[9]=[(0,s.Lk)("rect",{x:"2",y:"10",width:"2.5",height:"6",rx:"1",fill:"#1976d2"},null,-1),(0,s.Lk)("rect",{x:"6.5",y:"6",width:"2.5",height:"10",rx:"1",fill:"#1976d2"},null,-1),(0,s.Lk)("rect",{x:"11",y:"2",width:"2.5",height:"14",rx:"1",fill:"#1976d2"},null,-1),(0,s.Lk)("rect",{x:"15.5",y:"13",width:"2.5",height:"3",rx:"1",fill:"#1976d2"},null,-1)]))),l[10]||(l[10]=(0,s.Lk)("span",null,"Analytics",-1))])])]),t.value?((0,s.uX)(),(0,s.CE)("div",Ole,l[11]||(l[11]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading notifications...",-1)]))):o.value?((0,s.uX)(),(0,s.CE)("div",jle,[(0,s.Lk)("p",null,(0,d.v_)(o.value),1),(0,s.Lk)("button",{onClick:k,class:"retry-btn"},"Retry")])):((0,s.uX)(),(0,s.CE)("table",Ble,[l[12]||(l[12]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Notification"),(0,s.Lk)("th",null,"Priority"),(0,s.Lk)("th",null,"Time"),(0,s.Lk)("th",null,"Status")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:(0,d.C4)({unread:!e.status.isRead})},[(0,s.Lk)("td",null,[(0,s.Lk)("div",Wle,[(0,s.Lk)("span",{class:(0,d.C4)(["module-icon",e.category.toLowerCase()])},(0,d.v_)(L(e.category)),3),(0,s.Lk)("div",Qle,[(0,s.Lk)("div",qle,(0,d.v_)(e.title),1),(0,s.Lk)("div",Kle,(0,d.v_)(e.message),1)])])]),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["priority",e.priority.toLowerCase()])},(0,d.v_)(e.priority),3)]),(0,s.Lk)("td",null,(0,d.v_)(C(e.createdAt)),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["status",e.status.isRead?"read":"unread"])},(0,d.v_)(e.status.isRead?"read":"unread"),3),e.status.isRead?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:a=>f(e.id),class:"action-btn read-btn",title:"Mark as read",style:{"margin-left":"10px",background:"#e8f5e8",border:"1px solid #1976d2",color:"#1976d2","border-radius":"4px",padding:"2px 10px","font-size":"0.95rem",cursor:"pointer",transition:"background 0.2s"}}," âœ“ ",8,Jle))])],2))),128))])])),t.value||o.value||0!==m.value.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",zle,l[13]||(l[13]=[(0,s.Lk)("p",null,"No notifications found",-1)]))),a.value?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"modal-overlay",onClick:l[5]||(l[5]=(0,i.D$)(e=>a.value=!1,["self"]))},[(0,s.Lk)("div",Hle,[(0,s.Lk)("div",Yle,[l[14]||(l[14]=(0,s.Lk)("h2",null,"Notifications Analytics",-1)),(0,s.Lk)("button",{class:"close-btn",onClick:l[4]||(l[4]=e=>a.value=!1)},"Ã—")]),(0,s.Lk)("div",Gle,[(0,s.bF)((0,ee.R1)(He.yP),{data:w.value,options:E},null,8,["data"])])])])):(0,s.Q3)("",!0),(0,s.bF)(i.eB,{name:"fade"},{default:(0,s.k6)(()=>[g.value?((0,s.uX)(),(0,s.CE)("div",Zle,[(0,s.Lk)("div",ene,(0,d.v_)(y.value.category?y.value.category.toUpperCase():"NOTIFICATION"),1),(0,s.Lk)("div",ane,(0,d.v_)(y.value.title),1),(0,s.Lk)("div",tne,(0,d.v_)(y.value.message),1)])):(0,s.Q3)("",!0)]),_:1})]))}});const sne=(0,se.A)(ine,[["__scopeId","data-v-06a61940"]]);var one=sne;const lne={class:"risk-register-container create-risk"},nne={class:"risk-register-header-row"},rne={key:0,class:"risk-source-badge"},cne={key:0},dne={key:1},une={class:"risk-creation-mode-toggle"},pne={class:"risk-toggle-container"},vne={key:0,class:"risk-ai-input-form"},mne={class:"risk-ai-input-container"},kne={key:0,class:"risk-ai-loading-state"},hne={key:1},gne={key:0,class:"risk-incident-info"},yne={class:"risk-incident-badge"},fne={class:"risk-ai-form-group"},bne={key:0,class:"risk-incident-data-box"},Cne={class:"risk-ai-form-group"},Lne={key:0,class:"risk-incident-data-box description"},wne={class:"risk-ai-form-actions"},Ene=["disabled"],Rne={key:1,class:"risk-register-add-form"},Dne={class:"risk-register-form-group risk-compliance-id-container"},Ine={class:"risk-compliance-dropdown-container"},Pne={key:0,class:"risk-compliance-dropdown"},_ne={class:"risk-compliance-dropdown-search"},Sne={key:0,class:"risk-compliance-dropdown-list"},Ane={key:1,class:"risk-compliance-dropdown-list"},Tne={key:2,class:"risk-compliance-dropdown-list"},xne=["onClick"],Fne={class:"risk-compliance-item-checkbox"},Vne=["id","checked","onClick"],Mne={class:"risk-compliance-item-content"},Xne={class:"risk-compliance-item-header"},Une={class:"risk-compliance-id"},Nne={class:"risk-compliance-item-description"},$ne={key:0,class:"risk-compliance-item-damage"},One={class:"form-row"},jne={class:"risk-register-form-group"},Bne={class:"risk-category-container"},Wne={class:"risk-category-dropdown"},Qne={key:0},qne={key:1},Kne={key:0,class:"risk-category-options"},Jne={class:"risk-category-search"},zne={class:"risk-category-list"},Hne=["onClick"],Yne=["checked","onClick"],Gne={class:"form-row"},Zne={class:"form-row"},ere={class:"risk-register-form-group"},are={class:"risk-business-impact-container"},tre={class:"risk-business-impact-dropdown"},ire={key:0},sre={key:1},ore={key:0,class:"risk-business-impact-options"},lre={class:"risk-business-impact-search"},nre={class:"risk-business-impact-list"},rre=["onClick"],cre=["checked","onClick"],dre={class:"risk-selected-impacts-display"},ure=["onClick"],pre={class:"form-row"},vre={class:"risk-register-form-actions"},mre={key:2,class:"risk-success-message"},kre={class:"risk-modal-form-group"},hre={class:"risk-modal-actions"},gre=["disabled"],yre={class:"risk-modal-form-group"},fre={class:"risk-modal-actions"},bre=["disabled"];function Cre(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("SelectInput"),u=(0,s.g2)("NumberInput"),p=(0,s.g2)("TextInput"),v=(0,s.g2)("TextareaInput");return(0,s.uX)(),(0,s.CE)("div",lne,[(0,s.bF)(r),(0,s.Lk)("div",nne,[a[48]||(a[48]=(0,s.Lk)("h2",{class:"risk-register-title"}," Create New Risk",-1)),l.sourceRiskId?((0,s.uX)(),(0,s.CE)("div",rne,[l.isLoadingSourceRisk?((0,s.uX)(),(0,s.CE)("span",cne,a[46]||(a[46]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading source risk data... ")]))):((0,s.uX)(),(0,s.CE)("span",dne,[a[47]||(a[47]=(0,s.Lk)("i",{class:"fas fa-link"},null,-1)),(0,s.eW)(" Creating from Risk #"+(0,d.v_)(l.sourceRiskId),1)]))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",une,[(0,s.Lk)("div",pne,[(0,s.Lk)("div",{class:(0,d.C4)(["risk-toggle-option",{active:!l.isAiMode}]),onClick:a[0]||(a[0]=e=>n.setCreationMode(!1))},a[49]||(a[49]=[(0,s.Lk)("i",{class:"fas fa-user"},null,-1),(0,s.eW)(" Manual Creation ")]),2),(0,s.Lk)("div",{class:(0,d.C4)(["risk-toggle-option",{active:l.isAiMode}]),onClick:a[1]||(a[1]=e=>n.setCreationMode(!0))},a[50]||(a[50]=[(0,s.Lk)("i",{class:"fas fa-robot"},null,-1),(0,s.eW)(" AI Suggested ")]),2),(0,s.Lk)("div",{class:(0,d.C4)(["risk-toggle-slider",{"slide-right":l.isAiMode}])},null,2)])]),l.isAiMode&&!l.aiSuggestionGenerated?((0,s.uX)(),(0,s.CE)("div",vne,[(0,s.Lk)("div",mne,[a[56]||(a[56]=(0,s.Lk)("h3",null,[(0,s.Lk)("i",{class:"fas fa-robot"}),(0,s.eW)(" AI Risk Analysis")],-1)),l.isGeneratingAi?((0,s.uX)(),(0,s.CE)("div",kne,a[51]||(a[51]=[(0,s.Lk)("div",{class:"risk-ai-spinner"},[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"})],-1),(0,s.Lk)("p",null,"Analyzing incident data with AI...",-1)]))):((0,s.uX)(),(0,s.CE)("div",hne,[l.incidentId?((0,s.uX)(),(0,s.CE)("div",gne,[(0,s.Lk)("div",yne,[a[52]||(a[52]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.eW)(" Incident #"+(0,d.v_)(l.incidentId),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",fne,[a[53]||(a[53]=(0,s.Lk)("label",null,"Title",-1)),l.incidentId?((0,s.uX)(),(0,s.CE)("div",bne,(0,d.v_)(l.aiInput.title||"No title available"),1)):(0,s.bo)(((0,s.uX)(),(0,s.CE)("input",{key:1,type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>l.aiInput.title=e),placeholder:"Enter incident title for AI analysis",class:"risk-ai-input-field"},null,512)),[[i.Jo,l.aiInput.title]])]),(0,s.Lk)("div",Cne,[a[54]||(a[54]=(0,s.Lk)("label",null,"Description",-1)),l.incidentId?((0,s.uX)(),(0,s.CE)("div",Lne,(0,d.v_)(l.aiInput.description||"No description available"),1)):(0,s.bo)(((0,s.uX)(),(0,s.CE)("textarea",{key:1,"onUpdate:modelValue":a[3]||(a[3]=e=>l.aiInput.description=e),placeholder:"Enter incident description for AI analysis",class:"risk-ai-input-field description",rows:"4"},null,512)),[[i.Jo,l.aiInput.description]])]),(0,s.Lk)("div",wne,[(0,s.Lk)("button",{class:"risk-generate-btn",onClick:a[4]||(a[4]=(...e)=>n.generateAiSuggestion&&n.generateAiSuggestion(...e)),disabled:l.isGeneratingAi||!l.aiInput.title&&!l.aiInput.description},a[55]||(a[55]=[(0,s.Lk)("i",{class:"fas fa-magic"},null,-1),(0,s.eW)(" Generate Risk Analysis ")]),8,Ene)])]))])])):(0,s.Q3)("",!0),!l.isAiMode||l.aiSuggestionGenerated?((0,s.uX)(),(0,s.CE)("div",Rne,[(0,s.Lk)("form",{onSubmit:a[33]||(a[33]=(0,i.D$)((...e)=>n.submitRisk&&n.submitRisk(...e),["prevent"])),class:"risk-register-form-grid"},[(0,s.Lk)("div",Dne,[a[61]||(a[61]=(0,s.Lk)("label",null,[(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-hashtag"}),(0,s.eW)(" Compliance ID")])],-1)),(0,s.Lk)("div",Ine,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>l.selectedComplianceIdText=e),placeholder:"Enter or select compliance ID",onFocus:a[6]||(a[6]=e=>l.showComplianceDropdown=!0),readonly:""},null,544),[[i.Jo,l.selectedComplianceIdText]]),(0,s.Lk)("button",{type:"button",class:"risk-dropdown-toggle",onClick:a[7]||(a[7]=(...e)=>n.toggleComplianceDropdown&&n.toggleComplianceDropdown(...e))},a[57]||(a[57]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showComplianceDropdown?((0,s.uX)(),(0,s.CE)("div",Pne,[(0,s.Lk)("div",_ne,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=e=>l.complianceSearchQuery=e),placeholder:"Search compliances...",onInput:a[9]||(a[9]=(...e)=>n.filterCompliances&&n.filterCompliances(...e)),onClick:a[10]||(a[10]=(0,i.D$)(()=>{},["stop"]))},null,544),[[i.Jo,l.complianceSearchQuery]])]),l.loadingCompliances?((0,s.uX)(),(0,s.CE)("div",Sne,a[58]||(a[58]=[(0,s.Lk)("div",{class:"risk-loading-spinner"},"Loading compliances...",-1)]))):0===l.filteredCompliances.length?((0,s.uX)(),(0,s.CE)("div",Ane,a[59]||(a[59]=[(0,s.Lk)("div",{class:"risk-no-results"},"No compliances found",-1)]))):((0,s.uX)(),(0,s.CE)("div",Tne,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,class:"risk-compliance-item",onClick:a=>n.selectCompliance(e)},[(0,s.Lk)("div",Fne,[(0,s.Lk)("input",{type:"checkbox",id:"compliance-"+e.ComplianceId,checked:l.newRisk.ComplianceId===e.ComplianceId,onClick:(0,i.D$)(a=>n.selectCompliance(e),["stop"])},null,8,Vne)]),(0,s.Lk)("div",Mne,[(0,s.Lk)("div",Xne,[(0,s.Lk)("span",Une,"ID: "+(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("span",{class:(0,d.C4)("risk-compliance-criticality "+(e.Criticality?e.Criticality.toLowerCase():""))},(0,d.v_)(e.Criticality||"No Criticality"),3)]),(0,s.Lk)("div",Nne,(0,d.v_)(n.sanitizeHTML(n.truncateText(e.ComplianceItemDescription,100))||"No description available"),1),e.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",$ne,[a[60]||(a[60]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(n.sanitizeHTML(n.truncateText(e.PossibleDamage,80))),1)])):(0,s.Q3)("",!0)])],8,xne))),128))]))])):(0,s.Q3)("",!0)]),a[62]||(a[62]=(0,s.Lk)("div",{class:"risk-helper-text"},"Select the compliance requirement this risk is associated with",-1))]),(0,s.Lk)("div",One,[(0,s.bF)(c,{id:"criticality",modelValue:l.newRisk.Criticality,"onUpdate:modelValue":a[11]||(a[11]=e=>l.newRisk.Criticality=e),label:"Criticality",placeholder:"Select Criticality",options:l.criticalityOptions,name:"Criticality","helper-text":"Choose the severity level of this risk"},null,8,["modelValue","options"]),(0,s.Lk)("div",jne,[a[65]||(a[65]=(0,s.Lk)("label",null,[(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-tags"}),(0,s.eW)(" Category")])],-1)),(0,s.Lk)("div",Bne,[(0,s.Lk)("div",Wne,[(0,s.Lk)("div",{class:"risk-selected-category",onClick:a[12]||(a[12]=(...e)=>n.toggleCategoryDropdown&&n.toggleCategoryDropdown(...e))},[l.selectedCategory?((0,s.uX)(),(0,s.CE)("span",qne,(0,d.v_)(l.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",Qne,"Select Category")),a[63]||(a[63]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",Kne,[(0,s.Lk)("div",Jne,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[13]||(a[13]=e=>l.categorySearch=e),placeholder:"Search categories...",onClick:a[14]||(a[14]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,l.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"risk-add-category-btn",onClick:a[15]||(a[15]=(0,i.D$)(e=>l.showAddCategoryModal=!0,["stop","prevent"]))},a[64]||(a[64]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",zne,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-category-item",onClick:(0,i.D$)(a=>n.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:l.selectedCategory===e.value,onClick:(0,i.D$)(a=>n.selectCategory(e),["stop"])},null,8,Yne),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Hne))),128))])])):(0,s.Q3)("",!0)])]),a[66]||(a[66]=(0,s.Lk)("div",{class:"risk-helper-text"},"Categorize the risk for better organization and reporting",-1))]),(0,s.bF)(c,{id:"riskPriority",modelValue:l.newRisk.RiskPriority,"onUpdate:modelValue":a[16]||(a[16]=e=>l.newRisk.RiskPriority=e),label:"Risk Priority",placeholder:"Select Priority",options:l.priorityOptions,required:"",name:"RiskPriority","helper-text":"Set the priority level for risk treatment"},null,8,["modelValue","options"])]),(0,s.Lk)("div",Gne,[(0,s.bF)(u,{id:"riskLikelihood",modelValue:l.newRisk.RiskLikelihood,"onUpdate:modelValue":[a[17]||(a[17]=e=>l.newRisk.RiskLikelihood=e),n.calculateRiskExposureRating],label:"Risk Likelihood (1-10)",placeholder:"Enter likelihood",min:1,max:10,required:"",name:"RiskLikelihood","helper-text":"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)"},null,8,["modelValue","onUpdate:modelValue"]),(0,s.bF)(u,{id:"riskImpact",modelValue:l.newRisk.RiskImpact,"onUpdate:modelValue":[a[18]||(a[18]=e=>l.newRisk.RiskImpact=e),n.calculateRiskExposureRating],label:"Risk Impact (1-10)",placeholder:"Enter impact",min:1,max:10,required:"",name:"RiskImpact","helper-text":"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)"},null,8,["modelValue","onUpdate:modelValue"]),(0,s.bF)(u,{id:"riskExposureRating",modelValue:l.newRisk.RiskExposureRating,"onUpdate:modelValue":a[19]||(a[19]=e=>l.newRisk.RiskExposureRating=e),label:"Risk Exposure Rating",placeholder:"Calculated rating",readonly:"",name:"RiskExposureRating","helper-text":"Automatically calculated as Likelihood Ã— Impact"},null,8,["modelValue"])]),(0,s.Lk)("div",Zne,[(0,s.bF)(c,{id:"riskType",modelValue:l.newRisk.RiskType,"onUpdate:modelValue":a[20]||(a[20]=e=>l.newRisk.RiskType=e),label:"Risk Type",placeholder:"Select Risk Type",options:l.riskTypeOptions,required:"",name:"RiskType","helper-text":"Classify the nature and timing of this risk"},null,8,["modelValue","options"]),(0,s.Lk)("div",ere,[a[69]||(a[69]=(0,s.Lk)("label",null,[(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Impact")])],-1)),(0,s.Lk)("div",are,[(0,s.Lk)("div",tre,[(0,s.Lk)("div",{class:"risk-selected-impacts",onClick:a[21]||(a[21]=(...e)=>n.toggleBusinessImpactDropdown&&n.toggleBusinessImpactDropdown(...e))},[0===l.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",ire,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",sre,(0,d.v_)(l.selectedBusinessImpacts.length)+" impact(s) selected",1)),a[67]||(a[67]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",ore,[(0,s.Lk)("div",lre,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[22]||(a[22]=e=>l.businessImpactSearch=e),placeholder:"Search impacts...",onClick:a[23]||(a[23]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,l.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"risk-add-impact-btn",onClick:a[24]||(a[24]=(0,i.D$)(e=>l.showAddImpactModal=!0,["stop","prevent"]))},a[68]||(a[68]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",nre,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-business-impact-item",onClick:(0,i.D$)(a=>n.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",checked:n.isBusinessImpactSelected(e),onClick:(0,i.D$)(a=>n.toggleBusinessImpact(e),["stop"])},null,8,cre),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,rre))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",dre,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-selected-impact-tag"},[(0,s.eW)((0,d.v_)(e.value)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:a=>n.toggleBusinessImpact(e)},null,8,ure)]))),128))])]),a[70]||(a[70]=(0,s.Lk)("div",{class:"risk-helper-text"},"Select the business areas that would be affected by this risk",-1))]),(0,s.bF)(p,{id:"riskTitle",modelValue:l.newRisk.RiskTitle,"onUpdate:modelValue":a[25]||(a[25]=e=>l.newRisk.RiskTitle=e),label:"Risk Title",placeholder:"Enter a clear, concise risk title",required:"",pattern:null,name:"RiskTitle","helper-text":"Provide a brief, descriptive title for this risk"},null,8,["modelValue"])]),(0,s.Lk)("div",pre,[(0,s.bF)(v,{id:"riskDescription",modelValue:l.newRisk.RiskDescription,"onUpdate:modelValue":[a[26]||(a[26]=e=>l.newRisk.RiskDescription=e),a[27]||(a[27]=e=>l.newRisk.RiskDescription=n.sanitizeInput(e))],label:"Risk Description",placeholder:"Provide a detailed description of the risk",required:"",rows:4,name:"RiskDescription","helper-text":"Describe the risk scenario, causes, and potential triggers"},null,8,["modelValue"]),(0,s.bF)(v,{id:"possibleDamage",modelValue:l.newRisk.PossibleDamage,"onUpdate:modelValue":[a[28]||(a[28]=e=>l.newRisk.PossibleDamage=e),a[29]||(a[29]=e=>l.newRisk.PossibleDamage=n.sanitizeInput(e))],label:"Possible Damage",placeholder:"Describe the potential damage or consequences",rows:4,name:"PossibleDamage","helper-text":"Detail the potential consequences and damage if this risk materializes"},null,8,["modelValue"]),(0,s.bF)(v,{id:"riskMitigation",modelValue:l.newRisk.RiskMitigation,"onUpdate:modelValue":[a[30]||(a[30]=e=>l.newRisk.RiskMitigation=e),a[31]||(a[31]=e=>l.newRisk.RiskMitigation=n.sanitizeInput(e))],label:"Risk Mitigation",placeholder:"Describe mitigation strategies",rows:4,name:"RiskMitigation","helper-text":"Outline strategies and controls to reduce or eliminate this risk"},null,8,["modelValue"])]),(0,s.Lk)("div",vre,[a[72]||(a[72]=(0,s.Lk)("button",{type:"submit",class:"risk-register-submit-btn"},[(0,s.Lk)("i",{class:"fas fa-save"}),(0,s.eW)(" Create Risk ")],-1)),(0,s.Lk)("button",{type:"button",class:"risk-register-reset-btn",onClick:a[32]||(a[32]=(...e)=>n.resetForm&&n.resetForm(...e))},a[71]||(a[71]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset Form ")]))])],32)])):(0,s.Q3)("",!0),l.showSuccessMessage?((0,s.uX)(),(0,s.CE)("div",mre,a[73]||(a[73]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Risk has been successfully created! ")]))):(0,s.Q3)("",!0),l.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"risk-modal-overlay",onClick:a[39]||(a[39]=(0,i.D$)(e=>l.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-modal-content",onClick:a[38]||(a[38]=(0,i.D$)(()=>{},["stop"]))},[a[75]||(a[75]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:a[37]||(a[37]=(0,i.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"])),class:"risk-modal-form"},[(0,s.Lk)("div",kre,[a[74]||(a[74]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[34]||(a[34]=e=>l.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:a[35]||(a[35]=(0,i.jR)((0,i.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,l.newBusinessImpact]])]),(0,s.Lk)("div",hre,[(0,s.Lk)("button",{type:"button",class:"risk-cancel-btn",onClick:a[36]||(a[36]=(0,i.D$)(e=>l.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-add-btn",disabled:!l.newBusinessImpact.trim()}," Add Impact ",8,gre)])],32)])])):(0,s.Q3)("",!0),l.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"risk-modal-overlay",onClick:a[45]||(a[45]=(0,i.D$)(e=>l.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-modal-content",onClick:a[44]||(a[44]=(0,i.D$)(()=>{},["stop"]))},[a[77]||(a[77]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:a[43]||(a[43]=(0,i.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"])),class:"risk-modal-form"},[(0,s.Lk)("div",yre,[a[76]||(a[76]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[40]||(a[40]=e=>l.newCategory=e),placeholder:"Enter new category",onKeyup:a[41]||(a[41]=(0,i.jR)((0,i.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,l.newCategory]])]),(0,s.Lk)("div",fre,[(0,s.Lk)("button",{type:"button",class:"risk-cancel-btn",onClick:a[42]||(a[42]=(0,i.D$)(e=>l.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-add-btn",disabled:!l.newCategory.trim()}," Add Category ",8,bre)])],32)])])):(0,s.Q3)("",!0)])}const Lre=["id","type","value","placeholder","required","disabled","readonly","maxlength","minlength","pattern","autocomplete","autofocus","name"];var wre={__name:"TextInput",props:{id:{type:String,required:!0},modelValue:{type:String,default:""},type:{type:String,default:"text",validator:e=>["text","email","password","search","tel","url"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},maxlength:{type:Number,default:null},minlength:{type:Number,default:null},pattern:{type:String,default:""},autocomplete:{type:String,default:""},autofocus:{type:Boolean,default:!1},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:a}){const t=e,i=a,o=(0,s.EW)(()=>!!t.errorMessage),l=e=>{i("update:modelValue",e.target.value)},n=e=>{i("blur",e)},r=e=>{i("focus",e)};return(a,t)=>((0,s.uX)(),(0,s.Wv)(mD,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("input",{id:e.id,type:e.type,value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,maxlength:e.maxlength,minlength:e.minlength,pattern:e.pattern,autocomplete:e.autocomplete,autofocus:e.autofocus,name:e.name,class:(0,d.C4)(["text-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,Lre)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const Ere=(0,se.A)(wre,[["__scopeId","data-v-9c925992"]]);var Rre=Ere;const Dre=["id","value","placeholder","required","disabled","readonly","min","max","step","name"];var Ire={__name:"NumberInput",props:{id:{type:String,required:!0},modelValue:{type:[Number,String],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},min:{type:Number,default:null},max:{type:Number,default:null},step:{type:[Number,String],default:1},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:a}){const t=e,i=a,o=(0,s.EW)(()=>!!t.errorMessage),l=e=>{const a=e.target.value;i("update:modelValue",""===a?"":Number(a))},n=e=>{i("blur",e)},r=e=>{i("focus",e)};return(a,t)=>((0,s.uX)(),(0,s.Wv)(mD,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("input",{id:e.id,type:"number",value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,min:e.min,max:e.max,step:e.step,name:e.name,class:(0,d.C4)(["number-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,Dre)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const Pre=(0,se.A)(Ire,[["__scopeId","data-v-575b1c18"]]);var _re=Pre;const Sre={key:0,class:"checkbox-group-label"},Are={key:0,class:"required"},Tre={class:"checkbox-options"},xre=["id","value","checked","disabled","name"],Fre=["for"],Vre={key:1,class:"helper-text"},Mre={key:2,class:"error-text"};Boolean,Boolean,Boolean,Boolean;const Xre={key:0,class:"radio-group-label"},Ure={key:0,class:"required"},Nre={class:"radio-options"},$re=["id","value","checked","disabled","name"],Ore=["for"],jre={key:1,class:"helper-text"},Bre={key:2,class:"error-text"};Boolean,Boolean;const Wre={class:"file-input-wrapper"},Qre=["id","accept","multiple","required","disabled","name"],qre={key:0,class:"file-list"},Kre={class:"file-name"},Jre={class:"file-size"},zre=["onClick"];File,FileList,Boolean,Boolean,Boolean;var Hre={name:"CreateRisk",components:{SelectInput:bD,NumberInput:_re,TextInput:Rre,TextareaInput:ED,PopupModal:pv.wA},data(){return{newRisk:{ComplianceId:null,Criticality:"",PossibleDamage:"",Category:"",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskMitigation:"",RiskTitle:"",RiskType:"Current",BusinessImpact:""},businessImpacts:[],selectedBusinessImpacts:[],showBusinessImpactDropdown:!1,businessImpactSearch:"",showAddImpactModal:!1,newBusinessImpact:"",categories:[],selectedCategory:"",showCategoryDropdown:!1,categorySearch:"",showAddCategoryModal:!1,newCategory:"",compliances:[],filteredCompliances:[],complianceSearchQuery:"",showComplianceDropdown:!1,loadingCompliances:!1,selectedComplianceIdText:"",showSuccessMessage:!1,sourceRiskId:null,isLoadingSourceRisk:!1,isAiMode:!1,aiInput:{title:"",description:""},isGeneratingAi:!1,aiSuggestionGenerated:!1,incidentId:null,riskJustifications:{likelihood:"",impact:""},criticalityOptions:[{value:"Critical",label:"Critical"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}],priorityOptions:[{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}],riskTypeOptions:[{value:"Current",label:"Current"},{value:"Emerging",label:"Emerging"},{value:"Residual",label:"Residual"},{value:"Inherent",label:"Inherent"},{value:"Accepted",label:"Accepted"}]}},setup(){const e=(0,ae.rd)(),a=(0,ae.lq)();return{router:e,route:a}},computed:{filteredBusinessImpacts(){if(!this.businessImpactSearch)return this.businessImpacts;const e=this.businessImpactSearch.toLowerCase();return this.businessImpacts.filter(a=>a.value.toLowerCase().includes(e))},filteredCategories(){if(!this.categorySearch)return this.categories;const e=this.categorySearch.toLowerCase();return this.categories.filter(a=>a.value.toLowerCase().includes(e))}},mounted(){this.calculateRiskExposureRating(),this.route.query.source_risk_id&&(this.sourceRiskId=this.route.query.source_risk_id,this.loadSourceRiskData()),this.fetchBusinessImpacts(),this.fetchCategories(),"ai"===this.route.query.mode&&(this.isAiMode=!0,this.sourceRiskId&&this.fetchIncidentDataForAI()),this.fetchCompliances(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{sanitizeHTML(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},sanitizeInput(e){return e?e.replace(/[<>]/g,""):""},encodeQueryParam(e){return e?encodeURIComponent(e):""},async fetchCompliances(){this.loadingCompliances=!0;try{const e=`http://localhost:8000/api/compliances-for-dropdown/${this.encodeQueryParam(this.complianceSearchQuery)}`,a=await qe.A.get(e,{headers:{"Content-Type":"application/json"}});this.compliances=a.data.map(e=>({...e,ComplianceItemDescription:this.sanitizeHTML(e.ComplianceItemDescription),PossibleDamage:this.sanitizeHTML(e.PossibleDamage)})),this.filteredCompliances=[...this.compliances],this.loadingCompliances=!1,this.newRisk.ComplianceId&&this.updateSelectedComplianceIdText()}catch(e){console.error("Error fetching compliances:",e),this.loadingCompliances=!1,this.compliances=[],this.filteredCompliances=[],this.$popup.error("Failed to fetch compliances. Please try again.")}},filterCompliances(){if(!this.complianceSearchQuery)return void(this.filteredCompliances=[...this.compliances]);const e=this.complianceSearchQuery.toLowerCase();this.filteredCompliances=this.compliances.filter(a=>a.ComplianceId&&a.ComplianceId.toString().includes(e)||a.ComplianceItemDescription&&a.ComplianceItemDescription.toLowerCase().includes(e)||a.Criticality&&a.Criticality.toLowerCase().includes(e)||a.PossibleDamage&&a.PossibleDamage.toLowerCase().includes(e))},selectCompliance(e){this.newRisk.ComplianceId=e.ComplianceId,this.selectedComplianceIdText=`Compliance ID: ${e.ComplianceId}`,this.showComplianceDropdown=!1,e.Criticality&&(this.newRisk.Criticality=e.Criticality),e.PossibleDamage&&(this.newRisk.PossibleDamage=e.PossibleDamage)},toggleComplianceDropdown(){this.showComplianceDropdown=!this.showComplianceDropdown,this.showComplianceDropdown&&(this.complianceSearchQuery="",this.filterCompliances())},updateSelectedComplianceIdText(){if(this.newRisk.ComplianceId){const e=this.compliances.find(e=>e.ComplianceId===parseInt(this.newRisk.ComplianceId));this.selectedComplianceIdText=e?`Compliance ID: ${e.ComplianceId}`:`Compliance ID: ${this.newRisk.ComplianceId}`}else this.selectedComplianceIdText=""},truncateText(e,a){return e?e.length>a?e.substring(0,a)+"...":e:""},calculateRiskExposureRating(){const e=parseInt(this.newRisk.RiskLikelihood)||1,a=parseInt(this.newRisk.RiskImpact)||1;this.newRisk.RiskExposureRating=e*a},loadSourceRiskData(){this.sourceRiskId&&(this.isLoadingSourceRisk=!0,qe.A.get(`http://localhost:8000/api/risk-instances/${this.sourceRiskId}/`).then(e=>{console.log("Source risk data loaded:",e.data);const a=e.data;this.incidentId=a.IncidentId,a.ComplianceId&&(this.newRisk.ComplianceId=a.ComplianceId),a.Category&&(this.newRisk.Category=a.Category),a.RiskTitle&&(this.newRisk.RiskTitle=a.RiskTitle),a.RiskDescription&&(this.newRisk.RiskDescription=a.RiskDescription),this.isLoadingSourceRisk=!1,this.isAiMode&&this.incidentId&&this.fetchIncidentDataForAI()}).catch(e=>{console.error("Error loading source risk data:",e),this.isLoadingSourceRisk=!1}))},fetchIncidentDataForAI(){this.incidentId?(this.isGeneratingAi=!0,console.log(`Fetching incident data for ID: ${this.incidentId}`),qe.A.get(`http://localhost:8000/api/incidents/${this.incidentId}/`,{timeout:8e4}).then(e=>{const a=e.data;console.log("Incident data loaded:",a),this.aiInput.title=a.Title||"",this.aiInput.description=a.Description||"",this.aiInput.title||this.aiInput.description?this.generateAiSuggestion():(this.isGeneratingAi=!1,console.warn("Incident data missing title or description"))}).catch(e=>{console.error("Error fetching incident data:",e),this.isGeneratingAi=!1})):console.error("No incident ID available for AI analysis")},setCreationMode(e){this.isAiMode=e,e?this.incidentId&&this.fetchIncidentDataForAI():this.aiSuggestionGenerated=!1},generateAiSuggestion(){if(!this.aiInput.title&&!this.aiInput.description)return void this.$popup.warning("Please provide either a title or description for AI analysis.");this.isGeneratingAi=!0;const e={title:this.aiInput.title||"Untitled Incident",description:this.aiInput.description||this.aiInput.title||"No description available"};console.log("Sending to AI analysis:",e),qe.A.post("http://localhost:8000/api/analyze-incident/",e,{timeout:8e4}).then(e=>{if(console.log("AI Analysis Response:",e.data),e.data.error)throw new Error(e.data.error);e.data.riskLikelihoodJustification||e.data.riskImpactJustification?console.log("âœ… Using AI-generated justifications"):console.log("âš ï¸ No AI justifications found, might be using fallback"),this.mapAnalysisToForm(e.data),this.aiSuggestionGenerated=!0,this.isGeneratingAi=!1}).catch(e=>{console.error("Error analyzing incident:",e.response||e),this.isGeneratingAi=!1;let a="Failed to generate AI suggestion.";e.message?a=e.message:e.response&&e.response.data&&(e.response.data.error?a=e.response.data.error:"object"===typeof e.response.data?a+=" Error: "+JSON.stringify(e.response.data):a+=" Error: "+e.response.data),this.$popup.confirm(a+"\n\nWould you like to try again with different input?","AI Analysis Failed",()=>{},()=>{this.isAiMode=!1,this.aiSuggestionGenerated=!1})})},mapAnalysisToForm(e){if(console.log("Mapping analysis to form:",e),e.criticality){const a={Severe:"Critical",Significant:"High",Moderate:"Medium",Minor:"Low"};this.newRisk.Criticality=a[e.criticality]||e.criticality}if(this.newRisk.PossibleDamage=e.possibleDamage||"",this.newRisk.Category=e.category||"",this.newRisk.RiskDescription=e.riskDescription||"",this.newRisk.RiskTitle=this.aiInput.title||"",e.riskLikelihood&&(this.newRisk.RiskLikelihood=e.riskLikelihood.toString(),this.riskJustifications.likelihood=e.riskLikelihoodJustification||""),e.riskImpact&&(this.newRisk.RiskImpact=e.riskImpact.toString(),this.riskJustifications.impact=e.riskImpactJustification||""),e.riskExposureRating){const a={"Critical Exposure":"9.0","High Exposure":"7.5","Elevated Exposure":"5.5","Low Exposure":"3.0"};this.newRisk.RiskExposureRating=a[e.riskExposureRating]||"6.0"}else{const e=parseFloat(this.newRisk.RiskLikelihood)||5,a=parseFloat(this.newRisk.RiskImpact)||5;this.newRisk.RiskExposureRating=(e*a/10).toFixed(1)}if(e.riskPriority){const a={P0:"Critical",P1:"High",P2:"Medium",P3:"Low"};this.newRisk.RiskPriority=a[e.riskPriority]||"Medium"}e.riskMitigation&&Array.isArray(e.riskMitigation)&&(this.newRisk.RiskMitigation=e.riskMitigation.join("\n")),this.newRisk.BusinessImpact=this.aiInput.description||"",this.newRisk.RiskType=e.category||"",!this.newRisk.ComplianceId&&this.incidentId&&(this.newRisk.ComplianceId=this.incidentId)},resetForm(){this.newRisk={ComplianceId:null,Criticality:"",PossibleDamage:"",Category:"",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskMitigation:"",RiskTitle:"",RiskType:"Current",BusinessImpact:""},this.selectedComplianceIdText="",this.calculateRiskExposureRating(),this.aiSuggestionGenerated=!1,this.aiInput={title:"",description:""},this.riskJustifications={likelihood:"",impact:""},this.selectedCategory=""},async fetchBusinessImpacts(){try{const e=await qe.A.get("http://localhost:8000/api/business-impacts/");"success"===e.data.status&&(this.businessImpacts=e.data.data)}catch(e){console.error("Error fetching business impacts:",e)}},toggleBusinessImpactDropdown(){this.showBusinessImpactDropdown=!this.showBusinessImpactDropdown,this.showBusinessImpactDropdown&&(this.businessImpactSearch="")},closeBusinessImpactDropdown(e){const a=document.querySelector(".risk-business-impact-dropdown");a&&!a.contains(e.target)&&(this.showBusinessImpactDropdown=!1)},toggleBusinessImpact(e){const a=this.selectedBusinessImpacts.findIndex(a=>a.id===e.id);-1===a?this.selectedBusinessImpacts.push(e):this.selectedBusinessImpacts.splice(a,1),this.newRisk.BusinessImpact=this.selectedBusinessImpacts.map(e=>e.value).join(", ")},isBusinessImpactSelected(e){return this.selectedBusinessImpacts.some(a=>a.id===e.id)},async addNewBusinessImpact(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newBusinessImpact.trim())try{console.log("Adding new business impact:",this.newBusinessImpact);const e=await qe.A.post("http://localhost:8000/api/business-impacts/add/",{value:this.newBusinessImpact.trim()});if("success"!==e.data.status)throw new Error("Failed to add business impact: "+(e.data.message||"Unknown error"));console.log("Successfully added business impact:",e.data.data),this.businessImpacts.push(e.data.data),this.toggleBusinessImpact(e.data.data),this.showAddImpactModal=!1,this.newBusinessImpact=""}catch(a){console.error("Error adding new business impact:",a),this.$popup.error("Failed to add new business impact: "+(a.response?.data?.message||a.message))}},async fetchCategories(){try{const e=await qe.A.get("http://localhost:8000/api/risk-categories/");"success"===e.data.status&&(this.categories=e.data.data)}catch(e){console.error("Error fetching categories:",e)}},toggleCategoryDropdown(){this.showCategoryDropdown=!this.showCategoryDropdown,this.showCategoryDropdown&&(this.categorySearch="")},selectCategory(e){this.selectedCategory=e.value,this.newRisk.Category=e.value,this.showCategoryDropdown=!1},async addNewCategory(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newCategory.trim())try{console.log("Adding new category:",this.newCategory);const e=await qe.A.post("http://localhost:8000/api/risk-categories/add/",{value:this.newCategory.trim()});if("success"!==e.data.status)throw new Error("Failed to add category: "+(e.data.message||"Unknown error"));console.log("Successfully added category:",e.data.data),this.categories.push(e.data.data),this.selectCategory(e.data.data),this.showAddCategoryModal=!1,this.newCategory=""}catch(a){console.error("Error adding new category:",a),this.$popup.error("Failed to add new category: "+(a.response?.data?.message||a.message))}},async submitRisk(){const e=this.validateRiskData();if(Object.keys(e).length>0)return void Object.entries(e).forEach(([e,a])=>{this.$popup.error(`${e}: ${a}`)});const a={...this.newRisk,RiskTitle:this.sanitizeInput(this.newRisk.RiskTitle),RiskDescription:this.sanitizeInput(this.newRisk.RiskDescription),PossibleDamage:this.sanitizeInput(this.newRisk.PossibleDamage),RiskMitigation:this.sanitizeInput(this.newRisk.RiskMitigation),BusinessImpact:this.selectedBusinessImpacts.map(e=>this.sanitizeInput(e.value)).join(", "),RiskLikelihood:parseInt(this.newRisk.RiskLikelihood)||1,RiskImpact:parseInt(this.newRisk.RiskImpact)||1,RiskExposureRating:parseFloat(this.newRisk.RiskExposureRating)||1};try{const e=await qe.A.post("http://localhost:8000/api/risks/",a,{headers:{"Content-Type":"application/json"}});console.log("Risk created successfully:",e.data),this.resetForm(),this.$popup.success("Risk created successfully!")}catch(t){console.error("Error creating risk:",t),t.response&&![401,403].includes(t.response.status)&&(t.response.data.errors?Object.entries(t.response.data.errors).forEach(([e,a])=>{this.$popup.error(`${e}: ${a}`)}):this.$popup.error("Failed to create risk. Please try again."))}},validateRiskData(){const e={};if(this.newRisk.Criticality){const a=["Critical","High","Medium","Low"];a.includes(this.newRisk.Criticality)||(e.Criticality=`Must be one of: ${a.join(", ")}`)}if(this.newRisk.RiskPriority){const a=["High","Medium","Low"];a.includes(this.newRisk.RiskPriority)||(e.RiskPriority=`Must be one of: ${a.join(", ")}`)}if(this.newRisk.RiskType){const a=["Current","Residual","Inherent","Emerging","Accept"];a.includes(this.newRisk.RiskType)||(e.RiskType=`Must be one of: ${a.join(", ")}`)}const a=parseInt(this.newRisk.RiskLikelihood);(isNaN(a)||a<1||a>10)&&(e.RiskLikelihood="Must be a number between 1 and 10");const t=parseInt(this.newRisk.RiskImpact);return(isNaN(t)||t<1||t>10)&&(e.RiskImpact="Must be a number between 1 and 10"),this.newRisk.RiskTitle?.trim()||(e.RiskTitle="Risk Title is required"),this.newRisk.RiskDescription?.trim()||(e.RiskDescription="Risk Description is required"),e}}};const Yre=(0,se.A)(Hre,[["render",Cre]]);var Gre=Yre;const Zre={class:"risk-register-container"},ece={class:"risk-register-filters-section"},ace={class:"risk-register-search-row"},tce={class:"risk-register-dropdowns-row"},ice=["onClick"];function sce(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal"),r=(0,s.g2)("Dynamicalsearch"),c=(0,s.g2)("CustomDropdown"),d=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",Zre,[(0,s.bF)(n),a[3]||(a[3]=(0,s.Lk)("div",{class:"risk-register-header-row"},[(0,s.Lk)("h2",{class:"risk-register-title"}," Risk Register List")],-1)),(0,s.Lk)("div",ece,[(0,s.Lk)("div",ace,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>o.searchQuery=e),placeholder:"Search risks..."},null,8,["modelValue"])]),(0,s.Lk)("div",tce,[(0,s.bF)(c,{config:o.criticalityFilter,modelValue:o.selectedCriticality,"onUpdate:modelValue":a[1]||(a[1]=e=>o.selectedCriticality=e),onChange:l.handleFilterChange},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:o.categoryFilter,modelValue:o.selectedCategory,"onUpdate:modelValue":a[2]||(a[2]=e=>o.selectedCategory=e),onChange:l.handleFilterChange},null,8,["config","modelValue","onChange"])])]),(0,s.bF)(d,{title:"",data:l.tableData,columns:o.tableColumns,filters:[],"show-checkbox":!1,"show-actions":!0,"show-pagination":!0,"default-page-size":10,"unique-key":"RiskId",onFilterChange:l.handleFilterChange,onSortChange:l.handleSortChange,onPageChange:l.handlePageChange},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{onClick:a=>l.viewRiskDetails(e.RiskId),class:"risk-register-view-btn"}," View Risk ",8,ice)]),_:1},8,["data","columns","onFilterChange","onSortChange","onPageChange"])])}var oce={name:"RiskRegisterList",components:{DynamicTable:Ll.A,Dynamicalsearch:JK.A,CustomDropdown:mt.A,PopupModal:pv.wA},data(){return{risks:[],selectedCriticality:"",selectedCategory:"",searchQuery:"",loading:!1,criticalityFilter:{name:"criticality",label:"Criticality",values:[],defaultValue:""},categoryFilter:{name:"category",label:"Category",values:[],defaultValue:""},tableColumns:[{key:"RiskId",label:"RISK ID",sortable:!0,cellClass:"risk-register-id"},{key:"RiskTitle",label:"RISK TITLE",sortable:!0},{key:"RiskType",label:"RISK TYPE",sortable:!0},{key:"ComplianceId",label:"COMPLIANCE ID",sortable:!0},{key:"Category",label:"CATEGORY",sortable:!0},{key:"Criticality",label:"CRITICALITY",sortable:!0}]}},computed:{uniqueCriticality(){return[...new Set(this.risks.map(e=>e.Criticality).filter(Boolean))]},uniqueCategory(){return[...new Set(this.risks.map(e=>e.Category).filter(Boolean))]},filteredRisks(){let e=this.risks;if(this.searchQuery&&"string"===typeof this.searchQuery&&""!==this.searchQuery.trim()){const a=this.searchQuery.toLowerCase();e=e.filter(e=>e.RiskTitle&&e.RiskTitle.toLowerCase().includes(a)||e.RiskDescription&&e.RiskDescription.toLowerCase().includes(a)||e.Category&&e.Category.toLowerCase().includes(a)||e.Criticality&&e.Criticality.toLowerCase().includes(a))}return this.selectedCriticality&&(e=e.filter(e=>e.Criticality===this.selectedCriticality)),this.selectedCategory&&(e=e.filter(e=>e.Category===this.selectedCategory)),e},tableData(){return this.filteredRisks.map(e=>({...e,RiskType:e.RiskType||"N/A"}))}},watch:{searchQuery(){},selectedCriticality(){},selectedCategory(){}},mounted(){this.fetchRisks()},methods:{fetchRisks(){this.loading=!0,qe.A.get("http://localhost:8000/api/risks/").then(e=>{this.risks=e.data,this.updateFilterOptions(),this.loading=!1}).catch(e=>{console.error("Error fetching risks:",e),this.loading=!1})},updateFilterOptions(){const e=this.uniqueCriticality.map(e=>({value:e,label:e}));this.criticalityFilter.values=[{value:"",label:"All Criticality"},...e];const a=this.uniqueCategory.map(e=>({value:e,label:e}));this.categoryFilter.values=[{value:"",label:"All Category"},...a]},handleSearch(e){this.searchQuery=e},handleFilterChange(e){"criticality"===e.name?this.selectedCriticality=e.value:"category"===e.name&&(this.selectedCategory=e.value)},handleSortChange(e){console.log("Sort changed:",e)},handlePageChange(e){console.log("Page changed:",e)},viewRiskDetails(e){this.$router.push(`/view-risk/${e}`)},getCriticalityClass(e){return e&&"string"===typeof e?(e=e.toLowerCase(),"critical"===e?"risk-register-priority-critical":"high"===e?"risk-register-priority-high":"medium"===e?"risk-register-priority-medium":"low"===e?"risk-register-priority-low":""):""},formatDate(e){if(!e)return"N/A";const a=new Date(e);return a.toLocaleDateString()}}};const lce=(0,se.A)(oce,[["render",sce]]);var nce=lce;const rce={class:"risk-dashboard-container"},cce={class:"risk-filters-section"},dce={class:"risk-dashboard-filters"},uce={class:"risk-filter-group"},pce=["value"],vce={class:"risk-filter-group"},mce=["value"],kce={class:"risk-filter-group"},hce={class:"risk-metrics-section"},gce={class:"risk-performance-summary"},yce={key:0,class:"risk-no-data-message"},fce={class:"risk-summary-card"},bce={class:"risk-summary-content"},Cce={key:0,class:"risk-summary-value"},Lce={key:1,class:"risk-summary-value empty"},wce={key:2,class:"risk-summary-trend positive"},Ece={class:"risk-summary-card"},Rce={class:"risk-summary-content"},Dce={key:0,class:"risk-summary-value"},Ice={key:1,class:"risk-summary-value empty"},Pce={key:2,class:"risk-summary-trend positive"},_ce={class:"risk-summary-card"},Sce={class:"risk-summary-content"},Ace={key:0,class:"risk-summary-value"},Tce={key:1,class:"risk-summary-value empty"},xce={key:2,class:"risk-summary-trend negative"},Fce={class:"risk-summary-card"},Vce={class:"risk-summary-content"},Mce={key:0,class:"risk-summary-value"},Xce={key:1,class:"risk-summary-value empty"},Uce={key:2,class:"risk-summary-trend positive"},Nce={class:"risk-summary-card"},$ce={class:"risk-summary-content"},Oce={key:0,class:"risk-summary-value"},jce={key:1,class:"risk-summary-value empty"},Bce={key:2,class:"risk-summary-trend positive"},Wce={class:"risk-charts-row risk-charts-row-three"},Qce={class:"risk-chart-card"},qce={class:"risk-chart-container"},Kce={key:0,style:{"text-align":"center",color:"#aaa",padding:"40px"}},Jce={class:"risk-chart-legend"},zce={class:"risk-legend-label"},Hce={class:"risk-legend-value"},Yce={class:"risk-chart-insights"},Gce={class:"risk-insight-item"},Zce={class:"risk-insight-value"},ede={class:"risk-chart-card risk-heatmap-card"},ade={class:"risk-heatmap-container"},tde={ref:"heatmapCanvas"},ide={class:"risk-charts-row-uneven"},sde={class:"risk-chart-card risk-trend"},ode={class:"risk-chart-container"},lde={key:0,class:"no-chart-data"},nde={class:"risk-chart-insights"},rde={class:"risk-insight-item"},cde={class:"risk-chart-card risk-dynamic-chart"},dde={class:"risk-card-header"},ude={class:"risk-axis-controls"},pde={class:"risk-axis-control"},vde={class:"risk-axis-control"},mde=["value"],kde={class:"risk-chart-container"},hde={class:"risk-chart-tabs"},gde=["onClick"],yde={class:"risk-chart-content"},fde={key:0,class:"risk-chart-loading"},bde={key:1,class:"no-chart-data"};function Cde(e,a,t,o,l,n){const r=(0,s.g2)("Doughnut"),c=(0,s.g2)("LineChart"),u=(0,s.g2)("Bar");return(0,s.uX)(),(0,s.CE)("div",rce,[a[34]||(a[34]=(0,s.Fv)('<div class="risk-dashboard-header" data-v-fce55e70><h2 class="risk-dashboard-heading" data-v-fce55e70>Risk Dashboard</h2><div class="risk-dashboard-actions" data-v-fce55e70><button class="risk-action-btn refresh" data-v-fce55e70><i class="fas fa-sync-alt" data-v-fce55e70></i> Refresh</button><button class="risk-action-btn export" data-v-fce55e70><i class="fas fa-download" data-v-fce55e70></i> Export</button></div></div>',1)),(0,s.Lk)("div",cce,[(0,s.Lk)("div",dce,[(0,s.Lk)("div",uce,[a[10]||(a[10]=(0,s.Lk)("label",null,"Time Range",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.filters.timeRange=e),class:"risk-filter-select",onChange:a[1]||(a[1]=(...e)=>o.fetchRiskMetrics&&o.fetchRiskMetrics(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.timeRangeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,pce))),128))],544),[[i.u1,o.filters.timeRange]])]),(0,s.Lk)("div",vce,[a[11]||(a[11]=(0,s.Lk)("label",null,"Category",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>o.filters.category=e),class:"risk-filter-select",onChange:a[3]||(a[3]=(...e)=>o.fetchRiskMetrics&&o.fetchRiskMetrics(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.categoryOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,mce))),128))],544),[[i.u1,o.filters.category]])]),(0,s.Lk)("div",kce,[a[13]||(a[13]=(0,s.Lk)("label",null,"Priority",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>o.filters.priority=e),class:"risk-filter-select",onChange:a[5]||(a[5]=(...e)=>o.fetchRiskMetrics&&o.fetchRiskMetrics(...e))},a[12]||(a[12]=[(0,s.Fv)('<option value="all" data-v-fce55e70>All Priorities</option><option value="critical" data-v-fce55e70>Critical</option><option value="high" data-v-fce55e70>High</option><option value="medium" data-v-fce55e70>Medium</option><option value="low" data-v-fce55e70>Low</option>',5)]),544),[[i.u1,o.filters.priority]])])])]),(0,s.Lk)("div",hce,[(0,s.Lk)("div",gce,[o.hasData?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",fce,[a[15]||(a[15]=(0,s.Lk)("div",{class:"risk-summary-icon total"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"})],-1)),(0,s.Lk)("div",bce,[a[14]||(a[14]=(0,s.Lk)("div",{class:"risk-summary-label"},"Total Risks",-1)),o.metrics.total>0?((0,s.uX)(),(0,s.CE)("div",Cce,(0,d.v_)(o.metrics.total),1)):((0,s.uX)(),(0,s.CE)("div",Lce,"No data found")),o.metrics.total>0?((0,s.uX)(),(0,s.CE)("div",wce,"+12 this month")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Ece,[a[17]||(a[17]=(0,s.Lk)("div",{class:"risk-summary-icon accepted"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",Rce,[a[16]||(a[16]=(0,s.Lk)("div",{class:"risk-summary-label"},"Accepted Risks",-1)),o.metrics.accepted>0?((0,s.uX)(),(0,s.CE)("div",Dce,(0,d.v_)(o.metrics.accepted),1)):((0,s.uX)(),(0,s.CE)("div",Ice,"No data found")),o.metrics.accepted>0?((0,s.uX)(),(0,s.CE)("div",Pce,"+5 this month")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",_ce,[a[19]||(a[19]=(0,s.Lk)("div",{class:"risk-summary-icon rejected"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",Sce,[a[18]||(a[18]=(0,s.Lk)("div",{class:"risk-summary-label"},"Rejected Risks",-1)),o.metrics.rejected>0?((0,s.uX)(),(0,s.CE)("div",Ace,(0,d.v_)(o.metrics.rejected),1)):((0,s.uX)(),(0,s.CE)("div",Tce,"No data found")),o.metrics.rejected>0?((0,s.uX)(),(0,s.CE)("div",xce,"+3 this week")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Fce,[a[21]||(a[21]=(0,s.Lk)("div",{class:"risk-summary-icon mitigated"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"})],-1)),(0,s.Lk)("div",Vce,[a[20]||(a[20]=(0,s.Lk)("div",{class:"risk-summary-label"},"Mitigated Risks",-1)),o.metrics.mitigated>0?((0,s.uX)(),(0,s.CE)("div",Mce,(0,d.v_)(o.metrics.mitigated),1)):((0,s.uX)(),(0,s.CE)("div",Xce,"No data found")),o.metrics.mitigated>0?((0,s.uX)(),(0,s.CE)("div",Uce,"+8 this month")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Nce,[a[23]||(a[23]=(0,s.Lk)("div",{class:"risk-summary-icon inprogress"},[(0,s.Lk)("i",{class:"fas fa-spinner"})],-1)),(0,s.Lk)("div",$ce,[a[22]||(a[22]=(0,s.Lk)("div",{class:"risk-summary-label"},"In Progress Risks",-1)),o.metrics.inProgress>0?((0,s.uX)(),(0,s.CE)("div",Oce,(0,d.v_)(o.metrics.inProgress),1)):((0,s.uX)(),(0,s.CE)("div",jce,"No data found")),o.metrics.inProgress>0?((0,s.uX)(),(0,s.CE)("div",Bce,"+6 this week")):(0,s.Q3)("",!0)])])],64)):((0,s.uX)(),(0,s.CE)("div",yce," No data found for the selected filters "))])]),(0,s.Lk)("div",Wce,[(0,s.Lk)("div",Qce,[a[25]||(a[25]=(0,s.Lk)("div",{class:"risk-card-header"},[(0,s.Lk)("h3",null,"Risk Distribution by Category")],-1)),(0,s.Lk)("div",qce,[o.categoryDistributionData.labels.length&&o.categoryDistributionData.datasets[0].data.length?((0,s.uX)(),(0,s.Wv)(r,{key:1,data:o.categoryDistributionData,options:o.donutChartOptions},null,8,["data","options"])):((0,s.uX)(),(0,s.CE)("div",Kce," No category data to display. "))]),(0,s.Lk)("div",Jce,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.label,class:"risk-legend-item"},[(0,s.Lk)("span",{class:"risk-legend-color",style:(0,d.Tr)({backgroundColor:e.color})},null,4),(0,s.Lk)("span",zce,(0,d.v_)(e.label),1),(0,s.Lk)("span",Hce,(0,d.v_)(e.value),1)]))),128))]),(0,s.Lk)("div",Yce,[(0,s.Lk)("div",Gce,[a[24]||(a[24]=(0,s.Lk)("span",{class:"risk-insight-label"},"Highest Category:",-1)),(0,s.Lk)("span",Zce,(0,d.v_)(o.highestCategory.name)+" ("+(0,d.v_)(o.highestCategory.percent)+"%)",1)])])]),(0,s.Lk)("div",ede,[a[26]||(a[26]=(0,s.Lk)("div",{class:"risk-card-header"},[(0,s.Lk)("h3",null,"Risk Matrix Heatmap")],-1)),(0,s.Lk)("div",ade,[(0,s.Lk)("canvas",tde,null,512)])])]),(0,s.Lk)("div",ide,[(0,s.Lk)("div",sde,[a[28]||(a[28]=(0,s.Lk)("div",{class:"risk-card-header"},[(0,s.Lk)("h3",null,"Risk Trend Over Time")],-1)),(0,s.Lk)("div",ode,[o.riskTrendData.labels.length?((0,s.uX)(),(0,s.Wv)(c,{key:1,data:o.riskTrendData,options:o.riskTrendOptions},null,8,["data","options"])):((0,s.uX)(),(0,s.CE)("div",lde," No trend data available "))]),(0,s.Lk)("div",nde,[(0,s.Lk)("div",rde,[a[27]||(a[27]=(0,s.Lk)("span",{class:"risk-insight-label"},"Trend:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["risk-insight-value",o.getTrendClass()])},(0,d.v_)(o.getTrendText()),3)])])]),(0,s.Lk)("div",cde,[(0,s.Lk)("div",dde,[a[32]||(a[32]=(0,s.Lk)("h3",null,"Custom Risk Analysis",-1)),(0,s.Lk)("div",ude,[(0,s.Lk)("div",pde,[a[30]||(a[30]=(0,s.Lk)("label",null,"X-Axis",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[6]||(a[6]=e=>o.selectedXAxis=e),class:"risk-axis-select",onChange:a[7]||(a[7]=(...e)=>o.fetchCustomAnalysisData&&o.fetchCustomAnalysisData(...e))},a[29]||(a[29]=[(0,s.Fv)('<option value="time" data-v-fce55e70>Time</option><option value="category" data-v-fce55e70>Category</option><option value="priority" data-v-fce55e70>Risk Priority</option><option value="criticality" data-v-fce55e70>Criticality</option><option value="status" data-v-fce55e70>Status</option><option value="appetite" data-v-fce55e70>Risk Appetite</option><option value="mitigation" data-v-fce55e70>Mitigation Status</option>',7)]),544),[[i.u1,o.selectedXAxis]])]),(0,s.Lk)("div",vde,[a[31]||(a[31]=(0,s.Lk)("label",null,"Y-Axis",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>o.selectedYAxis=e),class:"risk-axis-select",onChange:a[9]||(a[9]=(...e)=>o.fetchCustomAnalysisData&&o.fetchCustomAnalysisData(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.yAxisOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,mde))),128))],544),[[i.u1,o.selectedYAxis]])])])]),(0,s.Lk)("div",kde,[(0,s.Lk)("div",hde,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["line","bar","doughnut"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["risk-chart-tab-btn",{active:o.activeChart===e}]),onClick:a=>o.activeChart=e},[(0,s.Lk)("i",{class:(0,d.C4)(o.getChartIcon(e))},null,2)],10,gde)),64))]),(0,s.Lk)("div",yde,[o.isLoadingCustomChart?((0,s.uX)(),(0,s.CE)("div",fde,a[33]||(a[33]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("span",null,"Loading chart data...",-1)]))):o.hasCustomChartData?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},["line"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:0,data:o.lineChartData,options:o.customChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"bar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(u,{key:1,data:o.barChartData,options:o.customChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"doughnut"===o.activeChart?((0,s.uX)(),(0,s.Wv)(r,{key:2,data:o.donutChartData,options:o.customDonutOptions},null,8,["data","options"])):(0,s.Q3)("",!0)],64)):((0,s.uX)(),(0,s.CE)("div",bde," No data available for selected parameters "))])])])])])}ze.t1.register(ze.Bs,ze.E8,ze.PP,ze.kc,ze.FN,ze.No,ze.m_,ze.s$);var Lde={name:"RiskDashboard",components:{Doughnut:He.nu,Bar:He.yP,LineChart:He.N1},setup(){console.log("=== RiskDashboard Component Debug ===");const e=(0,ee.KR)(!0),a=(0,ee.KR)("time"),t=(0,ee.KR)("performance");(0,s.wB)([a,t],([e,a])=>{o(e,a)});const i={Operational:{active:12,inactive:3,onhold:2},Compliance:{active:10,inactive:4,onhold:1},"IT Security":{active:8,inactive:6,onhold:2},Financial:{active:14,inactive:2,onhold:1},Strategic:{active:9,inactive:5,onhold:3}},o=(e,a)=>{const t=r(e);let s=c(a);if("categories"===e){const e=Object.values(i).reduce((e,a)=>e+a.active,0),a=Object.values(i).reduce((e,a)=>e+a.inactive,0),s=Object.values(i).reduce((e,a)=>e+a.onhold,0);return m.labels=["Active","Inactive","On Hold"],m.datasets[0].data=[e,a,s],m.datasets[0].backgroundColor=["#4ade80","#f87171","#fbbf24"],g.labels=t,g.datasets=[{label:"Active",data:t.map(e=>i[e]?.active||0),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Inactive",data:t.map(e=>i[e]?.inactive||0),backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4},{label:"On Hold",data:t.map(e=>i[e]?.onhold||0),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4}],p.labels=t,p.datasets[0].data=t.map(e=>i[e]?.active||0),void(p.datasets[0].label="Active")}if("status"===e){const e=["Active","Inactive","On Hold"],t=Object.values(i).reduce((e,a)=>e+a.active,0),s=Object.values(i).reduce((e,a)=>e+a.inactive,0),o=Object.values(i).reduce((e,a)=>e+a.onhold,0),n=[t,s,o];return m.labels=e,m.datasets[0].data=n,m.datasets[0].backgroundColor=["#4ade80","#f87171","#fbbf24"],g.labels=e,g.datasets=[{label:l(a),data:n,backgroundColor:["#4ade80","#f87171","#fbbf24"],borderRadius:4}],p.labels=e,p.datasets[0].data=n,void(p.datasets[0].label=l(a))}p.labels=t,p.datasets[0].data=s,p.datasets[0].label=l(a),g.labels=t,g.datasets=n(a),m.labels=t,m.datasets[0].data=s},l=e=>{const a={count:"Count",exposure:"Risk Exposure Rating",impact:"Risk Impact",likelihood:"Risk Likelihood",avgExposure:"Average Exposure",maxExposure:"Maximum Exposure",mitigated:"Mitigated Risks",avgImpact:"Average Impact",avgLikelihood:"Average Likelihood",responseTime:"Response Time (days)",mitigationTime:"Mitigation Time (days)",openRisks:"Open Risks",reviewCount:"Review Count",daysInStatus:"Days in Status",exposureByStatus:"Exposure by Status",acceptedRisks:"Accepted Risks",rejectedRisks:"Rejected Risks",mitigationCost:"Mitigation Cost",completedMitigations:"Completed Mitigations",pendingMitigations:"Pending Mitigations"};return a[e]||"Value"},n=e=>{const a=c(e);return[{label:"High",data:a.map(e=>Math.round(.4*e)),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Medium",data:a.map(e=>Math.round(.35*e)),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4},{label:"Low",data:a.map(e=>Math.round(.25*e)),backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4}]},r=e=>{switch(e){case"time":return["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];case"risks":return["Data Breach","Operational","Compliance","Financial","Strategic"];case"categories":return["Operational","Compliance","IT Security","Financial","Strategic"];case"status":return["Active","Inactive","On Hold"];default:return[]}},c=e=>{switch(e){case"performance":return[85,88,92,87,90,95,89];case"compliance":return[92,95,88,90,93,96,91];case"risk":return[65,70,68,72,75,80,78];default:return[]}},d=[{type:"line",icon:"fas fa-chart-line",label:"Line"},{type:"bar",icon:"fas fa-chart-bar",label:"Bar"},{type:"doughnut",icon:"fas fa-dot-circle",label:"Donut"}],u=(0,ee.KR)("line"),p=(0,ee.Kh)({labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Risk Performance",data:[42,38,35,40,56,75,82],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}),v={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:10},padding:5}},x:{grid:{display:!1},ticks:{font:{size:10},padding:5}}},animation:{duration:1e3,easing:"easeOutQuart"},layout:{padding:0}},m=(0,ee.Kh)({labels:["Active","Inactive","On Hold"],datasets:[{data:[60,25,15],backgroundColor:["#4ade80","#f87171","#fbbf24"],borderWidth:0,hoverOffset:5}]}),k=(0,s.EW)(()=>{const e=z.datasets[0].data.reduce((e,a)=>e+a,0);return z.datasets[0].data.map(a=>e>0?Math.round(a/e*100):0)}),h={cutout:"65%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>{const a=z.labels[e.dataIndex],t=z.datasets[0].data[e.dataIndex],i=k.value[e.dataIndex];return`${a}: ${t} (${i}%)`}}},percentageLabels:{id:"percentageLabels",afterDraw:e=>{const a=e.ctx,t=e.data.datasets[0].data.reduce((e,a)=>e+a,0);e.data.datasets[0].data.forEach((i,s)=>{if(i>0){const o=Math.round(i/t*100),l=e.getDatasetMeta(0).data[s].x,n=e.getDatasetMeta(0).data[s].y,r=e.getDatasetMeta(0).data[s].outerRadius,c=e.getDatasetMeta(0).data[s].startAngle,d=e.getDatasetMeta(0).data[s].endAngle,u=c+(d-c)/2,p=.7*r,v=l+Math.cos(u)*p,m=n+Math.sin(u)*p;a.save(),a.translate(v,m),a.rotate(u+Math.PI/2),a.textAlign="center",a.textBaseline="middle",a.fillStyle="#ffffff",a.font="12px Arial",a.fillText(`${o}%`,0,0),a.restore()}})}}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutCubic"},layout:{padding:0}},g=(0,ee.Kh)({labels:["Operational","Compliance"],datasets:[{label:"Active",data:[8,5],backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Inactive",data:[6,7],backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4},{label:"On Hold",data:[3,0],backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4}]}),y={plugins:{legend:{display:!1}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#222",font:{size:9},padding:5}},y:{stacked:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:9},padding:5}}},animation:{duration:800,easing:"easeInOutQuart"},layout:{padding:0}},f=()=>{e.value=!e.value},b=(0,ee.Kh)({total:0,accepted:0,rejected:0,mitigated:0,inProgress:0}),C=(0,ee.KR)(!0),L=async()=>{try{console.log("Fetching risk metrics with filters:",w);const e=new URLSearchParams({timeRange:w.timeRange,category:w.category,priority:w.priority}),i=await qe.A.get(`http://localhost:8000/api/risk/metrics?${e}`);console.log("Received metrics data:",i.data),C.value=i.data.total>0,Object.assign(b,i.data),o(a.value,t.value)}catch(e){if(console.error("Error fetching risk metrics:",e),ht.Ay.handleApiError(e))return;C.value=!1,Object.assign(b,{total:0,accepted:0,rejected:0,mitigated:0,inProgress:0})}},w=(0,ee.Kh)({timeRange:"6months",category:"all",priority:"all"}),E=(0,ee.KR)([{value:"30days",label:"Last 30 Days"},{value:"90days",label:"Last 90 Days"},{value:"6months",label:"Last 6 Months"},{value:"1year",label:"Last 1 Year"}]),R=(0,ee.KR)([{value:"all",label:"All Categories"}]),D=(0,ee.KR)([{value:"count",label:"Risk Count"},{value:"exposure",label:"Risk Exposure Rating"},{value:"impact",label:"Risk Impact"},{value:"likelihood",label:"Risk Likelihood"}]),I=async()=>{try{console.log("Fetching category options for dropdown...");const e=await qe.A.get("http://localhost:8000/api/risk/categories-for-dropdown/");e.data&&"success"===e.data.status&&e.data.data&&(R.value=[{value:"all",label:"All Categories"},...e.data.data.map(e=>({value:e.id,label:e.value}))],console.log("Fetched category options:",R.value))}catch(e){console.error("Error fetching category options:",e),ht.Ay.handleApiError(e,"view risk categories")}},P=async()=>{try{console.log("Fetching category distribution data...");const e=await qe.A.get("http://localhost:8000/api/risk/metrics-by-category/");e.data&&e.data.categories&&(z.labels=e.data.categories.map(e=>e.category),z.datasets[0].data=e.data.categories.map(e=>e.count),z.datasets[0].backgroundColor=J(e.data.categories.length))}catch(e){if(console.error("Error fetching category distribution:",e),ht.Ay.handleApiError(e))return}};(0,s.sV)(()=>{console.log("Component mounted, fetching initial data..."),A(),P(),L(),G(),I()}),(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],P);const _=(0,ee.Kh)({labels:[],datasets:[{label:"Risk Count",data:[],borderColor:"#f87171",backgroundColor:"rgba(248, 113, 113, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]}),S={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{stepSize:1}},x:{grid:{display:!1}}},plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#000",bodyColor:"#666",borderColor:"#ddd",borderWidth:1}},interaction:{mode:"nearest",axis:"x",intersect:!1}},A=async()=>{try{console.log("Fetching risk trend data...");const e=new URLSearchParams({timeRange:w.timeRange,category:w.category}),a=await qe.A.get(`http://localhost:8000/api/risk/trend-over-time/?${e}`);console.log("Risk trend API response:",a.data),a.data&&(a.data.months&&Array.isArray(a.data.months)?(_.labels=a.data.months,a.data.trendData&&Array.isArray(a.data.trendData)?(_.datasets[0].data=a.data.trendData,console.log("Using trendData array:",a.data.trendData)):a.data.newRisks&&a.data.newRisks.data?(_.datasets[0].data=a.data.newRisks.data,console.log("Using newRisks.data array:",a.data.newRisks.data)):(console.warn("No valid trend data found in response"),_.datasets[0].data=[])):(console.warn("No valid months array found in response"),_.labels=[],_.datasets[0].data=[]))}catch(e){if(console.error("Error fetching risk trend data:",e),ht.Ay.handleApiError(e))return;_.labels=[],_.datasets[0].data=[]}};(0,s.wB)([()=>w.timeRange,()=>w.category],()=>{console.log("\n=== Filter Change Detected ==="),console.log("New filter values:",{timeRange:w.timeRange,category:w.category}),A()});const T=(0,s.EW)(()=>{const e=z.datasets[0].data,a=z.labels;if(!e.length)return{name:"",percent:0};const t=Math.max(...e),i=e.indexOf(t),s=e.reduce((e,a)=>e+a,0),o=s>0?Math.round(t/s*100):0;return{name:a[i]||"",percent:o}}),x=()=>{const e=_.datasets[0]?.data||[];if(!e.length)return"No data";const a=e.length-1,t=a>0?a-1:0;return e[a]>e[t]?"Increasing â†‘":e[a]<e[t]?"Decreasing â†“":"Stable â†’"},F=()=>{if(!_.datasets[0]?.data?.length)return"";const e=x();return e.includes("Increasing")?"positive":e.includes("Decreasing")?"negative":""},V=async()=>{try{const e=new URLSearchParams({timeRange:w.timeRange,category:w.category,priority:w.priority}),a=await qe.A.get(`http://localhost:8000/api/risk/metrics-by-category?${e}`);if(a.data&&a.data.statusBreakdown){const e=Object.keys(a.data.statusBreakdown),t=e.map(e=>a.data.statusBreakdown[e]);z.labels=e,z.datasets[0].data=t}const t=await qe.A.get(`http://localhost:8000/api/risk/identification-rate?${e}`);if(t.data&&t.data.months&&t.data.trendData){_.labels=t.data.months,_.datasets[0].data=t.data.trendData;const a=await qe.A.get(`http://localhost:8000/api/risk/mitigation-completion-rate?${e}`);a.data&&a.data.trendData&&(_.datasets[0].data=a.data.trendData)}}catch(e){if(console.error("Error fetching specialized chart data:",e),ht.Ay.handleApiError(e))return}};V(),(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],()=>{V()});const M=e=>{switch(e){case"line":return"fas fa-chart-line";case"bar":return"fas fa-chart-bar";case"doughnut":return"fas fa-chart-pie";default:return"fas fa-chart-line"}},X=(0,ee.KR)(null),U=async()=>{try{const e=w.timeRange||"30days";console.log(`Fetching mitigation cost data with period: ${e}`);const a="localhost"===window.location.hostname?"http://localhost:8000":"",t=new URLSearchParams({timeRange:e,category:w.category||"all",priority:w.priority||"all"}),i=await qe.A.get(`${a}/api/risk/mitigation-cost/?${t}`);200===i.status?(console.log("Raw mitigation cost API response:",i.data),X.value=i.data,N()):console.error("Failed to fetch mitigation cost data:",i.status)}catch(e){if(console.error("Error fetching mitigation cost data:",e),ht.Ay.handleApiError(e))return}},N=()=>{"bar"===u.value&&"mitigationCost"===t.value&&(g.labels=X.value.monthlyData.map(e=>e.month),g.datasets[0].data=X.value.monthlyData.map(e=>e.cost))};(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],()=>{console.log("Filters changed, updating data"),U(),V()});const $={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:10},padding:5}},x:{grid:{display:!1},ticks:{font:{size:10},padding:5}}},animation:{duration:800,easing:"easeOutQuart"},layout:{padding:{top:30,right:8,bottom:8,left:8}}},O={cutout:"65%",plugins:{legend:{display:!1}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutCubic"},layout:{padding:{top:30,right:0,bottom:0,left:0}}},j=(0,ee.KR)(null),B=(0,ee.KR)(null),W=(0,ee.KR)([]),Q=async()=>{try{console.log("Fetching heatmap data...");const e=await qe.A.get("/api/risk/heatmap/");console.log("Received heatmap data:",e.data),W.value=e.data.heatmap_data,console.log("Total risks:",e.data.total_risks)}catch(e){console.error("Error fetching heatmap data:",e)}},q=e=>0===e?"rgba(0, 104, 55, 0.7)":1===e?"rgba(26, 152, 80, 0.7)":2===e?"rgba(145, 207, 96, 0.7)":3===e?"rgba(217, 239, 139, 0.7)":4===e?"rgba(254, 224, 139, 0.7)":"rgba(215, 48, 39, 0.7)",K=()=>{if(!j.value)return void console.error("Canvas element not found");const e=j.value.getContext("2d");e?(B.value&&(B.value.destroy(),B.value=null),(0,s.dY)(()=>{const a=[],t=new Set;if(W.value&&Array.isArray(W.value)){W.value.forEach(e=>{e.forEach(e=>{e>0&&t.add(e)})}),console.log("Unique values found:",Array.from(t)),Array.from(t).sort((e,a)=>e-a).forEach(e=>{a.push({label:`Count: ${e}`,data:[],backgroundColor:q(e),pointStyle:"square",pointRadius:15,pointHoverRadius:18})}),W.value.forEach((e,i)=>{e.forEach((e,s)=>{if(e>0){const o=Array.from(t).sort((e,a)=>e-a).indexOf(e);a[o].data.push({x:s+1,y:10-i})}})}),console.log("Prepared datasets:",a);try{B.value=new ze.t1(e,{type:"scatter",data:{datasets:a},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"right",labels:{usePointStyle:!0,pointStyle:"square"}},tooltip:{callbacks:{label:e=>`Impact: ${11-e.raw.y}, Likelihood: ${e.raw.x}, ${e.dataset.label}`}}},scales:{x:{type:"linear",position:"bottom",min:.5,max:10.5,title:{display:!0,text:"Likelihood",font:{weight:"bold"}},ticks:{stepSize:1},grid:{display:!0,color:"#ddd"}},y:{type:"linear",min:.5,max:10.5,title:{display:!0,text:"Impact",font:{weight:"bold"}},ticks:{stepSize:1,callback:e=>11-Math.round(e)},grid:{display:!0,color:"#ddd"}}}}})}catch(i){console.error("Error creating chart:",i)}}else console.error("Invalid heatmap data:",W.value)})):console.error("Could not get canvas context")};(0,s.sV)(async()=>{console.log("Component mounted"),await Q(),K()}),(0,s.wB)(W,()=>{console.log("Heatmap data changed, reinitializing chart"),K()});const J=e=>{const a=["#4ade80","#f87171","#fbbf24","#60a5fa","#818cf8","#f472b6","#a78bfa","#34d399","#fbbf24","#fb7185","#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444"],t=[];for(let i=0;i<e;i++)t.push(a[i%a.length]);return t},z=(0,ee.Kh)({labels:[],datasets:[{data:[],backgroundColor:[],borderWidth:0,hoverOffset:5}]}),H=(0,ee.KR)(!1),Y=(0,ee.KR)(!1),G=async()=>{try{H.value=!0,Y.value=!1,console.log("Fetching custom analysis data..."),console.log(`Parameters: x_axis=${a.value}, y_axis=${t.value}`);const e=new URLSearchParams({x_axis:a.value,y_axis:t.value,timeRange:w.timeRange,category:w.category,priority:w.priority}),i=await qe.A.get(`http://localhost:8000/api/risk/custom-analysis/?${e}`);if(console.log("Received custom analysis data:",i.data),i.data&&i.data.labels&&i.data.datasets){const e=i.data.labels,a=i.data.datasets;if(p.labels=e,p.datasets=a.map(e=>({...e,fill:!1,tension:.4,pointBackgroundColor:e.backgroundColor,pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6})),g.labels=e,g.datasets=a.map(e=>({...e,barPercentage:.7,categoryPercentage:.8})),m.labels=e,1===a.length)m.datasets[0].data=a[0].data,m.datasets[0].backgroundColor=a[0].data.map((e,t)=>J(a[0].data.length)[t]);else{const t=[];for(let i=0;i<e.length;i++){let e=0;for(const t of a)e+=t.data[i]||0;t.push(e)}m.datasets[0].data=t,m.datasets[0].backgroundColor=J(e.length)}Y.value=!0}else console.warn("No valid custom analysis data found in response"),Y.value=!1}catch(e){if(console.error("Error fetching custom analysis data:",e),ht.Ay.handleApiError(e))return;Y.value=!1}finally{H.value=!1}};(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],()=>{G()}),(0,s.wB)(u,()=>{(0,s.dY)(()=>{console.log("Chart type changed to:",u.value)})});const Z=(0,s.EW)(()=>z.labels.map((e,a)=>({label:e,value:z.datasets[0].data[a],color:z.datasets[0].backgroundColor[a]})).filter(e=>e.value>0));return{lineChartData:p,lineChartOptions:v,donutChartData:m,donutChartOptions:h,barChartData:g,barChartOptions:y,showRiskDetails:e,toggleRiskDetails:f,chartTypes:d,activeChart:u,selectedXAxis:a,selectedYAxis:t,metrics:b,filters:w,hasData:C,fetchRiskMetrics:L,categoryOptions:R,fetchCategoryOptions:I,fetchCategoryDistribution:P,categoryDistributionData:z,riskTrendData:_,highestCategory:T,getTrendText:x,getTrendClass:F,getChartIcon:M,fetchMitigationCostData:U,updateMitigationCostCharts:N,customChartOptions:$,customDonutOptions:O,heatmapCanvas:j,heatmapData:W,fetchHeatmapData:Q,initializeHeatmap:K,generateChartColors:J,yAxisOptions:D,riskTrendOptions:S,fetchRiskTrendData:A,timeRangeOptions:E,isLoadingCustomChart:H,hasCustomChartData:Y,fetchCustomAnalysisData:G,filteredCategories:Z,categoryPercentages:k}}};const wde=(0,se.A)(Lde,[["render",Cde],["__scopeId","data-v-fce55e70"]]);var Ede=wde;const Rde={class:"risk-instance-container"},Dde={class:"risk-instance-filters-section"},Ide={class:"risk-instance-search-row"},Pde={class:"risk-instance-dropdowns-row"},_de=["onClick"];function Sde(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal"),r=(0,s.g2)("Dynamicalsearch"),c=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",Rde,[(0,s.bF)(n),a[6]||(a[6]=(0,s.Lk)("div",{class:"risk-instance-header-row"},[(0,s.Lk)("h2",{class:"risk-instance-title"},"Risk Instances")],-1)),(0,s.Lk)("div",Dde,[(0,s.Lk)("div",Ide,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>o.searchQuery=e),placeholder:"Search risk instances...",onInput:l.applyFilters},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",Pde,[(0,s.bF)(c,{config:l.criticalityFilter,modelValue:o.selectedCriticality,"onUpdate:modelValue":a[1]||(a[1]=e=>o.selectedCriticality=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:l.statusFilter,modelValue:o.selectedStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>o.selectedStatus=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:l.categoryFilter,modelValue:o.selectedCategory,"onUpdate:modelValue":a[3]||(a[3]=e=>o.selectedCategory=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:l.priorityFilter,modelValue:o.selectedPriority,"onUpdate:modelValue":a[4]||(a[4]=e=>o.selectedPriority=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"])])]),(0,s.bF)(u,{title:"",data:l.filteredInstances,columns:l.tableColumns,filters:[],"show-checkbox":!1,"show-actions":!0,"show-pagination":!0,"default-page-size":10,"unique-key":"RiskInstanceId",onRowSelect:l.handleRowSelect},{"cell-Origin":(0,s.k6)(()=>a[5]||(a[5]=[(0,s.Lk)("span",{class:"risk-instance-origin-badge"},"MANUAL",-1)])),"cell-RiskStatus":(0,s.k6)(({row:e})=>[(0,s.Lk)("span",null,(0,d.v_)(e.RiskStatus||"Open"),1)]),actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{onClick:a=>l.viewInstanceDetails(e.RiskInstanceId),class:"risk-instance-view-btn"}," View Instance ",8,_de)]),_:1},8,["data","columns","onRowSelect"])])}var Ade={name:"RiskInstances",components:{DynamicTable:Ll.A,Dynamicalsearch:JK.A,CustomDropdown:mt.A,PopupModal:pv.wA},data(){return{instances:[],selectedCriticality:"",selectedStatus:"",selectedCategory:"",selectedPriority:"",searchQuery:"",showAddForm:!1,newInstance:{RiskId:null,Criticality:"",PossibleDamage:"",Category:"",Appetite:"",RiskDescription:"",RiskLikelihood:"",RiskImpact:"",RiskExposureRating:"",RiskPriority:"",RiskResponseType:"",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Open",UserId:1}}},computed:{uniqueCriticality(){return[...new Set(this.instances.map(e=>e.Criticality).filter(Boolean))]},uniqueStatus(){return[...new Set(this.instances.map(e=>e.RiskStatus).filter(Boolean))]},uniqueCategory(){return[...new Set(this.instances.map(e=>e.Category).filter(Boolean))]},uniquePriority(){return[...new Set(this.instances.map(e=>e.RiskPriority).filter(Boolean))]},filteredInstances(){let e=this.instances.filter(e=>(!this.selectedCriticality||e.Criticality===this.selectedCriticality)&&(!this.selectedStatus||e.RiskStatus===this.selectedStatus)&&(!this.selectedCategory||e.Category===this.selectedCategory)&&(!this.selectedPriority||e.RiskPriority===this.selectedPriority));if(this.searchQuery){const a=this.searchQuery.toLowerCase();e=e.filter(e=>e.RiskDescription&&e.RiskDescription.toLowerCase().includes(a)||e.RiskId&&e.RiskId.toString().includes(a)||e.Category&&e.Category.toLowerCase().includes(a)||e.RiskStatus&&e.RiskStatus.toLowerCase().includes(a)||e.Criticality&&e.Criticality.toLowerCase().includes(a))}return e.map(e=>({...e,Origin:"MANUAL",RiskId:e.RiskId||"N/A",Category:e.Category||"N/A",Criticality:e.Criticality||"Low",RiskStatus:e.RiskStatus||"Open",RiskDescription:e.RiskDescription||"No description available"}))},criticalityFilter(){return{name:"criticality",label:"Criticality",values:[{value:"",label:"All Criticality"},...this.uniqueCriticality.map(e=>({value:e,label:e}))],defaultValue:""}},statusFilter(){return{name:"status",label:"Status",values:[{value:"",label:"All Status"},...this.uniqueStatus.map(e=>({value:e,label:e}))],defaultValue:""}},categoryFilter(){return{name:"category",label:"Category",values:[{value:"",label:"All Category"},...this.uniqueCategory.map(e=>({value:e,label:e}))],defaultValue:""}},priorityFilter(){return{name:"priority",label:"Priority",values:[{value:"",label:"All Priority"},...this.uniquePriority.map(e=>({value:e,label:e}))],defaultValue:""}},tableColumns(){return[{key:"RiskId",label:"RISK ID",sortable:!0,headerClass:"risk-instance-id",cellClass:"risk-instance-id"},{key:"RiskDescription",label:"RISK DESCRIPTION",sortable:!0,cellClass:"risk-instance-description-cell"},{key:"Origin",label:"ORIGIN",sortable:!0,cellClass:"risk-instance-origin-cell"},{key:"Category",label:"CATEGORY",sortable:!0,cellClass:"risk-instance-category-cell"},{key:"Criticality",label:"CRITICALITY",sortable:!0,cellClass:"risk-instance-criticality-cell"},{key:"RiskStatus",label:"RISK STATUS",sortable:!0,cellClass:"risk-instance-status-cell",slot:!0}]}},mounted(){this.fetchInstances()},methods:{applyFilters(){},sanitizeQueryParams(e){const a={};for(const[t,i]of Object.entries(e))null!==i&&void 0!==i&&""!==i&&(a[t]=i);return a},fetchInstances(){qe.A.get("http://localhost:8000/api/risk-instances").then(e=>{this.instances=e.data,console.log("Fetched risk instances:",this.instances.length)}).catch(e=>{console.error("Error fetching risk instances:",e),ht.Ay.handleApiError(e,"view risk instances")||this.tryAlternativeEndpoint()})},tryAlternativeEndpoint(){console.log("Trying alternative endpoint..."),qe.A.get("http://localhost:8000/api/risk-instances").then(e=>{this.instances=e.data,console.log("Fetched risk instances from alternative endpoint:",this.instances.length)}).catch(e=>{console.error("Error with alternative endpoint:",e)})},validateResponseData(e){return Array.isArray(e)?e:(console.error("Expected array response, got:",typeof e),[])},viewInstanceDetails(e){this.$router.push(`/view-instance/${e}`)},handleRowSelect(e){console.log("Row selected:",e)},submitInstance(){const e={RiskId:parseInt(this.newInstance.RiskId)||null,Criticality:this.newInstance.Criticality,PossibleDamage:this.newInstance.PossibleDamage,Category:this.newInstance.Category,Appetite:this.newInstance.Appetite,RiskDescription:this.newInstance.RiskDescription,RiskLikelihood:parseFloat(this.newInstance.RiskLikelihood)||0,RiskImpact:parseFloat(this.newInstance.RiskImpact)||0,RiskExposureRating:this.newInstance.RiskExposureRating?parseFloat(this.newInstance.RiskExposureRating):null,RiskPriority:this.newInstance.RiskPriority,RiskResponseType:this.newInstance.RiskResponseType,RiskResponseDescription:this.newInstance.RiskResponseDescription,RiskMitigation:this.newInstance.RiskMitigation,RiskOwner:this.newInstance.RiskOwner,RiskStatus:this.newInstance.RiskStatus,UserId:parseInt(this.newInstance.UserId)||null};qe.A.post("http://localhost:8000/api/risk-instances/",e).then(e=>{this.instances.push(e.data),this.newInstance={RiskId:null,Criticality:"",PossibleDamage:"",Category:"",Appetite:"",RiskDescription:"",RiskLikelihood:"",RiskImpact:"",RiskExposureRating:"",RiskPriority:"",RiskResponseType:"",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Open",UserId:1},this.showAddForm=!1,this.$popup.success("Risk instance added successfully!")}).catch(e=>{console.error("Error adding risk instance:",e.response?.data||e.message),ht.Ay.handleApiError(e,"create risk instances")||this.$popup.error("Error adding risk instance. Please check your data and try again.")})}}};const Tde=(0,se.A)(Ade,[["render",Sde]]);var xde=Tde;const Fde={class:"risk-instance-container"},Vde={class:"risk-instance-card"},Mde={key:0,class:"validation-error-summary"},Xde={class:"risk-instance-dropdown-container"},Ude={key:0,class:"risk-instance-dropdown"},Nde={class:"risk-instance-dropdown-search"},$de={key:0,class:"risk-instance-dropdown-list"},Ode={key:1,class:"risk-instance-dropdown-list"},jde={key:2,class:"risk-instance-dropdown-list"},Bde=["onClick"],Wde={class:"risk-instance-item-checkbox"},Qde=["id","checked","onClick"],qde={class:"risk-instance-item-content"},Kde={class:"risk-instance-item-header"},Jde={class:"risk-instance-id"},zde={class:"risk-instance-category"},Hde={class:"risk-instance-item-title"},Yde={class:"risk-instance-item-description"},Gde={key:0,class:"risk-instance-item-damage"},Zde={key:0,class:"validation-error-message"},eue={class:"form-section"},aue=["value"],tue={key:0,class:"validation-error-message"},iue={class:"form-group"},sue={class:"risk-instance-category-container"},oue={class:"risk-instance-category-dropdown"},lue={key:0},nue={key:1},rue={key:0,class:"risk-instance-category-options"},cue={class:"risk-instance-category-search"},due={class:"risk-instance-category-list"},uue=["onClick"],pue=["checked","onClick"],vue=["value"],mue={key:0,class:"validation-error-message"},kue=["min","max","placeholder"],hue={key:0,class:"validation-error-message"},gue=["min","max","placeholder"],yue={key:0,class:"validation-error-message"},fue={class:"form-group"},bue=["value"],Cue={key:0,class:"validation-error-message"},Lue=["value"],wue={key:0,class:"validation-error-message"},Eue={class:"form-group"},Rue={class:"risk-instance-user-dropdown-container"},Due={key:0,class:"risk-instance-user-dropdown"},Iue={class:"risk-instance-user-dropdown-search"},Pue={key:0,class:"risk-instance-user-dropdown-list"},_ue={key:1,class:"risk-instance-user-dropdown-list"},Sue={key:2,class:"risk-instance-user-dropdown-list"},Aue=["onClick"],Tue={class:"risk-instance-user-item-checkbox"},xue=["id","checked","onClick"],Fue={class:"risk-instance-user-item-content"},Vue={class:"risk-instance-user-item-name"},Mue={class:"form-group"},Xue={key:0,class:"validation-error-message"},Uue={class:"form-group"},Nue={class:"risk-instance-business-impact-container"},$ue={class:"risk-instance-business-impact-dropdown"},Oue={key:0},jue={key:1},Bue={key:0,class:"risk-instance-business-impact-options"},Wue={class:"risk-instance-business-impact-header"},Que={class:"risk-instance-business-impact-search"},que={class:"risk-instance-business-impact-list"},Kue=["onClick"],Jue=["checked","onClick"],zue={class:"risk-instance-selected-impacts-display"},Hue=["onClick"],Yue={class:"risk-instance-modal-form-group"},Gue={class:"risk-instance-modal-actions"},Zue=["disabled"],epe={class:"risk-instance-modal-form-group"},ape={class:"risk-instance-modal-actions"},tpe=["disabled"],ipe=["value"],spe={key:0,class:"validation-error-message"},ope={class:"form-group"},lpe={class:"risk-instance-compliance-dropdown-container"},npe={key:0,class:"risk-instance-compliance-dropdown"},rpe={class:"risk-instance-compliance-dropdown-search"},cpe={key:0,class:"risk-instance-compliance-dropdown-list"},dpe={key:1,class:"risk-instance-compliance-dropdown-list"},upe={key:2,class:"risk-instance-compliance-dropdown-list"},ppe=["onClick"],vpe={class:"risk-instance-compliance-item-checkbox"},mpe=["id","checked","onClick"],kpe={class:"risk-instance-compliance-item-content"},hpe={class:"risk-instance-compliance-item-header"},gpe={class:"risk-instance-compliance-id"},ype={class:"risk-instance-compliance-item-description"},fpe={key:0,class:"risk-instance-compliance-item-damage"},bpe=["value"],Cpe={key:0,class:"validation-error-message"},Lpe={class:"form-section text-areas-section"},wpe={key:0,class:"validation-error-message"},Epe={key:0,class:"validation-error-message"},Rpe={key:0,class:"validation-error-message"},Dpe={key:0,class:"validation-error-message"},Ipe={class:"form-actions"};function Ppe(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Fde,[(0,s.bF)(r),(0,s.Lk)("div",Vde,[a[154]||(a[154]=(0,s.Lk)("div",{class:"risk-instance-title"}," Create Risk Instance ",-1)),n.activeValidationErrors.length>0?((0,s.uX)(),(0,s.CE)("div",Mde,[a[88]||(a[88]=(0,s.Lk)("h4",null,"Please fix the following errors:",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.activeValidationErrors,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.field},(0,d.v_)(n.encodeForHTML(e.error)),1))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("form",{onSubmit:a[87]||(a[87]=(0,i.D$)((...e)=>n.submitInstance&&n.submitInstance(...e),["prevent"])),class:"risk-instance-form"},[(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskId}])},[a[93]||(a[93]=(0,s.Lk)("label",{for:"riskId"},[(0,s.Lk)("i",{class:"fas fa-id-badge"}),(0,s.eW)(" Risk ID")],-1)),(0,s.Lk)("div",Xde,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"riskId","onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedRiskIdText=e),placeholder:"Enter or select risk ID",onFocus:a[1]||(a[1]=e=>l.showRiskDropdown=!0),readonly:"",class:(0,d.C4)({invalid:l.validationErrors.RiskId})},null,34),[[i.Jo,l.selectedRiskIdText]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-dropdown-toggle",onClick:a[2]||(a[2]=(...e)=>n.toggleRiskDropdown&&n.toggleRiskDropdown(...e))},a[89]||(a[89]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showRiskDropdown?((0,s.uX)(),(0,s.CE)("div",Ude,[(0,s.Lk)("div",Nde,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>l.riskSearchQuery=e),placeholder:"Search risks...",onInput:a[4]||(a[4]=(...e)=>n.filterRisks&&n.filterRisks(...e)),onClick:a[5]||(a[5]=(0,i.D$)(()=>{},["stop"]))},null,544),[[i.Jo,l.riskSearchQuery]])]),l.loadingRisks?((0,s.uX)(),(0,s.CE)("div",$de,a[90]||(a[90]=[(0,s.Lk)("div",{class:"loading-spinner"},"Loading risks...",-1)]))):0===l.filteredRisks.length?((0,s.uX)(),(0,s.CE)("div",Ode,a[91]||(a[91]=[(0,s.Lk)("div",{class:"no-results"},"No risks found",-1)]))):((0,s.uX)(),(0,s.CE)("div",jde,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.validFilteredRisks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.RiskId,class:"risk-instance-item",onClick:a=>n.selectRisk(e)},[(0,s.Lk)("div",Wde,[(0,s.Lk)("input",{type:"checkbox",id:"risk-"+e.RiskId,checked:l.newInstance.RiskId===e.RiskId,onClick:(0,i.D$)(a=>n.selectRisk(e),["stop"])},null,8,Qde)]),(0,s.Lk)("div",qde,[(0,s.Lk)("div",Kde,[(0,s.Lk)("span",Jde,"ID: "+(0,d.v_)(e.RiskId),1),(0,s.Lk)("span",{class:(0,d.C4)("risk-instance-criticality "+(e.Criticality||"unknown").toLowerCase())},(0,d.v_)(n.encodeForHTML(e.Criticality||"Unknown")),3),(0,s.Lk)("span",zde,(0,d.v_)(n.encodeForHTML(e.Category||"No Category")),1)]),(0,s.Lk)("div",Hde,(0,d.v_)(n.encodeForHTML(e.RiskTitle||"No Title")),1),(0,s.Lk)("div",Yde,(0,d.v_)(n.truncateText(e.RiskDescription,100)),1),e.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",Gde,[a[92]||(a[92]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(n.truncateText(e.PossibleDamage,80)),1)])):(0,s.Q3)("",!0)])],8,Bde))),128))]))])):(0,s.Q3)("",!0)]),l.validationErrors.RiskId?((0,s.uX)(),(0,s.CE)("span",Zde,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskId)),1)):(0,s.Q3)("",!0),a[94]||(a[94]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Select the base risk template for this instance",-1))],2),(0,s.Lk)("div",eue,[(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.Criticality}])},[a[96]||(a[96]=(0,s.Lk)("label",{for:"criticality"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Criticality")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"criticality",class:(0,d.C4)(["priority-select",{invalid:l.validationErrors.Criticality}]),"onUpdate:modelValue":a[6]||(a[6]=e=>l.newInstance.Criticality=e),onFocus:a[7]||(a[7]=e=>n.handleFocus("criticality")),onBlur:a[8]||(a[8]=e=>n.handleBlur("criticality"))},[a[95]||(a[95]=(0,s.Lk)("option",{value:""},"Select Criticality",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_CRITICALITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,aue))),128))],34),[[i.u1,l.newInstance.Criticality]]),l.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("span",tue,(0,d.v_)(n.encodeForHTML(l.validationErrors.Criticality)),1)):(0,s.Q3)("",!0),a[97]||(a[97]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Choose the severity level for this risk instance",-1))],2),(0,s.Lk)("div",iue,[a[100]||(a[100]=(0,s.Lk)("label",{for:"category"},[(0,s.Lk)("i",{class:"fas fa-tag"}),(0,s.eW)(" Category")],-1)),(0,s.Lk)("div",sue,[(0,s.Lk)("div",oue,[(0,s.Lk)("div",{class:"risk-instance-selected-category",onClick:a[9]||(a[9]=(...e)=>n.toggleCategoryDropdown&&n.toggleCategoryDropdown(...e))},[l.selectedCategory?((0,s.uX)(),(0,s.CE)("span",nue,(0,d.v_)(l.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",lue,"Select Category")),a[98]||(a[98]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",rue,[(0,s.Lk)("div",cue,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[10]||(a[10]=e=>l.categorySearch=e),placeholder:"Search categories...",onClick:a[11]||(a[11]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,l.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-add-category-btn",onClick:a[12]||(a[12]=(0,i.D$)(e=>l.showAddCategoryModal=!0,["stop","prevent"]))},a[99]||(a[99]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",due,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-instance-category-item",onClick:(0,i.D$)(a=>n.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:l.selectedCategory===e.value,onClick:(0,i.D$)(a=>n.selectCategory(e),["stop"])},null,8,pue),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,uue))),128))])])):(0,s.Q3)("",!0)])]),a[101]||(a[101]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Categorize this risk instance for better organization",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.Appetite}])},[a[102]||(a[102]=(0,s.Lk)("label",{for:"appetite"},[(0,s.Lk)("i",{class:"fas fa-balance-scale"}),(0,s.eW)(" Appetite")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"appetite","onUpdate:modelValue":a[13]||(a[13]=e=>l.newInstance.Appetite=e),onFocus:a[14]||(a[14]=e=>n.handleFocus("appetite")),onBlur:a[15]||(a[15]=e=>n.handleBlur("appetite")),onChange:a[16]||(a[16]=e=>n.onAppetiteChange()),class:(0,d.C4)({invalid:l.validationErrors.Appetite})},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_APPETITE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,vue))),128))],34),[[i.u1,l.newInstance.Appetite]]),l.validationErrors.Appetite?((0,s.uX)(),(0,s.CE)("span",mue,(0,d.v_)(n.encodeForHTML(l.validationErrors.Appetite)),1)):(0,s.Q3)("",!0),a[103]||(a[103]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Indicate if the organization accepts this risk level",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskLikelihood}])},[a[104]||(a[104]=(0,s.Lk)("label",{for:"riskLikelihood"},[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)(" Risk Likelihood")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",step:"1",min:l.validationRules.RISK_LIKELIHOOD_RANGE.min,max:l.validationRules.RISK_LIKELIHOOD_RANGE.max,id:"riskLikelihood","onUpdate:modelValue":a[17]||(a[17]=e=>l.newInstance.RiskLikelihood=e),placeholder:`Enter value (${l.validationRules.RISK_LIKELIHOOD_RANGE.min}-${l.validationRules.RISK_LIKELIHOOD_RANGE.max})`,onFocus:a[18]||(a[18]=e=>n.handleFocus("riskLikelihood")),onBlur:a[19]||(a[19]=e=>n.handleBlur("riskLikelihood")),onInput:a[20]||(a[20]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e)),class:(0,d.C4)({invalid:l.validationErrors.RiskLikelihood})},null,42,kue),[[i.Jo,l.newInstance.RiskLikelihood,void 0,{number:!0}]]),l.validationErrors.RiskLikelihood?((0,s.uX)(),(0,s.CE)("span",hue,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskLikelihood)),1)):(0,s.Q3)("",!0),a[105]||(a[105]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskImpact}])},[a[106]||(a[106]=(0,s.Lk)("label",{for:"riskImpact"},[(0,s.Lk)("i",{class:"fas fa-bolt"}),(0,s.eW)(" Risk Impact")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",step:"1",min:l.validationRules.RISK_IMPACT_RANGE.min,max:l.validationRules.RISK_IMPACT_RANGE.max,id:"riskImpact","onUpdate:modelValue":a[21]||(a[21]=e=>l.newInstance.RiskImpact=e),placeholder:`Enter value (${l.validationRules.RISK_IMPACT_RANGE.min}-${l.validationRules.RISK_IMPACT_RANGE.max})`,onFocus:a[22]||(a[22]=e=>n.handleFocus("riskImpact")),onBlur:a[23]||(a[23]=e=>n.handleBlur("riskImpact")),onInput:a[24]||(a[24]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e)),class:(0,d.C4)({invalid:l.validationErrors.RiskImpact})},null,42,gue),[[i.Jo,l.newInstance.RiskImpact,void 0,{number:!0}]]),l.validationErrors.RiskImpact?((0,s.uX)(),(0,s.CE)("span",yue,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskImpact)),1)):(0,s.Q3)("",!0),a[107]||(a[107]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)",-1))],2),(0,s.Lk)("div",fue,[a[108]||(a[108]=(0,s.Lk)("label",{for:"riskExposureRating"},[(0,s.Lk)("i",{class:"fas fa-thermometer-half"}),(0,s.eW)(" Risk Exposure Rating (Likelihood Ã— Impact)")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",readonly:"",id:"riskExposureRating","onUpdate:modelValue":a[25]||(a[25]=e=>l.newInstance.RiskExposureRating=e),class:"readonly-input",onFocus:a[26]||(a[26]=e=>n.handleFocus("riskExposureRating")),onBlur:a[27]||(a[27]=e=>n.handleBlur("riskExposureRating"))},null,544),[[i.Jo,l.newInstance.RiskExposureRating,void 0,{number:!0}]]),a[109]||(a[109]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Automatically calculated as Likelihood Ã— Impact",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskPriority}])},[a[111]||(a[111]=(0,s.Lk)("label",{for:"riskPriority"},[(0,s.Lk)("i",{class:"fas fa-flag"}),(0,s.eW)(" Risk Priority")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskPriority",class:(0,d.C4)(["priority-select",{invalid:l.validationErrors.RiskPriority}]),"onUpdate:modelValue":a[28]||(a[28]=e=>l.newInstance.RiskPriority=e),onFocus:a[29]||(a[29]=e=>n.handleFocus("riskPriority")),onBlur:a[30]||(a[30]=e=>n.handleBlur("riskPriority"))},[a[110]||(a[110]=(0,s.Lk)("option",{value:""},"Select Priority",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_PRIORITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,bue))),128))],34),[[i.u1,l.newInstance.RiskPriority]]),l.validationErrors.RiskPriority?((0,s.uX)(),(0,s.CE)("span",Cue,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskPriority)),1)):(0,s.Q3)("",!0),a[112]||(a[112]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Set the priority level for risk treatment",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskResponseType}])},[a[114]||(a[114]=(0,s.Lk)("label",{for:"riskResponseType"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Response Type")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskResponseType","onUpdate:modelValue":a[31]||(a[31]=e=>l.newInstance.RiskResponseType=e),onFocus:a[32]||(a[32]=e=>n.handleFocus("riskResponseType")),onBlur:a[33]||(a[33]=e=>n.handleBlur("riskResponseType")),class:(0,d.C4)({invalid:l.validationErrors.RiskResponseType})},[a[113]||(a[113]=(0,s.Lk)("option",{value:""},"Select Response Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_RESPONSE_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Lue))),128))],34),[[i.u1,l.newInstance.RiskResponseType]]),l.validationErrors.RiskResponseType?((0,s.uX)(),(0,s.CE)("span",wue,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskResponseType)),1)):(0,s.Q3)("",!0),a[115]||(a[115]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Choose how to respond to this risk",-1))],2),(0,s.Lk)("div",Eue,[a[119]||(a[119]=(0,s.Lk)("label",{for:"riskOwner"},[(0,s.Lk)("i",{class:"fas fa-user"}),(0,s.eW)(" Risk Owner")],-1)),(0,s.Lk)("div",Rue,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"riskOwner","onUpdate:modelValue":a[34]||(a[34]=e=>l.selectedOwnerText=e),placeholder:"Select risk owner",onFocus:a[35]||(a[35]=e=>l.showUserDropdown=!0),readonly:""},null,544),[[i.Jo,l.selectedOwnerText]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-dropdown-toggle",onClick:a[36]||(a[36]=(...e)=>n.toggleUserDropdown&&n.toggleUserDropdown(...e))},a[116]||(a[116]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showUserDropdown?((0,s.uX)(),(0,s.CE)("div",Due,[(0,s.Lk)("div",Iue,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[37]||(a[37]=e=>l.userSearchQuery=e),placeholder:"Search users...",onInput:a[38]||(a[38]=(...e)=>n.filterUsers&&n.filterUsers(...e)),onClick:a[39]||(a[39]=(0,i.D$)(()=>{},["stop"]))},null,544),[[i.Jo,l.userSearchQuery]])]),l.loadingUsers?((0,s.uX)(),(0,s.CE)("div",Pue,a[117]||(a[117]=[(0,s.Lk)("div",{class:"loading-spinner"},"Loading users...",-1)]))):0===l.filteredUsers.length?((0,s.uX)(),(0,s.CE)("div",_ue,a[118]||(a[118]=[(0,s.Lk)("div",{class:"no-results"},"No users found",-1)]))):((0,s.uX)(),(0,s.CE)("div",Sue,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredUsers,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.UserId,class:"risk-instance-user-item",onClick:a=>n.selectUser(e)},[(0,s.Lk)("div",Tue,[(0,s.Lk)("input",{type:"checkbox",id:"user-"+e.UserId,checked:l.newInstance.RiskOwner===e.UserName,onClick:(0,i.D$)(a=>n.selectUser(e),["stop"])},null,8,xue)]),(0,s.Lk)("div",Fue,[(0,s.Lk)("div",Vue,(0,d.v_)(e.UserName),1)])],8,Aue))),128))]))])):(0,s.Q3)("",!0)]),a[120]||(a[120]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Assign responsibility for managing this risk",-1))]),(0,s.Lk)("div",Mue,[a[122]||(a[122]=(0,s.Lk)("label",{for:"riskStatus"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Risk Status")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskStatus","onUpdate:modelValue":a[40]||(a[40]=e=>l.newInstance.RiskStatus=e),onFocus:a[41]||(a[41]=e=>n.handleFocus("riskStatus")),onBlur:a[42]||(a[42]=e=>n.handleBlur("riskStatus"))},a[121]||(a[121]=[(0,s.Lk)("option",{value:"Not Assigned"},"Not Assigned",-1),(0,s.Lk)("option",{value:"Assigned"},"Assigned",-1),(0,s.Lk)("option",{value:"Approved"},"Approved",-1),(0,s.Lk)("option",{value:"Rejected"},"Rejected",-1)]),544),[[i.u1,l.newInstance.RiskStatus]]),a[123]||(a[123]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Current status of this risk instance",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskTitle}])},[a[124]||(a[124]=(0,s.Lk)("label",{for:"riskTitle"},[(0,s.Lk)("i",{class:"fas fa-heading"}),(0,s.eW)(" Risk Title")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"riskTitle","onUpdate:modelValue":a[43]||(a[43]=e=>l.newInstance.RiskTitle=e),placeholder:"Enter risk title",class:(0,d.C4)({invalid:l.validationErrors.RiskTitle}),onFocus:a[44]||(a[44]=e=>n.handleFocus("riskTitle")),onBlur:a[45]||(a[45]=e=>n.handleBlur("riskTitle"))},null,34),[[i.Jo,l.newInstance.RiskTitle]]),l.validationErrors.RiskTitle?((0,s.uX)(),(0,s.CE)("span",Xue,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskTitle)),1)):(0,s.Q3)("",!0),a[125]||(a[125]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Provide a clear, descriptive title for this risk instance",-1))],2),(0,s.Lk)("div",Uue,[a[128]||(a[128]=(0,s.Lk)("label",{for:"businessImpact"},[(0,s.Lk)("i",{class:"fas fa-briefcase"}),(0,s.eW)(" Business Impact")],-1)),(0,s.Lk)("div",Nue,[(0,s.Lk)("div",$ue,[(0,s.Lk)("div",{class:"risk-instance-selected-impacts",onClick:a[46]||(a[46]=(...e)=>n.toggleBusinessImpactDropdown&&n.toggleBusinessImpactDropdown(...e))},[0===l.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",Oue,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",jue,(0,d.v_)(l.selectedBusinessImpacts.length)+" impact(s) selected",1)),a[126]||(a[126]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",Bue,[(0,s.Lk)("div",Wue,[(0,s.Lk)("div",Que,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[47]||(a[47]=e=>l.businessImpactSearch=e),placeholder:"Search impacts...",onClick:a[48]||(a[48]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,l.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-add-impact-btn",onClick:a[49]||(a[49]=(0,i.D$)(e=>l.showAddImpactModal=!0,["stop","prevent"]))},a[127]||(a[127]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))])]),(0,s.Lk)("div",que,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-instance-business-impact-item",onClick:(0,i.D$)(a=>n.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",checked:n.isBusinessImpactSelected(e),onClick:(0,i.D$)(a=>n.toggleBusinessImpact(e),["stop"])},null,8,Jue),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Kue))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",zue,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-instance-selected-impact-tag"},[(0,s.eW)((0,d.v_)(n.encodeForHTML(e.value))+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:a=>n.toggleBusinessImpact(e)},null,8,Hue)]))),128))])]),a[129]||(a[129]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Select the business areas that would be affected by this risk",-1))]),l.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"risk-instance-modal-overlay",onClick:a[55]||(a[55]=(0,i.D$)(e=>l.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-instance-modal-content",onClick:a[54]||(a[54]=(0,i.D$)(()=>{},["stop"]))},[a[131]||(a[131]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:a[53]||(a[53]=(0,i.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"])),class:"risk-instance-modal-form"},[(0,s.Lk)("div",Yue,[a[130]||(a[130]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[50]||(a[50]=e=>l.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:a[51]||(a[51]=(0,i.jR)((0,i.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,l.newBusinessImpact]])]),(0,s.Lk)("div",Gue,[(0,s.Lk)("button",{type:"button",class:"risk-instance-cancel-btn",onClick:a[52]||(a[52]=(0,i.D$)(e=>l.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-instance-add-btn",disabled:!l.newBusinessImpact.trim()}," Add ",8,Zue)])],32)])])):(0,s.Q3)("",!0),l.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"risk-instance-modal-overlay",onClick:a[61]||(a[61]=(0,i.D$)(e=>l.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-instance-modal-content",onClick:a[60]||(a[60]=(0,i.D$)(()=>{},["stop"]))},[a[133]||(a[133]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:a[59]||(a[59]=(0,i.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"])),class:"risk-instance-modal-form"},[(0,s.Lk)("div",epe,[a[132]||(a[132]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[56]||(a[56]=e=>l.newCategory=e),placeholder:"Enter new category",onKeyup:a[57]||(a[57]=(0,i.jR)((0,i.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,l.newCategory]])]),(0,s.Lk)("div",ape,[(0,s.Lk)("button",{type:"button",class:"risk-instance-cancel-btn",onClick:a[58]||(a[58]=(0,i.D$)(e=>l.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-instance-add-btn",disabled:!l.newCategory.trim()}," Add Category ",8,tpe)])],32)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.Origin}])},[a[135]||(a[135]=(0,s.Lk)("label",{for:"origin"},[(0,s.Lk)("i",{class:"fas fa-globe"}),(0,s.eW)(" Origin")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"origin","onUpdate:modelValue":a[62]||(a[62]=e=>l.newInstance.Origin=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Origin}]),onFocus:a[63]||(a[63]=e=>n.handleFocus("origin")),onBlur:a[64]||(a[64]=e=>n.handleBlur("origin"))},[a[134]||(a[134]=(0,s.Lk)("option",{value:""},"Select Origin",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_ORIGIN,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ipe))),128))],34),[[i.u1,l.newInstance.Origin]]),l.validationErrors.Origin?((0,s.uX)(),(0,s.CE)("span",spe,(0,d.v_)(n.encodeForHTML(l.validationErrors.Origin)),1)):(0,s.Q3)("",!0),a[136]||(a[136]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Source of this risk instance (Manual, SIEM, Audit Findings)",-1))],2),(0,s.Lk)("div",ope,[a[141]||(a[141]=(0,s.Lk)("label",{for:"complianceId"},[(0,s.Lk)("i",{class:"fas fa-hashtag"}),(0,s.eW)(" Compliance ID")],-1)),(0,s.Lk)("div",lpe,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"complianceId","onUpdate:modelValue":a[65]||(a[65]=e=>l.selectedComplianceIdText=e),placeholder:"Enter or select compliance ID",onFocus:a[66]||(a[66]=e=>l.showComplianceDropdown=!0),readonly:""},null,544),[[i.Jo,l.selectedComplianceIdText]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-dropdown-toggle",onClick:a[67]||(a[67]=(...e)=>n.toggleComplianceDropdown&&n.toggleComplianceDropdown(...e))},a[137]||(a[137]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showComplianceDropdown?((0,s.uX)(),(0,s.CE)("div",npe,[(0,s.Lk)("div",rpe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[68]||(a[68]=e=>l.complianceSearchQuery=e),placeholder:"Search compliances...",onInput:a[69]||(a[69]=(...e)=>n.filterCompliances&&n.filterCompliances(...e)),onClick:a[70]||(a[70]=(0,i.D$)(()=>{},["stop"]))},null,544),[[i.Jo,l.complianceSearchQuery]])]),l.loadingCompliances?((0,s.uX)(),(0,s.CE)("div",cpe,a[138]||(a[138]=[(0,s.Lk)("div",{class:"loading-spinner"},"Loading compliances...",-1)]))):0===l.filteredCompliances.length?((0,s.uX)(),(0,s.CE)("div",dpe,a[139]||(a[139]=[(0,s.Lk)("div",{class:"no-results"},"No compliances found",-1)]))):((0,s.uX)(),(0,s.CE)("div",upe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,class:"risk-instance-compliance-item",onClick:a=>n.selectCompliance(e)},[(0,s.Lk)("div",vpe,[(0,s.Lk)("input",{type:"checkbox",id:"compliance-"+e.ComplianceId,checked:l.newInstance.ComplianceId===e.ComplianceId,onClick:(0,i.D$)(a=>n.selectCompliance(e),["stop"])},null,8,mpe)]),(0,s.Lk)("div",kpe,[(0,s.Lk)("div",hpe,[(0,s.Lk)("span",gpe,"ID: "+(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("span",{class:(0,d.C4)("risk-instance-compliance-criticality "+(e.Criticality?e.Criticality.toLowerCase():""))},(0,d.v_)(n.encodeForHTML(e.Criticality||"No Criticality")),3)]),(0,s.Lk)("div",ype,(0,d.v_)(n.truncateText(e.ComplianceItemDescription,100)||"No description available"),1),e.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",fpe,[a[140]||(a[140]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(n.truncateText(e.PossibleDamage,80)),1)])):(0,s.Q3)("",!0)])],8,ppe))),128))]))])):(0,s.Q3)("",!0)]),a[142]||(a[142]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Link this risk instance to a specific compliance requirement",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskType}])},[a[143]||(a[143]=(0,s.Lk)("label",{for:"riskType"},[(0,s.Lk)("i",{class:"fas fa-cubes"}),(0,s.eW)(" Risk Type")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskType","onUpdate:modelValue":a[71]||(a[71]=e=>l.newInstance.RiskType=e),onFocus:a[72]||(a[72]=e=>n.handleFocus("riskType")),onBlur:a[73]||(a[73]=e=>n.handleBlur("riskType")),class:(0,d.C4)({invalid:l.validationErrors.RiskType})},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,bpe))),128))],34),[[i.u1,l.newInstance.RiskType]]),l.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("span",Cpe,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskType)),1)):(0,s.Q3)("",!0),a[144]||(a[144]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Classify the nature and timing of this risk",-1))],2)]),(0,s.Lk)("div",Lpe,[(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskDescription}])},[a[145]||(a[145]=(0,s.Lk)("label",{for:"riskDescription"},[(0,s.Lk)("i",{class:"fas fa-align-left"}),(0,s.eW)(" Risk Description")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"riskDescription","onUpdate:modelValue":a[74]||(a[74]=e=>l.newInstance.RiskDescription=e),placeholder:"Describe the risk...",rows:"3",class:(0,d.C4)({invalid:l.validationErrors.RiskDescription}),onFocus:a[75]||(a[75]=e=>n.handleFocus("riskDescription")),onBlur:a[76]||(a[76]=e=>n.handleBlur("riskDescription"))},null,34),[[i.Jo,l.newInstance.RiskDescription]]),l.validationErrors.RiskDescription?((0,s.uX)(),(0,s.CE)("span",wpe,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskDescription)),1)):(0,s.Q3)("",!0),a[146]||(a[146]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Provide a detailed description of this specific risk instance",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.PossibleDamage}])},[a[147]||(a[147]=(0,s.Lk)("label",{for:"possibleDamage"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Possible Damage")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"possibleDamage","onUpdate:modelValue":a[77]||(a[77]=e=>l.newInstance.PossibleDamage=e),placeholder:"Describe possible damage...",rows:"2",class:(0,d.C4)({invalid:l.validationErrors.PossibleDamage}),onFocus:a[78]||(a[78]=e=>n.handleFocus("possibleDamage")),onBlur:a[79]||(a[79]=e=>n.handleBlur("possibleDamage"))},null,34),[[i.Jo,l.newInstance.PossibleDamage]]),l.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("span",Epe,(0,d.v_)(n.encodeForHTML(l.validationErrors.PossibleDamage)),1)):(0,s.Q3)("",!0),a[148]||(a[148]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Detail the potential consequences and damage if this risk materializes",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskResponseDescription}])},[a[149]||(a[149]=(0,s.Lk)("label",{for:"riskResponseDescription"},[(0,s.Lk)("i",{class:"fas fa-reply"}),(0,s.eW)(" Response Description")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"riskResponseDescription","onUpdate:modelValue":a[80]||(a[80]=e=>l.newInstance.RiskResponseDescription=e),placeholder:"Describe the response strategy...",rows:"2",class:(0,d.C4)({invalid:l.validationErrors.RiskResponseDescription}),onFocus:a[81]||(a[81]=e=>n.handleFocus("riskResponseDescription")),onBlur:a[82]||(a[82]=e=>n.handleBlur("riskResponseDescription"))},null,34),[[i.Jo,l.newInstance.RiskResponseDescription]]),l.validationErrors.RiskResponseDescription?((0,s.uX)(),(0,s.CE)("span",Rpe,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskResponseDescription)),1)):(0,s.Q3)("",!0),a[150]||(a[150]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Describe the specific response strategy for this risk instance",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskMitigation}])},[a[151]||(a[151]=(0,s.Lk)("label",{for:"riskMitigation"},[(0,s.Lk)("i",{class:"fas fa-shield-virus"}),(0,s.eW)(" Risk Mitigation")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"riskMitigation","onUpdate:modelValue":a[83]||(a[83]=e=>l.newInstance.RiskMitigation=e),placeholder:"Describe mitigation actions...",rows:"2",class:(0,d.C4)({invalid:l.validationErrors.RiskMitigation}),onFocus:a[84]||(a[84]=e=>n.handleFocus("riskMitigation")),onBlur:a[85]||(a[85]=e=>n.handleBlur("riskMitigation"))},null,34),[[i.Jo,l.newInstance.RiskMitigation]]),l.validationErrors.RiskMitigation?((0,s.uX)(),(0,s.CE)("span",Dpe,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskMitigation)),1)):(0,s.Q3)("",!0),a[152]||(a[152]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Outline specific mitigation strategies and controls for this risk",-1))],2)]),(0,s.Lk)("div",Ipe,[(0,s.Lk)("button",{type:"button",class:"risk-instance-btn-cancel",onClick:a[86]||(a[86]=(...e)=>n.resetForm&&n.resetForm(...e))},"Clear"),a[153]||(a[153]=(0,s.Lk)("button",{type:"submit",class:"risk-instance-btn-submit"},"Create",-1))])],32)])])}var _pe={name:"CreateRiskInstance",components:{PopupModal:pv.wA},props:{riskId:{type:[String,Number],default:null},incidentId:{type:[String,Number],default:null}},data(){return{validationRules:{ALLOWED_CRITICALITY:["Critical","High","Medium","Low"],ALLOWED_RISK_PRIORITY:["High","Medium","Low"],ALLOWED_ORIGIN:["Manual","SIEM","AuditFindings"],ALLOWED_RISK_TYPE:["Current","Residual","Inherent","Emerging","Accept"],ALLOWED_APPETITE:["Yes","No"],ALLOWED_RISK_RESPONSE_TYPE:["Mitigate","Avoid","Accept","Transfer"],RISK_LIKELIHOOD_RANGE:{min:1,max:10},RISK_IMPACT_RANGE:{min:1,max:10},TEXT_PATTERN:/^[A-Za-z0-9\s.,;:!?'"()\-_[\]]{0,}$/},validationErrors:{Criticality:"",RiskPriority:"",Origin:"",RiskType:"",Appetite:"",RiskResponseType:"",RiskLikelihood:"",RiskImpact:"",RiskTitle:"",RiskDescription:"",PossibleDamage:"",RiskResponseDescription:"",RiskMitigation:""},newInstance:{Criticality:"",PossibleDamage:"",Category:"",Appetite:"Yes",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskResponseType:"Mitigation",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Not Assigned",UserId:1,RiskId:null,IncidentId:null,RiskTitle:"",BusinessImpact:"",Origin:"",MitigationDueDate:null,MitigationStatus:null,MitigationCompletedDate:null,ReviewerCount:null,RecurrenceCount:1,RiskFormDetails:null,ModifiedMitigations:null,ComplianceId:"",RiskType:"Current"},businessImpacts:[],selectedBusinessImpacts:[],showBusinessImpactDropdown:!1,businessImpactSearch:"",showAddImpactModal:!1,newBusinessImpact:"",categories:[],selectedCategory:"",showCategoryDropdown:!1,categorySearch:"",showAddCategoryModal:!1,newCategory:"",risks:[],filteredRisks:[],riskSearchQuery:"",showRiskDropdown:!1,loadingRisks:!1,selectedRiskIdText:"",isDebugging:!1,testResults:[],selectedOwnerText:"",showUserDropdown:!1,loadingUsers:!1,userSearchQuery:"",filteredUsers:[],users:[],selectedComplianceIdText:"",showComplianceDropdown:!1,loadingCompliances:!1,complianceSearchQuery:"",filteredCompliances:[],compliances:[]}},computed:{validFilteredRisks(){return this.filteredRisks.filter(e=>e&&e.RiskId)},filteredBusinessImpacts(){if(!this.businessImpactSearch)return this.businessImpacts;const e=this.businessImpactSearch.toLowerCase();return this.businessImpacts.filter(a=>a.value.toLowerCase().includes(e))},filteredCategories(){if(!this.categorySearch)return this.categories;const e=this.categorySearch.toLowerCase();return this.categories.filter(a=>a.value.toLowerCase().includes(e))},activeValidationErrors(){return Object.entries(this.validationErrors).filter(e=>e[1]).map(([e,a])=>({field:e,error:a}))}},mounted(){this.calculateRiskExposureRating(),null!==this.riskId&&void 0!==this.riskId?(this.newInstance.RiskId=this.riskId,this.updateSelectedRiskIdText()):this.$route.query.riskId&&(this.newInstance.RiskId=this.$route.query.riskId,this.updateSelectedRiskIdText()),null!==this.incidentId&&void 0!==this.incidentId?this.newInstance.IncidentId=this.incidentId:this.$route.query.incidentId&&(this.newInstance.IncidentId=this.$route.query.incidentId),this.fetchRisks(),this.fetchUsers(),this.fetchCompliances(),this.fetchBusinessImpacts(),this.fetchCategories(),document.addEventListener("click",this.closeRiskDropdown),document.addEventListener("click",this.closeUserDropdown),document.addEventListener("click",this.closeComplianceDropdown),document.addEventListener("click",this.closeBusinessImpactDropdown),console.log("CreateRiskInstance mounted with:",{riskId:this.newInstance.RiskId,incidentId:this.newInstance.IncidentId})},beforeUnmount(){document.removeEventListener("click",this.closeRiskDropdown),document.removeEventListener("click",this.closeUserDropdown),document.removeEventListener("click",this.closeComplianceDropdown),document.removeEventListener("click",this.closeBusinessImpactDropdown)},methods:{fetchRisks(){this.loadingRisks=!0;const e="http://127.0.0.1:8000/api/risks-for-dropdown/",a={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}};fetch(e,a).then(e=>{if(!e.ok)throw new Error(`API Error: ${e.status}`);return e.json()}).then(e=>{this.risks=(e||[]).filter(e=>e&&e.RiskId),this.filteredRisks=[...this.risks],this.loadingRisks=!1,this.newInstance.RiskId&&this.updateSelectedRiskIdText()}).catch(e=>{console.error("Error fetching risks:",e),this.loadingRisks=!1,this.risks=[],this.filteredRisks=[]})},filterRisks(){if(!this.riskSearchQuery)return void(this.filteredRisks=[...this.risks].filter(e=>e&&e.RiskId));const e=this.sanitizeHTML(this.riskSearchQuery.toLowerCase());this.filteredRisks=this.risks.filter(a=>a&&a.RiskId&&(a.RiskId&&a.RiskId.toString().includes(e)||a.RiskTitle&&this.sanitizeHTML(a.RiskTitle.toLowerCase()).includes(e)||a.Category&&this.sanitizeHTML(a.Category.toLowerCase()).includes(e)||a.RiskDescription&&this.sanitizeHTML(a.RiskDescription.toLowerCase()).includes(e)))},selectRisk(e){this.newInstance.RiskId=e.RiskId,this.selectedRiskIdText=`Risk ID: ${e.RiskId}`,this.showRiskDropdown=!1,e.RiskTitle&&(this.newInstance.RiskTitle=e.RiskTitle),e.Criticality&&(this.newInstance.Criticality=e.Criticality),e.Category&&(this.newInstance.Category=e.Category),e.PossibleDamage&&(this.newInstance.PossibleDamage=e.PossibleDamage),e.RiskDescription&&(this.newInstance.RiskDescription=e.RiskDescription)},toggleRiskDropdown(){this.showRiskDropdown=!this.showRiskDropdown,this.showRiskDropdown&&(this.riskSearchQuery="",this.filterRisks())},closeRiskDropdown(e){const a=document.querySelector(".risk-instance-dropdown-container");a&&!a.contains(e.target)&&(this.showRiskDropdown=!1)},updateSelectedRiskIdText(){if(this.newInstance.RiskId){const e=this.risks.find(e=>e.RiskId===parseInt(this.newInstance.RiskId));this.selectedRiskIdText=e?`Risk ID: ${e.RiskId}`:`Risk ID: ${this.newInstance.RiskId}`}else this.selectedRiskIdText=""},truncateText(e,a){if(!e)return"";const t=this.sanitizeHTML(e);return t.length>a?t.substring(0,a)+"...":t},calculateRiskExposureRating(){const e=parseInt(this.newInstance.RiskLikelihood)||0,a=parseInt(this.newInstance.RiskImpact)||0;this.newInstance.RiskExposureRating=e>0&&a>0?e*a:null},onAppetiteChange(){"No"===this.newInstance.Appetite&&(this.newInstance.RiskStatus="Rejected",console.log("Appetite set to No: Updated RiskStatus to Rejected"))},testBackendConnection(){this.isDebugging=!0,this.testResults=[];const e=["http://127.0.0.1:8000/api/risk-instances/","http://localhost:8000/api/risk-instances/","http://localhost:8080/api/risk-instances/","http://localhost:8080/risk-instances/","http://127.0.0.1:8000/risk-instances/","http://localhost:8000/risk-instances/"];this.testResults.push("Testing API endpoints in order of priority..."),this.testResults.push(`Primary endpoint: ${e[0]} (confirmed working in browser)`);const a=t=>{if(t>=e.length)return void this.testResults.push("All tests completed.");const i=e[t];this.testResults.push(`Testing: ${i}`),fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json().then(e=>{this.testResults.push(`âœ… ${i} - Connected successfully`),this.testResults.push(`Found ${e.length||0} risk instances in the database`),a(t+1)}):e.text().then(()=>{this.testResults.push(`âŒ ${i} - Status: ${e.status}`),a(t+1)})).catch(e=>{this.testResults.push(`âŒ ${i} - Error: ${e.message}`),a(t+1)})};a(0)},validateChoiceField(e,a,t){return e?t.includes(e)?(this.validationErrors[a]="",!0):(this.validationErrors[a]=`Invalid ${a}. Must be one of: ${t.join(", ")}`,!1):(this.validationErrors[a]=`${a} is required`,!1)},validateNumericField(e,a,t,i){const s=parseInt(e);return isNaN(s)?(this.validationErrors[a]=`${a} must be a number`,!1):s<t||s>i?(this.validationErrors[a]=`${a} must be between ${t} and ${i}`,!1):(this.validationErrors[a]="",!0)},validateTextField(e,a,t=!1){const i=this.sanitizeHTML(e);return!i&&t?(this.validationErrors[a]=`${a} is required`,!1):i&&!this.validationRules.TEXT_PATTERN.test(i)?(this.validationErrors[a]=`${a} contains invalid characters`,!1):(this.validationErrors[a]="",!0)},validateForm(){let e=!0;return e=this.validateChoiceField(this.newInstance.Criticality,"Criticality",this.validationRules.ALLOWED_CRITICALITY)&&e,e=this.validateChoiceField(this.newInstance.RiskPriority,"RiskPriority",this.validationRules.ALLOWED_RISK_PRIORITY)&&e,e=this.validateChoiceField(this.newInstance.Origin,"Origin",this.validationRules.ALLOWED_ORIGIN)&&e,e=this.validateChoiceField(this.newInstance.RiskType,"RiskType",this.validationRules.ALLOWED_RISK_TYPE)&&e,e=this.validateChoiceField(this.newInstance.Appetite,"Appetite",this.validationRules.ALLOWED_APPETITE)&&e,e=this.validateChoiceField(this.newInstance.RiskResponseType,"RiskResponseType",this.validationRules.ALLOWED_RISK_RESPONSE_TYPE)&&e,e=this.validateNumericField(this.newInstance.RiskLikelihood,"RiskLikelihood",this.validationRules.RISK_LIKELIHOOD_RANGE.min,this.validationRules.RISK_LIKELIHOOD_RANGE.max)&&e,e=this.validateNumericField(this.newInstance.RiskImpact,"RiskImpact",this.validationRules.RISK_IMPACT_RANGE.min,this.validationRules.RISK_IMPACT_RANGE.max)&&e,e=this.validateTextField(this.newInstance.RiskTitle,"RiskTitle",!0)&&e,e=this.validateTextField(this.newInstance.RiskDescription,"RiskDescription",!0)&&e,e=this.validateTextField(this.newInstance.PossibleDamage,"PossibleDamage",!1)&&e,e=this.validateTextField(this.newInstance.RiskResponseDescription,"RiskResponseDescription",!1)&&e,e=this.validateTextField(this.newInstance.RiskMitigation,"RiskMitigation",!1)&&e,e},submitInstance(){if(Object.keys(this.validationErrors).forEach(e=>{this.validationErrors[e]=""}),!this.validateForm())return console.error("Form validation failed",this.validationErrors),void this.$nextTick(()=>{const e=Object.keys(this.validationErrors).find(e=>this.validationErrors[e]);if(e){const a=document.getElementById(e.toLowerCase());a&&(a.scrollIntoView({behavior:"smooth",block:"center"}),a.focus())}});try{this.submitRiskInstance()}catch(e){console.error("Error submitting form:",e)}},submitRiskInstance(){const e={};Object.keys(this.newInstance).forEach(a=>{""!==this.newInstance[a]&&null!==this.newInstance[a]&&("string"===typeof this.newInstance[a]?e[a]=this.sanitizeHTML(this.newInstance[a]):e[a]=this.newInstance[a])}),this.selectedBusinessImpacts.length>0&&(e.BusinessImpact=this.selectedBusinessImpacts.map(e=>this.sanitizeHTML(e.value)).join(", ")),this.selectedOwnerText&&(e.RiskOwner=this.sanitizeHTML(this.selectedOwnerText)),e.MitigationStatus&&"Not Started"!==e.MitigationStatus||(e.MitigationStatus=null);const a=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),t={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};a&&(t["X-CSRF-TOKEN"]=a),e.UserId||(e.UserId=1),qe.A.post("http://localhost:8000/api/risk-instances/",e,{headers:t,withCredentials:!0}).then(a=>{console.log("Risk instance created successfully:",a.data),this.$popup.success("Risk instance created successfully!"),this.resetForm(),this.sendPushNotification(e)}).catch(e=>{console.error("Error creating risk instance:",e);let a="Unknown error occurred";e.response&&e.response.data?a=e.response.data.error?e.response.data.error:e.response.data.message?e.response.data.message:"string"===typeof e.response.data?e.response.data:JSON.stringify(e.response.data):e.message&&(a=e.message),this.$popup.error("Error: "+a)})},resetForm(){this.newInstance={Criticality:"",PossibleDamage:"",Category:"",Appetite:"Yes",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskResponseType:"Mitigation",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Not Assigned",UserId:1,RiskId:null,IncidentId:null,RiskTitle:"",BusinessImpact:"",Origin:"",MitigationDueDate:null,MitigationStatus:null,MitigationCompletedDate:null,ReviewerCount:null,RecurrenceCount:1,RiskFormDetails:null,ModifiedMitigations:null,ComplianceId:"",RiskType:"Current"},this.selectedRiskIdText="",this.selectedOwnerText="",this.selectedComplianceIdText="",this.selectedBusinessImpacts=[],this.showBusinessImpactDropdown=!1,this.businessImpactSearch="",this.showAddImpactModal=!1,this.newBusinessImpact="",this.selectedCategory="",this.calculateRiskExposureRating()},handleFocus(){},handleBlur(){},fetchUsers(){this.loadingUsers=!0;const e="http://127.0.0.1:8000/api/users-for-dropdown/",a={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}};fetch(e,a).then(e=>{if(!e.ok)throw new Error(`API Error: ${e.status}`);return e.json()}).then(e=>{this.users=e,this.filteredUsers=[...e],this.loadingUsers=!1}).catch(e=>{console.error("Error fetching users:",e),this.loadingUsers=!1,this.filteredUsers=[]})},filterUsers(){if(!this.userSearchQuery)return void(this.filteredUsers=[...this.users]);const e=this.sanitizeHTML(this.userSearchQuery.toLowerCase());this.filteredUsers=this.users.filter(a=>a.UserName&&a.UserName.toLowerCase().includes(e))},selectUser(e){this.selectedOwnerText=e.UserName,this.newInstance.RiskOwner=e.UserName,this.showUserDropdown=!1,e.UserId&&(this.newInstance.UserId=e.UserId)},toggleUserDropdown(){this.showUserDropdown=!this.showUserDropdown,this.showUserDropdown&&(this.userSearchQuery="",this.fetchUsers())},closeUserDropdown(e){const a=document.querySelector(".risk-instance-user-dropdown-container");a&&!a.contains(e.target)&&(this.showUserDropdown=!1)},fetchCompliances(){this.loadingCompliances=!0;const e="http://127.0.0.1:8000/api/compliances-for-dropdown/",a={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}};fetch(e,a).then(e=>{if(!e.ok)throw new Error(`API Error: ${e.status}`);return e.json()}).then(e=>{this.compliances=e,this.filteredCompliances=[...e],this.loadingCompliances=!1}).catch(e=>{console.error("Error fetching compliances:",e),this.loadingCompliances=!1,this.compliances=[],this.filteredCompliances=[]})},filterCompliances(){if(!this.complianceSearchQuery)return void(this.filteredCompliances=[...this.compliances]);const e=this.sanitizeHTML(this.complianceSearchQuery.toLowerCase());this.filteredCompliances=this.compliances.filter(a=>a.ComplianceId&&a.ComplianceId.toString().includes(e)||a.ComplianceItemDescription&&a.ComplianceItemDescription.toLowerCase().includes(e))},selectCompliance(e){this.selectedComplianceIdText=`Compliance ID: ${e.ComplianceId}`,this.showComplianceDropdown=!1,e.ComplianceItemDescription&&(this.newInstance.RiskDescription=e.ComplianceItemDescription),e.PossibleDamage&&(this.newInstance.PossibleDamage=e.PossibleDamage),e.ComplianceId&&(this.newInstance.ComplianceId=e.ComplianceId)},toggleComplianceDropdown(){this.showComplianceDropdown=!this.showComplianceDropdown,this.showComplianceDropdown&&(this.complianceSearchQuery="",this.fetchCompliances())},closeComplianceDropdown(e){const a=document.querySelector(".risk-instance-compliance-dropdown-container");a&&!a.contains(e.target)&&(this.showComplianceDropdown=!1)},async fetchBusinessImpacts(){try{const e={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}},a=await fetch("http://127.0.0.1:8000/api/business-impacts/",e);if(!a.ok)throw new Error(`API Error: ${a.status}`);const t=await a.json();"success"===t.status&&(this.businessImpacts=t.data)}catch(e){console.error("Error fetching business impacts:",e)}},toggleBusinessImpactDropdown(){this.showBusinessImpactDropdown=!this.showBusinessImpactDropdown,this.showBusinessImpactDropdown?(this.businessImpactSearch="",document.addEventListener("click",this.closeBusinessImpactDropdown)):document.removeEventListener("click",this.closeBusinessImpactDropdown)},closeBusinessImpactDropdown(e){const a=document.querySelector(".risk-instance-business-impact-dropdown");a&&!a.contains(e.target)&&(this.showBusinessImpactDropdown=!1,document.removeEventListener("click",this.closeBusinessImpactDropdown))},toggleBusinessImpact(e){const a=this.selectedBusinessImpacts.findIndex(a=>a.id===e.id);-1===a?this.selectedBusinessImpacts.push(e):this.selectedBusinessImpacts.splice(a,1),this.newInstance.BusinessImpact=this.selectedBusinessImpacts.map(e=>e.value).join(", ")},isBusinessImpactSelected(e){return this.selectedBusinessImpacts.some(a=>a.id===e.id)},async addNewBusinessImpact(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newBusinessImpact.trim())try{console.log("Adding new business impact:",this.newBusinessImpact);const e=await fetch("http://127.0.0.1:8000/api/business-impacts/add/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:this.newBusinessImpact.trim()})});if(!e.ok)throw new Error(`API Error: ${e.status}`);const a=await e.json();if("success"!==a.status)throw new Error("Failed to add business impact: "+(a.message||"Unknown error"));console.log("Successfully added business impact:",a.data),this.businessImpacts.push(a.data),this.toggleBusinessImpact(a.data),this.showAddImpactModal=!1,this.newBusinessImpact=""}catch(a){console.error("Error adding new business impact:",a),this.$popup.error("Failed to add new business impact: "+a.message)}},async fetchCategories(){try{const e={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}},a=await fetch("http://127.0.0.1:8000/api/risk-categories/",e);if(!a.ok)throw new Error(`API Error: ${a.status}`);const t=await a.json();"success"===t.status&&(this.categories=t.data)}catch(e){console.error("Error fetching categories:",e)}},toggleCategoryDropdown(){this.showCategoryDropdown=!this.showCategoryDropdown,this.showCategoryDropdown&&(this.categorySearch="")},selectCategory(e){this.selectedCategory=e.value,this.newInstance.Category=e.value,this.showCategoryDropdown=!1},async addNewCategory(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newCategory.trim())try{console.log("Adding new category:",this.newCategory);const e=await fetch("http://127.0.0.1:8000/api/risk-categories/add/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:this.newCategory.trim()})});if(!e.ok)throw new Error(`API Error: ${e.status}`);const a=await e.json();if("success"!==a.status)throw new Error("Failed to add category: "+(a.message||"Unknown error"));console.log("Successfully added category:",a.data),this.categories.push(a.data),this.selectCategory(a.data),this.showAddCategoryModal=!1,this.newCategory=""}catch(a){console.error("Error adding new category:",a),this.$popup.error("Failed to add new category: "+a.message)}},sanitizeHTML(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#x60;"):""},encodeForHTML(e){return this.sanitizeHTML(e)},encodeForJavaScript(e){return e?String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/`/g,"\\`").replace(/\//g,"\\/").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f").replace(/<\/script>/gi,"<\\/script>"):""},async sendPushNotification(e){try{const a={title:"New Risk Instance Created",message:`A new risk instance "${e.RiskTitle||"Untitled Risk"}" has been created in the Risk module.`,category:"risk",priority:"high",user_id:"default_user"},t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(a){console.error("Error sending push notification:",a)}}}};const Spe=(0,se.A)(_pe,[["render",Ppe],["__scopeId","data-v-3bc178f6"]]);var Ape=Spe;const Tpe={class:"risk-workflow-container"},xpe={key:0},Fpe={class:"risk-workflow-toggle-buttons"},Vpe={class:"risk-workflow-user-filter"},Mpe={key:0,class:"risk-workflow-loading-indicator"},Xpe={class:"risk-workflow-tabs"},Upe={key:0,class:"risk-workflow-loading"},Npe={key:1,class:"risk-workflow-error-message"},$pe={key:2},Ope={key:0,class:"risk-workflow-no-data"},jpe={key:1,class:"risk-workflow-no-data"},Bpe={key:2},Wpe={class:"risk-workflow-user-tasks-table-responsive"},Qpe={class:"risk-workflow-user-tasks-table"},qpe=["onClick"],Kpe={key:3},Jpe={key:0,class:"risk-workflow-no-data"},zpe={key:1,class:"risk-workflow-no-data"},Hpe={key:2},Ype={class:"risk-workflow-user-tasks-table-responsive"},Gpe={class:"risk-workflow-user-tasks-table"},Zpe={key:1,style:{"font-size":"12px",color:"#888"}},eve=["onClick"],ave={key:1,class:"risk-workflow-fullscreen"},tve={class:"risk-workflow-back-to-tasks"},ive={key:0,class:"risk-workflow-loading"},sve={key:1,class:"risk-workflow-no-data"},ove={key:2,class:"risk-workflow-simplified-workflow"},lve={class:"risk-workflow-timeline"},nve={class:"risk-workflow-step-circle"},rve={key:0},cve={key:1},dve={class:"step-box"},uve={key:0,class:"submission-date user-date"},pve={key:1,class:"submission-date reviewer-date"},vve={key:2,class:"status-tag approved"},mve={key:3,class:"status-tag rejected"},kve={key:0,class:"remarks"},hve={key:4,class:"status-tag completed"},gve={key:5,class:"status-tag active"},yve={key:6,class:"status-tag locked"},fve={key:7,class:"step-comments-display"},bve={key:8,class:"file-display"},Cve=["href","filename"],Lve={key:0,class:"file-info-details"},wve={class:"file-upload-date"},Eve={key:9,class:"risk-workflow-status-control"},Rve={class:"step-comments"},Dve=["id","onUpdate:modelValue"],Ive={class:"file-upload-container"},Pve=["for"],_ve={class:"file-upload-wrapper"},Sve=["id","onChange"],Ave={key:0,class:"file-preview"},Tve={class:"file-info"},xve=["onClick"],Fve=["onClick"],Vve=["onClick"],Mve={class:"mitigation-questionnaire"},Xve={key:0,class:"submission-date user-date"},Uve={key:1,class:"submission-date reviewer-date"},Nve={class:"question-group"},$ve=["disabled"],Ove={class:"question-group"},jve=["disabled"],Bve={class:"question-group"},Wve=["disabled"],Qve={class:"question-group"},qve=["disabled"],Kve={class:"question-group"},Jve=["disabled"],zve={class:"question-group"},Hve=["disabled"],Yve={class:"question-group"},Gve=["disabled"],Zve={class:"question-group"},eme=["disabled"],ame={class:"question-group"},tme=["disabled"],ime={class:"question-group"},sme=["disabled"],ome={key:1,class:"questionnaire-feedback"},lme={key:0,class:"reviewer-info"},nme={key:2,class:"reviewer-workflow-fullscreen"},rme={class:"back-to-tasks"},cme={key:0,class:"loading"},dme={key:1},ume={class:"risk-summary"},pme={key:0,class:"status-message"},vme={key:1,class:"status-message"},mme={class:"mitigation-review-list"},kme=["disabled"],hme=["value"],gme={key:0,class:"no-versions-message"},yme=["data-id"],fme={class:"mitigation-heading"},bme={class:"mitigation-split-content"},Cme={class:"mitigation-previous"},Lme={class:"version-label"},wme={style:{"font-size":"10px",color:"#999","margin-top":"2px"}},Eme={key:0,class:"mitigation-content"},Rme={class:"metadata-section"},Dme={class:"metadata-item"},Ime={class:"metadata-value"},Pme={class:"metadata-item"},_me={class:"metadata-value"},Sme={key:0,class:"metadata-item"},Ame={class:"metadata-value"},Tme={key:1,class:"metadata-item"},xme={class:"metadata-value"},Fme={key:0,class:"comments-section"},Vme={class:"comments-text"},Mme={key:1,class:"evidence-section"},Xme=["href","filename"],Ume={key:3,class:"remarks-section"},Nme={class:"remarks-text"},$me={key:4,class:"reviewer-feedback-section"},Ome={class:"reviewer-feedback-text"},jme={key:1,class:"mitigation-empty"},Bme={class:"mitigation-current"},Wme={class:"version-label"},Qme={style:{"font-size":"10px",color:"#666","margin-top":"2px"}},qme={class:"mitigation-content"},Kme={class:"metadata-section"},Jme={class:"metadata-item"},zme={class:"metadata-value"},Hme={class:"metadata-item"},Yme={class:"metadata-value"},Gme={key:0,class:"metadata-item"},Zme={class:"metadata-value"},eke={key:1,class:"metadata-item"},ake={class:"metadata-value"},tke={key:2,class:"metadata-item"},ike={class:"metadata-value"},ske={key:0,class:"comments-section"},oke={class:"comments-text"},lke={key:1,class:"evidence-section"},nke=["href","filename"],rke={key:3,class:"remarks-section"},cke={class:"remarks-text"},dke={class:"approval-controls"},uke={key:0,class:"approval-buttons"},pke=["onClick"],vke=["onClick"],mke={key:1,class:"remarks-field"},kke=["onUpdate:modelValue"],hke=["onClick"],gke=["onClick"],yke={key:2,class:"approved-actions"},fke=["onClick"],bke={key:3,class:"reviewer-remarks-display"},Cke={class:"form-details-review"},Lke={class:"submission-dates"},wke={key:0,class:"submission-date user-date"},Eke={key:1,class:"submission-date reviewer-date"},Rke={class:"form-split-content"},Dke={class:"form-field-split"},Ike={key:0,class:"form-field-previous"},Pke={class:"form-split-content"},_ke={class:"form-field-split"},Ske={key:0,class:"form-field-previous"},Ake={class:"form-split-content"},Tke={class:"form-field-split"},xke={key:0,class:"form-field-previous"},Fke={class:"form-split-content"},Vke={class:"form-field-split"},Mke={key:0,class:"form-field-previous"},Xke={class:"form-split-content"},Uke={class:"form-field-split"},Nke={key:0,class:"form-field-previous"},$ke={class:"form-split-content"},Oke={class:"form-field-split"},jke={key:0,class:"form-field-previous"},Bke={class:"form-split-content"},Wke={class:"form-field-split"},Qke={key:0,class:"form-field-previous"},qke={class:"form-split-content"},Kke={class:"form-field-split"},Jke={key:0,class:"form-field-previous"},zke={class:"form-split-content"},Hke={class:"form-field-split"},Yke={key:0,class:"form-field-previous"},Gke={class:"form-split-content"},Zke={class:"form-field-split"},ehe={key:0,class:"form-field-previous"},ahe={key:1,class:"questionnaire-approval"},the={key:0,class:"approval-buttons"},ihe={key:1,class:"approval-status approved"},she={key:2,class:"approval-status rejected"},ohe={class:"remarks-field"},lhe={class:"approval-actions"},nhe={class:"review-actions"},rhe=["disabled"],che=["disabled"],dhe={key:0,class:"review-complete-notice"};function uhe(e,a,t,o,l,n){const r=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)("div",Tpe,[l.showMitigationWorkflow||l.showReviewerWorkflow?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",xpe,[(0,s.Lk)("div",Fpe,[(0,s.Lk)("button",{class:"risk-workflow-toggle-button",onClick:a[0]||(a[0]=e=>n.navigateTo("resolution"))}," Risk Resolution "),(0,s.Lk)("button",{class:"risk-workflow-toggle-button active",onClick:a[1]||(a[1]=e=>n.navigateTo("workflow"))}," Risk Workflow ")]),(0,s.Lk)("div",Vpe,[l.loading&&0===l.users.length?((0,s.uX)(),(0,s.CE)("div",Mpe,"Loading users...")):((0,s.uX)(),(0,s.Wv)(r,{key:1,modelValue:l.selectedUserId,"onUpdate:modelValue":a[2]||(a[2]=e=>l.selectedUserId=e),config:l.userDropdownConfig,onChange:n.fetchData},null,8,["modelValue","config","onChange"]))]),(0,s.Lk)("div",Xpe,[(0,s.Lk)("div",{class:(0,d.C4)(["risk-workflow-tab",{active:"user"===l.activeTab}]),onClick:a[3]||(a[3]=e=>l.activeTab="user")}," My Tasks ",2),(0,s.Lk)("div",{class:(0,d.C4)(["risk-workflow-tab",{active:"reviewer"===l.activeTab}]),onClick:a[4]||(a[4]=e=>l.activeTab="reviewer")}," Reviewer Tasks ",2)]),l.loading?((0,s.uX)(),(0,s.CE)("div",Upe," Loading data... ")):l.error?((0,s.uX)(),(0,s.CE)("div",Npe,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),"user"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",$pe,[l.selectedUserId?0===l.userRisks.length?((0,s.uX)(),(0,s.CE)("div",jpe,a[29]||(a[29]=[(0,s.Lk)("p",null,"No risks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",Bpe,[(0,s.Lk)("div",Wpe,[(0,s.Lk)("table",Qpe,[a[31]||(a[31]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"RiskID"),(0,s.Lk)("th",null,"Origin"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Risk Description"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.userRisks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.RiskInstanceId},[(0,s.Lk)("td",null,(0,d.v_)(e.RiskInstanceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",null,(0,d.v_)(e.Category),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["risk-workflow-criticality-badge",e.Criticality?.toLowerCase()])},(0,d.v_)(e.Criticality),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.RiskDescription),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)("risk-workflow-status-"+(e.RiskStatus?.toLowerCase().replace(/\s+/g,"-")||"not-assigned"))},(0,d.v_)("Revision Required by Reviewer"===e.RiskStatus?"Waiting for Reviewer":"Revision Required by User"===e.RiskStatus?"Action Required":e.RiskStatus||"Not Assigned"),3),e.MitigationStatus?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)(["risk-workflow-mitigation-status",n.getMitigationStatusClass(e.MitigationStatus)])},(0,d.v_)(e.MitigationStatus),3)):(0,s.Q3)("",!0),e.MitigationDueDate?((0,s.uX)(),(0,s.CE)("span",{key:1,class:(0,d.C4)(["risk-workflow-due-status",n.getDueStatusClass(e.MitigationDueDate)])},(0,d.v_)(n.getDueStatusText(e.MitigationDueDate)),3)):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{onClick:a=>n.viewMitigations(e.RiskInstanceId),class:"risk-workflow-view-btn"},a[30]||(a[30]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,qpe)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",Ope,a[28]||(a[28]=[(0,s.Lk)("p",null,"Please select a user to view their assigned risks.",-1)])))])):(0,s.Q3)("",!0),"reviewer"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",Kpe,[l.selectedUserId?0===l.reviewerTasks.length?((0,s.uX)(),(0,s.CE)("div",zpe,a[33]||(a[33]=[(0,s.Lk)("p",null,"No review tasks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",Hpe,[(0,s.Lk)("div",Ype,[(0,s.Lk)("table",Gpe,[a[35]||(a[35]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"RiskID"),(0,s.Lk)("th",null,"Origin"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Risk Description"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.reviewerTasks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.RiskInstanceId},[(0,s.Lk)("td",null,(0,d.v_)(e.RiskInstanceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",null,(0,d.v_)(e.Category||"Unknown"),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["risk-workflow-criticality-badge",e.Criticality?.toLowerCase()||"unknown"])},(0,d.v_)(e.Criticality||"Unknown"),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.RiskDescription||"Unknown"),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",null,(0,d.v_)("Revision Required by Reviewer"===e.RiskStatus?"Review Required":"Revision Required by User"===e.RiskStatus?"Feedback Sent":e.RiskStatus||"Unknown"),1),e.MitigationStatus?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)(["risk-workflow-mitigation-status",n.getMitigationStatusClass(e.MitigationStatus)])},(0,d.v_)(e.MitigationStatus),3)):(0,s.Q3)("",!0),n.getUserName(e.UserId)?((0,s.uX)(),(0,s.CE)("div",Zpe,"By: "+(0,d.v_)(n.getUserName(e.UserId)),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{onClick:a=>n.reviewMitigations(e),class:"risk-workflow-review-btn"},a[34]||(a[34]=[(0,s.Lk)("i",{class:"fas fa-tasks"},null,-1),(0,s.eW)(" Review ")]),8,eve)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",Jpe,a[32]||(a[32]=[(0,s.Lk)("p",null,"Please select a user to view their reviewer tasks.",-1)])))])):(0,s.Q3)("",!0)])),l.showMitigationWorkflow?((0,s.uX)(),(0,s.CE)("div",ave,[(0,s.Lk)("div",tve,[(0,s.Lk)("button",{onClick:a[5]||(a[5]=(...e)=>n.closeMitigationModal&&n.closeMitigationModal(...e)),class:"risk-workflow-back-btn",title:"Back to tasks"},a[36]||(a[36]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",ive,a[37]||(a[37]=[(0,s.Lk)("div",{class:"risk-workflow-spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation steps...",-1)]))):l.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",ove,[(0,s.Lk)("div",lve,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["risk-workflow-timeline-step",{completed:"Completed"===e.status,active:n.isStepActive(t),locked:n.isStepLocked(t),approved:!0===e.approved,rejected:!1===e.approved}]),style:(0,d.Tr)({"--step-index":t})},[(0,s.Lk)("div",nve,["Completed"===e.status?((0,s.uX)(),(0,s.CE)("span",rve,a[38]||(a[38]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]))):((0,s.uX)(),(0,s.CE)("span",cve,(0,d.v_)(e.title.replace("Step ","")),1))]),(0,s.Lk)("div",dve,[(0,s.Lk)("h3",null,(0,d.v_)(e.description),1),e.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",uve,[a[39]||(a[39]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(e.user_submitted_date)),1)])):(0,s.Q3)("",!0),e.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",pve,[a[40]||(a[40]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(e.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0),!0===e.approved?((0,s.uX)(),(0,s.CE)("div",vve,a[41]||(a[41]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Approved ")]))):!1===e.approved?((0,s.uX)(),(0,s.CE)("div",mve,[a[43]||(a[43]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),a[44]||(a[44]=(0,s.eW)(" Rejected ")),e.remarks?((0,s.uX)(),(0,s.CE)("div",kve,[a[42]||(a[42]=(0,s.Lk)("strong",null,"Feedback:",-1)),(0,s.eW)(" "+(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])):"Completed"===e.status?((0,s.uX)(),(0,s.CE)("div",hve,a[45]||(a[45]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Completed ")]))):n.isStepActive(t)?((0,s.uX)(),(0,s.CE)("div",gve,a[46]||(a[46]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.eW)(" In Progress ")]))):((0,s.uX)(),(0,s.CE)("div",yve,a[47]||(a[47]=[(0,s.Lk)("i",{class:"fas fa-lock"},null,-1),(0,s.eW)(" Locked ")]))),e.comments?((0,s.uX)(),(0,s.CE)("div",fve,[a[48]||(a[48]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" Your Comments")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.comments),1)])):(0,s.Q3)("",!0),e.fileData?((0,s.uX)(),(0,s.CE)("div",bve,[a[50]||(a[50]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Uploaded Evidence")],-1)),(0,s.Lk)("a",{href:e.s3Url||e.fileData,download:"",filename:e.fileName||"evidence"},[a[49]||(a[49]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName||"Download file"),1)],8,Cve),e.s3FileInfo?((0,s.uX)(),(0,s.CE)("div",Lve,[(0,s.Lk)("span",wve,"Uploaded: "+(0,d.v_)(n.formatDateTime(e.s3FileInfo.uploadedAt)),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),e.approved||n.isStepLocked(t)?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Eve,[(0,s.Lk)("div",Rve,[a[51]||(a[51]=(0,s.Lk)("label",{for:"step-comments-input"},[(0,s.Lk)("i",{class:"fas fa-comment"}),(0,s.eW)(" Comments:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"step-comments-input-"+t,"onUpdate:modelValue":a=>e.comments=a,placeholder:"Enter your comments for this mitigation step...",class:"step-comments-input"},null,8,Dve),[[i.Jo,e.comments]])]),(0,s.Lk)("div",Ive,[(0,s.Lk)("label",{for:"file-upload-"+t,class:"file-upload-label"},[a[52]||(a[52]=(0,s.Lk)("i",{class:"fas fa-file-upload"},null,-1)),a[53]||(a[53]=(0,s.eW)(" Upload Evidence: ")),(0,s.Lk)("span",null,(0,d.v_)(e.fileName||"Choose a file..."),1)],8,Pve),(0,s.Lk)("div",_ve,[(0,s.Lk)("input",{type:"file",id:"file-upload-"+t,onChange:e=>n.handleFileUpload(e,t),class:"file-upload-input",style:{display:"none"}},null,40,Sve)]),e.fileData?((0,s.uX)(),(0,s.CE)("div",Ave,[(0,s.Lk)("div",Tve,[a[55]||(a[55]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName)+" ",1),(0,s.Lk)("button",{onClick:e=>n.removeFile(t),class:"remove-file-btn"},a[54]||(a[54]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,xve)])])):(0,s.Q3)("",!0)]),"Completed"!==e.status?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:e=>n.completeStep(t),class:(0,d.C4)(["risk-workflow-complete-btn",{active:"Completed"===e.status}])},a[56]||(a[56]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Mark as Complete ")]),10,Fve)):((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:e=>n.resetStep(t),class:"risk-workflow-reset-btn"},a[57]||(a[57]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset ")]),8,Vve))]))])],6))),128))]),(0,s.Lk)("div",Mve,[a[73]||(a[73]=(0,s.Lk)("h3",null,"Risk Mitigation Questionnaire",-1)),n.questionnaireReviewed?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["questionnaire-status",{approved:n.questionnaireApproved,rejected:!n.questionnaireApproved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",n.questionnaireApproved?"fa-check-circle":"fa-times-circle"])},null,2),(0,s.eW)(" "+(0,d.v_)(n.questionnaireApproved?"Approved":"Revision Required")+" ",1),l.formDetails.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",Xve,[a[58]||(a[58]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(l.formDetails.user_submitted_date)),1)])):(0,s.Q3)("",!0),l.formDetails.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",Uve,[a[59]||(a[59]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(l.formDetails.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0)],2)):(0,s.Q3)("",!0),a[74]||(a[74]=(0,s.Lk)("p",{class:"questionnaire-note"},"Please complete all fields to proceed with submission",-1)),(0,s.Lk)("div",Nve,[a[60]||(a[60]=(0,s.Lk)("label",{for:"cost-input"},[(0,s.Lk)("span",{class:"question-number"},"1"),(0,s.eW)(" What is the cost for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"cost-input",type:"number","onUpdate:modelValue":a[6]||(a[6]=e=>l.formDetails.cost=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter the cost..."},null,8,$ve),[[i.Jo,l.formDetails.cost]])]),(0,s.Lk)("div",Ove,[a[61]||(a[61]=(0,s.Lk)("label",{for:"impact-input"},[(0,s.Lk)("span",{class:"question-number"},"2"),(0,s.eW)(" What is the impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"impact-input",type:"number","onUpdate:modelValue":a[7]||(a[7]=e=>l.formDetails.impact=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter the impact..."},null,8,jve),[[i.Jo,l.formDetails.impact]])]),(0,s.Lk)("div",Bve,[a[62]||(a[62]=(0,s.Lk)("label",{for:"financial-impact-input"},[(0,s.Lk)("span",{class:"question-number"},"3"),(0,s.eW)(" What is the financial impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"financial-impact-input",type:"number","onUpdate:modelValue":a[8]||(a[8]=e=>l.formDetails.financialImpact=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter the financial impact..."},null,8,Wve),[[i.Jo,l.formDetails.financialImpact]])]),(0,s.Lk)("div",Qve,[a[63]||(a[63]=(0,s.Lk)("label",{for:"reputational-impact-input"},[(0,s.Lk)("span",{class:"question-number"},"4"),(0,s.eW)(" What is the reputational impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"reputational-impact-input","onUpdate:modelValue":a[9]||(a[9]=e=>l.formDetails.reputationalImpact=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,placeholder:"Describe the reputational impact..."},null,8,qve),[[i.Jo,l.formDetails.reputationalImpact]])]),(0,s.Lk)("div",Kve,[a[64]||(a[64]=(0,s.Lk)("label",{for:"operational-impact-input"},[(0,s.Lk)("span",{class:"question-number"},"5"),(0,s.eW)(" What is the Operational Impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"operational-impact-input",type:"number","onUpdate:modelValue":a[10]||(a[10]=e=>l.formDetails.operationalImpact=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter the operational impact..."},null,8,Jve),[[i.Jo,l.formDetails.operationalImpact]])]),(0,s.Lk)("div",zve,[a[65]||(a[65]=(0,s.Lk)("label",{for:"financial-loss-input"},[(0,s.Lk)("span",{class:"question-number"},"6"),(0,s.eW)(" What is the Financial Loss for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"financial-loss-input",type:"number","onUpdate:modelValue":a[11]||(a[11]=e=>l.formDetails.financialLoss=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter the financial loss..."},null,8,Hve),[[i.Jo,l.formDetails.financialLoss]])]),(0,s.Lk)("div",Yve,[a[66]||(a[66]=(0,s.Lk)("label",{for:"system-downtime-input"},[(0,s.Lk)("span",{class:"question-number"},"7"),(0,s.eW)(" What is the expected system downtime (hrs) if this risk occurs?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"system-downtime-input",type:"number","onUpdate:modelValue":a[12]||(a[12]=e=>l.formDetails.systemDowntime=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter expected downtime in hours..."},null,8,Gve),[[i.Jo,l.formDetails.systemDowntime]])]),(0,s.Lk)("div",Zve,[a[67]||(a[67]=(0,s.Lk)("label",{for:"recovery-time-input"},[(0,s.Lk)("span",{class:"question-number"},"8"),(0,s.eW)(" How long did it take to recover last time (hrs)?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"recovery-time-input",type:"number","onUpdate:modelValue":a[13]||(a[13]=e=>l.formDetails.recoveryTime=e),disabled:!n.allStepsCompleted||n.questionnaireApproved,min:"0",placeholder:"Enter recovery time in hours..."},null,8,eme),[[i.Jo,l.formDetails.recoveryTime]])]),(0,s.Lk)("div",ame,[a[69]||(a[69]=(0,s.Lk)("label",{for:"recurrence-possible-input"},[(0,s.Lk)("span",{class:"question-number"},"9"),(0,s.eW)(" Is it possible that this risk will recur again?")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"recurrence-possible-input","onUpdate:modelValue":a[14]||(a[14]=e=>l.formDetails.recurrencePossible=e),disabled:!n.allStepsCompleted||n.questionnaireApproved},a[68]||(a[68]=[(0,s.Lk)("option",{value:""},"Select",-1),(0,s.Lk)("option",{value:"Yes"},"Yes",-1),(0,s.Lk)("option",{value:"No"},"No",-1),(0,s.Lk)("option",{value:"Unknown"},"Unknown",-1)]),8,tme),[[i.u1,l.formDetails.recurrencePossible]])]),(0,s.Lk)("div",ime,[a[71]||(a[71]=(0,s.Lk)("label",{for:"improvement-initiative-input"},[(0,s.Lk)("span",{class:"question-number"},"10"),(0,s.eW)(" Is this an Improvement Initiative which will prevent the future recurrence of said risk?")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"improvement-initiative-input","onUpdate:modelValue":a[15]||(a[15]=e=>l.formDetails.improvementInitiative=e),disabled:!n.allStepsCompleted||n.questionnaireApproved},a[70]||(a[70]=[(0,s.Lk)("option",{value:""},"Select",-1),(0,s.Lk)("option",{value:"Yes"},"Yes",-1),(0,s.Lk)("option",{value:"No"},"No",-1),(0,s.Lk)("option",{value:"Unknown"},"Unknown",-1)]),8,sme),[[i.u1,l.formDetails.improvementInitiative]])]),n.questionnaireRejected?((0,s.uX)(),(0,s.CE)("div",ome,[a[72]||(a[72]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",null,(0,d.v_)(n.questionnaireRemarks),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:(0,d.C4)(["submission-area",{ready:n.canSubmit}])},[a[79]||(a[79]=(0,s.Lk)("h3",null,"Submit Mitigation",-1)),l.selectedReviewer?((0,s.uX)(),(0,s.CE)("div",lme,[(0,s.Lk)("p",null,[a[75]||(a[75]=(0,s.Lk)("strong",null,"Assigned Reviewer:",-1)),(0,s.eW)(" "+(0,d.v_)(n.getUserName(l.selectedReviewer)),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:a[16]||(a[16]=(...e)=>n.submitForReview&&n.submitForReview(...e)),class:"submit-btn"},a[76]||(a[76]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.eW)(" Submit for Review ")])),(0,s.Q3)("",!0),(0,s.Q3)("",!0)],2)])):((0,s.uX)(),(0,s.CE)("div",sve," No mitigation steps found for this risk. "))])):(0,s.Q3)("",!0),l.showReviewerWorkflow?((0,s.uX)(),(0,s.CE)("div",nme,[(0,s.Lk)("div",rme,[(0,s.Lk)("button",{onClick:a[17]||(a[17]=(...e)=>n.closeReviewerModal&&n.closeReviewerModal(...e)),class:"back-btn",title:"Back to tasks"},a[80]||(a[80]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),a[167]||(a[167]=(0,s.Lk)("h1",null,"Review Risk Mitigations",-1)),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",cme,a[81]||(a[81]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",dme,[(0,s.Lk)("div",ume,[(0,s.Lk)("h3",null,(0,d.v_)(l.currentReviewTask?.RiskDescription||"Risk #"+l.currentReviewTask?.RiskInstanceId),1),(0,s.Lk)("p",null,[a[82]||(a[82]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentReviewTask?.RiskInstanceId),1)]),(0,s.Lk)("p",null,[a[83]||(a[83]=(0,s.Lk)("strong",null,"Submitted By:",-1)),(0,s.eW)(" "+(0,d.v_)(n.getUserName(l.currentReviewTask?.UserId)),1)])]),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["review-status-banner",{approved:l.reviewApproved,rejected:!l.reviewApproved}])},[l.reviewApproved?((0,s.uX)(),(0,s.CE)("div",pme,a[84]||(a[84]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" This risk has been approved ")]))):((0,s.uX)(),(0,s.CE)("div",vme,a[85]||(a[85]=[(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1),(0,s.eW)(" Feedback sent to user for revision ")])))],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",mme,[(0,s.Lk)("div",{class:(0,d.C4)(["global-version-dropdown",{loading:l.loadingVersions}])},[a[88]||(a[88]=(0,s.Lk)("label",{for:"global-version-select"},"Select Version to Compare:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"global-version-select","onUpdate:modelValue":a[18]||(a[18]=e=>l.globalSelectedVersion=e),onChange:a[19]||(a[19]=(...e)=>n.onGlobalVersionChange&&n.onGlobalVersionChange(...e)),class:"global-version-select",disabled:l.loadingVersions||0===l.allVersionNames.length},[a[86]||(a[86]=(0,s.Lk)("option",{value:""},"Select a version",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.allVersionNames,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,hme))),128))],40,kme),[[i.u1,l.globalSelectedVersion]]),0!==l.allVersionNames.length||l.loadingVersions?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",gme,a[87]||(a[87]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.eW)(" No previous versions available ")])))],2),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationReviewData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"mitigation-review-item","data-id":t},[(0,s.Lk)("div",fme,[(0,s.Lk)("h4",null,"Mitigation #"+(0,d.v_)(t),1),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["mitigation-status-badge",{approved:!0===e.approved,rejected:!1===e.approved,pending:void 0===e.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===e.approved,"fa-times-circle":!1===e.approved,"fa-clock":void 0===e.approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending Review"),1)],2)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",bme,[(0,s.Lk)("div",Cme,[(0,s.Lk)("div",Lme,[a[89]||(a[89]=(0,s.eW)(" Previous Versions ")),(0,s.Lk)("div",wme," Total Versions: "+(0,d.v_)(l.allVersions.length)+", Selected: "+(0,d.v_)(l.selectedVersions[t]||"None"),1)]),l.selectedVersions[t]&&n.getSelectedVersionData(t,l.selectedVersions[t])?((0,s.uX)(),(0,s.CE)("div",Eme,[a[100]||(a[100]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).description||"No description available"),1),(0,s.Lk)("div",Rme,[a[94]||(a[94]=(0,s.Lk)("h5",null,"Metadata",-1)),(0,s.Lk)("div",Dme,[a[90]||(a[90]=(0,s.Lk)("div",{class:"metadata-label"},"Version:",-1)),(0,s.Lk)("div",Ime,(0,d.v_)(l.selectedVersions[t]),1)]),(0,s.Lk)("div",Pme,[a[91]||(a[91]=(0,s.Lk)("div",{class:"metadata-label"},"Status:",-1)),(0,s.Lk)("div",_me,(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).status||"Not specified"),1)]),n.getSelectedVersionData(t,l.selectedVersions[t]).user_submitted_date?((0,s.uX)(),(0,s.CE)("div",Sme,[a[92]||(a[92]=(0,s.Lk)("div",{class:"metadata-label"},"Submitted:",-1)),(0,s.Lk)("div",Ame,(0,d.v_)(n.formatDateTime(n.getSelectedVersionData(t,l.selectedVersions[t]).user_submitted_date)),1)])):(0,s.Q3)("",!0),void 0!==n.getSelectedVersionData(t,l.selectedVersions[t]).approved?((0,s.uX)(),(0,s.CE)("div",Tme,[a[93]||(a[93]=(0,s.Lk)("div",{class:"metadata-label"},"Review Status:",-1)),(0,s.Lk)("div",xme,[(0,s.Lk)("span",{class:(0,d.C4)({"text-success":n.getSelectedVersionData(t,l.selectedVersions[t]).approved,"text-danger":!1===n.getSelectedVersionData(t,l.selectedVersions[t]).approved})},(0,d.v_)(!0===n.getSelectedVersionData(t,l.selectedVersions[t]).approved?"Approved":!1===n.getSelectedVersionData(t,l.selectedVersions[t]).approved?"Rejected":"Pending"),3)])])):(0,s.Q3)("",!0)]),n.getSelectedVersionData(t,l.selectedVersions[t]).comments?((0,s.uX)(),(0,s.CE)("div",Fme,[a[95]||(a[95]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",Vme,(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).comments),1)])):(0,s.Q3)("",!0),n.getSelectedVersionData(t,l.selectedVersions[t]).fileData?((0,s.uX)(),(0,s.CE)("div",Mme,[a[97]||(a[97]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:n.getSelectedVersionData(t,l.selectedVersions[t]).fileData,download:"",filename:n.getSelectedVersionData(t,l.selectedVersions[t]).fileName,class:"evidence-link"},[a[96]||(a[96]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).fileName),1)],8,Xme)])):(0,s.Q3)("",!0),void 0!==n.getSelectedVersionData(t,l.selectedVersions[t]).approved?((0,s.uX)(),(0,s.CE)("div",{key:2,class:(0,d.C4)(["decision-tag",{approved:!0===n.getSelectedVersionData(t,l.selectedVersions[t]).approved,rejected:!1===n.getSelectedVersionData(t,l.selectedVersions[t]).approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===n.getSelectedVersionData(t,l.selectedVersions[t]).approved,"fa-times-circle":!1===n.getSelectedVersionData(t,l.selectedVersions[t]).approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).approved?"Approved":"Rejected"),1)],2)):(0,s.Q3)("",!0),!1===n.getSelectedVersionData(t,l.selectedVersions[t]).approved&&n.getSelectedVersionData(t,l.selectedVersions[t]).remarks?((0,s.uX)(),(0,s.CE)("div",Ume,[a[98]||(a[98]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",Nme,(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).remarks),1)])):(0,s.Q3)("",!0),n.getSelectedVersionData(t,l.selectedVersions[t]).reviewer_feedback?((0,s.uX)(),(0,s.CE)("div",$me,[a[99]||(a[99]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-dots"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",Ome,(0,d.v_)(n.getSelectedVersionData(t,l.selectedVersions[t]).reviewer_feedback),1)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",jme,a[101]||(a[101]=[(0,s.Lk)("i",{class:"fas fa-history"},null,-1),(0,s.Lk)("p",null,"Select a version from the dropdown above to compare",-1)])))]),(0,s.Lk)("div",Bme,[(0,s.Lk)("div",Wme,[a[102]||(a[102]=(0,s.eW)(" Latest Version ")),(0,s.Lk)("div",Qme,(0,d.v_)(n.getCurrentVersionLabel()),1)]),(0,s.Lk)("div",qme,[a[113]||(a[113]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.description||"No description available"),1),(0,s.Lk)("div",Kme,[a[108]||(a[108]=(0,s.Lk)("h5",null,"Metadata",-1)),(0,s.Lk)("div",Jme,[a[103]||(a[103]=(0,s.Lk)("div",{class:"metadata-label"},"Version:",-1)),(0,s.Lk)("div",zme,(0,d.v_)(l.currentReviewTask?.version||"Current"),1)]),(0,s.Lk)("div",Hme,[a[104]||(a[104]=(0,s.Lk)("div",{class:"metadata-label"},"Status:",-1)),(0,s.Lk)("div",Yme,(0,d.v_)(e.status||"Not specified"),1)]),e.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",Gme,[a[105]||(a[105]=(0,s.Lk)("div",{class:"metadata-label"},"Submitted:",-1)),(0,s.Lk)("div",Zme,(0,d.v_)(n.formatDateTime(e.user_submitted_date)),1)])):(0,s.Q3)("",!0),e.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",eke,[a[106]||(a[106]=(0,s.Lk)("div",{class:"metadata-label"},"Reviewed:",-1)),(0,s.Lk)("div",ake,(0,d.v_)(n.formatDateTime(e.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",tke,[a[107]||(a[107]=(0,s.Lk)("div",{class:"metadata-label"},"Review Status:",-1)),(0,s.Lk)("div",ike,[(0,s.Lk)("span",{class:(0,d.C4)({"text-success":e.approved,"text-danger":!1===e.approved})},(0,d.v_)(!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending"),3)])])):(0,s.Q3)("",!0)]),e.comments?((0,s.uX)(),(0,s.CE)("div",ske,[a[109]||(a[109]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",oke,(0,d.v_)(e.comments),1)])):(0,s.Q3)("",!0),e.fileData?((0,s.uX)(),(0,s.CE)("div",lke,[a[111]||(a[111]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:e.fileData,download:"",filename:e.fileName,class:"evidence-link"},[a[110]||(a[110]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)],8,nke)])):(0,s.Q3)("",!0),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",{key:2,class:(0,d.C4)(["decision-tag",{approved:!0===e.approved,rejected:!1===e.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===e.approved,"fa-times-circle":!1===e.approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(e.approved?"Approved":"Rejected"),1)],2)):(0,s.Q3)("",!0),!1===e.approved&&e.remarks?((0,s.uX)(),(0,s.CE)("div",rke,[a[112]||(a[112]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",cke,(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",dke,[!0===e.approved||!1===e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",uke,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!0),class:"approve-btn"},a[114]||(a[114]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve ")]),8,pke),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!1),class:"reject-btn"},a[115]||(a[115]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject ")]),8,vke)])),!1!==e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",mke,[a[118]||(a[118]=(0,s.Lk)("label",{for:"remarks"},"Feedback (required for rejection):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"remarks","onUpdate:modelValue":a=>e.remarks=a,class:"remarks-input",placeholder:"Provide feedback explaining why this mitigation was rejected..."},null,8,kke),[[i.Jo,e.remarks]]),(0,s.Lk)("button",{onClick:e=>n.updateRemarks(t),class:"save-remarks-btn"},a[116]||(a[116]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Feedback ")]),8,hke),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!0),class:"change-decision-btn"},a[117]||(a[117]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Approve ")]),8,gke)])),!0!==e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",yke,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(t,!1),class:"change-decision-btn"},a[119]||(a[119]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Reject ")]),8,fke)])),!1===e.approved&&l.reviewCompleted&&e.remarks?((0,s.uX)(),(0,s.CE)("div",bke,[a[120]||(a[120]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-exclamation"}),(0,s.eW)(" Rejection Feedback")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])],8,yme))),128))]),(0,s.Lk)("div",Cke,[a[163]||(a[163]=(0,s.Lk)("h4",null,"Risk Mitigation Questionnaire",-1)),void 0!==l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["approval-status",{approved:l.formDetails.approved,rejected:!1===l.formDetails.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",l.formDetails.approved?"fa-check-circle":"fa-times-circle"])},null,2),(0,s.eW)(" "+(0,d.v_)(l.formDetails.approved?"Questionnaire Approved":"Revisions Requested"),1)],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",Lke,[l.formDetails.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",wke,[a[121]||(a[121]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(l.formDetails.user_submitted_date)),1)])):(0,s.Q3)("",!0),l.formDetails.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",Eke,[a[122]||(a[122]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(l.formDetails.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Rke,[a[125]||(a[125]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"1. What is the cost for this mitigation?")],-1)),(0,s.Lk)("div",Dke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Ike,[a[123]||(a[123]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("cost")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("cost")}])},[a[124]||(a[124]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.cost||"Not specified"),1)],2)])]),(0,s.Lk)("div",Pke,[a[128]||(a[128]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"2. What is the impact for this mitigation?")],-1)),(0,s.Lk)("div",_ke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Ske,[a[126]||(a[126]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("impact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("impact")}])},[a[127]||(a[127]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.impact||"Not specified"),1)],2)])]),(0,s.Lk)("div",Ake,[a[131]||(a[131]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"3. What is the financial impact for this mitigation?")],-1)),(0,s.Lk)("div",Tke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",xke,[a[129]||(a[129]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("financialImpact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("financialImpact")}])},[a[130]||(a[130]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.financialImpact||"Not specified"),1)],2)])]),(0,s.Lk)("div",Fke,[a[134]||(a[134]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"4. What is the reputational impact for this mitigation?")],-1)),(0,s.Lk)("div",Vke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Mke,[a[132]||(a[132]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("reputationalImpact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("reputationalImpact")}])},[a[133]||(a[133]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.reputationalImpact||"Not specified"),1)],2)])]),(0,s.Lk)("div",Xke,[a[137]||(a[137]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"5. What is the Operational Impact for this mitigation?")],-1)),(0,s.Lk)("div",Uke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Nke,[a[135]||(a[135]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("operationalImpact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("operationalImpact")}])},[a[136]||(a[136]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.operationalImpact||"Not specified"),1)],2)])]),(0,s.Lk)("div",$ke,[a[140]||(a[140]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"6. What is the Financial Loss for this mitigation?")],-1)),(0,s.Lk)("div",Oke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",jke,[a[138]||(a[138]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("financialLoss")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("financialLoss")}])},[a[139]||(a[139]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.financialLoss||"Not specified"),1)],2)])]),(0,s.Lk)("div",Bke,[a[143]||(a[143]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"7. What is the expected system downtime (hrs) if this risk occurs?")],-1)),(0,s.Lk)("div",Wke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Qke,[a[141]||(a[141]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("systemDowntime")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("systemDowntime")}])},[a[142]||(a[142]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.systemDowntime||"Not specified"),1)],2)])]),(0,s.Lk)("div",qke,[a[146]||(a[146]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"8. How long did it take to recover last time (hrs)?")],-1)),(0,s.Lk)("div",Kke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Jke,[a[144]||(a[144]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("recoveryTime")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("recoveryTime")}])},[a[145]||(a[145]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.recoveryTime||"Not specified"),1)],2)])]),(0,s.Lk)("div",zke,[a[149]||(a[149]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"9. Is it possible that this risk will recur again?")],-1)),(0,s.Lk)("div",Hke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Yke,[a[147]||(a[147]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("recurrencePossible")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("recurrencePossible")}])},[a[148]||(a[148]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.recurrencePossible||"Not specified"),1)],2)])]),(0,s.Lk)("div",Gke,[a[152]||(a[152]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"10. Is this an Improvement Initiative which will prevent the future recurrence of said risk?")],-1)),(0,s.Lk)("div",Zke,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",ehe,[a[150]||(a[150]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("improvementInitiative")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("improvementInitiative")}])},[a[151]||(a[151]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.improvementInitiative||"Not specified"),1)],2)])]),l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",ahe,[void 0===l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",the,[(0,s.Lk)("button",{onClick:a[20]||(a[20]=e=>n.approveQuestionnaire(!0)),class:"approve-btn"},a[153]||(a[153]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve Questionnaire ")])),(0,s.Lk)("button",{onClick:a[21]||(a[21]=e=>n.approveQuestionnaire(!1)),class:"reject-btn"},a[154]||(a[154]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Request Revisions ")]))])):(0,s.Q3)("",!0),!0===l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",ihe,[a[156]||(a[156]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),a[157]||(a[157]=(0,s.eW)(" Questionnaire Approved ")),(0,s.Lk)("button",{onClick:a[22]||(a[22]=e=>n.approveQuestionnaire(!1)),class:"change-decision-btn"},a[155]||(a[155]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Reject ")]))])):(0,s.Q3)("",!0),!1===l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",she,[a[161]||(a[161]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),a[162]||(a[162]=(0,s.eW)(" Revisions Requested ")),(0,s.Lk)("div",ohe,[a[160]||(a[160]=(0,s.Lk)("label",{for:"questionnaire-remarks"},"Feedback (required):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"questionnaire-remarks","onUpdate:modelValue":a[23]||(a[23]=e=>l.formDetails.remarks=e),class:"remarks-input",placeholder:"Provide feedback on the questionnaire..."},null,512),[[i.Jo,l.formDetails.remarks]]),(0,s.Lk)("div",lhe,[(0,s.Lk)("button",{onClick:a[24]||(a[24]=(...e)=>n.saveQuestionnaireRemarks&&n.saveQuestionnaireRemarks(...e)),class:"save-remarks-btn"},a[158]||(a[158]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Feedback ")])),(0,s.Lk)("button",{onClick:a[25]||(a[25]=e=>n.approveQuestionnaire(!0)),class:"change-decision-btn"},a[159]||(a[159]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Approve ")]))])])])):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",nhe,[(0,s.Lk)("button",{class:"submit-review-btn",disabled:l.reviewCompleted,onClick:a[26]||(a[26]=e=>n.submitReview(!0))},a[164]||(a[164]=[(0,s.Lk)("i",{class:"fas fa-check-double"},null,-1),(0,s.eW)(" Approve Risk ")]),8,rhe),(0,s.Lk)("button",{class:"reject-review-btn",disabled:l.reviewCompleted,onClick:a[27]||(a[27]=e=>n.submitReview(!1))},a[165]||(a[165]=[(0,s.Lk)("i",{class:"fas fa-comment-dots"},null,-1),(0,s.eW)(" Send Feedback to User ")]),8,che),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",dhe," This review has been completed ")):(0,s.Q3)("",!0)])]))])):(0,s.Q3)("",!0)])}var phe={name:"UserTasks",components:{CustomDropdown:mt.A},data(){return{userRisks:[],reviewerTasks:[],users:[],selectedUserId:"",loading:!0,error:null,showMitigationWorkflow:!1,showReviewerWorkflow:!1,loadingMitigations:!1,mitigationSteps:[],selectedRiskId:null,selectedReviewer:"",activeTab:"user",showReviewerModal:!1,mitigationReviewData:{},currentReviewTask:null,userNotifications:[],reviewCompleted:!1,reviewApproved:!1,formDetails:{cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:"",approved:void 0,remarks:"",user_submitted_date:null,reviewer_submitted_date:null},previousVersions:{},previousFormDetails:null,showQuestionnaire:!1,questionnaireDetails:null,allVersions:[],selectedVersions:{},loadingVersions:!1,versionData:{},showVersionDropdowns:!0,globalSelectedVersion:"",allVersionNames:[],userDropdownConfig:{name:"Select User",values:[]}}},computed:{userCount(){return console.log("Current users in data:",this.users.length,this.users),this.users.length},allStepsCompleted(){const e=this.mitigationSteps.filter(e=>!0!==Boolean(e.approved));return e.length>0&&e.every(e=>"Completed"===e.status)},canSubmit(){return!0},canSubmitReview(){return!0},questionnaireReviewed(){return this.latestReview&&this.latestReview.risk_form_details&&(!0===this.latestReview.risk_form_details.approved||!1===this.latestReview.risk_form_details.approved)},questionnaireApproved(){return this.latestReview&&this.latestReview.risk_form_details&&!0===this.latestReview.risk_form_details.approved},questionnaireRejected(){return this.latestReview&&this.latestReview.risk_form_details&&!1===this.latestReview.risk_form_details.approved},questionnaireRemarks(){return this.latestReview&&this.latestReview.risk_form_details&&this.latestReview.risk_form_details.remarks?this.latestReview.risk_form_details.remarks:""},filteredVersions(){return this.allVersions.filter(e=>e.version!==this.currentReviewTask?.version)}},watch:{users:{immediate:!0,handler(e){this.userDropdownConfig.values=[{value:"",label:"All Users"},...e.map(e=>({value:e.user_id,label:`${e.user_name}${e.department?` (${e.department})`:""}`}))]}}},mounted(){this.fetchUsers(),setTimeout(()=>{0===this.users.length&&this.fetchUsers()},500)},methods:{fetchUsers(){console.log("Fetching users..."),this.loading=!0,qe.A.get("http://localhost:8000/api/custom-users/").then(e=>{if(console.log("User data received:",e.data),!(Array.isArray(e.data)&&e.data.length>0))return qe.A.get("http://localhost:8000/api/users-for-dropdown/");this.users=e.data,this.loading=!1}).then(e=>{e&&e.data&&(console.log("User data from dropdown endpoint:",e.data),this.users=e.data),this.loading=!1}).catch(e=>{console.error("Error fetching users:",e),this.error=`Failed to fetch users: ${e.message}`,this.loading=!1})},fetchData(){if(!this.selectedUserId)return this.userRisks=[],void(this.reviewerTasks=[]);this.loading=!0,Promise.all([qe.A.get(`http://localhost:8000/api/user-risks/${this.selectedUserId}/`),qe.A.get(`http://localhost:8000/api/reviewer-tasks/${this.selectedUserId}/`)]).then(([e,a])=>{this.userRisks=e.data,this.reviewerTasks=a.data,this.userRisks.forEach((e,a)=>{qe.A.get(`http://localhost:8000/api/latest-review/${e.RiskInstanceId}/`).then(t=>{if(t.data&&t.data.user_submitted_date){const i=[...this.userRisks];i[a]={...e,last_submitted:t.data.user_submitted_date},this.userRisks=i}else if(t.data&&t.data.submission_date){const i=[...this.userRisks];i[a]={...e,last_submitted:t.data.submission_date},this.userRisks=i}}).catch(a=>{console.error(`Error fetching latest review for risk ${e.RiskInstanceId}:`,a)})}),console.log("User risks:",this.userRisks),this.userRisks.forEach(e=>{"Revision Required"===e.RiskStatus?(e.hasNotification=!0,e.approved=!1):"Approved"===e.RiskStatus&&(e.hasNotification=!0,e.approved=!0)}),this.loading=!1,this.error=null}).catch(e=>{console.error("Error fetching data:",e),this.error=`Failed to fetch data: ${e.message}`,this.loading=!1})},getUserName(e){const a=this.users.find(a=>a.user_id==e);return a?a.user_name:"Unknown"},startWork(e){this.loading=!0,console.log(`Starting work on risk ID: ${e}`);const a={risk_id:e,status:"Work In Progress"};console.log("Sending request data:",a),qe.A.post("http://localhost:8000/api/update-mitigation-status/",a).then(a=>{console.log("Status updated:",a.data);const t=this.userRisks.findIndex(a=>a.RiskInstanceId===e);-1!==t&&(this.userRisks[t].MitigationStatus="Work In Progress"),this.loading=!1}).catch(e=>{console.error("Error updating status:",e),console.error("Error response:",e.response?e.response.data:"No response data"),this.error=`Failed to update status: ${e.message}`,this.loading=!1})},completeMitigation(e){this.loading=!0,qe.A.post("http://localhost:8000/api/update-mitigation-status/",{risk_id:e,status:"Completed"}).then(a=>{console.log("Status updated:",a.data);const t=this.userRisks.findIndex(a=>a.RiskInstanceId===e);-1!==t&&(this.userRisks[t].MitigationStatus="Completed",this.userRisks[t].RiskStatus="Approved"),this.loading=!1,alert("Mitigation marked as completed!")}).catch(e=>{console.error("Error updating status:",e),this.error=`Failed to update status: ${e.message}`,this.loading=!1})},viewMitigations(e){this.selectedRiskId=e,this.loadingMitigations=!0,this.showMitigationWorkflow=!0,qe.A.get(`http://localhost:8000/api/risk-mitigations/${e}/`).then(a=>{console.log("Mitigations received:",a.data),this.mitigationSteps=this.parseMitigations(a.data),qe.A.get(`http://localhost:8000/api/risk-form-details/${e}/`).then(a=>{console.log("Form details received:",a.data),this.formDetails={cost:String(a.data.cost||""),impact:String(a.data.impact||""),financialImpact:String(a.data.financialImpact||""),reputationalImpact:String(a.data.reputationalImpact||""),operationalImpact:String(a.data.operationalImpact||""),financialLoss:String(a.data.financialLoss||""),systemDowntime:String(a.data.systemDowntime||""),recoveryTime:String(a.data.recoveryTime||""),recurrencePossible:a.data.recurrencePossible||"",improvementInitiative:a.data.improvementInitiative||"",approved:a.data.approved,remarks:a.data.remarks||"",user_submitted_date:a.data.user_submitted_date||a.data.submission_date,reviewer_submitted_date:a.data.reviewer_submitted_date},qe.A.get(`http://localhost:8000/api/latest-review/${e}/`).then(a=>{const t=a.data;if(console.log("Latest review data:",t),this.latestReview=t,t&&t.risk_form_details&&(this.formDetails={...this.formDetails,approved:t.risk_form_details.approved,remarks:t.risk_form_details.remarks||"",user_submitted_date:t.user_submitted_date||t.submission_date,reviewer_submitted_date:t.reviewer_submitted_date||t.review_date}),t&&t.mitigations){const e=[];Object.keys(t.mitigations).forEach(a=>{const i=t.mitigations[a];let s;"approved"in i&&(s=!0===i.approved||"true"===i.approved),e.push({title:`Step ${a}`,description:i.description,status:i.status||"Completed",approved:s,remarks:i.remarks||"",comments:i.comments||"",fileData:i.fileData,fileName:i.fileName,user_submitted_date:i.user_submitted_date,reviewer_submitted_date:i.reviewer_submitted_date})}),this.mitigationSteps=e}qe.A.get(`http://localhost:8000/api/get-assigned-reviewer/${e}/`).then(e=>{console.log("Reviewer response:",e.data),e.data&&e.data.reviewer_name?e.data.reviewer_id?(this.selectedReviewer=e.data.reviewer_id,console.log(`Using reviewer ID: ${this.selectedReviewer}`)):(this.selectedReviewer=e.data.reviewer_name,console.log(`No reviewer ID available, using name: ${this.selectedReviewer}`)):(alert("No reviewer has been assigned to this risk yet. Please contact your administrator."),this.selectedReviewer=""),this.loadingMitigations=!1,this.showQuestionnaire=!0}).catch(e=>{console.error("Error fetching assigned reviewer:",e),alert("Could not fetch reviewer information. Please try again later."),this.selectedReviewer="",this.loadingMitigations=!1,this.showQuestionnaire=!0})}).catch(e=>{console.error("Error fetching latest review:",e),this.loadingMitigations=!1,this.showQuestionnaire=!0})}).catch(e=>{console.error("Error fetching form details:",e),this.formDetails={cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:"",approved:void 0,remarks:""},this.loadingMitigations=!1,this.showQuestionnaire=!0})}).catch(e=>{console.error("Error fetching mitigations:",e),this.mitigationSteps=[],this.loadingMitigations=!1,this.showQuestionnaire=!0})},fetchLatestReviewerData(e){qe.A.get(`http://localhost:8000/api/latest-review/${e}/`).then(e=>{if(console.log("Latest review data:",e.data),e.data&&e.data.mitigations){const a=e.data;this.mitigationSteps.forEach((e,t)=>{const i=e.title.replace("Step ","")||(t+1).toString();if(a.mitigations[i]){const t=a.mitigations[i];e.approved=t.approved,e.remarks=t.remarks||"",t.comments&&(e.comments=t.comments),t.fileData&&(e.fileData=t.fileData,e.fileName=t.fileName)}})}this.loadingMitigations=!1}).catch(e=>{console.error("Error fetching review data:",e),this.loadingMitigations=!1})},parseMitigations(e){if(e&&"object"===typeof e&&!Array.isArray(e)){const a=Object.keys(e);if(a.length>0&&!isNaN(Number(a[0]))){const t=[];a.sort((e,a)=>Number(e)-Number(a));for(const i of a)t.push({title:`Step ${i}`,description:e[i],status:"Not Started"});for(const e of t)e.comments=e.comments||"",e.fileData=e.fileData||null,e.fileName=e.fileName||null;return t}}if(Array.isArray(e))return e;if("string"===typeof e)try{const a=JSON.parse(e);return a&&"object"===typeof a&&!Array.isArray(a)?this.parseMitigations(a):Array.isArray(a)?a:[a]}catch(a){return console.error("Error parsing mitigation JSON:",a),[{title:"Mitigation",description:e}]}return[{title:"Mitigation",description:"No detailed mitigation steps available"}]},closeMitigationModal(){this.showMitigationWorkflow=!1,this.mitigationSteps=[],this.selectedRiskId=null},updateStepStatus(e,a){console.log(`Updating step ${e+1} status to ${a}`),this.mitigationSteps[e].status=a},submitForReview(){if(!this.isQuestionnaireComplete())return void alert("Please complete all questionnaire fields before submitting");this.loading=!0;const e={};this.mitigationSteps.forEach((a,t)=>{const i=a.title.replace("Step ","")||(t+1).toString();if(!0===a.approved)e[i]={description:a.description,status:a.status||"Completed",approved:!0,remarks:"",comments:a.comments||"",fileData:a.fileData,fileName:a.fileName};else{const t={description:a.description,status:a.status||"Completed",comments:a.comments||"",fileData:a.fileData,fileName:a.fileName};!1===a.approved&&(t.approved=!1,t.remarks=a.remarks||""),e[i]=t}});const a={...this.formDetails,user_submitted_date:(new Date).toISOString()};console.log(`Submitting for review with reviewer ID: ${this.selectedReviewer}, type: ${typeof this.selectedReviewer}`),qe.A.post("http://localhost:8000/api/assign-reviewer/",{risk_id:this.selectedRiskId,reviewer_id:this.selectedReviewer,user_id:this.selectedUserId,mitigations:e,risk_form_details:a,create_approval_record:!0}).then(e=>{console.log("Submission response:",e.data);const a=this.userRisks.findIndex(e=>e.RiskInstanceId===this.selectedRiskId);-1!==a&&(this.userRisks[a].MitigationStatus="Under Review",this.userRisks[a].RiskStatus="Revision Required by Reviewer"),this.loading=!1,this.closeMitigationModal(),alert("Risk submitted for review successfully!")}).catch(e=>{console.error("Error submitting for review:",e),this.loading=!1,alert("Failed to submit for review. Please try again.")})},closeReviewerModal(){this.showReviewerWorkflow=!1,this.currentReviewTask=null,this.mitigationReviewData={},this.previousVersions={},this.previousFormDetails=null,this.reviewCompleted=!1,this.reviewApproved=!1,this.allVersions=[],this.selectedVersions={},this.versionData={},this.loadingVersions=!1},approveMitigation(e,a){const t={...this.mitigationReviewData[e],approved:a,reviewer_submitted_date:(new Date).toISOString()};a&&(t.remarks=""),this.mitigationReviewData={...this.mitigationReviewData,[e]:t};const i=document.querySelector(`.mitigation-review-item[data-id="${e}"]`);if(i){const e=i.querySelector(".mitigation-status-badge");e&&(e.className="mitigation-status-badge "+(a?"approved":"rejected"),e.innerHTML=a?'<i class="fas fa-check-circle"></i> Approved':'<i class="fas fa-times-circle"></i> Rejected')}},submitReview(e){this.loading=!0;const a={approval_id:this.currentReviewTask.RiskInstanceId,risk_id:this.currentReviewTask.RiskInstanceId,approved:e,mitigations:this.mitigationReviewData,risk_form_details:{...this.formDetails,approved:this.formDetails.approved,remarks:this.formDetails.remarks||""}};console.log("SUBMITTING REVIEW DATA:",JSON.stringify(a,null,2)),qe.A.post("http://localhost:8000/api/complete-review/",a).then(a=>{console.log("Review completed:",a.data),this.loading=!1;const t=this.reviewerTasks.findIndex(e=>e.RiskInstanceId===this.currentReviewTask.RiskInstanceId);if(-1!==t&&this.reviewerTasks.splice(t,1),this.reviewCompleted=!0,this.reviewApproved=e,-1!==t){const a=e?"Approved":"Revision Required by User";this.currentReviewTask.RiskStatus=a,this.currentReviewTask.MitigationStatus=e?"Completed":"Revision Required"}alert(`Risk ${e?"approved":"rejected"} successfully!`),setTimeout(()=>{this.closeReviewerModal()},2500)}).catch(e=>{console.error("Error completing review:",e),this.loading=!1,alert("Failed to submit review. Please try again.")})},updateRemarks(e){this.mitigationReviewData[e].remarks.trim()?(this.mitigationReviewData={...this.mitigationReviewData},console.log(`Mitigation ${e} remarks updated successfully`)):alert("Please provide remarks for rejection")},handleFileUpload(e,a){const t=e.target.files[0];if(!t)return;if(t.size>5242880)return alert("File size exceeds 5MB limit"),void(e.target.value="");const i=new FileReader;i.onload=e=>{this.mitigationSteps[a].fileData=e.target.result,this.mitigationSteps[a].fileName=t.name;const i=new FormData;i.append("file",t),i.append("userId",this.selectedUserId||"default-user"),i.append("fileName",t.name),i.append("riskId",this.selectedRiskId),i.append("category",this.userRisks.find(e=>e.RiskInstanceId===this.selectedRiskId)?.Category||"general"),i.append("mitigationNumber",a+1),qe.A.post("http://localhost:5000/api/upload",i,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log("File uploaded successfully to S3:",e.data),e.data.success?(this.mitigationSteps[a].savedFileName=e.data.file.fileName,this.mitigationSteps[a].s3FileInfo=e.data.file,this.mitigationSteps[a].s3Url=e.data.file.url,alert("File uploaded successfully")):(console.error("S3 upload returned error:",e.data),alert("Error uploading file. Please try again."))}).catch(e=>{console.error("Error uploading file to S3:",e),alert("Error uploading file. Please try again.")})},i.readAsDataURL(t)},removeFile(e){if(this.mitigationSteps[e].s3FileInfo&&this.mitigationSteps[e].s3FileInfo.id){const a=this.mitigationSteps[e].s3FileInfo.id;qe.A.delete(`http://localhost:5000/api/file/${a}`).then(a=>{console.log("File deleted from S3:",a.data),this.mitigationSteps[e].fileData=null,this.mitigationSteps[e].fileName=null,this.mitigationSteps[e].s3FileInfo=null,this.mitigationSteps[e].s3Url=null,document.getElementById(`file-upload-${e}`).value=""}).catch(a=>{console.error("Error deleting file from S3:",a),alert("Error removing file. The file preview will be cleared, but the file may still exist on the server."),this.mitigationSteps[e].fileData=null,this.mitigationSteps[e].fileName=null,this.mitigationSteps[e].s3FileInfo=null,this.mitigationSteps[e].s3Url=null,document.getElementById(`file-upload-${e}`).value=""})}else this.mitigationSteps[e].fileData=null,this.mitigationSteps[e].fileName=null,this.mitigationSteps[e].s3FileInfo=null,this.mitigationSteps[e].s3Url=null,document.getElementById(`file-upload-${e}`).value=""},fetchReviewerComments(e){qe.A.get(`http://localhost:8000/api/reviewer-comments/${e}/`).then(a=>{const t=this.userRisks.findIndex(a=>a.RiskInstanceId===e);if(-1!==t){const e=[...this.userRisks];e[t]={...this.userRisks[t],reviewerComments:a.data},this.userRisks=e}}).catch(e=>{console.error("Error fetching reviewer comments:",e)})},getStatusClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("approved")?"status-approved":a.includes("revision required by user")?"status-revision-user":a.includes("revision required by reviewer")?"status-revision-reviewer":a.includes("revision")?"status-revision":a.includes("under review")?"status-review":a.includes("progress")?"status-progress":""},completeStep(e){this.isStepLocked(e)||(this.mitigationSteps[e].status="Completed",this.$nextTick(()=>{setTimeout(()=>{const e=document.querySelector(".timeline");e&&(e.classList.add("step-completed"),setTimeout(()=>{e.classList.remove("step-completed")},1e3))},50)}))},resetStep(e){this.mitigationSteps[e].status="In Progress"},isStepActive(e){if(!1===this.mitigationSteps[e].approved)return!0;for(let a=0;a<e;a++)if("Completed"!==this.mitigationSteps[a].status)return!1;return"Completed"!==this.mitigationSteps[e].status},isStepLocked(e){if(0===e)return!1;for(let a=0;a<e;a++)if("Completed"!==this.mitigationSteps[a].status)return!0;return!1},formatDate(e){if(!e)return"Not set";const a=new Date(e);return a.toLocaleDateString()},getDueStatusClass(e){if(!e)return"";const a=new Date(e),t=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);const i=Math.floor((a-t)/864e5);return i<0?"risk-workflow-overdue":i<=3?"risk-workflow-urgent":i<=7?"risk-workflow-warning":"risk-workflow-on-track"},getDueStatusText(e){if(!e)return"";const a=new Date(e),t=new Date;a.setHours(0,0,0,0),t.setHours(0,0,0,0);const i=Math.floor((a-t)/864e5);return i<0?`(Delayed by ${Math.abs(i)} days)`:0===i?"(Due today)":1===i?"(Due tomorrow)":`(${i} days left)`},getMitigationStatusClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("completed")?"risk-workflow-status-completed":a.includes("progress")?"risk-workflow-status-progress":a.includes("revision")?"risk-workflow-status-revision":a.includes("yet to start")?"risk-workflow-status-not-started":""},hasApprovalVersion(e){try{if(e.ExtractedInfo){const a=JSON.parse(e.ExtractedInfo);return a&&a.version}}catch(a){console.error("Error checking approval version:",a)}return!1},isQuestionnaireComplete(){return!0},validateQuestionnaire(){},async reviewMitigations(e){this.currentReviewTask=e,this.selectedRiskId=e.RiskInstanceId,this.loadingMitigations=!0,this.showReviewerWorkflow=!0,this.previousVersions={};try{const a=JSON.parse(e.ExtractedInfo);if(console.log("Extracted info:",a),a&&a.mitigations){if(this.mitigationReviewData=a.mitigations,a.risk_form_details){const e=a.risk_form_details;this.formDetails={cost:String(e.cost??""),impact:String(e.impact??""),financialImpact:String(e.financialImpact??e.financialimpact??""),reputationalImpact:String(e.reputationalImpact??e.reputationalimpact??""),operationalImpact:String(e.operationalImpact??e.operationalimpact??""),financialLoss:String(e.financialLoss??e.financialloss??""),systemDowntime:String(e.systemDowntime??e.expecteddowntime??""),recoveryTime:String(e.recoveryTime??e.recoverytime??""),recurrencePossible:e.recurrencePossible??e.riskrecurrence??"",improvementInitiative:e.improvementInitiative??e.improvementinitiative??"",approved:e.approved,remarks:e.remarks||"",user_submitted_date:e.user_submitted_date||a.user_submitted_date,reviewer_submitted_date:e.reviewer_submitted_date}}else this.formDetails={cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:"",approved:void 0,remarks:""};e.PreviousVersion&&e.PreviousVersion.mitigations&&(this.previousVersions=e.PreviousVersion.mitigations,e.PreviousVersion.risk_form_details&&(this.previousFormDetails=e.PreviousVersion.risk_form_details));const t="Approved"===e.RiskStatus||"Revision Required"===e.RiskStatus;this.reviewCompleted=t,this.reviewApproved="Approved"===e.RiskStatus,await this.fetchAllVersions(),this.loadingMitigations=!1}else this.mitigationReviewData={},console.error("No mitigations found in ExtractedInfo"),this.loadingMitigations=!1}catch(a){console.error("Error parsing ExtractedInfo:",a),this.mitigationReviewData={},this.loadingMitigations=!1}},approveQuestionnaire(e){this.formDetails.approved=e,this.formDetails.reviewer_submitted_date=(new Date).toISOString(),e||this.formDetails.remarks||(this.formDetails.remarks=""),e&&(this.formDetails.remarks="")},saveQuestionnaireRemarks(){!1!==this.formDetails.approved||this.formDetails.remarks.trim()?alert("Questionnaire feedback saved"):alert("Please provide feedback for the questionnaire")},formatDateTime(e){if(!e)return"N/A";try{const a=new Date(e);return a.toLocaleString()}catch(a){return"Invalid Date"}},getSubmissionDate(e){try{if(e.ExtractedInfo){const a=JSON.parse(e.ExtractedInfo);return a.user_submitted_date||a.submission_date}}catch(a){console.error("Error parsing submission date:",a)}return null},getPreviousMitigation(e){return this.previousVersions&&this.previousVersions[e]?this.previousVersions[e]:null},getPreviousFormDetail(e){return this.previousFormDetails?this.previousFormDetails[e]||"Not specified":null},hasFormFieldChanged(e){if(!this.previousFormDetails)return!1;const a=this.previousFormDetails[e]||"",t=this.formDetails[e]||"";return a!==t},getFieldLabel(e){const a={cost:"Cost for Mitigation",impact:"Impact for Mitigation",financialImpact:"Financial Impact",reputationalImpact:"Reputational Impact"};return a[e]||e},fetchQuestionnaire(e){qe.A.get(`http://localhost:8000/api/risk-instances/${e}/`).then(e=>{let a=e.data.RiskFormDetails;if("string"===typeof a)try{a=JSON.parse(a)}catch{a={}}this.questionnaireDetails=this.mapRiskFormDetails(a),this.showQuestionnaire=!0})},mapRiskFormDetails(e){if(!e)return{cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:""};function a(e){if(!e)return"";if("string"===typeof e){if("yes"===e.toLowerCase())return"Yes";if("no"===e.toLowerCase())return"No";if("unknown"===e.toLowerCase())return"Unknown"}return e}return{cost:e.cost??"",impact:e.impact??"",financialImpact:e.financialImpact??e.financialimpact??"",reputationalImpact:e.reputationalImpact??e.reputationalimpact??"",operationalImpact:e.operationalImpact??e.operationalimpact??"",financialLoss:e.financialLoss??e.financialloss??"",systemDowntime:e.systemDowntime??e.expecteddowntime??"",recoveryTime:e.recoveryTime??e.recoverytime??"",recurrencePossible:a(e.recurrencePossible??e.riskrecurrence),improvementInitiative:a(e.improvementInitiative??e.improvementinitiative)}},navigateTo(e){const a=document.querySelectorAll(".toggle-button");a.forEach(e=>e.classList.remove("active"));const t=Array.from(a).find(a=>a.textContent.trim().toLowerCase().includes(e));switch(t&&t.classList.add("active"),e){case"resolution":this.$router.push("/risk/resolution");break;case"workflow":break}},async onGlobalVersionChange(){if(console.log("Global version changed to:",this.globalSelectedVersion),!this.globalSelectedVersion)return console.log("No version selected, clearing selections"),void(this.selectedVersions={});this.loadingVersions=!0;try{const a=this.currentReviewTask?.RiskInstanceId||this.selectedRiskId;console.log("Fetching version details for:",this.globalSelectedVersion);const t=await fetch(`http://localhost:8000/api/risk/${a}/version/${this.globalSelectedVersion}/`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const i=await t.json();if(console.log("Received version details:",i),i.success&&i.version_data&&i.version_data.ExtractedInfo){let a;try{a="string"===typeof i.version_data.ExtractedInfo?JSON.parse(i.version_data.ExtractedInfo):i.version_data.ExtractedInfo}catch(e){console.error("Error parsing ExtractedInfo:",e),a={mitigations:{},risk_form_details:{}}}Object.keys(this.mitigationReviewData).forEach(e=>{this.selectedVersions={...this.selectedVersions,[e]:this.globalSelectedVersion};const t=a.mitigations?.[e]||{};let s="";t.remarks?s=t.remarks:t.reviewer_feedback?s=t.reviewer_feedback:i.version_data.ReviewerFeedback?s=i.version_data.ReviewerFeedback:a.reviewer_feedback&&(s=a.reviewer_feedback);const o=`${e}_${this.globalSelectedVersion}`;this.versionData={...this.versionData,[o]:{...t,version:this.globalSelectedVersion,RiskInstanceId:i.version_data.RiskInstanceId,UserId:i.version_data.UserId,ApproverId:i.version_data.ApproverId,Date:i.version_data.Date,formatted_date:i.version_data.formatted_date,approved:"Approved"===i.version_data.ApprovedRejected||"Rejected"!==i.version_data.ApprovedRejected&&void 0,reviewer_feedback:s}}}),console.log("Updated version data for all mitigations")}}catch(e){console.error("Error in global version change:",e),alert("Failed to load version data. Please try again.")}finally{this.loadingVersions=!1}},async fetchAllVersions(){if(!this.showReviewerWorkflow)return void console.log("Not in reviewer workflow, skipping version fetch");const e=this.currentReviewTask?.RiskInstanceId||this.selectedRiskId;if(e){console.log("\n=== FETCHING ALL VERSIONS ==="),console.log(`Risk ID: ${e}`),console.log(`API URL: http://localhost:8000/api/risk/${e}/versions/`),console.log("Current mitigation review data keys:",Object.keys(this.mitigationReviewData)),this.loadingVersions=!0;try{console.log("Making API call...");const a=await fetch(`http://localhost:8000/api/risk/${e}/versions/`);if(console.log("Response status:",a.status),console.log("Response ok:",a.ok),!a.ok){const e=await a.text();throw console.error("API Error Response:",e),new Error(`HTTP error! status: ${a.status}, response: ${e}`)}const t=await a.json();console.log("Full API Response:",t),console.log("Response type:",typeof t),console.log("Response keys:",Object.keys(t||{}));const i=t.versions||t||[];console.log("Extracted versions:",i),console.log("Total versions received:",i.length),console.log("Versions array type:",Array.isArray(i)),t.version_names&&Array.isArray(t.version_names)?(this.allVersionNames=t.version_names.filter(e=>e&&e.toString().startsWith("R")),console.log("Using filtered R version_names from API response:",this.allVersionNames)):(this.allVersionNames=i.map(e=>e.version).filter(e=>e&&e.toString().startsWith("R")),console.log("Extracted filtered R version names from versions array:",this.allVersionNames)),i&&i.length>0?(this.allVersions=i,console.log("Set allVersions to:",this.allVersions),i.forEach((e,a)=>{console.log(`Version ${a+1}:`,{version:e.version,RiskInstanceId:e.RiskInstanceId,UserId:e.UserId,ApproverId:e.ApproverId,Date:e.Date,ApprovedRejected:e.ApprovedRejected,mitigationCount:e.mitigations?Object.keys(e.mitigations).length:0,formDetailsCount:e.risk_form_details?Object.keys(e.risk_form_details).length:0})}),Object.keys(this.mitigationReviewData).forEach(e=>{this.selectedVersions[e]||(this.selectedVersions={...this.selectedVersions,[e]:""})}),console.log("Final selectedVersions state:",this.selectedVersions),console.log("Final allVersions length:",this.allVersions.length),console.log("Final allVersionNames:",this.allVersionNames)):(console.log("No versions found or empty array"),console.log("Setting allVersions to empty array"),this.allVersions=[],this.allVersionNames=[])}catch(a){console.error("ERROR fetching versions:",a),console.error("Error type:",a.constructor.name),console.error("Error message:",a.message),console.error("Error stack:",a.stack),a.response&&(console.error("Response data:",a.response.data),console.error("Response status:",a.response.status)),this.allVersions=[],this.allVersionNames=[]}finally{this.loadingVersions=!1,console.log("fetchAllVersions completed. Final allVersions length:",this.allVersions.length),console.log("Final allVersionNames:",this.allVersionNames)}}else console.log("No risk ID available for fetching versions")},async fetchVersionDetails(e,a){console.log("\n=== FETCH VERSION DETAILS ==="),console.log(`Risk ID: ${e}`),console.log(`Version: ${a}`);try{const t=await qe.A.get(`http://localhost:8000/api/risk/${e}/version/${a}/`);return console.log("API Response:",t.data),t.data.success?(console.log("Version data successfully retrieved"),console.log("Version data keys:",Object.keys(t.data.version_data)),t.data.version_data.ExtractedInfo&&(console.log("ExtractedInfo keys:",Object.keys(t.data.version_data.ExtractedInfo)),t.data.version_data.ExtractedInfo.mitigations&&console.log("Available mitigations:",Object.keys(t.data.version_data.ExtractedInfo.mitigations))),t.data.version_data.ExtractedInfo||t.data.version_data):(console.log("API returned success: false"),null)}catch(t){return console.error(`Error fetching version ${a}:`,t),console.error("Error response:",t.response?.data),null}},async onVersionChange(e,a){if(console.log("Version changed for mitigation:",e,"to version:",a),!a)return void console.log("No version selected, clearing data");const t=`${e}_${a}`;if(this.versionData[t])console.log("Version data already loaded for:",t);else try{const s=this.currentReviewTask?.RiskInstanceId||this.selectedRiskId;console.log("Fetching version details for:",a,"with risk ID:",s);const o=await fetch(`http://localhost:8000/api/risk/${s}/version/${a}/`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=await o.json();if(console.log("Received version details:",l),l.success&&l.version_data&&l.version_data.ExtractedInfo){let s;try{s="string"===typeof l.version_data.ExtractedInfo?JSON.parse(l.version_data.ExtractedInfo):l.version_data.ExtractedInfo}catch(i){console.error("Error parsing ExtractedInfo:",i),s={mitigations:{},risk_form_details:{}}}const o=s.mitigations[e]||{};console.log("Mitigation data for",e,":",o);let n="";o.remarks?n=o.remarks:o.reviewer_feedback?n=o.reviewer_feedback:l.version_data.ReviewerFeedback?n=l.version_data.ReviewerFeedback:s.reviewer_feedback&&(n=s.reviewer_feedback),console.log("Extracted reviewer feedback:",n),this.versionData={...this.versionData,[t]:{...o,version:a,RiskInstanceId:l.version_data.RiskInstanceId,UserId:l.version_data.UserId,ApproverId:l.version_data.ApproverId,Date:l.version_data.Date,formatted_date:l.version_data.formatted_date,approved:"Approved"===l.version_data.ApprovedRejected||"Rejected"!==l.version_data.ApprovedRejected&&void 0,reviewer_feedback:n}},console.log("Stored version data:",this.versionData[t])}}catch(i){console.error("Error fetching version details:",i),this.$toast?this.$toast.error("Failed to load version details. Please try again."):console.error("Failed to load version details. Please try again.")}},getVersionDisplayData(e,a){return"current"===a?this.mitigationReviewData[e]:this.versionData[`${e}_${a}`]||{}},getVersionOptions(){const e=[{value:"current",label:"Current Version"}];return this.allVersions.forEach(a=>{a.version!==this.currentReviewTask?.version&&e.push({value:a.version,label:`Version ${a.version} (${this.formatDateTime(a.formatted_date)})`})}),e},getAllVersionsExceptCurrent(){if(!this.allVersions||0===this.allVersions.length)return[];let e=null;if(this.currentReviewTask&&this.currentReviewTask.ExtractedInfo)try{const a="string"===typeof this.currentReviewTask.ExtractedInfo?JSON.parse(this.currentReviewTask.ExtractedInfo):this.currentReviewTask.ExtractedInfo;a.version&&(e=a.version)}catch(t){console.error("Error parsing current task ExtractedInfo:",t)}if(!e&&this.allVersions.length>0){const a=[...this.allVersions].sort((e,a)=>{const t=e=>{const a=e.match(/\d+/);return a?parseInt(a[0]):0};return t(a.version)-t(e.version)});e=a[0].version}console.log("Current version identified as:",e),console.log("All versions:",this.allVersions.map(e=>e.version));const a=this.allVersions.filter(a=>a.version!==e);return console.log("Filtered versions (excluding current):",a.map(e=>e.version)),a},getSelectedVersionData(e,a){return this.versionData[`${e}_${a}`]||{}},getCurrentVersionLabel(){if(!this.allVersions||0===this.allVersions.length)return"Current";let e=null;if(this.currentReviewTask&&this.currentReviewTask.ExtractedInfo)try{const a="string"===typeof this.currentReviewTask.ExtractedInfo?JSON.parse(this.currentReviewTask.ExtractedInfo):this.currentReviewTask.ExtractedInfo;a.version&&(e=a.version)}catch(t){console.error("Error parsing current task ExtractedInfo:",t)}if(!e&&this.allVersions.length>0){const a=[...this.allVersions].sort((e,a)=>{const t=e=>{const a=e.match(/\d+/);return a?parseInt(a[0]):0};return t(a.version)-t(e.version)});e=a[0].version}const a=this.allVersions.find(a=>a.version===e);return a&&a.formatted_date?`Version ${e} (${this.formatDateTime(a.formatted_date)})`:a&&a.Date?`Version ${e} (${this.formatDateTime(a.Date)})`:`Version ${e||"Current"}`},getVersionStatus(e){return"Approved"===e.ApprovedRejected?"Approved":"Rejected"===e.ApprovedRejected?"Rejected":!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending"}}};const vhe=(0,se.A)(phe,[["render",uhe],["__scopeId","data-v-9d99aefa"]]);var mhe=vhe;const khe={class:"tailoring-risk-container"},hhe={key:0,class:"tailoring-risk-loading-overlay"},ghe={class:"tailoring-risk-loading-spinner"},yhe={class:"tailoring-risk-form-group tailoring-risk-id-container"},fhe={class:"tailoring-risk-dropdown-container"},bhe=["value"],Che={class:"tailoring-risk-form-row"},Lhe={class:"tailoring-risk-form-group"},whe={class:"tailoring-risk-form-group"},Ehe={class:"tailoring-risk-form-row"},Rhe={class:"tailoring-risk-form-group"},Dhe={class:"tailoring-risk-form-group"},Ihe={class:"tailoring-risk-category-container"},Phe={class:"tailoring-risk-category-dropdown"},_he={key:0},She={key:1},Ahe={key:0,class:"tailoring-risk-category-options"},The={class:"tailoring-risk-category-search"},xhe={class:"tailoring-risk-category-list"},Fhe=["onClick"],Vhe=["checked","onClick"],Mhe={class:"tailoring-risk-form-row"},Xhe={class:"tailoring-risk-form-group"},Uhe={class:"tailoring-risk-form-group"},Nhe={class:"tailoring-risk-form-row"},$he={class:"tailoring-risk-form-group"},Ohe={class:"tailoring-risk-form-group"},jhe={class:"tailoring-risk-form-row"},Bhe={class:"tailoring-risk-form-group"},Whe={class:"tailoring-risk-form-group"},Qhe={class:"tailoring-risk-business-impact-container"},qhe={class:"tailoring-risk-business-impact-dropdown"},Khe={key:0},Jhe={key:1},zhe={key:0,class:"tailoring-risk-business-impact-options"},Hhe={class:"tailoring-risk-business-impact-search"},Yhe={class:"tailoring-risk-business-impact-list"},Ghe=["onClick"],Zhe=["checked","onClick"],ege={class:"tailoring-risk-selected-impacts-display"},age=["onClick"],tge={class:"tailoring-risk-modal-form-group"},ige={class:"tailoring-risk-modal-actions"},sge=["disabled"],oge={class:"tailoring-risk-modal-form-group"},lge={class:"tailoring-risk-modal-actions"},nge=["disabled"],rge={class:"tailoring-risk-form-row"},cge={class:"tailoring-risk-form-group"},dge={class:"tailoring-risk-form-group"},uge={class:"tailoring-risk-form-group"},pge={class:"tailoring-risk-form-actions"},vge=["disabled"];function mge(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",khe,[(0,s.bF)(r),a[78]||(a[78]=(0,s.Lk)("h2",{class:"tailoring-risk-title"},"Tailoring Risk",-1)),o.isLoading?((0,s.uX)(),(0,s.CE)("div",hhe,[(0,s.Lk)("div",ghe,[a[35]||(a[35]=(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.loadingMessage),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("form",{onSubmit:a[34]||(a[34]=(0,i.D$)((...e)=>o.saveRisk&&o.saveRisk(...e),["prevent"])),class:"tailoring-risk-form"},[(0,s.Lk)("div",yhe,[a[37]||(a[37]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-hashtag"}),(0,s.eW)(" Select Existing Risk (Optional):")],-1)),(0,s.Lk)("div",fhe,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>o.selectedRiskId=e),onChange:a[1]||(a[1]=(...e)=>o.onRiskSelected&&o.onRiskSelected(...e)),class:"tailoring-risk-form-control"},[a[36]||(a[36]=(0,s.Lk)("option",{value:""},"Select a risk to edit...",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.allRisks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.RiskId,value:e.RiskId}," ID: "+(0,d.v_)(e.RiskId)+" - "+(0,d.v_)(e.RiskTitle)+" ("+(0,d.v_)(e.Criticality)+") ",9,bhe))),128))],544),[[i.u1,o.selectedRiskId]])]),a[38]||(a[38]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Choose an existing risk to use as a template for creating a new one",-1))]),(0,s.Lk)("div",Che,[(0,s.Lk)("div",Lhe,[a[39]||(a[39]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-heading"}),(0,s.eW)(" Risk Title:")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>o.risk.RiskTitle=e),class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.RiskTitle]]),a[40]||(a[40]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Provide a brief, descriptive title for this risk",-1))]),(0,s.Lk)("div",whe,[a[41]||(a[41]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-clipboard-check"}),(0,s.eW)(" Compliance ID:")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=e=>o.risk.ComplianceId=e),class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.ComplianceId]]),a[42]||(a[42]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Enter the compliance framework identifier for this risk",-1))])]),(0,s.Lk)("div",Ehe,[(0,s.Lk)("div",Rhe,[a[44]||(a[44]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Criticality:")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>o.risk.Criticality=e),class:"tailoring-risk-form-control"},a[43]||(a[43]=[(0,s.Fv)('<option value="">Select Criticality</option><option value="Low">Low</option><option value="Medium">Medium</option><option value="High">High</option><option value="Critical">Critical</option>',5)]),512),[[i.u1,o.risk.Criticality]]),a[45]||(a[45]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Choose the severity level of this risk",-1))]),(0,s.Lk)("div",Dhe,[a[48]||(a[48]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-tag"}),(0,s.eW)(" Category:")],-1)),(0,s.Lk)("div",Ihe,[(0,s.Lk)("div",Phe,[(0,s.Lk)("div",{class:"tailoring-risk-selected-category",onClick:a[5]||(a[5]=(...e)=>o.toggleCategoryDropdown&&o.toggleCategoryDropdown(...e))},[o.selectedCategory?((0,s.uX)(),(0,s.CE)("span",She,(0,d.v_)(o.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",_he,"Select Category")),a[46]||(a[46]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),o.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",Ahe,[(0,s.Lk)("div",The,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=e=>o.categorySearch=e),placeholder:"Search categories...",onClick:a[7]||(a[7]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,o.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"tailoring-risk-add-category-btn",onClick:a[8]||(a[8]=(0,i.D$)(e=>o.showAddCategoryModal=!0,["stop","prevent"]))},a[47]||(a[47]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",xhe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"tailoring-risk-category-item",onClick:(0,i.D$)(a=>o.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:o.selectedCategory===e.value,onClick:(0,i.D$)(a=>o.selectCategory(e),["stop"])},null,8,Vhe),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Fhe))),128))])])):(0,s.Q3)("",!0)])]),a[49]||(a[49]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Categorize this risk for better organization and management",-1))])]),(0,s.Lk)("div",Mhe,[(0,s.Lk)("div",Xhe,[a[51]||(a[51]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-list"}),(0,s.eW)(" Risk Type:")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[9]||(a[9]=e=>o.risk.RiskType=e),class:"tailoring-risk-form-control"},a[50]||(a[50]=[(0,s.Fv)('<option value="">Select Risk Type</option><option value="Current">Current</option><option value="Residual">Residual</option><option value="Inherent">Inherent</option><option value="Emerging">Emerging</option><option value="Accept">Accept</option>',6)]),512),[[i.u1,o.risk.RiskType]]),a[52]||(a[52]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Classify the nature and timing of this risk",-1))]),(0,s.Lk)("div",Uhe,[a[54]||(a[54]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-flag"}),(0,s.eW)(" Risk Priority:")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[10]||(a[10]=e=>o.risk.RiskPriority=e),class:"tailoring-risk-form-control"},a[53]||(a[53]=[(0,s.Lk)("option",{value:""},"Select Priority",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"High"},"High",-1)]),512),[[i.u1,o.risk.RiskPriority]]),a[55]||(a[55]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Set the priority level for risk treatment and response",-1))])]),(0,s.Lk)("div",Nhe,[(0,s.Lk)("div",$he,[a[56]||(a[56]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-bomb"}),(0,s.eW)(" Risk Impact (1-10):")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[11]||(a[11]=e=>o.risk.RiskImpact=e),min:"1",max:"10",class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.RiskImpact,void 0,{number:!0}]]),a[57]||(a[57]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)",-1))]),(0,s.Lk)("div",Ohe,[a[58]||(a[58]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)(" Risk Likelihood (1-10):")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[12]||(a[12]=e=>o.risk.RiskLikelihood=e),min:"1",max:"10",class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.RiskLikelihood,void 0,{number:!0}]]),a[59]||(a[59]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)",-1))])]),(0,s.Lk)("div",jhe,[(0,s.Lk)("div",Bhe,[a[60]||(a[60]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-tachometer-alt"}),(0,s.eW)(" Risk Exposure Rating:")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[13]||(a[13]=e=>o.risk.RiskExposureRating=e),class:"tailoring-risk-form-control",readonly:""},null,512),[[i.Jo,o.risk.RiskExposureRating,void 0,{number:!0}]]),a[61]||(a[61]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Automatically calculated as Likelihood Ã— Impact",-1))]),(0,s.Lk)("div",Whe,[a[64]||(a[64]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Impact:")],-1)),(0,s.Lk)("div",Qhe,[(0,s.Lk)("div",qhe,[(0,s.Lk)("div",{class:"tailoring-risk-selected-impacts",onClick:a[14]||(a[14]=(...e)=>o.toggleBusinessImpactDropdown&&o.toggleBusinessImpactDropdown(...e))},[0===o.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",Khe,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",Jhe,(0,d.v_)(o.selectedBusinessImpacts.length)+" impact(s) selected",1)),a[62]||(a[62]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),o.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",zhe,[(0,s.Lk)("div",Hhe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[15]||(a[15]=e=>o.businessImpactSearch=e),placeholder:"Search impacts...",onClick:a[16]||(a[16]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,o.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"tailoring-risk-add-impact-btn",onClick:a[17]||(a[17]=(0,i.D$)(e=>o.showAddImpactModal=!0,["stop","prevent"]))},a[63]||(a[63]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",Yhe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"tailoring-risk-business-impact-item",onClick:(0,i.D$)(a=>o.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",checked:o.isBusinessImpactSelected(e),onClick:(0,i.D$)(a=>o.toggleBusinessImpact(e),["stop"])},null,8,Zhe),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Ghe))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",ege,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"tailoring-risk-selected-impact-tag"},[(0,s.eW)((0,d.v_)(e.value)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:a=>o.toggleBusinessImpact(e)},null,8,age)]))),128))])]),a[65]||(a[65]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Select the business areas that would be affected by this risk",-1))])]),o.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"tailoring-risk-modal-overlay",onClick:a[23]||(a[23]=(0,i.D$)(e=>o.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"tailoring-risk-modal-content",onClick:a[22]||(a[22]=(0,i.D$)(()=>{},["stop"]))},[a[67]||(a[67]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:a[21]||(a[21]=(0,i.D$)((...e)=>o.addNewBusinessImpact&&o.addNewBusinessImpact(...e),["prevent"])),class:"tailoring-risk-modal-form"},[(0,s.Lk)("div",tge,[a[66]||(a[66]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[18]||(a[18]=e=>o.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:a[19]||(a[19]=(0,i.jR)((0,i.D$)((...e)=>o.addNewBusinessImpact&&o.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,o.newBusinessImpact]])]),(0,s.Lk)("div",ige,[(0,s.Lk)("button",{type:"button",class:"tailoring-risk-cancel-btn",onClick:a[20]||(a[20]=(0,i.D$)(e=>o.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"tailoring-risk-add-btn",disabled:!o.newBusinessImpact.trim()}," Add Impact ",8,sge)])],32)])])):(0,s.Q3)("",!0),o.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"tailoring-risk-modal-overlay",onClick:a[29]||(a[29]=(0,i.D$)(e=>o.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"tailoring-risk-modal-content",onClick:a[28]||(a[28]=(0,i.D$)(()=>{},["stop"]))},[a[69]||(a[69]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:a[27]||(a[27]=(0,i.D$)((...e)=>o.addNewCategory&&o.addNewCategory(...e),["prevent"])),class:"tailoring-risk-modal-form"},[(0,s.Lk)("div",oge,[a[68]||(a[68]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[24]||(a[24]=e=>o.newCategory=e),placeholder:"Enter new category",onKeyup:a[25]||(a[25]=(0,i.jR)((0,i.D$)((...e)=>o.addNewCategory&&o.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,o.newCategory]])]),(0,s.Lk)("div",lge,[(0,s.Lk)("button",{type:"button",class:"tailoring-risk-cancel-btn",onClick:a[26]||(a[26]=(0,i.D$)(e=>o.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"tailoring-risk-add-btn",disabled:!o.newCategory.trim()}," Add Category ",8,nge)])],32)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",rge,[(0,s.Lk)("div",cge,[a[70]||(a[70]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Possible Damage:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[30]||(a[30]=e=>o.risk.PossibleDamage=e),rows:"4",class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.PossibleDamage]]),a[71]||(a[71]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Describe the potential damage or consequences if this risk materializes",-1))]),(0,s.Lk)("div",dge,[a[72]||(a[72]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-align-left"}),(0,s.eW)(" Risk Description:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[31]||(a[31]=e=>o.risk.RiskDescription=e),rows:"4",class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.RiskDescription]]),a[73]||(a[73]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Provide a detailed description of the risk, its context, and contributing factors",-1))]),(0,s.Lk)("div",uge,[a[74]||(a[74]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Risk Mitigation:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[32]||(a[32]=e=>o.risk.RiskMitigation=e),rows:"4",class:"tailoring-risk-form-control"},null,512),[[i.Jo,o.risk.RiskMitigation]]),a[75]||(a[75]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Describe the strategies and measures to reduce or eliminate this risk",-1))])]),(0,s.Lk)("div",pge,[(0,s.Lk)("button",{type:"button",onClick:a[33]||(a[33]=(...e)=>o.resetForm&&o.resetForm(...e)),class:"tailoring-risk-btn-secondary"},a[76]||(a[76]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset ")])),(0,s.Lk)("button",{type:"submit",class:"tailoring-risk-btn-primary",disabled:o.isLoading},a[77]||(a[77]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Risk ")]),8,vge)])],32)])}var kge={name:"TailoringRisk",components:{PopupModal:pv.wA},setup(){const e=(0,ae.lq)(),a=(0,ee.KR)({RiskTitle:"",ComplianceId:"",Criticality:"",Category:"",RiskType:"",RiskPriority:"",RiskImpact:1,RiskLikelihood:1,RiskExposureRating:1,BusinessImpact:"",PossibleDamage:"",RiskDescription:"",RiskMitigation:""}),t=(0,ee.KR)(!1),i=(0,ee.KR)("Loading..."),o=(0,ee.KR)([]),l=(0,ee.KR)(""),n=(0,ee.KR)([]),r=(0,ee.KR)([]),c=(0,ee.KR)(!1),d=(0,ee.KR)(""),u=(0,ee.KR)(!1),p=(0,ee.KR)(""),v=(0,ee.KR)([]),m=(0,ee.KR)(""),k=(0,ee.KR)(!1),h=(0,ee.KR)(""),g=(0,ee.KR)(!1),y=(0,ee.KR)(""),f=(0,s.EW)(()=>l.value?"Create Risk Based on Existing Risk":"Create New Risk"),b=(0,s.EW)(()=>{if(!d.value)return n.value;const e=d.value.toLowerCase();return n.value.filter(a=>a.value.toLowerCase().includes(e))}),C=(0,s.EW)(()=>{if(!h.value)return v.value;const e=h.value.toLowerCase();return v.value.filter(a=>a.value.toLowerCase().includes(e))});(0,s.wB)([()=>a.value.RiskImpact,()=>a.value.RiskLikelihood],()=>{a.value.RiskExposureRating=(a.value.RiskImpact||1)*(a.value.RiskLikelihood||1)});const L=()=>{if(l.value){const e=o.value.find(e=>e.RiskId==l.value);e&&(Object.assign(a.value,{RiskTitle:e.RiskTitle||"",ComplianceId:e.ComplianceId||"",Criticality:e.Criticality||"",Category:e.Category||"",RiskType:e.RiskType||"",RiskPriority:e.RiskPriority||"",RiskImpact:e.RiskImpact||1,RiskLikelihood:e.RiskLikelihood||1,RiskExposureRating:e.RiskExposureRating||1,BusinessImpact:e.BusinessImpact||"",PossibleDamage:e.PossibleDamage||"",RiskDescription:e.RiskDescription||"",RiskMitigation:e.RiskMitigation||""}),e.BusinessImpact&&w(e.BusinessImpact),e.Category&&(m.value=e.Category))}},w=e=>{if(!e)return;r.value=[];const a=e.split(",").map(e=>e.trim());a.forEach(e=>{if(!e)return;const a=n.value.find(a=>a.value.toLowerCase()===e.toLowerCase());if(a)r.value.push(a);else{const a={id:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,value:e};n.value.push(a),r.value.push(a)}})},E=async()=>{t.value=!0,i.value="Loading risks...";try{const a=await qe.A.get("http://localhost:8000/api/risks/");o.value=a.data,e.params.id&&"new"!==e.params.id&&(l.value=e.params.id,L())}catch(a){console.error("Error loading risks:",a),pv.Wo.error("Failed to load risks. Please try again.")}finally{t.value=!1}},R=async()=>{try{const e=await qe.A.get("http://localhost:8000/api/business-impacts/");"success"===e.data.status&&(n.value=e.data.data)}catch(e){console.error("Error fetching business impacts:",e)}},D=()=>{c.value=!c.value,c.value&&(d.value="")},I=e=>{const t=r.value.findIndex(a=>a.id===e.id);-1===t?r.value.push(e):r.value.splice(t,1),a.value.BusinessImpact=r.value.map(e=>e.value).join(", ")},P=e=>r.value.some(a=>a.id===e.id),_=async()=>{if(p.value.trim())try{const e=await qe.A.post("http://localhost:8000/api/business-impacts/add/",{value:p.value.trim()});if("success"!==e.data.status)throw new Error("Failed to add business impact: "+(e.data.message||"Unknown error"));n.value.push(e.data.data),I(e.data.data),u.value=!1,p.value=""}catch(e){console.error("Error adding new business impact:",e),pv.Wo.error("Failed to add new business impact: "+(e.response?.data?.message||e.message))}},S=async()=>{try{const e=await qe.A.get("http://localhost:8000/api/risk-categories/");"success"===e.data.status&&(v.value=e.data.data)}catch(e){console.error("Error fetching categories:",e)}},A=()=>{k.value=!k.value,k.value&&(h.value="")},T=e=>{m.value=e.value,a.value.Category=e.value,k.value=!1},x=async e=>{if(e&&(e.preventDefault(),e.stopPropagation()),y.value.trim())try{console.log("Adding new category:",y.value);const e=await qe.A.post("http://localhost:8000/api/risk-categories/add/",{value:y.value.trim()});if("success"!==e.data.status)throw new Error("Failed to add category: "+(e.data.message||"Unknown error"));console.log("Successfully added category:",e.data.data),v.value.push(e.data.data),T(e.data.data),g.value=!1,y.value=""}catch(a){console.error("Error adding new category:",a),pv.Wo.error("Failed to add new category: "+(a.response?.data?.message||a.message))}},F=()=>{l.value="",r.value=[],m.value="",Object.assign(a.value,{RiskTitle:"",ComplianceId:"",Criticality:"",Category:"",RiskType:"",RiskPriority:"",RiskImpact:1,RiskLikelihood:1,RiskExposureRating:1,BusinessImpact:"",PossibleDamage:"",RiskDescription:"",RiskMitigation:""})},V=()=>{const e={},t=["Critical","High","Medium","Low"];a.value.Criticality&&t.includes(a.value.Criticality)||(e.Criticality=`Invalid Criticality. Must be one of: ${t.join(", ")}`);const i=["High","Medium","Low"];a.value.RiskPriority&&i.includes(a.value.RiskPriority)||(e.RiskPriority=`Invalid Risk Priority. Must be one of: ${i.join(", ")}`);const s=["Current","Residual","Inherent","Emerging","Accept"];a.value.RiskType&&s.includes(a.value.RiskType)||(e.RiskType=`Invalid Risk Type. Must be one of: ${s.join(", ")}`);const o=parseInt(a.value.RiskImpact);(isNaN(o)||o<1||o>10)&&(e.RiskImpact="Risk Impact must be between 1 and 10");const l=parseInt(a.value.RiskLikelihood);(isNaN(l)||l<1||l>10)&&(e.RiskLikelihood="Risk Likelihood must be between 1 and 10");const n=/^[A-Za-z0-9\s.,;:!?'"()\-_[\]]{0,}$/,r=["RiskTitle","RiskDescription","PossibleDamage","RiskMitigation"];return r.forEach(t=>{a.value[t]&&!n.test(a.value[t])&&(e[t]=`${t} contains invalid characters`)}),e},M=async()=>{t.value=!0,i.value="Validating and saving risk...";try{const e=V();if(Object.keys(e).length>0){const a=Object.entries(e).map(([e,a])=>`${e}: ${a}`).join("\n");return void pv.Wo.error("Please fix the following validation errors:\n\n"+a)}const t={...a.value,RiskLikelihood:parseInt(a.value.RiskLikelihood)||1,RiskImpact:parseInt(a.value.RiskImpact)||1,RiskExposureRating:parseFloat(a.value.RiskExposureRating)||1,BusinessImpact:r.value.map(e=>e.value).join(", ")};await qe.A.post("http://localhost:8000/api/risks/",t),pv.Wo.success("Risk created successfully!"),F()}catch(e){console.error("Error saving risk:",e),e.response?.data?.detail?pv.Wo.error("Server validation error: "+e.response.data.detail):pv.Wo.error("Failed to save risk: "+e.message)}finally{t.value=!1}},X=()=>{document.addEventListener("click",e=>{const a=document.querySelector(".tailoring-risk-business-impact-dropdown");a&&!a.contains(e.target)&&(c.value=!1);const t=document.querySelector(".tailoring-risk-category-dropdown");t&&!t.contains(e.target)&&(k.value=!1)})};return(0,s.sV)(()=>{E(),R(),S(),X()}),{risk:a,isLoading:t,loadingMessage:i,allRisks:o,selectedRiskId:l,pageTitle:f,businessImpacts:n,selectedBusinessImpacts:r,showBusinessImpactDropdown:c,businessImpactSearch:d,showAddImpactModal:u,newBusinessImpact:p,filteredBusinessImpacts:b,categories:v,selectedCategory:m,showCategoryDropdown:k,categorySearch:h,showAddCategoryModal:g,newCategory:y,filteredCategories:C,onRiskSelected:L,toggleBusinessImpactDropdown:D,toggleBusinessImpact:I,isBusinessImpactSelected:P,addNewBusinessImpact:_,toggleCategoryDropdown:A,selectCategory:T,addNewCategory:x,resetForm:F,saveRisk:M}}};const hge=(0,se.A)(kge,[["render",mge]]);var gge=hge;const yge={class:"risk-kpi-dashboard"},fge={class:"category-filter-container"},bge={class:"first-row"},Cge={class:"kpi-box"},Lge={class:"kpi-number"},wge={class:"sparkline-chart"},Ege={key:0,class:"line-chart"},Rge={width:"100%",height:"100%",preserveAspectRatio:"none",viewBox:"0 0 100 30"},Dge=["d"],Ige=["d"],Pge={key:1,class:"month-labels"},_ge={class:"kpi-box high-criticality"},Sge={class:"kpi-number"},Age={class:"criticality-breakdown"},Tge={class:"breakdown-item"},xge={class:"item-value"},Fge={class:"breakdown-item"},Vge={class:"item-value"},Mge={class:"criticality-trend"},Xge={width:"100%",height:"15",viewBox:"0 0 100 15",preserveAspectRatio:"none"},Uge=["d"],Nge={class:"kpi-box"},$ge={class:"kpi-number"},Oge={class:"register-update-chart"},jge={width:"100%",height:"50",viewBox:"0 0 100 50",preserveAspectRatio:"none"},Bge=["d"],Wge=["cx","cy"],Qge={key:0,class:"month-labels"},qge={class:"kpi-grid"},Kge={class:"kpi-box"},Jge={class:"kpi-number"},zge={class:"remediation-chart"},Hge={width:"100%",height:"50",viewBox:"0 0 100 50",preserveAspectRatio:"none"},Yge={x:"2",y:"18","font-size":"3",fill:"#f59e0b"},Gge=["d"],Zge=["cx","cy"],eye={key:0,class:"month-labels"},aye={key:0,class:"overdue-info"},tye={class:"overdue-container"},iye={class:"risk-count"},sye={class:"risk-percentage"},oye={class:"kpi-box"},lye={class:"kpi-number"},nye={class:"recurrence-bars-container"},rye={class:"recurrence-values"},cye={class:"one-time-value"},dye={class:"recurring-value"},uye={class:"recurrence-bars"},pye={class:"recurrence-trend"},vye={width:"100%",height:"50",viewBox:"0 0 100 50",preserveAspectRatio:"none"},mye=["d"],kye=["cx","cy"],hye={class:"month-labels"},gye={class:"kpi-box"},yye={class:"kpi-number"},fye={class:"unit"},bye={class:"response-gauge"},Cye={width:"100%",height:"80",viewBox:"0 0 200 80"},Lye=["x2","y2"],wye={x:"30",y:"80","font-size":"8",fill:"#10b981","text-anchor":"start"},Eye={x:"170",y:"80","font-size":"8",fill:"#ef4444","text-anchor":"end"},Rye={key:0,class:"response-warning"},Dye={class:"response-trend"},Iye={width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none"},Pye=["d"],_ye=["cx","cy"],Sye={class:"month-labels"},Aye={class:"kpi-box"},Tye={class:"kpi-header"},xye={class:"kpi-period-selector"},Fye={class:"kpi-number"},Vye={class:"cost-chart"},Mye={key:0,class:"cost-bars"},Xye={class:"cost-value"},Uye={class:"cost-labels"},Nye={class:"cost-breakdown"},$ye={class:"cost-metric"},Oye={class:"metric-value"},jye={class:"cost-metric"},Bye={class:"metric-value high-cost"},Wye={class:"kpi-box"},Qye={class:"kpi-number"},qye={class:"kpi-note"},Kye={class:"kpi-chart"},Jye={key:0,width:"100%",height:"60",viewBox:"0 0 120 60"},zye=["points"],Hye=["points"],Yye=["cx","cy"],Gye={key:1,class:"month-labels"},Zye={class:"kpi-box"},efe={class:"kpi-header"},afe={class:"kpi-period-selector"},tfe={class:"kpi-number"},ife={class:"mitigation-chart"},sfe={class:"pie-chart"},ofe={width:"70",height:"70"},lfe=["d"],nfe=["d"],rfe=["d"],cfe={class:"pie-legend"},dfe={class:"legend-item"},ufe={class:"legend-value"},pfe={class:"legend-item"},vfe={class:"legend-value"},mfe={class:"legend-item"},kfe={class:"legend-value"},hfe={class:"mitigation-detail"},gfe={class:"detail-count"},yfe={class:"kpi-box"},ffe={class:"initiative-progress"},bfe={width:"70",height:"70"},Cfe=["stroke-dasharray"],Lfe={x:"35",y:"35","text-anchor":"middle","dominant-baseline":"middle",class:"circle-text"},wfe={class:"initiative-counts"},Efe={class:"count-item"},Rfe={class:"count-value"},Dfe={class:"count-item"},Ife={class:"count-value"},Pfe={class:"kpi-box"},_fe={class:"kpi-number"},Sfe={class:"impact-meter"},Afe={class:"impact-chart"},Tfe={class:"impact-bubbles"},xfe=["title"],Ffe={class:"kpi-box"},Vfe={class:"kpi-number"},Mfe={class:"kpi-note"},Xfe={class:"severity-categories"},Ufe={class:"severity-category"},Nfe={class:"category-value"},$fe={class:"severity-category"},Ofe={class:"category-value"},jfe={class:"severity-category"},Bfe={class:"category-value"},Wfe={class:"severity-category"},Qfe={class:"category-value"},qfe={class:"severity-chart-container"},Kfe={class:"severity-semi-circle"},Jfe={class:"kpi-box"},zfe={class:"kpi-number"},Hfe={class:"exposure-chart"},Yfe={class:"scatter-container"},Gfe=["title"],Zfe={class:"exposure-legend"},ebe={class:"exposure-risk-list"},abe={class:"risk-name"},tbe={class:"risk-score"},ibe={class:"kpi-box"},sbe={class:"kpi-number"},obe={class:"resilience-chart"},lbe={class:"resilience-bars"},nbe={class:"category-name"},rbe={class:"time-bars"},cbe={class:"time-value"},dbe={class:"time-value"},ube={class:"kpi-box"},pbe={class:"kpi-number"},vbe={key:0,class:"criticality-badge"},mbe={class:"assessment-chart"},kbe={class:"assessment-bars"},hbe={class:"bar-value"},gbe={key:0,class:"month-labels"},ybe={class:"assessment-breakdown"},fbe={key:0,class:"category-bars"},bbe={class:"category-label"},Cbe={class:"category-bar-bg"},Lbe={class:"category-value"},wbe={class:"kpi-box"},Ebe={class:"kpi-number"},Rbe={class:"consensus-chart"},Dbe={class:"consensus-pie"},Ibe={width:"70",height:"70",viewBox:"0 0 70 70"},Pbe=["d"],_be=["d"],Sbe={class:"consensus-legend"},Abe={class:"legend-item"},Tbe={class:"legend-value"},xbe={class:"legend-item"},Fbe={class:"legend-value"},Vbe={class:"investigation-section"},Mbe={key:0,class:"investigation-risks"},Xbe={class:"risk-item"},Ube={class:"risk-title"},Nbe={class:"risk-agreement"},$be={class:"kpi-box"},Obe={class:"kpi-box"},jbe={class:"kpi-number"},Bbe={class:"key-metrics"},Wbe={class:"metric-box"},Qbe={class:"metric-number"},qbe={class:"metric-box"},Kbe={class:"metric-number"},Jbe={class:"kpi-box"},zbe={class:"kpi-number"},Hbe={class:"waterfall-chart"},Ybe={class:"bar-value"},Gbe={class:"bar-value"},Zbe={class:"bar-value"},eCe={class:"bar-value"},aCe={class:"kpi-box"},tCe={class:"kpi-number"},iCe={class:"progress-bar"},sCe={class:"avg-time-metrics"},oCe={class:"avg-time-label"},lCe={class:"avg-time-value"},nCe={class:"kpi-box"},rCe={class:"kpi-number"},cCe={class:"probability-histogram"},dCe={class:"histogram-chart"},uCe={class:"count-label"},pCe={class:"range-labels"},vCe={key:0,class:"high-probability-risks"},mCe={class:"high-prob-item"},kCe={class:"high-prob-name"},hCe={class:"high-prob-value"},gCe={class:"kpi-box"},yCe={class:"kpi-number tolerance-status-container"},fCe={class:"tolerance-thresholds"},bCe={class:"category-header"},CCe={class:"category-name"},LCe={class:"tolerance-bar-bg"},wCe={class:"kpi-box"},ECe={class:"kpi-number centered-number"},RCe={class:"big-number"},DCe={class:"appetite-description"},ICe={class:"appetite-chart"},PCe={class:"appetite-slider-container"};function _Ce(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",yge,[(0,s.Lk)("div",fge,[a[7]||(a[7]=(0,s.Lk)("label",{for:"category-filter"},"Filter by Category:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"category-filter","onUpdate:modelValue":a[0]||(a[0]=e=>l.selectedCategory=e),onChange:a[1]||(a[1]=(...e)=>n.filterKpiCards&&n.filterKpiCards(...e))},a[6]||(a[6]=[(0,s.Lk)("option",{value:"all"},"All Categories",-1),(0,s.Lk)("option",{value:"risk-profile"},"Risk Profile",-1),(0,s.Lk)("option",{value:"risk-exposure"},"Risk Exposure",-1),(0,s.Lk)("option",{value:"risk-mitigation"},"Risk Mitigation",-1)]),544),[[i.u1,l.selectedCategory]])]),(0,s.Lk)("div",bge,[(0,s.bo)((0,s.Lk)("div",Cge,[a[8]||(a[8]=(0,s.Lk)("div",{class:"kpi-title"},"NUMBER OF ACTIVE RISKS",-1)),(0,s.Lk)("div",Lge,[(0,s.eW)((0,d.v_)(l.activeRisksData.current||"48")+" ",1),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.activeRisksData.percentageChange>0,down:l.activeRisksData.percentageChange<0}])},(0,d.v_)(l.activeRisksData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.activeRisksData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",wge,[l.activeRisksData.trendData&&l.activeRisksData.trendData.length>0?((0,s.uX)(),(0,s.CE)("div",Ege,[((0,s.uX)(),(0,s.CE)("svg",Rge,[(0,s.Lk)("path",{d:n.generateSmoothCurvePath(l.activeRisksData.trendData,l.activeRisksData.minValue,l.activeRisksData.maxValue),class:"line-path"},null,8,Dge),(0,s.Lk)("path",{d:n.generateSmoothAreaPath(l.activeRisksData.trendData,l.activeRisksData.minValue,l.activeRisksData.maxValue),class:"chart-area"},null,8,Ige)])),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeRisksData.trendData,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"ar-point-"+a,class:"data-point",style:(0,d.Tr)({left:a/(l.activeRisksData.trendData.length-1)*100+"%",top:`${n.calculatePointPosition(e,l.activeRisksData.minValue,l.activeRisksData.maxValue)}%`})},null,4))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeRisksData.trendData,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"ar-tooltip-"+a,class:"data-tooltip",style:(0,d.Tr)({left:a/(l.activeRisksData.trendData.length-1)*100+"%",top:`${n.calculatePointPosition(e,l.activeRisksData.minValue,l.activeRisksData.maxValue)}%`})},(0,d.v_)(l.activeRisksData.months[a])+": "+(0,d.v_)(e)+" risks ",5))),128))])):(0,s.Q3)("",!0),l.activeRisksData.months?((0,s.uX)(),(0,s.CE)("div",Pge,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeRisksData.months,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"ar-month-"+a},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)])],512),[[i.aG,n.isVisible("active-risks")]]),(0,s.bo)((0,s.Lk)("div",_ge,[a[14]||(a[14]=(0,s.Lk)("div",{class:"kpi-title"},"HIGH CRITICALITY RISKS",-1)),(0,s.Lk)("div",Sge,[(0,s.eW)((0,d.v_)(l.criticalityData.count||"6.5")+" ",1),a[9]||(a[9]=(0,s.Lk)("span",{class:"criticality-badge"},"HIGH",-1))]),(0,s.Lk)("div",Age,[(0,s.Lk)("div",Tge,[a[10]||(a[10]=(0,s.Lk)("div",{class:"item-dot critical"},null,-1)),a[11]||(a[11]=(0,s.Lk)("div",{class:"item-label"},"Critical",-1)),(0,s.Lk)("div",xge,(0,d.v_)(l.criticalityData.criticalCount||"2"),1)]),(0,s.Lk)("div",Fge,[a[12]||(a[12]=(0,s.Lk)("div",{class:"item-dot high"},null,-1)),a[13]||(a[13]=(0,s.Lk)("div",{class:"item-label"},"High",-1)),(0,s.Lk)("div",Vge,(0,d.v_)(l.criticalityData.highCount||"4"),1)])]),(0,s.Lk)("div",Mge,[((0,s.uX)(),(0,s.CE)("svg",Xge,[l.criticalityData.trendData&&l.criticalityData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateCriticalityPath(l.criticalityData.trendData),class:"criticality-path"},null,8,Uge)):(0,s.Q3)("",!0)]))])],512),[[i.aG,n.isVisible("high-criticality")]]),(0,s.bo)((0,s.Lk)("div",Nge,[a[16]||(a[16]=(0,s.Lk)("div",{class:"kpi-title"},"FREQUENCY OF RISK REGISTER UPDATE",-1)),(0,s.Lk)("div",$ge,[(0,s.eW)((0,d.v_)(l.registerUpdateData.avgUpdateFrequency||"10"),1),a[15]||(a[15]=(0,s.Lk)("span",{class:"unit"},"days",-1))]),(0,s.Lk)("div",Oge,[((0,s.uX)(),(0,s.CE)("svg",jge,[l.registerUpdateData.monthlyUpdates&&l.registerUpdateData.monthlyUpdates.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateRegisterUpdatePath(l.registerUpdateData.monthlyUpdates),fill:"none",stroke:"#4f46e5","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Bge)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.registerUpdateData.monthlyUpdates,(e,a)=>((0,s.uX)(),(0,s.CE)("circle",{key:"update-point-"+a,cx:a/(l.registerUpdateData.monthlyUpdates.length-1)*100,cy:n.calculateUpdateY(e),r:"2",fill:"#4f46e5",stroke:"#fff","stroke-width":"1"},null,8,Wge))),128))])),l.registerUpdateData.months?((0,s.uX)(),(0,s.CE)("div",Qge,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.registerUpdateData.months,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"update-month-"+a},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)])],512),[[i.aG,n.isVisible("register-update")]])]),(0,s.Lk)("div",qge,[(0,s.bo)((0,s.Lk)("div",Kge,[a[21]||(a[21]=(0,s.Lk)("div",{class:"kpi-title"},"AVERAGE TIME TO REMEDIATE CRITICAL RISKS",-1)),(0,s.Lk)("div",Jge,[(0,s.eW)((0,d.v_)(l.remediationData.current||l.kpiData.avgRemediationTime||"35"),1),a[17]||(a[17]=(0,s.Lk)("span",{class:"unit"},"days",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.remediationData.percentageChange>0,down:l.remediationData.percentageChange<0}])},(0,d.v_)(l.remediationData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.remediationData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",zge,[((0,s.uX)(),(0,s.CE)("svg",Hge,[a[18]||(a[18]=(0,s.Lk)("rect",{x:"0",y:"0",width:"100",height:"40",fill:"#f8fafc",rx:"2",ry:"2"},null,-1)),a[19]||(a[19]=(0,s.Lk)("line",{x1:"0",y1:"20",x2:"100",y2:"20",stroke:"#f59e0b","stroke-width":"1.5","stroke-dasharray":"3,2"},null,-1)),(0,s.Lk)("text",Yge,"SLA: "+(0,d.v_)(l.remediationData.slaThreshold||"30")+" days",1),l.remediationData.trendData&&l.remediationData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateRemediationPath(l.remediationData.trendData),fill:"none",stroke:"#3b82f6","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Gge)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.remediationData.trendData,(e,a)=>((0,s.uX)(),(0,s.CE)("circle",{key:"rem-point-"+a,cx:a/(l.remediationData.trendData.length-1)*100,cy:n.calculateRemediationY(e),r:"2.5",fill:"#3b82f6",stroke:"#fff","stroke-width":"1"},null,8,Zge))),128))])),l.remediationData.months?((0,s.uX)(),(0,s.CE)("div",eye,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.remediationData.months,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"rem-month-"+a},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)]),l.remediationData.overdueCount?((0,s.uX)(),(0,s.CE)("div",aye,[(0,s.Lk)("div",tye,[(0,s.Lk)("div",iye,[a[20]||(a[20]=(0,s.eW)(" Overdue Critical Risks: ")),(0,s.Lk)("span",null,(0,d.v_)(l.remediationData.overdueCount),1)]),(0,s.Lk)("div",sye,(0,d.v_)(l.remediationData.overduePercentage)+"% of active critical risks ",1)])])):(0,s.Q3)("",!0)],512),[[i.aG,n.isVisible("avg-remediation")]]),(0,s.bo)((0,s.Lk)("div",oye,[a[25]||(a[25]=(0,s.Lk)("div",{class:"kpi-title"},"RATE OF RECURRENCE",-1)),(0,s.Lk)("div",lye,[(0,s.eW)((0,d.v_)(l.recurrenceData.recurrenceRate||l.kpiData.recurrenceRate||"6.5"),1),a[22]||(a[22]=(0,s.Lk)("span",{class:"percent"},"%",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.recurrenceData.percentageChange>0,down:l.recurrenceData.percentageChange<0}])},(0,d.v_)(l.recurrenceData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.recurrenceData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",nye,[a[23]||(a[23]=(0,s.Lk)("div",{class:"recurrence-labels"},[(0,s.Lk)("span",{class:"one-time-label"},"One-time"),(0,s.Lk)("span",{class:"recurring-label"},"Recurring")],-1)),(0,s.Lk)("div",rye,[(0,s.Lk)("span",cye,(0,d.v_)(l.recurrenceData.oneTimeRate||93.5)+"%",1),(0,s.Lk)("span",dye,(0,d.v_)(l.recurrenceData.recurrenceRate||6.5)+"%",1)]),(0,s.Lk)("div",uye,[(0,s.Lk)("div",{class:"recurrence-bar one-time",style:(0,d.Tr)({width:`${l.recurrenceData.oneTimeRate||93.5}%`})},null,4),(0,s.Lk)("div",{class:"recurrence-bar recurring",style:(0,d.Tr)({width:`${l.recurrenceData.recurrenceRate||6.5}%`})},null,4)])]),(0,s.Lk)("div",pye,[((0,s.uX)(),(0,s.CE)("svg",vye,[a[24]||(a[24]=(0,s.Lk)("rect",{x:"0",y:"0",width:"100",height:"50",fill:"#f8fafc",rx:"2",ry:"2"},null,-1)),l.recurrenceData.trendData&&l.recurrenceData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateRecurrencePath(l.recurrenceData.trendData),fill:"none",stroke:"#ef4444","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,mye)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceData.trendData,(e,a)=>((0,s.uX)(),(0,s.CE)("circle",{key:"rec-point-"+a,cx:a/(l.recurrenceData.trendData.length-1)*100,cy:n.calculateRecurrenceY(e),r:"2.5",fill:"#ef4444",stroke:"#fff","stroke-width":"1"},null,8,kye))),128))])),(0,s.Lk)("div",hye,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceData.months,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"rec-month-"+a},(0,d.v_)(e),1))),128))])])],512),[[i.aG,n.isVisible("rate-recurrence")]]),(0,s.bo)((0,s.Lk)("div",gye,[a[32]||(a[32]=(0,s.Lk)("div",{class:"kpi-title"},"AVERAGE TIME TO INCIDENT RESPONSE",-1)),(0,s.Lk)("div",yye,[(0,s.eW)((0,d.v_)(n.formatResponseTime(l.responseData.current)),1),(0,s.Lk)("span",fye,(0,d.v_)(l.responseData.current>72?"":"hours"),1),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.responseData.percentageChange>0,down:l.responseData.percentageChange<0}])},(0,d.v_)(l.responseData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.responseData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",bye,[((0,s.uX)(),(0,s.CE)("svg",Cye,[a[26]||(a[26]=(0,s.Lk)("path",{d:"M 30 70 A 70 70 0 0 1 170 70",stroke:"#e5e7eb","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),a[27]||(a[27]=(0,s.Lk)("path",{d:"M 30 70 A 70 70 0 0 1 80 25",stroke:"#10b981","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),a[28]||(a[28]=(0,s.Lk)("path",{d:"M 80 25 A 70 70 0 0 1 120 25",stroke:"#f59e0b","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),a[29]||(a[29]=(0,s.Lk)("path",{d:"M 120 25 A 70 70 0 0 1 170 70",stroke:"#ef4444","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),(0,s.Lk)("line",{x1:"100",y1:"70",x2:n.calculateGaugeNeedleX(l.responseData.current||6),y2:n.calculateGaugeNeedleY(l.responseData.current||6),stroke:"#0f172a","stroke-width":"3","stroke-linecap":"round"},null,8,Lye),a[30]||(a[30]=(0,s.Lk)("circle",{cx:"100",cy:"70",r:"4",fill:"#0f172a"},null,-1)),(0,s.Lk)("text",wye,"Target: "+(0,d.v_)(l.responseData.target||"4")+"h",1),(0,s.Lk)("text",Eye,"SLA: "+(0,d.v_)(l.responseData.sla||"8")+"h",1)]))]),l.responseData.current>72?((0,s.uX)(),(0,s.CE)("div",Rye," Response time significantly exceeds SLA threshold ")):(0,s.Q3)("",!0),(0,s.Lk)("div",Dye,[((0,s.uX)(),(0,s.CE)("svg",Iye,[a[31]||(a[31]=(0,s.Lk)("rect",{x:"0",y:"0",width:"100",height:"40",fill:"#f8fafc",rx:"2",ry:"2"},null,-1)),l.responseData.trendData&&l.responseData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateResponsePath(l.responseData.trendData),fill:"none",stroke:"#ef4444","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Pye)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.responseData.trendData,(e,a)=>((0,s.uX)(),(0,s.CE)("circle",{key:"resp-point-"+a,cx:a/(l.responseData.trendData.length-1)*100,cy:n.calculateResponseY(e),r:"2",fill:"#ef4444",stroke:"#fff","stroke-width":"0.5"},null,8,_ye))),128))])),(0,s.Lk)("div",Sye,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.responseData.months,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"resp-month-"+a},(0,d.v_)(e),1))),128))])])],512),[[i.aG,n.isVisible("avg-response")]]),(0,s.bo)((0,s.Lk)("div",Aye,[(0,s.Lk)("div",Tye,[a[34]||(a[34]=(0,s.Lk)("div",{class:"kpi-title"},"COST OF MITIGATION",-1)),(0,s.Lk)("div",xye,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[2]||(a[2]=e=>l.mitigationCostPeriod=e),onChange:a[3]||(a[3]=(...e)=>n.fetchMitigationCostData&&n.fetchMitigationCostData(...e))},a[33]||(a[33]=[(0,s.Lk)("option",{value:"30days"},"Last 30 days",-1),(0,s.Lk)("option",{value:"90days"},"Last 90 days",-1),(0,s.Lk)("option",{value:"6months"},"Last 6 months",-1),(0,s.Lk)("option",{value:"1year"},"Last 1 year",-1)]),544),[[i.u1,l.mitigationCostPeriod]])])]),(0,s.Lk)("div",Fye,[(0,s.eW)(" â‚¹"+(0,d.v_)(l.mitigationCostData.totalCost||l.kpiData.mitigationCost||"184")+"K ",1),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.mitigationCostData.percentageChange>0,down:l.mitigationCostData.percentageChange<0}])},(0,d.v_)(l.mitigationCostData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.mitigationCostData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",Vye,[l.mitigationCostData.monthlyData&&l.mitigationCostData.monthlyData.length>0?((0,s.uX)(),(0,s.CE)("div",Mye,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationCostData.monthlyData,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"cost-bar-"+a,class:"cost-bar",style:(0,d.Tr)({height:n.calculateCostBarHeight(e.cost)+"%"})},[(0,s.Lk)("div",Xye,"â‚¹"+(0,d.v_)(e.cost)+"K",1)],4))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",Uye,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationCostData.monthlyData,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"cost-month-"+a},(0,d.v_)(e.month),1))),128))]),(0,s.Lk)("div",Nye,[(0,s.Lk)("div",$ye,[a[35]||(a[35]=(0,s.Lk)("div",{class:"metric-label"},"Avg Cost",-1)),(0,s.Lk)("div",Oye,"â‚¹"+(0,d.v_)(l.mitigationCostData.avgCost||"31")+"K",1)]),(0,s.Lk)("div",jye,[a[36]||(a[36]=(0,s.Lk)("div",{class:"metric-label"},"Highest",-1)),(0,s.Lk)("div",Bye,"â‚¹"+(0,d.v_)(l.mitigationCostData.highestCost||"42")+"K",1)])])])],512),[[i.aG,n.isVisible("cost-mitigation")]]),(0,s.bo)((0,s.Lk)("div",Wye,[a[39]||(a[39]=(0,s.Lk)("div",{class:"kpi-title"},"Risk Identification Rate",-1)),(0,s.Lk)("div",Qye,[(0,s.eW)((0,d.v_)(null!==l.identificationRate?l.identificationRate:"--")+"% ",1),(0,s.Lk)("span",{class:(0,d.C4)(["percent",{up:l.identificationChange>0,down:l.identificationChange<0}])},(0,d.v_)(l.identificationChange>0?"+":"")+(0,d.v_)(null!==l.identificationChange?l.identificationChange:"--")+"% ",3)]),(0,s.Lk)("div",qye,[a[37]||(a[37]=(0,s.eW)(" Avg. Daily ")),(0,s.Lk)("b",null,(0,d.v_)(null!==l.avgDailyRisks?l.avgDailyRisks:"--"),1),a[38]||(a[38]=(0,s.eW)(" risks/day "))]),(0,s.Lk)("div",Kye,[l.identificationTrend&&l.identificationTrend.length>1?((0,s.uX)(),(0,s.CE)("svg",Jye,[(0,s.Lk)("polygon",{points:n.generateAreaPoints(l.identificationTrend,120,60),class:"identification-area"},null,8,zye),(0,s.Lk)("polyline",{points:n.generateLinePoints(l.identificationTrend,120,60),class:"identification-path",fill:"none",stroke:"#3b82f6","stroke-width":"2"},null,8,Hye),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.identificationTrend,(e,a)=>((0,s.uX)(),(0,s.CE)("circle",{key:"identification-point-"+a,cx:n.getX(a,l.identificationTrend.length,120),cy:n.getY(e,l.identificationTrend,60),r:"2",class:"identification-point"},null,8,Yye))),128))])):(0,s.Q3)("",!0),l.identificationMonths&&l.identificationMonths.length?((0,s.uX)(),(0,s.CE)("div",Gye,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.identificationMonths,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"identification-month-"+a},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)])],512),[[i.aG,n.isVisible("identification-rate")]]),(0,s.bo)((0,s.Lk)("div",Zye,[(0,s.Lk)("div",efe,[a[41]||(a[41]=(0,s.Lk)("div",{class:"kpi-title"},"PERCENTAGE OF DUE MITIGATION ACTIONS",-1)),(0,s.Lk)("div",afe,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[4]||(a[4]=e=>l.dueMitigationPeriod=e),onChange:a[5]||(a[5]=(...e)=>n.fetchDueMitigationData&&n.fetchDueMitigationData(...e))},a[40]||(a[40]=[(0,s.Lk)("option",{value:"30days"},"Last 30 days",-1),(0,s.Lk)("option",{value:"90days"},"Last 90 days",-1),(0,s.Lk)("option",{value:"6months"},"Last 6 months",-1),(0,s.Lk)("option",{value:"1year"},"Last 1 year",-1)]),544),[[i.u1,l.dueMitigationPeriod]])])]),(0,s.Lk)("div",tfe,[(0,s.eW)((0,d.v_)(l.dueMitigationData.overduePercentage||l.kpiData.dueMitigation||"22"),1),a[42]||(a[42]=(0,s.Lk)("span",{class:"percent"},"%",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.dueMitigationData.percentageChange<0,down:l.dueMitigationData.percentageChange>0}])},(0,d.v_)(l.dueMitigationData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.dueMitigationData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",ife,[(0,s.Lk)("div",sfe,[((0,s.uX)(),(0,s.CE)("svg",ofe,[a[43]||(a[43]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"#f5f7fa",stroke:"none"},null,-1)),(0,s.Lk)("path",{d:n.generatePieSegment(35,35,30,20,0,l.dueMitigationData.completedPercentage||50),fill:"#10b981"},null,8,lfe),(0,s.Lk)("path",{d:n.generatePieSegment(35,35,30,20,l.dueMitigationData.completedPercentage||50,(l.dueMitigationData.completedPercentage||50)+(l.dueMitigationData.pendingPercentage||28)),fill:"#3b82f6"},null,8,nfe),(0,s.Lk)("path",{d:n.generatePieSegment(35,35,30,20,(l.dueMitigationData.completedPercentage||50)+(l.dueMitigationData.pendingPercentage||28),100),fill:"#ef4444"},null,8,rfe),a[44]||(a[44]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"15",fill:"white",stroke:"none"},null,-1))]))]),(0,s.Lk)("div",cfe,[(0,s.Lk)("div",dfe,[a[45]||(a[45]=(0,s.Lk)("div",{class:"legend-color completed"},null,-1)),a[46]||(a[46]=(0,s.Lk)("div",{class:"legend-label"},"Completed",-1)),(0,s.Lk)("div",ufe,(0,d.v_)(l.dueMitigationData.completedPercentage||"50")+"%",1)]),(0,s.Lk)("div",pfe,[a[47]||(a[47]=(0,s.Lk)("div",{class:"legend-color pending"},null,-1)),a[48]||(a[48]=(0,s.Lk)("div",{class:"legend-label"},"Pending",-1)),(0,s.Lk)("div",vfe,(0,d.v_)(l.dueMitigationData.pendingPercentage||"28")+"%",1)]),(0,s.Lk)("div",mfe,[a[49]||(a[49]=(0,s.Lk)("div",{class:"legend-color overdue"},null,-1)),a[50]||(a[50]=(0,s.Lk)("div",{class:"legend-label"},"Overdue",-1)),(0,s.Lk)("div",kfe,(0,d.v_)(l.dueMitigationData.overduePercentage||"22")+"%",1)])])]),(0,s.Lk)("div",hfe,[(0,s.Lk)("div",gfe,(0,d.v_)(l.dueMitigationData.overdueCount||"8")+" mitigation tasks overdue",1)])],512),[[i.aG,n.isVisible("due-mitigation")]]),(0,s.bo)((0,s.Lk)("div",yfe,[a[54]||(a[54]=(0,s.Lk)("div",{class:"kpi-title"},"COMPLETION OF IMPROVEMENT INITIATIVES",-1)),(0,s.Lk)("div",ffe,[((0,s.uX)(),(0,s.CE)("svg",bfe,[a[51]||(a[51]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"transparent",stroke:"#e5e7eb","stroke-width":"8"},null,-1)),(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"transparent",stroke:"#4f46e5","stroke-width":"8","stroke-linecap":"round","stroke-dasharray":1.88*l.initiativeData.completionPercentage+" 188.5","stroke-dashoffset":"0",transform:"rotate(-90 35 35)"},null,8,Cfe),(0,s.Lk)("text",Lfe,(0,d.v_)(l.initiativeData.completionPercentage||"76")+"%",1)])),(0,s.Lk)("div",wfe,[(0,s.Lk)("div",Efe,[a[52]||(a[52]=(0,s.Lk)("div",{class:"count-label"},"Completed",-1)),(0,s.Lk)("div",Rfe,(0,d.v_)(l.initiativeData.completedCount||"19"),1)]),(0,s.Lk)("div",Dfe,[a[53]||(a[53]=(0,s.Lk)("div",{class:"count-label"},"Total",-1)),(0,s.Lk)("div",Ife,(0,d.v_)(l.initiativeData.totalCount||"25"),1)])])])],512),[[i.aG,n.isVisible("improvement-initiatives")]]),(0,s.bo)((0,s.Lk)("div",Pfe,[a[60]||(a[60]=(0,s.Lk)("div",{class:"kpi-title"},"RISK IMPACT ON OPERATIONS AND FINANCES",-1)),(0,s.Lk)("div",_fe,[(0,s.eW)((0,d.v_)(Number(l.impactData.overallScore||5.7).toFixed(1)),1),a[55]||(a[55]=(0,s.Lk)("span",{class:"unit"},"/10",-1))]),(0,s.Lk)("div",Sfe,[a[56]||(a[56]=(0,s.Lk)("div",{class:"impact-gradient"},null,-1)),(0,s.Lk)("div",{class:"impact-pointer",style:(0,d.Tr)({left:`${(10*Number(l.impactData.overallScore||5.7)).toFixed(1)}%`})},null,4),a[57]||(a[57]=(0,s.Lk)("div",{class:"impact-scale"},[(0,s.Lk)("span",null,"0"),(0,s.Lk)("span",null,"5"),(0,s.Lk)("span",null,"10")],-1))]),(0,s.Lk)("div",Afe,[a[58]||(a[58]=(0,s.Lk)("div",{class:"chart-header"},[(0,s.Lk)("span",{class:"axis-label op"},"Operational Impact"),(0,s.Lk)("span",{class:"axis-label fin"},"Financial Impact")],-1)),(0,s.Lk)("div",Tfe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.impactData.topRisks||l.defaultTopRisks,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"impact-"+a,class:(0,d.C4)(["impact-bubble",e.category.toLowerCase()]),style:(0,d.Tr)({left:10*e.operational_impact+"%",bottom:9*e.financial_impact+"%",width:`${Math.min(10,2.5*Math.max(e.operational_impact,e.financial_impact))}px`,height:`${Math.min(10,2.5*Math.max(e.operational_impact,e.financial_impact))}px`}),title:`${e.title}: Op Impact ${e.operational_impact}, Fin Impact ${e.financial_impact}`},null,14,xfe))),128))]),a[59]||(a[59]=(0,s.Lk)("div",{class:"impact-grid-lines"},[(0,s.Lk)("div",{class:"grid-line vertical"}),(0,s.Lk)("div",{class:"grid-line horizontal"})],-1))])],512),[[i.aG,n.isVisible("risk-impact")]]),(0,s.bo)((0,s.Lk)("div",Ffe,[a[66]||(a[66]=(0,s.Lk)("div",{class:"kpi-title"},"Risk Severity Based on Potential",-1)),(0,s.Lk)("div",Vfe,[(0,s.eW)((0,d.v_)(l.averageSeverity),1),a[61]||(a[61]=(0,s.Lk)("span",{class:"unit"},"/10",-1))]),(0,s.Lk)("div",Mfe,"Most Severe: "+(0,d.v_)(l.mostSevereRisk),1),(0,s.Lk)("div",Xfe,[(0,s.Lk)("div",Ufe,[a[62]||(a[62]=(0,s.Lk)("span",{class:"category-label"},"Low",-1)),(0,s.Lk)("span",Nfe,(0,d.v_)(l.severityPercentages.Low)+"%",1)]),(0,s.Lk)("div",$fe,[a[63]||(a[63]=(0,s.Lk)("span",{class:"category-label"},"Medium",-1)),(0,s.Lk)("span",Ofe,(0,d.v_)(l.severityPercentages.Medium)+"%",1)]),(0,s.Lk)("div",jfe,[a[64]||(a[64]=(0,s.Lk)("span",{class:"category-label"},"High",-1)),(0,s.Lk)("span",Bfe,(0,d.v_)(l.severityPercentages.High)+"%",1)]),(0,s.Lk)("div",Wfe,[a[65]||(a[65]=(0,s.Lk)("span",{class:"category-label"},"Critical",-1)),(0,s.Lk)("span",Qfe,(0,d.v_)(l.severityPercentages.Critical)+"%",1)])]),(0,s.Lk)("div",qfe,[(0,s.Lk)("div",Kfe,[(0,s.Lk)("div",{class:"severity-segment low",style:(0,d.Tr)(n.severitySegmentStyles.low)},null,4),(0,s.Lk)("div",{class:"severity-segment medium",style:(0,d.Tr)(n.severitySegmentStyles.medium)},null,4),(0,s.Lk)("div",{class:"severity-segment high",style:(0,d.Tr)(n.severitySegmentStyles.high)},null,4),(0,s.Lk)("div",{class:"severity-segment critical",style:(0,d.Tr)(n.severitySegmentStyles.critical)},null,4)])])],512),[[i.aG,n.isVisible("risk-severity")]]),(0,s.bo)((0,s.Lk)("div",Jfe,[a[70]||(a[70]=(0,s.Lk)("div",{class:"kpi-title"},"RISK EXPOSURE SCORE",-1)),(0,s.Lk)("div",zfe,[(0,s.eW)((0,d.v_)(l.exposureScoreData.overallScore||l.kpiData.exposureScore||"75"),1),a[67]||(a[67]=(0,s.Lk)("span",{class:"percent"},"%",-1))]),(0,s.Lk)("div",Hfe,[(0,s.Lk)("div",Yfe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.exposureScoreData.riskPoints||[],(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"exp-"+a,class:(0,d.C4)(["exposure-point",n.getCategoryClass(e.category)]),style:(0,d.Tr)({left:e.likelihood/10*100+"%",bottom:e.impact/10*100+"%",width:`${Math.min(12,1.2*e.exposure)}px`,height:`${Math.min(12,1.2*e.exposure)}px`}),title:`${e.title}: Impact ${e.impact.toFixed(1)}, Likelihood ${e.likelihood.toFixed(1)}, Exposure ${e.exposure}`},null,14,Gfe))),128)),a[68]||(a[68]=(0,s.Fv)('<div class="grid-line vertical" style="left:33%;" data-v-175f7afa></div><div class="grid-line vertical" style="left:67%;" data-v-175f7afa></div><div class="grid-line horizontal" style="bottom:33%;" data-v-175f7afa></div><div class="grid-line horizontal" style="bottom:67%;" data-v-175f7afa></div><div class="axis-label x-label" data-v-175f7afa>Likelihood</div><div class="axis-label y-label" data-v-175f7afa>Impact</div>',6))]),(0,s.Lk)("div",Zfe,[a[69]||(a[69]=(0,s.Lk)("div",{class:"exposure-header"},"Top Risks by Exposure",-1)),(0,s.Lk)("div",ebe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getTopRisks(l.exposureScoreData.riskPoints||[]),(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"top-"+a,class:"exposure-risk-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["risk-dot",n.getCategoryClass(e.category)])},null,2),(0,s.Lk)("div",abe,(0,d.v_)(e.title),1),(0,s.Lk)("div",tbe,(0,d.v_)(e.exposure),1)]))),128))])])])],512),[[i.aG,n.isVisible("exposure-score")]]),(0,s.bo)((0,s.Lk)("div",ibe,[a[73]||(a[73]=(0,s.Lk)("div",{class:"kpi-title"},"RISK RESILIENCE TO ABSORB SHOCKS",-1)),(0,s.Lk)("div",sbe,[(0,s.eW)((0,d.v_)(l.resilienceData.avgDowntime||l.kpiData.resilienceHours||"4.6"),1),a[71]||(a[71]=(0,s.Lk)("span",{class:"unit"},"hrs",-1))]),(0,s.Lk)("div",obe,[(0,s.Lk)("div",lbe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.resilienceData.categoryData||l.defaultResilienceData,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"res-"+a,class:"resilience-category"},[(0,s.Lk)("div",nbe,(0,d.v_)(e.category),1),(0,s.Lk)("div",rbe,[(0,s.Lk)("div",{class:"time-bar downtime",style:(0,d.Tr)({width:10*e.downtime+"%"})},[(0,s.Lk)("span",cbe,(0,d.v_)(e.downtime)+"h",1)],4),(0,s.Lk)("div",{class:"time-bar recovery",style:(0,d.Tr)({width:10*e.recovery+"%"})},[(0,s.Lk)("span",dbe,(0,d.v_)(e.recovery)+"h",1)],4)])]))),128))]),a[72]||(a[72]=(0,s.Fv)('<div class="resilience-legend" data-v-175f7afa><div class="legend-item" data-v-175f7afa><div class="legend-color downtime" data-v-175f7afa></div><div class="legend-label" data-v-175f7afa>Expected Downtime</div></div><div class="legend-item" data-v-175f7afa><div class="legend-color recovery" data-v-175f7afa></div><div class="legend-label" data-v-175f7afa>Recovery Time</div></div></div>',1))])],512),[[i.aG,n.isVisible("risk-resilience")]]),(0,s.bo)((0,s.Lk)("div",ube,[a[76]||(a[76]=(0,s.Lk)("div",{class:"kpi-title"},"FREQUENCY OF RISK ASSESSMENT REVIEW",-1)),(0,s.Lk)("div",pbe,[(0,s.eW)((0,d.v_)(l.assessmentData.avgReviewFrequency||"60"),1),a[74]||(a[74]=(0,s.Lk)("span",{class:"unit"},"days",-1)),l.assessmentData.overdueCount?((0,s.uX)(),(0,s.CE)("span",vbe,(0,d.v_)(l.assessmentData.overdueCount||"3")+" overdue",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",mbe,[(0,s.Lk)("div",kbe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assessmentData.monthlyReviews||[15,18,22,17,20,23],(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"assess-"+a,class:"assessment-bar",style:(0,d.Tr)({height:`${n.calculateAssessmentBarHeight(e)}%`})},[(0,s.Lk)("div",hbe,(0,d.v_)(e),1)],4))),128))]),l.assessmentData.months?((0,s.uX)(),(0,s.CE)("div",gbe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assessmentData.months,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"assess-month-"+a},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",ybe,[a[75]||(a[75]=(0,s.Lk)("div",{class:"breakdown-title"},"By Category (Average Days)",-1)),l.assessmentData.categoryFrequencies?((0,s.uX)(),(0,s.CE)("div",fbe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assessmentData.categoryFrequencies,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"cat-"+a,class:"category-bar-container"},[(0,s.Lk)("div",bbe,(0,d.v_)(a),1),(0,s.Lk)("div",Cbe,[(0,s.Lk)("div",{class:"category-bar",style:(0,d.Tr)({width:n.calculateCategoryBarWidth(e)+"%"})},null,4)]),(0,s.Lk)("div",Lbe,(0,d.v_)(e),1)]))),128))])):(0,s.Q3)("",!0)])])],512),[[i.aG,n.isVisible("assessment-review")]]),(0,s.bo)((0,s.Lk)("div",wbe,[a[86]||(a[86]=(0,s.Lk)("div",{class:"kpi-title"},"RISK ASSESSMENT CONSENSUS",-1)),(0,s.Lk)("div",Ebe,[(0,s.eW)((0,d.v_)(l.consensusData.consensusPercentage||"75"),1),a[77]||(a[77]=(0,s.Lk)("span",{class:"percent"},"%",-1)),a[78]||(a[78]=(0,s.Lk)("span",{class:"consensus-label"},"agreement",-1))]),(0,s.Lk)("div",Rbe,[(0,s.Lk)("div",Dbe,[((0,s.uX)(),(0,s.CE)("svg",Ibe,[a[79]||(a[79]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"#f8fafc",stroke:"#e5e7eb","stroke-width":"1"},null,-1)),(0,s.Lk)("path",{d:n.generateArcPath(35,35,30,0,l.consensusData.consensusPercentage||75),fill:"#3b82f6"},null,8,Pbe),(0,s.Lk)("path",{d:n.generateArcPath(35,35,30,l.consensusData.consensusPercentage||75,100),fill:"#ef4444"},null,8,_be),a[80]||(a[80]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"15",fill:"white"},null,-1))]))]),(0,s.Lk)("div",Sbe,[(0,s.Lk)("div",Abe,[a[81]||(a[81]=(0,s.Lk)("div",{class:"legend-color consensus"},null,-1)),a[82]||(a[82]=(0,s.Lk)("div",{class:"legend-label"},"Consensus",-1)),(0,s.Lk)("div",Tbe,(0,d.v_)(l.consensusData.consensusCount||"90"),1)]),(0,s.Lk)("div",xbe,[a[83]||(a[83]=(0,s.Lk)("div",{class:"legend-color no-consensus"},null,-1)),a[84]||(a[84]=(0,s.Lk)("div",{class:"legend-label"},"No Consensus",-1)),(0,s.Lk)("div",Fbe,(0,d.v_)(l.consensusData.noConsensusCount||"30"),1)])])]),(0,s.Lk)("div",Vbe,[a[85]||(a[85]=(0,s.Lk)("div",{class:"investigation-title"},"Needs Investigation",-1)),l.consensusData.lowConsensusRisks&&l.consensusData.lowConsensusRisks.length>0?((0,s.uX)(),(0,s.CE)("div",Mbe,[(0,s.Lk)("div",Xbe,[(0,s.Lk)("div",Ube,(0,d.v_)(l.consensusData.lowConsensusRisks[0].title),1),(0,s.Lk)("div",Nbe,(0,d.v_)(l.consensusData.lowConsensusRisks[0].agreement)+" agreed",1)])])):(0,s.Q3)("",!0)])],512),[[i.aG,n.isVisible("assessment-consensus")]]),(0,s.bo)((0,s.Lk)("div",$be,a[87]||(a[87]=[(0,s.Lk)("div",{class:"kpi-title"},"RISK ASSESSMENT CONSENSUS",-1)]),512),[[i.aG,!1]]),(0,s.bo)((0,s.Lk)("div",Obe,[a[94]||(a[94]=(0,s.Lk)("div",{class:"kpi-title"},"RISK APPROVAL RATE AND CYCLE",-1)),(0,s.Lk)("div",jbe,[(0,s.eW)((0,d.v_)(l.approvalRateData.approvalRate||"81"),1),a[88]||(a[88]=(0,s.Lk)("span",{class:"percent"},"%",-1)),a[89]||(a[89]=(0,s.Lk)("span",{class:"approval-label"},"approval rate",-1))]),(0,s.Lk)("div",Bbe,[(0,s.Lk)("div",Wbe,[a[90]||(a[90]=(0,s.Lk)("div",{class:"metric-icon"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"#3b82f6"},[(0,s.Lk)("path",{d:"M12 12.75c1.148 0 2.278.08 3.383.237 1.037.146 1.866.966 1.866 2.013 0 3.728-2.35 6.75-5.25 6.75S6.75 18.728 6.75 15c0-1.046.83-1.867 1.866-2.013A24.204 24.204 0 0 1 12 12.75Z"}),(0,s.Lk)("path",{d:"M12 8.25a2.25 2.25 0 0 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z"})])],-1)),(0,s.Lk)("div",Qbe,(0,d.v_)(l.approvalRateData.avgReviewCycles||"3.2"),1),a[91]||(a[91]=(0,s.Lk)("div",{class:"metric-label"},"Avg. Review Cycles",-1))]),(0,s.Lk)("div",qbe,[a[92]||(a[92]=(0,s.Lk)("div",{class:"metric-icon"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"#3b82f6"},[(0,s.Lk)("path",{d:"M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75ZM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 0 1-1.875-1.875V8.625ZM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 0 1 3 19.875v-6.75Z"})])],-1)),(0,s.Lk)("div",Kbe,(0,d.v_)(l.approvalRateData.maxReviewCycles||"4"),1),a[93]||(a[93]=(0,s.Lk)("div",{class:"metric-label"},"Max Review Cycles",-1))])])],512),[[i.aG,n.isVisible("approval-rate-cycle")]]),(0,s.bo)((0,s.Lk)("div",Jbe,[a[101]||(a[101]=(0,s.Lk)("div",{class:"kpi-title"},"RISK REDUCTION TREND",-1)),(0,s.Lk)("div",zbe,[(0,s.eW)((0,d.v_)(l.reductionData.reductionPercentage||"25"),1),a[95]||(a[95]=(0,s.Lk)("span",{class:"percent"},"%",-1)),a[96]||(a[96]=(0,s.Lk)("span",{class:"reduction-label"},"reduction",-1))]),(0,s.Lk)("div",Hbe,[(0,s.Lk)("div",{class:"waterfall-bar start",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.startCount)})},[(0,s.Lk)("div",Ybe,(0,d.v_)(l.reductionData.startCount),1)],4),a[97]||(a[97]=(0,s.Lk)("div",{class:"connector-line"},null,-1)),(0,s.Lk)("div",{class:"waterfall-bar new",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.newCount)})},[(0,s.Lk)("div",Gbe,"+"+(0,d.v_)(l.reductionData.newCount),1)],4),a[98]||(a[98]=(0,s.Lk)("div",{class:"connector-line"},null,-1)),(0,s.Lk)("div",{class:"waterfall-bar mitigated",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.mitigatedCount)})},[(0,s.Lk)("div",Zbe,"-"+(0,d.v_)(l.reductionData.mitigatedCount),1)],4),a[99]||(a[99]=(0,s.Lk)("div",{class:"connector-line"},null,-1)),(0,s.Lk)("div",{class:"waterfall-bar end",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.endCount)})},[(0,s.Lk)("div",eCe,(0,d.v_)(l.reductionData.endCount),1)],4),a[100]||(a[100]=(0,s.Lk)("div",{class:"waterfall-labels"},[(0,s.Lk)("span",null,"Start"),(0,s.Lk)("span",null,"New"),(0,s.Lk)("span",null,"Mitigated"),(0,s.Lk)("span",null,"End")],-1))])],512),[[i.aG,n.isVisible("risk-reduction-trend")]]),(0,s.bo)((0,s.Lk)("div",aCe,[a[104]||(a[104]=(0,s.Lk)("div",{class:"kpi-title"},"RISK MITIGATION COMPLETION RATE",-1)),(0,s.Lk)("div",tCe,[(0,s.eW)((0,d.v_)(l.kpiData.mitigationCompletionRate||"76"),1),a[102]||(a[102]=(0,s.Lk)("span",{class:"percent"},"%",-1))]),(0,s.Lk)("div",iCe,[(0,s.Lk)("div",{class:"progress-fill",style:(0,d.Tr)({width:(l.kpiData.mitigationCompletionRate||76)+"%"})},null,4)]),(0,s.Lk)("div",sCe,[(0,s.Lk)("div",oCe,[a[103]||(a[103]=(0,s.eW)("Avg. Time to Mitigation: ")),(0,s.Lk)("span",lCe,(0,d.v_)(l.mitigationData.avgDays||"14")+" days",1)]),(0,s.Lk)("div",{class:(0,d.C4)(["sla-indicator",{"sla-warning":l.mitigationData.avgDays>l.mitigationData.slaDays}])}," SLA: "+(0,d.v_)(l.mitigationData.slaDays||"21")+" days ",3)])],512),[[i.aG,n.isVisible("mitigation-completion")]]),(0,s.bo)((0,s.Lk)("div",nCe,[a[107]||(a[107]=(0,s.Lk)("div",{class:"kpi-title"},"PROBABILITY OF RISK RECURRENCE",-1)),(0,s.Lk)("div",rCe,[(0,s.eW)((0,d.v_)(l.recurrenceProbabilityData.averageProbability||"38"),1),a[105]||(a[105]=(0,s.Lk)("span",{class:"percent"},"%",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.recurrenceProbabilityData.percentageChange>0,down:l.recurrenceProbabilityData.percentageChange<0}])},(0,d.v_)(l.recurrenceProbabilityData.percentageChange>0?"â†‘":"â†“")+" "+(0,d.v_)(Math.abs(l.recurrenceProbabilityData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",cCe,[(0,s.Lk)("div",dCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceProbabilityData.probabilityRanges||l.defaultProbabilityRanges,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"prob-"+a,class:(0,d.C4)(["histogram-bar",n.getBarClass(e.range)]),style:(0,d.Tr)({height:n.calculateHistogramBarHeight(e.count)+"%"})},[(0,s.Lk)("div",uCe,(0,d.v_)(e.count),1)],6))),128))]),(0,s.Lk)("div",pCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceProbabilityData.probabilityRanges||l.defaultProbabilityRanges,(e,a)=>((0,s.uX)(),(0,s.CE)("span",{key:"label-"+a,class:"range-label"},(0,d.v_)(e.range),1))),128))])]),l.recurrenceProbabilityData.highRecurrenceRisks&&l.recurrenceProbabilityData.highRecurrenceRisks.length>0?((0,s.uX)(),(0,s.CE)("div",vCe,[a[106]||(a[106]=(0,s.Lk)("div",{class:"high-prob-title"},"Highest Probability Risk",-1)),(0,s.Lk)("div",mCe,[(0,s.Lk)("div",kCe,(0,d.v_)(l.recurrenceProbabilityData.highRecurrenceRisks[0].title),1),(0,s.Lk)("div",hCe,(0,d.v_)(l.recurrenceProbabilityData.highRecurrenceRisks[0].probability)+"%",1)])])):(0,s.Q3)("",!0)],512),[[i.aG,n.isVisible("recurrence-probability")]]),(0,s.bo)((0,s.Lk)("div",gCe,[a[108]||(a[108]=(0,s.Lk)("div",{class:"kpi-title"},"RISK TOLERANCE THRESHOLDS",-1)),(0,s.Lk)("div",yCe,[(0,s.Lk)("span",{class:(0,d.C4)(["tolerance-status",n.getToleranceStatusClass(l.toleranceData.overallStatus)])},(0,d.v_)(l.toleranceData.overallStatus||"Near Limits"),3)]),(0,s.Lk)("div",fCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.toleranceData.toleranceThresholds||l.defaultToleranceThresholds,(e,a)=>((0,s.uX)(),(0,s.CE)("div",{key:"tolerance-"+a,class:"tolerance-category"},[(0,s.Lk)("div",bCe,[(0,s.Lk)("div",CCe,(0,d.v_)(a),1),(0,s.Lk)("div",{class:(0,d.C4)(["category-status",n.getCategoryStatusClass(e.status)])},(0,d.v_)(e.status),3)]),(0,s.Lk)("div",LCe,[(0,s.Lk)("div",{class:(0,d.C4)(["tolerance-bar","status-"+e.status.toLowerCase()]),style:(0,d.Tr)({width:Math.min(100,e.percentage)+"%"})},null,6)])]))),128))])],512),[[i.aG,n.isVisible("tolerance-thresholds")]]),(0,s.bo)((0,s.Lk)("div",wCe,[a[112]||(a[112]=(0,s.Lk)("div",{class:"kpi-title"},"RISK APPETITE BASED ON TOLERANCE LEVEL",-1)),(0,s.Lk)("div",ECe,[(0,s.Lk)("div",RCe,(0,d.v_)(l.appetiteData.currentLevel||6),1),a[109]||(a[109]=(0,s.Lk)("div",{class:"unit-label"},"/10",-1)),(0,s.Lk)("div",DCe,(0,d.v_)(l.appetiteData.description||"Balanced risk approach"),1)]),(0,s.Lk)("div",ICe,[(0,s.Lk)("div",PCe,[a[110]||(a[110]=(0,s.Lk)("div",{class:"appetite-gradient-bar"},null,-1)),(0,s.Lk)("div",{class:"appetite-marker",style:(0,d.Tr)({left:10*(l.appetiteData.currentLevel||6)+"%"})},null,4)]),a[111]||(a[111]=(0,s.Lk)("div",{class:"appetite-labels"},[(0,s.Lk)("span",{class:"label-left"},"Risk Averse"),(0,s.Lk)("span",{class:"label-center"},"Balanced"),(0,s.Lk)("span",{class:"label-right"},"Risk Seeking")],-1))])],512),[[i.aG,n.isVisible("risk-appetite")]])])])}var SCe={name:"RiskKPI",data(){return{selectedCategory:"risk-profile",kpiCategories:{"risk-profile":["active-risks","high-criticality","identification-rate","rate-recurrence","improvement-initiatives","assessment-review","register-update","approval-rate-cycle"],"risk-exposure":["risk-exposure","risk-severity","risk-impact","exposure-score","tolerance-thresholds","risk-appetite","risk-resilience","risk-reduction-trend"],"risk-mitigation":["avg-remediation","mitigation-completion","avg-remediation","avg-response","cost-mitigation","recurrence-probability","due-mitigation"]},kpiData:{},activeRisksData:{current:0,months:[],trendData:[],percentageChange:0},exposureData:{current:0,months:[],trendData:[],percentageChange:0},reductionData:{startCount:0,newCount:0,mitigatedCount:0,endCount:0,reductionPercentage:0},criticalityData:{count:0,highCount:0,criticalCount:0,percentage:0,months:[],trendData:[]},mitigationData:{avgDays:0,slaDays:0,trendData:[],months:[]},remediationData:{current:0,slaThreshold:30,trendData:[],months:[],percentageChange:0},recurrenceData:{recurrenceRate:0,oneTimeRate:0,percentageChange:0,trendData:[],months:[],breakdown:null},responseData:{current:0,target:4,sla:8,percentageChange:0,trendData:[],months:[],delayedResponses:0},mitigationCostData:{totalCost:0,avgCost:0,highestCost:0,highestCategory:"",percentageChange:0,monthlyData:[]},identificationData:{current:0,dailyAverage:0,percentageChange:0,trendData:[],months:[],minValue:0,maxValue:0},dueMitigationData:{overduePercentage:0,completedPercentage:0,pendingPercentage:0,overdueCount:0,totalCount:0,percentageChange:0},classificationData:{accuracy:0,percentageChange:0,categoryAccuracy:null,timeSeriesData:[]},initiativeData:{completionPercentage:0,totalCount:0,completedCount:0,pendingCount:0,categoryBreakdown:null},impactData:{overallScore:0,impactDistribution:null,topRisks:null},severityData:{severityDistribution:null,severityPercentages:null,averageSeverity:0,trendData:[],topSevereRisks:[]},defaultTopRisks:[{id:1,title:"Service Outage",operational_impact:8.5,financial_impact:9.2,category:"Operational"},{id:2,title:"Data Breach",operational_impact:7.2,financial_impact:9.5,category:"Security"},{id:3,title:"Compliance Violation",operational_impact:6.8,financial_impact:8.1,category:"Compliance"},{id:4,title:"Supply Chain Disruption",operational_impact:9.1,financial_impact:7.4,category:"Operational"},{id:5,title:"Market Volatility",operational_impact:5.6,financial_impact:8.7,category:"Financial"}],exposureScoreData:{overallScore:0,riskPoints:[],categoryDistribution:{}},resilienceData:{avgDowntime:0,avgRecovery:0,categoryData:[],trendData:[],months:[]},defaultResilienceData:[{category:"Infrastructure",downtime:6,recovery:8},{category:"Application",downtime:3,recovery:5},{category:"Network",downtime:5,recovery:7},{category:"Security",downtime:7,recovery:9}],assessmentData:{avgReviewFrequency:0,categoryFrequencies:{},mostReviewed:[],overdueReviews:[],months:[],monthlyReviews:[],overdueCount:0,totalRisks:0},consensusData:{consensusPercentage:0,totalAssessments:0,consensusCount:0,noConsensusCount:0,categoryConsensus:{},lowConsensusRisks:[],months:[],monthlyConsensus:[]},registerUpdateData:{avgUpdateFrequency:0,months:[],monthlyUpdates:[],stagnantRisks:[],categoryFrequencies:{},dailyUpdates:[],stagnantCount:0},recurrenceProbabilityData:{averageProbability:0,probabilityRanges:[],highRecurrenceRisks:[],trendData:[],months:[],percentageChange:0,totalRisks:0},defaultProbabilityRanges:[{range:"0-20%",count:20,label:"Very Low",percentage:20},{range:"21-40%",count:30,label:"Low",percentage:30},{range:"41-60%",count:25,label:"Medium",percentage:25},{range:"61-80%",count:15,label:"High",percentage:15},{range:"81-100%",count:10,label:"Very High",percentage:10}],toleranceData:{overallStatus:"",toleranceThresholds:{},alerts:[],historicalData:{},months:[]},defaultToleranceThresholds:{Security:{max_exposure:80,current_exposure:75,unit:"score",percentage:93.8,status:"Warning"},Compliance:{max_exposure:75,current_exposure:62,unit:"score",percentage:82.7,status:"Normal"},Operational:{max_exposure:70,current_exposure:75,unit:"score",percentage:107.1,status:"Exceeded"}},appetiteData:{currentLevel:6,description:"",historicalLevels:[],dates:[],lastUpdated:"",approvedBy:"",levelDescriptions:{}},identificationPeriod:"30days",dueMitigationPeriod:"30days",mitigationCostPeriod:"30days",severityDistribution:{Low:0,Medium:0,High:0,Critical:0},severityPercentages:{Low:0,Medium:0,High:0,Critical:0},averageSeverity:0,trendData:[],topSevereRisks:[],mostSevereRisk:"Loading...",approvalRateData:{approvalRate:0,avgReviewerCount:0,avgCycleDays:0,totalRisks:0,approvedRisks:0,pendingRisks:0,months:[],monthlyApprovalRates:[],monthlyCycleDays:[],pendingApprovalRisks:[]},identificationRate:null,identificationChange:null,avgDailyRisks:null,identificationTrend:null,identificationMonths:null}},mounted(){this.fetchKpiData(),this.fetchActiveRisksTrend(),this.fetchExposureTrend(),this.fetchReductionTrend(),this.fetchCriticalityData(),this.fetchMitigationData(),this.fetchRemediationData(),this.fetchRecurrenceData(),this.fetchResponseData(),this.fetchIdentificationData(),this.fetchDueMitigationData(),this.fetchClassificationData(),this.fetchInitiativeData(),this.fetchImpactData(),this.fetchSeverityData(),this.fetchExposureScoreData(),this.fetchResilienceData(),this.fetchAssessmentFrequencyData(),this.fetchAssessmentConsensusData(),this.fetchRegisterUpdateFrequency(),this.fetchRecurrenceProbability(),this.fetchToleranceThresholds(),this.fetchRiskAppetite(),this.fetchRiskSeverity(),this.fetchIdentificationRate()},methods:{async fetchKpiData(){try{const e=await fetch("/api/risk/kpi-data/");e.ok?this.kpiData=await e.json():(console.error("Failed to fetch KPI data"),this.setFallbackData())}catch(e){if(console.error("Error fetching KPI data:",e),ht.wr.handleApiError(e))return;this.setFallbackData()}},async fetchActiveRisksTrend(){try{console.log("Fetching active risks data from backend...");const e=await fetch("http://localhost:8000/api/risk/active-risks-kpi/");if(console.log("Response status:",e.status),e.ok){const a=await e.json();console.log("Active risks data received:",a),this.activeRisksData=a,this.kpiData={...this.kpiData,activeRisks:a.current},console.log("Updated KPI data with active risks:",this.kpiData.activeRisks)}else console.error("Failed to fetch active risks trend:",e.status,e.statusText),this.setFallbackActiveRisksTrend()}catch(e){if(console.error("Error fetching active risks trend:",e),ht.wr.handleApiError(e))return;this.setFallbackActiveRisksTrend()}},async fetchExposureTrend(){try{console.log("Fetching risk exposure data from backend...");const e=await fetch("http://localhost:8000/api/risk/exposure-trend/");if(console.log("Exposure trend response status:",e.status),e.ok){const a=await e.json();console.log("Risk exposure data received:",a),this.exposureData=a,this.kpiData={...this.kpiData,riskExposure:a.current},console.log("Updated KPI data with risk exposure:",this.kpiData.riskExposure)}else console.error("Failed to fetch exposure trend:",e.status,e.statusText),this.setFallbackExposureTrend()}catch(e){if(console.error("Error fetching exposure trend:",e),ht.wr.handleApiError(e))return;this.setFallbackExposureTrend()}},async fetchReductionTrend(){try{console.log("Fetching risk reduction trend data from backend...");const e=await fetch("http://localhost:8000/api/risk/reduction-trend/");if(console.log("Risk reduction trend response status:",e.status),e.ok){const a=await e.json();console.log("Risk reduction trend data received:",a),this.reductionData=a,console.log("Updated reduction trend data with startCount:",a.startCount,"newCount:",a.newCount,"mitigatedCount:",a.mitigatedCount,"endCount:",a.endCount,"reductionPercentage:",a.reductionPercentage)}else console.error("Failed to fetch reduction trend:",e.status,e.statusText),this.setFallbackReductionTrend()}catch(e){if(console.error("Error fetching reduction trend:",e),ht.wr.handleApiError(e))return;this.setFallbackReductionTrend()}},async fetchCriticalityData(){try{console.log("Fetching high criticality risks data from backend...");const e=await fetch("http://localhost:8000/api/risk/high-criticality/");if(console.log("High criticality risks response status:",e.status),e.ok){const a=await e.json();console.log("High criticality risks data received:",a),this.criticalityData=a,this.kpiData={...this.kpiData,highCriticalityRisks:a.count,highCount:a.highCount,criticalCount:a.criticalCount},console.log("Updated KPI data with high criticality risks:",this.kpiData.highCriticalityRisks)}else console.error("Failed to fetch criticality data:",e.status,e.statusText),this.setFallbackCriticalityData()}catch(e){if(console.error("Error fetching criticality data:",e),ht.wr.handleApiError(e))return;this.setFallbackCriticalityData()}},async fetchMitigationData(){try{console.log("Fetching mitigation completion rate data from backend...");const e=await fetch("http://localhost:8000/api/risk/mitigation-completion-rate/");if(console.log("Mitigation completion rate response status:",e.status),e.ok){const a=await e.json();console.log("Mitigation completion rate data received:",a),this.mitigationData={avgDays:a.avgDays,slaDays:a.slaDays,trendData:a.trendData,months:a.months},this.kpiData={...this.kpiData,mitigationCompletionRate:a.completionRate},console.log("Updated KPI data with mitigation completion rate:",this.kpiData.mitigationCompletionRate)}else console.error("Failed to fetch mitigation completion rate data:",e.status,e.statusText),this.setFallbackMitigationData()}catch(e){if(console.error("Error fetching mitigation completion rate data:",e),ht.wr.handleApiError(e))return;this.setFallbackMitigationData()}},async fetchRemediationData(){try{console.log("Fetching average remediation time data from backend...");const e=await fetch("http://localhost:8000/api/risk/avg-remediation-time/");if(console.log("Remediation time response status:",e.status),e.ok){const a=await e.json();console.log("Average remediation time data received:",a),this.remediationData={current:a.current,slaThreshold:a.slaDays,trendData:a.trendData,months:a.months,percentageChange:a.percentageChange,overdueCount:a.overdueCount,overduePercentage:a.overduePercentage,totalActive:a.totalActive,minValue:a.minValue,maxValue:a.maxValue},this.kpiData={...this.kpiData,avgRemediationTime:a.current},console.log("Updated KPI data with avg remediation time:",this.kpiData.avgRemediationTime)}else console.error("Failed to fetch remediation time data:",e.status,e.statusText),this.setFallbackRemediationData()}catch(e){if(console.error("Error fetching remediation time data:",e),ht.wr.handleApiError(e))return;this.setFallbackRemediationData()}},async fetchRecurrenceData(){try{console.log("Fetching recurrence rate data from backend...");const e=await fetch("http://localhost:8000/api/risk/recurrence-rate/");if(console.log("Recurrence rate response status:",e.status),e.ok){const a=await e.json();console.log("Recurrence rate data received:",a),this.recurrenceData={recurrenceRate:a.recurrenceRate,oneTimeRate:a.oneTimeRate,percentageChange:a.percentageChange,trendData:a.trendData,months:a.months,breakdown:a.breakdown,totalRisks:a.totalRisks,recurringRisks:a.recurringRisks,oneTimeRisks:a.oneTimeRisks,topRecurringRisks:a.topRecurringRisks},this.kpiData={...this.kpiData,recurrenceRate:a.recurrenceRate},console.log("Updated KPI data with recurrence rate:",this.kpiData.recurrenceRate)}else console.error("Failed to fetch recurrence data:",e.status,e.statusText),this.setFallbackRecurrenceData()}catch(e){if(console.error("Error fetching recurrence data:",e),ht.wr.handleApiError(e))return;this.setFallbackRecurrenceData()}},async fetchResponseData(){try{console.log("Fetching incident response time data from backend...");const e=await fetch("http://localhost:8000/api/risk/avg-incident-response-time/");if(console.log("Incident response time response status:",e.status),e.ok){const a=await e.json();console.log("Incident response time data received:",a),this.responseData={current:a.current,target:a.target,sla:a.sla,percentageChange:a.percentageChange,trendData:a.trendData,months:a.months,delayedCount:a.delayedCount,delayedPercentage:a.delayedPercentage,totalIncidents:a.totalIncidents},this.kpiData={...this.kpiData,avgResponseTime:a.current},console.log("Updated KPI data with avg response time:",this.kpiData.avgResponseTime)}else console.error("Failed to fetch incident response time data:",e.status,e.statusText),this.setFallbackResponseData()}catch(e){if(console.error("Error fetching incident response time data:",e),ht.wr.handleApiError(e))return;this.setFallbackResponseData()}},async fetchMitigationCostData(){try{console.log("Fetching mitigation cost data...");const e=await fetch(`/api/risk/mitigation-cost/?timeRange=${this.mitigationCostPeriod}`);e.ok?(this.mitigationCostData=await e.json(),console.log("Mitigation cost data received:",this.mitigationCostData)):(console.error("Failed to fetch mitigation cost data:",e.status,e.statusText),this.setFallbackMitigationCostData())}catch(e){if(console.error("Error fetching mitigation cost data:",e),ht.wr.handleApiError(e))return;this.setFallbackMitigationCostData()}},async fetchIdentificationData(){try{console.log("Fetching risk identification rate data...");const e=await fetch(`/api/risk/identification-rate/?timeRange=${this.identificationPeriod}`);e.ok?(this.identificationData=await e.json(),console.log("Risk identification rate data received:",this.identificationData)):(console.error("Failed to fetch identification rate data:",e.status,e.statusText),this.setFallbackIdentificationData())}catch(e){if(console.error("Error fetching identification rate data:",e),ht.wr.handleApiError(e))return;this.setFallbackIdentificationData()}},async fetchDueMitigationData(){try{console.log("Fetching due mitigation data...");const e=await fetch(`/api/risk/due-mitigation/?timeRange=${this.dueMitigationPeriod}`);e.ok?(this.dueMitigationData=await e.json(),console.log("Due mitigation data received:",this.dueMitigationData)):(console.error("Failed to fetch due mitigation data:",e.status,e.statusText),this.setFallbackDueMitigationData())}catch(e){if(console.error("Error fetching due mitigation data:",e),ht.wr.handleApiError(e))return;this.setFallbackDueMitigationData()}},async fetchClassificationData(){try{const e=await fetch("/api/risk/classification-accuracy/");e.ok?this.classificationData=await e.json():(console.error("Failed to fetch classification accuracy data"),this.setFallbackClassificationData())}catch(e){if(console.error("Error fetching classification accuracy data:",e),ht.wr.handleApiError(e))return;this.setFallbackClassificationData()}},async fetchInitiativeData(){try{console.log("============================================"),console.log("Fetching improvement initiatives data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"";console.log("Base URL for API calls:",e);const a=`${e}/api/risk/improvement-initiatives/`;console.log("Full URL for improvement initiatives API:",a);const t=await fetch(a);if(console.log("Improvement initiatives response status:",t.status),console.log("Improvement initiatives response headers:",t.headers),t.ok){const e=await t.json();console.log("Improvement initiatives data received:",e),console.log("Received completionPercentage:",e.completionPercentage),console.log("Received completedCount:",e.completedCount),console.log("Received totalCount:",e.totalCount),this.initiativeData=e,console.log("Component state after assignment:",this.initiativeData),console.log("============================================")}else console.error("Failed to fetch initiative data:",t.status,t.statusText),this.setFallbackInitiativeData()}catch(e){if(console.error("Error fetching initiative data:",e),ht.wr.handleApiError(e))return;this.setFallbackInitiativeData()}},async fetchImpactData(){try{console.log("============================================"),console.log("Fetching risk impact data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"";console.log("Base URL for API calls:",e);const a=`${e}/api/risk/impact/`;console.log("Full URL for risk impact API:",a);const t=await fetch(a);if(console.log("Risk impact response status:",t.status),console.log("Risk impact response headers:",t.headers),t.ok){const e=await t.json();console.log("Risk impact data received:",e),console.log("Received overallScore:",e.overallScore),console.log("Received top risks:",e.topRisks?.length||0),console.log("Received total risks:",e.total_risks),this.impactData=e,console.log("Component state after assignment:",this.impactData),console.log("============================================")}else console.error("Failed to fetch impact data:",t.status,t.statusText),this.setFallbackImpactData()}catch(e){if(console.error("Error fetching impact data:",e),ht.wr.handleApiError(e))return;this.setFallbackImpactData()}},async fetchSeverityData(){try{const e=await fetch("/api/risk/severity/");e.ok?this.severityData=await e.json():(console.error("Failed to fetch severity data"),this.setFallbackSeverityData())}catch(e){if(console.error("Error fetching severity data:",e),ht.wr.handleApiError(e))return;this.setFallbackSeverityData()}},async fetchExposureScoreData(){try{const e=await fetch("http://localhost:8000/api/risk/exposure-score/");e.ok?this.exposureScoreData=await e.json():(console.error("Failed to fetch exposure score data"),this.setFallbackExposureScoreData())}catch(e){if(console.error("Error fetching exposure score data:",e),ht.wr.handleApiError(e))return;this.setFallbackExposureScoreData()}},async fetchResilienceData(){try{console.log("Fetching risk resilience data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await fetch(`${e}/api/risk/resilience/`);if(console.log("Risk resilience response status:",a.status),a.ok){const e=await a.json();console.log("Risk resilience data received:",e),this.resilienceData=e,console.log("Resilience data in component:",this.resilienceData)}else console.error("Failed to fetch resilience data:",a.status,a.statusText),this.setFallbackResilienceData()}catch(e){if(console.error("Error fetching resilience data:",e),ht.wr.handleApiError(e))return;this.setFallbackResilienceData()}},async fetchAssessmentFrequencyData(){try{const e=await fetch("/api/risk/assessment-frequency/");e.ok?this.assessmentData=await e.json():(console.error("Failed to fetch assessment frequency data"),this.setFallbackAssessmentData())}catch(e){if(console.error("Error fetching assessment frequency data:",e),ht.wr.handleApiError(e))return;this.setFallbackAssessmentData()}},async fetchAssessmentConsensusData(){try{const e=await fetch("/api/risk/assessment-consensus/");e.ok?this.consensusData=await e.json():(console.error("Failed to fetch assessment consensus data"),this.setFallbackConsensusData())}catch(e){if(console.error("Error fetching assessment consensus data:",e),ht.wr.handleApiError(e))return;this.setFallbackConsensusData()}await this.fetchApprovalRateData()},async fetchApprovalRateData(){try{console.log("Fetching risk approval rate and cycle data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await fetch(`${e}/api/risk/approval-rate-cycle/`);if(console.log("Approval rate cycle response status:",a.status),a.ok){const e=await a.json();console.log("Risk approval rate and cycle data received:",e),this.approvalRateData=e}else console.error("Failed to fetch approval rate data"),this.setFallbackApprovalRateData()}catch(e){if(console.error("Error fetching approval rate data:",e),ht.wr.handleApiError(e))return;this.setFallbackApprovalRateData()}},setFallbackApprovalRateData(){this.approvalRateData={approvalRate:81,avgReviewCycles:3.2,maxReviewCycles:4}},async fetchRegisterUpdateFrequency(){try{console.log("Fetching risk register update frequency data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await fetch(`${e}/api/risk/register-update-frequency/`);if(console.log("Register update frequency response status:",a.status),a.ok){const e=await a.json();console.log("Risk register update frequency data received:",e),this.registerUpdateData=e}else console.error("Failed to fetch register update frequency data"),this.setFallbackRegisterUpdateData()}catch(e){if(console.error("Error fetching register update frequency data:",e),ht.wr.handleApiError(e))return;this.setFallbackRegisterUpdateData()}},async fetchRecurrenceProbability(){try{console.log("Fetching risk recurrence probability data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await fetch(`${e}/api/risk/recurrence-probability/`);if(console.log("Risk recurrence probability response status:",a.status),a.ok){const e=await a.json();console.log("Risk recurrence probability data received:",e),console.log("Received averageProbability:",e.averageProbability),console.log("Received percentageChange:",e.percentageChange),console.log("Received probabilityRanges:",e.probabilityRanges),console.log("Received highRecurrenceRisks:",e.highRecurrenceRisks),this.recurrenceProbabilityData=e,console.log("Component state after assignment:",this.recurrenceProbabilityData)}else console.error("Failed to fetch recurrence probability data"),this.setFallbackRecurrenceProbabilityData()}catch(e){console.error("Error fetching recurrence probability data:",e),this.setFallbackRecurrenceProbabilityData()}},async fetchToleranceThresholds(){try{console.log("Fetching risk tolerance thresholds data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await fetch(`${e}/api/risk/tolerance-thresholds/`);if(console.log("Risk tolerance thresholds API response status:",a.status),a.ok){const e=await a.json();console.log("Risk tolerance thresholds data received:",e),this.toleranceData=e}else console.error("Failed to fetch tolerance thresholds data:",a.status,a.statusText),this.setFallbackToleranceData()}catch(e){console.error("Error fetching tolerance thresholds data:",e),this.setFallbackToleranceData()}},async fetchRiskAppetite(){try{console.log("Fetching risk appetite data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await fetch(`${e}/api/risk/appetite/`);if(console.log("Risk appetite API response status:",a.status),a.ok){const e=await a.json();console.log("Risk appetite data received:",e),this.appetiteData=e}else console.error("Failed to fetch risk appetite data:",a.status,a.statusText),this.setFallbackAppetiteData()}catch(e){console.error("Error fetching risk appetite data:",e),this.setFallbackAppetiteData()}},async fetchRiskSeverity(){try{console.log("Fetching risk severity data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",a=await qe.A.get(`${e}/api/risk/severity/`);if(console.log("Risk severity API response:",a),200===a.status&&a.data)if(console.log("Risk severity data received:",a.data),this.severityDistribution=a.data.severityDistribution||{Low:20,Medium:40,High:25,Critical:15},this.severityPercentages=a.data.severityPercentages||{Low:20,Medium:40,High:25,Critical:15},this.averageSeverity=a.data.averageSeverity||6.8,this.trendData=a.data.trendData||[],this.topSevereRisks=a.data.topSevereRisks||[],this.topSevereRisks&&this.topSevereRisks.length>0){const e=this.topSevereRisks[0];this.mostSevereRisk=`${e.title} (${e.severity})`}else this.mostSevereRisk="No data";else console.error("Invalid response from risk severity API"),this.setFallbackSeverityData()}catch(e){console.error("Error fetching risk severity data:",e),this.setFallbackSeverityData()}},setFallbackData(){this.kpiData={activeRisks:48,riskExposure:872,riskRecurrence:6.5,mitigationCompletionRate:76,avgRemediationTime:35,recurrenceRate:6.5,avgResponseTime:6,mitigationCost:184,identificationRate:88,dueMitigation:22,classificationAccuracy:88,exposureScore:75,resilienceHours:5,months:["J","F","M","A","M","J"],riskReductionTrend:{start:45,new:15,end:35}}},setFallbackActiveRisksTrend(){const e=[41,45,43,48,45,48];this.activeRisksData={current:48,months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:e,percentageChange:4.3,minValue:Math.min(...e),maxValue:Math.max(...e),range:Math.max(...e)-Math.min(...e)}},setFallbackExposureTrend(){const e=[820,845,860,880,865,872];this.exposureData={current:872,months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:e,percentageChange:.8,minValue:Math.min(...e),maxValue:Math.max(...e),range:Math.max(...e)-Math.min(...e)}},setFallbackReductionTrend(){this.reductionData={startCount:45,newCount:15,mitigatedCount:25,endCount:35,reductionPercentage:25}},setFallbackCriticalityData(){this.criticalityData={count:6,highCount:4,criticalCount:2,percentage:8.5,months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:[5,4,6,7,5,6]},this.kpiData={...this.kpiData,highCriticalityRisks:this.criticalityData.count}},setFallbackMitigationData(){this.mitigationData={avgDays:14,slaDays:21,trendData:[18,16,14,15,13,14],months:["Jan","Feb","Mar","Apr","May","Jun"]},this.kpiData={...this.kpiData,mitigationCompletionRate:76}},setFallbackRemediationData(){const e=[38,36,35,37,34,35];this.remediationData={current:35,slaThreshold:30,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],percentageChange:2.5,overdueCount:12,overduePercentage:15,totalActive:80,minValue:Math.min(...e),maxValue:Math.max(...e)}},setFallbackRecurrenceData(){const e=[5.8,6.2,6.7,6.3,6.8,6.5];this.recurrenceData={recurrenceRate:6.5,oneTimeRate:93.5,totalRisks:200,recurringRisks:13,oneTimeRisks:187,percentageChange:-.3,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],breakdown:{Security:8.4,Compliance:5.2,Operational:7.3,Financial:4.8},topRecurringRisks:[{id:1,title:"System Outage",category:"Operational",count:4,owner:"IT Department"},{id:2,title:"Data Quality Issues",category:"Technology",count:3,owner:"Data Team"},{id:3,title:"Vendor Delivery Delays",category:"Supply Chain",count:3,owner:"Procurement"},{id:4,title:"Staff Turnover",category:"HR",count:2,owner:"HR Department"},{id:5,title:"Security Breach",category:"Security",count:2,owner:"Security Team"}]}},setFallbackResponseData(){const e=[7.2,6.8,6.5,6.3,6.1,6];this.responseData={current:6,target:4,sla:8,percentageChange:-1.6,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],delayedCount:8,delayedPercentage:12.5,totalIncidents:64,minValue:Math.min(...e),maxValue:Math.max(...e)},this.kpiData={...this.kpiData,avgResponseTime:6}},setFallbackMitigationCostData(){this.mitigationCostData={totalCost:184,avgCost:31,highestCost:42,highestCategory:"Security",percentageChange:5.7,monthlyData:[{month:"Jan",cost:35},{month:"Feb",cost:28},{month:"Mar",cost:42},{month:"Apr",cost:31},{month:"May",cost:25},{month:"Jun",cost:23}]}},setFallbackIdentificationData(){const e=[75,82,88,92,85,88];this.identificationData={current:88,dailyAverage:4.2,percentageChange:3.5,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],minValue:Math.min(...e),maxValue:Math.max(...e)}},setFallbackDueMitigationData(){this.dueMitigationData={overduePercentage:22,completedPercentage:50,pendingPercentage:28,overdueCount:8,totalCount:36,percentageChange:2.8}},setFallbackClassificationData(){this.classificationData={accuracy:88,percentageChange:2.3,categoryAccuracy:{Compliance:92,Operational:87,Security:85,Financial:90},timeSeriesData:[{month:"Jan",value:84},{month:"Feb",value:85},{month:"Mar",value:86},{month:"Apr",value:87},{month:"May",value:86},{month:"Jun",value:88}]}},setFallbackInitiativeData(){this.initiativeData={completionPercentage:76,totalCount:25,completedCount:19,pendingCount:6,categoryBreakdown:{Security:{total:10,completed:8},Compliance:{total:8,completed:6},Process:{total:7,completed:5}}}},setFallbackImpactData(){this.impactData={overallScore:5.7,impactDistribution:{operational:{low:15,medium:30,high:20,critical:10},financial:{low:20,medium:25,high:20,critical:10}},topRisks:[{id:1,title:"Service Outage",operational_impact:8.5,financial_impact:9.2,category:"Operational"},{id:2,title:"Data Breach",operational_impact:7.2,financial_impact:9.5,category:"Security"},{id:3,title:"Compliance Violation",operational_impact:6.8,financial_impact:8.1,category:"Compliance"},{id:4,title:"Supply Chain Disruption",operational_impact:9.1,financial_impact:7.4,category:"Operational"},{id:5,title:"Market Volatility",operational_impact:5.6,financial_impact:8.7,category:"Financial"}],total_risks:25}},setFallbackSeverityData(){this.severityDistribution={Low:20,Medium:40,High:25,Critical:15},this.severityPercentages={Low:20,Medium:40,High:25,Critical:15},this.averageSeverity=6.8,this.topSevereRisks=[{id:1,title:"Data Center Failure",severity:9.5,category:"Infrastructure"},{id:2,title:"Critical Data Breach",severity:9.2,category:"Security"},{id:3,title:"Regulatory Non-Compliance",severity:8.7,category:"Compliance"},{id:4,title:"Key Supplier Failure",severity:8.4,category:"Supply Chain"},{id:5,title:"Critical System Outage",severity:8.1,category:"Technology"}],this.mostSevereRisk="Data Center Failure (9.5)"},setFallbackExposureScoreData(){this.exposureScoreData={overallScore:75,riskPoints:[{id:1,title:"Data Center Outage",impact:8.7,likelihood:7.2,category:"Infrastructure",exposure:6.3},{id:2,title:"Sensitive Data Breach",impact:9.1,likelihood:6.5,category:"Security",exposure:5.9},{id:3,title:"Regulatory Non-Compliance",impact:8.4,likelihood:5.8,category:"Compliance",exposure:4.9},{id:4,title:"Critical System Failure",impact:8.2,likelihood:5.5,category:"Technology",exposure:4.5},{id:5,title:"Supply Chain Disruption",impact:7.9,likelihood:6.8,category:"Operational",exposure:5.4},{id:6,title:"Financial Fraud",impact:7.6,likelihood:4.2,category:"Financial",exposure:3.2}],categoryDistribution:{Infrastructure:1,Security:1,Compliance:1,Technology:1,Operational:1,Financial:1}}},setFallbackResilienceData(){this.resilienceData={avgDowntime:4.6,avgRecovery:3.9,categoryData:[{category:"Security",downtime:4.8,recovery:5},{category:"Operational",downtime:4,recovery:3.5},{category:"Financial",downtime:5,recovery:4.1},{category:"Compliance",downtime:5.3,recovery:2.8}],months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:[]}},setFallbackAssessmentData(){this.assessmentData={avgReviewFrequency:60,categoryFrequencies:{Security:45,Operational:55,Compliance:35,Financial:65,Strategic:75},mostReviewed:[{id:1,title:"Data Breach",reviews:7,last_review:"2023-06-10",category:"Security"},{id:2,title:"Regulatory Non-Compliance",reviews:6,last_review:"2023-06-05",category:"Compliance"},{id:3,title:"System Outage",reviews:5,last_review:"2023-05-28",category:"Operational"}],overdueReviews:[{id:6,title:"Market Volatility",last_review:"2023-03-10",days_overdue:45,category:"Financial"},{id:7,title:"Talent Shortage",last_review:"2023-02-15",days_overdue:60,category:"Strategic"},{id:8,title:"Legacy System Failure",last_review:"2023-04-05",days_overdue:30,category:"Technology"}],months:["Jan","Feb","Mar","Apr","May","Jun"],monthlyReviews:[15,18,22,17,20,23],overdueCount:3,totalRisks:65}},setFallbackConsensusData(){this.consensusData={consensusPercentage:75,totalAssessments:120,consensusCount:90,noConsensusCount:30,categoryConsensus:{Security:80,Operational:70,Compliance:85,Financial:75,Strategic:65},lowConsensusRisks:[{id:1,title:"Cloud Migration Security",category:"Security",reviewers:4,agreement:"2/4"},{id:2,title:"Third-party Vendor Assessment",category:"Operational",reviewers:3,agreement:"1/3"},{id:3,title:"New Regulatory Requirements",category:"Compliance",reviewers:5,agreement:"3/5"}],months:["Jan","Feb","Mar","Apr","May","Jun"],monthlyConsensus:[70,72,68,75,78,75]}},setFallbackRegisterUpdateData(){this.registerUpdateData={avgUpdateFrequency:10,months:["Jan","Feb","Mar","Apr","May","Jun"],monthlyUpdates:[28,32,38,35,42,40],categoryFrequencies:{Security:7,Compliance:12,Operational:10,Financial:18,Technology:9},dailyUpdates:[2,1,3,0,2,4,1,3,2,1,0,2,3,5,2,1,3,4,2,1,0,2,3,1,2,3,1,4,2,3]}},setFallbackRecurrenceProbabilityData(){this.recurrenceProbabilityData={averageProbability:38,probabilityRanges:this.defaultProbabilityRanges,highRecurrenceRisks:[{id:1,title:"Service Outage",probability:85,category:"Operational"},{id:2,title:"Data Quality Issues",probability:78,category:"Technology"},{id:3,title:"Staff Turnover",probability:72,category:"HR"},{id:4,title:"Minor Security Breaches",probability:68,category:"Security"},{id:5,title:"Vendor Delivery Delays",probability:65,category:"Supply Chain"}],trendData:[{month:"Jan",probability:52},{month:"Feb",probability:49.5},{month:"Mar",probability:46.2},{month:"Apr",probability:43.8},{month:"May",probability:40.5},{month:"Jun",probability:38}],months:["Jan","Feb","Mar","Apr","May","Jun"],percentageChange:-6.2,totalRisks:100}},setFallbackToleranceData(){this.toleranceData={overallStatus:"Near Limits",toleranceThresholds:this.defaultToleranceThresholds,alerts:[{category:"Operational",message:"Operational risks exceeding defined tolerance threshold by 7.1%",date:"2023-06-12"}],historicalData:{Security:[{month:"Jan",percentage:85},{month:"Feb",percentage:88},{month:"Mar",percentage:90},{month:"Apr",percentage:92},{month:"May",percentage:95},{month:"Jun",percentage:94}],Compliance:[{month:"Jan",percentage:70},{month:"Feb",percentage:75},{month:"Mar",percentage:78},{month:"Apr",percentage:85},{month:"May",percentage:80},{month:"Jun",percentage:83}],Operational:[{month:"Jan",percentage:90},{month:"Feb",percentage:95},{month:"Mar",percentage:100},{month:"Apr",percentage:105},{month:"May",percentage:110},{month:"Jun",percentage:107}]},months:["Jan","Feb","Mar","Apr","May","Jun"]}},setFallbackAppetiteData(){this.appetiteData={currentLevel:6,description:"Balanced risk approach",historicalLevels:[4,5,5,6,6,6],dates:["Jan","Feb","Mar","Apr","May","Jun"],levelDescriptions:{low:"Risk Averse (1-3)",medium:"Balanced (4-7)",high:"Risk Seeking (8-10)"}}},getToleranceStatusClass(e){return e?"Within Limits"===e?"status-normal":"Near Limits"===e?"status-warning":"Exceeding Limits"===e?"status-exceeded":"status-warning":"status-warning"},getCategoryStatusClass(e){return e?"Normal"===e?"status-normal":"Warning"===e?"status-warning":"Exceeded"===e?"status-exceeded":"status-normal":"status-normal"},calculateBarHeight(e,a){if(!a||0===a.length)return 0;const t=Math.min(...a),i=Math.max(...a);return t===i?50:20+(e-t)/(i-t)*80},calculatePointPosition(e,a,t){if(void 0===a||void 0===t){const e=this.activeRisksData.trendData||[];a=Math.min(...e),t=Math.max(...e)}const i=t-a||1;return 100*(1-((e-a)/i*.7+.15))},generateSmoothCurvePath(e,a,t){if(!e||e.length<2)return"";void 0!==a&&void 0!==t||(a=Math.min(...e),t=Math.max(...e));const i=100,s=30,o=t-a||1,l=e.map((t,l)=>{const n=l/(e.length-1)*i,r=s-((t-a)/o*21+4.5);return{x:n,y:r}});let n=`M ${l[0].x},${l[0].y}`;for(let r=0;r<l.length-1;r++){const e=l[r].x+(l[r+1].x-l[r].x)/3,a=l[r].y,t=l[r].x+2*(l[r+1].x-l[r].x)/3,i=l[r+1].y;n+=` C ${e},${a} ${t},${i} ${l[r+1].x},${l[r+1].y}`}return n},generateSmoothAreaPath(e,a,t){if(!e||e.length<2)return"";void 0!==a&&void 0!==t||(a=Math.min(...e),t=Math.max(...e));const i=100,s=30,o=t-a||1,l=e.map((t,l)=>{const n=l/(e.length-1)*i,r=s-((t-a)/o*21+4.5);return{x:n,y:r}});let n=`M ${l[0].x},${l[0].y}`;for(let r=0;r<l.length-1;r++){const e=l[r].x+(l[r+1].x-l[r].x)/3,a=l[r].y,t=l[r].x+2*(l[r+1].x-l[r].x)/3,i=l[r+1].y;n+=` C ${e},${a} ${t},${i} ${l[r+1].x},${l[r+1].y}`}return n+=` L ${i},${s} L 0,${s} Z`,n},calculateWaterfallBarHeight(e){const a=Math.max(this.reductionData.startCount,this.reductionData.newCount,this.reductionData.mitigatedCount,this.reductionData.endCount,60),t=25+e/a*75;return`${t}%`},generateCriticalityPath(e){if(!e||e.length<2)return"";const a=100,t=15,i=Math.min(...e),s=Math.max(...e),o=s-i||1,l=e.map((s,l)=>{const n=l/(e.length-1)*a,r=t-((s-i)/o*10+2.5);return{x:n,y:r}});let n=`M ${l[0].x},${l[0].y}`;for(let r=1;r<l.length;r++)n+=` L ${l[r].x},${l[r].y}`;return n},calculateRemediationY(e){const a=this.remediationData.trendData||[30,35,32,38,33,35],t=this.remediationData.slaThreshold||30,i=Math.max(...a,t+10),s=Math.min(...a,t-5),o=i-s||1;return 35-(e-s)/o*25+5},generateRemediationPath(e){if(!e||e.length<2)return"";const a=100,t=e.map((t,i)=>{const s=i/(e.length-1)*a,o=this.calculateRemediationY(t);return{x:s,y:o}});let i=`M ${t[0].x},${t[0].y}`;for(let s=1;s<t.length;s++){const e=t[s-1].x+(t[s].x-t[s-1].x)/3,a=t[s-1].y,o=t[s].x-(t[s].x-t[s-1].x)/3,l=t[s].y;i+=` C ${e},${a} ${o},${l} ${t[s].x},${t[s].y}`}return i},calculateRecurrenceY(e){if(!this.recurrenceData.trendData||0===this.recurrenceData.trendData.length)return 25;const a=1.1*Math.max(...this.recurrenceData.trendData),t=.9*Math.min(...this.recurrenceData.trendData);return 40-(e-t)/(a-t||1)*30+10},generateRecurrencePath(e){if(!e||e.length<2)return"";const a=100,t=e.map((t,i)=>{const s=i/(e.length-1)*a,o=this.calculateRecurrenceY(t);return{x:s,y:o}});let i=`M ${t[0].x},${t[0].y}`;for(let s=1;s<t.length;s++){const e=t[s-1].x+(t[s].x-t[s-1].x)/3,a=t[s-1].y,o=t[s].x-(t[s].x-t[s-1].x)/3,l=t[s].y;i+=` C ${e},${a} ${o},${l} ${t[s].x},${t[s].y}`}return i},calculateNeedleEnd(e){const a=this.responseData.target/2||2,t=1.5*this.responseData.sla||12,i=Math.max(a,Math.min(e,t)),s=(i-a)/(t-a)*180,o=(s-90)*(Math.PI/180),l=30+25*Math.cos(o),n=35+25*Math.sin(o);return{x:l,y:n}},calculateResponseY(e){if(!this.responseData.trendData||0===this.responseData.trendData.length)return 20;const a=Math.min(e,50),t=this.responseData.trendData.map(e=>Math.min(e,50)),i=1.1*Math.max(...t),s=.9*Math.min(...t);return 35-(a-s)/(i-s||1)*30+5},generateResponsePath(e){if(!e||e.length<2)return"";const a=e.map(e=>Math.min(e,50)),t=100,i=a.map((e,i)=>{const s=i/(a.length-1)*t,o=this.calculateResponseY(e);return{x:s,y:o}});let s=`M ${i[0].x},${i[0].y}`;for(let o=1;o<i.length;o++){const e=i[o-1].x+(i[o].x-i[o-1].x)/3,a=i[o-1].y,t=i[o].x-(i[o].x-i[o-1].x)/3,l=i[o].y;s+=` C ${e},${a} ${t},${l} ${i[o].x},${i[o].y}`}return s},getResponseStrokeColor(e){const a=this.responseData.target||4,t=this.responseData.sla||8;return e<=a?"#10b981":e<=t?"#f59e0b":"#ef4444"},getResponsePointColor(e){const a=this.responseData.target||4,t=this.responseData.sla||8;return e<=a?"#10b981":e<=t?"#f59e0b":"#ef4444"},calculateCostBarHeight(e){if(!this.mitigationCostData.monthlyData||0===this.mitigationCostData.monthlyData.length)return 50;const a=this.mitigationCostData.monthlyData.map(e=>e.cost),t=Math.max(...a);return e/t*85},generatePieSegment(e,a,t,i,s,o){const l=s/100*360-90,n=o/100*360-90,r=t,c=t-i,d=e+r*Math.cos(l*Math.PI/180),u=a+r*Math.sin(l*Math.PI/180),p=e+r*Math.cos(n*Math.PI/180),v=a+r*Math.sin(n*Math.PI/180),m=e+c*Math.cos(n*Math.PI/180),k=a+c*Math.sin(n*Math.PI/180),h=e+c*Math.cos(l*Math.PI/180),g=a+c*Math.sin(l*Math.PI/180),y=o-s>50?1:0;return`M ${d} ${u} \n              A ${r} ${r} 0 ${y} 1 ${p} ${v}\n              L ${m} ${k} \n              A ${c} ${c} 0 ${y} 0 ${h} ${g}\n              Z`},generateArcPath(e,a,t,i,s){const o=i/100*Math.PI*2-Math.PI/2,l=s/100*Math.PI*2-Math.PI/2,n=e+t*Math.cos(o),r=a+t*Math.sin(o),c=e+t*Math.cos(l),d=a+t*Math.sin(l),u=s-i>50?1:0;return`M ${e} ${a} L ${n} ${r} A ${t} ${t} 0 ${u} 1 ${c} ${d} Z`},getCategoryClass(e){return e?e.toLowerCase():""},getTopRisks(e){return e&&0!==e.length?e.slice(0,4):[]},calculateAssessmentBarHeight(e){const a=Math.max(...this.assessmentData.monthlyReviews||[25]);return e/a*85},calculateCategoryBarWidth(e){const a=Object.values(this.assessmentData.categoryFrequencies||{}),t=Math.max(...a,90);return e/t*100},calculateUpdateY(e){if(!this.registerUpdateData.monthlyUpdates||0===this.registerUpdateData.monthlyUpdates.length)return 25;const a=1.1*Math.max(...this.registerUpdateData.monthlyUpdates),t=.9*Math.min(...this.registerUpdateData.monthlyUpdates);return 45-(e-t)/(a-t)*40},generateRegisterUpdatePath(e){if(!e||e.length<2)return"";const a=100,t=e.map((t,i)=>{const s=i/(e.length-1)*a,o=this.calculateUpdateY(t);return{x:s,y:o}});let i=`M ${t[0].x},${t[0].y}`;for(let s=1;s<t.length;s++){const e=t[s-1].x+(t[s].x-t[s-1].x)/3,a=t[s-1].y,o=t[s].x-(t[s].x-t[s-1].x)/3,l=t[s].y;i+=` C ${e},${a} ${o},${l} ${t[s].x},${t[s].y}`}return i},calculateHistogramBarHeight(e){const a=this.recurrenceProbabilityData.probabilityRanges?.map(e=>e.count)||this.defaultProbabilityRanges.map(e=>e.count),t=Math.max(...a);return 10+e/t*80},getBarClass(e){return"0-20%"===e?"very-low-prob":"21-40%"===e?"low-prob":"41-60%"===e?"med-prob":"61-80%"===e?"high-prob":"81-100%"===e?"very-high-prob":""},calculateAppetitePosition(e){return e?(e-1)/9*100:60},calculateAppetiteY(e){return this.appetiteData.historicalLevels&&0!==this.appetiteData.historicalLevels.length?30-3*e:15},getAppetiteDescription(e){return e?e<=3?"Risk Averse":e<=7?"Balanced":"Risk Seeking":"Balanced"},generateAppetitePath(e){if(!e||e.length<2)return"";const a=100,t=e.map((t,i)=>{const s=i/(e.length-1)*a,o=this.calculateAppetiteY(t);return{x:s,y:o}});let i=`M ${t[0].x},${t[0].y}`;for(let s=1;s<t.length;s++){const e=t[s-1].x+(t[s].x-t[s-1].x)/3,a=t[s-1].y,o=t[s].x-(t[s].x-t[s-1].x)/3,l=t[s].y;i+=` C ${e},${a} ${o},${l} ${t[s].x},${t[s].y}`}return i},calculateGaugeNeedleX(e){const a=12,t=Math.min(e,a),i=Math.PI*(t/a-.5),s=70,o=.8*s;return 100+Math.cos(i)*o},calculateGaugeNeedleY(e){const a=12,t=Math.min(e,a),i=Math.PI*(t/a-.5),s=70,o=.8*s;return 70-Math.sin(i)*o},formatResponseTime(e){if(!e)return"0";if(e>=72){const a=Math.floor(e/24),t=Math.floor(e%24);return`${a}d ${t}h`}return e},filterKpiCards(){console.log("Filtering KPIs by category:",this.selectedCategory)},isVisible(e){return"all"===this.selectedCategory||this.kpiCategories[this.selectedCategory].includes(e)},calculateCycleTimeY(e){const a=this.approvalRateData.monthlyCycleDays||[10,12,14,16,18,20],t=Math.max(...a,30),i=Math.min(...a,0),s=t-i||1;return 100-(e-i)/s*80},generateCycleTimePath(e){if(!e||e.length<2)return"";const a=100,t=e.map((t,i)=>{const s=i/(e.length-1)*a,o=this.calculateCycleTimeY(t);return{x:s,y:o}});let i=`M ${t[0].x},${t[0].y}`;for(let s=1;s<t.length;s++){const e=t[s-1].x+(t[s].x-t[s-1].x)/3,a=t[s-1].y,o=t[s].x-(t[s].x-t[s-1].x)/3,l=t[s].y;i+=` C ${e},${a} ${o},${l} ${t[s].x},${t[s].y}`}return i},calculateCycleBarHeight(e){const a=Math.max(...this.approvalRateData.monthlyCycleDays||[20]);return e/a*80},calculateDistributionHeight(e){const a=Object.values(this.approvalRateData.reviewCyclesDistribution||{1:20,2:15,"3+":10}),t=Math.max(...a);return 10+e/t*50},getMaxReviewCycles(){if(!this.approvalRateData.monthlyCycleDays||0===this.approvalRateData.monthlyCycleDays.length)return 4;const e=Math.max(...this.approvalRateData.monthlyCycleDays);return Math.ceil(e/6)},async fetchIdentificationRate(){try{const e=await qe.A.get("http://localhost:8000/api/risk/identification-rate/",{params:{timeRange:"30days"}});this.identificationRate=e.data.current,this.identificationChange=e.data.percentageChange,this.avgDailyRisks=e.data.dailyAverage,this.identificationTrend=e.data.trendData,this.identificationMonths=e.data.months}catch(e){console.error("Failed to fetch identification rate",e)}},getX(e,a,t){return a<=1?t/2:e/(a-1)*(t-10)+5},getY(e,a,t){const i=Math.min(...a),s=Math.max(...a);return s===i?t/2:(s-e)/(s-i)*(t-20)+10},generateAreaPoints(e,a,t){if(!e.length)return"";let i=e.map((i,s)=>`${this.getX(s,e.length,a)},${this.getY(i,e,t)}`).join(" ");return i+=` ${this.getX(e.length-1,e.length,a)},${t-5}`,i+=` ${this.getX(0,e.length,a)},${t-5}`,i},generateLinePoints(e,a,t){return e.map((i,s)=>`${this.getX(s,e.length,a)},${this.getY(i,e,t)}`).join(" ")}},computed:{severitySegmentStyles(){const e=this.severityPercentages.Low||0,a=this.severityPercentages.Medium||0,t=this.severityPercentages.High||0,i=this.severityPercentages.Critical||0;return{low:{width:`${e}%`,left:"0%"},medium:{width:`${a}%`,left:`${e}%`},high:{width:`${t}%`,left:`${e+a}%`},critical:{width:`${i}%`,left:`${e+a+t}%`}}}}};const ACe=(0,se.A)(SCe,[["render",_Ce],["__scopeId","data-v-175f7afa"]]);var TCe=ACe;const xCe={class:"risk-scoring-container"},FCe={class:"risk-scoring-filters-wrapper"},VCe={class:"risk-scoring-dropdowns-wrapper"},MCe={key:0,class:"risk-scoring-loading"},XCe={key:1,class:"risk-scoring-error-message"},UCe={key:2,class:"risk-scoring-no-data"},NCe={key:3},$Ce={class:"risk-scoring-table-container"},OCe={class:"risk-scoring-action-text"},jCe=["onClick"],BCe=["onClick"],WCe={key:2,class:"risk-scoring-simple-actions"},QCe=["onClick"],qCe=["onClick"];function KCe(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal"),r=(0,s.g2)("Dynamicalsearch"),c=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",xCe,[(0,s.bF)(n),a[7]||(a[7]=(0,s.Lk)("div",{class:"risk-scoring-title"}," Risk Scoring ",-1)),(0,s.Lk)("div",FCe,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>o.searchQuery=e),placeholder:"Search...",onInput:l.applyFilters},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",VCe,[(0,s.bF)(c,{config:o.statusFilterConfig,modelValue:o.statusFilter,"onUpdate:modelValue":a[1]||(a[1]=e=>o.statusFilter=e),onChange:l.handleStatusFilterChange},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:o.categoryFilterConfig,modelValue:o.categoryFilter,"onUpdate:modelValue":a[2]||(a[2]=e=>o.categoryFilter=e),onChange:l.handleCategoryFilterChange},null,8,["config","modelValue","onChange"])]),o.loading?((0,s.uX)(),(0,s.CE)("div",MCe,a[3]||(a[3]=[(0,s.Lk)("div",{class:"risk-scoring-spinner"},null,-1),(0,s.Lk)("span",null,"Loading risk data...",-1)]))):o.error?((0,s.uX)(),(0,s.CE)("div",XCe,(0,d.v_)(o.error),1)):0===o.filteredRiskInstances.length?((0,s.uX)(),(0,s.CE)("div",UCe,a[4]||(a[4]=[(0,s.Lk)("p",null,"No risk instances found.",-1)]))):((0,s.uX)(),(0,s.CE)("div",NCe,[(0,s.Lk)("div",$Ce,[(0,s.bF)(u,{title:"",data:o.filteredRiskInstances,columns:o.tableColumns,filters:[],"show-checkbox":!1,"show-actions":!0,"show-pagination":!0,"page-size-options":[7,10,20,50],"default-page-size":7,"unique-key":"RiskInstanceId",onFilterChange:l.handleFilterChange},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("div",OCe,[l.isScoringCompleted(e)?((0,s.uX)(),(0,s.CE)("span",{key:0,onClick:a=>l.viewScoringDetails(e.RiskInstanceId)},a[5]||(a[5]=[(0,s.eW)(" Scoring Completed "),(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,jCe)):l.isRiskRejected(e)?((0,s.uX)(),(0,s.CE)("span",{key:1,onClick:a=>l.viewScoringDetails(e.RiskInstanceId)},a[6]||(a[6]=[(0,s.eW)(" Instance Rejected "),(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,BCe)):((0,s.uX)(),(0,s.CE)("div",WCe,[(0,s.Lk)("span",{class:"accept-action",onClick:a=>l.mapScoringRisk(e.RiskInstanceId)},"Accept",8,QCe),(0,s.Lk)("span",{class:"reject-action",onClick:a=>l.rejectRisk(e.RiskInstanceId)},"Reject",8,qCe)]))])]),"cell-RiskDescription":(0,s.k6)(({value:e})=>[(0,s.eW)((0,d.v_)(l.truncateText(e,50)||"N/A"),1)]),_:1},8,["data","columns","onFilterChange"])])]))])}var JCe={name:"RiskScoring",components:{DynamicTable:Ll.A,CustomDropdown:mt.A,Dynamicalsearch:JK.A,PopupModal:pv.wA},data(){return{riskInstances:[],filteredRiskInstances:[],loading:!0,error:null,showActionButtons:(0,ee.Kh)({}),searchQuery:"",statusFilter:"",categoryFilter:"",tableColumns:[{key:"RiskInstanceId",label:"Risk Instance ID",sortable:!0,headerClass:"risk-scoring-col-risk-id",cellClass:"risk-scoring-col-risk-id"},{key:"IncidentId",label:"Incident ID",sortable:!0,headerClass:"risk-scoring-col-incident-id",cellClass:"risk-scoring-col-incident-id"},{key:"ComplianceId",label:"Compliance ID",sortable:!0,headerClass:"risk-scoring-col-compliance-id",cellClass:"risk-scoring-col-compliance-id"},{key:"RiskTitle",label:"Risk Title",sortable:!0,headerClass:"risk-scoring-col-risk-title",cellClass:"risk-scoring-col-risk-title"},{key:"Category",label:"Category",sortable:!0,headerClass:"risk-scoring-col-category",cellClass:"risk-scoring-col-category"},{key:"RiskDescription",label:"Risk Description",sortable:!0,headerClass:"risk-scoring-col-description",cellClass:"risk-scoring-col-description",slot:!0}],statusFilterConfig:{name:"statusFilter",label:"Status",values:[],defaultValue:""},categoryFilterConfig:{name:"categoryFilter",label:"Category",values:[],defaultValue:""},mapScoringButtonConfig:{name:"MAP SCORING RISK",className:"risk-scoring-map-btn risk-scoring-map-btn-full",disabled:!1}}},computed:{uniqueStatuses(){return[...new Set(this.riskInstances.map(e=>e.RiskStatus).filter(e=>e&&""!==e.trim()))]},uniqueCategories(){return[...new Set(this.riskInstances.map(e=>e.Category).filter(e=>e&&""!==e.trim()))]}},watch:{uniqueStatuses:{handler(e){this.statusFilterConfig.values=[{value:"",label:"All Status"},...e.map(e=>({value:e,label:e}))]},immediate:!0},uniqueCategories:{handler(e){this.categoryFilterConfig.values=[{value:"",label:"All Categories"},...e.map(e=>({value:e,label:e}))]},immediate:!0}},mounted(){if(this.fetchRiskInstances(),window.addEventListener("resize",this.handleResize),this.handleResize(),!document.querySelector('link[href*="font-awesome"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css",document.head.appendChild(e)}},activated(){console.log("RiskScoring component activated - refreshing data"),this.fetchRiskInstances()},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},methods:{applyFilters(){this.filterRiskInstances()},handleStatusFilterChange(e){this.statusFilter=e.value,this.applyFilters()},handleCategoryFilterChange(e){this.categoryFilter=e.value,this.applyFilters()},handleFilterChange(e){console.log("Filter change:",e)},filterRiskInstances(){this.filteredRiskInstances=this.riskInstances.filter(e=>{const a=!this.searchQuery||e.RiskTitle?.toLowerCase().includes(this.searchQuery.toLowerCase())||e.RiskDescription?.toLowerCase().includes(this.searchQuery.toLowerCase()),t=!this.statusFilter||e.RiskStatus===this.statusFilter,i=!this.categoryFilter||e.Category===this.categoryFilter;return a&&t&&i})},validateResponseData(e){return Array.isArray(e)?e:(console.error("Expected array response, got:",typeof e),[])},isScoringCompleted(e){const a=void 0!==e.RiskLikelihood&&null!==e.RiskLikelihood&&void 0!==e.RiskImpact&&null!==e.RiskImpact&&void 0!==e.RiskExposureRating&&null!==e.RiskExposureRating,t=(e.Appetite||"").toLowerCase(),i=(e.RiskStatus||"").toLowerCase();return a&&"yes"===t&&"rejected"!==i},isRiskRejected(e){const a=void 0!==e.RiskLikelihood&&null!==e.RiskLikelihood&&void 0!==e.RiskImpact&&null!==e.RiskImpact&&void 0!==e.RiskExposureRating&&null!==e.RiskExposureRating,t=(e.Appetite||"").toLowerCase(),i=(e.RiskStatus||"").toLowerCase();return a&&("no"===t||"rejected"===i)},viewScoringDetails(e){const a=this.riskInstances.find(a=>a.RiskInstanceId===e);console.log(`Viewing scoring details for Risk ${e}`),console.log(`Risk details: Status=${a.RiskStatus}, Appetite=${a.Appetite}`),console.log(`Display logic: isScoringCompleted=${this.isScoringCompleted(a)}, isRiskRejected=${this.isRiskRejected(a)}`),this.$router.push({path:`/risk/scoring-details/${e}`,query:{action:"view"}})},fetchRiskInstances(){qe.A.get("http://localhost:8000/api/risk-instances/").then(e=>{console.log("Risk instances data received:",e.data),this.riskInstances=e.data.map(e=>({...e,RiskLikelihood:e.RiskLikelihood||1,RiskImpact:e.RiskImpact||1,RiskExposureRating:e.RiskExposureRating||(e.RiskLikelihood||1)*(e.RiskImpact||1)})),this.filteredRiskInstances=[...this.riskInstances],this.riskInstances.forEach(e=>{console.log(`Risk #${e.RiskInstanceId}: Status=${e.RiskStatus}, Appetite=${e.Appetite}, Likelihood=${e.RiskLikelihood}, Impact=${e.RiskImpact}, Exposure=${e.RiskExposureRating}`),this.showActionButtons[e.RiskInstanceId]=!1}),this.loading=!1}).catch(e=>{console.error("Error fetching risk instances:",e),this.error=`Failed to fetch risk instances: ${e.message}`,this.loading=!1})},handleResize(){const e=document.querySelector(".risk-scoring-container");e&&(window.innerWidth<768?(e.style.marginLeft="0",e.style.maxWidth="100vw"):window.innerWidth<992?(e.style.marginLeft="60px",e.style.maxWidth="calc(100vw - 60px)"):window.innerWidth<1200?(e.style.marginLeft="200px",e.style.maxWidth="calc(100vw - 200px)"):(e.style.marginLeft="280px",e.style.maxWidth="calc(100vw - 280px)"))},truncateText(e,a){return e?e.length>a?e.substring(0,a)+"...":e:""},toggleActionButtons(e){this.showActionButtons[e]=!this.showActionButtons[e]},rejectRisk(e){console.log(`Navigating to Scoring Details for Risk ${e} (rejected)`),this.$router.push({path:`/risk/scoring-details/${e}`,query:{action:"reject"}})},mapScoringRisk(e){console.log(`Navigating to Scoring Details for Risk ${e} (accepted)`),this.$router.push({path:`/risk/scoring-details/${e}`,query:{action:"accept"}})}}};const zCe=(0,se.A)(JCe,[["render",KCe],["__scopeId","data-v-1ae7ba23"]]);var HCe=zCe;const YCe={class:"risk-scoring-container"},GCe={key:0,class:"risk-scoring-loading"},ZCe=["innerHTML"],eLe={key:2,class:"risk-scoring-no-data"},aLe={key:3,class:"risk-scoring-details"},tLe={class:"risk-scoring-detail-header"},iLe={key:0,class:"risk-scoring-action-header-buttons"},sLe={key:0,class:"risk-scoring-validation-summary"},oLe={class:"risk-scoring-section-container"},lLe={class:"risk-scoring-detail-row"},nLe={class:"risk-scoring-detail-item"},rLe={class:"risk-scoring-detail-value"},cLe={class:"risk-scoring-detail-item"},dLe=["readonly"],uLe={class:"risk-scoring-detail-item"},pLe=["readonly"],vLe={class:"risk-scoring-detail-row"},mLe={class:"risk-scoring-detail-item"},kLe=["readonly"],hLe={key:0,class:"validation-error"},gLe={class:"risk-scoring-detail-item"},yLe=["disabled"],fLe=["value"],bLe={key:0,class:"validation-error"},CLe={class:"risk-scoring-detail-item"},LLe=["disabled"],wLe={class:"risk-scoring-detail-row"},ELe={class:"risk-scoring-detail-item"},RLe={key:0,class:"risk-scoring-category-container"},DLe={class:"risk-scoring-category-dropdown"},ILe={key:0},PLe={key:1},_Le={key:0,class:"risk-scoring-category-options"},SLe={class:"risk-scoring-category-search"},ALe={class:"risk-scoring-category-list"},TLe=["onClick"],xLe=["checked","onClick"],FLe={class:"risk-scoring-detail-item"},VLe=["readonly"],MLe={class:"risk-scoring-detail-item"},XLe=["disabled"],ULe=["value"],NLe={key:0,class:"validation-error"},$Le={class:"risk-scoring-detail-row"},OLe={class:"risk-scoring-detail-item"},jLe=["readonly"],BLe={class:"risk-scoring-detail-item"},WLe=["disabled"],QLe=["value"],qLe={key:0,class:"validation-error"},KLe={class:"risk-scoring-detail-item"},JLe=["readonly"],zLe={class:"risk-scoring-section-container"},HLe={class:"risk-scoring-mapping-risks-section"},YLe={class:"risk-scoring-mapping-description"},GLe={key:0,class:"risk-scoring-loading"},ZLe={key:1,class:"risk-scoring-mapping-risks-table"},ewe=["id","value"],awe={class:"risk-scoring-selected-risks-actions"},twe={class:"risk-scoring-selected-risks-info"},iwe={key:0,class:"risk-scoring-selected-risks-count"},swe={key:2,class:"risk-scoring-no-matching-risks"},owe={class:"risk-scoring-section-container"},lwe={class:"risk-scoring-detail-row"},nwe={class:"risk-scoring-detail-item"},rwe=["readonly"],cwe={class:"risk-scoring-detail-item"},dwe=["min","max","readonly"],uwe={key:0,class:"validation-error"},pwe={class:"risk-scoring-detail-item"},vwe=["min","max","readonly"],mwe={key:0,class:"validation-error"},kwe={class:"risk-scoring-detail-row"},hwe={class:"risk-scoring-detail-item"},gwe={class:"risk-scoring-detail-item"},ywe=["disabled"],fwe=["value"],bwe={key:0,class:"validation-error"},Cwe={class:"risk-scoring-detail-item"},Lwe=["disabled"],wwe=["value"],Ewe={key:0,class:"validation-error"},Rwe={class:"risk-scoring-detail-row"},Dwe={class:"risk-scoring-detail-item"},Iwe={key:0},Pwe={key:1},_we={class:"risk-scoring-dropdown-search-container"},Swe={class:"risk-scoring-dropdown-items"},Awe=["onClick"],Twe=["id","checked"],xwe=["for"],Fwe={class:"risk-scoring-selected-items"},Vwe=["onClick"],Mwe={class:"risk-scoring-detail-item"},Xwe=["disabled"],Uwe=["value"],Nwe={key:0,class:"validation-error"},$we={class:"risk-scoring-detail-row"},Owe={class:"risk-scoring-detail-item"},jwe=["readonly"],Bwe={class:"risk-scoring-detail-item"},Wwe={class:"risk-scoring-mitigation-form"},Qwe={class:"risk-scoring-mitigation-input-group"},qwe=["readonly"],Kwe={class:"risk-scoring-mitigation-input-group"},Jwe=["onUpdate:modelValue","readonly","onInput"],zwe=["onClick"],Hwe={class:"risk-scoring-form-footer"},Ywe=["disabled"],Gwe={key:0},Zwe={key:1},eEe={class:"risk-scoring-modal-form-group"},aEe={class:"risk-scoring-modal-actions"},tEe=["disabled"],iEe={class:"risk-scoring-modal-form-group"},sEe={class:"risk-scoring-modal-actions"},oEe=["disabled"];function lEe(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",YCe,[(0,s.bF)(r),a[125]||(a[125]=(0,s.Lk)("h1",null,"Scoring Details",-1)),l.loading?((0,s.uX)(),(0,s.CE)("div",GCe,a[58]||(a[58]=[(0,s.Lk)("div",{class:"risk-scoring-spinner"},null,-1),(0,s.Lk)("span",null,"Loading risk instance data...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"risk-scoring-error-message",innerHTML:l.sanitize.sanitizeHtml(l.error)},null,8,ZCe)):l.riskInstance?((0,s.uX)(),(0,s.CE)("div",aLe,[(0,s.Lk)("div",tLe,[(0,s.Lk)("h2",null,"Risk Instance #"+(0,d.v_)(l.sanitize.escapeHtml(l.editedRiskInstance.RiskInstanceId)),1),n.isCreateAction?((0,s.uX)(),(0,s.CE)("div",iLe,[(0,s.Lk)("button",{class:"risk-scoring-map-btn",onClick:a[0]||(a[0]=(...e)=>n.mapScoringRisk&&n.mapScoringRisk(...e))},"MAP SCORING RISK")])):(0,s.Q3)("",!0)]),(0,s.Lk)("form",{onSubmit:a[57]||(a[57]=(0,i.D$)((...e)=>n.submitForm&&n.submitForm(...e),["prevent"])),class:"risk-scoring-detail-grid-container"},[n.activeValidationErrors.length>0?((0,s.uX)(),(0,s.CE)("div",sLe,[a[60]||(a[60]=(0,s.Lk)("h4",null,"Please fix the following errors:",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.activeValidationErrors,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.field},(0,d.v_)(l.sanitize.escapeHtml(e.error)),1))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",oLe,[a[91]||(a[91]=(0,s.Lk)("h3",{class:"risk-scoring-section-title"},"Basic Risk Information",-1)),(0,s.Lk)("div",lLe,[(0,s.Lk)("div",nLe,[a[61]||(a[61]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Instance Id",-1)),(0,s.Lk)("div",rLe,(0,d.v_)(l.sanitize.escapeHtml(l.editedRiskInstance.RiskInstanceId)),1),a[62]||(a[62]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Unique identifier for this risk instance",-1))]),(0,s.Lk)("div",cLe,[a[63]||(a[63]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Incident Id",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>l.editedRiskInstance.IncidentId=e),class:"risk-scoring-form-input",readonly:l.isReadOnly,onInput:a[2]||(a[2]=e=>l.editedRiskInstance.IncidentId=l.sanitize.escapeHtml(e.target.value))},null,40,dLe),[[i.Jo,l.editedRiskInstance.IncidentId]]),a[64]||(a[64]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Reference to the related incident or event",-1))]),(0,s.Lk)("div",uLe,[a[65]||(a[65]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Compliance Id",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>l.editedRiskInstance.ComplianceId=e),class:"risk-scoring-form-input",readonly:l.isReadOnly,onInput:a[4]||(a[4]=e=>l.editedRiskInstance.ComplianceId=l.sanitize.escapeHtml(e.target.value))},null,40,pLe),[[i.Jo,l.editedRiskInstance.ComplianceId]]),a[66]||(a[66]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Compliance framework identifier for this risk",-1))])]),(0,s.Lk)("div",vLe,[(0,s.Lk)("div",mLe,[a[67]||(a[67]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Title",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>l.editedRiskInstance.RiskTitle=e),class:(0,d.C4)(["risk-scoring-form-input",{invalid:l.validationErrors.RiskTitle}]),readonly:l.isReadOnly,onInput:a[6]||(a[6]=e=>l.editedRiskInstance.RiskTitle=l.sanitize.escapeHtml(e.target.value))},null,42,kLe),[[i.Jo,l.editedRiskInstance.RiskTitle]]),l.validationErrors.RiskTitle?((0,s.uX)(),(0,s.CE)("span",hLe,(0,d.v_)(l.sanitize.escapeHtml(l.validationErrors.RiskTitle)),1)):(0,s.Q3)("",!0),a[68]||(a[68]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Provide a brief, descriptive title for this risk",-1))]),(0,s.Lk)("div",gLe,[a[70]||(a[70]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=e=>l.editedRiskInstance.Criticality=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Criticality}]),disabled:l.isReadOnly},[a[69]||(a[69]=(0,s.Lk)("option",{value:""},"Select Criticality",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_CRITICALITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,fLe))),128))],10,yLe),[[i.u1,l.editedRiskInstance.Criticality]]),l.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("span",bLe,(0,d.v_)(l.validationErrors.Criticality),1)):(0,s.Q3)("",!0),a[71]||(a[71]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Choose the severity level of this risk",-1))]),(0,s.Lk)("div",CLe,[a[73]||(a[73]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>l.editedRiskInstance.RiskStatus=e),class:"risk-scoring-form-select",disabled:l.isReadOnly},a[72]||(a[72]=[(0,s.Lk)("option",{value:"Not Assigned",selected:""},"Not Assigned",-1),(0,s.Lk)("option",{value:"Assigned"},"Assigned",-1),(0,s.Lk)("option",{value:"Approved"},"Approved",-1),(0,s.Lk)("option",{value:"Rejected"},"Rejected",-1)]),8,LLe),[[i.u1,l.editedRiskInstance.RiskStatus]]),a[74]||(a[74]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Current status of this risk in the assessment process",-1))])]),(0,s.Lk)("div",wLe,[(0,s.Lk)("div",ELe,[a[77]||(a[77]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Category",-1)),l.isReadOnly?(0,s.bo)(((0,s.uX)(),(0,s.CE)("input",{key:1,type:"text","onUpdate:modelValue":a[13]||(a[13]=e=>l.editedRiskInstance.Category=e),class:"risk-scoring-form-input",readonly:""},null,512)),[[i.Jo,l.editedRiskInstance.Category]]):((0,s.uX)(),(0,s.CE)("div",RLe,[(0,s.Lk)("div",DLe,[(0,s.Lk)("div",{class:"risk-scoring-selected-category",onClick:a[9]||(a[9]=(...e)=>n.toggleCategoryDropdown&&n.toggleCategoryDropdown(...e))},[l.selectedCategory?((0,s.uX)(),(0,s.CE)("span",PLe,(0,d.v_)(l.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",ILe,"Select Category")),a[75]||(a[75]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",_Le,[(0,s.Lk)("div",SLe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[10]||(a[10]=e=>l.categorySearch=e),placeholder:"Search categories...",onClick:a[11]||(a[11]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,l.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"risk-scoring-add-category-btn",onClick:a[12]||(a[12]=(0,i.D$)(e=>l.showAddCategoryModal=!0,["stop","prevent"]))},a[76]||(a[76]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",ALe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-scoring-category-item",onClick:(0,i.D$)(a=>n.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:l.selectedCategory===e.value,onClick:(0,i.D$)(a=>n.selectCategory(e),["stop"])},null,8,xLe),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,TLe))),128))])])):(0,s.Q3)("",!0)])])),a[78]||(a[78]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Categorize this risk for better organization and management",-1))]),(0,s.Lk)("div",FLe,[a[79]||(a[79]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Possible Damage",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[14]||(a[14]=e=>l.editedRiskInstance.PossibleDamage=e),class:"risk-scoring-form-input",readonly:l.isReadOnly},null,8,VLe),[[i.Jo,l.editedRiskInstance.PossibleDamage]]),a[80]||(a[80]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Describe the potential damage or consequences if this risk occurs",-1))]),(0,s.Lk)("div",MLe,[a[82]||(a[82]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Priority",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[15]||(a[15]=e=>l.editedRiskInstance.RiskPriority=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.RiskPriority}]),disabled:l.isReadOnly},[a[81]||(a[81]=(0,s.Lk)("option",{value:""},"Select Priority",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_PRIORITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ULe))),128))],10,XLe),[[i.u1,l.editedRiskInstance.RiskPriority]]),l.validationErrors.RiskPriority?((0,s.uX)(),(0,s.CE)("span",NLe,(0,d.v_)(l.validationErrors.RiskPriority),1)):(0,s.Q3)("",!0),a[83]||(a[83]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Set the priority level for risk treatment and response",-1))])]),(0,s.Lk)("div",$Le,[(0,s.Lk)("div",OLe,[a[84]||(a[84]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Reported By",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[16]||(a[16]=e=>l.editedRiskInstance.ReportedBy=e),class:"risk-scoring-form-input",readonly:l.isReadOnly},null,8,jLe),[[i.Jo,l.editedRiskInstance.ReportedBy]]),a[85]||(a[85]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Name or identifier of the person who reported this risk",-1))]),(0,s.Lk)("div",BLe,[a[87]||(a[87]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Origin",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[17]||(a[17]=e=>l.editedRiskInstance.Origin=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Origin}]),disabled:l.isReadOnly},[a[86]||(a[86]=(0,s.Lk)("option",{value:""},"Select Origin",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_ORIGIN,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,QLe))),128))],10,WLe),[[i.u1,l.editedRiskInstance.Origin]]),l.validationErrors.Origin?((0,s.uX)(),(0,s.CE)("span",qLe,(0,d.v_)(l.validationErrors.Origin),1)):(0,s.Q3)("",!0),a[88]||(a[88]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Source or method through which this risk was identified",-1))]),(0,s.Lk)("div",KLe,[a[89]||(a[89]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[18]||(a[18]=e=>l.editedRiskInstance.RiskDescription=e),class:"risk-scoring-form-textarea",readonly:l.isReadOnly},null,8,JLe),[[i.Jo,l.editedRiskInstance.RiskDescription]]),a[90]||(a[90]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Provide a detailed description of the risk, its context, and contributing factors",-1))])])]),(0,s.Lk)("div",zLe,[a[94]||(a[94]=(0,s.Lk)("h3",{class:"risk-scoring-section-title"},"Mapped Risks",-1)),(0,s.Lk)("div",HLe,[(0,s.Lk)("p",YLe,"Select risks from Risk Register with matching Compliance ID: "+(0,d.v_)(l.editedRiskInstance.ComplianceId||"None"),1),l.loadingMatchingRisks?((0,s.uX)(),(0,s.CE)("div",GLe,a[92]||(a[92]=[(0,s.Lk)("div",{class:"risk-scoring-spinner"},null,-1),(0,s.Lk)("span",null,"Loading matching risks...",-1)]))):l.matchingRisks.length>0?((0,s.uX)(),(0,s.CE)("div",ZLe,[(0,s.Lk)("table",null,[a[93]||(a[93]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Select"),(0,s.Lk)("th",null,"Risk ID"),(0,s.Lk)("th",null,"Compliance ID"),(0,s.Lk)("th",null,"Risk Title"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Category")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.matchingRisks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.RiskId},[(0,s.Lk)("td",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",id:"risk-"+e.RiskId,value:e.RiskId,"onUpdate:modelValue":a[19]||(a[19]=e=>l.selectedRisks=e),class:"risk-scoring-risk-checkbox"},null,8,ewe),[[i.lH,l.selectedRisks]])]),(0,s.Lk)("td",null,(0,d.v_)(e.RiskId),1),(0,s.Lk)("td",null,(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.RiskTitle),1),(0,s.Lk)("td",null,(0,d.v_)(e.Criticality),1),(0,s.Lk)("td",null,(0,d.v_)(e.Category),1)]))),128))])]),(0,s.Lk)("div",awe,[(0,s.Lk)("div",twe,[l.selectedRisks.length>0?((0,s.uX)(),(0,s.CE)("div",iwe,(0,d.v_)(l.selectedRisks.length)+" risk(s) selected ",1)):(0,s.Q3)("",!0),l.selectedRisks.length>0?((0,s.uX)(),(0,s.CE)("button",{key:1,type:"button",class:"risk-scoring-fill-scoring-button",onClick:a[20]||(a[20]=(...e)=>n.fillScoringFromSelectedRisk&&n.fillScoringFromSelectedRisk(...e))}," Fill Scoring ")):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{type:"button",class:"risk-scoring-create-risk-btn",onClick:a[21]||(a[21]=(...e)=>n.createRisk&&n.createRisk(...e))},"Create Risk")])])):((0,s.uX)(),(0,s.CE)("div",swe,[(0,s.Lk)("p",null,"No matching risks found with Compliance ID: "+(0,d.v_)(l.editedRiskInstance.ComplianceId||"None"),1),(0,s.Lk)("button",{type:"button",class:"risk-scoring-create-risk-btn",onClick:a[22]||(a[22]=(...e)=>n.createRisk&&n.createRisk(...e))},"Create Risk")]))])]),(0,s.Lk)("div",owe,[a[120]||(a[120]=(0,s.Lk)("h3",{class:"risk-scoring-section-title"},"Risk Assessment",-1)),(0,s.Lk)("div",lwe,[(0,s.Lk)("div",nwe,[a[95]||(a[95]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Id",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[23]||(a[23]=e=>l.editedRiskInstance.RiskId=e),class:"risk-scoring-form-input",readonly:l.isReadOnly},null,8,rwe),[[i.Jo,l.editedRiskInstance.RiskId]]),a[96]||(a[96]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Reference to the base risk template from the risk register",-1))]),(0,s.Lk)("div",cwe,[a[97]||(a[97]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Likelihood",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[24]||(a[24]=e=>l.editedRiskInstance.RiskLikelihood=e),class:(0,d.C4)(["risk-scoring-form-input",{invalid:l.validationErrors.RiskLikelihood}]),min:l.validationRules.RISK_LIKELIHOOD_RANGE.min,max:l.validationRules.RISK_LIKELIHOOD_RANGE.max,readonly:l.isReadOnly,onInput:a[25]||(a[25]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e))},null,42,dwe),[[i.Jo,l.editedRiskInstance.RiskLikelihood,void 0,{number:!0}]]),l.validationErrors.RiskLikelihood?((0,s.uX)(),(0,s.CE)("span",uwe,(0,d.v_)(l.validationErrors.RiskLikelihood),1)):(0,s.Q3)("",!0),a[98]||(a[98]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)",-1))]),(0,s.Lk)("div",pwe,[a[99]||(a[99]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Impact",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":a[26]||(a[26]=e=>l.editedRiskInstance.RiskImpact=e),class:(0,d.C4)(["risk-scoring-form-input",{invalid:l.validationErrors.RiskImpact}]),min:l.validationRules.RISK_IMPACT_RANGE.min,max:l.validationRules.RISK_IMPACT_RANGE.max,readonly:l.isReadOnly,onInput:a[27]||(a[27]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e))},null,42,vwe),[[i.Jo,l.editedRiskInstance.RiskImpact,void 0,{number:!0}]]),l.validationErrors.RiskImpact?((0,s.uX)(),(0,s.CE)("span",mwe,(0,d.v_)(l.validationErrors.RiskImpact),1)):(0,s.Q3)("",!0),a[100]||(a[100]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)",-1))])]),(0,s.Lk)("div",kwe,[(0,s.Lk)("div",hwe,[a[101]||(a[101]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Exposure Rating (Likelihood Ã— Impact)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",readonly:"","onUpdate:modelValue":a[28]||(a[28]=e=>l.editedRiskInstance.RiskExposureRating=e),class:"risk-scoring-form-input risk-scoring-readonly-input"},null,512),[[i.Jo,l.editedRiskInstance.RiskExposureRating,void 0,{number:!0}]]),a[102]||(a[102]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Automatically calculated as Likelihood Ã— Impact",-1))]),(0,s.Lk)("div",gwe,[a[103]||(a[103]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Type",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[29]||(a[29]=e=>l.editedRiskInstance.RiskType=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.RiskType}]),disabled:l.isReadOnly},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,fwe))),128))],10,ywe),[[i.u1,l.editedRiskInstance.RiskType]]),l.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("span",bwe,(0,d.v_)(l.validationErrors.RiskType),1)):(0,s.Q3)("",!0),a[104]||(a[104]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Classify the nature and timing of this risk",-1))]),(0,s.Lk)("div",Cwe,[a[105]||(a[105]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Appetite",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[30]||(a[30]=e=>l.editedRiskInstance.Appetite=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Appetite}]),disabled:l.isReadOnly,onChange:a[31]||(a[31]=(...e)=>n.onAppetiteChange&&n.onAppetiteChange(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_APPETITE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,wwe))),128))],42,Lwe),[[i.u1,l.editedRiskInstance.Appetite]]),l.validationErrors.Appetite?((0,s.uX)(),(0,s.CE)("span",Ewe,(0,d.v_)(l.validationErrors.Appetite),1)):(0,s.Q3)("",!0),a[106]||(a[106]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Indicate if the organization accepts this risk level",-1))])]),(0,s.Lk)("div",Rwe,[(0,s.Lk)("div",Dwe,[a[109]||(a[109]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Impact")],-1)),(0,s.Lk)("div",{class:"risk-scoring-business-impact-dropdown-header",onClick:a[32]||(a[32]=(0,i.D$)((...e)=>n.toggleBusinessImpactDropdown&&n.toggleBusinessImpactDropdown(...e),["stop"]))},[0===l.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",Iwe,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",Pwe,(0,d.v_)(l.selectedBusinessImpacts.length)+" impact(s) selected",1)),a[107]||(a[107]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"risk-scoring-business-impact-dropdown",onClick:a[37]||(a[37]=(0,i.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",_we,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[33]||(a[33]=e=>l.businessImpactSearch=e),placeholder:"Search impacts...",class:"risk-scoring-dropdown-search",onClick:a[34]||(a[34]=(0,i.D$)(()=>{},["stop"]))},null,512),[[i.Jo,l.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"risk-scoring-add-impact-btn",onClick:a[35]||(a[35]=(0,i.D$)(e=>l.showAddImpactModal=!0,["stop","prevent"]))},a[108]||(a[108]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",Swe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-scoring-dropdown-item",onClick:(0,i.D$)(a=>n.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",id:"impact-"+e.id,checked:n.isBusinessImpactSelected(e),onClick:a[36]||(a[36]=(0,i.D$)(()=>{},["stop"]))},null,8,Twe),(0,s.Lk)("label",{for:"impact-"+e.id},(0,d.v_)(e.value),9,xwe)],8,Awe))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Fwe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-scoring-selected-item"},[(0,s.eW)((0,d.v_)(l.sanitize.escapeHtml(e.value))+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:a=>n.toggleBusinessImpact(e)},null,8,Vwe)]))),128))]),a[110]||(a[110]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Select the business areas that would be affected by this risk",-1))]),(0,s.Lk)("div",Mwe,[a[111]||(a[111]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Response Type",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[38]||(a[38]=e=>l.editedRiskInstance.RiskResponseType=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.RiskResponseType}]),disabled:l.isReadOnly},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_RESPONSE_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Uwe))),128))],10,Xwe),[[i.u1,l.editedRiskInstance.RiskResponseType]]),l.validationErrors.RiskResponseType?((0,s.uX)(),(0,s.CE)("span",Nwe,(0,d.v_)(l.validationErrors.RiskResponseType),1)):(0,s.Q3)("",!0),a[112]||(a[112]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Choose the strategy for addressing this risk",-1))])]),(0,s.Lk)("div",$we,[(0,s.Lk)("div",Owe,[a[113]||(a[113]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Response Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[39]||(a[39]=e=>l.editedRiskInstance.RiskResponseDescription=e),class:"risk-scoring-form-textarea",readonly:l.isReadOnly},null,8,jwe),[[i.Jo,l.editedRiskInstance.RiskResponseDescription]]),a[114]||(a[114]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Provide details about the chosen risk response strategy",-1))]),(0,s.Lk)("div",Bwe,[a[118]||(a[118]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Mitigation",-1)),(0,s.Lk)("div",Wwe,[(0,s.Lk)("div",Qwe,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[40]||(a[40]=e=>l.mitigationForm.description=e),class:"risk-scoring-form-textarea",placeholder:"Enter mitigation description",readonly:l.isReadOnly,onInput:a[41]||(a[41]=e=>{l.mitigationForm.description=l.sanitize.escapeHtml(e.target.value),n.updateMitigationJson()})},null,40,qwe),[[i.Jo,l.mitigationForm.description]])]),(0,s.Lk)("div",Kwe,[a[117]||(a[117]=(0,s.Lk)("label",null,"Actions",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationForm.actions,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"risk-scoring-action-item"},[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>l.mitigationForm.actions[t]=e,class:"risk-scoring-form-input",readonly:l.isReadOnly,onInput:e=>{l.mitigationForm.actions[t]=l.sanitize.escapeHtml(e.target.value),n.updateMitigationJson()}},null,40,Jwe),[[i.Jo,l.mitigationForm.actions[t]]]),l.isReadOnly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",class:"risk-scoring-remove-action",onClick:e=>n.removeAction(t)},a[115]||(a[115]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,zwe))]))),128)),l.isReadOnly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",class:"risk-scoring-add-action",onClick:a[42]||(a[42]=(...e)=>n.addAction&&n.addAction(...e))},a[116]||(a[116]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Action ")])))]),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[43]||(a[43]=e=>l.riskMitigationJson=e),style:{display:"none"}},null,512),[[i.Jo,l.riskMitigationJson]])]),a[119]||(a[119]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Describe the strategies and measures to reduce or eliminate this risk",-1))])])]),(0,s.Lk)("div",Hwe,[(0,s.Lk)("button",{type:"submit",class:"risk-scoring-submit-button",disabled:l.submitting},[l.submitting?((0,s.uX)(),(0,s.CE)("span",Gwe,"Saving...")):((0,s.uX)(),(0,s.CE)("span",Zwe,"Save Changes"))],8,Ywe),(0,s.Lk)("button",{type:"button",class:"risk-scoring-back-button",onClick:a[44]||(a[44]=(...e)=>n.goBack&&n.goBack(...e))},"Back to Risk Scoring")]),l.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"risk-scoring-modal-overlay",onClick:a[50]||(a[50]=(0,i.D$)(e=>l.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-scoring-modal-content",onClick:a[49]||(a[49]=(0,i.D$)(()=>{},["stop"]))},[a[122]||(a[122]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:a[48]||(a[48]=(0,i.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"])),class:"risk-scoring-modal-form"},[(0,s.Lk)("div",eEe,[a[121]||(a[121]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[45]||(a[45]=e=>l.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:a[46]||(a[46]=(0,i.jR)((0,i.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,l.newBusinessImpact]])]),(0,s.Lk)("div",aEe,[(0,s.Lk)("button",{type:"button",class:"risk-scoring-cancel-btn",onClick:a[47]||(a[47]=(0,i.D$)(e=>l.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-scoring-add-btn",disabled:!l.newBusinessImpact.trim()}," Add Impact ",8,tEe)])],32)])])):(0,s.Q3)("",!0),l.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:2,class:"risk-scoring-modal-overlay",onClick:a[56]||(a[56]=(0,i.D$)(e=>l.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-scoring-modal-content",onClick:a[55]||(a[55]=(0,i.D$)(()=>{},["stop"]))},[a[124]||(a[124]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:a[54]||(a[54]=(0,i.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"])),class:"risk-scoring-modal-form"},[(0,s.Lk)("div",iEe,[a[123]||(a[123]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[51]||(a[51]=e=>l.newCategory=e),placeholder:"Enter new category",onKeyup:a[52]||(a[52]=(0,i.jR)((0,i.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[i.Jo,l.newCategory]])]),(0,s.Lk)("div",sEe,[(0,s.Lk)("button",{type:"button",class:"risk-scoring-cancel-btn",onClick:a[53]||(a[53]=(0,i.D$)(e=>l.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-scoring-add-btn",disabled:!l.newCategory.trim()}," Add Category ",8,oEe)])],32)])])):(0,s.Q3)("",!0)],32)])):((0,s.uX)(),(0,s.CE)("div",eLe,a[59]||(a[59]=[(0,s.Lk)("p",null,"No risk instance found.",-1)])))])}const nEe={escapeHtml(e){if(null===e||void 0===e)return"";const a=String(e);return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},escapeJs(e){return null===e||void 0===e?"":JSON.stringify(String(e)).slice(1,-1)},sanitizeHtml(e){if(null===e||void 0===e)return"";let a=this.escapeHtml(String(e));const t=["b","i","em","strong","a","p","br"];return t.forEach(e=>{const t=new RegExp(`&lt;${e}( .*?)?&gt;`,"g"),i=new RegExp(`&lt;/${e}&gt;`,"g");a=a.replace(t,`<${e}>`).replace(i,`</${e}>`)}),a},safeValue(e){return null===e||void 0===e?"":"number"===typeof e?e:this.escapeHtml(String(e))}};var rEe={name:"ScoringDetails",components:{PopupModal:pv.wA},props:{riskId:{type:[String,Number],required:!0},action:{type:String,default:"view"}},data(){return{riskInstance:null,editedRiskInstance:{RiskLikelihood:null,RiskImpact:null},riskMitigationJson:"",loading:!0,error:null,submitting:!1,submitSuccess:!1,submitError:null,matchingRisks:[],selectedRisks:[],loadingMatchingRisks:!1,defaultAppetite:"No",isReadOnly:!1,businessImpacts:[],selectedBusinessImpacts:[],showBusinessImpactDropdown:!1,businessImpactSearch:"",showAddImpactModal:!1,newBusinessImpact:"",categories:[],selectedCategory:"",showCategoryDropdown:!1,categorySearch:"",showAddCategoryModal:!1,newCategory:"",mitigationForm:{description:"",actions:[]},validationRules:{ALLOWED_CRITICALITY:["Critical","High","Medium","Low"],ALLOWED_RISK_PRIORITY:["High","Medium","Low"],ALLOWED_ORIGIN:["Manual","SIEM","AuditFindings"],ALLOWED_RISK_TYPE:["Current","Residual","Inherent","Emerging","Accept"],ALLOWED_APPETITE:["Yes","No"],ALLOWED_RISK_RESPONSE_TYPE:["Mitigate","Avoid","Accept","Transfer"],RISK_LIKELIHOOD_RANGE:{min:1,max:10},RISK_IMPACT_RANGE:{min:1,max:10},TEXT_PATTERN:/^[A-Za-z0-9\s.,;:!?'"()\-_[\]]{0,}$/},validationErrors:{Criticality:"",RiskPriority:"",Origin:"",RiskType:"",Appetite:"",RiskResponseType:"",RiskLikelihood:"",RiskImpact:"",RiskTitle:"",RiskDescription:"",Category:"",BusinessImpact:"",RiskMitigation:""},sanitize:nEe}},computed:{isRejectedAction(){return"reject"===this.$route.query.action},isViewAction(){return"view"===this.$route.query.action},isCreateAction(){return"create"===this.$route.query.action},filteredBusinessImpacts(){if(!this.businessImpactSearch)return this.businessImpacts;const e=this.businessImpactSearch.toLowerCase();return this.businessImpacts.filter(a=>a.value.toLowerCase().includes(e))},filteredCategories(){if(!this.categorySearch)return this.categories;const e=this.categorySearch.toLowerCase();return this.categories.filter(a=>a.value.toLowerCase().includes(e))},activeValidationErrors(){return Object.entries(this.validationErrors).filter(([,e])=>e).map(([e,a])=>({field:e,error:a}))}},mounted(){if(this.fetchRiskInstance(),this.fetchBusinessImpacts(),this.fetchCategories(),!document.querySelector('link[href*="font-awesome"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css",document.head.appendChild(e)}const e=this.$route.query.action;e&&(console.log(`Risk ${this.riskId} action: ${e}`),"reject"===e&&(this.defaultAppetite="NO"),"view"===e&&this.setReadOnlyMode(),"create"===e&&console.log("Create action detected - will prepare for risk creation"))},methods:{setReadOnlyMode(){this.isReadOnly=!0,setTimeout(()=>{const e=document.querySelector(".risk-scoring-container");e&&e.classList.add("risk-scoring-read-only-mode")},100)},calculateRiskExposureRating(){if(this.editedRiskInstance){if(this.editedRiskInstance.RiskLikelihood&&this.editedRiskInstance.RiskImpact){const e=parseInt(this.editedRiskInstance.RiskLikelihood),a=parseInt(this.editedRiskInstance.RiskImpact);isNaN(e)||isNaN(a)||(this.editedRiskInstance.RiskExposureRating=e*a)}}else this.editedRiskInstance={RiskLikelihood:null,RiskImpact:null}},fetchRiskInstance(){if(this.isCreateAction)return this.editedRiskInstance=this.getDefaultInstance(),this.riskMitigationJson=JSON.stringify({description:"",actions:[]},null,2),void(this.loading=!1);const e=encodeURIComponent(this.riskId);qe.A.get(`http://localhost:8000/api/risk-instances/${e}/`).then(e=>{const a={...e.data,RiskTitle:this.sanitize.safeValue(e.data.RiskTitle),RiskDescription:this.sanitize.safeValue(e.data.RiskDescription),Category:this.sanitize.safeValue(e.data.Category),ReportedBy:this.sanitize.safeValue(e.data.ReportedBy),RiskLikelihood:e.data.RiskLikelihood,RiskImpact:e.data.RiskImpact,RiskExposureRating:e.data.RiskExposureRating};if(this.riskInstance=a,this.editedRiskInstance={...this.getDefaultInstance(),...JSON.parse(JSON.stringify(a))},this.editedRiskInstance.RiskMitigation)try{const e="string"===typeof this.editedRiskInstance.RiskMitigation?JSON.parse(this.editedRiskInstance.RiskMitigation):this.editedRiskInstance.RiskMitigation;e.description&&(e.description=this.sanitize.safeValue(e.description)),Array.isArray(e.actions)&&(e.actions=e.actions.map(e=>this.sanitize.safeValue(e))),this.riskMitigationJson=JSON.stringify(e,null,2)}catch(t){console.error("Error parsing RiskMitigation:",t),this.riskMitigationJson=JSON.stringify({description:"",actions:[]},null,2)}this.loading=!1,this.editedRiskInstance.ComplianceId&&this.fetchMatchingRisks(this.editedRiskInstance.ComplianceId),this.businessImpacts.length>0&&this.editedRiskInstance.BusinessImpact&&this.parseBusinessImpacts();try{const e=JSON.parse(this.riskMitigationJson);this.mitigationForm={description:this.sanitize.safeValue(e.description)||"",actions:Array.isArray(e.actions)?e.actions.map(e=>this.sanitize.safeValue(e)):[]}}catch(t){console.error("Error parsing mitigation JSON:",t),this.mitigationForm={description:"",actions:[]}}}).catch(e=>{console.error("Error fetching risk instance:",e),this.error=this.sanitize.safeValue(`Failed to fetch risk instance: ${e.message}`),this.loading=!1})},fetchMatchingRisks(e){e&&(this.loadingMatchingRisks=!0,qe.A.get("http://localhost:8000/api/risks/").then(a=>{console.log("All risks data received:",a.data),this.matchingRisks=a.data.filter(a=>a.ComplianceId&&a.ComplianceId.toString()===e.toString()),console.log("Filtered matching risks:",this.matchingRisks),this.loadingMatchingRisks=!1}).catch(e=>{console.error("Error fetching matching risks:",e),this.loadingMatchingRisks=!1}))},submitForm(){if(!this.validateForm()){const e=Object.entries(this.validationErrors).filter(e=>e[1]).map(e=>this.sanitize.escapeHtml(e[1])).join("\n");return void this.$popup.error("Please fix the following validation errors:\n"+e)}this.submitting=!0;let e={};try{if(e=JSON.parse(this.riskMitigationJson),"object"!==typeof e)throw new Error("Risk mitigation must be a valid JSON object");e.description&&(e.description=this.sanitize.escapeHtml(e.description)),Array.isArray(e.actions)&&(e.actions=e.actions.map(e=>this.sanitize.escapeHtml(e)))}catch(i){return this.$popup.error("Invalid Risk Mitigation JSON format. Please check the format and try again."),void(this.submitting=!1)}const a={...this.editedRiskInstance,RiskTitle:this.sanitize.escapeHtml(this.editedRiskInstance.RiskTitle),RiskDescription:this.sanitize.escapeHtml(this.editedRiskInstance.RiskDescription),Category:this.sanitize.escapeHtml(this.editedRiskInstance.Category),ReportedBy:this.sanitize.escapeHtml(this.editedRiskInstance.ReportedBy),RiskMitigation:e,BusinessImpact:this.selectedBusinessImpacts.map(e=>this.sanitize.escapeHtml(e.value)).join(", ")},t=encodeURIComponent(this.riskId);qe.A.put(`http://localhost:8000/api/risk-instances/${t}/`,a).then(e=>{this.riskInstance=e.data,this.editedRiskInstance=JSON.parse(JSON.stringify(e.data)),e.data.RiskMitigation&&(this.riskMitigationJson=JSON.stringify(e.data.RiskMitigation,null,2)),this.submitting=!1,this.submitSuccess=!0,this.$popup.success("Risk instance updated successfully!")}).catch(e=>{console.error("Error updating risk instance:",e),this.submitting=!1,this.$popup.error("Failed to update risk instance: "+this.sanitize.escapeHtml(e.response?.data?.message||e.message))})},formatLabel(e){return e.replace(/([A-Z])/g," $1").trim()},onAppetiteChange(){const e=(this.editedRiskInstance.Appetite||"").toLowerCase();"no"===e?(this.editedRiskInstance.RiskStatus="Rejected",this.editedRiskInstance.Appetite="No",console.log("Appetite set to No: Updated RiskStatus to Rejected")):this.isRejectedAction&&"yes"===e&&(console.log("Warning: Appetite changed from No to Yes in a rejection action"),this.editedRiskInstance.Appetite="Yes")},goBack(){this.$router.push("/risk/scoring"),this.isRejectedAction&&console.log(`Returning to Risk Scoring after rejecting risk ${this.riskId}`)},createRisk(){console.log(`Navigating to Create Risk page from risk ${this.riskId}`),this.$router.push({path:"/risk/create-risk",query:{source_risk_id:this.riskId,return_to:"scoring-details",action:"accept"}})},mapScoringRisk(){console.log(`Mapping scoring risk for risk ${this.riskId}`),this.$popup.info("Mapping scoring risk functionality will be implemented here.")},fillScoringFromSelectedRisk(){if(this.selectedRisks.length>0){const e=this.selectedRisks[0],a=this.matchingRisks.find(a=>a.RiskId===e);a?(this.editedRiskInstance.RiskId=a.RiskId,this.editedRiskInstance.RiskLikelihood=a.RiskLikelihood&&parseInt(a.RiskLikelihood)||1,this.editedRiskInstance.RiskImpact=a.RiskImpact&&parseInt(a.RiskImpact)||1,this.calculateRiskExposureRating(),this.$popup.success("Risk scoring data has been filled from the selected risk.")):this.$popup.error("Could not find the selected risk data.")}else this.$popup.warning("Please select a risk first.")},validateField(){return!0},validateAllFields(){return!0},validateResponseData(e){return Array.isArray(e)?e:(console.error("Expected array response, got:",typeof e),[])},async fetchBusinessImpacts(){try{const e=await qe.A.get("http://localhost:8000/api/business-impacts/");"success"===e.data.status&&(this.businessImpacts=e.data.data,this.editedRiskInstance&&this.editedRiskInstance.BusinessImpact&&this.parseBusinessImpacts())}catch(e){console.error("Error fetching business impacts:",e)}},parseBusinessImpacts(){if(!this.editedRiskInstance.BusinessImpact)return;const e=this.editedRiskInstance.BusinessImpact.split(",").map(e=>e.trim());e.forEach(e=>{const a=this.businessImpacts.find(a=>a.value.toLowerCase()===e.toLowerCase());a&&!this.selectedBusinessImpacts.some(e=>e.id===a.id)&&this.selectedBusinessImpacts.push(a)})},toggleBusinessImpactDropdown(){this.showBusinessImpactDropdown=!this.showBusinessImpactDropdown,this.showBusinessImpactDropdown?(this.businessImpactSearch="",document.addEventListener("click",this.closeBusinessImpactDropdown)):document.removeEventListener("click",this.closeBusinessImpactDropdown)},closeBusinessImpactDropdown(e){const a=document.querySelector(".risk-scoring-business-impact-dropdown");a&&!a.contains(e.target)&&(this.showBusinessImpactDropdown=!1,document.removeEventListener("click",this.closeBusinessImpactDropdown))},toggleBusinessImpact(e){const a=this.selectedBusinessImpacts.findIndex(a=>a.id===e.id);-1===a?this.selectedBusinessImpacts.push(e):this.selectedBusinessImpacts.splice(a,1),this.editedRiskInstance.BusinessImpact=this.selectedBusinessImpacts.map(e=>e.value).join(", ")},isBusinessImpactSelected(e){return this.selectedBusinessImpacts.some(a=>a.id===e.id)},async addNewBusinessImpact(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newBusinessImpact.trim())try{console.log("Adding new business impact:",this.newBusinessImpact);const e=await qe.A.post("http://localhost:8000/api/business-impacts/add/",{value:this.newBusinessImpact.trim()});if("success"!==e.data.status)throw new Error("Failed to add business impact: "+(e.data.message||"Unknown error"));console.log("Successfully added business impact:",e.data.data),this.businessImpacts.push(e.data.data),this.toggleBusinessImpact(e.data.data),this.showAddImpactModal=!1,this.newBusinessImpact=""}catch(a){console.error("Error adding new business impact:",a),this.$popup.error("Failed to add new business impact: "+(a.response?.data?.message||a.message))}},async fetchCategories(){try{const e=await qe.A.get("http://localhost:8000/api/risk-categories/");"success"===e.data.status&&(this.categories=e.data.data,this.editedRiskInstance&&this.editedRiskInstance.Category&&(this.selectedCategory=this.editedRiskInstance.Category))}catch(e){console.error("Error fetching categories:",e)}},toggleCategoryDropdown(){this.showCategoryDropdown=!this.showCategoryDropdown,this.showCategoryDropdown&&(this.categorySearch="")},selectCategory(e){this.selectedCategory=e.value,this.editedRiskInstance.Category=e.value,this.showCategoryDropdown=!1},async addNewCategory(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newCategory.trim())try{console.log("Adding new category:",this.newCategory);const e=await qe.A.post("http://localhost:8000/api/risk-categories/add/",{value:this.newCategory.trim()});if("success"!==e.data.status)throw new Error("Failed to add category: "+(e.data.message||"Unknown error"));console.log("Successfully added category:",e.data.data),this.categories.push(e.data.data),this.selectCategory(e.data.data),this.showAddCategoryModal=!1,this.newCategory=""}catch(a){console.error("Error adding new category:",a),this.$popup.error("Failed to add new category: "+(a.response?.data?.message||a.message))}},updateMitigationJson(){this.riskMitigationJson=JSON.stringify({description:this.mitigationForm.description,actions:this.mitigationForm.actions.filter(e=>""!==e.trim())},null,2)},addAction(){this.mitigationForm.actions.push(""),this.updateMitigationJson()},removeAction(e){this.mitigationForm.actions.splice(e,1),this.updateMitigationJson()},validateChoiceField(e,a,t){return e?t.includes(e)?"":`Invalid ${a}. Must be one of: ${t.join(", ")}`:`${a} is required`},validateNumericField(e,a,t,i){const s=parseInt(e);return isNaN(s)?`${a} must be a number`:s<t||s>i?`${a} must be between ${t} and ${i}`:""},validateTextField(e,a,t=!1){const i=this.sanitize.safeValue(e);return!i&&t?`${a} is required`:i&&!this.validationRules.TEXT_PATTERN.test(i)?`${a} contains invalid characters`:""},validateForm(){return Object.keys(this.validationErrors).forEach(e=>{this.validationErrors[e]=""}),this.validationErrors.Criticality=this.validateChoiceField(this.editedRiskInstance.Criticality,"Criticality",this.validationRules.ALLOWED_CRITICALITY),this.validationErrors.RiskPriority=this.validateChoiceField(this.editedRiskInstance.RiskPriority,"Risk Priority",this.validationRules.ALLOWED_RISK_PRIORITY),this.validationErrors.Origin=this.validateChoiceField(this.editedRiskInstance.Origin,"Origin",this.validationRules.ALLOWED_ORIGIN),this.validationErrors.RiskType=this.validateChoiceField(this.editedRiskInstance.RiskType,"Risk Type",this.validationRules.ALLOWED_RISK_TYPE),this.validationErrors.Appetite=this.validateChoiceField(this.editedRiskInstance.Appetite,"Appetite",this.validationRules.ALLOWED_APPETITE),this.validationErrors.RiskResponseType=this.validateChoiceField(this.editedRiskInstance.RiskResponseType,"Risk Response Type",this.validationRules.ALLOWED_RISK_RESPONSE_TYPE),this.validationErrors.RiskLikelihood=this.validateNumericField(this.editedRiskInstance.RiskLikelihood,"Risk Likelihood",this.validationRules.RISK_LIKELIHOOD_RANGE.min,this.validationRules.RISK_LIKELIHOOD_RANGE.max),this.validationErrors.RiskImpact=this.validateNumericField(this.editedRiskInstance.RiskImpact,"Risk Impact",this.validationRules.RISK_IMPACT_RANGE.min,this.validationRules.RISK_IMPACT_RANGE.max),this.validationErrors.RiskTitle=this.validateTextField(this.editedRiskInstance.RiskTitle,"Risk Title",!0),this.validationErrors.RiskDescription=this.validateTextField(this.editedRiskInstance.RiskDescription,"Risk Description",!0),this.validationErrors.Category=this.validateTextField(this.editedRiskInstance.Category,"Category",!0),!Object.values(this.validationErrors).some(e=>""!==e)},getDefaultInstance(){return{RiskLikelihood:null,RiskImpact:null,RiskStatus:"Not Assigned",RiskType:"Current",Appetite:this.isRejectedAction?"No":"Yes",RiskResponseType:"Mitigation",RiskMitigation:{},BusinessImpact:"",ComplianceId:"",RiskTitle:"",RiskDescription:"",Category:"",Criticality:"",RiskPriority:"",Origin:"",ReportedBy:""}}},watch:{"editedRiskInstance.ComplianceId":function(e){console.log("ComplianceId changed to:",e),this.selectedRisks=[],e?this.fetchMatchingRisks(e):this.matchingRisks=[]}}};const cEe=(0,se.A)(rEe,[["render",lEe]]);var dEe=cEe;const uEe={class:"risk-resolution-container"},pEe={class:"risk-resolution-toggle-buttons"},vEe={class:"risk-resolution-filters-wrapper"},mEe={class:"risk-resolution-filter-dropdowns"},kEe={key:0,class:"risk-resolution-loading"},hEe={key:1,class:"risk-resolution-error-message"},gEe={key:2,class:"risk-resolution-no-data"},yEe={key:3,class:"risk-resolution-collapsible-container"},fEe={key:4,class:"risk-resolution-mitigation-workflow-section"},bEe={class:"risk-resolution-mitigation-header"},CEe={key:0},LEe={key:1},wEe={class:"risk-resolution-mitigation-body"},EEe={key:0,class:"risk-resolution-loading"},REe={key:1},DEe={class:"risk-resolution-risk-summary"},IEe={class:"risk-resolution-risk-details"},PEe={class:"risk-resolution-reviewer-info"},_Ee={key:0,class:"risk-resolution-assignment-section"},SEe={class:"risk-resolution-assignment-fields"},AEe={class:"risk-resolution-assignment-field"},TEe=["value"],xEe={key:0,class:"risk-resolution-selected-user-info"},FEe={class:"risk-resolution-assignment-field"},VEe=["value"],MEe={key:0,class:"risk-resolution-selected-user-info"},XEe={class:"risk-resolution-assignment-field"},UEe=["readonly","min"],NEe={class:"risk-resolution-mitigation-workflow"},$Ee={key:0,class:"risk-resolution-workflow-timeline"},OEe={class:"risk-resolution-step-number"},jEe={class:"risk-resolution-step-content"},BEe=["onUpdate:modelValue","readonly"],WEe={class:"risk-resolution-step-actions"},QEe=["onClick","disabled"],qEe={key:1,class:"risk-resolution-no-mitigations"},KEe={class:"risk-resolution-add-mitigation"},JEe=["readonly"],zEe=["disabled"],HEe={class:"risk-resolution-due-date-section"},YEe=["readonly","min"],GEe={class:"risk-resolution-form-section",style:{display:"none"}},ZEe={class:"risk-resolution-form-field horizontal"},eRe=["readonly"],aRe={class:"risk-resolution-form-field horizontal"},tRe=["readonly"],iRe={class:"risk-resolution-form-field horizontal"},sRe=["readonly"],oRe={class:"risk-resolution-form-field horizontal"},lRe=["readonly"],nRe={class:"risk-resolution-form-field horizontal"},rRe=["readonly"],cRe={class:"risk-resolution-form-field horizontal"},dRe=["readonly"],uRe={class:"risk-resolution-form-field horizontal"},pRe=["readonly"],vRe={class:"risk-resolution-form-field horizontal"},mRe=["readonly"],kRe={class:"risk-resolution-form-field horizontal"},hRe=["disabled"],gRe={class:"risk-resolution-form-field horizontal"},yRe=["disabled"],fRe={class:"risk-resolution-mitigation-actions"},bRe={key:0,class:"risk-resolution-form-warning",style:{display:"none"}},CRe=["disabled"],LRe={key:5,class:"risk-resolution-questionnaire-modal-overlay"},wRe={class:"risk-resolution-questionnaire-modal-content"},ERe={key:0},RRe={class:"risk-resolution-questionnaire-field"},DRe={class:"risk-resolution-questionnaire-field"},IRe={class:"risk-resolution-questionnaire-field"},PRe={class:"risk-resolution-questionnaire-field"},_Re={class:"risk-resolution-questionnaire-field"},SRe={class:"risk-resolution-questionnaire-field"},ARe={class:"risk-resolution-questionnaire-field"},TRe={class:"risk-resolution-questionnaire-field"},xRe={class:"risk-resolution-questionnaire-field"},FRe={class:"risk-resolution-questionnaire-field"},VRe={key:1};function MRe(e,a,t,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("Dynamicalsearch"),u=(0,s.g2)("CustomDropdown"),p=(0,s.g2)("CollapsibleTable");return(0,s.uX)(),(0,s.CE)("div",uEe,[(0,s.bF)(r),(0,s.Lk)("div",pEe,[(0,s.Lk)("button",{class:"risk-resolution-toggle-button active",onClick:a[0]||(a[0]=e=>n.navigateTo("resolution"))}," Risk Resolution "),(0,s.Lk)("button",{class:"risk-resolution-toggle-button",onClick:a[1]||(a[1]=e=>n.navigateTo("workflow"))}," Risk Workflow ")]),(0,s.Lk)("div",vEe,[(0,s.bF)(c,{modelValue:l.searchQuery,"onUpdate:modelValue":a[2]||(a[2]=e=>l.searchQuery=e),placeholder:"Search risks...",onInput:n.filterRisks},null,8,["modelValue","onInput"]),(0,s.Lk)("div",mEe,[(0,s.bF)(u,{config:n.criticalityDropdownConfig,modelValue:l.criticalityFilter,"onUpdate:modelValue":a[3]||(a[3]=e=>l.criticalityFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"]),(0,s.bF)(u,{config:n.statusDropdownConfig,modelValue:l.statusFilter,"onUpdate:modelValue":a[4]||(a[4]=e=>l.statusFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"]),(0,s.bF)(u,{config:n.assignedToDropdownConfig,modelValue:l.assignedToFilter,"onUpdate:modelValue":a[5]||(a[5]=e=>l.assignedToFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"]),(0,s.bF)(u,{config:n.reviewerDropdownConfig,modelValue:l.reviewerFilter,"onUpdate:modelValue":a[6]||(a[6]=e=>l.reviewerFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"])])]),l.loading?((0,s.uX)(),(0,s.CE)("div",kEe,a[26]||(a[26]=[(0,s.Lk)("div",{class:"risk-resolution-spinner"},null,-1),(0,s.Lk)("span",null,"Loading risk data...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",hEe,(0,d.v_)(l.error),1)):0===l.filteredRisks.length?((0,s.uX)(),(0,s.CE)("div",gEe,a[27]||(a[27]=[(0,s.Lk)("p",null,"No eligible risk instances found for resolution. Either there are no risks with completed scoring, or all scored risks have been rejected.",-1),(0,s.Lk)("p",{class:"risk-resolution-no-data-subtitle"},"Note: Rejected risks are not displayed in Risk Resolution as they don't require further processing.",-1)]))):l.showMitigationModal?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",yEe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.riskSections,(e,a)=>((0,s.uX)(),(0,s.Wv)(p,{key:e.name,"section-config":e,"table-headers":n.tableHeaders,"is-expanded":l.expandedSections[a],onToggle:e=>n.toggleSection(a),onTaskClick:n.openMitigationModal,onAddTask:n.addTaskToSection},null,8,["section-config","table-headers","is-expanded","onToggle","onTaskClick","onAddTask"]))),128))])),l.showMitigationModal?((0,s.uX)(),(0,s.CE)("div",fEe,[(0,s.Lk)("div",bEe,[l.viewOnlyMitigationModal?((0,s.uX)(),(0,s.CE)("h2",CEe,"Viewing Mitigation Steps")):((0,s.uX)(),(0,s.CE)("h2",LEe,"Assign Risk with Mitigation Steps")),(0,s.Lk)("button",{class:"risk-resolution-back-btn",onClick:a[7]||(a[7]=(...e)=>n.closeMitigationModal&&n.closeMitigationModal(...e))},a[28]||(a[28]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Risks ")]))]),(0,s.Lk)("div",wEe,[l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",EEe,a[29]||(a[29]=[(0,s.Lk)("div",{class:"risk-resolution-spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation steps...",-1)]))):((0,s.uX)(),(0,s.CE)("div",REe,[(0,s.Lk)("div",DEe,[(0,s.Lk)("h3",null,(0,d.v_)(l.selectedRisk.RiskTitle||"Risk #"+l.selectedRisk.RiskInstanceId),1),(0,s.Lk)("div",IEe,[(0,s.Lk)("p",null,[a[30]||(a[30]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedRisk.RiskInstanceId),1)]),(0,s.Lk)("p",null,[a[31]||(a[31]=(0,s.Lk)("strong",null,"Category:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedRisk.Category),1)]),(0,s.Lk)("p",null,[a[32]||(a[32]=(0,s.Lk)("strong",null,"Criticality:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedRisk.Criticality),1)]),(0,s.Lk)("p",null,[a[33]||(a[33]=(0,s.Lk)("strong",null,"Reviewer:",-1)),a[34]||(a[34]=(0,s.eW)()),(0,s.Lk)("span",PEe,(0,d.v_)(l.selectedRisk.Reviewer||l.selectedRisk.ReviewerName||"Not Assigned"),1)])])]),l.viewOnlyMitigationModal?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",_Ee,[a[40]||(a[40]=(0,s.Lk)("h3",null,"Assign Risk",-1)),(0,s.Lk)("div",SEe,[(0,s.Lk)("div",AEe,[a[36]||(a[36]=(0,s.Lk)("label",null,"Assign To:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[8]||(a[8]=e=>l.selectedUsers[l.selectedRisk.RiskInstanceId]=e),class:"risk-resolution-assignment-dropdown"},[a[35]||(a[35]=(0,s.Lk)("option",{value:""},"Select User",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:n.getUserId(e),value:n.getUserId(e)},(0,d.v_)(n.getUserName(e))+" (ID: "+(0,d.v_)(n.getUserId(e))+") ",9,TEe))),128))],512),[[i.u1,l.selectedUsers[l.selectedRisk.RiskInstanceId]]]),l.selectedUsers[l.selectedRisk.RiskInstanceId]?((0,s.uX)(),(0,s.CE)("div",xEe," Selected User ID: "+(0,d.v_)(l.selectedUsers[l.selectedRisk.RiskInstanceId]),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",FEe,[a[38]||(a[38]=(0,s.Lk)("label",null,"Reviewer:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[9]||(a[9]=e=>l.selectedReviewers[l.selectedRisk.RiskInstanceId]=e),class:"risk-resolution-assignment-dropdown"},[a[37]||(a[37]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:n.getUserId(e),value:n.getUserId(e)},(0,d.v_)(n.getUserName(e))+" (ID: "+(0,d.v_)(n.getUserId(e))+") ",9,VEe))),128))],512),[[i.u1,l.selectedReviewers[l.selectedRisk.RiskInstanceId]]]),l.selectedReviewers[l.selectedRisk.RiskInstanceId]?((0,s.uX)(),(0,s.CE)("div",MEe," Selected Reviewer ID: "+(0,d.v_)(l.selectedReviewers[l.selectedRisk.RiskInstanceId]),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",XEe,[a[39]||(a[39]=(0,s.Lk)("label",null,"Due Date for Mitigation:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[10]||(a[10]=e=>l.mitigationDueDate=e),class:"risk-resolution-assignment-dropdown",readonly:l.viewOnlyMitigationModal,min:n.getTodayDate()},null,8,UEe),[[i.Jo,l.mitigationDueDate]])])])])),(0,s.Lk)("div",NEe,[a[61]||(a[61]=(0,s.Lk)("h3",null,"Mitigation Steps",-1)),l.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",$Ee,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"risk-resolution-workflow-step"},[(0,s.Lk)("div",OEe,(0,d.v_)(t+1),1),(0,s.Lk)("div",jEe,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a=>e.description=a,class:"risk-resolution-mitigation-textarea",readonly:l.viewOnlyMitigationModal,placeholder:"Enter mitigation step description"},null,8,BEe),[[i.Jo,e.description]]),(0,s.Lk)("div",WEe,[(0,s.Lk)("button",{onClick:e=>n.removeMitigationStep(t),class:"risk-resolution-remove-step-btn",disabled:l.viewOnlyMitigationModal},a[41]||(a[41]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1),(0,s.eW)(" Remove ")]),8,QEe)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",qEe,a[42]||(a[42]=[(0,s.Lk)("p",null,"No mitigation steps defined for this risk. Add steps below.",-1)]))),(0,s.Lk)("div",KEe,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[11]||(a[11]=e=>l.newMitigationStep=e),class:"risk-resolution-mitigation-textarea",readonly:l.viewOnlyMitigationModal,placeholder:"Enter a new mitigation step description"},null,8,JEe),[[i.Jo,l.newMitigationStep]]),(0,s.Lk)("button",{onClick:a[12]||(a[12]=(...e)=>n.addMitigationStep&&n.addMitigationStep(...e)),class:"risk-resolution-add-step-btn",disabled:l.viewOnlyMitigationModal||!l.newMitigationStep.trim()},a[43]||(a[43]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Mitigation Step ")]),8,zEe)]),(0,s.Lk)("div",HEe,[a[44]||(a[44]=(0,s.Lk)("h4",null,"Due Date for Mitigation Completion",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":a[13]||(a[13]=e=>l.mitigationDueDate=e),class:"risk-resolution-due-date-input",readonly:l.viewOnlyMitigationModal,min:n.getTodayDate()},null,8,YEe),[[i.Jo,l.mitigationDueDate]])]),(0,s.Lk)("div",GEe,[a[57]||(a[57]=(0,s.Lk)("h4",null,"Risk Mitigation Questionnaire",-1)),a[58]||(a[58]=(0,s.Lk)("p",{class:"risk-resolution-form-note"},"Please complete these details about the risk mitigation:",-1)),(0,s.Lk)("div",ZEe,[a[45]||(a[45]=(0,s.Lk)("label",{for:"cost-input"},"1. What is the cost for this mitigation?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"cost-input","onUpdate:modelValue":a[14]||(a[14]=e=>l.riskFormDetails.cost=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter the cost...",class:"risk-resolution-form-textarea"},null,8,eRe),[[i.Jo,l.riskFormDetails.cost]])]),(0,s.Lk)("div",aRe,[a[46]||(a[46]=(0,s.Lk)("label",{for:"impact-input"},"2. What is the impact for this mitigation?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"impact-input","onUpdate:modelValue":a[15]||(a[15]=e=>l.riskFormDetails.impact=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter the impact...",class:"risk-resolution-form-textarea"},null,8,tRe),[[i.Jo,l.riskFormDetails.impact]])]),(0,s.Lk)("div",iRe,[a[47]||(a[47]=(0,s.Lk)("label",{for:"financial-impact-input"},"3. What is the financial impact for this mitigation?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"financial-impact-input","onUpdate:modelValue":a[16]||(a[16]=e=>l.riskFormDetails.financialImpact=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter the financial impact...",class:"risk-resolution-form-textarea"},null,8,sRe),[[i.Jo,l.riskFormDetails.financialImpact]])]),(0,s.Lk)("div",oRe,[a[48]||(a[48]=(0,s.Lk)("label",{for:"reputational-impact-input"},"4. What is the reputational impact for this mitigation?",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"reputational-impact-input","onUpdate:modelValue":a[17]||(a[17]=e=>l.riskFormDetails.reputationalImpact=e),readonly:l.viewOnlyMitigationModal,placeholder:"Describe the reputational impact...",class:"risk-resolution-form-textarea"},null,8,lRe),[[i.Jo,l.riskFormDetails.reputationalImpact]])]),(0,s.Lk)("div",nRe,[a[49]||(a[49]=(0,s.Lk)("label",{for:"operational-impact-input"},"5. What is the Operational Impact for this mitigation?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"operational-impact-input","onUpdate:modelValue":a[18]||(a[18]=e=>l.riskFormDetails.operationalImpact=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter the operational impact...",class:"risk-resolution-form-textarea"},null,8,rRe),[[i.Jo,l.riskFormDetails.operationalImpact]])]),(0,s.Lk)("div",cRe,[a[50]||(a[50]=(0,s.Lk)("label",{for:"financial-loss-input"},"6. What is the Financial Loss for this mitigation?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"financial-loss-input","onUpdate:modelValue":a[19]||(a[19]=e=>l.riskFormDetails.financialLoss=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter the financial loss...",class:"risk-resolution-form-textarea"},null,8,dRe),[[i.Jo,l.riskFormDetails.financialLoss]])]),(0,s.Lk)("div",uRe,[a[51]||(a[51]=(0,s.Lk)("label",{for:"system-downtime-input"},"7. What is the expected system downtime (hrs) if this risk occurs?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"system-downtime-input","onUpdate:modelValue":a[20]||(a[20]=e=>l.riskFormDetails.systemDowntime=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter expected downtime in hours...",class:"risk-resolution-form-textarea"},null,8,pRe),[[i.Jo,l.riskFormDetails.systemDowntime]])]),(0,s.Lk)("div",vRe,[a[52]||(a[52]=(0,s.Lk)("label",{for:"recovery-time-input"},"8. How long did it take to recover last time (hrs)?",-1)),(0,s.bo)((0,s.Lk)("input",{id:"recovery-time-input","onUpdate:modelValue":a[21]||(a[21]=e=>l.riskFormDetails.recoveryTime=e),type:"number",readonly:l.viewOnlyMitigationModal,min:"0",placeholder:"Enter recovery time in hours...",class:"risk-resolution-form-textarea"},null,8,mRe),[[i.Jo,l.riskFormDetails.recoveryTime]])]),(0,s.Lk)("div",kRe,[a[54]||(a[54]=(0,s.Lk)("label",{for:"recurrence-possible-input"},"9. Is it possible that this risk will recur again?",-1)),(0,s.bo)((0,s.Lk)("select",{id:"recurrence-possible-input","onUpdate:modelValue":a[22]||(a[22]=e=>l.riskFormDetails.recurrencePossible=e),disabled:l.viewOnlyMitigationModal,class:"risk-resolution-form-textarea"},a[53]||(a[53]=[(0,s.Lk)("option",{value:""},"Select",-1),(0,s.Lk)("option",{value:"Yes"},"Yes",-1),(0,s.Lk)("option",{value:"No"},"No",-1),(0,s.Lk)("option",{value:"Unknown"},"Unknown",-1)]),8,hRe),[[i.u1,l.riskFormDetails.recurrencePossible]])]),(0,s.Lk)("div",gRe,[a[56]||(a[56]=(0,s.Lk)("label",{for:"improvement-initiative-input"},"10. Is this an Improvement Initiative which will prevent the future recurrence of said risk?",-1)),(0,s.bo)((0,s.Lk)("select",{id:"improvement-initiative-input","onUpdate:modelValue":a[23]||(a[23]=e=>l.riskFormDetails.improvementInitiative=e),disabled:l.viewOnlyMitigationModal,class:"risk-resolution-form-textarea"},a[55]||(a[55]=[(0,s.Lk)("option",{value:""},"Select",-1),(0,s.Lk)("option",{value:"Yes"},"Yes",-1),(0,s.Lk)("option",{value:"No"},"No",-1),(0,s.Lk)("option",{value:"Unknown"},"Unknown",-1)]),8,yRe),[[i.u1,l.riskFormDetails.improvementInitiative]])])]),(0,s.Lk)("div",fRe,[l.viewOnlyMitigationModal&&!n.isFormComplete()?((0,s.uX)(),(0,s.CE)("div",bRe,a[59]||(a[59]=[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1),(0,s.eW)(" Please complete all questionnaire fields ")]))):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:a[24]||(a[24]=(...e)=>n.assignRiskWithMitigations&&n.assignRiskWithMitigations(...e)),class:"risk-resolution-submit-mitigations-btn",disabled:l.viewOnlyMitigationModal||0===l.mitigationSteps.length||!l.mitigationDueDate||!l.selectedUsers[l.selectedRisk.RiskInstanceId]||!l.selectedReviewers[l.selectedRisk.RiskInstanceId]},a[60]||(a[60]=[(0,s.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,s.eW)(" Assign with Mitigations ")]),8,CRe)])])]))])])):(0,s.Q3)("",!0),l.showQuestionnaireModal?((0,s.uX)(),(0,s.CE)("div",LRe,[(0,s.Lk)("div",wRe,[(0,s.Lk)("button",{class:"risk-resolution-close-modal-btn",onClick:a[25]||(a[25]=(...e)=>n.closeQuestionnaireModal&&n.closeQuestionnaireModal(...e))},a[62]||(a[62]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)])),a[74]||(a[74]=(0,s.Lk)("h3",null,"Risk Mitigation Questionnaire (View Only)",-1)),l.selectedQuestionnaire?((0,s.uX)(),(0,s.CE)("div",ERe,[(0,s.Lk)("div",RRe,[a[63]||(a[63]=(0,s.Lk)("strong",null,"1. Cost:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.cost),1)]),(0,s.Lk)("div",DRe,[a[64]||(a[64]=(0,s.Lk)("strong",null,"2. Impact:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.impact),1)]),(0,s.Lk)("div",IRe,[a[65]||(a[65]=(0,s.Lk)("strong",null,"3. Financial Impact:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.financialImpact),1)]),(0,s.Lk)("div",PRe,[a[66]||(a[66]=(0,s.Lk)("strong",null,"4. Reputational Impact:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.reputationalImpact),1)]),(0,s.Lk)("div",_Re,[a[67]||(a[67]=(0,s.Lk)("strong",null,"5. Operational Impact:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.operationalImpact),1)]),(0,s.Lk)("div",SRe,[a[68]||(a[68]=(0,s.Lk)("strong",null,"6. Financial Loss:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.financialLoss),1)]),(0,s.Lk)("div",ARe,[a[69]||(a[69]=(0,s.Lk)("strong",null,"7. System Downtime (hrs):",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.systemDowntime),1)]),(0,s.Lk)("div",TRe,[a[70]||(a[70]=(0,s.Lk)("strong",null,"8. Recovery Time (hrs):",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.recoveryTime),1)]),(0,s.Lk)("div",xRe,[a[71]||(a[71]=(0,s.Lk)("strong",null,"9. Recurrence Possible:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.recurrencePossible),1)]),(0,s.Lk)("div",FRe,[a[72]||(a[72]=(0,s.Lk)("strong",null,"10. Improvement Initiative:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedQuestionnaire.improvementInitiative),1)])])):((0,s.uX)(),(0,s.CE)("div",VRe,a[73]||(a[73]=[(0,s.Lk)("p",null,"No questionnaire data found for this risk.",-1)])))])])):(0,s.Q3)("",!0)])}var XRe={name:"RiskResolution",components:{CustomDropdown:mt.A,Dynamicalsearch:JK.A,CollapsibleTable:Cl,PopupModal:pv.wA},data(){return{risks:[],filteredRisks:[],users:[],selectedUsers:{},selectedReviewers:{},loading:!0,error:null,showMitigationModal:!1,selectedRisk:{},mitigationSteps:[],newMitigationStep:"",loadingMitigations:!1,mitigationDueDate:"",riskFormDetails:{cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:""},showQuestionnaireModal:!1,selectedQuestionnaire:null,viewOnlyMitigationModal:!1,searchQuery:"",criticalityFilter:"",statusFilter:"",assignedToFilter:"",reviewerFilter:"",expandedSections:[]}},computed:{uniqueCriticalities(){return[...new Set(this.risks.map(e=>e.Criticality).filter(Boolean))]},uniqueStatuses(){return[...new Set(this.risks.map(e=>e.RiskStatus).filter(Boolean))]},uniqueAssignedUsers(){return[...new Set(this.risks.map(e=>e.RiskOwner&&"System Owner"!==e.RiskOwner&&"System User"!==e.RiskOwner?e.RiskOwner:"Not Assigned"))]},uniqueReviewers(){return[...new Set(this.risks.map(e=>e.ReviewerName||"Not Assigned"))]},tableHeaders(){return[{key:"riskId",label:"RISK ID",width:"80px"},{key:"riskTitle",label:"Risk Title",width:"200px"},{key:"category",label:"Category",width:"120px"},{key:"criticality",label:"Criticality",width:"100px"},{key:"assignedTo",label:"Assigned To",width:"150px"},{key:"reviewer",label:"Reviewer",width:"150px"},{key:"reviewCount",label:"Review Count",width:"100px"},{key:"actions",label:"Action",width:"120px"}]},riskSections(){const e={};return this.filteredRisks.forEach(a=>{const t=a.RiskStatus||"Unknown";e[t]||(e[t]={name:t,statusClass:this.getStatusClass(t),tasks:[]});const i={incidentId:a.RiskInstanceId,riskId:a.RiskInstanceId,riskTitle:a.RiskTitle||"No title",category:a.Category||"N/A",criticality:a.Criticality||"N/A",assignedTo:a.RiskOwner&&"System Owner"!==a.RiskOwner&&"System User"!==a.RiskOwner?a.RiskOwner:"Not Assigned",reviewer:a.Reviewer||a.ReviewerName||"Not Assigned",reviewCount:a.ReviewerCount||0,actions:"assign",originalRisk:a};e[t].tasks.push(i)}),Object.values(e).sort((e,a)=>{const t={Assigned:1,"In Progress":2,Pending:3,Open:4,Completed:5,Closed:6,Rejected:7};return(t[e.name]||999)-(t[a.name]||999)})},criticalityDropdownConfig(){return{label:"Criticality",defaultValue:"All Criticality",values:[{value:"",label:"All Criticality"},...this.uniqueCriticalities.map(e=>({value:e,label:e}))]}},statusDropdownConfig(){return{label:"Status",defaultValue:"All Status",values:[{value:"",label:"All Status"},...this.uniqueStatuses.map(e=>({value:e,label:e}))]}},assignedToDropdownConfig(){return{label:"Assigned To",defaultValue:"All Assigned To",values:[{value:"",label:"All Assigned To"},...this.uniqueAssignedUsers.map(e=>({value:e,label:e}))]}},reviewerDropdownConfig(){return{label:"Reviewer",defaultValue:"All Reviewers",values:[{value:"",label:"All Reviewers"},...this.uniqueReviewers.map(e=>({value:e,label:e}))]}}},mounted(){this.searchQuery="",this.criticalityFilter="",this.statusFilter="",this.assignedToFilter="",this.reviewerFilter="",this.fetchRisks(),this.fetchUsers()},created(){this.filteredRisks=this.risks},methods:{fetchRisks(){qe.A.get("http://localhost:8000/api/risk-instances/").then(e=>{console.log("Risk data received:",e.data),e.data&&e.data.length>0&&e.data.forEach(e=>{console.log(`Risk ID: ${e.RiskInstanceId}, Reviewer: ${e.Reviewer||e.ReviewerName||"None"}, ReviewerId: ${e.ReviewerId||"None"}`)});const a=e.data.filter(e=>{const a=this.hasCompletedScoring(e),t=!this.isRiskRejected(e);return a&&t});console.log(`Filtered ${e.data.length-a.length} risks without complete scoring or rejected status`),this.risks=a,this.filteredRisks=[...a],this.loading=!1,this.initializeExpandedSections()}).catch(e=>{console.error("Error fetching risks:",e),this.error=`Failed to fetch risks: ${e.message}`,this.loading=!1})},fetchUsers(){qe.A.get("http://localhost:8000/api/custom-users/").then(e=>{console.log("User data received:",e.data),this.users=e.data,this.users&&this.users.length>0?(console.log(`Loaded ${this.users.length} users successfully`),console.log("Sample user data:",this.users[0]),this.users.forEach(e=>{const a=this.getUserId(e);console.log(`User: ${this.getUserName(e)}, ID: ${a}, Type: ${typeof a}`)})):console.warn("No users found or empty users array returned")}).catch(e=>{console.error("Error fetching users:",e),this.error="Failed to load user data. Please refresh the page or contact support."})},filterRisks(){this.filteredRisks=this.risks.filter(e=>{const a=this.searchQuery.toLowerCase(),t=!this.searchQuery||e.RiskInstanceId&&e.RiskInstanceId.toString().toLowerCase().includes(a)||e.RiskTitle&&e.RiskTitle.toLowerCase().includes(a)||e.Category&&e.Category.toLowerCase().includes(a)||e.Criticality&&e.Criticality.toLowerCase().includes(a)||e.RiskStatus&&e.RiskStatus.toLowerCase().includes(a)||e.RiskDescription&&e.RiskDescription.toLowerCase().includes(a),i=!this.criticalityFilter||e.Criticality===this.criticalityFilter,s=!this.statusFilter||e.RiskStatus===this.statusFilter,o=e.RiskOwner&&"System Owner"!==e.RiskOwner&&"System User"!==e.RiskOwner?e.RiskOwner:"Not Assigned",l=!this.assignedToFilter||o===this.assignedToFilter,n=e.ReviewerName||"Not Assigned",r=!this.reviewerFilter||n===this.reviewerFilter;return t&&i&&s&&l&&r}),console.log(`Applied filters: ${this.filteredRisks.length} risks displayed out of ${this.risks.length} total risks with completed scoring`)},initializeExpandedSections(){this.expandedSections=this.riskSections.map(()=>!0)},toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]},addTaskToSection(e){console.log("Adding task to section:",e)},openMitigationModal(e){let a=e;"object"===typeof e&&null!==e&&(a=e.incidentId);let t=null;for(const i of this.riskSections){const e=i.tasks.find(e=>e.incidentId===a);if(e){t=e.originalRisk;break}}t?(this.selectedRisk=t,this.showMitigationModal=!0,this.loadingMitigations=!0,t.UserId&&(this.selectedUsers[t.RiskInstanceId]=t.UserId),t.ReviewerId&&(this.selectedReviewers[t.RiskInstanceId]=t.ReviewerId),qe.A.get(`http://localhost:8000/api/risk-instances/${t.RiskInstanceId}/`).then(e=>{if(console.log("Risk instance data:",e.data),this.selectedRisk=e.data,e.data.RiskMitigation){let t=[];const i=e.data.RiskMitigation;if("string"===typeof i)try{const e=JSON.parse(i);"object"===typeof e&&Object.keys(e).forEach(a=>{t.push({description:e[a],status:"Not Started"})})}catch(a){t=[{description:i,status:"Not Started"}]}else"object"!==typeof i||Array.isArray(i)?Array.isArray(i)&&(t=i.map(e=>({description:"string"===typeof e?e:e.description,status:e.status||"Not Started"}))):Object.keys(i).forEach(e=>{t.push({description:i[e],status:"Not Started"})});this.mitigationSteps=t}else this.mitigationSteps=[];if(this.loadingMitigations=!1,e.data.MitigationDueDate)this.mitigationDueDate=e.data.MitigationDueDate;else{const e=new Date;e.setDate(e.getDate()+7);const a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");this.mitigationDueDate=`${a}-${t}-${i}`}}).catch(e=>{console.error("Error fetching risk instance:",e),this.mitigationSteps=[],this.loadingMitigations=!1;const a=new Date;a.setDate(a.getDate()+7);const t=a.getFullYear(),i=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");this.mitigationDueDate=`${t}-${i}-${s}`})):console.error("Risk not found for incidentId:",a)},closeMitigationModal(){this.showMitigationModal=!1,this.selectedRisk={},this.mitigationSteps=[],this.newMitigationStep="",this.mitigationDueDate="",this.riskFormDetails={cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:""},this.viewOnlyMitigationModal=!1},parseMitigations(e){if(!e||0===e.length)return[];if(Array.isArray(e)&&e[0]&&e[0].description)return e.map(e=>({description:e.description||e.title||"",status:e.status||"Not Started"}));if(Array.isArray(e))return e.map((e,a)=>({description:"string"===typeof e?e:e.description||e.title||`Step ${a+1}`,status:e.status||"Not Started"}));if("object"===typeof e&&!Array.isArray(e)){const a=[];return Object.keys(e).forEach(t=>{const i=e[t];a.push({description:"string"===typeof i?i:i.description||i.title||`Step ${t}`,status:i.status||"Not Started"})}),a}return"string"===typeof e?[{description:e,status:"Not Started"}]:[]},addMitigationStep(){this.newMitigationStep.trim()&&(this.mitigationSteps.push({description:this.newMitigationStep,status:"Not Started"}),this.newMitigationStep="")},removeMitigationStep(e){this.mitigationSteps.splice(e,1)},assignRiskWithMitigations(){const e=this.selectedRisk.RiskInstanceId,a=this.selectedUsers[e],t=this.selectedReviewers[e];if(!a)return this.$popup.warning("No user selected. Please select a user to assign this risk to."),void(this.loading=!1);const i=parseInt(a,10),s=parseInt(t,10);if(console.log("Assigning risk with following IDs:",{riskId:e,userId:i,reviewerId:s}),!i||!s||0===this.mitigationSteps.length||!this.mitigationDueDate)return i?s?0===this.mitigationSteps.length?void this.$popup.warning("Please add at least one mitigation step."):this.mitigationDueDate?void 0:void this.$popup.warning("Please select a due date for mitigation completion."):void this.$popup.warning("Please select a valid reviewer for this risk."):void this.$popup.warning("Please select a valid user to assign this risk to.");this.loading=!0;const o={};this.mitigationSteps.forEach((e,a)=>{o[a+1]=e.description}),console.log("Sending mitigation data:",o),console.log("User ID type:",typeof i,"value:",i),console.log("Reviewer ID type:",typeof s,"value:",s);const l={risk_id:parseInt(e,10),UserId:i,mitigations:o,due_date:this.mitigationDueDate,risk_form_details:{}};console.log("Exact payload being sent to risk-assign API:",JSON.stringify(l)),qe.A.post("http://localhost:8000/api/risk-assign/",l,{headers:{"Content-Type":"application/json"}}).then(a=>{console.log("Assignment response:",a.data);const t={risk_id:parseInt(e,10),ReviewerId:s,UserId:i,mitigations:o,risk_form_details:{},create_approval_record:!1};return console.log("Exact payload being sent to assign-reviewer API:",JSON.stringify(t)),qe.A.post("http://localhost:8000/api/assign-reviewer/",t,{headers:{"Content-Type":"application/json"}})}).then(i=>{console.log("Reviewer assignment response:",i.data);const s=this.risks.findIndex(a=>a.RiskInstanceId===e);if(-1!==s){const e=this.users.find(e=>this.getUserId(e)==a),i=this.users.find(e=>this.getUserId(e)==t);e&&i?(this.risks[s].RiskOwner=this.getUserName(e),this.risks[s].UserId=a,this.risks[s].ReviewerId=Number(t),this.risks[s].ReviewerName=this.getUserName(i),this.risks[s].Reviewer=this.getUserName(i),this.risks[s].RiskStatus="Assigned",this.risks[s].RiskMitigation=o,this.risks[s].MitigationDueDate=this.mitigationDueDate,this.risks[s].MitigationStatus="Yet to Start",this.risks[s].RiskFormDetails={}):console.error("Could not find assigned user or reviewer:",{userId:a,reviewerId:t})}this.loading=!1,this.closeMitigationModal(),this.$popup.success("Risk assigned successfully with mitigation steps and reviewer!")}).catch(e=>{console.error("Error assigning risk:",e),this.loading=!1;let a="Failed to assign risk. ";e.response?(a+=`Server error: ${e.response.status} - ${e.response.data.message||e.response.data||"Unknown error"}`,console.error("Error response data:",e.response.data)):e.request?a+="No response received from server. Please check your network connection.":a+=e.message||"Unknown error occurred",this.$popup.error(a)})},getCriticalityClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("high")?"high":a.includes("medium")?"medium":a.includes("low")?"low":a.includes("critical")?"critical":""},getPriorityClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("high")?"high":a.includes("medium")?"medium":a.includes("low")?"low":""},getStatusClass(e){if(!e)return"pending";const a=e.toLowerCase();return a.includes("assigned")||a.includes("in progress")?"in-progress":a.includes("completed")||a.includes("closed")||a.includes("approved")?"completed":a.includes("rejected")?"rejected":(a.includes("pending")||a.includes("open"),"pending")},getRowClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("approved")?"row-approved":a.includes("review")?"row-review":""},getTodayDate(){const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${i}`},isFormComplete(){return!0},isRiskRejected(e){if(!e)return!1;const a=(e.Appetite||"").toLowerCase(),t=(e.RiskStatus||"").toLowerCase();return"no"===a||"rejected"===t},hasCompletedScoring(e){return!!e&&(void 0!==e.RiskLikelihood&&null!==e.RiskLikelihood&&void 0!==e.RiskImpact&&null!==e.RiskImpact&&void 0!==e.RiskExposureRating&&null!==e.RiskExposureRating)},viewQuestionnaire(e){console.log("Viewing mitigation steps for risk:",e.RiskInstanceId),qe.A.get(`http://localhost:8000/api/risk-instances/${e.RiskInstanceId}/`).then(a=>{const t=a.data;this.selectedRisk=t,qe.A.get(`http://localhost:8000/api/risk-mitigations/${e.RiskInstanceId}/`).then(e=>{console.log("Mitigation steps:",e.data),this.mitigationSteps=this.parseMitigations(e.data),this.showMitigationModal=!0,this.viewOnlyMitigationModal=!0,this.mitigationDueDate=t.MitigationDueDate||"";let a=t.RiskFormDetails;if("string"===typeof a)try{a=JSON.parse(a)}catch(i){a={}}this.riskFormDetails=this.mapRiskFormDetails(a)}).catch(e=>{console.error("Error fetching mitigation steps:",e),this.mitigationSteps=this.parseMitigations(t.RiskMitigation||{}),this.showMitigationModal=!0,this.viewOnlyMitigationModal=!0,this.mitigationDueDate=t.MitigationDueDate||"";let a=t.RiskFormDetails;if("string"===typeof a)try{a=JSON.parse(a)}catch(i){a={}}this.riskFormDetails=this.mapRiskFormDetails(a)})}).catch(e=>{console.error("Error fetching risk details:",e),this.$popup.error("Failed to fetch risk details")})},closeQuestionnaireModal(){this.showQuestionnaireModal=!1,this.selectedQuestionnaire=null},mapRiskFormDetails(e){if(!e)return{cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:""};function a(e){if(!e)return"";if("string"===typeof e){if("yes"===e.toLowerCase())return"Yes";if("no"===e.toLowerCase())return"No";if("unknown"===e.toLowerCase())return"Unknown"}return e}return{cost:e.cost??"",impact:e.impact??"",financialImpact:e.financialImpact??e.financialimpact??"",reputationalImpact:e.reputationalImpact??e.reputationalimpact??"",operationalImpact:e.operationalImpact??e.operationalimpact??"",financialLoss:e.financialLoss??e.financialloss??"",systemDowntime:e.systemDowntime??e.expecteddowntime??"",recoveryTime:e.recoveryTime??e.recoverytime??"",recurrencePossible:a(e.recurrencePossible??e.riskrecurrence),improvementInitiative:a(e.improvementInitiative??e.improvementinitiative)}},getUserId(e){if(!e)return"";if(void 0!==e.UserId)return parseInt(e.UserId,10);if(void 0!==e.user_id)return parseInt(e.user_id,10);if(void 0!==e.id)return parseInt(e.id,10);const a=e.id||e.UserId||e.user_id||"";return a?parseInt(a,10):""},getUserName(e){if(!e)return"Unknown User";if(e.UserName)return e.UserName+(e.email?` (${e.email})`:"");if(e.user_name){let a=e.user_name;return(e.department||e.designation)&&(a+=" (",e.department&&(a+=e.department),e.department&&e.designation&&(a+=", "),e.designation&&(a+=e.designation),a+=")"),a}return e.username?e.first_name&&e.last_name?`${e.first_name} ${e.last_name} (${e.username})`:e.username:e.UserName||e.user_name||e.username||e.email||"User "+this.getUserId(e)},navigateTo(e){const a=document.querySelectorAll(".risk-resolution-toggle-button");a.forEach(e=>e.classList.remove("active"));const t=Array.from(a).find(a=>a.textContent.trim().toLowerCase().includes(e));switch(t&&t.classList.add("active"),e){case"resolution":break;case"workflow":this.$router.push("/risk/workflow");break}}}};const URe=(0,se.A)(XRe,[["render",MRe],["__scopeId","data-v-7b0f447e"]]);var NRe=URe;const $Re={class:"risk-view-container"},ORe={class:"risk-view-header"},jRe={key:0,class:"risk-view-details-card"},BRe={class:"risk-view-details-top"},WRe={class:"risk-view-id-section"},QRe={class:"risk-view-id-value"},qRe={class:"risk-view-meta"},KRe={class:"risk-view-category"},JRe={class:"risk-view-title-section"},zRe={class:"risk-view-compliance-section"},HRe={class:"risk-view-compliance-value"},YRe={class:"risk-view-content"},GRe={class:"risk-view-content-row"},ZRe={class:"risk-view-content-column"},eDe={class:"risk-view-section-content"},aDe={class:"risk-view-content-column"},tDe={class:"risk-view-section-content"},iDe={class:"risk-view-content-row"},sDe={class:"risk-view-content-column"},oDe={class:"risk-view-section-content"},lDe={class:"risk-view-content-column"},nDe={class:"risk-view-section-content"},rDe={class:"risk-view-content-row"},cDe={class:"risk-view-content-column"},dDe={class:"risk-view-section-content"},uDe={class:"risk-view-content-column"},pDe={class:"risk-view-section-content"},vDe={class:"risk-view-content-row"},mDe={class:"risk-view-content-column"},kDe={class:"risk-view-section-content"},hDe={class:"risk-view-content-column"},gDe={class:"risk-view-section-content"},yDe={class:"risk-view-content-row"},fDe={class:"risk-view-content-column"},bDe={class:"risk-view-section-content"},CDe={key:1,class:"risk-view-no-data"};function LDe(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",$Re,[(0,s.bF)(n),(0,s.Lk)("div",ORe,[a[2]||(a[2]=(0,s.Lk)("h2",{class:"risk-view-title"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle risk-view-icon"}),(0,s.eW)(" Risk Details")],-1)),(0,s.Lk)("button",{class:"risk-view-back-button",onClick:a[0]||(a[0]=(...e)=>l.goBack&&l.goBack(...e))},a[1]||(a[1]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Risk Register ")]))]),o.risk?((0,s.uX)(),(0,s.CE)("div",jRe,[(0,s.Lk)("div",BRe,[(0,s.Lk)("div",WRe,[a[3]||(a[3]=(0,s.Lk)("span",{class:"risk-view-id-label"},"Risk ID:",-1)),(0,s.Lk)("span",QRe,(0,d.v_)(o.risk.RiskId),1)]),(0,s.Lk)("div",qRe,[(0,s.Lk)("div",KRe,(0,d.v_)(o.risk.Category),1),(0,s.Lk)("div",{class:(0,d.C4)(["risk-view-criticality",l.getCriticalityClass(o.risk.Criticality)])},(0,d.v_)(o.risk.Criticality),3)])]),(0,s.Lk)("div",JRe,[(0,s.Lk)("h3",null,(0,d.v_)(o.risk.RiskTitle),1),(0,s.Lk)("div",zRe,[a[4]||(a[4]=(0,s.Lk)("span",{class:"risk-view-compliance-label"},"Compliance ID:",-1)),(0,s.Lk)("span",HRe,(0,d.v_)(o.risk.ComplianceId||"N/A"),1)])]),(0,s.Lk)("div",YRe,[(0,s.Lk)("div",GRe,[(0,s.Lk)("div",ZRe,[a[5]||(a[5]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Description:",-1)),(0,s.Lk)("div",eDe,(0,d.v_)(o.risk.RiskDescription||"N/A"),1)]),(0,s.Lk)("div",aDe,[a[6]||(a[6]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Business Impact:",-1)),(0,s.Lk)("div",tDe,(0,d.v_)(o.risk.BusinessImpact||"N/A"),1)])]),(0,s.Lk)("div",iDe,[(0,s.Lk)("div",sDe,[a[7]||(a[7]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Possible Damage:",-1)),(0,s.Lk)("div",oDe,(0,d.v_)(o.risk.PossibleDamage||"N/A"),1)]),(0,s.Lk)("div",lDe,[a[8]||(a[8]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Likelihood:",-1)),(0,s.Lk)("div",nDe,(0,d.v_)(o.risk.RiskLikelihood||"N/A"),1)])]),(0,s.Lk)("div",rDe,[(0,s.Lk)("div",cDe,[a[9]||(a[9]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Impact:",-1)),(0,s.Lk)("div",dDe,(0,d.v_)(o.risk.RiskImpact||"N/A"),1)]),(0,s.Lk)("div",uDe,[a[10]||(a[10]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Exposure Rating:",-1)),(0,s.Lk)("div",pDe,(0,d.v_)(o.risk.RiskExposureRating||"N/A"),1)])]),(0,s.Lk)("div",vDe,[(0,s.Lk)("div",mDe,[a[11]||(a[11]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Priority:",-1)),(0,s.Lk)("div",kDe,(0,d.v_)(o.risk.RiskPriority||"N/A"),1)]),(0,s.Lk)("div",hDe,[a[12]||(a[12]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Mitigation:",-1)),(0,s.Lk)("div",gDe,(0,d.v_)(o.risk.RiskMitigation||"N/A"),1)])]),(0,s.Lk)("div",yDe,[(0,s.Lk)("div",fDe,[a[13]||(a[13]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Created At:",-1)),(0,s.Lk)("div",bDe,(0,d.v_)(l.formatDate(o.risk.CreatedAt)),1)]),a[14]||(a[14]=(0,s.Lk)("div",{class:"risk-view-content-column"},null,-1))])])])):((0,s.uX)(),(0,s.CE)("div",CDe," Loading risk details or no risk found... "))])}var wDe={name:"ViewRisk",components:{PopupModal:pv.wA},data(){return{risk:null}},created(){this.fetchRiskDetails()},methods:{fetchRiskDetails(){const e=this.$route.params.id;e?qe.A.get(`http://localhost:8000/api/risks/${e}/`).then(e=>{this.risk=e.data}).catch(e=>{console.error("Error fetching risk details:",e)}):this.$router.push("/risk/riskregister-list")},getCriticalityClass(e){return e?(e=e.toLowerCase(),"critical"===e?"risk-view-priority-critical":"high"===e?"risk-view-priority-high":"medium"===e?"risk-view-priority-medium":"low"===e?"risk-view-priority-low":""):""},formatDate(e){if(!e)return"N/A";const a=new Date(e);return a.toLocaleDateString()},goBack(){this.$router.push("/risk/riskregister-list")}}};const EDe=(0,se.A)(wDe,[["render",LDe]]);var RDe=EDe;const DDe={class:"instance-view-container"},IDe={class:"instance-view-header"},PDe={key:0,class:"instance-view-details-card"},_De={class:"instance-view-details-header"},SDe={class:"instance-view-id-section"},ADe={class:"instance-view-id-value"},TDe={class:"instance-view-id-value"},xDe={class:"instance-view-meta"},FDe={class:"instance-view-meta-item"},VDe={class:"instance-view-category-badge"},MDe={class:"instance-view-meta-item"},XDe={class:"instance-view-meta-item"},UDe={class:"instance-view-content"},NDe={class:"instance-view-content-row"},$De={class:"instance-view-content-column"},ODe={class:"instance-view-section-content"},jDe={class:"instance-view-content-column"},BDe={class:"instance-view-section-content"},WDe={class:"instance-view-content-row"},QDe={class:"instance-view-content-column"},qDe={class:"instance-view-section-content"},KDe={class:"instance-view-content-column"},JDe={class:"instance-view-section-content"},zDe={class:"instance-view-content-row"},HDe={class:"instance-view-content-column"},YDe={class:"instance-view-section-content"},GDe={class:"instance-view-content-column"},ZDe={class:"instance-view-section-content"},eIe={class:"instance-view-content-row"},aIe={class:"instance-view-content-column"},tIe={class:"instance-view-section-content"},iIe={class:"instance-view-content-column"},sIe={class:"instance-view-section-content"},oIe={class:"instance-view-content-row"},lIe={class:"instance-view-content-column"},nIe={class:"instance-view-section-content"},rIe={class:"instance-view-content-column"},cIe={class:"instance-view-section-content"},dIe={class:"instance-view-content-row"},uIe={class:"instance-view-content-column"},pIe={class:"instance-view-section-content"},vIe={class:"instance-view-content-column"},mIe={class:"instance-view-section-content"},kIe={class:"instance-view-content-row"},hIe={class:"instance-view-content-column"},gIe={class:"instance-view-section-content"},yIe={class:"instance-view-content-column"},fIe={class:"instance-view-section-content"},bIe={key:1,class:"instance-view-no-data"};function CIe(e,a,t,i,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",DDe,[(0,s.bF)(n),(0,s.Lk)("div",IDe,[a[2]||(a[2]=(0,s.Lk)("h2",{class:"instance-view-title"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle instance-view-icon"}),(0,s.eW)(" Risk Instance Details")],-1)),(0,s.Lk)("button",{class:"instance-view-back-button",onClick:a[0]||(a[0]=(...e)=>l.goBack&&l.goBack(...e))},a[1]||(a[1]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Risk Instances ")]))]),o.instance?((0,s.uX)(),(0,s.CE)("div",PDe,[(0,s.Lk)("div",_De,[(0,s.Lk)("div",SDe,[a[3]||(a[3]=(0,s.Lk)("span",{class:"instance-view-id-label"},"Risk ID:",-1)),(0,s.Lk)("span",ADe,(0,d.v_)(o.instance.RiskId),1),a[4]||(a[4]=(0,s.Lk)("span",{class:"instance-view-id-label"},"Instance ID:",-1)),(0,s.Lk)("span",TDe,(0,d.v_)(o.instance.RiskInstanceId),1)]),(0,s.Lk)("div",xDe,[a[5]||(a[5]=(0,s.Lk)("div",{class:"instance-view-meta-item"},[(0,s.Lk)("span",{class:"instance-view-origin-badge"},"MANUAL")],-1)),(0,s.Lk)("div",FDe,[(0,s.Lk)("span",VDe,(0,d.v_)(o.instance.Category),1)]),(0,s.Lk)("div",MDe,[(0,s.Lk)("span",{class:(0,d.C4)("instance-view-priority-"+o.instance.Criticality.toLowerCase())},(0,d.v_)(o.instance.Criticality),3)]),(0,s.Lk)("div",XDe,[(0,s.Lk)("span",{class:(0,d.C4)("instance-view-status-"+(o.instance.RiskStatus?o.instance.RiskStatus.toLowerCase().replace(/\s+/g,"-"):"open"))},(0,d.v_)(o.instance.RiskStatus||"Open"),3)])])]),(0,s.Lk)("div",UDe,[(0,s.Lk)("div",NDe,[(0,s.Lk)("div",$De,[a[6]||(a[6]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Description:",-1)),(0,s.Lk)("div",ODe,(0,d.v_)(o.instance.RiskDescription||"Not specified"),1)]),(0,s.Lk)("div",jDe,[a[7]||(a[7]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Category:",-1)),(0,s.Lk)("div",BDe,(0,d.v_)(o.instance.Category||"Not specified"),1)])]),(0,s.Lk)("div",WDe,[(0,s.Lk)("div",QDe,[a[8]||(a[8]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Criticality:",-1)),(0,s.Lk)("div",qDe,(0,d.v_)(o.instance.Criticality||"Not specified"),1)]),(0,s.Lk)("div",KDe,[a[9]||(a[9]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Status:",-1)),(0,s.Lk)("div",JDe,(0,d.v_)(o.instance.RiskStatus||"Open"),1)])]),(0,s.Lk)("div",zDe,[(0,s.Lk)("div",HDe,[a[10]||(a[10]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Possible Damage:",-1)),(0,s.Lk)("div",YDe,(0,d.v_)(o.instance.PossibleDamage||"Not specified"),1)]),(0,s.Lk)("div",GDe,[a[11]||(a[11]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Risk Appetite:",-1)),(0,s.Lk)("div",ZDe,(0,d.v_)(o.instance.Appetite||"Not specified"),1)])]),(0,s.Lk)("div",eIe,[(0,s.Lk)("div",aIe,[a[12]||(a[12]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Likelihood:",-1)),(0,s.Lk)("div",tIe,(0,d.v_)(o.instance.RiskLikelihood||"Not specified"),1)]),(0,s.Lk)("div",iIe,[a[13]||(a[13]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Impact:",-1)),(0,s.Lk)("div",sIe,(0,d.v_)(o.instance.RiskImpact||"Not specified"),1)])]),(0,s.Lk)("div",oIe,[(0,s.Lk)("div",lIe,[a[14]||(a[14]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Exposure Rating:",-1)),(0,s.Lk)("div",nIe,(0,d.v_)(o.instance.RiskExposureRating||"Not specified"),1)]),(0,s.Lk)("div",rIe,[a[15]||(a[15]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Priority:",-1)),(0,s.Lk)("div",cIe,(0,d.v_)(o.instance.RiskPriority||"Not specified"),1)])]),(0,s.Lk)("div",dIe,[(0,s.Lk)("div",uIe,[a[16]||(a[16]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Response Type:",-1)),(0,s.Lk)("div",pIe,(0,d.v_)(o.instance.RiskResponseType||"Not specified"),1)]),(0,s.Lk)("div",vIe,[a[17]||(a[17]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Response Description:",-1)),(0,s.Lk)("div",mIe,(0,d.v_)(o.instance.RiskResponseDescription||"Not specified"),1)])]),(0,s.Lk)("div",kIe,[(0,s.Lk)("div",hIe,[a[18]||(a[18]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Mitigation:",-1)),(0,s.Lk)("div",gIe,(0,d.v_)(o.instance.RiskMitigation||"Not specified"),1)]),(0,s.Lk)("div",yIe,[a[19]||(a[19]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Risk Owner:",-1)),(0,s.Lk)("div",fIe,(0,d.v_)(o.instance.RiskOwner||"Not assigned"),1)])])])])):((0,s.uX)(),(0,s.CE)("div",bIe," Loading instance details or no instance found... "))])}var LIe={name:"ViewInstance",components:{PopupModal:pv.wA},data(){return{instance:null}},created(){this.fetchInstanceDetails()},methods:{fetchInstanceDetails(){const e=this.$route.params.id;e?qe.A.get(`http://localhost:8000/api/risk-instances/${e}/`).then(e=>{this.instance=e.data}).catch(a=>{console.error("Error fetching risk instance details:",a),this.tryAlternativeEndpoint(e)}):this.$router.push("/risk/riskinstances-list")},tryAlternativeEndpoint(e){qe.A.get(`http://localhost:8000/risk-instances/${e}/`).then(e=>{this.instance=e.data}).catch(e=>{console.error("Error with alternative endpoint:",e)})},goBack(){this.$router.push("/risk/riskinstances-list")}}};const wIe=(0,se.A)(LIe,[["render",CIe]]);var EIe=wIe;const RIe={class:"login-page"},DIe={class:"login-panel"},IIe={class:"login-container"},PIe={class:"form-group"},_Ie={class:"form-group"},SIe={class:"input-wrapper"},AIe=["type"],TIe={key:0,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye"},xIe={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye-off"},FIe={key:0,class:"error-message"};var VIe={__name:"LoginView",setup(e){const a=(0,ee.KR)(""),t=(0,ee.KR)(""),o=(0,ee.KR)(""),l=(0,ae.rd)(),n=(0,ee.KR)("password"),r=async()=>{try{if(o.value="",!a.value||!t.value)return void(o.value="Username and password are required");const e=await qe.A.post("/api/login/",{username:a.value,password:t.value});e.data.success?(localStorage.setItem("isAuthenticated","true"),localStorage.setItem("user",JSON.stringify(e.data.user)),localStorage.setItem("user_id",e.data.user.id||"1"),localStorage.setItem("user_email",e.data.user.email),localStorage.setItem("user_name",e.data.user.username),localStorage.setItem("is_logged_in","true"),console.log("ðŸ” Login successful! Session created:",{user_id:e.data.user.id,email:e.data.user.email,username:e.data.user.username}),window.dispatchEvent(new Event("authChanged")),l.push("/home")):o.value=e.data.message||"Login failed"}catch(e){e.response&&e.response.data?o.value=e.response.data.message||"Invalid credentials":o.value="Connection error. Please check if the server is running.",console.error("âŒ Login error:",e)}},c=()=>{n.value="password"===n.value?"text":"password"};return(e,l)=>((0,s.uX)(),(0,s.CE)("div",RIe,[(0,s.Lk)("div",DIe,[(0,s.Lk)("div",IIe,[l[8]||(l[8]=(0,s.Lk)("h2",{class:"title"},"Login",-1)),l[9]||(l[9]=(0,s.Lk)("p",{class:"subtitle"},"Enter your account details",-1)),(0,s.Lk)("form",{onSubmit:(0,i.D$)(r,["prevent"])},[(0,s.Lk)("div",PIe,[l[2]||(l[2]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":l[0]||(l[0]=e=>a.value=e),required:""},null,512),[[i.Jo,a.value]])]),(0,s.Lk)("div",_Ie,[l[5]||(l[5]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.Lk)("div",SIe,[(0,s.bo)((0,s.Lk)("input",{type:n.value,id:"password","onUpdate:modelValue":l[1]||(l[1]=e=>t.value=e),required:""},null,8,AIe),[[i.hp,t.value]]),(0,s.Lk)("span",{onClick:c,class:"password-toggle"},["password"===n.value?((0,s.uX)(),(0,s.CE)("svg",TIe,l[3]||(l[3]=[(0,s.Lk)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),(0,s.Lk)("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):((0,s.uX)(),(0,s.CE)("svg",xIe,l[4]||(l[4]=[(0,s.Lk)("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},null,-1),(0,s.Lk)("line",{x1:"1",y1:"1",x2:"23",y2:"23"},null,-1)])))])])]),l[6]||(l[6]=(0,s.Lk)("a",{href:"#",class:"forgot-password"},"Forgot Password?",-1)),l[7]||(l[7]=(0,s.Lk)("button",{type:"submit"},"Login",-1))],32),l[10]||(l[10]=(0,s.Lk)("div",{class:"signup-prompt"},[(0,s.Lk)("p",null,"Don't have an account?"),(0,s.Lk)("button",{class:"signup-button"},"Sign up")],-1)),o.value?((0,s.uX)(),(0,s.CE)("p",FIe,(0,d.v_)(o.value),1)):(0,s.Q3)("",!0)])]),l[11]||(l[11]=(0,s.Fv)('<div class="welcome-panel" data-v-c1aecfec><div class="welcome-content" data-v-c1aecfec><h2 data-v-c1aecfec>Welcome to the GRC Platform for XYZ Bank</h2><p data-v-c1aecfec>Streamlining Governance, Risk, and Compliance for XYZ Bank.</p><div class="features" data-v-c1aecfec><div class="feature-item" data-v-c1aecfec><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-c1aecfec><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" data-v-c1aecfec></path><path d="m9 12 2 2 4-4" data-v-c1aecfec></path></svg><span data-v-c1aecfec>Secure &amp; Compliant</span></div><div class="feature-item" data-v-c1aecfec><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-c1aecfec><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-c1aecfec></path><polyline points="14 2 14 8 20 8" data-v-c1aecfec></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-c1aecfec></line><line x1="16" y1="17" x2="8" y2="17" data-v-c1aecfec></line></svg><span data-v-c1aecfec>Insightful Reporting</span></div><div class="feature-item" data-v-c1aecfec><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-c1aecfec><line x1="12" y1="20" x2="12" y2="10" data-v-c1aecfec></line><line x1="18" y1="20" x2="18" y2="4" data-v-c1aecfec></line><line x1="6" y1="20" x2="6" y2="16" data-v-c1aecfec></line></svg><span data-v-c1aecfec>Risk Analytics</span></div><div class="feature-item" data-v-c1aecfec><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-c1aecfec><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" data-v-c1aecfec></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1" data-v-c1aecfec></rect><line x1="9" y1="15" x2="15" y2="15" data-v-c1aecfec></line><line x1="9" y1="11" x2="15" y2="11" data-v-c1aecfec></line></svg><span data-v-c1aecfec>Audit Management</span></div></div></div></div>',1))]))}};const MIe=(0,se.A)(VIe,[["__scopeId","data-v-c1aecfec"]]);var XIe=MIe;const UIe={class:"home-container"},NIe={class:"main-header"},$Ie={class:"main-nav"},OIe={class:"main-content"},jIe={class:"hero-section"},BIe={class:"hero-text"},WIe={class:"card chart-card"},QIe={class:"card chart-card"};var qIe={__name:"HomeView",setup(e){ze.t1.register(ze.hE,ze.m_,ze.s$,ze.E8,ze.PP,ze.kc,ze.FN,ze.No);const a=(0,ae.rd)(),t=(0,ee.KR)(null),i=(0,ee.KR)({totalPolicies:0,totalIncidents:0,totalRisks:0,totalCompliances:0}),o=(0,ee.KR)({labels:["January","February","March","April","May","June","July"],datasets:[{label:"Incidents",backgroundColor:"#6a5acd",borderColor:"#6a5acd",data:[40,39,10,40,39,80,40],tension:.4}]}),l=(0,ee.KR)({labels:["IT","Finance","HR","Operations","Marketing"],datasets:[{label:"Compliance Status",backgroundColor:["#6a5acd","#7b6bd2","#8c7cd7","#9d8ddc","#aea0e1"],data:[95,80,60,90,75]}]}),n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}},r=async()=>{try{const[e,a]=await Promise.all([qe.A.get("/api/incidents/counts/"),qe.A.get("/api/policy-dashboard/")]);e.data&&(i.value.totalIncidents=e.data.total||0),a.data&&(i.value.totalPolicies=a.data.totalPolicies||0)}catch(e){console.error("Error fetching dashboard data:",e)}},c=async()=>{try{await qe.A.post("/api/logout/"),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("user"),window.dispatchEvent(new Event("authChanged")),a.push("/login")}catch(e){console.error("Logout error:",e),localStorage.removeItem("isAuthenticated"),localStorage.removeItem("user"),window.dispatchEvent(new Event("authChanged")),a.push("/login")}};return(0,s.sV)(()=>{const e=localStorage.getItem("user");e&&(t.value=JSON.parse(e)),r()}),(e,a)=>{const t=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",UIe,[(0,s.Lk)("header",NIe,[a[6]||(a[6]=(0,s.Lk)("div",{class:"logo"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,s.Lk)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})]),(0,s.Lk)("span",null,"GRC Platform")],-1)),(0,s.Lk)("nav",$Ie,[(0,s.bF)(t,{to:"/home",class:"active"},{default:(0,s.k6)(()=>a[0]||(a[0]=[(0,s.eW)("Dashboard")])),_:1,__:[0]}),(0,s.bF)(t,{to:"/policy/dashboard"},{default:(0,s.k6)(()=>a[1]||(a[1]=[(0,s.eW)("Policies")])),_:1,__:[1]}),(0,s.bF)(t,{to:"/compliance/user-dashboard"},{default:(0,s.k6)(()=>a[2]||(a[2]=[(0,s.eW)("Compliance")])),_:1,__:[2]}),(0,s.bF)(t,{to:"/risk/riskdashboard"},{default:(0,s.k6)(()=>a[3]||(a[3]=[(0,s.eW)("Risk")])),_:1,__:[3]}),(0,s.bF)(t,{to:"/auditor/performance/userdashboard"},{default:(0,s.k6)(()=>a[4]||(a[4]=[(0,s.eW)("Audits")])),_:1,__:[4]}),(0,s.bF)(t,{to:"/incident/dashboard"},{default:(0,s.k6)(()=>a[5]||(a[5]=[(0,s.eW)("Incidents")])),_:1,__:[5]})]),(0,s.Lk)("button",{onClick:c,class:"logout-btn"},"Logout")]),(0,s.Lk)("main",OIe,[(0,s.Lk)("section",jIe,[(0,s.Lk)("div",BIe,[a[7]||(a[7]=(0,s.Lk)("h1",null,"Unified GRC at Your Fingertips",-1)),a[8]||(a[8]=(0,s.Lk)("p",null," Experience the future of Governance, Risk, and Compliance with a unified platform designed for agility, accuracy, and efficiency. Our GRC solution empowers XYZ Bank to seamlessly manage audits, assess risks, enforce compliance, and monitor policies â€” all from a single intuitive interface. ",-1)),a[9]||(a[9]=(0,s.Lk)("p",null," Secure. Scalable. Smart. Your unified GRC system is now just a login away. ",-1)),(0,s.Lk)("div",WIe,[(0,s.bF)((0,ee.R1)(He.yP),{data:l.value,options:n},null,8,["data"])])]),a[10]||(a[10]=(0,s.Lk)("div",{class:"card metrics-card"},[(0,s.Lk)("div",{class:"logo-title"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,s.Lk)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})]),(0,s.Lk)("span",null,"GRC Platform")]),(0,s.Lk)("h2",null,"42% decrease in compliance breaches"),(0,s.Lk)("p",null,"Public does not participate in payment for order flow as a source of revenue.")],-1)),(0,s.Lk)("div",QIe,[(0,s.bF)((0,ee.R1)(He.N1),{data:o.value,options:n},null,8,["data"])])]),a[11]||(a[11]=(0,s.Fv)('<footer class="stats-footer" data-v-b1f7916e><div class="stat-item" data-v-b1f7916e><div class="stat-header" data-v-b1f7916e><span class="stat-value" data-v-b1f7916e>39,000+</span><div class="stat-icon-wrapper" data-v-b1f7916e><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stat-icon" data-v-b1f7916e><line x1="6" y1="3" x2="6" y2="15" data-v-b1f7916e></line><circle cx="18" cy="6" r="3" data-v-b1f7916e></circle><circle cx="6" cy="18" r="3" data-v-b1f7916e></circle><path d="M18 9a9 9 0 0 1-9 9" data-v-b1f7916e></path></svg></div></div><p data-v-b1f7916e>â€¢ Policies ready to be connected</p></div><div class="stat-item" data-v-b1f7916e><div class="stat-header" data-v-b1f7916e><span class="stat-value" data-v-b1f7916e>180M+</span><div class="stat-icon-wrapper" data-v-b1f7916e><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stat-icon" data-v-b1f7916e><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" data-v-b1f7916e></path><circle cx="12" cy="7" r="4" data-v-b1f7916e></circle></svg></div></div><p data-v-b1f7916e>â€¢ Happy global client</p></div><div class="stat-item" data-v-b1f7916e><div class="stat-header" data-v-b1f7916e><span class="stat-value" data-v-b1f7916e>5.00</span><div class="stat-icon-wrapper" data-v-b1f7916e><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stat-icon" data-v-b1f7916e><path d="M12 2 L14.5 9.5 L22 12 L14.5 14.5 L12 22 L9.5 14.5 L2 12 L9.5 9.5 Z" data-v-b1f7916e></path></svg></div></div><p data-v-b1f7916e>â€¢ 10k+ rating</p></div></footer>',1))])])}}};const KIe=(0,se.A)(qIe,[["__scopeId","data-v-b1f7916e"]]);var JIe=KIe;const zIe={class:"user-profile-container"},HIe={class:"tabs"},YIe=["onClick"],GIe={class:"tab-label"},ZIe={class:"tab-content"},ePe={key:0},aPe={key:0,class:"message error-message"},tPe={key:1,class:"message success-message"},iPe={class:"form-row"},sPe=["disabled"],oPe=["disabled"],lPe={class:"form-row"},nPe=["disabled"],rPe=["disabled"],cPe={class:"form-row"},dPe=["disabled"],uPe=["disabled"],pPe={class:"form-row center"},vPe=["disabled"],mPe={key:0,class:"fas fa-spinner fa-spin"},kPe={key:1,class:"fas fa-save"},hPe={key:1},gPe={class:"profile-form"},yPe={class:"form-row"},fPe={key:2},bPe={key:0,class:"message error-message"},CPe={key:1,class:"message success-message"},LPe={class:"form-row password-row"},wPe=["disabled"],EPe=["disabled"],RPe={class:"form-row password-row"},DPe=["disabled"],IPe={class:"form-row password-row"},PPe=["disabled"],_Pe={class:"form-row password-row"},SPe=["disabled"],APe={class:"form-row password-submit-row"},TPe=["disabled"],xPe={key:0,class:"fas fa-spinner fa-spin"},FPe={key:1,class:"fas fa-paper-plane"},VPe={key:3},MPe={class:"notification-settings"},XPe={class:"notif-dropdown-section"},UPe={class:"notif-dropdown-arrow"},NPe={key:0,class:"notif-dropdown-content"},$Pe={class:"notif-form-row"},OPe={class:"notif-dropdown-section"},jPe={class:"notif-dropdown-arrow"},BPe={key:0,class:"notif-dropdown-content"},WPe={class:"notif-form-row"};function QPe(e,a,t,o,l,n){return(0,s.uX)(),(0,s.CE)("div",zIe,[(0,s.Lk)("div",HIe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.tabs,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.key,class:(0,d.C4)(["tab-btn",{active:l.activeTab===e.key}]),onClick:a=>l.activeTab=e.key},[(0,s.Lk)("i",{class:(0,d.C4)([e.icon,"tab-icon"])},null,2),(0,s.Lk)("span",GIe,(0,d.v_)(e.label),1)],10,YIe))),128))]),(0,s.Lk)("div",ZIe,["account"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",ePe,[(0,s.Lk)("form",{class:"profile-form",onSubmit:a[6]||(a[6]=(0,i.D$)((...e)=>n.saveAccountChanges&&n.saveAccountChanges(...e),["prevent"]))},[a[32]||(a[32]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-user"}),(0,s.eW)(" Account Information")],-1)),a[33]||(a[33]=(0,s.Lk)("p",{class:"section-helper"},"Update your personal and organizational details. Please ensure your information is accurate for account security and communication.",-1)),l.error?((0,s.uX)(),(0,s.CE)("div",aPe,[a[24]||(a[24]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.error),1)])):(0,s.Q3)("",!0),l.success?((0,s.uX)(),(0,s.CE)("div",tPe,[a[25]||(a[25]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.success),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",iPe,[a[26]||(a[26]=(0,s.Lk)("label",null,"User Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>l.form.username=e),disabled:l.loading},null,8,sPe),[[i.Jo,l.form.username]]),a[27]||(a[27]=(0,s.Lk)("label",null,"Role:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[1]||(a[1]=e=>l.form.role=e),disabled:l.loading},null,8,oPe),[[i.Jo,l.form.role]])]),(0,s.Lk)("div",lPe,[a[28]||(a[28]=(0,s.Lk)("label",null,"Phone Number:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=e=>l.form.phone=e),disabled:l.loading},null,8,nPe),[[i.Jo,l.form.phone]]),a[29]||(a[29]=(0,s.Lk)("label",null,"Email :",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":a[3]||(a[3]=e=>l.form.email=e),disabled:l.loading},null,8,rPe),[[i.Jo,l.form.email]])]),(0,s.Lk)("div",cPe,[a[30]||(a[30]=(0,s.Lk)("label",null,"Organization:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=e=>l.form.organization=e),disabled:l.loading},null,8,dPe),[[i.Jo,l.form.organization]]),a[31]||(a[31]=(0,s.Lk)("label",null,"Country :",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>l.form.country=e),disabled:l.loading},null,8,uPe),[[i.Jo,l.form.country]])]),(0,s.Lk)("div",pPe,[(0,s.Lk)("button",{class:"submit-btn",type:"submit",disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("i",mPe)):((0,s.uX)(),(0,s.CE)("i",kPe)),(0,s.eW)(" "+(0,d.v_)(l.loading?"Saving...":"Save Changes"),1)],8,vPe)])],32)])):"role"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",hPe,[(0,s.Lk)("form",gPe,[a[36]||(a[36]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-exchange-alt"}),(0,s.eW)(" Role Management")],-1)),a[37]||(a[37]=(0,s.Lk)("p",{class:"section-helper"},"View or request changes to your user role. Role changes may require approval from an administrator.",-1)),(0,s.Lk)("div",yPe,[a[34]||(a[34]=(0,s.Lk)("label",null,"User Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=e=>l.form.username=e)},null,512),[[i.Jo,l.form.username]]),a[35]||(a[35]=(0,s.Lk)("label",null,"Role:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=e=>l.form.role=e)},null,512),[[i.Jo,l.form.role]])]),a[38]||(a[38]=(0,s.Lk)("div",{class:"form-row center"},[(0,s.Lk)("button",{class:"submit-btn",type:"button"},[(0,s.Lk)("i",{class:"fas fa-check"}),(0,s.eW)(" Request Role Change ")])],-1))])])):"password"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",fPe,[(0,s.Lk)("form",{class:"profile-form password-form",onSubmit:a[13]||(a[13]=(0,i.D$)((...e)=>n.updatePassword&&n.updatePassword(...e),["prevent"]))},[a[46]||(a[46]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-key"}),(0,s.eW)(" Change Your Password")],-1)),a[47]||(a[47]=(0,s.Lk)("p",{class:"section-helper"},"For your security, please enter your email and a new password. You will need to verify with an OTP sent to your registered email or phone.",-1)),l.error?((0,s.uX)(),(0,s.CE)("div",bPe,[a[39]||(a[39]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.error),1)])):(0,s.Q3)("",!0),l.success?((0,s.uX)(),(0,s.CE)("div",CPe,[a[40]||(a[40]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.success),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",LPe,[a[42]||(a[42]=(0,s.Lk)("label",null,"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":a[9]||(a[9]=e=>l.form.email=e),placeholder:"Enter your email address",disabled:l.loading},null,8,wPe),[[i.Jo,l.form.email]]),(0,s.Lk)("button",{class:"verify-btn",type:"button",disabled:l.loading},a[41]||(a[41]=[(0,s.Lk)("i",{class:"fas fa-shield-alt"},null,-1),(0,s.eW)(" Verify ")]),8,EPe)]),(0,s.Lk)("div",RPe,[a[43]||(a[43]=(0,s.Lk)("label",null,"Enter OTP",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[10]||(a[10]=e=>l.form.otp=e),placeholder:"Enter OTP",disabled:l.loading},null,8,DPe),[[i.Jo,l.form.otp]])]),(0,s.Lk)("div",IPe,[a[44]||(a[44]=(0,s.Lk)("label",null,"New Password",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password","onUpdate:modelValue":a[11]||(a[11]=e=>l.form.newPassword=e),placeholder:"Enter new password",disabled:l.loading},null,8,PPe),[[i.Jo,l.form.newPassword]])]),(0,s.Lk)("div",_Pe,[a[45]||(a[45]=(0,s.Lk)("label",null,"Confirm Password",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password","onUpdate:modelValue":a[12]||(a[12]=e=>l.form.confirmPassword=e),placeholder:"Re-enter new password",disabled:l.loading},null,8,SPe),[[i.Jo,l.form.confirmPassword]])]),(0,s.Lk)("div",APe,[(0,s.Lk)("button",{class:"submit-btn",type:"submit",style:{width:"100%","max-width":"320px"},disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("i",xPe)):((0,s.uX)(),(0,s.CE)("i",FPe)),(0,s.eW)(" "+(0,d.v_)(l.loading?"Updating...":"Update Password"),1)],8,TPe)])],32)])):"notification"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",VPe,[(0,s.Lk)("div",MPe,[a[56]||(a[56]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-bell"}),(0,s.eW)(" Notification Preferences")],-1)),a[57]||(a[57]=(0,s.Lk)("p",{class:"section-helper"},"Manage how you receive notifications and update your contact details for alerts.",-1)),(0,s.Lk)("div",XPe,[(0,s.Lk)("div",{class:"notification-row notif-dropdown-toggle",onClick:a[16]||(a[16]=e=>l.notifDropdownOpen="email"===l.notifDropdownOpen?null:"email")},[a[49]||(a[49]=(0,s.Lk)("span",{style:{display:"flex","align-items":"center",gap:"10px"}},[(0,s.Lk)("i",{class:"fas fa-envelope"}),(0,s.eW)(" Email Notification updates ")],-1)),(0,s.Lk)("label",{class:"switch",onClick:a[15]||(a[15]=(0,i.D$)(()=>{},["stop"]))},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[14]||(a[14]=e=>l.form.emailNotif=e)},null,512),[[i.lH,l.form.emailNotif]]),a[48]||(a[48]=(0,s.Lk)("span",{class:"slider"},null,-1))]),(0,s.Lk)("span",UPe,[(0,s.Lk)("i",{class:(0,d.C4)("email"===l.notifDropdownOpen?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)])]),(0,s.bF)(i.eB,{name:"fade"},{default:(0,s.k6)(()=>["email"===l.notifDropdownOpen?((0,s.uX)(),(0,s.CE)("div",NPe,[(0,s.Lk)("form",{class:"notif-change-form",onSubmit:a[18]||(a[18]=(0,i.D$)(()=>{},["prevent"]))},[(0,s.Lk)("div",$Pe,[a[50]||(a[50]=(0,s.Lk)("label",null,"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":a[17]||(a[17]=e=>l.form.notifEmail=e),placeholder:"Enter new notification email"},null,512),[[i.Jo,l.form.notifEmail]])]),a[51]||(a[51]=(0,s.Lk)("div",{class:"notif-form-row center"},[(0,s.Lk)("button",{class:"submit-btn",type:"submit",style:{width:"100%","max-width":"320px"}},[(0,s.Lk)("i",{class:"fas fa-save"}),(0,s.eW)(" Save ")])],-1))],32)])):(0,s.Q3)("",!0)]),_:1})]),(0,s.Lk)("div",OPe,[(0,s.Lk)("div",{class:"notification-row notif-dropdown-toggle",onClick:a[21]||(a[21]=e=>l.notifDropdownOpen="whatsapp"===l.notifDropdownOpen?null:"whatsapp")},[a[53]||(a[53]=(0,s.Lk)("span",{style:{display:"flex","align-items":"center",gap:"10px"}},[(0,s.Lk)("i",{class:"fab fa-whatsapp"}),(0,s.eW)(" WhatsApp Notification updates ")],-1)),(0,s.Lk)("label",{class:"switch",onClick:a[20]||(a[20]=(0,i.D$)(()=>{},["stop"]))},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":a[19]||(a[19]=e=>l.form.whatsappNotif=e)},null,512),[[i.lH,l.form.whatsappNotif]]),a[52]||(a[52]=(0,s.Lk)("span",{class:"slider"},null,-1))]),(0,s.Lk)("span",jPe,[(0,s.Lk)("i",{class:(0,d.C4)("whatsapp"===l.notifDropdownOpen?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)])]),(0,s.bF)(i.eB,{name:"fade"},{default:(0,s.k6)(()=>["whatsapp"===l.notifDropdownOpen?((0,s.uX)(),(0,s.CE)("div",BPe,[(0,s.Lk)("form",{class:"notif-change-form",onSubmit:a[23]||(a[23]=(0,i.D$)(()=>{},["prevent"]))},[(0,s.Lk)("div",WPe,[a[54]||(a[54]=(0,s.Lk)("label",null,"Mobile Number",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":a[22]||(a[22]=e=>l.form.notifMobile=e),placeholder:"Enter new WhatsApp number"},null,512),[[i.Jo,l.form.notifMobile]])]),a[55]||(a[55]=(0,s.Lk)("div",{class:"notif-form-row center"},[(0,s.Lk)("button",{class:"submit-btn",type:"submit",style:{width:"100%","max-width":"320px"}},[(0,s.Lk)("i",{class:"fas fa-save"}),(0,s.eW)(" Save ")])],-1))],32)])):(0,s.Q3)("",!0)]),_:1})])])])):(0,s.Q3)("",!0)])])}var qPe={name:"UserProfile",data(){return{activeTab:"account",tabs:[{key:"account",label:"Account",icon:"fas fa-user"},{key:"role",label:"Role",icon:"fas fa-exchange-alt"},{key:"password",label:"Password",icon:"fas fa-key"},{key:"notification",label:"Notification",icon:"fas fa-bell"}],form:{username:"",role:"",organization:"",country:"",phone:"",email:"",newPassword:"",confirmPassword:"",otp:"",emailNotif:!1,whatsappNotif:!1,notifEmail:"",notifMobile:""},notifDropdownOpen:null,loading:!1,error:null,success:null}},mounted(){this.loadUserData()},methods:{async loadUserData(){this.loading=!0,this.error=null;try{const e=localStorage.getItem("user"),a=localStorage.getItem("username"),t=localStorage.getItem("fullName");if(e){const i=JSON.parse(e);this.form.username=t||a||i.username||"",this.form.email=i.email||"",this.form.role=i.role||"User",this.form.organization=i.organization||"",this.form.country=i.country||"",this.form.phone=i.phone||""}else{const e=await fetch("http://localhost:8000/api/current-user/");if(e.ok){const a=await e.json();this.form.username=a.full_name||a.username||"",this.form.email=a.email||"",this.form.role=a.role||"User",this.form.organization=a.organization||"",this.form.country=a.country||"",this.form.phone=a.phone||""}}}catch(e){console.error("Error loading user data:",e),this.error="Failed to load user data. Please try again."}finally{this.loading=!1}},async saveAccountChanges(){this.loading=!0,this.error=null,this.success=null;try{const e=JSON.parse(localStorage.getItem("user")||"{}");e.username=this.form.username,e.email=this.form.email,e.organization=this.form.organization,e.country=this.form.country,e.phone=this.form.phone,localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("username",this.form.username),this.success="Account information updated successfully!",window.dispatchEvent(new Event("userDataUpdated"))}catch(e){console.error("Error saving account changes:",e),this.error="Failed to save changes. Please try again."}finally{this.loading=!1}},async updatePassword(){this.loading=!0,this.error=null,this.success=null;try{if(this.form.newPassword!==this.form.confirmPassword)return void(this.error="Passwords do not match.");if(this.form.newPassword.length<6)return void(this.error="Password must be at least 6 characters long.");this.success="Password updated successfully!",this.form.newPassword="",this.form.confirmPassword="",this.form.otp=""}catch(e){console.error("Error updating password:",e),this.error="Failed to update password. Please try again."}finally{this.loading=!1}},async saveNotificationSettings(){this.loading=!0,this.error=null,this.success=null;try{this.success="Notification settings updated successfully!"}catch(e){console.error("Error saving notification settings:",e),this.error="Failed to save notification settings. Please try again."}finally{this.loading=!1}}}};const KPe=(0,se.A)(qPe,[["render",QPe],["__scopeId","data-v-4fba1b67"]]);var JPe=KPe;const zPe=[{path:"/login",name:"Login",component:XIe},{path:"/home",name:"Home",component:JIe,meta:{requiresAuth:!0}},{path:"/",redirect:()=>{const e="true"===localStorage.getItem("isAuthenticated");return e?"/home":"/login"}},{path:"/policy/dashboard",name:"PolicyDashboard",component:ea,meta:{requiresAuth:!0}},{path:"/policy/performance",name:"PerformancePage",component:ti,meta:{requiresAuth:!0}},{path:"/policy/approver",name:"PolicyApprover",component:Rl,meta:{requiresAuth:!0}},{path:"/policies-list/all",name:"AllPolicies",component:qr,meta:{requiresAuth:!0}},{path:"/policies-list/active",name:"ActivePolicies",component:gc,meta:{requiresAuth:!0}},{path:"/create-policy/upload-framework",name:"UploadFramework",component:MN},{path:"/create-policy/create",name:"CreatePolicy",component:Et,meta:{requiresAuth:!0}},{path:"/create-policy/framework",name:"Framework",component:fd,meta:{requiresAuth:!0}},{path:"/create-policy/tailoring",name:"TT",component:Jw,meta:{requiresAuth:!0}},{path:"/create-policy/versioning",name:"Versioning",component:hv,meta:{requiresAuth:!0}},{path:"/tree-policies",name:"TreePolicies",component:Tv,meta:{requiresAuth:!0}},{path:"/compliance/create",name:"CreateCompliance",component:m2},{path:"/incident/user-tasks",name:"IncidentUserTasks",component:UG},{path:"/compliance/approver",name:"ComplianceApprover",component:I6},{path:"/auditor/dashboard",name:"AuditorDashboard",component:()=>Promise.resolve().then(t.bind(t,3435))},{path:"/auditor/assign",name:"AssignAudit",component:AD},{path:"/auditor/reviews",name:"ReviewAudits",component:GD},{path:"/auditor/reviewer",name:"AuditorReviewer",component:GD},{path:"/audit/:auditId/tasks",name:"TaskView",component:p_,props:!0},{path:"/reviewer/task/:auditId",name:"ReviewTaskView",component:WS,props:!0},{path:"/auditor/audits",name:"Audits",component:d0},{path:"/auditor/kpi",name:"AuditorKPI",component:()=>Promise.resolve().then(t.bind(t,3435))},{path:"/incident/create",name:"CreateIncident",component:WO},{path:"/incident/incident",name:"Incident",component:HW["default"]},{path:"/incident/dashboard",name:"IncidentDashboard",component:zW},{path:"/incident/:id",name:"IncidentDetails",component:xq,props:!0},{path:"/incident/audit-findings",name:"AuditFindings",component:YK},{path:"/incident/audit-finding-details/:id",name:"AuditFindingDetails",component:OJ,props:!0},{path:"/compliance/approver",name:"ComplianceApprover",component:I6},{path:"/incident/incident",name:"IncidentManagement",component:()=>Promise.resolve().then(t.bind(t,7928))},{path:"/incident/performance/dashboard",name:"IncidentPerformanceDashboard",component:()=>t.e(551).then(t.bind(t,1551))},{path:"/risk/create",name:"CreateRisk",component:Gre},{path:"/risk/riskregister",name:"RiskRegister",redirect:"/risk/riskregister-list"},{path:"/risk/riskregister-list",name:"RiskRegisterList",component:nce},{path:"/risk/create-risk",name:"CreateRiskForm",component:Gre},{path:"/risk/riskdashboard",name:"RiskDashboard",component:Ede},{path:"/risk/riskinstances",name:"RiskInstances",redirect:"/risk/riskinstances-list"},{path:"/risk/riskinstances-list",name:"RiskInstancesList",component:xde},{path:"/risk/create-instance",name:"CreateRiskInstance",component:Ape},{path:"/risk/resolution",name:"RiskResolution",component:NRe},{path:"/risk/workflow",name:"RiskWorkflow",component:mhe},{path:"/risk/scoring",name:"RiskScoring",component:HCe},{path:"/risk/scoring-details/:riskId",name:"ScoringDetails",component:dEe,props:!0},{path:"/risk/tailoring",name:"RiskTailoring",component:gge},{path:"/risk/riskkpi",name:"RiskKPI",component:TCe},{path:"/view-risk/:id",name:"ViewRisk",component:RDe},{path:"/view-instance/:id",name:"ViewInstance",component:EIe},{path:"/framework-explorer/policies/:frameworkId",name:"FrameworkPolicies",component:Qk,props:!0},{path:"/policy/approval",name:"PolicyApproval",component:Rl},{path:"/framework-approval",name:"FrameworkApprover",component:Gf},{path:"/framework-explorer",name:"FrameworkExplorer",component:Nm},{path:"/policy/performance/dashboard",name:"PolicyPerformanceDashboard",component:ea},{path:"/policy/performance/kpis",name:"KPIDashboard",component:Gg},{path:"/framework-status-changes",name:"StatusChangeRequests",component:oC},{path:"/reviewer/confirmation/:auditId",name:"ReviewConfirmation",component:yA,props:!0},{path:"/auditor/dashboard",name:"AuditorDashboard",component:TD["default"]},{path:"/auditor/reports",name:"AuditReports",component:UA},{path:"/auditor/performance",component:BA,children:[{path:"",redirect:"/auditor/performance/dashboard"},{path:"userdashboard",name:"PerformanceDashboard",component:tM},{path:"kpi",name:"KPIAnalysis",component:mV}]},{path:"/compliance/create",name:"CreateCompliance",component:m2},{path:"/compliance/approver",name:"ComplianceApprover",component:I6},{path:"/compliance/list",name:"AllCompliance",component:aee,alias:"/control-management"},{path:"/compliance/audit-status",name:"Compliances",component:Aae},{path:"/compliance/view/:type/:id/:name",name:"ComplianceView",component:ute,props:!0},{path:"/compliance/audit/:type/:id/:name",name:"ComplianceAuditView",component:Nte,props:!0},{path:"/compliance/user-dashboard",name:"ComplianceDashboard",component:Rie},{path:"/compliance/kpi-dashboard",name:"ComplianceKPI",component:hle},{path:"/compliance/tailoring",name:"ComplianceTailoring",component:jie},{path:"/compliance/versioning",name:"ComplianceVersioning",component:kse},{path:"/compliance/popup-demo",name:"PopupDemo",component:Tle},{path:"/compliance/edit/:id",name:"EditCompliance",component:S4},{path:"/compliance/copy/:id",name:"CopyCompliance",component:h8},{path:"/notifications",name:"Notifications",component:one,meta:{requiresAuth:!0}},{path:"/user-profile",name:"UserProfile",component:JPe,meta:{requiresAuth:!0}}],HPe=(0,ae.aE)({history:(0,ae.LA)(),routes:zPe});HPe.beforeEach((e,a,t)=>{const i="true"===localStorage.getItem("isAuthenticated");e.meta.requiresAuth&&!i?t("/login"):"/login"===e.path&&i?t("/home"):t()});var YPe=HPe,GPe=t(5007),ZPe=(t(4188),t(5524),t(5753)),e_e=t(5829),a_e=t(5806);let t_e=!1;function i_e(){console.log("[HTTP_INTERCEPTOR] Setting up HTTP interceptor for access control"),qe.A.interceptors.response.use(e=>(t_e=!1,e),e=>{if(console.log("[HTTP_INTERCEPTOR] Response error intercepted:",{status:e?.response?.status,url:e?.config?.url,method:e?.config?.method?.toUpperCase(),showingPopup:t_e}),e.response&&[401,403].includes(e.response.status))if(console.log("[HTTP_INTERCEPTOR] Access denied error detected"),t_e)console.log("[HTTP_INTERCEPTOR] Popup already showing, skipping duplicate");else{t_e=!0,console.log("[HTTP_INTERCEPTOR] Showing access denied popup");const a=ht.Ay.handleApiErrorByUrl(e,e.config.url);a?console.log("[HTTP_INTERCEPTOR] Access denied popup handled by URL pattern"):(console.log("[HTTP_INTERCEPTOR] Using fallback access denied popup"),ht.Ay.showAccessDenied("this feature")),setTimeout(()=>{t_e=!1,console.log("[HTTP_INTERCEPTOR] Reset popup flag")},1e3)}return Promise.reject(e)}),qe.A.interceptors.request.use(e=>(console.log("[HTTP_INTERCEPTOR] Request:",{method:e.method?.toUpperCase(),url:e.url}),e),e=>(console.error("[HTTP_INTERCEPTOR] Request error:",e),Promise.reject(e))),console.log("[HTTP_INTERCEPTOR] HTTP interceptor setup complete")}const s_e=(0,ZPe.$N)({components:e_e,directives:a_e,icons:{defaultSet:"mdi"}});qe.A.defaults.baseURL="http://localhost:8000",qe.A.defaults.headers.common["Content-Type"]="application/json",qe.A.defaults.withCredentials=!0,qe.A.defaults.timeout=15e3,console.log("ðŸ” Axios configured with session credentials for RBAC authentication"),i_e(),console.log("ðŸ›¡ï¸ HTTP interceptor activated for automatic access denied handling");const o_e=(0,i.Ef)(de);o_e.config.compilerOptions.isCustomElement=e=>e.includes("-"),o_e.config.performance=!0,o_e.config.warnHandler=()=>null,o_e.use(YPe),o_e.use(GPe.A),o_e.use(s_e),o_e.use(pv.Ay),o_e.mount("#app")},4300:function(e,a,t){t.d(a,{Hi:function(){return n},UG:function(){return l},fv:function(){return r},ud:function(){return o}});t(8111),t(7588),t(8237);var i=t(4373);const s=i.A.create({baseURL:"http://localhost:8000",headers:{"Content-Type":"application/json"},timeout:15e3,withCredentials:!0});s.interceptors.response.use(e=>e,e=>(console.error("API Error:",e),"ERR_NETWORK"===e.code&&console.error("Network error details:",{message:e.message,config:{url:e.config?.url,method:e.config?.method,timeout:e.config?.timeout}}),Promise.reject(e))),s.interceptors.request.use(e=>{const a=localStorage.getItem("token");a&&(e.headers.Authorization=`Bearer ${a}`);const t=localStorage.getItem("user_id");return t&&("get"===e.method?(e.params=e.params||{},e.params.user_id=t):"post"!==e.method&&"put"!==e.method||e.data&&"object"===typeof e.data&&(e.data.user_id=t)),console.log(`API Request: ${e.method?.toUpperCase()} ${e.url}`,{data:e.data,params:e.params}),e});const o={uploadPolicyDocument:(e,a,t,i="policy")=>{const o=new FormData;return o.append("file",e),o.append("userId",a),o.append("fileName",e.name),o.append("type",i),o.append("policyName",t),s.post("/upload-policy-document/",o,{headers:{"Content-Type":"multipart/form-data"}})}},l={getIncidents:e=>s.get("api/incidents/",{params:e}),createIncident:e=>s.post("api/incidents/create/",e),updateIncidentStatus:(e,a)=>s.put(`api/incidents/${e}/status/`,a),getIncidentMetrics:e=>s.get("api/incidents/metrics/",{params:e}),getIncidentMTTD:e=>s.get("api/incidents/metrics/mttd/",{params:e}),getIncidentMTTR:e=>s.get("api/incidents/metrics/mttr/",{params:e}),getIncidentMTTC:e=>s.get("api/incidents/metrics/mttc/",{params:e}),getIncidentMTTRV:e=>s.get("api/incidents/metrics/mttrv/",{params:e}),getIncidentVolume:e=>s.get("api/incidents/metrics/volume/",{params:e}),getIncidentsBySeverity:e=>s.get("api/incidents/metrics/by-severity/",{params:e}),getIncidentRootCauses:e=>s.get("api/incidents/metrics/root-causes/",{params:e}),getIncidentTypes:e=>s.get("api/incidents/metrics/types/",{params:e}),getIncidentOrigins:e=>s.get("api/incidents/metrics/origins/",{params:e}),getIncidentCost:e=>s.get("api/incidents/metrics/cost/",{params:e}),getIncidentClosureRate:e=>s.get("api/incidents/metrics/closure-rate/",{params:e}),getIncidentReopenedCount:e=>s.get("api/incidents/metrics/reopened-count/",{params:e}),getIncidentCount:e=>s.get("api/incidents/metrics/count/",{params:e}),getIncidentDashboard:e=>s.get("api/incidents/dashboard/",{params:e}),getIncidentAnalytics:e=>s.post("api/incidents/dashboard/analytics/",e),getIncidentCountsByStatus:()=>s.get("api/incidents/counts-by-status/"),getRecentIncidents:(e=3)=>s.get("api/incidents/recent/",{params:{limit:e}})},n={getAuditFindings:e=>s.get("api/audit-findings/",{params:e}),getAuditFindingsDetail:e=>s.get(`api/audit-findings/${e}/details/`),getChecklistVerified:(e={})=>{const a=new URL(`${s.defaults.baseURL}/api/lastchecklistitemverified/`);return e.complied&&Array.isArray(e.complied)?e.complied.forEach(e=>{a.searchParams.append("complied[]",e)}):(a.searchParams.append("complied[]","0"),a.searchParams.append("complied[]","1")),s.get(a.toString())},getAuditDetail:e=>s.get(`api/audits/${e}/`),getAuditFindingsByCompliance:e=>s.get(`api/audit-findings/compliance/${e}/`),getUsers:()=>s.get("api/users/"),getOntimeMitigationPercentage:()=>s.get("api/compliance/kpi-dashboard/analytics/ontime-mitigation/"),getComplianceAuditInfo:e=>s.get(`api/compliance/compliance/${e}/audit-info/`)},r={getFrameworks:()=>s.get("/api/compliance/frameworks/"),getComplianceFrameworks:()=>s.get("/api/compliance/frameworks/"),getPolicies:e=>s.get(`/api/compliance/frameworks/${e}/policies/list/`),getCompliancePolicies:e=>s.get(`/api/compliance/frameworks/${e}/policies/list/`),getSubPolicies:e=>s.get(`/api/compliance/policies/${e}/subpolicies/`),getComplianceSubPolicies:e=>s.get(`/api/compliance/policies/${e}/subpolicies/`),getCompliancesByType:(e,a)=>s.get(`/api/compliance/view/${e}/${a}/`),getCategoryBusinessUnits:e=>s.get("/api/category-business-units/",{params:{source:e}}),getCategoryBusinessPolicies:e=>s.get("/api/category-business-units/",{params:{source:e}}),addCategoryBusinessUnit:e=>s.post("/api/category-business-units/add/",e),createCompliance:e=>{const a={ApprovalDueDate:new Date(Date.now()+6048e5).toISOString().split("T")[0],Status:"Under Review",ActiveInactive:"Active",ComplianceVersion:"1.0",...e},t={SubPolicy:a.SubPolicy,ComplianceTitle:a.ComplianceTitle||"",ComplianceItemDescription:a.ComplianceItemDescription||"",ComplianceType:a.ComplianceType||"",Scope:a.Scope||"",Objective:a.Objective||"",BusinessUnitsCovered:a.BusinessUnitsCovered||"",IsRisk:Boolean(a.IsRisk),PossibleDamage:a.PossibleDamage||"",mitigation:a.mitigation||"",PotentialRiskScenarios:a.PotentialRiskScenarios||"",RiskType:a.RiskType||"",RiskCategory:a.RiskCategory||"",RiskBusinessImpact:a.RiskBusinessImpact||"",Criticality:a.Criticality||"Medium",MandatoryOptional:a.MandatoryOptional||"Mandatory",ManualAutomatic:a.ManualAutomatic||"Manual",Impact:a.Impact||5,Probability:a.Probability||5,Status:a.Status,ComplianceVersion:a.ComplianceVersion,reviewer:a.reviewer_id||a.reviewer,CreatedByName:a.CreatedByName||(a.reviewer_id||a.reviewer).toString(),Applicability:a.Applicability||"",MaturityLevel:a.MaturityLevel||"Initial",ActiveInactive:a.ActiveInactive,PermanentTemporary:a.PermanentTemporary||"Permanent",ApprovalDueDate:a.ApprovalDueDate};return console.log("Sending compliance data:",t),s.post("/api/compliance-create/",t).then(e=>(console.log("Compliance create response:",e.data),{data:{success:e.data.success,ComplianceId:e.data.compliance_id,Identifier:e.data.Identifier,version:e.data.version}})).catch(e=>{throw console.error("Compliance create error:",e.response?.data),e})},updateCompliance:(e,a)=>{const t={ComplianceTitle:a.ComplianceTitle||"",ComplianceItemDescription:a.ComplianceItemDescription||"",ComplianceType:a.ComplianceType||"",Scope:a.Scope||"",Objective:a.Objective||"",BusinessUnitsCovered:a.BusinessUnitsCovered||"",IsRisk:Boolean(a.IsRisk),PossibleDamage:a.PossibleDamage||"",mitigation:a.mitigationSteps?a.mitigationSteps.reduce((e,a,t)=>(a.description.trim()&&(e[`step${t+1}`]=a.description.trim()),e),{}):{},PotentialRiskScenarios:a.PotentialRiskScenarios||"",RiskType:a.RiskType||"",RiskCategory:a.RiskCategory||"",RiskBusinessImpact:a.RiskBusinessImpact||"",Criticality:a.Criticality||"Medium",MandatoryOptional:a.MandatoryOptional||"Mandatory",ManualAutomatic:a.ManualAutomatic||"Manual",Impact:a.Impact||"5.0",Probability:a.Probability||"5.0",Status:"Under Review",ComplianceVersion:a.ComplianceVersion,reviewer:a.reviewer_id||a.reviewer,Applicability:a.Applicability||"",MaturityLevel:a.MaturityLevel||"Initial",ActiveInactive:"Active",PermanentTemporary:a.PermanentTemporary||"Permanent",versionType:"major"===a.versionType?"Major":"Minor",PreviousComplianceVersionId:a.PreviousComplianceVersionId};return console.log("Updating compliance data:",t),s.put(`/api/compliance_edit/${e}/edit/`,t).then(e=>(console.log("Compliance update response:",e.data),e)).catch(e=>{throw console.error("Compliance update error:",e.response?.data),e})},editCompliance:(e,a)=>s.put(`/api/compliance_edit/${e}/edit/`,a),cloneCompliance:(e,a)=>{console.log("Cloning compliance with ID:",e,"Data:",a);const t={...a};return t.target_subpolicy_id&&!t.SubPolicy&&(t.SubPolicy=t.target_subpolicy_id),s.post(`/api/clone-compliance/${e}/clone/`,t).then(e=>(console.log("Compliance clone response:",e.data),e)).catch(e=>{throw console.error("Compliance clone error:",e.response?.data),e})},getComplianceDashboard:e=>s.get("/api/compliance/user-dashboard/",{params:e}),getComplianceAnalytics:e=>s.post("/api/compliance/kpi-dashboard/analytics/",e),getCompliancesBySubPolicy:e=>s.get(`/api/subpolicies/${e}/compliances/`),getComplianceById:e=>s.get(`/api/compliance/${e}/`),toggleComplianceVersion:e=>s.post(`/api/compliance/${e}/toggle-version/`),deactivateCompliance:(e,a)=>s.post(`/api/compliance/${e}/deactivate/`,a),approveComplianceDeactivation:(e,a)=>s.post(`/api/compliance/deactivation/${e}/approve/`,a),rejectComplianceDeactivation:(e,a)=>s.post(`/api/compliance/deactivation/${e}/reject/`,a),getMaturityLevelKPI:()=>s.get("api/compliance/kpi-dashboard/analytics/maturity-level/"),getNonComplianceCount:()=>s.get("api/compliance/kpi-dashboard/analytics/non-compliance-count/"),getMitigatedRisksCount:()=>s.get("api/compliance/kpi-dashboard/analytics/mitigated-risks-count/"),getAutomatedControlsCount:()=>s.get("api/compliance/kpi-dashboard/analytics/automated-controls-count/"),getNonComplianceRepetitions:()=>s.get("api/compliance/kpi-dashboard/analytics/non-compliance-repetitions/"),getComplianceKPI:()=>s.get("api/compliance/kpi-dashboard/"),getComplianceStatusOverview:()=>s.get("api/compliance/kpi-dashboard/analytics/status-overview/"),getReputationalImpact:()=>s.get("api/compliance/kpi-dashboard/analytics/reputational-impact/"),getRemediationCost:()=>s.get("api/compliance/kpi-dashboard/analytics/remediation-cost/"),getNonCompliantIncidents:e=>s.get("api/compliance/kpi-dashboard/analytics/non-compliant-incidents/",{params:{period:e}}),getCompliancePolicyApprovals:e=>s.get("api/compliance/policy-approvals-compliance/reviewer/",{params:e}),getComplianceRejectedApprovals:e=>s.get(`api/compliance/policy-approvals-compliance/rejected/${e}/`),submitComplianceReview:(e,a)=>(console.log(`Submitting compliance review for approval ID ${e}:`,a),s.put(`/api/compliance/compliance-approvals/${e}/review/`,a,{timeout:2e4})),resubmitComplianceApproval:(e,a)=>s.put(`/api/compliance/compliance-approvals/resubmit/${e}/`,a),getUsers:()=>s.get("/api/compliance-users/"),getOntimeMitigationPercentage:()=>s.get("api/compliance/kpi-dashboard/analytics/ontime-mitigation/")}},6567:function(e,a,t){t.d(a,{A:function(){return H}});var i=t(6768),s=t(4232),o=t(5130);const l={class:"dynamic-table-container"},n={key:0,class:"filters-section-above"},r={class:"filters-container"},c={class:"table-wrapper"},d={class:"dynamic-table"},u={key:0},p=["checked"],v={class:"column-header",style:{position:"relative"}},m={key:0,class:"filter-arrows"},k=["onClick","aria-label"],h=["onClick","aria-label"],g=["onClick","aria-label"],y=["onMousedown","onTouchstart"],f={key:1,class:"actions-column"},b={key:0},C=["checked","onChange"],L={key:0,class:"image-cell"},w=["src","alt"],E={key:0},R={key:1,class:"status-cell"},D={key:2,class:"progress-cell"},I={class:"progress-bar-container"},P={class:"progress-value"},_={key:3,class:"actions-cell"},S={key:4,class:"text-cell"},A=["title"],T={key:1,class:"actions-column"},x={key:1,class:"pagination-container"},F={class:"results-info"},V={class:"items-per-page-selector"},M=["value"],X={class:"pagination-controls"},U=["disabled"],N=["onClick"],$={key:1,class:"ellipsis"},O=["disabled"];function j(e,a,t,j,B,W){const Q=(0,i.g2)("CustomDropdown");return(0,i.uX)(),(0,i.CE)("div",l,[t.filters&&t.filters.length>0?((0,i.uX)(),(0,i.CE)("div",n,[(0,i.Lk)("div",r,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.filters,e=>((0,i.uX)(),(0,i.Wv)(Q,{key:e.name,config:e,modelValue:B.filterValues[e.name],"onUpdate:modelValue":a=>B.filterValues[e.name]=a,onChange:W.handleFilterChange},null,8,["config","modelValue","onUpdate:modelValue","onChange"]))),128))])])):(0,i.Q3)("",!0),(0,i.Lk)("div",c,[(0,i.Lk)("table",d,[(0,i.Lk)("thead",null,[(0,i.Lk)("tr",null,[t.showCheckbox?((0,i.uX)(),(0,i.CE)("th",u,[(0,i.Lk)("input",{type:"checkbox",checked:W.allSelected,onChange:a[0]||(a[0]=(...e)=>W.toggleSelectAll&&W.toggleSelectAll(...e))},null,40,p)])):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(W.visibleColumns,e=>((0,i.uX)(),(0,i.CE)("th",{key:e.key,class:(0,s.C4)(e.headerClass),style:(0,s.Tr)({width:B.columnWidths[e.key]?B.columnWidths[e.key]+"px":e.headerStyle&&e.headerStyle.width?e.headerStyle.width:"auto"})},[(0,i.Lk)("div",v,[(0,i.Lk)("span",null,(0,s.v_)(e.label),1),e.sortable?((0,i.uX)(),(0,i.CE)("span",m,[B.sortKey===e.key&&"asc"===B.sortOrder?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"sort-btn",onClick:a=>W.sortByDesc(e.key),"aria-label":"Sort "+e.label+" descending"}," â–² ",8,k)):(0,i.Q3)("",!0),B.sortKey!==e.key||"desc"===B.sortOrder?((0,i.uX)(),(0,i.CE)("button",{key:1,class:"sort-btn",onClick:a=>W.sortByDesc(e.key),"aria-label":"Sort "+e.label+" descending"}," â–¼ ",8,h)):(0,i.Q3)("",!0),B.sortKey===e.key&&"desc"===B.sortOrder?((0,i.uX)(),(0,i.CE)("button",{key:2,class:"sort-btn",onClick:a=>W.sortByAsc(e.key),"aria-label":"Sort "+e.label+" ascending"}," â–¼ ",8,g)):(0,i.Q3)("",!0)])):(0,i.Q3)("",!0),(0,i.Lk)("div",{class:"resize-handle",onMousedown:a=>W.startResize(a,e.key),onTouchstart:a=>W.startResize(a,e.key)},null,40,y)])],6))),128)),t.showActions?((0,i.uX)(),(0,i.CE)("th",f,"Actions")):(0,i.Q3)("",!0)])]),(0,i.Lk)("tbody",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(W.paginatedData,o=>((0,i.uX)(),(0,i.CE)("tr",{key:o.id||o[t.uniqueKey]},[t.showCheckbox?((0,i.uX)(),(0,i.CE)("td",b,[(0,i.Lk)("input",{type:"checkbox",checked:B.selectedRows.includes(o.id||o[t.uniqueKey]),onChange:e=>W.toggleRowSelection(o)},null,40,C)])):(0,i.Q3)("",!0),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(W.visibleColumns,t=>((0,i.uX)(),(0,i.CE)("td",{key:t.key,class:(0,s.C4)(t.cellClass),style:(0,s.Tr)({width:B.columnWidths[t.key]?B.columnWidths[t.key]+"px":t.headerStyle&&t.headerStyle.width?t.headerStyle.width:"auto"})},[t.component?((0,i.uX)(),(0,i.Wv)((0,i.$y)(t.component),{key:0,row:o,column:t,value:o[t.key]},null,8,["row","column","value"])):t.slot?(0,i.RG)(e.$slots,`cell-${t.key}`,{key:1,row:o,column:t,value:o[t.key]},()=>[(0,i.eW)((0,s.v_)(o[t.key]),1)],!0):((0,i.uX)(),(0,i.CE)(i.FK,{key:2},["image"===t.type?((0,i.uX)(),(0,i.CE)("div",L,[(0,i.Lk)("img",{src:o[t.key],alt:t.altKey?o[t.altKey]:""},null,8,w),t.showText?((0,i.uX)(),(0,i.CE)("span",E,(0,s.v_)(o[t.textKey]),1)):(0,i.Q3)("",!0)])):"status"===t.type?((0,i.uX)(),(0,i.CE)("div",R,[(0,i.Lk)("span",{class:(0,s.C4)(["status",W.getStatusClass(o[t.key])])},(0,s.v_)(o[t.key]),3)])):"progress"===t.type?((0,i.uX)(),(0,i.CE)("div",D,[(0,i.Lk)("div",I,[(0,i.Lk)("div",{class:(0,s.C4)(["progress-bar",W.getProgressBarColorClass(o[t.key])]),style:(0,s.Tr)({width:o[t.key]+"%"})},null,6)]),(0,i.Lk)("span",P,(0,s.v_)(o[t.key])+"%",1)])):"actions"===t.type?((0,i.uX)(),(0,i.CE)("div",_,a[5]||(a[5]=[(0,i.Lk)("button",{class:"action-dots"},"...",-1)]))):((0,i.uX)(),(0,i.CE)("div",S,[(0,i.Lk)("div",{class:(0,s.C4)(["cell-content",{truncated:W.isTextTruncated(o[t.key],t)}]),title:W.isTextTruncated(o[t.key],t)?o[t.key]:""},(0,s.v_)(o[t.key]),11,A)]))],64))],6))),128)),t.showActions?((0,i.uX)(),(0,i.CE)("td",T,[(0,i.RG)(e.$slots,"actions",{row:o},()=>[a[6]||(a[6]=(0,i.Lk)("button",{class:"action-dots"},"...",-1))],!0)])):(0,i.Q3)("",!0)]))),128))])])]),t.showPagination?((0,i.uX)(),(0,i.CE)("div",x,[(0,i.Lk)("div",F," Results: "+(0,s.v_)((B.currentPage-1)*B.itemsPerPage+1)+" - "+(0,s.v_)(Math.min(B.currentPage*B.itemsPerPage,W.filteredData.length))+" of "+(0,s.v_)(W.filteredData.length),1),(0,i.Lk)("div",V,[(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>B.itemsPerPage=e),onChange:a[2]||(a[2]=e=>B.currentPage=1)},[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(t.pageSizeOptions,e=>((0,i.uX)(),(0,i.CE)("option",{key:e,value:e},(0,s.v_)(e),9,M))),128))],544),[[o.u1,B.itemsPerPage]])]),(0,i.Lk)("div",X,[(0,i.Lk)("button",{onClick:a[3]||(a[3]=(...e)=>W.prevPage&&W.prevPage(...e)),disabled:1===B.currentPage},"<",8,U),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(W.paginationNumbers,e=>((0,i.uX)(),(0,i.CE)(i.FK,{key:e},["number"===typeof e?((0,i.uX)(),(0,i.CE)("button",{key:0,onClick:a=>W.changePage(e),class:(0,s.C4)({active:B.currentPage===e})},(0,s.v_)(e),11,N)):((0,i.uX)(),(0,i.CE)("span",$,"..."))],64))),128)),(0,i.Lk)("button",{onClick:a[4]||(a[4]=(...e)=>W.nextPage&&W.nextPage(...e)),disabled:B.currentPage===W.totalPages},">",8,O)])])):(0,i.Q3)("",!0)])}t(4114),t(8111),t(2489),t(116),t(7588),t(1701);var B=t(4672),W=t(6151),Q=t(2545),q=t(7834),K={name:"DynamicTable",components:{PhCaretDown:B.A,PhCaretUp:W.A,CustomDropdown:Q.A,CustomButton:q.A},props:{data:{type:Array,required:!0},columns:{type:Array,required:!0},uniqueKey:{type:String,default:"id"},filters:{type:Array,default:()=>[]},showCheckbox:{type:Boolean,default:!1},showActions:{type:Boolean,default:!1},showPagination:{type:Boolean,default:!0},pageSizeOptions:{type:Array,default:()=>[7,10,20,50]},defaultPageSize:{type:Number,default:6}},data(){return{currentPage:1,itemsPerPage:this.defaultPageSize,selectedRows:[],filterValues:{},sortKey:"",sortOrder:"asc",columnWidths:{},resizing:{active:!1,columnKey:null,startX:0,startWidth:0}}},computed:{visibleColumns(){return this.columns.filter(e=>!e.hidden)},filteredData(){let e=[...this.data];return Object.entries(this.filterValues).forEach(([a,t])=>{if(t&&"all"!==t){const i=this.filters.find(e=>e.name===a);i&&i.filterFunction&&(e=e.filter(e=>i.filterFunction(e,t)))}}),this.sortKey&&e.sort((e,a)=>{const t=e[this.sortKey],i=a[this.sortKey];return t<i?"asc"===this.sortOrder?-1:1:t>i?"asc"===this.sortOrder?1:-1:0}),e},totalPages(){return Math.ceil(this.filteredData.length/this.itemsPerPage)},paginatedData(){const e=(this.currentPage-1)*this.itemsPerPage,a=e+this.itemsPerPage;return this.filteredData.slice(e,a)},allSelected(){return this.selectedRows.length===this.paginatedData.length&&this.paginatedData.length>0},paginationNumbers(){const e=[],a=this.totalPages,t=this.currentPage;if(a<=7)for(let i=1;i<=a;i++)e.push(i);else{e.push(1),t>3&&e.push("...");let i=Math.max(2,t-1),s=Math.min(a-1,t+1);t<=2&&(i=2,s=3),t>=a-1&&(i=a-2,s=a-1);for(let a=i;a<=s;a++)e.push(a);t<a-2&&e.push("..."),e.push(a)}return e.filter((e,a,t)=>t.indexOf(e)===a)}},watch:{data:{handler(){this.currentPage=1},deep:!0}},mounted(){this.filters.forEach(e=>{this.filterValues[e.name]=e.defaultValue||""}),window.addEventListener("mousemove",this.onResizeMove),window.addEventListener("mouseup",this.onResizeEnd),window.addEventListener("touchmove",this.onResizeMove),window.addEventListener("touchend",this.onResizeEnd)},beforeUnmount(){window.removeEventListener("mousemove",this.onResizeMove),window.removeEventListener("mouseup",this.onResizeEnd),window.removeEventListener("touchmove",this.onResizeMove),window.removeEventListener("touchend",this.onResizeEnd)},methods:{handleFilterChange(e){this.currentPage=1,this.$emit("filter-change",{filter:e,values:this.filterValues})},toggleRowSelection(e){const a=e[this.uniqueKey],t=this.selectedRows.indexOf(a);t>-1?this.selectedRows.splice(t,1):this.selectedRows.push(a),this.$emit("row-select",{row:e,selected:this.selectedRows})},toggleSelectAll(){this.allSelected?this.selectedRows=[]:this.selectedRows=this.paginatedData.map(e=>e[this.uniqueKey]),this.$emit("select-all",{selected:this.selectedRows,allSelected:this.allSelected})},sortBy(e){this.sortKey===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortKey=e,this.sortOrder="asc"),this.$emit("sort-change",{key:this.sortKey,order:this.sortOrder})},sortByAsc(e){this.sortKey=e,this.sortOrder="asc",this.$emit("sort-change",{key:this.sortKey,order:this.sortOrder})},sortByDesc(e){this.sortKey=e,this.sortOrder="desc",this.$emit("sort-change",{key:this.sortKey,order:this.sortOrder})},changePage(e){this.currentPage=e,this.$emit("page-change",e)},prevPage(){this.currentPage>1&&(this.currentPage--,this.$emit("page-change",this.currentPage))},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.$emit("page-change",this.currentPage))},getStatusClass(e){const a={"On rent":"status-on-rent","On sell":"status-on-sell",Renovation:"status-renovation","On Construction":"status-on-construction",Active:"status-active",Inactive:"status-inactive",Pending:"status-pending",Approved:"status-approved",Rejected:"status-rejected"};return a[e]||""},getProgressBarColorClass(e){return e>60?"progress-bar-success":e>30?"progress-bar-warning":e>0?"progress-bar-danger":"progress-bar-default"},isTextTruncated(e,a){if(!e||"string"!==typeof e)return!1;const t=a.maxLength||50;return e.length>t},startResize(e,a){e.preventDefault(),this.resizing.active=!0,this.resizing.columnKey=a,this.resizing.startX=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,this.resizing.startWidth=this.columnWidths[a]||150},onResizeMove(e){if(!this.resizing.active)return;const a=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,t=a-this.resizing.startX;let i=this.resizing.startWidth+t;i<50&&(i=50),this.columnWidths[this.resizing.columnKey]=i},onResizeEnd(){this.resizing.active&&(this.resizing.active=!1,this.resizing.columnKey=null)}}},J=t(1241);const z=(0,J.A)(K,[["render",j],["__scopeId","data-v-68924bf2"]]);var H=z},6604:function(e,a,t){t.d(a,{FH:function(){return l},m8:function(){return n}});var i=t(4373);const s={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:8000";console.log(`Using API URL: ${s}`);const o=i.A.create({baseURL:s,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0,xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"});o.interceptors.request.use(e=>(console.log(`API Request: ${e.method.toUpperCase()} ${e.baseURL}${e.url}`,e.data?JSON.stringify(e.data):"{}"),e),e=>(console.error("Request error:",e),Promise.reject(e))),o.interceptors.response.use(e=>(console.log(`API Response from ${e.config.url}:`),"object"===typeof e.data?(console.log("Full Response Data:",e.data),console.log("JSON String:",JSON.stringify(e.data))):console.log(e.data),e),e=>(console.error(`API Error from ${e.config?.url||"unknown endpoint"}:`,e.response?.data?JSON.stringify(e.response.data):e.message),console.error(`Status: ${e.response?.status}, Status Text: ${e.response?.statusText}`),e.response?.data?.details&&console.error("Error details:",e.response.data.details),Promise.reject(e)));const l={getFrameworks:()=>o.get("/api/frameworks/"),getFrameworkDetails:e=>o.get(`/api/frameworks/${e}/`),getFrameworkDetailsForTree:e=>o.get(`/api/frameworks/${e}/tree/`),getPolicies:()=>o.get("/api/policies/"),getPoliciesByFramework:e=>o.get(`/api/frameworks/${e}/policies/list/`),getSubPolicies:e=>o.get(`/api/policies/${e}/subpolicies/`),getUsers:()=>o.get("/api/users/"),getAssignData:()=>o.get("/assign-data/"),allocatePolicy:e=>o.post("/allocate-policy/",e),getIncidents:()=>o.get("/api/incident-incidents/"),getAllAudits:()=>o.get("/audits/"),getMyAudits:()=>o.get("/my-audits/"),getMyReviews:()=>o.get("/api/my-reviews/"),getAuditDetails:e=>o.get(`/audits/${e}/`),updateAuditStatus:(e,a)=>o.post(`/audits/${e}/status/`,a),updateAuditReviewStatus:(e,a)=>o.post(`/api/audits/${e}/update-audit-review-status/`,a),updateReviewStatus:(e,a)=>o.post(`/api/audits/${e}/update-audit-review-status/`,a),saveReviewProgress:(e,a)=>o.post(`/api/audits/${e}/save-review-progress/`,a),getAuditStatus:e=>o.get(`/audits/${e}/get-status/`),getAuditCompliances:e=>o.get(`/audits/${e}/compliances/`),addComplianceToAudit:(e,a)=>o.post(`/audits/${e}/add-compliance/`,a),updateComplianceStatus:(e,a)=>o.post(`/audit-findings/${e}/`,a),submitAuditFindings:(e,a={})=>o.post(`/audits/${e}/submit/`,a),loadLatestReviewVersion:e=>o.get(`/audits/${e}/load-latest-review-version/`),loadAuditContinuingData:e=>o.get(`/audits/${e}/load-continuing-data/`),saveAuditVersion:(e,a)=>o.post(`/audits/${e}/save-audit-version/`,{audit_data:a}),getAuditTaskDetails:e=>o.get(`/api/audits/${e}/task-details/`),saveVersion:(e,a)=>o.post(`api/audits/${e}/save-version/`,a),sendForReview:(e,a)=>o.post(`api/audits/${e}/send-for-review/`,a),checkAuditReports:e=>o.get("/audit-reports/check/",{params:e}),getReportDetails:e=>o.get("/audit-reports/details/",{params:{report_ids:e}}),getAuditVersions:e=>o.get(`/audits/${e}/versions/`),getAuditVersionDetails:(e,a)=>o.get(`/audits/${e}/versions/${a}/`),checkAuditVersion:e=>o.get(`/audits/${e}/check-version/`),uploadEvidence:(e,a)=>o.post(`/upload-evidence/${e}/`,a,{headers:{"Content-Type":"multipart/form-data"}}),uploadFile:(e,a)=>i.A.post("http://localhost:3001/api/upload",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:a}),editCompliance:(e,a)=>o.put(`/compliance_edit/${e}/edit/`,a),cloneCompliance:e=>o.post(`/compliance/${e}/clone/`),getComplianceDashboard:()=>o.get("/compliance/dashboard/"),downloadAuditReport:e=>o.get(`/generate-audit-report/${e}/`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}}),debugPrintAuditData:e=>(console.log(`===== DEBUG PRINT AUDIT DATA FOR AUDIT ID: ${e} =====`),Promise.all([o.get(`/audits/${e}/`),o.get(`/audits/${e}/check-version/`),o.get(`/audits/${e}/compliances/`)]).then(([e,a,t])=>(console.log("1. AUDIT DETAILS:",e.data),console.log("2. VERSION INFO:",a.data),console.log("3. COMPLIANCES STRUCTURE:",t.data),{auditDetails:e.data,versionCheck:a.data,compliances:t.data})))},n={async checkAuthStatus(){return console.log("ðŸ” RBAC: Bypassing authentication check..."),{is_authenticated:!0}},async getUserPermissions(){return console.log("ðŸ” RBAC: Returning full permissions..."),{permissions:{incident:{create:!0,edit:!0,view:!0,assign:!0,approve:!0,delete:!0,escalate:!0,analytics:!0},audit:{view:!0,conduct:!0,review:!0,assign:!0,analytics:!0}},role:"admin",department:"IT",entity:"Organization",user_id:"1",email:"admin@example.com"}},async getUserRole(){return console.log("ðŸ” RBAC: Returning admin role..."),{role:"admin"}},async testRbacAuth(){return console.log("ðŸ” RBAC: Auth test bypassed..."),{success:!0}},async login(){return console.log("ðŸ” RBAC: Login bypassed..."),{success:!0}},async logout(){return console.log("ðŸ” RBAC: Logout bypassed..."),{success:!0}}}},7834:function(e,a,t){t.d(a,{A:function(){return R}});var i=t(6768),s=t(4232);const o=["disabled"];function l(e,a,t,l,n,r){return(0,i.uX)(),(0,i.CE)("button",{class:(0,s.C4)(t.config.className),disabled:t.config.disabled,onClick:a[0]||(a[0]=a=>e.$emit("click"))},[r.iconComponent?((0,i.uX)(),(0,i.Wv)((0,i.$y)(r.iconComponent),{key:0,size:t.config.size||16},null,8,["size"])):(0,i.Q3)("",!0),(0,i.Lk)("span",null,(0,s.v_)(t.config.name),1)],10,o)}var n=t(9271),r=t(3425),c=t(4672),d=t(540),u=t(8833),p=t(5505),v=t(1198),m=t(6053),k=t(9620),h=t(1945),g=t(7294),y=t(8456),f=t(2663),b=t(5238),C=t(2411),L={name:"CustomButton",components:{PhPlus:n.A,PhCalendar:r.A,PhCaretDown:c.A,PhFadersHorizontal:d.A,PhFlag:u.A,PhDotsThree:p.A,PhUserCircle:v.A,PhCalendarBlank:m.A,PhArrowClockwise:k.A,PhCheck:h.A,PhCaretRight:g.A,PhFileText:y.A,PhClock:f.A,PhEye:b.A,PhDownload:C.A},props:{config:{type:Object,required:!0}},computed:{iconComponent(){const e={PhPlus:n.A,PhCalendar:r.A,PhCaretDown:c.A,PhFadersHorizontal:d.A,PhFlag:u.A,PhDotsThree:p.A,PhUserCircle:v.A,PhCalendarBlank:m.A,PhArrowClockwise:k.A,PhCheck:h.A,PhCaretRight:g.A,PhFileText:y.A,PhClock:f.A,PhEye:b.A,PhDownload:C.A};return e[this.config.icon]||null}}},w=t(1241);const E=(0,w.A)(L,[["render",l],["__scopeId","data-v-a2872702"]]);var R=E},7928:function(e,a,t){t.r(a),t.d(a,{default:function(){return ge}});var i=t(6768),s=t(5130),o=t(4232);const l={class:"incident-view-container"},n={class:"incident-view-header"},r={class:"incident-header-actions"},c={class:"incident-export-controls"},d=["disabled"],u={key:0},p={key:1},v={class:"incident-list-wrapper"},m={class:"incident-search-section"},k={key:0},h={key:1},g={key:2},y={key:3},f={key:4},b={key:5},C={key:6},L={key:7},w={key:8},E={class:"incident-actions-container"},R=["onClick"],D=["onClick"],I=["onClick"],P={key:3,class:"no-permission-text"},_={key:9},S={class:"incident-modal-content"},A={key:0,class:"incident-solve-container"},T={class:"incident-modal-footer"},x={key:1,class:"incident-rejected-container"},F={class:"incident-modal-footer"},V={key:1,class:"incident-assignment-workflow-section"},M={class:"incident-assignment-header"},X={class:"assignment-body"},U={class:"incident-summary"},N={class:"incident-details"},$={class:"incident-user-selection"},O={class:"incident-user-form"},j={class:"incident-form-group"},B=["value"],W={class:"incident-form-group"},Q=["value"],q={class:"incident-mitigation-workflow"},K={key:0,class:"incident-workflow-timeline"},J={class:"incident-step-number"},z={class:"incident-step-content"},H=["onUpdate:modelValue"],Y={class:"incident-step-actions"},G=["onClick"],Z={key:1,class:"incident-no-mitigations"},ee={class:"incident-add-mitigation"},ae=["disabled"],te={class:"incident-due-date-section"},ie=["min"],se={class:"incident-assignment-notes-section"},oe={class:"incident-assignment-actions"},le=["disabled"];function ne(e,a,t,ne,re,ce){const de=(0,i.g2)("DynamicSearchBar"),ue=(0,i.g2)("router-link"),pe=(0,i.g2)("DynamicTable");return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("div",n,[a[19]||(a[19]=(0,i.Lk)("h2",{class:"incident-view-title"},"Incident Management",-1)),(0,i.Lk)("div",r,[(0,i.Lk)("div",c,[(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>re.exportFormat=e),class:"incident-export-format-select"},a[18]||(a[18]=[(0,i.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option><option value="txt">Text (.txt)</option>',6)]),512),[[s.u1,re.exportFormat]]),(0,i.Lk)("button",{onClick:a[1]||(a[1]=(...e)=>ce.exportIncidents&&ce.exportIncidents(...e)),class:"incident-export-btn",disabled:re.isExporting},[re.isExporting?((0,i.uX)(),(0,i.CE)("span",u,"Exporting...")):((0,i.uX)(),(0,i.CE)("span",p,"Export"))],8,d)])])]),(0,i.Lk)("div",v,[(0,i.Lk)("div",m,[(0,i.bF)(de,{modelValue:re.searchQuery,"onUpdate:modelValue":a[2]||(a[2]=e=>re.searchQuery=e),placeholder:"Search by ID, title, origin, priority, category, or status...",onInput:ce.filterIncidents,onSearch:ce.performSearch},null,8,["modelValue","onInput","onSearch"])]),(0,i.bF)(pe,{data:re.incidents,columns:re.tableColumns,uniqueKey:"IncidentId",showActions:!0,showPagination:!0,pageSizeOptions:[10,20,50],defaultPageSize:10},{"cell-IncidentTitle":(0,i.k6)(({row:e})=>[(0,i.bF)(ue,{to:`/incident/${e.IncidentId}`,class:"incident-title-link"},{default:(0,i.k6)(()=>[(0,i.eW)((0,o.v_)(e.IncidentTitle),1)]),_:2},1032,["to"])]),"cell-Origin":(0,i.k6)(({row:e})=>[(0,i.eW)((0,o.v_)(e.Origin),1)]),"cell-RiskPriority":(0,i.k6)(({row:e})=>[(0,i.eW)((0,o.v_)(e.RiskPriority),1)]),"cell-Date":(0,i.k6)(({row:e})=>[(0,i.eW)((0,o.v_)(ce.formatDate(e.Date)),1)]),actions:(0,i.k6)(({row:t})=>["Scheduled"===t.Status?((0,i.uX)(),(0,i.CE)("div",k," Mitigated to Risk ")):"Rejected"===t.Status?((0,i.uX)(),(0,i.CE)("div",h,(0,o.v_)("RISK"===t.RejectionSource?"Rejected from Risk":"Rejected as Incident"),1)):"Assigned"===t.Status?((0,i.uX)(),(0,i.CE)("div",g," Assigned ")):"Approved"===t.Status?((0,i.uX)(),(0,i.CE)("div",y," Approved ")):"Active"===t.Status?((0,i.uX)(),(0,i.CE)("div",f," Active ")):"Under Review"===t.Status||"PENDING REVIEW"===t.Status?((0,i.uX)(),(0,i.CE)("div",b," Pending Review ")):"Completed"===t.Status?((0,i.uX)(),(0,i.CE)("div",C," Completed ")):"Closed"===t.Status?((0,i.uX)(),(0,i.CE)("div",L," Closed ")):"Open"!==t.Status&&t.Status&&""!==t.Status.trim()?t.Status&&""!==t.Status.trim()?((0,i.uX)(),(0,i.CE)("div",_,(0,o.v_)(t.Status),1)):(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",w,[(0,i.Lk)("div",E,[e.canAssignIncident()?((0,i.uX)(),(0,i.CE)("button",{key:0,class:"incident-action-icon",onClick:e=>ce.handleDropdownAction("assign",t),title:"Assign as Incident"},a[20]||(a[20]=[(0,i.Lk)("i",{class:"fas fa-user-plus"},null,-1)]),8,R)):(0,i.Q3)("",!0),e.canEscalateIncident()?((0,i.uX)(),(0,i.CE)("button",{key:1,class:"incident-action-icon",onClick:e=>ce.handleDropdownAction("escalate",t),title:"Escalate to Risk"},a[21]||(a[21]=[(0,i.Lk)("i",{class:"fas fa-arrow-up"},null,-1)]),8,D)):(0,i.Q3)("",!0),e.canEditIncident()?((0,i.uX)(),(0,i.CE)("button",{key:2,class:"incident-action-icon",onClick:e=>ce.handleDropdownAction("reject",t),title:"Reject Incident"},a[22]||(a[22]=[(0,i.Lk)("i",{class:"fas fa-times"},null,-1)]),8,I)):(0,i.Q3)("",!0),e.canAssignIncident()||e.canEscalateIncident()||e.canEditIncident()?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("span",P,a[23]||(a[23]=[(0,i.Lk)("i",{class:"fas fa-lock"},null,-1)])))])]))]),_:1},8,["data","columns"])]),re.showModal&&"assign"!==re.modalAction?((0,i.uX)(),(0,i.CE)("div",{key:0,class:"incident-modal-overlay",onClick:a[9]||(a[9]=(...e)=>ce.closeModal&&ce.closeModal(...e))},[(0,i.Lk)("div",{class:"incident-modal-container",onClick:a[8]||(a[8]=(0,s.D$)(()=>{},["stop"]))},[(0,i.Lk)("button",{class:"incident-modal-close-btn",onClick:a[3]||(a[3]=(...e)=>ce.closeModal&&ce.closeModal(...e))},"âœ•"),(0,i.Lk)("div",S,["solve"===re.modalAction?((0,i.uX)(),(0,i.CE)("div",A,[a[24]||(a[24]=(0,i.Lk)("div",{class:"incident-solve-icon"},"ðŸ”„",-1)),a[25]||(a[25]=(0,i.Lk)("h3",{class:"incident-modal-title incident-solve"},"Forwarded to Risk",-1)),a[26]||(a[26]=(0,i.Lk)("p",{class:"incident-modal-subtitle"},"You will be directed to the Risk module",-1)),(0,i.Lk)("div",T,[(0,i.Lk)("button",{onClick:a[4]||(a[4]=(...e)=>ce.confirmSolve&&ce.confirmSolve(...e)),class:"incident-modal-btn incident-confirm-btn"},"Confirm Forward"),(0,i.Lk)("button",{onClick:a[5]||(a[5]=(...e)=>ce.closeModal&&ce.closeModal(...e)),class:"incident-modal-btn incident-cancel-btn"},"Cancel")])])):"reject"===re.modalAction?((0,i.uX)(),(0,i.CE)("div",x,[a[27]||(a[27]=(0,i.Lk)("div",{class:"incident-rejected-icon"},"âœ•",-1)),a[28]||(a[28]=(0,i.Lk)("h3",{class:"incident-modal-title incident-rejected"},"REJECTED",-1)),(0,i.Lk)("div",F,[(0,i.Lk)("button",{onClick:a[6]||(a[6]=(...e)=>ce.confirmReject&&ce.confirmReject(...e)),class:"incident-modal-btn incident-reject-btn"},"Confirm Reject"),(0,i.Lk)("button",{onClick:a[7]||(a[7]=(...e)=>ce.closeModal&&ce.closeModal(...e)),class:"incident-modal-btn incident-cancel-btn"},"Cancel")])])):(0,i.Q3)("",!0)])])])):(0,i.Q3)("",!0),re.showAssignmentWorkflow?((0,i.uX)(),(0,i.CE)("div",V,[(0,i.Lk)("div",M,[(0,i.Lk)("button",{class:"incident-back-btn",onClick:a[10]||(a[10]=(...e)=>ce.closeAssignmentWorkflow&&ce.closeAssignmentWorkflow(...e))},a[29]||(a[29]=[(0,i.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,i.eW)(" Back to Incidents ")]))]),(0,i.Lk)("div",X,[(0,i.Lk)("div",U,[(0,i.Lk)("h3",null,(0,o.v_)(re.selectedIncident.IncidentTitle||"Incident #"+re.selectedIncident.IncidentId),1),(0,i.Lk)("div",N,[(0,i.Lk)("p",null,[a[30]||(a[30]=(0,i.Lk)("strong",null,"ID:",-1)),(0,i.eW)(" "+(0,o.v_)(re.selectedIncident.IncidentId),1)]),(0,i.Lk)("p",null,[a[31]||(a[31]=(0,i.Lk)("strong",null,"Category:",-1)),(0,i.eW)(" "+(0,o.v_)(re.selectedIncident.RiskCategory),1)]),(0,i.Lk)("p",null,[a[32]||(a[32]=(0,i.Lk)("strong",null,"Priority:",-1)),(0,i.eW)(" "+(0,o.v_)(re.selectedIncident.RiskPriority),1)]),(0,i.Lk)("p",null,[a[33]||(a[33]=(0,i.Lk)("strong",null,"Origin:",-1)),(0,i.eW)(" "+(0,o.v_)(re.selectedIncident.Origin),1)])])]),(0,i.Lk)("div",$,[a[38]||(a[38]=(0,i.Lk)("h3",null,"Assignment Details",-1)),(0,i.Lk)("div",O,[(0,i.Lk)("div",j,[a[35]||(a[35]=(0,i.Lk)("label",{for:"assigner"},"Assigner:",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":a[11]||(a[11]=e=>re.selectedAssigner=e),id:"assigner",class:"incident-assign-select",required:""},[a[34]||(a[34]=(0,i.Lk)("option",{value:""},"Select Assigner",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(re.availableUsers,e=>((0,i.uX)(),(0,i.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name)+" ("+(0,o.v_)(e.role)+") ",9,B))),128))],512),[[s.u1,re.selectedAssigner]])]),(0,i.Lk)("div",W,[a[37]||(a[37]=(0,i.Lk)("label",{for:"reviewer"},"Reviewer:",-1)),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":a[12]||(a[12]=e=>re.selectedReviewer=e),id:"reviewer",class:"incident-assign-select",required:""},[a[36]||(a[36]=(0,i.Lk)("option",{value:""},"Select Reviewer",-1)),((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(re.availableUsers,e=>((0,i.uX)(),(0,i.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name)+" ("+(0,o.v_)(e.role)+") ",9,Q))),128))],512),[[s.u1,re.selectedReviewer]])])])]),(0,i.Lk)("div",q,[a[45]||(a[45]=(0,i.Lk)("h3",null,"Mitigation Steps",-1)),re.mitigationSteps.length?((0,i.uX)(),(0,i.CE)("div",K,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(re.mitigationSteps,(e,t)=>((0,i.uX)(),(0,i.CE)("div",{key:t,class:"incident-workflow-step"},[(0,i.Lk)("div",J,(0,o.v_)(t+1),1),(0,i.Lk)("div",z,[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":a=>e.description=a,class:"incident-mitigation-textarea",placeholder:"Enter mitigation step description"},null,8,H),[[s.Jo,e.description]]),(0,i.Lk)("div",Y,[(0,i.Lk)("button",{onClick:e=>ce.removeMitigationStep(t),class:"incident-remove-step-btn"},a[39]||(a[39]=[(0,i.Lk)("i",{class:"fas fa-trash"},null,-1),(0,i.eW)(" Remove ")]),8,G)])])]))),128))])):((0,i.uX)(),(0,i.CE)("div",Z,a[40]||(a[40]=[(0,i.Lk)("p",null,"No mitigation steps found for this incident. Add steps below.",-1)]))),(0,i.Lk)("div",ee,[(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":a[13]||(a[13]=e=>re.newMitigationStep=e),class:"incident-mitigation-textarea",placeholder:"Enter mitigation step(s). Use commas to separate multiple steps (e.g., 'Step 1, Step 2, Step 3')"},null,512),[[s.Jo,re.newMitigationStep]]),(0,i.Lk)("button",{onClick:a[14]||(a[14]=(...e)=>ce.addMitigationStep&&ce.addMitigationStep(...e)),class:"incident-add-step-btn",disabled:!re.newMitigationStep.trim()},a[41]||(a[41]=[(0,i.Lk)("i",{class:"fas fa-plus"},null,-1),(0,i.eW)(" Add Mitigation Step ")]),8,ae)]),(0,i.Lk)("div",te,[a[42]||(a[42]=(0,i.Lk)("h4",null,"Due Date for Mitigation Completion",-1)),(0,i.bo)((0,i.Lk)("input",{type:"date","onUpdate:modelValue":a[15]||(a[15]=e=>re.mitigationDueDate=e),class:"incident-due-date-input",min:ce.getTodayDate()},null,8,ie),[[s.Jo,re.mitigationDueDate]])]),(0,i.Lk)("div",se,[a[43]||(a[43]=(0,i.Lk)("h4",null,"Assignment Notes (Optional)",-1)),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":a[16]||(a[16]=e=>re.assignmentNotes=e),class:"incident-assignment-notes-textarea",placeholder:"Add any specific instructions or notes for the assignees...",rows:"3"},null,512),[[s.Jo,re.assignmentNotes]])]),(0,i.Lk)("div",oe,[(0,i.Lk)("button",{onClick:a[17]||(a[17]=(...e)=>ce.confirmAssignmentWorkflow&&ce.confirmAssignmentWorkflow(...e)),class:"incident-submit-assignment-btn",disabled:!re.selectedAssigner||!re.selectedReviewer||0===re.mitigationSteps.length||!re.mitigationDueDate},a[44]||(a[44]=[(0,i.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,i.eW)(" Assign Incident with Mitigations ")]),8,le)])])])])):(0,i.Q3)("",!0)])}t(4114),t(8111),t(2489),t(116),t(7588),t(1701),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698);var re=t(4373),ce=t(2972),de=t(766),ue=t(9254),pe=t(6567),ve=t(2018),me={name:"IncidentManagement",components:{DynamicTable:pe.A,DynamicSearchBar:ve.A},mixins:[de.r],data(){return{incidents:[],filteredIncidents:[],searchQuery:"",sortField:"",sortOrder:"asc",searchTimeout:null,isLoadingIncidents:!1,currentPage:1,incidentsPerPage:10,showModal:!1,modalAction:"",selectedIncident:null,exportFormat:"xlsx",isExporting:!1,selectedAssigner:"",selectedReviewer:"",assignmentNotes:"",availableUsers:[],showAssignmentWorkflow:!1,mitigationSteps:[],newMitigationStep:"",mitigationDueDate:"",dropdownOpenFor:null,tableColumns:[{key:"IncidentId",label:"ID",sortable:!0,headerClass:"incident-header-cell id-header",cellClass:"incident-table-cell incident-id-cell",width:"50px"},{key:"IncidentTitle",label:"Title",sortable:!0,headerClass:"incident-header-cell title-header",cellClass:"incident-table-cell incident-title-cell",slot:!0,width:"auto"},{key:"Origin",label:"Origin",sortable:!0,headerClass:"incident-header-cell origin-header",cellClass:"incident-table-cell incident-origin-cell",slot:!0,width:"100px"},{key:"RiskPriority",label:"Priority",sortable:!0,headerClass:"incident-header-cell priority-header",cellClass:"incident-table-cell incident-priority-cell",slot:!0,width:"90px"},{key:"Date",label:"Date",sortable:!0,headerClass:"incident-header-cell date-header",cellClass:"incident-table-cell incident-date-cell",slot:!0,width:"90px"}]}},computed:{totalPages(){return Math.ceil(this.filteredIncidents.length/this.incidentsPerPage)},paginatedIncidents(){const e=(this.currentPage-1)*this.incidentsPerPage,a=e+this.incidentsPerPage;return this.filteredIncidents.slice(e,a)},pageNumbers(){const e=[];let a=Math.max(1,this.currentPage-2),t=Math.min(this.totalPages,a+4);t-a<4&&this.totalPages>5&&(a=Math.max(1,t-4));for(let i=a;i<=t;i++)e.push(i);return e}},watch:{incidents:{handler(e){console.log("Incidents array updated. Current statuses:",e.slice(0,5).map(e=>({id:e.IncidentId,status:e.Status})))},deep:!0}},mounted(){console.log("Incident component mounted - fetching incidents from database..."),this.fetchIncidents(),this.fetchUsers(),document.documentElement.style.overflow="auto",document.body.style.overflow="auto",window.addEventListener("resize",this.handleResize),document.addEventListener("click",this.closeAllDropdowns)},beforeUnmount(){window.removeEventListener("resize",this.handleResize),document.removeEventListener("click",this.closeAllDropdowns)},methods:{toggleActionDropdown(e){console.log("Toggle dropdown for incident:",e),console.log("Current dropdownOpenFor:",this.dropdownOpenFor),this.dropdownOpenFor===e?this.dropdownOpenFor=null:this.dropdownOpenFor=e,console.log("New dropdownOpenFor:",this.dropdownOpenFor)},closeAllDropdowns(e){if(e&&e.target){const a=e.target.closest(".action-dropdown-container");if(a)return}console.log("Closing all dropdowns"),this.dropdownOpenFor=null},handleDropdownAction(e,a){console.log("Dropdown action:",e,"for incident:",a.IncidentId),this.logUserAction(`INCIDENT_${e.toUpperCase()}`,"incident",a.IncidentId);let t=!1;switch(e){case"assign":t=this.canAssignIncident();break;case"escalate":t=this.canEscalateIncident();break;case"reject":t=this.canEditIncident();break}if(t)switch(console.log(`âœ… Permission granted for action: ${e}`),this.dropdownOpenFor=null,e){case"assign":this.openAssignModal(a);break;case"escalate":this.openSolveModal(a);break;case"reject":this.openRejectModal(a);break}else{switch(console.warn(`âŒ Permission denied for action: ${e}`),e){case"assign":ue.wr.showIncidentAccessDenied("assign");break;case"escalate":ue.wr.showIncidentAccessDenied("escalate");break;case"reject":ue.wr.showIncidentAccessDenied("edit");break;default:ue.wr.showIncidentAccessDenied("access")}this.dropdownOpenFor=null}},openSolveModal(e){this.selectedIncident=e,this.modalAction="solve",this.showModal=!0},openRejectModal(e){this.selectedIncident=e,this.modalAction="reject",this.showModal=!0},openAssignModal(e){this.selectedIncident=e,this.showAssignmentWorkflow=!0,this.selectedAssigner="",this.selectedReviewer="",this.assignmentNotes="",this.newMitigationStep="",this.mitigationDueDate="",console.log("Selected incident:",e),console.log("Incident Mitigation field:",e.Mitigation),this.loadExistingMitigations(e)},closeModal(){this.showModal=!1,this.selectedIncident=null,this.selectedAssigner="",this.selectedReviewer="",this.assignmentNotes=""},closeAssignmentWorkflow(){this.showAssignmentWorkflow=!1,this.selectedIncident=null,this.selectedAssigner="",this.selectedReviewer="",this.assignmentNotes="",this.mitigationSteps=[],this.newMitigationStep="",this.mitigationDueDate=""},addMitigationStep(){if(!this.newMitigationStep.trim())return;const e=this.newMitigationStep.split(",").filter(e=>e.trim());e.length>1?e.forEach(e=>{this.mitigationSteps.push({description:e.trim(),status:"Not Started"})}):this.mitigationSteps.push({description:this.newMitigationStep.trim(),status:"Not Started"}),this.newMitigationStep=""},removeMitigationStep(e){this.mitigationSteps.splice(e,1)},getTodayDate(){const e=new Date,a=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0");return`${a}-${t}-${i}`},loadExistingMitigations(e){if(this.mitigationSteps=[],e.Mitigation)try{let t=e.Mitigation;if("string"===typeof t&&(t.trim().startsWith("{")||t.trim().startsWith("[")))try{t=JSON.parse(t)}catch(a){console.log("Mitigation data is not JSON, treating as plain text")}if("string"===typeof t){let e=[];const a=t.split("\n").filter(e=>e.trim());if(a.length>1)e=a;else{const a=t.split(",").filter(e=>e.trim());e=a.length>1?a:[t]}this.mitigationSteps=e.map(e=>({description:e.trim(),status:"Not Started"}))}else Array.isArray(t)?this.mitigationSteps=t.map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})):"object"===typeof t&&(this.mitigationSteps=Object.values(t).map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})));console.log("Loaded existing mitigation steps:",this.mitigationSteps)}catch(t){console.error("Error parsing mitigation data:",t),this.mitigationSteps=[{description:e.Mitigation,status:"Not Started"}]}0===this.mitigationSteps.length&&console.log("No existing mitigation steps found")},confirmAssignmentWorkflow(){if(!this.selectedAssigner||!this.selectedReviewer)return void ce.OQ.warning("Please select both assigner and reviewer");if(this.selectedAssigner===this.selectedReviewer)return void ce.OQ.warning("Assigner and reviewer cannot be the same person");if(0===this.mitigationSteps.length)return void ce.OQ.warning("Please add at least one mitigation step");if(!this.mitigationDueDate)return void ce.OQ.warning("Please select a due date");console.log("Assigning incident:",this.selectedIncident.IncidentId);const e=this.availableUsers.find(e=>e.id===this.selectedAssigner),a=this.availableUsers.find(e=>e.id===this.selectedReviewer),t={};this.mitigationSteps.forEach((e,a)=>{t[a+1]=e.description}),re.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/assign/`,{status:"Assigned",assigner_id:this.selectedAssigner,assigner_name:e.name,reviewer_id:this.selectedReviewer,reviewer_name:a.name,assignment_notes:this.assignmentNotes,assigned_date:(new Date).toISOString(),mitigations:t,due_date:this.mitigationDueDate}).then(e=>{console.log("Incident assigned successfully - API response:",e.data);const a=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);a&&(a.Status="Assigned",a.AssignerId=this.selectedAssigner,a.ReviewerId=this.selectedReviewer,console.log("Updated local incident status to Assigned"));const t=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Assigned",t.AssignerId=this.selectedAssigner,t.ReviewerId=this.selectedReviewer),this.fetchIncidents(),ce.OQ.success("Incident assigned successfully with mitigation steps!"),this.closeAssignmentWorkflow()}).catch(e=>{console.error("Error assigning incident:",e),ue.wr.handleApiError(e,"assign incidents")||ce.OQ.error("Failed to assign incident. Please try again.")})},confirmSolve(){console.log("Escalating incident to risk:",this.selectedIncident.IncidentId),re.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/status/`,{status:"Scheduled"}).then(e=>{console.log("Incident escalated to risk - API response:",e.data),ce.OQ.success(`Incident #${this.selectedIncident.IncidentId} has been successfully escalated to Risk Management for further evaluation and mitigation.`);const a=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);a&&(a.Status="Scheduled",console.log("Updated local incident status to Scheduled"));const t=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Scheduled"),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},2e3)}).catch(e=>{console.error("Error updating incident status:",e),ue.wr.handleApiError(e,"escalate incidents")||ce.OQ.error("Failed to escalate incident. Please try again.")})},confirmReject(){console.log("Rejecting incident:",this.selectedIncident.IncidentId),re.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/status/`,{status:"Rejected",rejection_source:"INCIDENT"}).then(e=>{console.log("Incident rejected - API response:",e.data);const a=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);a&&(a.Status="Rejected",a.RejectionSource="INCIDENT",console.log("Updated local incident status to Rejected"));const t=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Rejected",t.RejectionSource="INCIDENT"),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},2e3)}).catch(e=>{console.error("Error updating incident status:",e),ue.wr.handleApiError(e,"reject incidents")||ce.OQ.error("Failed to reject incident. Please try again.")})},confirmAssign(){if(!this.selectedAssigner||!this.selectedReviewer)return void ce.OQ.warning("Please select both assigner and reviewer");if(this.selectedAssigner===this.selectedReviewer)return void ce.OQ.warning("Assigner and reviewer cannot be the same person");const e=this.availableUsers.find(e=>e.id===this.selectedAssigner),a=this.availableUsers.find(e=>e.id===this.selectedReviewer);re.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/assign/`,{status:"Assigned",assigner_id:this.selectedAssigner,assigner_name:e.name,reviewer_id:this.selectedReviewer,reviewer_name:a.name,assignment_notes:this.assignmentNotes,assigned_date:(new Date).toISOString()}).then(e=>{console.log("Incident assigned successfully:",e.data),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},1500)}).catch(e=>{console.error("Error assigning incident:",e),ue.wr.handleApiError(e,"assign incidents")||ce.OQ.error("Failed to assign incident. Please try again.")})},getRiskCategoryClass(e){if(!e)return"";const a=e.toLowerCase();return a.includes("security")?"category-security":a.includes("compliance")?"category-compliance":a.includes("operational")?"category-operational":a.includes("financial")?"category-financial":a.includes("strategic")?"category-strategic":"category-other"},changePage(e){if(e>=1&&e<=this.totalPages){this.currentPage=e;const a=document.querySelector(".incident-list-wrapper");a&&(a.scrollTop=0,window.scrollTo({top:a.offsetTop,behavior:"smooth"}))}},getStatusClass(e){const a=e?.toLowerCase()||"";return"high"===a?"status-active":"medium"===a?"status-medium":"low"===a?"status-inactive":"status-default"},getOriginClass(e){const a=e?.toLowerCase()||"";return a.includes("manual")?"incident-origin-manual":a.includes("audit")?"incident-origin-audit":a.includes("siem")?"incident-origin-siem":"incident-origin-other"},async fetchIncidents(){try{this.isLoadingIncidents=!0;const e={};this.searchQuery.trim()&&(e.search=this.searchQuery.trim(),console.log("Adding search parameter:",e.search)),this.sortField&&(e.sort_field=this.sortField,e.sort_order=this.sortOrder,console.log("Adding sort parameters:",e.sort_field,e.sort_order)),console.log("Fetching incidents with params:",e),console.log("API URL:","http://localhost:8000/api/incident-incidents/");const a=await re.A.get("http://localhost:8000/api/incident-incidents/",{params:e});console.log("Response received:",a),console.log("Response data length:",a.data.length),this.incidents=a.data,this.filteredIncidents=[...this.incidents],console.log("Fetched incidents:",this.incidents),console.log("Sample incident statuses:",this.incidents.slice(0,3).map(e=>({id:e.IncidentId,status:e.Status})));const t=[...new Set(this.incidents.map(e=>e.Status).filter(e=>e))];console.log("All unique status values found:",t),this.currentPage=1,this.$nextTick(()=>{this.handleResize()})}catch(e){console.error("Failed to fetch incidents:",e),console.error("Error details:",e.response),ue.wr.handleApiError(e,"view incidents")||ce.OQ.error("Failed to load incidents. Please try again.")}finally{this.isLoadingIncidents=!1}},async fetchUsers(){try{const e=await re.A.get("http://localhost:8000/api/incidents-users/");this.availableUsers=e.data.map(e=>({id:e.UserId,name:e.UserName,role:e.role})),console.log("Fetched users:",this.availableUsers)}catch(e){console.error("Failed to fetch users:",e),ue.wr.handleApiError(e,"view users")||ce.OQ.error("Failed to load users. Please try again."),this.availableUsers=[]}},filterIncidents(){console.log("filterIncidents called with searchQuery:",this.searchQuery),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{console.log("Debounce timeout reached, calling performSearch"),this.performSearch()},300)},performSearch(){console.log("performSearch called"),this.fetchIncidents()},clearSearch(){console.log("Clear search clicked"),this.searchQuery="",this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.fetchIncidents()},setSortField(e){this.sortField===e?this.toggleSortOrder():(this.sortField=e,this.sortOrder="asc"),this.fetchIncidents()},sortIncidents(){this.fetchIncidents()},toggleSortOrder(){this.sortOrder="asc"===this.sortOrder?"desc":"asc",this.fetchIncidents()},handleResize(){const e=document.querySelector(".incident-list-wrapper");e&&(e.style.maxWidth="100%")},getPriorityClass(e){switch(e?.toLowerCase()){case"high":return"incident-priority-high";case"medium":return"incident-priority-medium";case"low":return"incident-priority-low";default:return""}},formatDate(e){if(!e)return"";const[a,t,i]=e.split("-");return`${t}/${i}/${a}`},closeIncidentDetails(){this.selectedIncident=null,this.showIncidentDetails=!1},exportIncidents(){console.log("Exporting incidents..."),this.isExporting=!0;const e=this.searchQuery?this.filteredIncidents:this.incidents,a=e.map(e=>({IncidentId:e.IncidentId,IncidentTitle:e.IncidentTitle,Date:e.Date,RiskPriority:e.RiskPriority,Origin:e.Origin,Status:e.Status}));re.A.post("http://localhost:8000/api/incidents/export/",{file_format:this.exportFormat,data:JSON.stringify(a),options:JSON.stringify({filters:{searchQuery:this.searchQuery,sortField:this.sortField,sortOrder:this.sortOrder}})}).then(e=>{if(console.log("Export successful:",e.data),e.data&&e.data.file_url){const a=document.createElement("a");a.href=e.data.file_url,a.setAttribute("download",e.data.file_name||`incidents.${this.exportFormat}`),document.body.appendChild(a),a.click(),document.body.removeChild(a)}this.isExporting=!1,ce.OQ.success("Export completed successfully")}).catch(e=>{console.error("Export failed:",e),ue.wr.handleApiError(e,"export incidents")||ce.OQ.error("Export failed. Please try again."),this.isExporting=!1})}}},ke=t(1241);const he=(0,ke.A)(me,[["render",ne]]);var ge=he},9254:function(e,a,t){t.d(a,{G4:function(){return s},wr:function(){return o}});var i=t(2351);const s={setUserSession(e){console.log("[SESSION_UTILS] Setting user session:",e),e.user_id&&localStorage.setItem("user_id",e.user_id.toString()),e.email&&localStorage.setItem("user_email",e.email),e.name&&localStorage.setItem("user_name",e.name),localStorage.setItem("is_logged_in","true")},getUserSession(){return{user_id:localStorage.getItem("user_id"),email:localStorage.getItem("user_email"),name:localStorage.getItem("user_name"),is_logged_in:"true"===localStorage.getItem("is_logged_in")}},clearUserSession(){console.log("[SESSION_UTILS] Clearing user session"),localStorage.removeItem("user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_name"),localStorage.removeItem("is_logged_in")},isLoggedIn(){return"true"===localStorage.getItem("is_logged_in")},getUserId(){return localStorage.getItem("user_id")}},o={showAccessDenied(e="this feature",a=null,t=null){console.log("[ACCESS_UTILS] showAccessDenied called:",{feature:e,customMessage:a,hasCallback:!!t});const s=`You don't have permission to access ${e}. Please contact your administrator to activate this feature.`,o=a||s;console.log("[ACCESS_UTILS] Calling PopupService.accessDenied with message:",o);try{i.O.accessDenied(o,"Access Denied",t||this.defaultContactAdmin),console.log("[ACCESS_UTILS] PopupService.accessDenied called successfully")}catch(l){console.error("[ACCESS_UTILS] Error calling PopupService.accessDenied:",l)}},showRiskAccessDenied(e="access",a=null){console.log("[ACCESS_UTILS] showRiskAccessDenied called:",{operation:e,hasCallback:!!a});const t={create:"create new risks",edit:"edit risks",view:"view risks",delete:"delete risks",approve:"approve risks",assign:"assign risks",analytics:"view risk analytics",access:"access the risk module"}[e]||e,s=`You don't have permission to ${t}. Please contact your administrator to request access to this feature.`;console.log("[ACCESS_UTILS] Calling PopupService.accessDenied with risk message:",s);try{i.O.accessDenied(s,"Risk Access Denied",a||this.defaultContactAdmin),console.log("[ACCESS_UTILS] Risk access denied popup called successfully")}catch(o){console.error("[ACCESS_UTILS] Error calling risk access denied popup:",o)}},showComplianceAccessDenied(e="access",a=null){console.log("[ACCESS_UTILS] showComplianceAccessDenied called:",{operation:e});const t={create:{feature:"CreateCompliance",text:"create compliance items"},clone:{feature:"CreateCompliance",text:"clone compliance items"},edit:{feature:"EditCompliance",text:"edit compliance items"},toggle:{feature:"EditCompliance",text:"toggle compliance status"},deactivate:{feature:"EditCompliance",text:"deactivate compliance items"},delete:{feature:"EditCompliance",text:"delete compliance items"},assign:{feature:"EditCompliance",text:"assign compliance items"},category:{feature:"EditCompliance",text:"manage compliance categories"},"business-unit":{feature:"EditCompliance",text:"manage compliance business units"},approve:{feature:"ApproveCompliance",text:"approve compliance items"},review:{feature:"ApproveCompliance",text:"review compliance items"},view:{feature:"ViewAllCompliance",text:"view compliance items"},dashboard:{feature:"ViewAllCompliance",text:"access the compliance dashboard"},versioning:{feature:"ViewAllCompliance",text:"view compliance versioning"},audit:{feature:"ViewAllCompliance",text:"view compliance audit information"},framework:{feature:"ViewAllCompliance",text:"access compliance frameworks"},policy:{feature:"ViewAllCompliance",text:"access compliance policies"},subpolicy:{feature:"ViewAllCompliance",text:"access compliance subpolicies"},notification:{feature:"ViewAllCompliance",text:"view compliance notifications"},export:{feature:"ViewAllCompliance",text:"export compliance data"},access:{feature:"ViewAllCompliance",text:"access the compliance module"},analytics:{feature:"CompliancePerformanceAnalytics",text:"view compliance analytics"},kpi:{feature:"CompliancePerformanceAnalytics",text:"view compliance KPIs"}},s=t[e]||{feature:"ViewAllCompliance",text:e},o=`You don't have permission to ${s.text}. Please contact your administrator to request the "${s.feature}" permission.`;i.O.accessDenied(o,"Compliance Access Denied",a||this.defaultContactAdmin)},showComplianceFeatureDenied(e,a=null){console.log("[ACCESS_UTILS] showComplianceFeatureDenied called:",{feature:e});const t={CreateCompliance:"create compliance items",EditCompliance:"edit compliance items",ApproveCompliance:"approve compliance items",ViewAllCompliance:"view compliance information",CompliancePerformanceAnalytics:"view compliance performance analytics"},s=t[e]||"access this compliance feature",o=`You don't have permission to ${s}. Please contact your administrator to request the "${e}" permission.`;i.O.accessDenied(o,"Compliance Access Denied",a||this.defaultContactAdmin)},showComplianceViewDenied(e=null){this.showComplianceAccessDenied("view",e)},showComplianceDashboardDenied(e=null){this.showComplianceAccessDenied("dashboard",e)},showComplianceVersioningDenied(e=null){this.showComplianceAccessDenied("versioning",e)},showComplianceCreateDenied(e=null){this.showComplianceAccessDenied("create",e)},showComplianceCloneDenied(e=null){this.showComplianceAccessDenied("clone",e)},showComplianceEditDenied(e=null){this.showComplianceAccessDenied("edit",e)},showComplianceToggleDenied(e=null){this.showComplianceAccessDenied("toggle",e)},showComplianceDeactivateDenied(e=null){this.showComplianceAccessDenied("deactivate",e)},showComplianceApproveDenied(e=null){this.showComplianceAccessDenied("approve",e)},showComplianceReviewDenied(e=null){this.showComplianceAccessDenied("review",e)},showComplianceAnalyticsDenied(e=null){this.showComplianceAccessDenied("analytics",e)},showComplianceKPIDenied(e=null){this.showComplianceAccessDenied("kpi",e)},showCompliancePerformanceAnalyticsDenied(e=null){this.showComplianceAccessDenied("analytics",e)},showCreateComplianceDenied(e=null){this.showComplianceAccessDenied("create",e)},showEditComplianceDenied(e=null){this.showComplianceAccessDenied("edit",e)},showApproveComplianceDenied(e=null){this.showComplianceAccessDenied("approve",e)},showViewAllComplianceDenied(e=null){this.showComplianceAccessDenied("view",e)},showComplianceExportDenied(e=null){this.showComplianceAccessDenied("export",e)},showComplianceAuditDenied(e=null){this.showComplianceAccessDenied("audit",e)},showComplianceFrameworkDenied(e=null){this.showComplianceAccessDenied("framework",e)},showCompliancePolicyDenied(e=null){this.showComplianceAccessDenied("policy",e)},showComplianceSubpolicyDenied(e=null){this.showComplianceAccessDenied("subpolicy",e)},showComplianceCategoryDenied(e=null){this.showComplianceAccessDenied("category",e)},showComplianceBusinessUnitDenied(e=null){this.showComplianceAccessDenied("business-unit",e)},showComplianceNotificationDenied(e=null){this.showComplianceAccessDenied("notification",e)},showComplianceAssignDenied(e=null){this.showComplianceAccessDenied("assign",e)},showComplianceDeleteDenied(e=null){this.showComplianceAccessDenied("delete",e)},showIncidentAccessDenied(e="access",a=null){console.log("[ACCESS_UTILS] showIncidentAccessDenied called:",{operation:e});const t={create:"create incidents",edit:"edit incidents",view:"view incidents",delete:"delete incidents",assign:"assign incidents",escalate:"escalate incidents",analytics:"view incident analytics",access:"access the incident module"}[e]||e,s=`You don't have permission to ${t}. Please contact your administrator to request access to this feature.`;i.O.accessDenied(s,"Incident Access Denied",a||this.defaultContactAdmin)},defaultContactAdmin(){console.log("[ACCESS_UTILS] defaultContactAdmin callback triggered"),console.log("Contact admin action triggered");try{i.O.info("Please contact your system administrator via email or support ticket to request access to this feature.","Contact Administrator")}catch(e){console.error("[ACCESS_UTILS] Error showing contact admin popup:",e)}},handleApiError(e,a="this feature"){if(console.log("[ACCESS_UTILS] handleApiError called:",{error:e?.response?.status,defaultFeature:a,errorResponse:e?.response?.data}),e.response&&[401,403].includes(e.response.status)){console.log("[ACCESS_UTILS] Detected 401/403 error, showing access denied popup");const t=e.response.data?.message||e.response.data?.detail;return t?(console.log("[ACCESS_UTILS] Using custom error message:",t),this.showAccessDenied(a,t)):(console.log("[ACCESS_UTILS] Using default access denied message for:",a),this.showAccessDenied(a)),!0}return console.log("[ACCESS_UTILS] Not an access error, status:",e?.response?.status),!1},handleApiErrorByUrl(e,a){if(console.log("[ACCESS_UTILS] handleApiErrorByUrl called:",{status:e?.response?.status,url:a,method:e?.config?.method?.toUpperCase()}),!e.response||![401,403].includes(e.response.status))return console.log("[ACCESS_UTILS] Not an access error, ignoring"),!1;const t=e?.config?.method?.toUpperCase()||"GET";return a.includes("/api/risks/")?(console.log("[ACCESS_UTILS] Risk API access denied detected"),"POST"===t?this.showRiskAccessDenied("create"):"PUT"===t||"PATCH"===t?this.showRiskAccessDenied("edit"):"DELETE"===t?this.showRiskAccessDenied("delete"):this.showRiskAccessDenied("view"),!0):a.includes("/api/risk-instances/")?(console.log("[ACCESS_UTILS] Risk instances API access denied detected"),"POST"===t?this.showRiskAccessDenied("create"):"PUT"===t||"PATCH"===t?this.showRiskAccessDenied("edit"):this.showRiskAccessDenied("view"),!0):a.includes("/api/risk/metrics")||a.includes("/api/risk/analytics")?(console.log("[ACCESS_UTILS] Risk analytics API access denied detected"),this.showRiskAccessDenied("analytics"),!0):a.includes("/api/compliance/")?(console.log("[ACCESS_UTILS] Compliance API access denied detected"),"POST"===t?this.showComplianceAccessDenied("create"):"PUT"===t||"PATCH"===t?this.showComplianceAccessDenied("edit"):this.showComplianceAccessDenied("view"),!0):a.includes("/api/incidents/")?(console.log("[ACCESS_UTILS] Incident API access denied detected"),"POST"===t?this.showIncidentAccessDenied("create"):"PUT"===t||"PATCH"===t?this.showIncidentAccessDenied("edit"):this.showIncidentAccessDenied("view"),!0):(console.log("[ACCESS_UTILS] Generic API access denied detected for URL:",a),this.showAccessDenied("this feature"),!0)}};a.Ay=o}},a={};function t(i){var s=a[i];if(void 0!==s)return s.exports;var o=a[i]={exports:{}};return e[i].call(o.exports,o,o.exports,t),o.exports}t.m=e,function(){var e=[];t.O=function(a,i,s,o){if(!i){var l=1/0;for(d=0;d<e.length;d++){i=e[d][0],s=e[d][1],o=e[d][2];for(var n=!0,r=0;r<i.length;r++)(!1&o||l>=o)&&Object.keys(t.O).every(function(e){return t.O[e](i[r])})?i.splice(r--,1):(n=!1,o<l&&(l=o));if(n){e.splice(d--,1);var c=s();void 0!==c&&(a=c)}}return a}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[i,s,o]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var i in a)t.o(a,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:a[i]})}}(),function(){t.f={},t.e=function(e){return Promise.all(Object.keys(t.f).reduce(function(a,i){return t.f[i](e,a),a},[]))}}(),function(){t.u=function(e){return"js/"+e+".014d6fd0.js"}}(),function(){t.miniCssF=function(e){return"css/"+e+".76b64d25.css"}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){var e={},a="frontend:";t.l=function(i,s,o,l){if(e[i])e[i].push(s);else{var n,r;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==i||u.getAttribute("data-webpack")==a+o){n=u;break}}n||(r=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,t.nc&&n.setAttribute("nonce",t.nc),n.setAttribute("data-webpack",a+o),n.src=i),e[i]=[s];var p=function(a,t){n.onerror=n.onload=null,clearTimeout(v);var s=e[i];if(delete e[i],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach(function(e){return e(t)}),a)return a(t)},v=setTimeout(p.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=p.bind(null,n.onerror),n.onload=p.bind(null,n.onload),r&&document.head.appendChild(n)}}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,a,i,s,o){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css",t.nc&&(l.nonce=t.nc);var n=function(t){if(l.onerror=l.onload=null,"load"===t.type)s();else{var i=t&&t.type,n=t&&t.target&&t.target.href||a,r=new Error("Loading CSS chunk "+e+" failed.\n("+i+": "+n+")");r.name="ChunkLoadError",r.code="CSS_CHUNK_LOAD_FAILED",r.type=i,r.request=n,l.parentNode&&l.parentNode.removeChild(l),o(r)}};return l.onerror=l.onload=n,l.href=a,i?i.parentNode.insertBefore(l,i.nextSibling):document.head.appendChild(l),l},a=function(e,a){for(var t=document.getElementsByTagName("link"),i=0;i<t.length;i++){var s=t[i],o=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===a))return s}var l=document.getElementsByTagName("style");for(i=0;i<l.length;i++){s=l[i],o=s.getAttribute("data-href");if(o===e||o===a)return s}},i=function(i){return new Promise(function(s,o){var l=t.miniCssF(i),n=t.p+l;if(a(l,n))return s();e(i,n,null,s,o)})},s={524:0};t.f.miniCss=function(e,a){var t={551:1};s[e]?a.push(s[e]):0!==s[e]&&t[e]&&a.push(s[e]=i(e).then(function(){s[e]=0},function(a){throw delete s[e],a}))}}}(),function(){var e={524:0};t.f.j=function(a,i){var s=t.o(e,a)?e[a]:void 0;if(0!==s)if(s)i.push(s[2]);else{var o=new Promise(function(t,i){s=e[a]=[t,i]});i.push(s[2]=o);var l=t.p+t.u(a),n=new Error,r=function(i){if(t.o(e,a)&&(s=e[a],0!==s&&(e[a]=void 0),s)){var o=i&&("load"===i.type?"missing":i.type),l=i&&i.target&&i.target.src;n.message="Loading chunk "+a+" failed.\n("+o+": "+l+")",n.name="ChunkLoadError",n.type=o,n.request=l,s[1](n)}};t.l(l,r,"chunk-"+a,a)}},t.O.j=function(a){return 0===e[a]};var a=function(a,i){var s,o,l=i[0],n=i[1],r=i[2],c=0;if(l.some(function(a){return 0!==e[a]})){for(s in n)t.o(n,s)&&(t.m[s]=n[s]);if(r)var d=r(t)}for(a&&a(i);c<l.length;c++)o=l[c],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(d)},i=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];i.forEach(a.bind(null,0)),i.push=a.bind(null,i.push.bind(i))}();var i=t.O(void 0,[504],function(){return t(3983)});i=t.O(i)})();
//# sourceMappingURL=app.fcbde3db.js.map
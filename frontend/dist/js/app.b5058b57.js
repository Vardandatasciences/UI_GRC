(function(){"use strict";var e={16:function(e,t,i){i.d(t,{A:function(){return f}});var a=i(6768),s=i(5130),o=i(4232);const l={key:0,class:"popup-icon"},n=["innerHTML"],r={class:"popup-heading"},c={class:"popup-message"},d=["placeholder"],u={class:"popup-actions"},p=["onClick"];function m(e,t,i,m,v,k){return k.visible?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"popup-backdrop",onKeydown:t[2]||(t[2]=(0,s.jR)((...e)=>k.onClose&&k.onClose(...e),["esc"])),tabindex:"0","aria-modal":"true",role:"dialog"},[(0,a.Lk)("div",{class:(0,o.C4)(["popup-modal",k.type])},[k.icon?((0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("span",{innerHTML:k.icon},null,8,n)])):(0,a.Q3)("",!0),(0,a.Lk)("h2",r,(0,o.v_)(k.heading),1),(0,a.Lk)("p",c,(0,o.v_)(k.message),1),"comment"===k.type?(0,a.bo)(((0,a.uX)(),(0,a.CE)("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=e=>v.comment=e),class:"popup-input",placeholder:k.inputPlaceholder,onKeydown:t[1]||(t[1]=(0,s.jR)((0,s.D$)(()=>{},["stop"]),["enter"]))},null,40,d)),[[s.Jo,v.comment]]):(0,a.Q3)("",!0),(0,a.Lk)("div",u,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.buttons,(e,t)=>((0,a.uX)(),(0,a.CE)("button",{key:t,onClick:t=>m.onAction(e.action),class:(0,o.C4)(e.class)},(0,o.v_)(e.label),11,p))),128))])],2)],32)):(0,a.Q3)("",!0)}var v=i(2351);const k={success:"✓",error:"✗",warning:"⚠️",info:"ℹ️",confirm:"❓",comment:"💬","access-denied":"🚫"};var h={name:"PopupModal",setup(){const e=v.O.getState(),t=(e,t)=>{v.O.handleAction({action:e,comment:t})};return{popupState:e,onAction:t}},computed:{visible(){return this.popupState.visible},type(){return this.popupState.type},heading(){return this.popupState.heading},message(){return this.popupState.message},buttons(){return this.popupState.buttons},autoClose(){return this.popupState.autoClose},inputPlaceholder(){return this.popupState.inputPlaceholder},icon(){return k[this.type]||""}},watch:{visible(e){e&&this.autoClose>0&&setTimeout(()=>this.onAction("auto-close"),this.autoClose),e&&(this.comment="")}},data(){return{comment:""}},methods:{onClose(){this.onAction("close")}}},g=i(1241);const y=(0,g.A)(h,[["render",m],["__scopeId","data-v-0911b198"]]);var f=y},766:function(e,t,i){i.d(t,{r:function(){return s}});i(4114);var a=i(6604);const s={data(){return{userPermissions:{},userRole:null,userDepartment:null,userEntity:null,userId:null,userEmail:null,permissionsLoaded:!1,permissionsError:null,isAuthenticated:!1}},async created(){console.log("🔐 Permission Mixin: Checking authentication status..."),await this.checkAuthenticationStatus()},methods:{async checkAuthenticationStatus(){try{console.log("🔐 Permission Mixin: Checking authentication...");const e=await a.m8.checkAuthStatus();this.isAuthenticated=e.is_authenticated||!1,this.isAuthenticated?(console.log("🔐 Permission Mixin: User is authenticated, loading permissions..."),await this.loadUserPermissions()):(console.log("🔐 Permission Mixin: User not authenticated, using default permissions"),this.setDefaultPermissions())}catch(e){console.error("❌ Permission Mixin: Error checking authentication:",e),this.isAuthenticated=!1,this.setDefaultPermissions()}},async loadUserPermissions(){try{console.log("🔐 Permission Mixin: Fetching permissions from API...");const e=await a.m8.getUserPermissions();if("User not authenticated"===e.message)return console.log("🔐 Permission Mixin: User not authenticated, using default permissions"),this.isAuthenticated=!1,void this.setDefaultPermissions();this.userPermissions=e.permissions||{},this.userRole=e.role,this.userDepartment=e.department,this.userEntity=e.entity,this.userId=e.user_id,this.userEmail=e.email,this.permissionsLoaded=!0,this.isAuthenticated=!0,this.permissionsError=null,console.log("🔐 Permission Mixin: Permissions loaded successfully"),console.log("   👤 User ID:",this.userId),console.log("   👤 User Role:",this.userRole),console.log("   📧 Email:",this.userEmail),console.log("   🏢 Department:",this.userDepartment),console.log("   🏭 Entity:",this.userEntity),console.log("   🔑 Permissions:",this.userPermissions)}catch(e){console.error("❌ Permission Mixin: Error loading permissions:",e),this.permissionsError=e.message||"Failed to load permissions",this.isAuthenticated=!1,this.setDefaultPermissions()}},setDefaultPermissions(){this.userPermissions={incident:{create:!1,edit:!1,view:!1,assign:!1,approve:!1,delete:!1},audit:{view:!1,conduct:!1,review:!1,assign:!1,analytics:!1}},this.userRole=null,this.userDepartment=null,this.userEntity=null,this.userId=null,this.userEmail=null,this.permissionsLoaded=!0,console.log("🔐 Permission Mixin: Default permissions set")},async reloadPermissions(){console.log("🔐 Permission Mixin: Manually reloading permissions..."),this.permissionsLoaded=!1,this.permissionsError=null,await this.checkAuthenticationStatus()},hasPermission(e,t){const i=this.userPermissions[e]?.[t]||!1;return console.log(`🔐 Permission Check: ${e}.${t} = ${i?"✅ ALLOWED":"❌ DENIED"}`),i},canCreateIncident(){return this.hasPermission("incident","create")},canEditIncident(){return this.hasPermission("incident","edit")},canViewIncident(){return this.hasPermission("incident","view")},canAssignIncident(){return this.hasPermission("incident","assign")},canEscalateIncident(){return this.hasPermission("incident","escalate")},canViewIncidentAnalytics(){return this.hasPermission("incident","analytics")},canViewAudit(){return this.hasPermission("audit","view")},canConductAudit(){return this.hasPermission("audit","conduct")},canReviewAudit(){return this.hasPermission("audit","review")},canAssignAudit(){return this.hasPermission("audit","assign")},canViewAuditAnalytics(){return this.hasPermission("audit","analytics")},canViewAnalytics(){return this.canViewIncidentAnalytics()||this.canViewAuditAnalytics()},logUserAction(e,t=null,i=null){console.log("🎯 User Action Logged:"),console.log("   👤 User Role:",this.userRole),console.log("   🏢 Department:",this.userDepartment),console.log("   🏭 Entity:",this.userEntity),console.log("   🎯 Action:",e),console.log("   📊 Resource:",t,i),console.log("   ⏰ Timestamp:",(new Date).toISOString())},hasAnyPermissions(){if(!this.permissionsLoaded)return!1;for(const e in this.userPermissions)for(const t in this.userPermissions[e])if(this.userPermissions[e][t])return!0;return!1},getAllowedActions(){const e=[];for(const t in this.userPermissions)for(const i in this.userPermissions[t])this.userPermissions[t][i]&&e.push(`${t}.${i}`);return console.log("🔑 User Allowed Actions:",e),e}},computed:{permissionStatus(){return{loaded:this.permissionsLoaded,error:this.permissionsError,authenticated:this.isAuthenticated,hasPermissions:this.hasAnyPermissions(),userId:this.userId,email:this.userEmail,role:this.userRole,department:this.userDepartment,entity:this.userEntity}}}}},2018:function(e,t,i){i.d(t,{A:function(){return u}});var a=i(6768),s=i(5130);const o={class:"dynamic-search-bar"},l=["placeholder"];function n(e,t,i,n,r,c){return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.bo)((0,a.Lk)("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>r.inputValue=e),placeholder:i.placeholder,class:"dynamic-search-input",onInput:t[1]||(t[1]=(...e)=>c.onInput&&c.onInput(...e)),onKeyup:t[2]||(t[2]=(0,s.jR)((...e)=>c.onEnter&&c.onEnter(...e),["enter"]))},null,40,l),[[s.Jo,r.inputValue]]),r.inputValue?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"clear-btn",onClick:t[3]||(t[3]=(...e)=>c.clearInput&&c.clearInput(...e))},"✕")):(0,a.Q3)("",!0)])}var r={name:"DynamicSearchBar",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:"Search..."}},data(){return{inputValue:this.modelValue}},watch:{modelValue(e){this.inputValue=e}},methods:{onInput(){this.$emit("update:modelValue",this.inputValue),this.$emit("input",this.inputValue)},onEnter(){this.$emit("search",this.inputValue)},clearInput(){this.inputValue="",this.onInput()}}},c=i(1241);const d=(0,c.A)(r,[["render",n],["__scopeId","data-v-0f33b442"]]);var u=d},2351:function(e,t,i){i.d(t,{O:function(){return l}});var a=i(144);const s=(0,a.KR)({visible:!1,type:"info",heading:"",message:"",buttons:[],autoClose:0,inputPlaceholder:"Enter your comment..."}),o=(0,a.KR)(new Map),l={show(e){console.log("[POPUP_SERVICE] show() called with config:",e),console.log("[POPUP_SERVICE] Current popup state before update:",s.value),s.value={...s.value,...e,visible:!0},console.log("[POPUP_SERVICE] Popup state updated:",s.value),console.log("[POPUP_SERVICE] Popup should now be visible:",s.value.visible)},hide(){s.value.visible=!1},getState(){return s},handleAction({action:e,comment:t}){const i=o.value.get(e);i&&(i(t),o.value.delete(e)),this.hide()},onAction(e,t){o.value.set(e,t)},info(e,t="Information"){this.show({type:"info",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"info"}]})},success(e,t="Success"){this.show({type:"success",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"success"}]})},error(e,t="Error"){this.show({type:"error",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"error"}]})},warning(e,t="Warning"){this.show({type:"warning",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"warning"}]})},confirm(e,t="Confirm",i,a){this.show({type:"confirm",heading:t,message:e,buttons:[{label:"Yes",action:"yes",class:"success"},{label:"No",action:"no",class:"error"}]}),i&&this.onAction("yes",i),a&&this.onAction("no",a)},comment(e,t="Comment",i){this.show({type:"comment",heading:t,message:e,buttons:[{label:"Submit",action:"submit",class:"success"},{label:"Cancel",action:"cancel",class:"error"}]}),i&&this.onAction("submit",i)},accessDenied(e="You don't have permission to access this feature. Please contact your administrator to activate this feature.",t="Access Denied",i){console.log("[POPUP_SERVICE] accessDenied called with:",{message:e,heading:t,hasCallback:!!i});const a={type:"access-denied",heading:t,message:e,buttons:[{label:"Contact Admin",action:"contact-admin",class:"warning"},{label:"OK",action:"ok",class:"error"}]};console.log("[POPUP_SERVICE] Popup config created:",a);try{this.show(a),console.log("[POPUP_SERVICE] show() method called successfully"),console.log("[POPUP_SERVICE] Current popup state after show():",s.value),i&&(this.onAction("contact-admin",i),console.log("[POPUP_SERVICE] Contact admin callback registered"))}catch(o){console.error("[POPUP_SERVICE] Error in accessDenied method:",o)}}};t.A=l},2545:function(e,t,i){i.d(t,{A:function(){return f}});var a=i(6768),s=i(4232),o=i(5130);const l={class:"dropdown-container"},n={class:"text-content"},r={class:"dropdown-label"},c={class:"dropdown-value"},d={key:0,class:"dropdown-menu"},u=["onClick"],p={key:1,class:"dropdown-no-results"};function m(e,t,i,m,v,k){const h=(0,a.g2)("PhCalendar"),g=(0,a.g2)("PhCaretDown");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("button",{class:"filter-btn",onClick:t[0]||(t[0]=(...e)=>k.toggleDropdown&&k.toggleDropdown(...e))},[k.showCalendarIcon?((0,a.uX)(),(0,a.Wv)(h,{key:0,size:16})):(0,a.Q3)("",!0),(0,a.Lk)("span",n,[(0,a.Lk)("span",r,(0,s.v_)(i.config.label||i.config.name)+": ",1),(0,a.Lk)("span",c,(0,s.v_)(k.selectedLabel),1)]),(0,a.bF)(g,{size:16})]),v.isOpen?((0,a.uX)(),(0,a.CE)("div",d,[i.showSearchBar?(0,a.bo)(((0,a.uX)(),(0,a.CE)("input",{key:0,"onUpdate:modelValue":t[1]||(t[1]=e=>v.searchQuery=e),type:"text",class:"dropdown-search",placeholder:"Search...",onClick:t[2]||(t[2]=(0,o.D$)(()=>{},["stop"]))},null,512)),[[o.Jo,v.searchQuery]]):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.filteredOptions,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.value,class:"dropdown-item",onClick:t=>k.selectOption(e)},(0,s.v_)(e.label),9,u))),128)),0===k.filteredOptions.length?((0,a.uX)(),(0,a.CE)("div",p," No results found ")):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0)])}i(8111),i(2489),i(116);var v=i(3425),k=i(4672),h={name:"CustomDropdown",components:{PhCalendar:v.A,PhCaretDown:k.A},props:{config:{type:Object,required:!0},modelValue:{type:String,default:""},showSearchBar:{type:Boolean,default:!0}},data(){return{isOpen:!1,searchQuery:""}},computed:{selectedLabel(){const e=this.config.values||this.config.options||[],t=e.find(e=>e.value===this.modelValue);return t?t.label:this.config.defaultValue||this.config.defaultLabel||"Select..."},showCalendarIcon(){return"Due Date"===(this.config.label||this.config.name)},filteredOptions(){const e=this.config.values||this.config.options||[];if(!this.searchQuery)return e;const t=this.searchQuery.toLowerCase();return e.filter(e=>e.label&&e.label.toLowerCase().includes(t))}},mounted(){document.addEventListener("click",this.closeDropdown)},beforeDestroy(){document.removeEventListener("click",this.closeDropdown)},methods:{toggleDropdown(){this.isOpen=!this.isOpen,this.isOpen&&(this.searchQuery="")},selectOption(e){this.$emit("update:modelValue",e.value),this.$emit("change",e),this.isOpen=!1},closeDropdown(e){e.target.closest(".dropdown-container")||(this.isOpen=!1)}}},g=i(1241);const y=(0,g.A)(h,[["render",m],["__scopeId","data-v-dfffad08"]]);var f=y},2625:function(e,t,i){var a=i(5130),s=i(6768);const o={id:"app"},l={key:0,class:"app-container"},n={class:"main-content"},r={key:1,class:"login-container"};function c(e,t,i,a,c,d){const u=(0,s.g2)("Sidebar"),p=(0,s.g2)("router-view"),m=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",o,[c.isAuthenticated?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.bF)(u),(0,s.Lk)("div",n,[(0,s.bF)(p)])])):((0,s.uX)(),(0,s.CE)("div",r,[(0,s.bF)(p)])),(0,s.bF)(m)])}var d=i(4232);const u={class:"sidebar-header"},p={class:"logo-container"},m=["src"],v={key:0,class:"logo-text"},k={key:0,class:"notification-badge header-badge"},h={key:0,class:"expand-button-container"},g={class:"menu"},y={key:0},f={key:1,class:"fas fa-chevron-right submenu-arrow"},b={key:0,class:"submenu"},C={key:0,class:"submenu"},L={key:1,class:"submenu"},w={key:2,class:"submenu"},E={key:0},R={key:1,class:"fas fa-chevron-right submenu-arrow"},I={key:1,class:"submenu"},D={key:0,class:"submenu"},P={key:1,class:"submenu"},_={key:2,class:"submenu"},A={key:0},S={key:1,class:"fas fa-chevron-right submenu-arrow"},T={key:2,class:"submenu"},x={key:0,class:"submenu nested-submenu"},F={key:1,class:"submenu nested-submenu"},V={key:2,class:"submenu nested-submenu"},U={key:0},N={key:1,class:"fas fa-chevron-right submenu-arrow"},M={key:3,class:"submenu"},X={key:0,class:"submenu"},$={key:0},O={key:1,class:"fas fa-chevron-right submenu-arrow"},j={key:4,class:"submenu"},B={key:0,class:"submenu"},W={key:1,class:"submenu"},q={class:"bottom-section"},Q={key:0},K={key:1,class:"notification-badge"},J={ref:"notifAudio",src:"https://actions.google.com/sounds/v1/alarms/beep_short.ogg",preload:"auto"},z={key:0},H={key:0,class:"theme-submenu"},G={key:0,class:"fas fa-check theme-check"},Y={key:0,class:"fas fa-check theme-check"},Z={key:0,class:"fas fa-check theme-check"},ee={key:0};function te(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["sidebar",{collapsed:o.isCollapsed}])},[(0,s.Lk)("div",u,[(0,s.Lk)("div",p,[(0,s.Lk)("div",{class:"logo-wrapper",onClick:t[1]||(t[1]=e=>o.navigate("/home"))},[(0,s.Lk)("img",{src:o.logo,alt:"GRC Logo",class:"logo-image"},null,8,m),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",v,"GRC")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",{key:1,class:"header-notification",onClick:t[0]||(t[0]=(0,a.D$)(e=>o.navigate("/notifications"),["stop"]))},[t[68]||(t[68]=(0,s.Lk)("i",{class:"fas fa-bell icon bell-theme"},null,-1)),o.unreadCount>0?((0,s.uX)(),(0,s.CE)("span",k,(0,d.v_)(o.unreadCount),1)):(0,s.Q3)("",!0)]))]),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,class:"toggle",onClick:t[2]||(t[2]=(...e)=>o.toggleCollapse&&o.toggleCollapse(...e))},(0,d.v_)(o.isCollapsed?"»":"«"),1))])]),o.isCollapsed?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("button",{class:"expand-button",onClick:t[3]||(t[3]=(...e)=>o.toggleCollapse&&o.toggleCollapse(...e)),title:"Expand Sidebar"},t[69]||(t[69]=[(0,s.Lk)("i",{class:"fas fa-chevron-right"},null,-1)]))])):(0,s.Q3)("",!0),(0,s.Lk)("nav",g,[(0,s.Lk)("div",{onClick:t[4]||(t[4]=e=>o.toggleSubmenu("policy")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.policy}])},[t[70]||(t[70]=(0,s.Lk)("i",{class:"fas fa-file-alt icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",y,"Policy")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",f))],2),!o.isCollapsed&&o.openMenus.policy?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("div",{onClick:t[5]||(t[5]=e=>o.toggleSubmenu("policyCreation")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.policyCreation}])},t[71]||(t[71]=[(0,s.Lk)("i",{class:"fas fa-plus-square icon"},null,-1),(0,s.Lk)("span",null,"Policy Creation",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.policyCreation?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/create-policy/create")}]),onClick:t[6]||(t[6]=e=>o.navigate("/create-policy/create"))},t[72]||(t[72]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Policy",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/create-policy/upload-framework")}]),onClick:t[7]||(t[7]=e=>o.navigate("/create-policy/upload-framework"))},t[73]||(t[73]=[(0,s.Lk)("i",{class:"fas fa-upload icon"},null,-1),(0,s.Lk)("span",null,"Upload Framework",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/create-policy/tailoring")}]),onClick:t[8]||(t[8]=e=>o.navigate("/create-policy/tailoring"))},t[74]||(t[74]=[(0,s.Lk)("i",{class:"fas fa-edit icon"},null,-1),(0,s.Lk)("span",null,"Tailoring & Templating",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/create-policy/versioning")}]),onClick:t[9]||(t[9]=e=>o.navigate("/create-policy/versioning"))},t[75]||(t[75]=[(0,s.Lk)("i",{class:"fas fa-code-branch icon"},null,-1),(0,s.Lk)("span",null,"Versioning",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[10]||(t[10]=e=>o.toggleSubmenu("policiesList")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.policiesList}])},t[76]||(t[76]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Policies List",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.policiesList?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/policies-list/all")}]),onClick:t[11]||(t[11]=e=>o.navigate("/policies-list/all"))},t[77]||(t[77]=[(0,s.Lk)("i",{class:"fas fa-list-alt icon"},null,-1),(0,s.Lk)("span",null,"All Policies",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/tree-policies")}]),onClick:t[12]||(t[12]=e=>o.navigate("/tree-policies"))},t[78]||(t[78]=[(0,s.Lk)("i",{class:"fas fa-sitemap icon"},null,-1),(0,s.Lk)("span",null,"Tree Policies",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[13]||(t[13]=e=>o.navigate("/framework-explorer")),class:(0,d.C4)(["menu-item",{active:o.isActive("/framework-explorer")}])},t[79]||(t[79]=[(0,s.Lk)("i",{class:"fas fa-cubes icon"},null,-1),(0,s.Lk)("span",null,"Framework Explorer",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/policy/approval")}]),onClick:t[14]||(t[14]=e=>o.navigate("/policy/approval"))},t[80]||(t[80]=[(0,s.Lk)("i",{class:"fas fa-check-circle icon"},null,-1),(0,s.Lk)("span",null,"Policy Approval",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/framework-approval")}]),onClick:t[15]||(t[15]=e=>o.navigate("/framework-approval"))},t[81]||(t[81]=[(0,s.Lk)("i",{class:"fas fa-check-circle icon"},null,-1),(0,s.Lk)("span",null,"Framework Approval",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/framework-status-changes")}]),onClick:t[16]||(t[16]=e=>o.navigate("/framework-status-changes"))},t[82]||(t[82]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt icon"},null,-1),(0,s.Lk)("span",null,"Status Change Requests",-1)]),2),(0,s.Lk)("div",{onClick:t[17]||(t[17]=e=>o.toggleSubmenu("performanceAnalysis")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.performanceAnalysis}])},t[83]||(t[83]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.performanceAnalysis?((0,s.uX)(),(0,s.CE)("div",w,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/policy/performance/kpis")}]),onClick:t[18]||(t[18]=e=>o.navigate("/policy/performance/kpis"))},t[84]||(t[84]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"KPIs Analysis",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/policy/performance/dashboard")}]),onClick:t[19]||(t[19]=e=>o.navigate("/policy/performance/dashboard"))},t[85]||(t[85]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"User Dashboard",-1)]),2)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[20]||(t[20]=e=>o.toggleSubmenu("compliances")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.compliances}])},[t[86]||(t[86]=(0,s.Lk)("i",{class:"fas fa-check-circle icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",E,"Compliance")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",R))],2),!o.isCollapsed&&o.openMenus.compliances?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",{onClick:t[21]||(t[21]=e=>o.toggleSubmenu("complianceList")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.complianceList}])},t[87]||(t[87]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Compliance List",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.complianceList?((0,s.uX)(),(0,s.CE)("div",D,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/list")}]),onClick:t[22]||(t[22]=e=>o.navigate("/compliance/list"))},t[88]||(t[88]=[(0,s.Lk)("i",{class:"fas fa-shield-alt icon"},null,-1),(0,s.Lk)("span",null,"Control Management",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/audit-status")}]),onClick:t[23]||(t[23]=e=>o.navigate("/compliance/audit-status"))},t[89]||(t[89]=[(0,s.Lk)("i",{class:"fas fa-tasks icon"},null,-1),(0,s.Lk)("span",null,"Compliance Audit Management",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/approver")}]),onClick:t[24]||(t[24]=e=>o.navigate("/compliance/approver"))},t[90]||(t[90]=[(0,s.Lk)("i",{class:"fas fa-check-double icon"},null,-1),(0,s.Lk)("span",null,"Compliance Approval",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[25]||(t[25]=e=>o.toggleSubmenu("complianceCreation")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.complianceCreation}])},t[91]||(t[91]=[(0,s.Lk)("i",{class:"fas fa-plus-square icon"},null,-1),(0,s.Lk)("span",null,"Compliance Creation",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.complianceCreation?((0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/create")}]),onClick:t[26]||(t[26]=e=>o.navigate("/compliance/create"))},t[92]||(t[92]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Compliance",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/tailoring")}]),onClick:t[27]||(t[27]=e=>o.navigate("/compliance/tailoring"))},t[93]||(t[93]=[(0,s.Lk)("i",{class:"fas fa-edit icon"},null,-1),(0,s.Lk)("span",null,"Tailoring & Templating",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/versioning")}]),onClick:t[28]||(t[28]=e=>o.navigate("/compliance/versioning"))},t[94]||(t[94]=[(0,s.Lk)("i",{class:"fas fa-code-branch icon"},null,-1),(0,s.Lk)("span",null,"Versioning",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[29]||(t[29]=e=>o.toggleSubmenu("compliancePerformance")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.compliancePerformance}])},t[95]||(t[95]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.compliancePerformance?((0,s.uX)(),(0,s.CE)("div",_,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/user-dashboard")}]),onClick:t[30]||(t[30]=e=>o.navigate("/compliance/user-dashboard"))},t[96]||(t[96]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"Compliance Dashboard",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/compliance/kpi-dashboard")}]),onClick:t[31]||(t[31]=e=>o.navigate("/compliance/kpi-dashboard"))},t[97]||(t[97]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"Compliance KPI",-1)]),2)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[32]||(t[32]=e=>o.toggleSubmenu("risk")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.risk}])},[t[98]||(t[98]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",A,"Risk")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",S))],2),!o.isCollapsed&&o.openMenus.risk?((0,s.uX)(),(0,s.CE)("div",T,[(0,s.Lk)("div",{onClick:t[33]||(t[33]=e=>o.toggleSubmenu("riskRegister")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.riskRegister}])},t[99]||(t[99]=[(0,s.Lk)("i",{class:"fas fa-clipboard-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Register",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),o.openMenus.riskRegister?((0,s.uX)(),(0,s.CE)("div",x,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/riskregister-list")}]),onClick:t[34]||(t[34]=e=>o.navigate("/risk/riskregister-list"))},t[100]||(t[100]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Register List",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/create-risk")}]),onClick:t[35]||(t[35]=e=>o.navigate("/risk/create-risk"))},t[101]||(t[101]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Risk",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/tailoring")}]),onClick:t[36]||(t[36]=e=>o.navigate("/risk/tailoring"))},t[102]||(t[102]=[(0,s.Lk)("i",{class:"fas fa-edit icon"},null,-1),(0,s.Lk)("span",null,"Tailoring Existing Risk",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[37]||(t[37]=e=>o.toggleSubmenu("riskInstances")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.riskInstances}])},t[103]||(t[103]=[(0,s.Lk)("i",{class:"fas fa-th-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Instances",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),o.openMenus.riskInstances?((0,s.uX)(),(0,s.CE)("div",F,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/riskinstances-list")}]),onClick:t[38]||(t[38]=e=>o.navigate("/risk/riskinstances-list"))},t[104]||(t[104]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Risk Instances List",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/create-instance")}]),onClick:t[39]||(t[39]=e=>o.navigate("/risk/create-instance"))},t[105]||(t[105]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Instance",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/scoring")}]),onClick:t[40]||(t[40]=e=>o.navigate("/risk/scoring"))},t[106]||(t[106]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Risk Scoring",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[41]||(t[41]=e=>o.navigate("/risk/resolution")),class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/resolution")}])},t[107]||(t[107]=[(0,s.Lk)("i",{class:"fas fa-cogs icon"},null,-1),(0,s.Lk)("span",null,"Risk Handling",-1)]),2),(0,s.Lk)("div",{onClick:t[42]||(t[42]=e=>o.toggleSubmenu("riskAnalytics")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.riskAnalytics}])},t[108]||(t[108]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"Risk Analytics",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),o.openMenus.riskAnalytics?((0,s.uX)(),(0,s.CE)("div",V,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/riskdashboard")}]),onClick:t[43]||(t[43]=e=>o.navigate("/risk/riskdashboard"))},t[109]||(t[109]=[(0,s.Lk)("i",{class:"fas fa-th-large icon"},null,-1),(0,s.Lk)("span",null,"Dashboard",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/risk/riskkpi")}]),onClick:t[44]||(t[44]=e=>o.navigate("/risk/riskkpi"))},t[110]||(t[110]=[(0,s.Lk)("i",{class:"fas fa-chart-pie icon"},null,-1),(0,s.Lk)("span",null,"KPI Dashboard",-1)]),2)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[45]||(t[45]=e=>o.toggleSubmenu("auditor")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.auditor}])},[t[111]||(t[111]=(0,s.Lk)("i",{class:"fas fa-user-tie icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",U,"Auditor")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",N))],2),!o.isCollapsed&&o.openMenus.auditor?((0,s.uX)(),(0,s.CE)("div",M,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/auditor/dashboard")}]),onClick:t[46]||(t[46]=e=>o.navigate("/auditor/dashboard"))},t[112]||(t[112]=[(0,s.Lk)("i",{class:"fas fa-th-large icon"},null,-1),(0,s.Lk)("span",null,"Audits",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/auditor/assign")}]),onClick:t[47]||(t[47]=e=>o.navigate("/auditor/assign"))},t[113]||(t[113]=[(0,s.Lk)("i",{class:"fas fa-check-square icon"},null,-1),(0,s.Lk)("span",null,"Assign Audit",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/auditor/reviews")}]),onClick:t[48]||(t[48]=e=>o.navigate("/auditor/reviews"))},t[114]||(t[114]=[(0,s.Lk)("i",{class:"fas fa-tasks icon"},null,-1),(0,s.Lk)("span",null,"Review Audits",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/auditor/reports")}]),onClick:t[49]||(t[49]=e=>o.navigate("/auditor/reports"))},t[115]||(t[115]=[(0,s.Lk)("i",{class:"fas fa-file-alt icon"},null,-1),(0,s.Lk)("span",null,"Audit Reports",-1)]),2),(0,s.Lk)("div",{onClick:t[50]||(t[50]=e=>o.toggleSubmenu("performance")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.performance}])},t[116]||(t[116]=[(0,s.Lk)("i",{class:"fas fa-chart-bar icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),o.openMenus.performance?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/auditor/performance/kpi")}]),onClick:t[51]||(t[51]=e=>o.navigate("/auditor/performance/kpi"))},t[117]||(t[117]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"KPIs Analysis",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/auditor/performance/userdashboard")}]),onClick:t[52]||(t[52]=e=>o.navigate("/auditor/performance/userdashboard"))},t[118]||(t[118]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Dashboard",-1)]),2)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[53]||(t[53]=e=>o.toggleSubmenu("incident")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.incident}])},[t[119]||(t[119]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",$,"Incident")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",O))],2),!o.isCollapsed&&o.openMenus.incident?((0,s.uX)(),(0,s.CE)("div",j,[(0,s.Lk)("div",{onClick:t[54]||(t[54]=e=>o.toggleSubmenu("incidentManagement")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.incidentManagement}])},t[120]||(t[120]=[(0,s.Lk)("i",{class:"fas fa-clipboard-list icon"},null,-1),(0,s.Lk)("span",null,"Incident Management",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.incidentManagement?((0,s.uX)(),(0,s.CE)("div",B,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/incident/incident")}]),onClick:t[55]||(t[55]=e=>o.navigate("/incident/incident"))},t[121]||(t[121]=[(0,s.Lk)("i",{class:"fas fa-list icon"},null,-1),(0,s.Lk)("span",null,"Incident List",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/incident/create")}]),onClick:t[56]||(t[56]=e=>o.navigate("/incident/create"))},t[122]||(t[122]=[(0,s.Lk)("i",{class:"fas fa-plus icon"},null,-1),(0,s.Lk)("span",null,"Create Incident",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/incident/audit-findings")}]),onClick:t[57]||(t[57]=e=>o.navigate("/incident/audit-findings"))},t[123]||(t[123]=[(0,s.Lk)("i",{class:"fas fa-search icon"},null,-1),(0,s.Lk)("span",null,"Audit Findings",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/incident/user-tasks")}]),onClick:t[58]||(t[58]=e=>o.navigate("/incident/user-tasks"))},t[124]||(t[124]=[(0,s.Lk)("i",{class:"fas fa-user-check icon"},null,-1),(0,s.Lk)("span",null,"User Tasks",-1)]),2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{onClick:t[59]||(t[59]=e=>o.toggleSubmenu("incidentPerformance")),class:(0,d.C4)(["menu-item has-submenu",{expanded:o.openMenus.incidentPerformance}])},t[125]||(t[125]=[(0,s.Lk)("i",{class:"fas fa-chart-line icon"},null,-1),(0,s.Lk)("span",null,"Performance Analysis",-1),(0,s.Lk)("i",{class:"fas fa-chevron-right submenu-arrow"},null,-1)]),2),!o.isCollapsed&&o.openMenus.incidentPerformance?((0,s.uX)(),(0,s.CE)("div",W,[(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/incident/dashboard")}]),onClick:t[60]||(t[60]=e=>o.navigate("/incident/dashboard"))},t[126]||(t[126]=[(0,s.Lk)("i",{class:"fas fa-chart-pie icon"},null,-1),(0,s.Lk)("span",null,"KPIs Analysis",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["menu-item",{active:o.isActive("/incident/performance/dashboard")}]),onClick:t[61]||(t[61]=e=>o.navigate("/incident/performance/dashboard"))},t[127]||(t[127]=[(0,s.Lk)("i",{class:"fas fa-tachometer-alt icon"},null,-1),(0,s.Lk)("span",null,"Dashboard",-1)]),2)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",q,[(0,s.Lk)("div",{onClick:t[62]||(t[62]=e=>o.navigate("/notifications")),class:"notification-menu-item"},[t[128]||(t[128]=(0,s.Lk)("i",{class:"fas fa-bell icon bell-theme"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",Q,"Notifications")),o.unreadCount>0?((0,s.uX)(),(0,s.CE)("span",K,(0,d.v_)(o.unreadCount),1)):(0,s.Q3)("",!0),(0,s.Lk)("audio",J,null,512)]),(0,s.Lk)("div",{onClick:t[63]||(t[63]=(...e)=>o.toggleThemeMenu&&o.toggleThemeMenu(...e)),class:"theme-menu-item"},[t[129]||(t[129]=(0,s.Lk)("i",{class:"fas fa-palette icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",z,"Theme")),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",{key:1,class:(0,d.C4)(["fas fa-chevron-down theme-arrow",{rotated:o.themeMenuOpen}])},null,2))]),!o.isCollapsed&&o.themeMenuOpen?((0,s.uX)(),(0,s.CE)("div",H,[(0,s.Lk)("div",{class:(0,d.C4)(["theme-option",{active:"light"===o.currentTheme}]),onClick:t[64]||(t[64]=e=>o.setTheme("light"))},[t[130]||(t[130]=(0,s.Lk)("div",{class:"theme-preview light-theme"},null,-1)),t[131]||(t[131]=(0,s.Lk)("span",null,"Light",-1)),"light"===o.currentTheme?((0,s.uX)(),(0,s.CE)("i",G)):(0,s.Q3)("",!0)],2),(0,s.Lk)("div",{class:(0,d.C4)(["theme-option",{active:"dark"===o.currentTheme}]),onClick:t[65]||(t[65]=e=>o.setTheme("dark"))},[t[132]||(t[132]=(0,s.Lk)("div",{class:"theme-preview dark-theme"},null,-1)),t[133]||(t[133]=(0,s.Lk)("span",null,"Dark",-1)),"dark"===o.currentTheme?((0,s.uX)(),(0,s.CE)("i",Y)):(0,s.Q3)("",!0)],2),(0,s.Lk)("div",{class:(0,d.C4)(["theme-option",{active:"blue"===o.currentTheme}]),onClick:t[66]||(t[66]=e=>o.setTheme("blue"))},[t[134]||(t[134]=(0,s.Lk)("div",{class:"theme-preview blue-theme"},null,-1)),t[135]||(t[135]=(0,s.Lk)("span",null,"Blue",-1)),"blue"===o.currentTheme?((0,s.uX)(),(0,s.CE)("i",Z)):(0,s.Q3)("",!0)],2)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:"bottom-profile",onClick:t[67]||(t[67]=e=>o.navigate("/user-profile"))},[t[136]||(t[136]=(0,s.Lk)("i",{class:"fas fa-user icon"},null,-1)),o.isCollapsed?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",ee,(0,d.v_)(o.username),1))])])],2)}i(4114),i(8111),i(2489);var ie=i(144),ae=i(1387),se=i.p+"img/grc_logo1.aaa37024.svg",oe={name:"PolicySidebar",setup(){const e=(0,ae.rd)(),t=(0,ae.lq)(),i=(0,ie.KR)(!1),a=(0,ie.KR)(!1),o=(0,ie.KR)("light"),l=(0,ie.KR)(0),n=(0,ie.KR)("User");let r=0,c=null;const d=(0,ie.KR)(null),u=(0,s.EW)(()=>t.path),p=(0,ie.KR)({policy:!1,policyCreation:!1,policiesList:!1,performanceAnalysis:!1,compliance:!1,risk:!1,riskRegister:!1,riskInstances:!1,riskAnalytics:!1,auditor:!1,incident:!1,incidentManagement:!1,incidentPerformance:!1,dashboard:!1,complianceDashboard:!1,policyManagement:!1,createPolicy:!1,performance:!1,auditFindings:!1,compliances:!1,compliancesView:!1,complianceCreation:!1,complianceList:!1,compliancePerformance:!1}),m=e=>u.value===e||u.value.startsWith(e+"/"),v=()=>{i.value=!i.value},k=e=>{p.value[e]=!p.value[e]},h=()=>{a.value=!a.value},g=e=>{o.value=e,document.documentElement.setAttribute("data-theme",e),localStorage.setItem("selected-theme",e),a.value=!1},y=()=>{k("dashboard"),p.value.dashboard||e.push("/policy/dashboard")},f=t=>{e.push(t)},b=async()=>{try{const e=await fetch("http://localhost:8000/api/get-notifications/?user_id=default_user");if(e.ok){const t=await e.json();if("success"===t.status){const e=(t.notifications||[]).filter(e=>e.status&&!e.status.isRead).length;e>r&&0!==r&&d.value&&d.value.play(),l.value=e,r=e}}}catch(e){}},C=async()=>{try{const t=localStorage.getItem("fullName"),i=localStorage.getItem("username"),a=localStorage.getItem("user");let s="User";if(a)try{const e=JSON.parse(a);s=e.full_name||e.UserName||e.user_name||e.username||s}catch(e){console.error("Error parsing user data:",e)}n.value=t&&"null"!==t?t:i&&"null"!==i?i:s}catch(e){console.error("Error fetching username:",e),n.value="User"}};return(0,s.sV)(()=>{b(),C(),c=setInterval(b,1e4);const e=localStorage.getItem("selected-theme")||"light";g(e),window.addEventListener("userDataUpdated",C)}),(0,s.hi)(()=>{c&&clearInterval(c),window.removeEventListener("userDataUpdated",C)}),{isCollapsed:i,openMenus:p,themeMenuOpen:a,currentTheme:o,logo:se,username:n,toggleCollapse:v,toggleSubmenu:k,toggleThemeMenu:h,setTheme:g,navigate:f,handleDashboardClick:y,unreadCount:l,notifAudio:d,isActive:m}}},le=i(1241);const ne=(0,le.A)(oe,[["render",te],["__scopeId","data-v-231cacad"]]);var re=ne,ce=i(16),de={name:"App",components:{Sidebar:re,PopupModal:ce.A},data(){return{isAuthenticated:!1}},created(){this.checkAuthStatus(),window.addEventListener("authChanged",this.checkAuthStatus)},beforeUnmount(){window.removeEventListener("authChanged",this.checkAuthStatus)},methods:{checkAuthStatus(){this.isAuthenticated="true"===localStorage.getItem("isAuthenticated")}}};const ue=(0,le.A)(de,[["render",c]]);var pe=ue;const me={class:"dashboard-container"},ve={key:0,class:"error-message"},ke={key:1,class:"loading-overlay"},he={key:2},ge={class:"dashboard-header"},ye={class:"dashboard-actions"},fe={class:"summary-tabs"},be={class:"summary-tab-content"},Ce={class:"summary-tab-value"},Le={class:"summary-tab-trend positive"},we={class:"summary-tab-content"},Ee={class:"summary-tab-value"},Re={class:"summary-tab-trend neutral"},Ie={class:"summary-tab-content"},De={class:"summary-tab-value"},Pe={class:"summary-tab-trend neutral"},_e={class:"summary-tab-content"},Ae={class:"summary-tab-value"},Se={class:"dashboard-main-row dashboard-main-row-3col",style:{display:"flex",width:"100%"}},Te={class:"dashboard-main-col asset-performance-col",style:{width:"70%"}},xe={class:"chart-card tabbed-chart-card"},Fe={class:"card-header"},Ve={class:"header-left"},Ue={class:"axis-selectors"},Ne={class:"chart-tabs"},Me=["onClick","title"],Xe={class:"chart-container"},$e={class:"dashboard-main-col recent-activity-col",style:{width:"30%"}},Oe={class:"activity-card"},je={class:"activity-list"},Be={class:"activity-content"},We={class:"activity-title"},qe={class:"activity-desc"},Qe={class:"activity-meta"},Ke={class:"activity-author"},Je={class:"activity-time"};function ze(e,t,i,o,l,n){const r=(0,s.g2)("LineChart"),c=(0,s.g2)("Bar"),u=(0,s.g2)("Doughnut");return(0,s.uX)(),(0,s.CE)("div",me,[o.error?((0,s.uX)(),(0,s.CE)("div",ve,[(0,s.eW)((0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.fetchDashboardData&&o.fetchDashboardData(...e)),class:"retry-btn"},"Retry")])):(0,s.Q3)("",!0),o.loading?((0,s.uX)(),(0,s.CE)("div",ke,t[8]||(t[8]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading dashboard data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",he,[(0,s.Lk)("div",ge,[t[11]||(t[11]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Policy Dashboard",-1)),(0,s.Lk)("div",ye,[(0,s.Lk)("button",{class:"action-btn",onClick:t[1]||(t[1]=(...e)=>o.fetchDashboardData&&o.fetchDashboardData(...e)),title:"Refresh"},t[9]||(t[9]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),t[10]||(t[10]=(0,s.Lk)("button",{class:"action-btn",title:"Download"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",fe,[(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"approval"===o.activeTab}]),onClick:t[2]||(t[2]=e=>o.activeTab="approval")},[t[14]||(t[14]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-chart-line"})],-1)),(0,s.Lk)("div",be,[t[13]||(t[13]=(0,s.Lk)("div",{class:"summary-tab-label"},"Approval Rate",-1)),(0,s.Lk)("div",Ce,(0,d.v_)(o.dashboardData.approval_rate)+"%",1),(0,s.Lk)("div",Le,[t[12]||(t[12]=(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1)),(0,s.eW)(" Based on "+(0,d.v_)(o.dashboardData.total_policies)+" policies ",1)])])],2),(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"policies"===o.activeTab}]),onClick:t[3]||(t[3]=e=>o.activeTab="policies")},[t[17]||(t[17]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("div",we,[t[16]||(t[16]=(0,s.Lk)("div",{class:"summary-tab-label"},"Active Policies",-1)),(0,s.Lk)("div",Ee,(0,d.v_)(o.dashboardData.active_policies),1),(0,s.Lk)("div",Re,[t[15]||(t[15]=(0,s.Lk)("i",{class:"fas fa-layer-group"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.dashboardData.total_policies)+" total policies ",1)])])],2),(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"subpolicies"===o.activeTab}]),onClick:t[4]||(t[4]=e=>o.activeTab="subpolicies")},[t[20]||(t[20]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-list"})],-1)),(0,s.Lk)("div",Ie,[t[19]||(t[19]=(0,s.Lk)("div",{class:"summary-tab-label"},"Active SubPolicies",-1)),(0,s.Lk)("div",De,(0,d.v_)(o.dashboardData.active_subpolicies),1),(0,s.Lk)("div",Pe,[t[18]||(t[18]=(0,s.Lk)("i",{class:"fas fa-layer-group"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.dashboardData.total_subpolicies)+" total subpolicies ",1)])])],2),(0,s.Lk)("button",{class:(0,d.C4)(["summary-tab",{active:"approval_time"===o.activeTab}]),onClick:t[5]||(t[5]=e=>o.activeTab="approval_time")},[t[23]||(t[23]=(0,s.Lk)("div",{class:"summary-tab-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})],-1)),(0,s.Lk)("div",_e,[t[21]||(t[21]=(0,s.Lk)("div",{class:"summary-tab-label"},"Avg. Approval Time",-1)),(0,s.Lk)("div",Ae,(0,d.v_)(o.avgApprovalTime)+" days",1),t[22]||(t[22]=(0,s.Lk)("div",{class:"summary-tab-trend"},[(0,s.Lk)("i",{class:"fas fa-history"}),(0,s.eW)(" Time to approve ")],-1))])],2)]),(0,s.Lk)("div",Se,[(0,s.Lk)("div",Te,[(0,s.Lk)("div",xe,[(0,s.Lk)("div",Fe,[(0,s.Lk)("div",Ve,[t[26]||(t[26]=(0,s.Lk)("span",null,"Policy Analytics",-1)),(0,s.Lk)("div",Ue,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>o.selectedXAxis=e),class:"axis-select"},t[24]||(t[24]=[(0,s.Lk)("option",{disabled:"",value:""},"Select X Axis",-1),(0,s.Lk)("option",{value:"framework"},"Framework",-1),(0,s.Lk)("option",{value:"policy"},"Policy",-1),(0,s.Lk)("option",{value:"subpolicy"},"SubPolicy",-1)]),512),[[a.u1,o.selectedXAxis]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>o.selectedYAxis=e),class:"axis-select"},t[25]||(t[25]=[(0,s.Fv)('<option disabled value="" data-v-f787c6d4>Select Y Axis</option><option value="activeInactive" data-v-f787c6d4>Active/Inactive</option><option value="category" data-v-f787c6d4>Category Distribution</option><option value="status" data-v-f787c6d4>Status Distribution</option><option value="createdByDate" data-v-f787c6d4>Creation Date Distribution</option><option value="createdByName" data-v-f787c6d4>Created By Distribution</option><option value="department" data-v-f787c6d4>Department Distribution</option>',7)]),512),[[a.u1,o.selectedYAxis]])])]),(0,s.Lk)("div",Ne,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.chartTypes,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.type,class:(0,d.C4)(["chart-tab-btn",{active:o.activeChart===e.type}]),onClick:t=>o.activeChart=e.type,title:e.label},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon)},null,2)],10,Me))),128))])]),(0,s.Lk)("div",Xe,["line"===o.activeChart?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:o.lineChartData,options:o.lineChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"bar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:1,data:o.barChartData,options:o.barChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"doughnut"===o.activeChart?((0,s.uX)(),(0,s.Wv)(u,{key:2,data:o.donutChartData,options:o.donutChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"horizontalBar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:3,data:o.horizontalBarChartData,options:o.horizontalBarChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",$e,[(0,s.Lk)("div",Oe,[t[27]||(t[27]=(0,s.Lk)("div",{class:"card-header"},[(0,s.Lk)("h3",null,"Recent Activity"),(0,s.Lk)("button",{class:"card-action"},[(0,s.Lk)("i",{class:"fas fa-ellipsis-v"})])],-1)),(0,s.Lk)("div",je,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.recentActivity,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"activity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["activity-icon",o.getActivityIconClass(e.type)])},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon||"fas fa-plus-circle")},null,2)],2),(0,s.Lk)("div",Be,[(0,s.Lk)("div",We,(0,d.v_)(e.title||"Policy Activity"),1),(0,s.Lk)("div",qe,(0,d.v_)(e.name||e.PolicyName),1),(0,s.Lk)("div",Qe,[(0,s.Lk)("span",Ke,(0,d.v_)(e.created_by||e.CreatedBy),1),(0,s.Lk)("span",Je,(0,d.v_)(new Date(e.date||e.CreatedDate).toLocaleDateString()),1)])])]))),128))])])])])]))])}i(1701),i(8237);var He=i(4373);const Ge="http://localhost:8000/api";var Ye={async getDashboardSummary(){try{const e=await He.A.get(`${Ge}/policy-dashboard/`);return{data:{...e.data,policies:Array.isArray(e.data.policies)?e.data.policies:[]}}}catch(e){return console.error("Error fetching dashboard data:",e),{data:{total_policies:0,active_policies:0,inactive_policies:0,total_subpolicies:0,active_subpolicies:0,approval_rate:0,policies:[]}}}},getPolicyAnalytics(e,t){return He.A.get(`${Ge}/policy-analytics/`,{params:{x_axis:e,y_axis:t}})},getPolicyStatusDistribution(){return He.A.get(`${Ge}/policy-status-distribution/`)},getReviewerWorkload(){return He.A.get(`${Ge}/reviewer-workload/`)},getRecentPolicyActivity(){return He.A.get(`${Ge}/recent-policy-activity/`)},getAvgApprovalTime(){return He.A.get(`${Ge}/avg-policy-approval-time/`)},getAllPolicies(){return He.A.get(`${Ge}/policies/`)}},Ze=i(9064),et=i(1010),tt=i.p+"img/loan_logo1.74a77aa1.svg";Ze.t1.register(Ze.Bs,Ze.E8,Ze.PP,Ze.kc,Ze.FN,Ze.No,Ze.m_,Ze.s$);var it={name:"PolicyDashboard",components:{Doughnut:et.nu,Bar:et.yP,LineChart:et.N1},setup(){const e=(0,ie.KR)(!0),t=(0,ie.KR)("framework"),i=(0,ie.KR)("category"),a=(0,ie.KR)({total_policies:0,total_subpolicies:0,active_policies:0,inactive_policies:0,active_subpolicies:0,approval_rate:0,policies:[]}),o=(0,ie.KR)([]),l=(0,ie.KR)(0),n=(0,ie.KR)([]),r=(0,ie.KR)([]),c=(0,ie.KR)(!0),d=(0,ie.KR)(null),u=(0,ie.KR)("bar"),p=(0,ie.KR)("approval"),m=async()=>{try{c.value=!0,d.value=null;const[e,s,u,p,m]=await Promise.all([Ye.getDashboardSummary(),Ye.getPolicyStatusDistribution(),Ye.getRecentPolicyActivity(),Ye.getAvgApprovalTime(),Ye.getReviewerWorkload()]);a.value=e.data,n.value=s.data,o.value=u.data,l.value=p.data.average_days,r.value=m.data,await v(t.value,i.value)}catch(e){console.error("Error fetching dashboard data:",e),d.value="Failed to load dashboard data"}finally{c.value=!1}},v=async(e,t)=>{try{c.value=!0;const i=await Ye.getPolicyAnalytics(e,t),a=i.data,o=a.map(e=>e.label||"N/A"),l=a.map(e=>"createdByName"===t?e.label:"category"===t?R(e.label||"N/A"):e.label||"N/A"),n=a.map(e=>e.value||0);f.labels=[...l],f.datasets=[{data:[...n],backgroundColor:l.map((e,t)=>`hsl(${360*t/l.length}, 70%, 60%)`),borderWidth:0,hoverOffset:5}],f._originalLabels=[...o],C.labels=[...l],C.datasets=[{label:k(t),data:[...n],backgroundColor:l.map((e,t)=>`hsl(${360*t/l.length}, 70%, 60%)`),borderRadius:4}],C._originalLabels=[...o],w.labels=[...l],w.datasets=[{label:k(t),data:[...n],backgroundColor:l.map((e,t)=>`hsl(${360*t/l.length}, 70%, 60%)`),borderRadius:6,barPercentage:.5,categoryPercentage:.7}],w._originalLabels=[...o],g.labels=[...l],g.datasets=[{label:k(t),data:[...n],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}],g._originalLabels=[...o],(0,s.dY)(()=>{"line"===u.value&&(g.datasets=[...g.datasets]),"bar"===u.value&&(C.datasets=[...C.datasets]),"doughnut"===u.value&&(f.datasets=[...f.datasets]),"horizontalBar"===u.value&&(w.datasets=[...w.datasets])})}catch(i){console.error("Error updating chart data:",i),d.value="Failed to update chart data"}finally{c.value=!1}};(0,s.wB)([t,i],async([e,t])=>{await v(e,t)},{immediate:!0}),(0,s.wB)(u,()=>{(0,s.dY)(()=>{v(t.value,i.value)})});const k=e=>{switch(e){case"activeInactive":return"Active Items";case"category":return"Policy Categories";case"status":return"Status Distribution";case"createdByDate":return"Creation Date Distribution";case"createdByName":return"Created By Distribution";case"department":return"Department Distribution";default:return"Value"}},h=[{type:"line",icon:"fas fa-chart-line",label:"Line"},{type:"bar",icon:"fas fa-chart-bar",label:"Bar"},{type:"doughnut",icon:"fas fa-dot-circle",label:"Donut"},{type:"horizontalBar",icon:"fas fa-align-left",label:"Horizontal Bar"}],g=(0,ie.Kh)({labels:[],datasets:[{label:"Policy Performance",data:[],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}),y={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const t=e.dataIndex;let i=e.chart.data._originalLabels&&e.chart.data._originalLabels[t]?e.chart.data._originalLabels[t]:e.label||"";const a=e.raw||0;return`${i}: ${a}`}}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:11}}},x:{grid:{display:!1},ticks:{font:{size:11}}}},animation:{duration:1500,easing:"easeOutQuart"}},f=(0,ie.Kh)({labels:[],datasets:[{data:[],backgroundColor:["#4ade80","#f87171","#fbbf24"],borderWidth:0,hoverOffset:5}]}),b={cutout:"70%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const t=e.dataIndex;let i=e.chart.data._originalLabels&&e.chart.data._originalLabels[t]?e.chart.data._originalLabels[t]:e.label||"";const a=e.raw||0,s=e.dataset,o=s.data.reduce((e,t)=>e+t,0),l=Math.round(a/o*100);return`${i}: ${a} (${l}%)`}}}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeOutCubic"}},C=(0,ie.Kh)({labels:[],datasets:[{label:"",data:[],backgroundColor:[],borderRadius:4}]}),L={plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const t=e.dataIndex;let i=e.chart.data._originalLabels&&e.chart.data._originalLabels[t]?e.chart.data._originalLabels[t]:e.label||"";const a=e.raw||0;return`${i}: ${a}`}}}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#222",font:{size:10}}},y:{stacked:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}}}},animation:{duration:1e3,easing:"easeInOutQuart"}},w=(0,ie.Kh)({labels:[],datasets:[{label:"",data:[],backgroundColor:[],borderRadius:6,barPercentage:.5,categoryPercentage:.7}]}),E={indexAxis:"y",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(e){const t=e.dataIndex;let i=e.chart.data._originalLabels&&e.chart.data._originalLabels[t]?e.chart.data._originalLabels[t]:e.label||"";const a=e.raw||0;return`${i}: ${a}`}}}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}}},y:{grid:{display:!1},ticks:{color:"#222",font:{size:10}}}},maintainAspectRatio:!1,animation:{duration:1e3,easing:"easeInOutQuart"}};(0,s.sV)(()=>{m()});const R=e=>{if("category"===i.value&&e.includes(" > ")){const t=e.split(" > ");if(3===t.length)return t[2]}return e},I=e=>{switch(e){case"policy_created":return"create";case"policy_approved":return"approved";case"framework_created":return"create";case"framework_approved":return"approved";default:return""}};return{dashboardData:a,recentActivity:o,avgApprovalTime:l,loading:c,error:d,lineChartData:g,lineChartOptions:y,donutChartData:f,donutChartOptions:b,barChartData:C,barChartOptions:L,horizontalBarChartData:w,horizontalBarChartOptions:E,loanLogo:tt,showPolicyDetails:e,chartTypes:h,activeChart:u,selectedXAxis:t,selectedYAxis:i,fetchDashboardData:m,activeTab:p,getActivityIconClass:I}}};const at=(0,le.A)(it,[["render",ze],["__scopeId","data-v-f787c6d4"]]);var st=at;const ot={key:0,class:"loading-overlay"},lt={key:1,class:"error-message"},nt={key:2},rt={class:"framework-policy-row"},ct={class:"framework-policy-selects"},dt={key:0,class:"framework-form-container"},ut={class:"framework-form"},pt={class:"form-group policy-name"},mt={class:"form-row single-column"},vt={class:"form-group description"},kt={class:"textarea-container"},ht={class:"form-row"},gt={class:"form-group version"},yt={key:0,class:"auto-generated-label"},ft=["readonly"],bt={class:"form-group category"},Ct={class:"form-row"},Lt={class:"form-group internal-external"},wt={class:"form-group upload"},Et={class:"form-row"},Rt={class:"form-group date"},It={class:"form-group date"},Dt={class:"form-actions"},Pt={key:1},_t={class:"policy-header-section"},At={class:"subpolicy-stepper"},St=["onClick"],Tt=["onClick"],xt={key:0,class:"policy-rows full-width-policy-rows"},Ft={class:"policy-row"},Vt={class:"policy-card full-width-policy-card selected-policy",style:{cursor:"pointer"}},Ut={class:"policy-card-header"},Nt={style:{"font-size":"0.95rem"}},Mt={class:"policy-form-row"},Xt={class:"form-group"},$t={class:"input-with-icon"},Ot={class:"form-group"},jt={key:0,class:"auto-generated-label"},Bt={class:"input-with-icon"},Wt=["readonly"],qt={class:"form-group description"},Qt={class:"textarea-container"},Kt={class:"policy-form-row"},Jt={class:"form-group"},zt={class:"input-with-icon"},Ht={class:"form-group"},Gt={class:"input-with-icon"},Yt={class:"policy-form-row objective-applicability-row"},Zt={class:"form-group description"},ei={class:"textarea-container"},ti={class:"policy-form-row date-row"},ii={class:"form-group"},ai={class:"input-with-icon"},si={class:"form-group"},oi={class:"input-with-icon"},li={class:"policy-form-row"},ni={class:"form-group"},ri={class:"input-with-icon"},ci={class:"searchable-select"},di={id:"policyTypes"},ui=["value"],pi={class:"form-group"},mi={class:"input-with-icon"},vi={class:"searchable-select"},ki=["disabled"],hi={id:"policyCategories"},gi=["value"],yi={class:"policy-form-row date-row"},fi={class:"form-group"},bi={class:"input-with-icon"},Ci={class:"searchable-select"},Li=["disabled"],wi={id:"policySubCategories"},Ei=["value"],Ri={class:"form-group entities-group"},Ii={class:"entities-dropdown"},Di={class:"entity-content"},Pi={key:0,class:"entity-tag all-tag"},_i={key:1,class:"placeholder"},Ai={key:2,class:"entity-count"},Si={key:0,class:"entities-options"},Ti=["onClick"],xi=["checked","onChange"],Fi={class:"entity-label"},Vi={class:"policy-form-row date-row"},Ui={class:"form-group"},Ni={class:"input-with-icon"},Mi={class:"form-group"},Xi={class:"input-with-icon"},$i={key:0,class:"selected-file-name"},Oi={key:2,class:"subpolicy-creation-section"},ji={class:"subpolicy-stepper"},Bi=["onClick"],Wi=["onClick"],qi={key:0,class:"subpolicy-card"},Qi={class:"policy-card-header"},Ki={style:{"font-size":"0.9rem"}},Ji={class:"form-group"},zi={class:"input-with-icon"},Hi={class:"form-group"},Gi={class:"input-with-icon"},Yi={class:"form-group"},Zi={class:"textarea-container"},ea={class:"form-group"},ta={class:"textarea-container"},ia={key:3,class:"form-actions"},aa=["disabled"],sa={key:3,class:"approval-section"},oa={class:"approval-header"},la={class:"approval-form-container"},na={class:"approval-form"},ra={class:"form-group"},ca={class:"created-by-field"},da=["disabled","placeholder"],ua={class:"form-group"},pa=["disabled"],ma=["value"],va=["disabled"];function ka(e,t,i,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",{class:"create-policy-container",onClick:t[61]||(t[61]=(...e)=>o.closeAllEntityDropdowns&&o.closeAllEntityDropdowns(...e))},[o.loading?((0,s.uX)(),(0,s.CE)("div",ot,t[62]||(t[62]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading...",-1)]))):(0,s.Q3)("",!0),o.error?((0,s.uX)(),(0,s.CE)("div",lt,[(0,s.eW)((0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=e=>o.error=null)},"✕")])):(0,s.Q3)("",!0),o.showApprovalForm?((0,s.uX)(),(0,s.CE)("div",sa,[(0,s.Lk)("div",oa,[t[129]||(t[129]=(0,s.Lk)("h2",null,"Request Approvals",-1)),(0,s.Lk)("button",{class:"back-btn",onClick:t[57]||(t[57]=e=>o.showApprovalForm=!1)},t[128]||(t[128]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Policy Form ")]))]),(0,s.Lk)("div",la,[(0,s.Lk)("div",na,[(0,s.Lk)("div",ra,[t[131]||(t[131]=(0,s.Lk)("label",null,[(0,s.eW)("Created By "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",ca,[t[130]||(t[130]=(0,s.Lk)("div",{class:"user-icon"},[(0,s.Lk)("i",{class:"fas fa-user"})],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[58]||(t[58]=e=>o.approvalForm.createdByName=e),readonly:"",disabled:o.loading,placeholder:o.currentUser.UserName||"Loading user...",title:"This policy will be created under your username"},null,8,da),[[a.Jo,o.approvalForm.createdByName]])]),t[132]||(t[132]=(0,s.Lk)("div",{class:"helper-text"},"This policy will be created under your username.",-1))]),(0,s.Lk)("div",ua,[t[134]||(t[134]=(0,s.Lk)("label",null,[(0,s.eW)("Reviewer "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[59]||(t[59]=e=>o.approvalForm.reviewer=e),disabled:o.loading,title:"Select the person who will review and approve this framework/policy"},[t[133]||(t[133]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName),9,ma))),128))],8,pa),[[a.u1,o.approvalForm.reviewer]]),t[135]||(t[135]=(0,s.Lk)("div",{class:"helper-text"},"Select the person who will review and approve this framework/policy. This person will receive notification to review the submitted content.",-1))]),t[136]||(t[136]=(0,s.Lk)("div",{class:"approval-info"},[(0,s.Lk)("div",{class:"info-box"},[(0,s.Lk)("h4",null,"Approval Process"),(0,s.Lk)("ul",null,[(0,s.Lk)("li",null,"The selected reviewer will be notified to review your framework and policies"),(0,s.Lk)("li",null,"Once approved, the framework and policies will be activated in the system"),(0,s.Lk)("li",null,"You can track the approval status in the Policies List page"),(0,s.Lk)("li",null,"If changes are needed, the reviewer will provide feedback for updates")])])],-1)),(0,s.Lk)("button",{class:"create-btn",onClick:t[60]||(t[60]=(...e)=>o.handleFinalSubmit&&o.handleFinalSubmit(...e)),disabled:o.loading||!o.approvalForm.reviewer,title:"Submit the framework/policy for review and approval"},(0,d.v_)(o.loading?"Submitting...":"Submit for Review"),9,va)])])])):((0,s.uX)(),(0,s.CE)("div",nt,[t[127]||(t[127]=(0,s.Lk)("h2",null,"Create New Policy",-1)),(0,s.Lk)("div",rt,[(0,s.Lk)("div",ct,[(0,s.Lk)("div",null,[t[63]||(t[63]=(0,s.Lk)("label",null,[(0,s.eW)("Framework "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bF)(r,{config:o.frameworkDropdownConfig,modelValue:o.selectedFramework,"onUpdate:modelValue":t[1]||(t[1]=e=>o.selectedFramework=e)},null,8,["config","modelValue"]),t[64]||(t[64]=(0,s.Lk)("div",{class:"helper-text"},"Select an existing framework or create a new one to associate with your policy.",-1))])])]),o.showFrameworkForm?((0,s.uX)(),(0,s.CE)("div",dt,[(0,s.Lk)("div",ut,[t[84]||(t[84]=(0,s.Lk)("div",{class:"framework-header"},[(0,s.Lk)("h3",null,"Create New Framework"),(0,s.Lk)("div",{class:"framework-note"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("span",null,"After creating the framework, you can add policies and subpolicies. You can also return to this form later to make corrections.")])],-1)),(0,s.Lk)("div",pt,[t[65]||(t[65]=(0,s.Lk)("label",null,[(0,s.eW)("Framework Name "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter Framework name","onUpdate:modelValue":t[2]||(t[2]=e=>o.newFramework.FrameworkName=e),title:"Enter a descriptive name for your framework"},null,512),[[a.Jo,o.newFramework.FrameworkName]]),t[66]||(t[66]=(0,s.Lk)("div",{class:"helper-text"},"Enter a descriptive name for your framework",-1))]),(0,s.Lk)("div",mt,[(0,s.Lk)("div",vt,[t[67]||(t[67]=(0,s.Lk)("label",null,[(0,s.eW)("Description "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",kt,[(0,s.bo)((0,s.Lk)("textarea",{placeholder:"Enter framework description","onUpdate:modelValue":t[3]||(t[3]=e=>o.newFramework.FrameworkDescription=e),rows:"3",title:"Describe the purpose, scope, and objectives of this framework",maxlength:"1000"},null,512),[[a.Jo,o.newFramework.FrameworkDescription]]),(0,s.Lk)("div",{class:(0,d.C4)(["character-counter",o.getCharacterCounterClass(o.newFramework.FrameworkDescription,1e3)])},(0,d.v_)((o.newFramework.FrameworkDescription||"").length)+"/1000 ",3)]),t[68]||(t[68]=(0,s.Lk)("div",{class:"helper-text"},"Describe the purpose, scope, and objectives of this framework",-1))])]),(0,s.Lk)("div",ht,[(0,s.Lk)("div",gt,[(0,s.Lk)("label",null,[t[69]||(t[69]=(0,s.eW)("Identifier ")),t[70]||(t[70]=(0,s.Lk)("span",{class:"required-star"},"*",-1)),"Internal"===o.newFramework.InternalExternal?((0,s.uX)(),(0,s.CE)("span",yt," (Auto-generated) ")):(0,s.Q3)("",!0)]),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter Identifier","onUpdate:modelValue":t[4]||(t[4]=e=>o.newFramework.Identifier=e),readonly:"Internal"===o.newFramework.InternalExternal,title:"Use a unique code like 'FW-001' or 'ISO-27001'"},null,8,ft),[[a.Jo,o.newFramework.Identifier]]),t[71]||(t[71]=(0,s.Lk)("div",{class:"helper-text"},"Use a unique code like 'FW-001' or 'ISO-27001'",-1))]),(0,s.Lk)("div",bt,[t[72]||(t[72]=(0,s.Lk)("label",null,[(0,s.eW)("Category "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter category","onUpdate:modelValue":t[5]||(t[5]=e=>o.newFramework.Category=e),title:"e.g., Security, Compliance, Risk Management, etc."},null,512),[[a.Jo,o.newFramework.Category]]),t[73]||(t[73]=(0,s.Lk)("div",{class:"helper-text"},"e.g., Security, Compliance, Risk Management, etc.",-1))])]),(0,s.Lk)("div",Ct,[(0,s.Lk)("div",Lt,[t[75]||(t[75]=(0,s.Lk)("label",null,[(0,s.eW)("Internal/External "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>o.newFramework.InternalExternal=e),title:"Select whether this framework is for internal or external use"},t[74]||(t[74]=[(0,s.Lk)("option",{value:""},"Select Type",-1),(0,s.Lk)("option",{value:"Internal"},"Internal",-1),(0,s.Lk)("option",{value:"External"},"External",-1)]),512),[[a.u1,o.newFramework.InternalExternal]]),t[76]||(t[76]=(0,s.Lk)("div",{class:"helper-text"},"Select whether this framework is for internal or external use",-1))]),(0,s.Lk)("div",wt,[t[77]||(t[77]=(0,s.Lk)("label",null,"Upload Document",-1)),(0,s.Lk)("span",null,(0,d.v_)(o.newFramework.DocURL?o.newFramework.DocURL.name:"Choose File"),1),(0,s.Lk)("button",{class:"browse-btn",type:"button",onClick:t[7]||(t[7]=()=>o.handleFrameworkFileUpload()),title:"Browse and select a document file"},"Browse"),(0,s.Lk)("input",{type:"file",ref:"frameworkFileInput",style:{display:"none"},onChange:t[8]||(t[8]=(...e)=>o.onFrameworkFileChange&&o.onFrameworkFileChange(...e))},null,544),t[78]||(t[78]=(0,s.Lk)("div",{class:"helper-text"},"Upload a supporting document for this framework (optional)",-1))])]),(0,s.Lk)("div",Et,[(0,s.Lk)("div",Rt,[t[79]||(t[79]=(0,s.Lk)("label",null,[(0,s.eW)("Effective Start Date "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[9]||(t[9]=e=>o.newFramework.StartDate=e),title:"Date when the framework implementation begins"},null,512),[[a.Jo,o.newFramework.StartDate]]),t[80]||(t[80]=(0,s.Lk)("div",{class:"helper-text"},"Date when the framework implementation begins",-1))]),(0,s.Lk)("div",It,[t[81]||(t[81]=(0,s.Lk)("label",null,"Effective End Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=e=>o.newFramework.EndDate=e),title:"Date when the framework expires or requires review"},null,512),[[a.Jo,o.newFramework.EndDate]]),t[82]||(t[82]=(0,s.Lk)("div",{class:"helper-text"},"Date when the framework expires or requires review",-1))])]),(0,s.Lk)("div",Dt,[(0,s.Lk)("button",{class:"submitt-btn",onClick:t[11]||(t[11]=(...e)=>o.handleCreateFramework&&o.handleCreateFramework(...e))},t[83]||(t[83]=[(0,s.Lk)("i",{class:"fas fa-arrow-right"},null,-1),(0,s.eW)(" Continue to Policies ")]))])])])):(0,s.Q3)("",!0),o.selectedFramework&&!o.showFrameworkForm?((0,s.uX)(),(0,s.CE)("div",Pt,[(0,s.Lk)("div",_t,[t[86]||(t[86]=(0,s.Lk)("h3",{style:{margin:"0"}},"Policy Creation",-1)),"__new__"===o.selectedFramework?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"back-to-framework-btn",onClick:t[12]||(t[12]=(...e)=>o.goBackToFramework&&o.goBackToFramework(...e)),title:"Return to framework form to make corrections"},t[85]||(t[85]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Framework ")]))):(0,s.Q3)("",!0)]),(0,s.Lk)("div",At,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policiesForm,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["subpolicy-step",{active:o.selectedPolicyIdx===t}]),onClick:e=>o.selectedPolicyIdx=t},[(0,s.eW)((0,d.v_)(e.PolicyName||`Policy ${t+1}`)+" ",1),(0,s.Lk)("button",{class:"remove-btn",onClick:(0,a.D$)(e=>o.handleRemovePolicy(t),["stop"]),title:"Remove Policy"},"✕",8,Tt)],10,St))),128)),(0,s.Lk)("button",{class:"add-subpolicy-step-btn",onClick:t[13]||(t[13]=(...e)=>o.handleAddPolicy&&o.handleAddPolicy(...e))}," + Add Policy ")]),null!==o.selectedPolicyIdx&&o.policiesForm[o.selectedPolicyIdx]?((0,s.uX)(),(0,s.CE)("div",xt,[(0,s.Lk)("div",Ft,[(0,s.Lk)("div",Vt,[(0,s.Lk)("div",Ut,[(0,s.Lk)("b",Nt,(0,d.v_)(o.policiesForm[o.selectedPolicyIdx].PolicyName||`Policy ${o.selectedPolicyIdx+1}`),1),(0,s.Lk)("button",{class:"remove-btn",onClick:t[14]||(t[14]=(0,a.D$)(e=>o.handleRemovePolicy(o.selectedPolicyIdx),["stop"])),title:"Remove Policy"},"✕")]),(0,s.Lk)("div",Mt,[(0,s.Lk)("div",Xt,[t[87]||(t[87]=(0,s.Lk)("label",null,[(0,s.eW)("Policy Name "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",$t,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter policy name","onUpdate:modelValue":t[15]||(t[15]=e=>o.policiesForm[o.selectedPolicyIdx].PolicyName=e),onInput:t[16]||(t[16]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"PolicyName",e.target.value)),title:"Use a clear, descriptive name that identifies the policy's purpose"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].PolicyName]])]),t[88]||(t[88]=(0,s.Lk)("div",{class:"helper-text"},"Use a clear, descriptive name that identifies the policy's purpose",-1))]),(0,s.Lk)("div",Ot,[(0,s.Lk)("label",null,[t[89]||(t[89]=(0,s.eW)("Policy Identifier ")),t[90]||(t[90]=(0,s.Lk)("span",{class:"required-star"},"*",-1)),o.isInternalFramework()?((0,s.uX)(),(0,s.CE)("span",jt," (Auto-generated) ")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Bt,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter policy identifier","onUpdate:modelValue":t[17]||(t[17]=e=>o.policiesForm[o.selectedPolicyIdx].Identifier=e),readonly:o.isInternalFramework(),onInput:t[18]||(t[18]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"Identifier",e.target.value)),title:"Use a unique code like 'POL-001' or 'SEC-AUTH-01'"},null,40,Wt),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].Identifier]])]),t[91]||(t[91]=(0,s.Lk)("div",{class:"helper-text"},"Use a unique code like 'POL-001' or 'SEC-AUTH-01'",-1))])]),(0,s.Lk)("div",qt,[t[92]||(t[92]=(0,s.Lk)("label",null,[(0,s.eW)("Description "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",Qt,[(0,s.bo)((0,s.Lk)("textarea",{placeholder:"Enter policy description","onUpdate:modelValue":t[19]||(t[19]=e=>o.policiesForm[o.selectedPolicyIdx].PolicyDescription=e),onInput:t[20]||(t[20]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"PolicyDescription",e.target.value)),rows:"3",title:"Describe the policy's purpose, requirements, and key provisions",maxlength:"1000"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].PolicyDescription]]),(0,s.Lk)("div",{class:(0,d.C4)(["character-counter",o.getCharacterCounterClass(o.policiesForm[o.selectedPolicyIdx].PolicyDescription,1e3)])},(0,d.v_)((o.policiesForm[o.selectedPolicyIdx].PolicyDescription||"").length)+"/1000 ",3)]),t[93]||(t[93]=(0,s.Lk)("div",{class:"helper-text"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",Kt,[(0,s.Lk)("div",Jt,[t[94]||(t[94]=(0,s.Lk)("label",null,[(0,s.eW)("Scope "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",zt,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter policy scope","onUpdate:modelValue":t[21]||(t[21]=e=>o.policiesForm[o.selectedPolicyIdx].Scope=e),onInput:t[22]||(t[22]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"Scope",e.target.value)),title:"Specify what areas, processes, or systems this policy applies to"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].Scope]])]),t[95]||(t[95]=(0,s.Lk)("div",{class:"helper-text"},"Specify what areas, processes, or systems this policy applies to",-1))]),(0,s.Lk)("div",Ht,[t[96]||(t[96]=(0,s.Lk)("label",null,[(0,s.eW)("Department "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",Gt,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter department","onUpdate:modelValue":t[23]||(t[23]=e=>o.policiesForm[o.selectedPolicyIdx].Department=e),onInput:t[24]||(t[24]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"Department",e.target.value)),title:"e.g., IT, HR, Finance, Legal, Operations, etc."},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].Department]])]),t[97]||(t[97]=(0,s.Lk)("div",{class:"helper-text"},"e.g., IT, HR, Finance, Legal, Operations, etc.",-1))])]),(0,s.Lk)("div",Yt,[(0,s.Lk)("div",Zt,[t[98]||(t[98]=(0,s.Lk)("label",null,[(0,s.eW)("Objective "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",ei,[(0,s.bo)((0,s.Lk)("textarea",{placeholder:"Enter policy objective","onUpdate:modelValue":t[25]||(t[25]=e=>o.policiesForm[o.selectedPolicyIdx].Objective=e),onInput:t[26]||(t[26]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"Objective",e.target.value)),rows:"3",title:"Explain what this policy is designed to accomplish and its expected outcomes",maxlength:"1000"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].Objective]]),(0,s.Lk)("div",{class:(0,d.C4)(["character-counter",o.getCharacterCounterClass(o.policiesForm[o.selectedPolicyIdx].Objective,1e3)])},(0,d.v_)((o.policiesForm[o.selectedPolicyIdx].Objective||"").length)+"/1000 ",3)]),t[99]||(t[99]=(0,s.Lk)("div",{class:"helper-text"},"Explain what this policy is designed to accomplish and its expected outcomes",-1))])]),(0,s.Lk)("div",ti,[(0,s.Lk)("div",ii,[t[100]||(t[100]=(0,s.Lk)("label",null,[(0,s.eW)("Coverage Rate (%) "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",ai,[(0,s.bo)((0,s.Lk)("input",{type:"number",min:"0",max:"100",step:"0.01",placeholder:"Enter coverage rate","onUpdate:modelValue":t[27]||(t[27]=e=>o.policiesForm[o.selectedPolicyIdx].CoverageRate=e),onInput:t[28]||(t[28]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"CoverageRate",e.target.value)),title:"Specify how much of the target area this policy covers (0-100%)"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].CoverageRate]])]),t[101]||(t[101]=(0,s.Lk)("div",{class:"helper-text"},"Specify how much of the target area this policy covers (0-100%)",-1))]),(0,s.Lk)("div",si,[t[102]||(t[102]=(0,s.Lk)("label",null,[(0,s.eW)("Applicability "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",oi,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter applicability","onUpdate:modelValue":t[29]||(t[29]=e=>o.policiesForm[o.selectedPolicyIdx].Applicability=e),onInput:t[30]||(t[30]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"Applicability",e.target.value)),title:"Define the target audience, roles, or entities this policy affects"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].Applicability]])]),t[103]||(t[103]=(0,s.Lk)("div",{class:"helper-text"},"Define the target audience, roles, or entities this policy affects",-1))])]),(0,s.Lk)("div",li,[(0,s.Lk)("div",ni,[t[104]||(t[104]=(0,s.Lk)("label",null,[(0,s.eW)("Policy Type "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",ri,[(0,s.Lk)("div",ci,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Search or enter new policy type","onUpdate:modelValue":t[31]||(t[31]=e=>o.policiesForm[o.selectedPolicyIdx].PolicyType=e),onInput:t[32]||(t[32]=e=>o.handlePolicyTypeChange(o.selectedPolicyIdx,e.target.value)),list:"policyTypes",title:"e.g., Security Policy, HR Policy, Financial Policy, etc."},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].PolicyType]]),(0,s.Lk)("datalist",di,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ui))),128))])])]),t[105]||(t[105]=(0,s.Lk)("div",{class:"helper-text"},"e.g., Security Policy, HR Policy, Financial Policy, etc.",-1))]),(0,s.Lk)("div",pi,[t[106]||(t[106]=(0,s.Lk)("label",null,[(0,s.eW)("Policy Category "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",mi,[(0,s.Lk)("div",vi,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Search or enter new category","onUpdate:modelValue":t[33]||(t[33]=e=>o.policiesForm[o.selectedPolicyIdx].PolicyCategory=e),onInput:t[34]||(t[34]=e=>o.handlePolicyCategoryChange(o.selectedPolicyIdx,e.target.value)),list:"policyCategories",disabled:!o.policiesForm[o.selectedPolicyIdx].PolicyType,title:"Choose a category that best describes this policy's focus area"},null,40,ki),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].PolicyCategory]]),(0,s.Lk)("datalist",hi,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.getCategoriesForType(o.policiesForm[o.selectedPolicyIdx].PolicyType),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,gi))),128))])])]),t[107]||(t[107]=(0,s.Lk)("div",{class:"helper-text"},"Choose a category that best describes this policy's focus area",-1))])]),(0,s.Lk)("div",yi,[(0,s.Lk)("div",fi,[t[108]||(t[108]=(0,s.Lk)("label",null,[(0,s.eW)("Policy Sub Category "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",bi,[(0,s.Lk)("div",Ci,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Search or enter new sub category","onUpdate:modelValue":t[35]||(t[35]=e=>o.policiesForm[o.selectedPolicyIdx].PolicySubCategory=e),onInput:t[36]||(t[36]=e=>o.handlePolicySubCategoryChange(o.selectedPolicyIdx,e.target.value)),list:"policySubCategories",disabled:!o.policiesForm[o.selectedPolicyIdx].PolicyCategory,title:"Provide more specific classification within the selected category"},null,40,Li),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].PolicySubCategory]]),(0,s.Lk)("datalist",wi,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.getSubCategoriesForCategory(o.policiesForm[o.selectedPolicyIdx].PolicyType,o.policiesForm[o.selectedPolicyIdx].PolicyCategory),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Ei))),128))])])]),t[109]||(t[109]=(0,s.Lk)("div",{class:"helper-text"},"Provide more specific classification within the selected category",-1))]),(0,s.Lk)("div",Ri,[t[111]||(t[111]=(0,s.Lk)("label",null,[(0,s.eW)("Applicable Entities "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",{class:"entities-multi-select",onClick:t[39]||(t[39]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Ii,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:o.policiesForm[o.selectedPolicyIdx].showEntitiesDropdown}]),onClick:t[37]||(t[37]=e=>o.toggleEntitiesDropdown(o.selectedPolicyIdx))},[(0,s.Lk)("div",Di,[o.isAllEntitiesSelected(o.selectedPolicyIdx)?((0,s.uX)(),(0,s.CE)("span",Pi," All Locations ")):0===o.getSelectedEntitiesCount(o.selectedPolicyIdx)?((0,s.uX)(),(0,s.CE)("span",_i," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",Ai,(0,d.v_)(o.getSelectedEntitiesCount(o.selectedPolicyIdx))+" location(s) selected ",1))]),t[110]||(t[110]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),o.policiesForm[o.selectedPolicyIdx].showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",Si,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:t=>o.selectEntity(o.selectedPolicyIdx,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?o.isAllEntitiesSelected(o.selectedPolicyIdx):o.getSelectedEntityIds(o.selectedPolicyIdx).includes(e.id),onChange:t=>o.handleEntitySelection(o.selectedPolicyIdx,e.id,t.target.checked),onClick:t[38]||(t[38]=(0,a.D$)(()=>{},["stop"]))},null,40,xi),(0,s.Lk)("span",Fi,(0,d.v_)(e.label),1)],10,Ti))),128))])):(0,s.Q3)("",!0)])]),t[112]||(t[112]=(0,s.Lk)("div",{class:"helper-text"},"Select the locations/entities this policy applies to",-1))])]),(0,s.Lk)("div",Vi,[(0,s.Lk)("div",Ui,[t[113]||(t[113]=(0,s.Lk)("label",null,[(0,s.eW)("Start Date "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",Ni,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[40]||(t[40]=e=>o.policiesForm[o.selectedPolicyIdx].StartDate=e),onInput:t[41]||(t[41]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"StartDate",e.target.value)),title:"Date when this policy takes effect and becomes enforceable"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].StartDate]])]),t[114]||(t[114]=(0,s.Lk)("div",{class:"helper-text"},"Date when this policy takes effect and becomes enforceable",-1))]),(0,s.Lk)("div",Mi,[t[115]||(t[115]=(0,s.Lk)("label",null,"End Date",-1)),(0,s.Lk)("div",Xi,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[42]||(t[42]=e=>o.policiesForm[o.selectedPolicyIdx].EndDate=e),onInput:t[43]||(t[43]=e=>o.handlePolicyChange(o.selectedPolicyIdx,"EndDate",e.target.value)),title:"Date when this policy expires or requires review/renewal"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].EndDate]])]),t[116]||(t[116]=(0,s.Lk)("div",{class:"helper-text"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("button",{class:"upload-btn",type:"button",onClick:t[44]||(t[44]=()=>o.handlePolicyFileUpload(o.selectedPolicyIdx)),title:"Upload supporting documentation for this policy"},t[117]||(t[117]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Upload Document ")])),o.policiesForm[o.selectedPolicyIdx].DocURL?((0,s.uX)(),(0,s.CE)("span",$i,(0,d.v_)(o.policiesForm[o.selectedPolicyIdx].DocURL.name),1)):(0,s.Q3)("",!0),(0,s.Lk)("input",{type:"file",ref:e=>o.setPolicyFileInputRef(e,o.selectedPolicyIdx),style:{display:"none"},onChange:t[45]||(t[45]=e=>o.onPolicyFileChange(e,o.selectedPolicyIdx))},null,544)])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),null!==o.selectedPolicyIdx&&o.policiesForm[o.selectedPolicyIdx]?((0,s.uX)(),(0,s.CE)("div",Oi,[t[126]||(t[126]=(0,s.Lk)("div",{class:"subpolicy-header-row",style:{display:"flex","align-items":"center","justify-content":"space-between"}},[(0,s.Lk)("h3",{style:{margin:"0"}},"Subpolicy Creation")],-1)),(0,s.Lk)("div",ji,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policiesForm[o.selectedPolicyIdx].subpolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["subpolicy-step",{active:o.selectedSubPolicyIdx[o.selectedPolicyIdx]===t}]),onClick:e=>o.selectedSubPolicyIdx[o.selectedPolicyIdx]=t},[(0,s.eW)((0,d.v_)(e.SubPolicyName||`Subpolicy ${t+1}`)+" ",1),(0,s.Lk)("button",{class:"remove-btn",onClick:(0,a.D$)(e=>o.handleRemoveSubPolicy(o.selectedPolicyIdx,t),["stop"]),title:"Remove Sub Policy"},"✕",8,Wi)],10,Bi))),128)),(0,s.Lk)("button",{class:"add-subpolicy-step-btn",onClick:t[46]||(t[46]=e=>o.handleAddSubPolicy(o.selectedPolicyIdx))}," + Add Sub Policy ")]),null!==o.selectedSubPolicyIdx[o.selectedPolicyIdx]&&o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]]?((0,s.uX)(),(0,s.CE)("div",qi,[(0,s.Lk)("div",Qi,[(0,s.Lk)("b",Ki,(0,d.v_)(o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].SubPolicyName||`Sub Policy ${o.selectedSubPolicyIdx[o.selectedPolicyIdx]+1}`),1),(0,s.Lk)("button",{class:"remove-btn",onClick:t[47]||(t[47]=e=>o.handleRemoveSubPolicy(o.selectedPolicyIdx,o.selectedSubPolicyIdx[o.selectedPolicyIdx])),title:"Remove Sub Policy"},"✕")]),(0,s.Lk)("div",Ji,[t[118]||(t[118]=(0,s.Lk)("label",null,[(0,s.eW)("Sub Policy Name "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",zi,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter sub policy name","onUpdate:modelValue":t[48]||(t[48]=e=>o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].SubPolicyName=e),onInput:t[49]||(t[49]=e=>o.handleSubPolicyChange(o.selectedPolicyIdx,o.selectedSubPolicyIdx[o.selectedPolicyIdx],"SubPolicyName",e.target.value)),title:"Use a clear name that describes this sub-policy's specific focus"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].SubPolicyName]])]),t[119]||(t[119]=(0,s.Lk)("div",{class:"helper-text"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",Hi,[t[120]||(t[120]=(0,s.Lk)("label",null,[(0,s.eW)("Identifier "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",Gi,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Enter identifier","onUpdate:modelValue":t[50]||(t[50]=e=>o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Identifier=e),onInput:t[51]||(t[51]=e=>o.handleSubPolicyChange(o.selectedPolicyIdx,o.selectedSubPolicyIdx[o.selectedPolicyIdx],"Identifier",e.target.value)),title:"Use a unique code like 'SUB-001' or append to parent policy ID"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Identifier]])]),t[121]||(t[121]=(0,s.Lk)("div",{class:"helper-text"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",Yi,[t[122]||(t[122]=(0,s.Lk)("label",null,[(0,s.eW)("Control "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",Zi,[(0,s.bo)((0,s.Lk)("textarea",{type:"text",placeholder:"Enter control","onUpdate:modelValue":t[52]||(t[52]=e=>o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Control=e),onInput:t[53]||(t[53]=e=>o.handleSubPolicyChange(o.selectedPolicyIdx,o.selectedSubPolicyIdx[o.selectedPolicyIdx],"Control",e.target.value)),rows:"3",title:"Specify the control mechanisms, procedures, or safeguards to be implemented",maxlength:"1000"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Control]]),(0,s.Lk)("div",{class:(0,d.C4)(["character-counter",o.getCharacterCounterClass(o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Control,1e3)])},(0,d.v_)((o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Control||"").length)+"/1000 ",3)]),t[123]||(t[123]=(0,s.Lk)("div",{class:"helper-text"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",ea,[t[124]||(t[124]=(0,s.Lk)("label",null,[(0,s.eW)("Description "),(0,s.Lk)("span",{class:"required-star"},"*")],-1)),(0,s.Lk)("div",ta,[(0,s.bo)((0,s.Lk)("textarea",{placeholder:"Enter description","onUpdate:modelValue":t[54]||(t[54]=e=>o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Description=e),onInput:t[55]||(t[55]=e=>o.handleSubPolicyChange(o.selectedPolicyIdx,o.selectedSubPolicyIdx[o.selectedPolicyIdx],"Description",e.target.value)),rows:"3",title:"Explain the purpose, scope, and specific requirements of this sub-policy",maxlength:"1000"},null,544),[[a.Jo,o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Description]]),(0,s.Lk)("div",{class:(0,d.C4)(["character-counter",o.getCharacterCounterClass(o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Description,1e3)])},(0,d.v_)((o.policiesForm[o.selectedPolicyIdx].subpolicies[o.selectedSubPolicyIdx[o.selectedPolicyIdx]].Description||"").length)+"/1000 ",3)]),t[125]||(t[125]=(0,s.Lk)("div",{class:"helper-text"},"Explain the purpose, scope, and specific requirements of this sub-policy",-1))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),o.policiesForm.length>0?((0,s.uX)(),(0,s.CE)("div",ia,[(0,s.Lk)("button",{class:"create-btn",onClick:t[56]||(t[56]=(...e)=>o.handleSubmitPolicy&&o.handleSubmitPolicy(...e)),disabled:o.loading,style:{"font-size":"1rem","margin-top":"24px"}},(0,d.v_)(o.loading?"Submitting...":"Submit"),9,aa)])):(0,s.Q3)("",!0)])),(0,s.bF)(c)])}i(116),i(7588),i(3579),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698);const ha=(0,ie.KR)({visible:!1,type:"info",heading:"",message:"",buttons:[],autoClose:0,inputPlaceholder:"Enter your comment...",selectOptions:[],selectedValue:""}),ga=(0,ie.KR)(new Map),ya={show(e){console.log("[POPUP_SERVICE] show() called with config:",e),console.log("[POPUP_SERVICE] Current popup state before update:",ha.value),ha.value={...ha.value,...e,visible:!0},console.log("[POPUP_SERVICE] Popup state updated:",ha.value),console.log("[POPUP_SERVICE] Popup should now be visible:",ha.value.visible)},hide(){ha.value.visible=!1},getState(){return ha},handleAction({action:e,comment:t}){console.log("DEBUG PopupService: handleAction called with:",{action:e,comment:t});const i=ga.value.get(e);console.log("DEBUG PopupService: Found callback for action:",e,i?"YES":"NO"),i?(console.log("DEBUG PopupService: Executing callback with comment:",t),this.hide(),console.log("DEBUG PopupService: Popup hidden"),setTimeout(()=>{i(t),console.log("DEBUG PopupService: Callback executed")},100),ga.value.delete(e),console.log("DEBUG PopupService: Callback deleted")):(this.hide(),console.log("DEBUG PopupService: Popup hidden (no callback)"))},onAction(e,t){ga.value.set(e,t)},success(e,t="Success"){this.show({type:"success",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"success"}]})},error(e,t="Error"){this.show({type:"error",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"error"}]})},warning(e,t="Warning"){this.show({type:"warning",heading:t,message:e,buttons:[{label:"OK",action:"ok",class:"warning"}]})},confirm(e,t="Confirm",i,a){this.show({type:"confirm",heading:t,message:e,buttons:[{label:"Yes",action:"yes",class:"success"},{label:"No",action:"no",class:"error"}]}),i&&this.onAction("yes",i),a&&this.onAction("no",a)},comment(e,t="Comment",i){this.show({type:"comment",heading:t,message:e,buttons:[{label:"Submit",action:"submit",class:"success"},{label:"Cancel",action:"cancel",class:"error"}]}),i&&this.onAction("submit",i)},select(e,t="Select",i,a){this.show({type:"select",heading:t,message:e,selectOptions:i,selectedValue:i.length>0?i[0].value:"",buttons:[{label:"Submit",action:"submit",class:"success"},{label:"Cancel",action:"cancel",class:"error"}]}),a&&this.onAction("submit",a)},accessDenied(e="You don't have permission to access this feature. Please contact your administrator to activate this feature.",t="Access Denied",i){console.log("[POPUP_SERVICE] accessDenied called with:",{message:e,heading:t,hasCallback:!!i});const a={type:"access-denied",heading:t,message:e,buttons:[{label:"Contact Admin",action:"contact-admin",class:"warning"},{label:"OK",action:"ok",class:"error"}]};console.log("[POPUP_SERVICE] Popup config created:",a);try{this.show(a),console.log("[POPUP_SERVICE] show() method called successfully"),console.log("[POPUP_SERVICE] Current popup state after show():",ha.value),i&&(this.onAction("contact-admin",i),console.log("[POPUP_SERVICE] Contact admin callback registered"))}catch(s){console.error("[POPUP_SERVICE] Error in accessDenied method:",s)}}};var fa=ya;const ba={key:0,class:"popup-icon"},Ca=["innerHTML"],La={class:"popup-heading"},wa={class:"popup-message"},Ea=["placeholder"],Ra=["value"],Ia={class:"popup-actions"},Da=["onClick"];function Pa(e,t,i,o,l,n){return n.visible?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"popup-backdrop",onKeydown:t[3]||(t[3]=(0,a.jR)((...e)=>n.onClose&&n.onClose(...e),["esc"])),tabindex:"0","aria-modal":"true",role:"dialog"},[(0,s.Lk)("div",{class:(0,d.C4)(["popup-modal",n.type])},[n.icon?((0,s.uX)(),(0,s.CE)("div",ba,[(0,s.Lk)("span",{innerHTML:n.icon},null,8,Ca)])):(0,s.Q3)("",!0),(0,s.Lk)("h2",La,(0,d.v_)(n.heading),1),(0,s.Lk)("p",wa,(0,d.v_)(n.message),1),"comment"===n.type?(0,s.bo)(((0,s.uX)(),(0,s.CE)("textarea",{key:1,"onUpdate:modelValue":t[0]||(t[0]=e=>l.comment=e),class:"popup-input",placeholder:n.inputPlaceholder,onKeydown:t[1]||(t[1]=(0,a.jR)((0,a.D$)(()=>{},["stop"]),["enter"]))},null,40,Ea)),[[a.Jo,l.comment]]):(0,s.Q3)("",!0),"select"===n.type?(0,s.bo)(((0,s.uX)(),(0,s.CE)("select",{key:2,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedValue=e),class:"popup-select"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,Ra))),128))],512)),[[a.u1,l.selectedValue]]):(0,s.Q3)("",!0),(0,s.Lk)("div",Ia,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.buttons,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:t,onClick:t=>n.onAction(e.action),class:(0,d.C4)(e.class)},(0,d.v_)(e.label),11,Da))),128))])],2)],32)):(0,s.Q3)("",!0)}const _a={success:"✓",error:"✗",warning:"⚠️",info:"ℹ️",confirm:"❓",comment:"💬",select:"📋","access-denied":"🚫"};var Aa={name:"PopupModal",setup(){const e=ya.getState();return{popupState:e}},computed:{visible(){return this.popupState.visible},type(){return this.popupState.type},heading(){return this.popupState.heading},message(){return this.popupState.message},buttons(){return this.popupState.buttons},autoClose(){return this.popupState.autoClose},icon(){return _a[this.type]||""},selectOptions(){return this.popupState.selectOptions||[]},inputPlaceholder(){return this.popupState.inputPlaceholder}},watch:{visible(e){e&&this.autoClose>0&&setTimeout(()=>this.onAction("auto-close"),this.autoClose),e&&(this.comment="",this.selectedValue=this.popupState.selectedValue||"")}},data(){return{comment:"",selectedValue:""}},methods:{onClose(){this.onAction("close")},onAction(e){"comment"===this.type?ya.handleAction({action:e,comment:this.comment}):"select"===this.type?ya.handleAction({action:e,comment:this.selectedValue}):ya.handleAction({action:e})}}};const Sa=(0,le.A)(Aa,[["render",Pa],["__scopeId","data-v-f6ef7506"]]);var Ta=Sa,xa=i(2545);const Fa="http://localhost:8000/api";var Va={name:"CreatePolicy",components:{PopupModal:Ta,CustomDropdown:xa.A},setup(){const e=(0,ie.KR)([]),t=(0,ae.rd)(),i=(0,ie.KR)(""),a=(0,ie.KR)([]),o=(0,ie.KR)(null),l=(0,ie.KR)(!1),n=(0,ie.KR)(!1),r=(0,ie.KR)({createdBy:"",createdByName:localStorage.getItem("username")||"",reviewer:""}),c=(0,ie.KR)({UserId:null,UserName:localStorage.getItem("username")||"",Role:null}),d=(0,ie.KR)([]),u=(0,ie.KR)(!1),p=(0,ie.KR)(null),m=(0,ie.KR)([]),v=(0,ie.KR)(null),k=(0,ie.KR)([]),h=(0,ie.KR)([]),g=(0,ie.KR)([]),y=(0,ie.KR)([]),f=(0,ie.KR)({FrameworkName:"",Identifier:"",FrameworkDescription:"",Category:"",StartDate:"",EndDate:"",DocURL:"",InternalExternal:""}),b=async e=>{if(!e||e.length<4)return"";const t=e.substring(0,4).toUpperCase();let i=1,a=`${t}${i}`;while(y.value.includes(a))i++,a=`${t}${i}`;return a},C=e=>{if(!e)return"";const t=e.split(" ").filter(e=>e.length>0);return t.map(e=>e.charAt(0).toUpperCase()).join("")},L=(e,t)=>e?`${e}-${t+1}`:"",w=async()=>{try{const e=await He.A.get(`${Fa}/frameworks/`,{params:{include_all_for_identifiers:"true"}});y.value=e.data.map(e=>e.Identifier).filter(e=>e),console.log("Fetched existing framework identifiers:",y.value)}catch(e){console.error("Error fetching existing framework identifiers:",e)}},E=async()=>{if("Internal"===f.value.InternalExternal&&f.value.FrameworkName){const e=await b(f.value.FrameworkName);f.value.Identifier=e}},R=e=>{const t=a.value[e];if(!t)return;const s="__new__"===i.value&&"Internal"===v.value?.InternalExternal||"__new__"!==i.value&&""!==i.value&&"Internal"===d.value.find(e=>e.id===i.value)?.InternalExternal;if(s&&t.PolicyName){const e=C(t.PolicyName);t.Identifier=e,t.subpolicies.forEach((t,i)=>{t.SubPolicyName&&(t.Identifier=L(e,i))})}},I=(e,t)=>{const s=a.value[e],o=s?.subpolicies[t];if(!s||!o)return;const l="__new__"===i.value&&"Internal"===v.value?.InternalExternal||"__new__"!==i.value&&""!==i.value&&"Internal"===d.value.find(e=>e.id===i.value)?.InternalExternal;l&&o.SubPolicyName&&s.Identifier&&(o.Identifier=L(s.Identifier,t))},D=()=>"__new__"===i.value&&"Internal"===v.value?.InternalExternal||"__new__"!==i.value&&""!==i.value&&"Internal"===d.value.find(e=>e.id===i.value)?.InternalExternal;async function P(){try{u.value=!0;const e=await He.A.get(`${Fa}/frameworks/`);d.value=e.data.map(e=>({id:e.FrameworkId,name:e.FrameworkName,InternalExternal:e.InternalExternal}))}catch(e){console.error("Error fetching frameworks:",e),fa.error("Failed to fetch frameworks","Loading Error"),se({title:"Framework Loading Failed",message:"Failed to fetch frameworks. Please try again.",category:"framework",priority:"medium",user_id:c.value?.UserId||"default_user"})}finally{u.value=!1}}(0,s.wB)(()=>f.value.FrameworkName,E),(0,s.wB)(()=>f.value.InternalExternal,E),(0,s.wB)(i,e=>{"create"===e?(n.value=!0,i.value=""):e&&!n.value&&0===a.value.length&&(S(),o.value=0)});const _=async()=>{p.value=null,v.value={...f.value},n.value=!1,S(),i.value="__new__",f.value={FrameworkName:"",Identifier:"",FrameworkDescription:"",Category:"",StartDate:"",EndDate:"",DocURL:"",InternalExternal:""},w()},A=()=>{f.value={...v.value},n.value=!0,i.value="",a.value=[],o.value=null,e.value=[]},S=()=>{const t={PolicyName:"",Identifier:"",PolicyDescription:"",Scope:"",Objective:"",Department:"",Applicability:"",StartDate:"",EndDate:"",CreatedByName:"",DocURL:"",PolicyType:"",PolicyCategory:"",PolicySubCategory:"",Entities:[],subpolicies:[]};a.value.push(t),o.value=a.value.length-1,e.value.push(null),D()&&setTimeout(()=>{R(a.value.length-1)},100)},T=t=>{a.value=a.value.filter((e,i)=>i!==t),e.value=e.value.filter((e,i)=>i!==t),a.value.length>0?o.value>t?o.value=o.value-1:o.value===t&&(o.value=Math.max(0,t-1)):o.value=null},x=(e,t,i)=>{a.value[e][t]=i,"PolicyName"===t&&R(e)},F=t=>{a.value[t].subpolicies.push({SubPolicyName:"",Identifier:"",Control:"",Description:"",CreatedByName:"",PermanentTemporary:""});const i=a.value[t].subpolicies.length-1;I(t,i),e.value[t]=i},V=(t,i)=>{a.value[t].subpolicies=a.value[t].subpolicies.filter((e,t)=>t!==i),e.value[t]===i?e.value[t]=Math.max(0,i-1):e.value[t]>i&&e.value[t]--},U=(e,t,i,s)=>{a.value[e].subpolicies[t][i]=s,"SubPolicyName"===i&&I(e,t)},N=()=>{l.value=!0};async function M(){try{const e=await He.A.get("http://localhost:8000/api/user-role/");e.data.success&&(c.value={UserId:e.data.user_id,UserName:e.data.username||e.data.user_name||localStorage.getItem("username")||"",Role:e.data.role},r.value.createdByName=c.value.UserName,r.value.createdBy=c.value.UserId,console.log("Current user loaded:",c.value))}catch(e){console.error("Error fetching current user:",e);const t=localStorage.getItem("username");t&&(c.value.UserName=t,r.value.createdByName=t)}}async function X(){try{u.value=!0;const e=await He.A.get(`${Fa}/policy-users/`);m.value=e.data}catch(e){console.error("Error fetching users:",e),fa.error("Failed to fetch users","Loading Error"),se({title:"Users Loading Failed",message:"Failed to fetch users. Please try again.",category:"policy",priority:"medium",user_id:c.value?.UserId||"default_user"})}finally{u.value=!1}}async function $(){try{u.value=!0;const e=await He.A.get(`${Fa}/policy-categories/`);k.value=e.data,h.value=[...new Set(k.value.map(e=>e.PolicyType).filter(Boolean))]}catch(e){console.error("Error fetching policy categories:",e),fa.error("Failed to fetch policy categories","Loading Error"),se({title:"Policy Categories Loading Failed",message:"Failed to fetch policy categories. Please try again.",category:"policy",priority:"medium",user_id:c.value?.UserId||"default_user"})}finally{u.value=!1}}async function O(){try{const e=await He.A.get(`${Fa}/entities/`);g.value=e.data.entities||[]}catch(e){console.error("Error fetching entities:",e),fa.error("Failed to fetch entities","Loading Error"),se({title:"Entities Loading Failed",message:"Failed to fetch entities. Please try again.",category:"policy",priority:"medium",user_id:c.value?.UserId||"default_user"})}}const j=e=>e?[...new Set(k.value.filter(t=>t.PolicyType===e).map(e=>e.PolicyCategory).filter(Boolean))]:[],B=(e,t)=>e&&t?[...new Set(k.value.filter(i=>i.PolicyType===e&&i.PolicyCategory===t).map(e=>e.PolicySubCategory).filter(Boolean))]:[],W=async(e,t)=>{a.value[e].PolicyType=t,a.value[e].PolicyCategory="",a.value[e].PolicySubCategory="",await(0,s.dY)()},q=async(e,t)=>{a.value[e].PolicyCategory=t,a.value[e].PolicySubCategory=""},Q=(e,t)=>{a.value[e].PolicySubCategory=t},K=(e,t)=>{t.includes("all")?a.value[e].Entities="all":a.value[e].Entities=t.filter(e=>"all"!==e)},J=e=>"all"===a.value[e].Entities,z=e=>{const t=a.value[e].Entities;return"all"===t?["all"]:Array.isArray(t)?t.filter(e=>"all"!==e):[]},H=e=>{const t=a.value[e].Entities;return"all"===t?0:Array.isArray(t)?t.filter(e=>"all"!==e).length:0},G=e=>{a.value.forEach((t,i)=>{i!==e&&(t.showEntitiesDropdown=!1)}),void 0===a.value[e].showEntitiesDropdown&&(a.value[e].showEntitiesDropdown=!1),a.value[e].showEntitiesDropdown=!a.value[e].showEntitiesDropdown},Y=()=>{a.value.forEach(e=>{e.showEntitiesDropdown=!1})},Z=(e,t,i)=>{console.log("handleEntitySelection called:",{idx:e,entityId:t,isChecked:i});let s=z(e);console.log("Current selected entities:",s),"all"===t?i?(a.value[e].Entities="all",console.log('Set entities to "all"')):(a.value[e].Entities=[],console.log("Cleared entities")):(i?(s.includes("all")&&(s=[]),s.includes(t)||s.push(t)):s=s.filter(e=>e!==t&&"all"!==e),a.value[e].Entities=s,console.log("Updated entities to:",s)),console.log("Final policy entities:",a.value[e].Entities)},ee=(e,t)=>{const i=a.value[e].Entities;let s=!1;s="all"===t?"all"===i:Array.isArray(i)&&i.includes(t),Z(e,t,!s)},te=async()=>{try{console.log("Checking for new policy categories to save...");const e=[];for(const t of a.value){const i=t.PolicyType?.trim(),a=t.PolicyCategory?.trim(),s=t.PolicySubCategory?.trim();if(!i||!a||!s)continue;const o=k.value.some(e=>e.PolicyType===i&&e.PolicyCategory===a&&e.PolicySubCategory===s);o||(console.log(`Found new combination: ${i} > ${a} > ${s}`),e.push({PolicyType:i,PolicyCategory:a,PolicySubCategory:s}))}if(e.length>0){console.log(`Saving ${e.length} new policy category combinations...`);for(const t of e)await He.A.post(`${Fa}/policy-categories/save/`,t);await $(),console.log("Policy categories refreshed")}else console.log("No new policy category combinations to save")}catch(e){console.error("Error saving policy categories:",e)}},se=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(p){console.error("Error sending push notification:",p)}},oe=async()=>{try{u.value=!0,p.value=null,await te();const o="__new__"===i.value;if(o&&(!v.value||!v.value.FrameworkName))return fa.error("Please fill in all required framework fields.","Validation Error"),se({title:"Framework Creation Failed",message:"Please fill in all required framework fields.",category:"framework",priority:"high",user_id:c.value?.UserId||"default_user"}),void(u.value=!1);const n=m.value.find(e=>e.UserName===r.value.createdByName)||c.value,d=m.value.find(e=>e.UserId===r.value.reviewer);if(!r.value.createdByName)return fa.error("Creator name not found. Please try logging in again.","Validation Error"),se({title:"Policy Creation Failed",message:"Creator name not found. Please try logging in again.",category:"policy",priority:"high",user_id:c.value?.UserId||"default_user"}),void(u.value=!1);for(const e of a.value){if(!e.PolicyName||!e.Identifier||!e.StartDate)return fa.error("Please fill in all required fields (Policy Name, Identifier, and Start Date) for all policies","Validation Error"),se({title:"Policy Creation Failed",message:"Please fill in all required fields (Policy Name, Identifier, and Start Date) for all policies",category:"policy",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1);if(!e.subpolicies||0===e.subpolicies.length)return fa.error("Each policy must have at least one subpolicy.","Validation Error"),se({title:"Policy Creation Failed",message:"Each policy must have at least one subpolicy.",category:"policy",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1);e.Status=e.Status||"Under Review",e.ActiveInactive=e.ActiveInactive||"Inactive",e.CreatedByName=n.UserName,e.Reviewer=d?d.UserName:null;for(const t of e.subpolicies){if(!t.SubPolicyName||!t.Identifier)return fa.error("Please fill in all required fields (Name and Identifier) for all subpolicies","Validation Error"),se({title:"Policy Creation Failed",message:"Please fill in all required fields (Name and Identifier) for all subpolicies",category:"policy",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1);t.Status=t.Status||"Under Review",t.CreatedByName=n.UserName}}if(console.log("DEBUG: Policies after validation:",a.value.map(e=>({PolicyName:e.PolicyName,Entities:e.Entities}))),o){if(v.value.DocURL&&v.value.DocURL instanceof File){const t=new FormData;t.append("file",v.value.DocURL),t.append("userId",n.UserId),t.append("fileName",v.value.DocURL.name),t.append("type","framework"),t.append("frameworkName",v.value.FrameworkName);try{const e=await He.A.post("http://localhost:8000/api/upload-policy-document/",t,{headers:{"Content-Type":"multipart/form-data"},timeout:1e6});if(!e.data.success)throw new Error(e.data.error||"Upload failed");v.value.DocURL=e.data.file.url}catch(e){return console.error("Error uploading framework document:",e),fa.error("Failed to upload framework document: "+(e.response?.data?.error||e.message),"Upload Error"),se({title:"Framework Document Upload Failed",message:`Failed to upload framework document: ${e.response?.data?.error||e.message}`,category:"framework",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1)}}for(const s of a.value)if(s.DocURL&&s.DocURL instanceof File){const t=new FormData;t.append("file",s.DocURL),t.append("userId",n.UserId),t.append("fileName",s.DocURL.name),t.append("type","policy"),t.append("policyName",s.PolicyName);try{const e=await He.A.post("http://localhost:8000/api/upload-policy-document/",t,{headers:{"Content-Type":"multipart/form-data"},timeout:1e6});if(!e.data.success)throw new Error(e.data.error||"Upload failed");s.DocURL=e.data.file.url}catch(e){return console.error("Error uploading policy document:",e),fa.error("Failed to upload policy document: "+(e.response?.data?.error||e.message),"Upload Error"),se({title:"Policy Document Upload Failed",message:`Failed to upload policy document: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1)}}console.log("Policies form data before payload creation:",JSON.stringify(a.value,null,2));const t={...v.value,CreatedByName:n.UserName,CreatedById:n.UserId,Reviewer:d?d.UserId:null,policies:a.value.map((e,t)=>{console.log(`DEBUG: Processing policy ${t}, Entities before mapping:`,e.Entities);const i={...e,CoverageRate:""!==e.CoverageRate&&null!==e.CoverageRate&&void 0!==e.CoverageRate?Number(e.CoverageRate):null,CreatedByName:n.UserName,CreatedById:n.UserId,Reviewer:d?d.UserId:null,Entities:e.Entities,subpolicies:e.subpolicies.map(e=>({...e,CreatedByName:n.UserName,CreatedByDate:(new Date).toISOString().split("T")[0],Status:"Under Review",PermanentTemporary:""}))};return console.log(`DEBUG: Policy ${t} after mapping, Entities:`,i.Entities),i})};console.log("Final payload being sent:",JSON.stringify(t,null,2));const i=await He.A.post(`${Fa}/frameworks/`,t);if(i.data.error)throw new Error(i.data.error);fa.success("Successfully created new framework and policies! Redirecting to All Policies page...","Framework Created"),se({title:"Framework and Policies Created Successfully",message:`New framework "${v.value.FrameworkName}" with ${a.value.length} policies has been created successfully.`,category:"framework",priority:"medium",user_id:n?.UserId||"default_user"})}else{const t=i.value;for(const i of a.value)if(i.DocURL&&i.DocURL instanceof File){const t=new FormData;t.append("file",i.DocURL),t.append("userId",n.UserId),t.append("fileName",i.DocURL.name),t.append("type","policy"),t.append("policyName",i.PolicyName);try{const e=await He.A.post("http://localhost:8000/api/upload-policy-document/",t,{headers:{"Content-Type":"multipart/form-data"},timeout:1e6});if(!e.data.success)throw new Error(e.data.error||"Upload failed");i.DocURL=e.data.file.url}catch(e){return console.error("Error uploading policy document:",e),fa.error("Failed to upload policy document: "+(e.response?.data?.error||e.message),"Upload Error"),se({title:"Policy Document Upload Failed",message:`Failed to upload policy document: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1)}}const o=a.value.map(e=>({...e,CoverageRate:""!==e.CoverageRate&&null!==e.CoverageRate&&void 0!==e.CoverageRate?Number(e.CoverageRate):null,CreatedByName:n.UserName,CreatedById:n.UserId,Reviewer:d?d.UserId:null,subpolicies:e.subpolicies.map(e=>({...e,CreatedByName:n.UserName,CreatedByDate:(new Date).toISOString().split("T")[0],Status:"Under Review",PermanentTemporary:""}))}));try{const e=await He.A.post(`${Fa}/frameworks/${t}/policies/`,{policies:o});if(e.data.error)throw new Error(e.data.error);fa.success("Successfully added policies! Redirecting to All Policies page...","Policies Added"),se({title:"Policies Added Successfully",message:`Successfully added ${a.value.length} policies to the existing framework.`,category:"policy",priority:"medium",user_id:n?.UserId||"default_user"})}catch(s){console.error("Error submitting policies:",s);const e=s.response?.data?.details||s.response?.data?.error||"Failed to submit policies";return fa.error("object"===typeof e?JSON.stringify(e):e,"Submission Error"),se({title:"Policy Submission Failed",message:"object"===typeof e?JSON.stringify(e):e,category:"policy",priority:"high",user_id:n?.UserId||"default_user"}),void(u.value=!1)}}a.value=[],r.value={createdBy:c.value.UserId||"",createdByName:c.value.UserName||localStorage.getItem("username")||"",reviewer:""},i.value="",l.value=!1,v.value=null,setTimeout(()=>{t.push("/policies-list/all")},1500)}catch(s){console.error("Error submitting policies:",s);const e=s.response?.data?.details||s.response?.data?.error||"Failed to submit policies";fa.error("object"===typeof e?JSON.stringify(e):e,"Submission Error"),se({title:"Policy Submission Failed",message:"object"===typeof e?JSON.stringify(e):e,category:"policy",priority:"high",user_id:c.value?.UserId||"default_user"})}finally{u.value=!1}},le=()=>{const e=d.value.find(e=>e.id===i.value);return e?e.name:""},ne=()=>{i.value="",a.value=[]},re=(0,ie.KR)(null),ce=(0,ie.KR)({}),de=(e,t)=>{e&&(ce.value[t]=e)},ue=()=>{re.value&&re.value.click()},pe=e=>{ce.value[e]&&ce.value[e].click()},me=e=>{const t=e.target.files[0];t&&(f.value.DocURL=t)},ve=(e,t)=>{const i=e.target.files[0];i&&(a.value[t].DocURL=i)};(0,s.sV)(async()=>{await M(),P(),X(),$(),w(),O(),e.value=a.value.map(()=>null)});const ke=(0,ie.KR)(!1),he=(0,ie.KR)({SubPolicyName:"",Identifier:"",Control:"",Description:""}),ge=()=>{he.value.SubPolicyName&&(a.value[o.value].subpolicies.push({...he.value}),he.value={SubPolicyName:"",Identifier:"",Control:"",Description:""},ke.value=!1)},ye=(0,s.EW)(()=>({label:"Framework",options:[{label:"Select",value:""},{label:"+ Create New Framework",value:"create"},...d.value.map(e=>({label:e.name,value:e.id}))]})),fe=(e,t)=>{if(!e)return"";const i=e.length,a=i/t*100;return a>=90?"error":a>=75?"warning":""};return{selectedFramework:i,policiesForm:a,selectedPolicyIdx:o,frameworks:d,showApprovalForm:l,showFrameworkForm:n,approvalForm:r,newFramework:f,loading:u,error:p,users:m,currentUser:c,policyCategories:k,policyTypes:h,entities:g,handleAddPolicy:S,handleRemovePolicy:T,handlePolicyChange:x,handleAddSubPolicy:F,handleRemoveSubPolicy:V,handleSubPolicyChange:U,handleSubmitPolicy:N,handleFinalSubmit:oe,handleCreateFramework:_,goBackToFramework:A,getSelectedFrameworkName:le,handleChangeFramework:ne,frameworkFormData:v,frameworkFileInput:re,policyFileInputRefs:ce,setPolicyFileInputRef:de,handleFrameworkFileUpload:ue,handlePolicyFileUpload:pe,onFrameworkFileChange:me,onPolicyFileChange:ve,getCategoriesForType:j,getSubCategoriesForCategory:B,handlePolicyTypeChange:W,handlePolicyCategoryChange:q,handlePolicySubCategoryChange:Q,handleEntityChange:K,isAllEntitiesSelected:J,getSelectedEntityIds:z,getSelectedEntitiesCount:H,toggleEntitiesDropdown:G,closeAllEntityDropdowns:Y,handleEntitySelection:Z,selectEntity:ee,generateFrameworkIdentifier:b,generatePolicyIdentifier:C,generateSubPolicyIdentifier:L,autoGenerateFrameworkIdentifier:E,autoGeneratePolicyIdentifiers:R,autoGenerateSubPolicyIdentifier:I,isInternalFramework:D,showAddSubPolicyForm:ke,newSubPolicy:he,addNewSubPolicy:ge,selectedSubPolicyIdx:e,frameworkDropdownConfig:ye,sendPushNotification:se,getCharacterCounterClass:fe}}};const Ua=(0,le.A)(Va,[["render",ka],["__scopeId","data-v-d35f4c24"]]);var Na=Ua;const Ma={class:"performance-page"},Xa={key:0,class:"access-denied-message"},$a={key:1,class:"loading-message"},Oa={key:2,class:"error-message"},ja={class:"error-card"},Ba={key:3},Wa={class:"search-bar"},qa={class:"search-container"},Qa={key:0,class:"kpi-summary"},Ka={class:"kpi-card"},Ja={class:"kpi-value"},za={class:"kpi-card"},Ha={class:"kpi-value"},Ga={class:"kpi-card"},Ya={class:"kpi-value"},Za={class:"kpi-card"},es={class:"kpi-value"},ts={class:"policy-cards-grid"},is={class:"policy-card-header"},as={class:"policy-card-icon"},ss={class:"policy-card-title"},os={class:"policy-card-progressbar"},ls={class:"progress-bar-main"},ns={class:"policy-card-progress-label"},rs={class:"policy-card-list"},cs={class:"policy-card-list-label"},ds={class:"policy-card-list-progress"},us={class:"progress-bar-sub"};function ps(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Ma,[t[14]||(t[14]=(0,s.Lk)("h2",null,"Performance Dashboard",-1)),o.accessDenied?((0,s.uX)(),(0,s.CE)("div",Xa,t[2]||(t[2]=[(0,s.Lk)("div",{class:"access-denied-card"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.Lk)("h3",null,"Access Denied"),(0,s.Lk)("p",null,"You don't have permission to view Policy KPIs and Performance Data."),(0,s.Lk)("p",null,[(0,s.eW)("Required permission: "),(0,s.Lk)("strong",null,"policy_view")]),(0,s.Lk)("p",null,"Contact your administrator to request access.")],-1)]))):(0,s.Q3)("",!0),o.loading&&!o.accessDenied?((0,s.uX)(),(0,s.CE)("div",$a,t[3]||(t[3]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading Performance Data...",-1)]))):(0,s.Q3)("",!0),o.error&&!o.accessDenied?((0,s.uX)(),(0,s.CE)("div",Oa,[(0,s.Lk)("div",ja,[t[4]||(t[4]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),t[5]||(t[5]=(0,s.Lk)("h3",null,"Error Loading Data",-1)),(0,s.Lk)("p",null,(0,d.v_)(o.error),1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.loadPolicyKPIs&&o.loadPolicyKPIs(...e)),class:"retry-button"},"Retry")])])):(0,s.Q3)("",!0),o.accessDenied||o.loading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Ba,[(0,s.Lk)("div",Wa,[(0,s.Lk)("div",qa,[t[6]||(t[6]=(0,s.Lk)("i",{class:"fas fa-search search-icon"},null,-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>o.searchQuery=e),placeholder:"Search Policies..."},null,512),[[a.Jo,o.searchQuery]])])]),o.kpiData?((0,s.uX)(),(0,s.CE)("div",Qa,[(0,s.Lk)("div",Ka,[(0,s.Lk)("div",Ja,(0,d.v_)(o.kpiData.total_policies||0),1),t[7]||(t[7]=(0,s.Lk)("div",{class:"kpi-label"},"Total Policies",-1))]),(0,s.Lk)("div",za,[(0,s.Lk)("div",Ha,(0,d.v_)(o.kpiData.active_policies||0),1),t[8]||(t[8]=(0,s.Lk)("div",{class:"kpi-label"},"Active Policies",-1))]),(0,s.Lk)("div",Ga,[(0,s.Lk)("div",Ya,(0,d.v_)(o.kpiData.revision_rate||0)+"%",1),t[9]||(t[9]=(0,s.Lk)("div",{class:"kpi-label"},"Revision Rate",-1))]),(0,s.Lk)("div",Za,[(0,s.Lk)("div",es,(0,d.v_)(o.kpiData.coverage_metrics?.overall_coverage_rate||0)+"%",1),t[10]||(t[10]=(0,s.Lk)("div",{class:"kpi-label"},"Coverage Rate",-1))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",ts,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredPolicies,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"policy-card"},[(0,s.Lk)("div",is,[(0,s.Lk)("div",as,(0,d.v_)(e.category.charAt(0)),1),(0,s.Lk)("div",ss,(0,d.v_)(e.name),1),t[11]||(t[11]=(0,s.Lk)("div",{class:"policy-card-upload"},[(0,s.Lk)("i",{class:"fas fa-upload"})],-1))]),(0,s.Lk)("div",os,[(0,s.Lk)("div",ls,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:e.progress})},null,4)]),(0,s.Lk)("span",ns,(0,d.v_)(e.progress)+" Latest results",1)]),t[13]||(t[13]=(0,s.Lk)("div",{class:"policy-card-analytics"},[(0,s.Lk)("span",null,"Analytics"),(0,s.Lk)("span",{class:"policy-card-analytics-arrow"},"▼")],-1)),(0,s.Lk)("div",rs,[t[12]||(t[12]=(0,s.Lk)("div",{class:"policy-card-list-header"},[(0,s.Lk)("span",null,"Performance")],-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"policy-card-list-row"},[(0,s.Lk)("span",cs,(0,d.v_)(e.name),1),(0,s.Lk)("div",ds,[(0,s.Lk)("div",us,[(0,s.Lk)("div",{class:"progress-bar-fill-sub",style:(0,d.Tr)({width:`${e.percent}%`})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["policy-card-list-status","Completed"===e.status?"completed":"inprogress"])},(0,d.v_)(e.status),3)])]))),128))])]))),128))])]))])}var ms={name:"PerformancePage",setup(){const e=(0,ie.KR)(""),t=(0,ie.KR)(!1),i=(0,ie.KR)(""),a=(0,ie.KR)(!1),o=(0,ie.KR)(null),l=(0,ie.KR)([{id:"1.1",name:"Financial Policy",category:"Financial",progress:"40%",subpolicies:[{name:"Budget Management",status:"Completed",percent:95},{name:"Expense Tracking",status:"Completed",percent:88},{name:"Financial Reporting",status:"In Progress",percent:65},{name:"Audit Compliance",status:"In Progress",percent:70},{name:"Risk Assessment",status:"In Progress",percent:45}]},{id:"1.2",name:"Service Policy",category:"Service",progress:"50%",subpolicies:[{name:"Customer Support",status:"Completed",percent:92},{name:"Service Delivery",status:"In Progress",percent:75}]},{id:"2.1",name:"Loan Policy",category:"Loan",progress:"80%",subpolicies:[{name:"Loan Processing",status:"Completed",percent:90},{name:"Credit Assessment",status:"Completed",percent:85},{name:"Risk Evaluation",status:"Completed",percent:88},{name:"Documentation",status:"Completed",percent:92},{name:"Compliance Check",status:"In Progress",percent:60}]}]),n=async()=>{t.value=!0,i.value="",a.value=!1;try{console.log("[RBAC DEBUG] Attempting to load Policy KPIs...");const e=await He.A.get("/policy-kpis/");console.log("[RBAC DEBUG] Policy KPIs loaded successfully:",e.data),o.value=e.data}catch(e){if(console.error("[RBAC DEBUG] Error loading Policy KPIs:",e),e.response){const t=e.response.status;console.log("[RBAC DEBUG] Response status:",t),console.log("[RBAC DEBUG] Response data:",e.response.data),403===t?(a.value=!0,i.value="Access denied: You do not have permission to view Policy KPIs",console.log("[RBAC DEBUG] Access denied - user lacks policy_view permission")):401===t?(a.value=!0,i.value="Authentication required: Please log in to access this page",console.log("[RBAC DEBUG] Authentication required")):i.value=`Server error (${t}): ${e.response.data?.error||"Unknown error"}`}else e.request?i.value="Network error: Unable to connect to the server":i.value=`Request error: ${e.message}`}finally{t.value=!1}},r=(0,s.EW)(()=>l.value.filter(t=>t.name.toLowerCase().includes(e.value.toLowerCase())));return(0,s.sV)(()=>{console.log("[RBAC DEBUG] PerformancePage component mounted, loading Policy KPIs..."),n()}),{searchQuery:e,loading:t,error:i,accessDenied:a,kpiData:o,filteredPolicies:r,loadPolicyKPIs:n}}};const vs=(0,le.A)(ms,[["render",ps],["__scopeId","data-v-91431756"]]);var ks=vs;const hs={key:0},gs={class:"dashboard-container"},ys={class:"dashboard-header"},fs={class:"dashboard-actions"},bs={key:0,class:"user-selection-dropdown"},Cs=["value"],Ls={key:0,class:"user-help-text"},ws={class:"performance-summary"},Es={class:"summary-card growth"},Rs={class:"summary-content"},Is={class:"summary-value"},Ds={class:"summary-card"},Ps={class:"summary-content"},_s={class:"summary-value"},As={class:"summary-card"},Ss={class:"summary-content"},Ts={class:"summary-value"},xs={class:"tabs-container"},Fs={class:"tabs"},Vs={class:"tab-count"},Us={class:"tab-count"},Ns={class:"tab-content"},Ms={key:0,class:"approvals-list"},Xs={key:0,class:"user-info-badge"},$s={class:"collapsible-table-container"},Os={key:0,class:"no-tasks-message"},js={key:1,class:"approvals-list"},Bs={key:0,class:"user-info-badge"},Ws={class:"collapsible-table-container"},qs={key:0,class:"no-tasks-message"},Qs={key:0,class:"policy-details-modal-overlay"},Ks={class:"policy-details-modal"},Js={class:"policy-details-content"},zs={key:0},Hs={key:1},Gs={class:"detail-type-indicator"},Ys={class:"version-pill"},Zs={key:0,class:"approved-only-badge"},eo={key:2,class:"version-history"},to={class:"version-info"},io={class:"version-value"},ao={key:0,class:"subpolicies-versions"},so={class:"version-list"},oo={class:"subpolicy-name"},lo={class:"version-tag"},no={key:0,class:"resubmitted-tag"},ro={key:3,class:"review-status-section"},co={class:"policy-status-indicator"},uo={class:"review-action-section"},po={key:4,class:"policy-approval-section"},mo={class:"policy-status-indicator"},vo={class:"policy-actions"},ko={key:0,class:"policy-approval-status"},ho={class:"status-container"},go={key:0,class:"policy-approved-date"},yo={class:"date-value"},fo={key:1,class:"policy-rejection-remarks"},bo={class:"remarks-value"},Co={key:5},Lo={key:0,class:"compliance-details"},wo={class:"compliance-detail-row"},Eo={class:"compliance-detail-row"},Ro={class:"compliance-detail-row"},Io={class:"compliance-detail-row"},Do={class:"compliance-detail-row"},Po={class:"policy-actions"},_o={key:0},Ao={class:"subpolicy-id"},So={class:"subpolicy-name"},To={key:0},xo={class:"subpolicy-actions"},Fo=["onClick"],Vo=["onClick"],Uo=["onClick"],No={key:6,class:"policy-detail-row"},Mo={key:1,class:"rejected-approvals-list"},Xo=["onClick","title"],$o={key:0,class:"no-rejected-items"},Oo={key:2,class:"edit-policy-modal"},jo={class:"edit-policy-content"},Bo={class:"rejection-reason"},Wo={key:3,class:"edit-policy-modal"},qo={class:"edit-policy-content"},Qo={key:0,class:"rejection-reason-container"},Ko={class:"rejection-reason-content"},Jo=["value"],zo=["value"],Ho=["value"],Go={key:1,class:"edit-subpolicy-section"},Yo={class:"subpolicy-edit-header"},Zo={class:"subpolicy-edit-field"},el=["onUpdate:modelValue"],tl={class:"subpolicy-edit-field"},il=["onUpdate:modelValue"],al={class:"subpolicy-edit-field"},sl=["onUpdate:modelValue"],ol={class:"subpolicy-edit-field"},ll={class:"rejection-reason"},nl={key:4,class:"modal"},rl={class:"modal-content edit-modal"},cl={key:0,class:"version-tag reviewer-version"},dl={key:0},ul={class:"form-group"},pl={class:"form-group"},ml={key:0,class:"rejection-reason-container"},vl={class:"rejection-reason-content"},kl={class:"form-group"},hl={class:"form-group"},gl={key:1,class:"changes-summary"},yl={class:"changes-content"},fl={key:0,class:"change-item"},bl={key:1,class:"change-item"},Cl={class:"form-actions"},Ll=["disabled"],wl={key:5},El={class:"subpolicies-modal"},Rl={class:"subpolicies-modal-content"},Il={key:0},Dl={key:1},Pl={key:2,class:"version-pill reviewer-version"},_l={key:3,class:"version-pill"},Al={class:"subpolicy-header"},Sl={class:"subpolicy-id"},Tl={class:"subpolicy-name"},xl={key:0,class:"version-tag reviewer-version"},Fl={key:1,class:"version-tag"},Vl={class:"subpolicy-content"},Ul={key:0},Nl={key:1,class:"edit-history"},Ml={class:"edit-history-content"},Xl={class:"edit-field"},$l={key:0},Ol={class:"field-previous"},jl={class:"field-current"},Bl={class:"field-value"},Wl={class:"edit-field"},ql={key:0},Ql={class:"field-previous"},Kl={class:"field-current"},Jl={class:"field-value"},zl={key:0,class:"subpolicy-actions"},Hl=["onClick"],Gl=["onClick"],Yl={key:1},Zl={key:0},en={class:"subpolicy-inline-edit"},tn={class:"version-tag reviewer-version"},an=["onUpdate:modelValue"],sn=["onUpdate:modelValue"],on=["onUpdate:modelValue"],ln={class:"rejection-reason"},nn={class:"subpolicy-edit-actions"},rn=["onClick"],cn=["onClick"],dn=["onClick"],un={key:1,class:"reject-modal"},pn={class:"reject-modal-content"},mn={class:"reject-modal-actions"};function vn(e,t,i,o,l,n){const r=(0,s.g2)("CollapsibleTable"),c=(0,s.g2)("DynamicTable"),u=(0,s.g2)("PopupModal"),p=(0,s.g2)("ReviewHistoryModal");return(0,s.uX)(),(0,s.CE)(s.FK,null,[l.showRejectModal?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",hs,[(0,s.Lk)("div",gs,[(0,s.Lk)("div",ys,[t[43]||(t[43]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Policy Approver",-1)),(0,s.Lk)("div",fs,[l.isAdministrator?((0,s.uX)(),(0,s.CE)("div",bs,[t[40]||(t[40]=(0,s.Lk)("label",{for:"userSelect"},"Select User to View Tasks:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"userSelect","onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedUserId=e),onChange:t[1]||(t[1]=(...e)=>n.onUserChange&&n.onUserChange(...e)),class:"form-control"},[t[39]||(t[39]=(0,s.Lk)("option",{value:""},"-- Select a User to View Their Tasks --",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.availableUsers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName)+" ("+(0,d.v_)(e.Role)+") - ID: "+(0,d.v_)(e.UserId),9,Cs))),128))],544),[[a.u1,l.selectedUserId]]),l.selectedUserId?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("small",Ls,' Please select a user to view their "My Tasks" and "Reviewer Tasks" '))])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"action-btn",onClick:t[2]||(t[2]=(...e)=>n.refreshData&&n.refreshData(...e))},t[41]||(t[41]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),t[42]||(t[42]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",ws,[(0,s.Lk)("div",Es,[t[45]||(t[45]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",Rs,[t[44]||(t[44]=(0,s.Lk)("div",{class:"summary-label"},"Pending Approvals",-1)),(0,s.Lk)("div",Is,(0,d.v_)(n.pendingApprovalsCount),1)])]),(0,s.Lk)("div",Ds,[t[47]||(t[47]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",Ps,[t[46]||(t[46]=(0,s.Lk)("div",{class:"summary-label"},"Approved",-1)),(0,s.Lk)("div",_s,(0,d.v_)(n.approvedApprovalsCount),1)])]),(0,s.Lk)("div",As,[t[49]||(t[49]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",Ss,[t[48]||(t[48]=(0,s.Lk)("div",{class:"summary-label"},"Rejected",-1)),(0,s.Lk)("div",Ts,(0,d.v_)(n.rejectedApprovalsCount),1)])])]),(0,s.Lk)("div",xs,[(0,s.Lk)("div",Fs,[(0,s.Lk)("button",{class:(0,d.C4)(["tab-button",{active:"myTasks"===l.activeTab}]),onClick:t[3]||(t[3]=e=>n.switchTab("myTasks"))},[t[50]||(t[50]=(0,s.eW)(" My Tasks ")),(0,s.Lk)("span",Vs,(0,d.v_)(n.myTasksCount),1)],2),(0,s.Lk)("button",{class:(0,d.C4)(["tab-button",{active:"reviewerTasks"===l.activeTab}]),onClick:t[4]||(t[4]=e=>n.switchTab("reviewerTasks"))},[t[51]||(t[51]=(0,s.eW)(" Reviewer Tasks ")),(0,s.Lk)("span",Us,(0,d.v_)(n.reviewerTasksCount),1)],2)])]),(0,s.Lk)("div",Ns,["myTasks"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",Ms,[(0,s.Lk)("h3",null,[t[52]||(t[52]=(0,s.eW)(" My Approval Tasks ")),l.selectedUserInfo&&l.isAdministrator?((0,s.uX)(),(0,s.CE)("span",Xs," (Viewing: "+(0,d.v_)(l.selectedUserInfo.UserName)+") ",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",$s,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.myTasksCollapsibleSections,e=>((0,s.uX)(),(0,s.Wv)(r,{key:e.name,"section-config":e,"table-headers":l.tableHeaders,"is-expanded":l.expandedSections[e.name.toLowerCase()],pagination:e.pagination,onToggle:t=>n.toggleSection(e.name),onTaskClick:n.handleTaskClick},null,8,["section-config","table-headers","is-expanded","pagination","onToggle","onTaskClick"]))),128))]),0===n.myTasksCollapsibleSections.length?((0,s.uX)(),(0,s.CE)("div",Os,[t[53]||(t[53]=(0,s.Lk)("div",{class:"no-tasks-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-check"})],-1)),t[54]||(t[54]=(0,s.Lk)("h4",null,"No My Tasks",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.selectedUserInfo&&l.isAdministrator?`${l.selectedUserInfo.UserName} doesn't have`:"You don't have")+" any tasks at the moment.",1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),"reviewerTasks"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",js,[(0,s.Lk)("h3",null,[t[55]||(t[55]=(0,s.eW)(" Reviewer Tasks ")),l.selectedUserInfo&&l.isAdministrator?((0,s.uX)(),(0,s.CE)("span",Bs," (Viewing: "+(0,d.v_)(l.selectedUserInfo.UserName)+") ",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Ws,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.reviewerTasksCollapsibleSections,e=>((0,s.uX)(),(0,s.Wv)(r,{key:e.name,"section-config":e,"table-headers":l.tableHeaders,"is-expanded":l.expandedSections[e.name.toLowerCase()],pagination:e.pagination,onToggle:t=>n.toggleSection(e.name),onTaskClick:n.handleTaskClick},null,8,["section-config","table-headers","is-expanded","pagination","onToggle","onTaskClick"]))),128))]),0===n.reviewerTasksCollapsibleSections.length?((0,s.uX)(),(0,s.CE)("div",qs,[t[56]||(t[56]=(0,s.Lk)("div",{class:"no-tasks-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-check"})],-1)),t[57]||(t[57]=(0,s.Lk)("h4",null,"No Reviewer Tasks",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.selectedUserInfo&&l.isAdministrator?`${l.selectedUserInfo.UserName} doesn't have`:"You don't have")+" any reviewer tasks at the moment.",1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),l.showDetails&&l.selectedApproval&&!l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",Qs,[(0,s.Lk)("div",Ks,[(0,s.Lk)("div",Js,[n.isUserViewingReviewHistory?((0,s.uX)(),(0,s.CE)("h3",zs,[t[58]||(t[58]=(0,s.Lk)("span",{class:"detail-type-indicator"},[(0,s.Lk)("i",{class:"fas fa-clock"}),(0,s.eW)(" Review Status ")],-1)),(0,s.eW)(" "+(0,d.v_)(n.getPolicyId(l.selectedApproval))+" ",1),(0,s.Lk)("span",{class:(0,d.C4)(["status-pill",n.getPolicyStatusClass(l.selectedApproval)])},(0,d.v_)("pending"===n.getApprovalStatus(l.selectedApproval)?"Under Review":"approved"===n.getApprovalStatus(l.selectedApproval)?"Approved":"Rejected"),3)])):((0,s.uX)(),(0,s.CE)("h3",Hs,[(0,s.Lk)("span",Gs,(0,d.v_)(n.isComplianceApproval?"Compliance":"Policy"),1),(0,s.eW)(" Details: "+(0,d.v_)(n.getPolicyId(l.selectedApproval))+" ",1),(0,s.Lk)("span",Ys,"Version: "+(0,d.v_)(l.selectedApproval.version||"u1"),1),l.selectedApproval.showingApprovedOnly?((0,s.uX)(),(0,s.CE)("span",Zs," Showing Approved Only ")):(0,s.Q3)("",!0)])),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",eo,[(0,s.Lk)("div",to,[t[59]||(t[59]=(0,s.Lk)("div",{class:"version-label"},"Current Version:",-1)),(0,s.Lk)("div",io,(0,d.v_)(l.selectedApproval.version||"u1"),1)]),l.selectedApproval.ExtractedData.subpolicies&&l.selectedApproval.ExtractedData.subpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",ao,[t[60]||(t[60]=(0,s.Lk)("h4",null,"Subpolicies Versions:",-1)),(0,s.Lk)("ul",so,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.ExtractedData.subpolicies,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.SubPolicyId},[(0,s.Lk)("span",oo,(0,d.v_)(e.SubPolicyName),1),(0,s.Lk)("span",lo,"v"+(0,d.v_)(e.version||"u1"),1),e.resubmitted?((0,s.uX)(),(0,s.CE)("span",no,"Resubmitted")):(0,s.Q3)("",!0)]))),128))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"close-btn",onClick:t[5]||(t[5]=(...e)=>n.closeApprovalDetails&&n.closeApprovalDetails(...e))},"Close"),n.isUserViewingReviewHistory?((0,s.uX)(),(0,s.CE)("div",ro,[t[63]||(t[63]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-clock"}),(0,s.eW)(" Review Status")],-1)),(0,s.Lk)("div",co,[t[61]||(t[61]=(0,s.Lk)("span",{class:"status-label"},"Current Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",n.getPolicyStatusClass(l.selectedApproval)])},(0,d.v_)("pending"===n.getApprovalStatus(l.selectedApproval)?"Under Review":"approved"===n.getApprovalStatus(l.selectedApproval)?"Approved":"Rejected"),3)]),t[64]||(t[64]=(0,s.Lk)("div",{class:"review-progress-message"},[(0,s.Lk)("div",{class:"progress-icon"},[(0,s.Lk)("i",{class:"fas fa-info-circle"})]),(0,s.Lk)("div",{class:"progress-text"},[(0,s.Lk)("p",null,[(0,s.Lk)("strong",null,"Your policy is currently under review.")]),(0,s.Lk)("p",null,"The reviewer will either approve or reject your policy. Once a decision is made, you'll receive a notification with the outcome."),(0,s.Lk)("p",null,[(0,s.eW)("Click the "),(0,s.Lk)("strong",null,'"View Review History"'),(0,s.eW)(" button below to see detailed review progress and any reviewer actions.")])])],-1)),(0,s.Lk)("div",uo,[(0,s.Lk)("button",{class:"review-history-btn",onClick:t[6]||(t[6]=e=>n.showReviewHistory(n.getPolicyId(l.selectedApproval),l.selectedApproval.ExtractedData?.PolicyName||n.getPolicyId(l.selectedApproval),n.getApprovalStatus(l.selectedApproval)))},t[62]||(t[62]=[(0,s.Lk)("i",{class:"fas fa-history"},null,-1),(0,s.eW)(" View Review History ")]))])])):((0,s.uX)(),(0,s.CE)("div",po,[(0,s.Lk)("h4",null,(0,d.v_)(n.isComplianceApproval?"Compliance":"Policy")+" Approval",1),(0,s.Lk)("div",mo,[t[65]||(t[65]=(0,s.Lk)("span",{class:"status-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",{"status-approved":"Approved"===l.selectedApproval.dbStatus||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status,"status-rejected":"Rejected"===l.selectedApproval.dbStatus||!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status,"status-pending":!["Approved","Rejected"].includes(l.selectedApproval.dbStatus)&&null===l.selectedApproval.ApprovedNot&&!["Approved","Rejected"].includes(l.selectedApproval.ExtractedData?.Status)}])},(0,d.v_)("Approved"===l.selectedApproval.dbStatus||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status?"Approved":"Rejected"===l.selectedApproval.dbStatus||!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status?"Rejected":"Under Review"),3)]),(0,s.Lk)("div",vo,[(0,s.Lk)("button",{class:"submit-btn",onClick:t[7]||(t[7]=e=>n.submitReview()),"data-action":"submit-policy-review"},t[66]||(t[66]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.eW)(" Submit Review ")]))]),n.approvalStatus&&!0!==l.selectedApproval.ApprovedNot&&"Approved"!==l.selectedApproval.ExtractedData?.Status&&!1!==l.selectedApproval.ApprovedNot&&"Rejected"!==l.selectedApproval.ExtractedData?.Status?((0,s.uX)(),(0,s.CE)("div",ko,[(0,s.Lk)("div",ho,[t[67]||(t[67]=(0,s.Lk)("div",{class:"status-label"},"Status:",-1)),(0,s.Lk)("div",{class:(0,d.C4)(["status-value",{approved:!0===n.approvalStatus.approved,rejected:!1===n.approvalStatus.approved,pending:null===n.approvalStatus.approved}])},(0,d.v_)(!0===n.approvalStatus.approved?"Approved":!1===n.approvalStatus.approved?"Rejected":"Pending"),3)]),!0===n.approvalStatus.approved&&l.selectedApproval.ApprovedDate?((0,s.uX)(),(0,s.CE)("div",go,[t[68]||(t[68]=(0,s.Lk)("div",{class:"date-label"},"Approved Date:",-1)),(0,s.Lk)("div",yo,(0,d.v_)(n.formatDate(l.selectedApproval.ApprovedDate)),1)])):(0,s.Q3)("",!0),!1===n.approvalStatus.approved&&n.approvalStatus.remarks?((0,s.uX)(),(0,s.CE)("div",fo,[t[69]||(t[69]=(0,s.Lk)("div",{class:"remarks-label"},"Rejection Reason:",-1)),(0,s.Lk)("div",bo,(0,d.v_)(n.approvalStatus.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",Co,[n.isComplianceApproval?((0,s.uX)(),(0,s.CE)("div",Lo,[(0,s.Lk)("div",wo,[t[70]||(t[70]=(0,s.Lk)("strong",null,"Description:",-1)),t[71]||(t[71]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.ComplianceItemDescription),1)]),(0,s.Lk)("div",Eo,[t[72]||(t[72]=(0,s.Lk)("strong",null,"Criticality:",-1)),t[73]||(t[73]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.Criticality),1)]),(0,s.Lk)("div",Ro,[t[74]||(t[74]=(0,s.Lk)("strong",null,"Impact:",-1)),t[75]||(t[75]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.Impact),1)]),(0,s.Lk)("div",Io,[t[76]||(t[76]=(0,s.Lk)("strong",null,"Probability:",-1)),t[77]||(t[77]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.Probability),1)]),(0,s.Lk)("div",Do,[t[78]||(t[78]=(0,s.Lk)("strong",null,"Mitigation:",-1)),t[79]||(t[79]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.mitigation),1)]),(0,s.Lk)("div",Po,[(0,s.Lk)("button",{class:"approve-btn",onClick:t[8]||(t[8]=e=>n.approveCompliance())},"Approve"),(0,s.Lk)("button",{class:"reject-btn",onClick:t[9]||(t[9]=e=>n.rejectCompliance())},"Reject")])])):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.selectedApproval.ExtractedData,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"policy-detail-row"},["subpolicies"!==i&&"policy_approval"!==i?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("strong",null,(0,d.v_)(i)+":",1),t[80]||(t[80]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(e),1)],64)):(0,s.Q3)("",!0),"subpolicies"===i&&Array.isArray(e)?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[t[86]||(t[86]=(0,s.Lk)("h4",null,"Subpolicies",-1)),e&&e.length?((0,s.uX)(),(0,s.CE)("ul",_o,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.Identifier,class:"subpolicy-status"},[(0,s.Lk)("div",null,[(0,s.Lk)("span",Ao,(0,d.v_)(e.Identifier),1),t[81]||(t[81]=(0,s.eW)(" : ")),(0,s.Lk)("span",So,(0,d.v_)(e.SubPolicyName),1),t[82]||(t[82]=(0,s.Lk)("span",{class:"item-type-badge subpolicy-badge"},"Subpolicy",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["badge",{approved:!0===e.approval?.approved||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status,rejected:!1===e.approval?.approved&&!(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status),pending:null===e.approval?.approved&&!e.resubmitted&&!(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status),resubmitted:null===e.approval?.approved&&e.resubmitted&&!(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status)}])},(0,d.v_)(!0===e.approval?.approved||!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status?"Approved":!1===e.approval?.approved?"Rejected":e.resubmitted?"Resubmitted":"Pending"),3)]),(0,s.Lk)("div",null,[t[83]||(t[83]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)]),(0,s.Lk)("div",null,[t[84]||(t[84]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Control),1)]),!1===e.approval?.approved?((0,s.uX)(),(0,s.CE)("div",To,[t[85]||(t[85]=(0,s.Lk)("strong",null,"Reason:",-1)),(0,s.eW)(" "+(0,d.v_)(e.approval?.remarks),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",xo,[l.isReviewer?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},["Under Review"!==e.Status&&e.Status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>n.approveSubpolicy(e),class:"approve-button"}," Approve ",8,Fo)),"Under Review"!==e.Status&&e.Status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:t=>n.rejectSubpolicy(e),class:"reject-button"}," Reject ",8,Vo))],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},["Rejected"===e.Status?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>n.openEditSubpolicyModal(e),class:"edit-button"}," Edit & Resubmit ",8,Uo)):(0,s.Q3)("",!0)],64))])]))),128))])):(0,s.Q3)("",!0)],64)):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),l.selectedApproval&&l.selectedApproval.PolicyId?((0,s.uX)(),(0,s.CE)("div",No,[t[87]||(t[87]=(0,s.Lk)("strong",null,"Policy ID:",-1)),t[88]||(t[88]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(n.getPolicyId(l.selectedApproval)),1)])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),l.rejectedPolicies.length?((0,s.uX)(),(0,s.CE)("div",Mo,[t[91]||(t[91]=(0,s.Lk)("h3",null,"Rejected Policies & Compliances (Edit & Resubmit)",-1)),(0,s.bF)(c,{data:n.rejectedTableData,columns:l.rejectedTableColumns,filters:l.rejectedTableFilters,"show-actions":!0,"show-pagination":!0,"default-page-size":10,"page-size-options":[5,10,20,50],"unique-key":"id",onRowSelect:n.handleRejectedPolicyAction},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"edit-action-btn",onClick:t=>n.handleRejectedPolicyAction(e),title:`Edit & Resubmit ${e.type}`},t[89]||(t[89]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,Xo)]),_:1},8,["data","columns","filters","onRowSelect"]),0===n.rejectedTableData.length?((0,s.uX)(),(0,s.CE)("div",$o,t[90]||(t[90]=[(0,s.Lk)("div",{class:"no-items-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1),(0,s.Lk)("h4",null,"No Rejected Items",-1),(0,s.Lk)("p",null,"All policies and compliances have been approved or are pending review.",-1)]))):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),l.showEditComplianceModal&&l.editingCompliance?((0,s.uX)(),(0,s.CE)("div",Oo,[(0,s.Lk)("div",jo,[(0,s.Lk)("h3",null,"Edit & Resubmit Compliance: "+(0,d.v_)(n.getPolicyId(l.editingCompliance)),1),(0,s.Lk)("button",{class:"close-btn",onClick:t[10]||(t[10]=(...e)=>n.closeEditComplianceModal&&n.closeEditComplianceModal(...e))},"Close"),(0,s.Lk)("div",null,[t[92]||(t[92]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.editingCompliance.ExtractedData.ComplianceItemDescription=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.ComplianceItemDescription]])]),(0,s.Lk)("div",null,[t[94]||(t[94]=(0,s.Lk)("label",null,"Criticality:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>l.editingCompliance.ExtractedData.Criticality=e)},t[93]||(t[93]=[(0,s.Lk)("option",null,"High",-1),(0,s.Lk)("option",null,"Medium",-1),(0,s.Lk)("option",null,"Low",-1)]),512),[[a.u1,l.editingCompliance.ExtractedData.Criticality]])]),(0,s.Lk)("div",null,[t[95]||(t[95]=(0,s.Lk)("label",null,"Impact:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[13]||(t[13]=e=>l.editingCompliance.ExtractedData.Impact=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.Impact]])]),(0,s.Lk)("div",null,[t[96]||(t[96]=(0,s.Lk)("label",null,"Probability:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[14]||(t[14]=e=>l.editingCompliance.ExtractedData.Probability=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.Probability]])]),(0,s.Lk)("div",null,[t[97]||(t[97]=(0,s.Lk)("label",null,"Mitigation:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[15]||(t[15]=e=>l.editingCompliance.ExtractedData.mitigation=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.mitigation]])]),(0,s.Lk)("div",null,[t[98]||(t[98]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",Bo,(0,d.v_)(l.editingCompliance.ExtractedData.compliance_approval?.remarks),1)]),(0,s.Lk)("button",{class:"resubmit-btn",onClick:t[16]||(t[16]=e=>n.resubmitCompliance(l.editingCompliance))},"Resubmit for Review")])])):(0,s.Q3)("",!0),l.showEditModal&&l.editingPolicy?((0,s.uX)(),(0,s.CE)("div",Wo,[(0,s.Lk)("div",qo,[(0,s.Lk)("h3",null,"Edit & Resubmit Policy: "+(0,d.v_)(n.getPolicyId(l.editingPolicy)),1),(0,s.Lk)("button",{class:"close-btn",onClick:t[17]||(t[17]=(...e)=>n.closeEditModal&&n.closeEditModal(...e))},"Close"),l.editingPolicy.ExtractedData.rejection_reason||l.editingPolicy.rejectionReason?((0,s.uX)(),(0,s.CE)("div",Qo,[t[99]||(t[99]=(0,s.Lk)("div",{class:"rejection-reason-header"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Policy Rejection Reason ")],-1)),(0,s.Lk)("div",Ko,(0,d.v_)(l.editingPolicy.ExtractedData.rejection_reason||l.editingPolicy.rejectionReason||"No rejection reason provided"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",null,[t[100]||(t[100]=(0,s.Lk)("label",null,"Scope:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.editingPolicy.ExtractedData.Scope=e)},null,512),[[a.Jo,l.editingPolicy.ExtractedData.Scope]])]),(0,s.Lk)("div",null,[t[101]||(t[101]=(0,s.Lk)("label",null,"Objective:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[19]||(t[19]=e=>l.editingPolicy.ExtractedData.Objective=e)},null,512),[[a.Jo,l.editingPolicy.ExtractedData.Objective]])]),(0,s.Lk)("div",null,[t[103]||(t[103]=(0,s.Lk)("label",null,"Policy Type:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[20]||(t[20]=e=>l.editingPolicy.ExtractedData.PolicyType=e),class:"form-control",onChange:t[21]||(t[21]=e=>n.handlePolicyTypeChange(l.editingPolicy))},[t[102]||(t[102]=(0,s.Lk)("option",{value:""},"Select Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.policyTypeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Jo))),128))],544),[[a.u1,l.editingPolicy.ExtractedData.PolicyType]])]),(0,s.Lk)("div",null,[t[105]||(t[105]=(0,s.Lk)("label",null,"Policy Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[22]||(t[22]=e=>l.editingPolicy.ExtractedData.PolicyCategory=e),class:"form-control",onChange:t[23]||(t[23]=e=>n.handlePolicyCategoryChange(l.editingPolicy))},[t[104]||(t[104]=(0,s.Lk)("option",{value:""},"Select Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicyCategories(l.editingPolicy.ExtractedData.PolicyType),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,zo))),128))],544),[[a.u1,l.editingPolicy.ExtractedData.PolicyCategory]])]),(0,s.Lk)("div",null,[t[107]||(t[107]=(0,s.Lk)("label",null,"Policy Sub Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[24]||(t[24]=e=>l.editingPolicy.ExtractedData.PolicySubCategory=e),class:"form-control"},[t[106]||(t[106]=(0,s.Lk)("option",{value:""},"Select Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicySubCategories(l.editingPolicy.ExtractedData.PolicyType,l.editingPolicy.ExtractedData.PolicyCategory),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Ho))),128))],512),[[a.u1,l.editingPolicy.ExtractedData.PolicySubCategory]])]),n.hasRejectedSubpolicies?((0,s.uX)(),(0,s.CE)("div",Go,[t[113]||(t[113]=(0,s.Lk)("h4",null,"Rejected Subpolicies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.rejectedSubpoliciesInPolicy,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.Identifier,class:"subpolicy-edit-item"},[(0,s.Lk)("div",Yo,[(0,s.Lk)("span",null,(0,d.v_)(e.Identifier)+": "+(0,d.v_)(e.SubPolicyName),1),t[108]||(t[108]=(0,s.Lk)("span",{class:"subpolicy-badge"},"Rejected",-1))]),(0,s.Lk)("div",Zo,[t[109]||(t[109]=(0,s.Lk)("label",null,"Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.SubPolicyName=t},null,8,el),[[a.Jo,e.SubPolicyName]])]),(0,s.Lk)("div",tl,[t[110]||(t[110]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Description=t},null,8,il),[[a.Jo,e.Description]])]),(0,s.Lk)("div",al,[t[111]||(t[111]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Control=t},null,8,sl),[[a.Jo,e.Control]])]),(0,s.Lk)("div",ol,[t[112]||(t[112]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",ll,(0,d.v_)(e.approval?.remarks),1)])]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"resubmit-btn",onClick:t[25]||(t[25]=e=>n.resubmitPolicy(l.editingPolicy))},"Resubmit for Review")])])):(0,s.Q3)("",!0),l.showEditSubpolicyModal?((0,s.uX)(),(0,s.CE)("div",nl,[(0,s.Lk)("div",rl,[(0,s.Lk)("span",{class:"close",onClick:t[26]||(t[26]=(...e)=>n.closeEditSubpolicyModal&&n.closeEditSubpolicyModal(...e))},"×"),(0,s.Lk)("h2",null,[t[114]||(t[114]=(0,s.eW)("Edit Rejected Subpolicy ")),!l.editingSubpolicy||"Rejected"!==l.editingSubpolicy.Status&&!1!==l.editingSubpolicy.approval?.approved?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",cl," Version: "+(0,d.v_)(l.editingSubpolicy.reviewerVersion||"R1"),1))]),l.editingSubpolicy?((0,s.uX)(),(0,s.CE)("div",dl,[(0,s.Lk)("div",ul,[t[115]||(t[115]=(0,s.Lk)("label",null,"Subpolicy Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=e=>l.editingSubpolicy.SubPolicyName=e),disabled:""},null,512),[[a.Jo,l.editingSubpolicy.SubPolicyName]])]),(0,s.Lk)("div",pl,[t[116]||(t[116]=(0,s.Lk)("label",null,"Identifier:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[28]||(t[28]=e=>l.editingSubpolicy.Identifier=e),disabled:""},null,512),[[a.Jo,l.editingSubpolicy.Identifier]])]),l.editingSubpolicy.approval&&l.editingSubpolicy.approval.remarks?((0,s.uX)(),(0,s.CE)("div",ml,[t[117]||(t[117]=(0,s.Lk)("div",{class:"rejection-reason-header"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Rejection Reason ")],-1)),(0,s.Lk)("div",vl,(0,d.v_)(l.editingSubpolicy.approval.remarks),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",kl,[t[118]||(t[118]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[29]||(t[29]=e=>l.editingSubpolicy.Description=e),onInput:t[30]||(t[30]=(...e)=>n.trackChanges&&n.trackChanges(...e))},null,544),[[a.Jo,l.editingSubpolicy.Description]])]),(0,s.Lk)("div",hl,[t[119]||(t[119]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[31]||(t[31]=e=>l.editingSubpolicy.Control=e),onInput:t[32]||(t[32]=(...e)=>n.trackChanges&&n.trackChanges(...e))},null,544),[[a.Jo,l.editingSubpolicy.Control]])]),n.hasChanges?((0,s.uX)(),(0,s.CE)("div",gl,[t[120]||(t[120]=(0,s.Lk)("div",{class:"changes-header"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Changes detected ")],-1)),(0,s.Lk)("div",yl,[l.editingSubpolicy.Description!==l.editingSubpolicy.originalDescription?((0,s.uX)(),(0,s.CE)("div",fl," Description has been modified ")):(0,s.Q3)("",!0),l.editingSubpolicy.Control!==l.editingSubpolicy.originalControl?((0,s.uX)(),(0,s.CE)("div",bl," Control has been modified ")):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Cl,[(0,s.Lk)("button",{class:"resubmit-btn",onClick:t[33]||(t[33]=e=>n.resubmitSubpolicy()),disabled:!n.hasChanges},(0,d.v_)(n.hasChanges?"Resubmit with Changes":"Make changes to resubmit"),9,Ll),(0,s.Lk)("button",{class:"cancel-btn",onClick:t[34]||(t[34]=(...e)=>n.closeEditSubpolicyModal&&n.closeEditSubpolicyModal(...e))},"Cancel")])])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),l.showSubpoliciesModal&&l.selectedPolicyForSubpolicies?((0,s.uX)(),(0,s.CE)("div",wl,[t[134]||(t[134]=(0,s.Lk)("div",{class:"modal-overlay"},null,-1)),(0,s.Lk)("div",El,[(0,s.Lk)("div",Rl,[(0,s.Lk)("h3",null,[l.isReviewer?((0,s.uX)(),(0,s.CE)("span",Il,"Subpolicies for "+(0,d.v_)(n.getPolicyId(l.selectedPolicyForSubpolicies)),1)):((0,s.uX)(),(0,s.CE)("span",Dl,"Edit Rejected Subpolicies for "+(0,d.v_)(n.getPolicyId(l.selectedPolicyForSubpolicies)),1)),!1===l.selectedPolicyForSubpolicies.ApprovedNot||"Rejected"===l.selectedPolicyForSubpolicies.ExtractedData?.Status?((0,s.uX)(),(0,s.CE)("span",Pl," Version: "+(0,d.v_)(l.selectedPolicyForSubpolicies.reviewerVersion||"R1"),1)):((0,s.uX)(),(0,s.CE)("span",_l," Version: "+(0,d.v_)(l.selectedPolicyForSubpolicies.version||"u1"),1))]),(0,s.Lk)("button",{class:"close-btn",onClick:t[35]||(t[35]=(...e)=>n.closeSubpoliciesModal&&n.closeSubpoliciesModal(...e))},"Close"),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredSubpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.Identifier,class:(0,d.C4)(["subpolicy-status",{"resubmitted-item":e.resubmitted}])},[(0,s.Lk)("div",Al,[(0,s.Lk)("span",Sl,(0,d.v_)(e.Identifier),1),(0,s.Lk)("span",Tl,(0,d.v_)(e.SubPolicyName),1),"Rejected"===e.Status||e.approval&&!1===e.approval.approved?((0,s.uX)(),(0,s.CE)("span",xl," Version: "+(0,d.v_)(e.reviewerVersion||"R1"),1)):((0,s.uX)(),(0,s.CE)("span",Fl," Version: "+(0,d.v_)(e.version||"u1"),1))]),(0,s.Lk)("div",Vl,[(0,s.Lk)("div",null,[t[121]||(t[121]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)]),(0,s.Lk)("div",null,[t[122]||(t[122]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Control),1)]),!1===e.approval?.approved?((0,s.uX)(),(0,s.CE)("div",Ul,[t[123]||(t[123]=(0,s.Lk)("strong",null,"Rejection Reason:",-1)),(0,s.eW)(" "+(0,d.v_)(e.approval?.remarks),1)])):(0,s.Q3)("",!0),e.resubmitted&&l.isReviewer?((0,s.uX)(),(0,s.CE)("div",Nl,[t[128]||(t[128]=(0,s.Lk)("div",{class:"edit-history-header"},[(0,s.Lk)("i",{class:"fas fa-history"}),(0,s.eW)(" Resubmitted with Changes ")],-1)),(0,s.Lk)("div",Ml,[(0,s.Lk)("div",Xl,[e.previousVersion?((0,s.uX)(),(0,s.CE)("div",$l,[t[124]||(t[124]=(0,s.Lk)("div",{class:"field-label"},"Original Description:",-1)),(0,s.Lk)("div",Ol,(0,d.v_)(e.previousVersion.Description||"Not available"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",jl,[t[125]||(t[125]=(0,s.Lk)("div",{class:"field-label"},"Updated Description:",-1)),(0,s.Lk)("div",Bl,(0,d.v_)(e.Description),1)])]),(0,s.Lk)("div",Wl,[e.previousVersion?((0,s.uX)(),(0,s.CE)("div",ql,[t[126]||(t[126]=(0,s.Lk)("div",{class:"field-label"},"Original Control:",-1)),(0,s.Lk)("div",Ql,(0,d.v_)(e.previousVersion.Control||"Not available"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",Kl,[t[127]||(t[127]=(0,s.Lk)("div",{class:"field-label"},"Updated Control:",-1)),(0,s.Lk)("div",Jl,(0,d.v_)(e.Control),1)])])])])):(0,s.Q3)("",!0)]),!l.isReviewer||null!==e.approval?.approved&&void 0!==e.approval?.approved?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",zl,[(0,s.Lk)("button",{class:"approve-btn",onClick:t=>n.approveSubpolicyFromModal(e)},"Approve",8,Hl),(0,s.Lk)("button",{class:"reject-btn",onClick:t=>n.rejectSubpolicyFromModal(e)},"Reject",8,Gl)])),!1===e.approval?.approved||"Rejected"===e.Status?((0,s.uX)(),(0,s.CE)("div",Yl,[e.showEditForm?((0,s.uX)(),(0,s.CE)("div",Zl,[(0,s.Lk)("div",en,[(0,s.Lk)("h4",null,[t[129]||(t[129]=(0,s.eW)("Edit Rejected Subpolicy ")),(0,s.Lk)("span",tn,"Version: "+(0,d.v_)(e.reviewerVersion||"R1"),1)]),(0,s.Lk)("div",null,[t[130]||(t[130]=(0,s.Lk)("label",null,"Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.SubPolicyName=t,disabled:""},null,8,an),[[a.Jo,e.SubPolicyName]])]),(0,s.Lk)("div",null,[t[131]||(t[131]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Description=t},null,8,sn),[[a.Jo,e.Description]])]),(0,s.Lk)("div",null,[t[132]||(t[132]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Control=t},null,8,on),[[a.Jo,e.Control]])]),(0,s.Lk)("div",null,[t[133]||(t[133]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",ln,(0,d.v_)(e.approval&&e.approval.remarks?e.approval.remarks:"No rejection reason provided"),1)]),(0,s.Lk)("div",nn,[(0,s.Lk)("button",{class:"resubmit-btn",onClick:t=>n.resubmitSubpolicyDirect(e)},"Resubmit for Review",8,rn),l.isReviewer?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"cancel-btn",onClick:t=>n.hideEditFormInline(e)},"Cancel",8,cn)):(0,s.Q3)("",!0)])])])):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"edit-btn",onClick:t=>n.showEditFormInline(e)},"Edit & Resubmit",8,dn))])):(0,s.Q3)("",!0)],2))),128))])])])):(0,s.Q3)("",!0),(0,s.bF)(u)])])),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",un,[(0,s.Lk)("div",pn,[t[135]||(t[135]=(0,s.Lk)("h4",null,"Rejection Reason",-1)),(0,s.Lk)("p",null,"Please provide a reason for rejecting "+(0,d.v_)("policy"===l.rejectingType?"the policy":"subpolicy "+l.rejectingSubpolicy?.Identifier),1),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[36]||(t[36]=e=>l.rejectionComment=e),class:"rejection-comment",placeholder:"Enter your comments here..."},null,512),[[a.Jo,l.rejectionComment]]),(0,s.Lk)("div",mn,[(0,s.Lk)("button",{class:"cancel-btn",onClick:t[37]||(t[37]=(...e)=>n.cancelRejection&&n.cancelRejection(...e))},"Cancel"),(0,s.Lk)("button",{class:"confirm-btn",onClick:t[38]||(t[38]=(...e)=>n.confirmRejection&&n.confirmRejection(...e))},"Confirm Rejection")])])])):(0,s.Q3)("",!0),l.showReviewHistoryModal?((0,s.uX)(),(0,s.Wv)(p,{key:2,"policy-id":l.selectedPolicyId,"policy-name":l.selectedPolicyName,"current-status":l.selectedPolicyStatus,onClose:n.closeReviewHistoryModal},null,8,["policy-id","policy-name","current-status","onClose"])):(0,s.Q3)("",!0)],64)}i(1148);const kn={class:"pagination-bar"},hn={class:"results-info"},gn={class:"page-size-selector"},yn=["value"],fn={class:"pagination-controls"},bn=["disabled"],Cn=["onClick"],Ln={key:1,class:"ellipsis"},wn=["disabled"];function En(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",kn,[(0,s.Lk)("div",hn," Results: "+(0,d.v_)(o.startResult)+" - "+(0,d.v_)(o.endResult)+" of "+(0,d.v_)(i.totalItems),1),(0,s.Lk)("div",gn,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.localPageSize=e),onChange:t[1]||(t[1]=(...e)=>o.onPageSizeChange&&o.onPageSizeChange(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.pageSizeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,yn))),128))],544),[[a.u1,o.localPageSize,void 0,{number:!0}]])]),(0,s.Lk)("div",fn,[(0,s.Lk)("button",{disabled:1===i.currentPage,onClick:t[2]||(t[2]=t=>e.$emit("update:page",i.currentPage-1))},"<",8,bn),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.paginationNumbers,t=>((0,s.uX)(),(0,s.CE)(s.FK,{key:t},["number"===typeof t?((0,s.uX)(),(0,s.CE)("button",{key:0,class:(0,d.C4)({active:t===i.currentPage}),onClick:i=>e.$emit("update:page",t)},(0,d.v_)(t),11,Cn)):((0,s.uX)(),(0,s.CE)("span",Ln,"..."))],64))),128)),(0,s.Lk)("button",{disabled:i.currentPage===i.totalPages,onClick:t[3]||(t[3]=t=>e.$emit("update:page",i.currentPage+1))},">",8,wn)])])}var Rn={name:"PaginationComponent",props:{currentPage:{type:Number,required:!0},totalPages:{type:Number,required:!0},pageSize:{type:Number,required:!0},totalItems:{type:Number,required:!0},pageSizeOptions:{type:Array,default:()=>[6,15,30,50]}},emits:["update:page","update:pageSize"],setup(e,{emit:t}){console.log("Pagination component props:",e);const i=(0,ie.KR)(e.pageSize);(0,s.wB)(()=>e.pageSize,e=>{i.value=e});const a=(0,s.EW)(()=>0===e.totalItems?0:(e.currentPage-1)*e.pageSize+1),o=(0,s.EW)(()=>Math.min(e.currentPage*e.pageSize,e.totalItems)),l=(0,s.EW)(()=>{const t=[],i=e.totalPages,a=e.currentPage;if(i<=7)for(let e=1;e<=i;e++)t.push(e);else{t.push(1),a>3&&t.push("...");let e=Math.max(2,a-1),s=Math.min(i-1,a+1);a<=2&&(e=2,s=3),a>=i-1&&(e=i-2,s=i-1);for(let i=e;i<=s;i++)t.push(i);a<i-2&&t.push("..."),t.push(i)}return t.filter((e,t,i)=>i.indexOf(e)===t)});function n(){t("update:pageSize",i.value)}return{localPageSize:i,startResult:a,endResult:o,paginationNumbers:l,onPageSizeChange:n}}};const In=(0,le.A)(Rn,[["render",En],["__scopeId","data-v-e0861b9a"]]);var Dn=In,Pn=i(1315),_n=i(3631),An=i(9137),Sn=i(4672),Tn=i(7294),xn=i(5505);const Fn={class:"header-left"},Vn={class:"header-right"},Un={key:0},Nn={class:"task-table"},Mn={class:"column-header",style:{position:"relative"}},Xn={key:0,class:"filter-arrows"},$n=["onClick","aria-label"],On=["onClick","aria-label"],jn=["onClick","aria-label"],Bn=["onMousedown","onTouchstart"],Wn=["onClick"],qn=["innerHTML"],Qn=["title"];var Kn={__name:"CollapsibleTable",props:{sectionConfig:{type:Object,required:!0},tableHeaders:{type:Array,required:!0},isExpanded:{type:Boolean,default:!0},pagination:{type:Object,default:null},onNextPage:{type:Function,default:null},onPrevPage:{type:Function,default:null}},emits:["toggle","addTask","taskClick"],setup(e,{emit:t}){const i=e;console.log("CollapsibleTable props:",{sectionName:i.sectionConfig?.name,pagination:i.pagination,isExpanded:i.isExpanded,tasksCount:i.sectionConfig?.tasks?.length});const o=t,l=()=>{o("toggle")},n=(0,s.EW)(()=>{switch(i.sectionConfig.name){case"Pending":case"Open":case"Assigned":return Pn.A;case"In Progress":case"Under Review":case"Pending Review":case"Scheduled":return _n.A;case"Completed":case"Closed":case"Approved":return An.A;case"Rejected":return Pn.A;case"Not Assigned":case"Unknown":return Pn.A;default:return Pn.A}}),r=(0,s.EW)(()=>{const e=i.sectionConfig.name;return"Pending"===e||"Open"===e||"Rejected"===e||"Assigned"===e||"Not Assigned"===e||"Unknown"===e?"light":"fill"}),c=e=>!(!e||"string"!==typeof e)&&e.length>50,u=(0,ie.KR)(""),p=(0,ie.KR)("asc"),m=e=>{u.value=e,p.value="asc"},v=e=>{u.value=e,p.value="desc"},k=(0,s.EW)(()=>u.value?[...i.sectionConfig.tasks].sort((e,t)=>{const i=e[u.value],a=t[u.value];return null==i?1:null==a?-1:i<a?"asc"===p.value?-1:1:i>a?"asc"===p.value?1:-1:0}):i.sectionConfig.tasks),h=(0,ie.KR)({}),g=(0,ie.KR)({active:!1,columnKey:null,startX:0,startWidth:0}),y=(e,t)=>{e.preventDefault(),g.value.active=!0,g.value.columnKey=t,g.value.startX=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,g.value.startWidth=h.value[t]||150},f=e=>{if(!g.value.active)return;const t=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,i=t-g.value.startX;let a=g.value.startWidth+i;a<50&&(a=50),h.value={...h.value,[g.value.columnKey]:a}},b=()=>{g.value.active&&(g.value.active=!1,g.value.columnKey=null)};return(0,s.sV)(()=>{window.addEventListener("mousemove",f),window.addEventListener("mouseup",b),window.addEventListener("touchmove",f),window.addEventListener("touchend",b)}),(0,s.xo)(()=>{window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",b),window.removeEventListener("touchmove",f),window.removeEventListener("touchend",b)}),(t,i)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["task-section",e.sectionConfig.statusClass])},[(0,s.Lk)("div",{class:"task-section-header",onClick:l},[(0,s.Lk)("div",Fn,[((0,s.uX)(),(0,s.Wv)((0,s.$y)(e.isExpanded?(0,ie.R1)(Sn.A):(0,ie.R1)(Tn.A)),{size:16})),(0,s.Lk)("div",{class:(0,d.C4)(["status-chip",e.sectionConfig.statusClass])},[((0,s.uX)(),(0,s.Wv)((0,s.$y)(n.value),{size:14,weight:r.value},null,8,["weight"])),(0,s.Lk)("span",null,(0,d.v_)(e.sectionConfig.name),1)],2)]),(0,s.Lk)("div",Vn,[(0,s.bF)((0,ie.R1)(xn.A),{size:20})])]),e.isExpanded?((0,s.uX)(),(0,s.CE)("div",Un,[(0,s.Lk)("table",Nn,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.tableHeaders,e=>((0,s.uX)(),(0,s.CE)("th",{key:e.key,class:(0,d.C4)(e.className),style:(0,d.Tr)({width:h.value[e.key]?h.value[e.key]+"px":e.width?e.width:"auto"})},[(0,s.Lk)("div",Mn,[(0,s.eW)((0,d.v_)(e.label)+" ",1),e.sortable?((0,s.uX)(),(0,s.CE)("span",Xn,[u.value===e.key&&"asc"===p.value?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"sort-btn",onClick:(0,a.D$)(t=>v(e.key),["stop"]),"aria-label":"Sort "+e.label+" descending"}," ▲ ",8,$n)):(0,s.Q3)("",!0),u.value!==e.key||"desc"===p.value?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"sort-btn",onClick:(0,a.D$)(t=>v(e.key),["stop"]),"aria-label":"Sort "+e.label+" descending"}," ▼ ",8,On)):(0,s.Q3)("",!0),u.value===e.key&&"desc"===p.value?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"sort-btn",onClick:(0,a.D$)(t=>m(e.key),["stop"]),"aria-label":"Sort "+e.label+" ascending"}," ▼ ",8,jn)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:"resize-handle",onMousedown:t=>y(t,e.key),onTouchstart:t=>y(t,e.key)},null,40,Bn)])],6))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(k.value,a=>((0,s.uX)(),(0,s.CE)("tr",{key:a.incidentId},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.tableHeaders,e=>((0,s.uX)(),(0,s.CE)("td",{key:e.key,class:(0,d.C4)(e.className),style:(0,d.Tr)({width:h.value[e.key]?h.value[e.key]+"px":e.width?e.width:"auto"})},["actions"===e.key?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"view-details-btn",onClick:e=>t.$emit("taskClick",a)},i[2]||(i[2]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" VIEW DETAILS ")]),8,Wn)):["criticality","priority","status"].includes(e.key)?((0,s.uX)(),(0,s.CE)("span",{key:1,innerHTML:a[e.key]},null,8,qn)):((0,s.uX)(),(0,s.CE)("div",{key:2,class:(0,d.C4)(["cell-content",{truncated:c(a[e.key])}]),title:c(a[e.key])?a[e.key]:""},(0,d.v_)(a[e.key]),11,Qn))],6))),128))]))),128))])]),e.pagination?((0,s.uX)(),(0,s.Wv)(Dn,{key:0,"current-page":e.pagination.currentPage,"total-pages":e.pagination.totalPages,"page-size":e.pagination.pageSize,"total-items":e.pagination.totalCount,"page-size-options":e.pagination.pageSizeOptions||[6,15,30,50],"onUpdate:page":i[0]||(i[0]=t=>{t>e.pagination.currentPage?e.onNextPage&&e.onNextPage():t<e.pagination.currentPage&&e.onPrevPage&&e.onPrevPage()}),"onUpdate:pageSize":i[1]||(i[1]=t=>e.pagination.onPageSizeChange&&e.pagination.onPageSizeChange(t))},null,8,["current-page","total-pages","page-size","total-items","page-size-options"])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)],2))}};const Jn=(0,le.A)(Kn,[["__scopeId","data-v-3c5046da"]]);var zn=Jn,Hn=i(6567);const Gn={class:"modal-header"},Yn={class:"modal-body"},Zn={class:"policy-info"},er={class:"info-item"},tr={class:"value"},ir={class:"info-item"},ar={class:"review-timeline"},sr={key:0,class:"loading-state"},or={key:1,class:"empty-state"},lr={key:2,class:"timeline"},nr={class:"timeline-marker"},rr={class:"timeline-content"},cr={class:"review-header"},dr={class:"revision-info"},ur={class:"revision-number"},pr={class:"review-meta"},mr={class:"reviewer"},vr={class:"date"},kr={key:0,class:"rejection-reason"},hr={class:"reason-text"},gr={key:1,class:"review-details"},yr={class:"details-content"},fr={key:0,class:"detail-item"},br={class:"detail-value"},Cr={key:1,class:"detail-item"},Lr={class:"detail-value"},wr={class:"modal-footer"};function Er(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",{class:"review-history-modal-overlay",onClick:t[3]||(t[3]=t=>e.$emit("close"))},[(0,s.Lk)("div",{class:"review-history-modal",onClick:t[2]||(t[2]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Gn,[(0,s.Lk)("h3",null,[t[4]||(t[4]=(0,s.Lk)("i",{class:"fas fa-history"},null,-1)),(0,s.eW)(" Review History: "+(0,d.v_)(i.policyName),1)]),(0,s.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=t=>e.$emit("close"))},t[5]||(t[5]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",Yn,[(0,s.Lk)("div",Zn,[(0,s.Lk)("div",er,[t[6]||(t[6]=(0,s.Lk)("span",{class:"label"},"Policy ID:",-1)),(0,s.Lk)("span",tr,(0,d.v_)(i.policyId),1)]),(0,s.Lk)("div",ir,[t[7]||(t[7]=(0,s.Lk)("span",{class:"label"},"Current Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["value status-badge",`status-${i.currentStatus.toLowerCase().replace(" ","-")}`])},(0,d.v_)(i.currentStatus),3)])]),(0,s.Lk)("div",ar,[t[16]||(t[16]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-clock"}),(0,s.eW)(" Review Timeline")],-1)),l.loading?((0,s.uX)(),(0,s.CE)("div",sr,t[8]||(t[8]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading review history... ")]))):0===l.reviewHistory.length?((0,s.uX)(),(0,s.CE)("div",or,t[9]||(t[9]=[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1),(0,s.eW)(" No review history available for this policy. ")]))):((0,s.uX)(),(0,s.CE)("div",lr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.reviewHistory,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:e.approval_id,class:(0,d.C4)(["timeline-item",{latest:0===i,approved:"approved"===e.status_label,rejected:"rejected"===e.status_label,pending:"pending"===e.status_label}])},[(0,s.Lk)("div",nr,[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":"approved"===e.status_label,"fa-times-circle":"rejected"===e.status_label,"fa-clock":"pending"===e.status_label}])},null,2)]),(0,s.Lk)("div",rr,[(0,s.Lk)("div",cr,[(0,s.Lk)("div",dr,[(0,s.Lk)("span",ur,(0,d.v_)(e.version),1),(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",`status-${e.status_label}`])},(0,d.v_)(e.status),3)]),(0,s.Lk)("div",pr,[(0,s.Lk)("span",mr,[t[10]||(t[10]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.reviewer_name),1)]),(0,s.Lk)("span",vr,[t[11]||(t[11]=(0,s.Lk)("i",{class:"fas fa-calendar"},null,-1)),(0,s.eW)(" "+(0,d.v_)(n.formatDate(e.approved_date||e.created_date)),1)])])]),e.rejection_reason?((0,s.uX)(),(0,s.CE)("div",kr,[t[12]||(t[12]=(0,s.Lk)("div",{class:"reason-header"},[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" Rejection Reason: ")],-1)),(0,s.Lk)("div",hr,(0,d.v_)(e.rejection_reason),1)])):(0,s.Q3)("",!0),e.extracted_data?((0,s.uX)(),(0,s.CE)("div",gr,[t[15]||(t[15]=(0,s.Lk)("div",{class:"details-header"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Review Details ")],-1)),(0,s.Lk)("div",yr,[e.extracted_data.PolicyName?((0,s.uX)(),(0,s.CE)("div",fr,[t[13]||(t[13]=(0,s.Lk)("span",{class:"detail-label"},"Policy Name:",-1)),(0,s.Lk)("span",br,(0,d.v_)(e.extracted_data.PolicyName),1)])):(0,s.Q3)("",!0),e.extracted_data.ReviewComments?((0,s.uX)(),(0,s.CE)("div",Cr,[t[14]||(t[14]=(0,s.Lk)("span",{class:"detail-label"},"Comments:",-1)),(0,s.Lk)("span",Lr,(0,d.v_)(e.extracted_data.ReviewComments),1)])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])],2))),128))]))])]),(0,s.Lk)("div",wr,[(0,s.Lk)("button",{class:"btn-secondary",onClick:t[1]||(t[1]=t=>e.$emit("close"))}," Close ")])])])}var Rr={name:"ReviewHistoryModal",props:{policyId:{type:[Number,String],required:!0},policyName:{type:String,default:"Unknown Policy"},currentStatus:{type:String,default:"Unknown"}},emits:["close"],data(){return{reviewHistory:[],loading:!0,error:null}},async mounted(){await this.fetchReviewHistory()},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async fetchReviewHistory(){try{this.loading=!0;const e=await He.A.get(`http://localhost:8000/api/policies/${this.policyId}/review-history/`);e.data.success?(this.reviewHistory=e.data.review_history,this.sendPushNotification({title:"Review History Loaded Successfully",message:`Review history for policy "${this.policyName}" has been loaded successfully.`,category:"policy",priority:"medium",user_id:"default_user"})):(this.error=e.data.error||"Failed to load review history",this.sendPushNotification({title:"Review History Load Failed",message:`Failed to load review history for policy "${this.policyName}": ${this.error}`,category:"policy",priority:"high",user_id:"default_user"}))}catch(e){console.error("Error fetching review history:",e),this.error="Failed to load review history",this.sendPushNotification({title:"Review History Load Failed",message:`Failed to load review history for policy "${this.policyName}": ${e.message||"Network error"}`,category:"policy",priority:"high",user_id:"default_user"})}finally{this.loading=!1}},formatDate(e){if(!e)return"N/A";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}catch(t){return e}}}};const Ir=(0,le.A)(Rr,[["render",Er],["__scopeId","data-v-df2046fe"]]);var Dr=Ir,Pr={name:"PolicyApprover",components:{PopupModal:Ta,CollapsibleTable:zn,DynamicTable:Hn.A,ReviewHistoryModal:Dr},data(){return{approvals:[],selectedApproval:null,showDetails:!1,showRejectModal:!1,rejectingSubpolicy:null,rejectingType:"",rejectionComment:"",rejectedPolicies:[],rejectedSubpolicies:[],showEditModal:!1,editingPolicy:null,showEditSubpolicyModal:!1,editingSubpolicy:null,editingSubpolicyParent:null,userId:2,showSubpoliciesModal:!1,selectedPolicyForSubpolicies:null,showEditComplianceModal:!1,editingCompliance:null,isReviewer:!0,showReviewHistoryModal:!1,selectedPolicyId:null,selectedPolicyName:"",selectedPolicyStatus:"",activeTab:"myTasks",isAdministrator:!1,availableUsers:[],selectedUserId:null,selectedUserInfo:null,currentUserId:2,myTasks:[],reviewerTasks:[],policyCategories:[],policyCategoriesMap:{},tableHeaders:[{key:"policyName",label:"Policy Name",sortable:!0,width:"200px"},{key:"type",label:"Type",sortable:!0,width:"100px"},{key:"scope",label:"Scope",sortable:!0,width:"150px"},{key:"createdBy",label:"Created By",sortable:!0,width:"120px"},{key:"createdDate",label:"Created Date",sortable:!0,width:"120px"},{key:"status",label:"Status",sortable:!0,width:"100px"},{key:"actions",label:"Actions",sortable:!1,width:"120px"}],expandedSections:{pending:!0,approved:!0,rejected:!0},rejectedTableColumns:[{key:"policyId",label:"Policy ID",sortable:!0,headerStyle:{width:"150px"},maxLength:20},{key:"type",label:"Type",sortable:!0,headerStyle:{width:"100px"},type:"status"},{key:"description",label:"Description",sortable:!0,headerStyle:{width:"200px"},maxLength:50},{key:"rejectionReason",label:"Rejection Reason",sortable:!1,headerStyle:{width:"250px"},maxLength:60},{key:"createdDate",label:"Created Date",sortable:!0,headerStyle:{width:"120px"}}],rejectedTableFilters:[{name:"type",label:"Type",type:"dropdown",options:[{value:"all",label:"All Types"},{value:"policy",label:"Policy"},{value:"subpolicy",label:"Subpolicy"},{value:"compliance",label:"Compliance"}],defaultValue:"all",filterFunction:(e,t)=>"all"===t||e.type.toLowerCase()===t.toLowerCase()}],collapsiblePagination:{pending:{currentPage:1,pageSize:6},approved:{currentPage:1,pageSize:6},rejected:{currentPage:1,pageSize:6}}}},mounted(){console.log("PolicyApprover component mounted"),console.log("Initial data state:",{isAdministrator:this.isAdministrator,currentUserId:this.currentUserId,selectedUserId:this.selectedUserId,availableUsers:this.availableUsers}),this.initializeUser()},watch:{isReviewer(e){e?(this.fetchPolicies(),this.fetchRejectedPolicies()):this.fetchRejectedSubpolicies()}},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async initializeUser(){try{console.log("Initializing user and checking role...");const e=await He.A.get("http://localhost:8000/api/user-role/");if(console.log("User role API response:",e.data),e.data.success){this.currentUserId=e.data.user_id;const t=e.data.role;console.log("User role received:",t),this.isAdministrator="GRC Administrator"===t,console.log("Is GRC Administrator:",this.isAdministrator),this.isAdministrator?(console.log("User is GRC Administrator, fetching all users for dropdown..."),await this.fetchUsers(),this.selectedUserId=null):(console.log("User is not GRC Administrator, setting selected user to current user"),this.selectedUserId=this.currentUserId,await this.loadUserTasks()),this.fetchRejectedPolicies(),this.fetchPolicyTypes()}else console.error("User role API did not return success:",e.data),alert("Error: Could not determine user role. Please contact administrator."),this.sendPushNotification({title:"User Role Error",message:"Could not determine user role. Please contact administrator.",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})}catch(e){console.error("Error initializing user:",e),alert("Error: Could not initialize user. Please refresh the page and try again."),this.sendPushNotification({title:"User Initialization Error",message:"Could not initialize user. Please refresh the page and try again.",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})}},async fetchUsers(){try{console.log("Fetching users for dropdown from RBAC...");const e=await He.A.get("http://localhost:8000/api/users-for-dropdown/");console.log("Users API response:",e.data),Array.isArray(e.data)?this.availableUsers=e.data:e.data&&e.data.success&&Array.isArray(e.data.data)?this.availableUsers=e.data.data:this.availableUsers=e.data||[],console.log("Available users loaded:",this.availableUsers.length,"users"),console.log("Users:",this.availableUsers),0===this.availableUsers.length&&(console.error("No users found in RBAC table"),alert("Error: No users found. Please contact administrator."),this.sendPushNotification({title:"No Users Found",message:"No users found in RBAC table. Please contact administrator.",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"}))}catch(e){console.error("Error fetching users:",e),this.availableUsers=[],alert("Error: Could not load users list. Please contact administrator."),this.sendPushNotification({title:"Users List Error",message:"Could not load users list. Please contact administrator.",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})}},async onUserChange(){console.log("User selection changed to:",this.selectedUserId),console.log("Available users:",this.availableUsers),this.selectedUserId?(this.selectedUserInfo=this.availableUsers.find(e=>e.UserId==this.selectedUserId),console.log("Selected user info:",this.selectedUserInfo),this.selectedUserInfo?(console.log(`Loading tasks for user: ${this.selectedUserInfo.UserName} (ID: ${this.selectedUserId})`),await this.loadUserTasks()):console.warn("Could not find user info for selected user ID:",this.selectedUserId)):(console.log("No user selected, clearing user info and tasks"),this.selectedUserInfo=null,this.myTasks=[],this.reviewerTasks=[])},switchTab(e){this.activeTab=e},showReviewHistory(e,t,i){this.selectedPolicyId=e,this.selectedPolicyName=t,this.selectedPolicyStatus=i,this.showReviewHistoryModal=!0},closeReviewHistoryModal(){this.showReviewHistoryModal=!1,this.selectedPolicyId=null,this.selectedPolicyName="",this.selectedPolicyStatus=""},async loadUserTasks(){const e=this.selectedUserId||this.currentUserId;if(console.log("Loading user tasks for user ID:",e),console.log("Selected user ID:",this.selectedUserId),console.log("Current user ID:",this.currentUserId),console.log("Is Administrator:",this.isAdministrator),this.isAdministrator&&!this.selectedUserId)return console.log("Administrator with no user selected - clearing tasks"),this.myTasks=[],void(this.reviewerTasks=[]);try{await this.fetchMyTasks(e),await this.fetchReviewerTasks(e)}catch(t){console.error("Error loading user tasks:",t),this.myTasks=[],this.reviewerTasks=[]}},async fetchMyTasks(e){try{const t=await He.A.get(`http://localhost:8000/api/policy-approvals/user/${e}/`);let i;i=t.data.success&&t.data.data?t.data.data:Array.isArray(t.data)?t.data:[],this.myTasks=i.map(e=>({ApprovalId:e.ApprovalId,PolicyId:e.PolicyId,ExtractedData:e.ExtractedData,ApprovedNot:e.ApprovedNot,ApprovedDate:e.ApprovedDate,version:e.Version,UserId:e.UserId,ReviewerId:e.ReviewerId,dbStatus:null})),await this.updateTasksWithPolicyStatus(this.myTasks)}catch(t){console.error("Error fetching my tasks:",t),this.myTasks=[]}},async fetchReviewerTasks(e){try{const t=await He.A.get(`http://localhost:8000/api/policy-approvals/reviewer/${e}/`);let i;i=t.data.success&&t.data.data?t.data.data:Array.isArray(t.data)?t.data:[],this.reviewerTasks=i.map(e=>({ApprovalId:e.ApprovalId,PolicyId:e.PolicyId,ExtractedData:e.ExtractedData,ApprovedNot:e.ApprovedNot,ApprovedDate:e.ApprovedDate,version:e.Version,UserId:e.UserId,ReviewerId:e.ReviewerId,dbStatus:null})),await this.updateTasksWithPolicyStatus(this.reviewerTasks)}catch(t){console.error("Error fetching reviewer tasks:",t),this.fetchPolicies()}},async updateTasksWithPolicyStatus(e){const t=e.filter(e=>e.PolicyId).map(e=>"object"===typeof e.PolicyId?e.PolicyId.PolicyId:e.PolicyId);if(t.length>0){const i=t.map(e=>He.A.get(`http://localhost:8000/api/policies/${e}/`).then(t=>({policyId:e,status:t.data.Status})).catch(t=>(console.error(`Error fetching policy ${e}:`,t),{policyId:e,status:null}))),a=await Promise.all(i);a.forEach(t=>{const i=e.find(e=>{const i="object"===typeof e.PolicyId?e.PolicyId.PolicyId:e.PolicyId;return i===t.policyId});i&&(i.dbStatus=t.status)})}},fetchPolicies(){console.log("Fetching policy approvals for reviewer..."),He.A.get("http://localhost:8000/api/policy-approvals/reviewer/").then(e=>{let t;if(console.log("Policy approvals response:",e.data),e.data.success&&e.data.data)t=e.data.data;else{if(!Array.isArray(e.data))return void console.error("Unexpected response format:",e.data);t=e.data}const i=t.map(e=>({ApprovalId:e.ApprovalId,PolicyId:e.PolicyId,ExtractedData:e.ExtractedData,ApprovedNot:e.ApprovedNot,ApprovedDate:e.ApprovedDate,version:e.Version,UserId:e.UserId,ReviewerId:e.ReviewerId,dbStatus:null})),a=i.filter(e=>e.PolicyId).map(e=>"object"===typeof e.PolicyId?e.PolicyId.PolicyId:e.PolicyId);if(a.length>0){const e=a.map(e=>He.A.get(`http://localhost:8000/api/policies/${e}/`).then(t=>({policyId:e,status:t.data.Status})).catch(t=>(console.error(`Error fetching policy ${e}:`,t),{policyId:e,status:null})));Promise.all(e).then(e=>{e.forEach(e=>{const t=i.find(t=>{const i="object"===typeof t.PolicyId?t.PolicyId.PolicyId:t.PolicyId;return i===e.policyId});t&&(t.dbStatus=e.status,t.ExtractedData&&e.status&&(t.ExtractedData.Status=e.status))}),this.approvals=i,console.log("Updated approvals with database status:",this.approvals)}).catch(e=>{console.error("Error updating policy statuses:",e),this.approvals=i})}else this.approvals=i}).catch(e=>{console.error("Error fetching policy approvals:",e)})},openApprovalDetails(e){const t=this.getPolicyId(e);He.A.get(`http://localhost:8000/api/policies/${t}/`).then(i=>{const a=i.data.Status;let s;console.log(`Policy database status: ${a}`),"Rejected"===a?(s=`http://localhost:8000/api/policies/${t}/reviewer-version/`,console.log("Policy is rejected, fetching latest reviewer version...")):(s=`http://localhost:8000/api/policies/${t}/version/`,console.log("Policy is not rejected, fetching latest user version...")),He.A.get(s).then(i=>{const s=i.data.version||"u1";console.log(`Fetched policy version: ${s} for status: ${a}`),He.A.get(`http://localhost:8000/api/policy-approvals/latest/${t}/`).then(t=>{if(console.log("Latest policy approval:",t.data),t.data&&t.data.ExtractedData){const i=t.data,o={...e,...i,dbStatus:a,version:s,ExtractedData:i.ExtractedData};if(o.ExtractedData&&a&&(o.ExtractedData.Status=a),o.ExtractedData&&o.ExtractedData.subpolicies&&o.ExtractedData.subpolicies.length>0){console.log("Fetching versions for",o.ExtractedData.subpolicies.length,"subpolicies");const e=o.ExtractedData.subpolicies.map(e=>e.SubPolicyId?He.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`).then(t=>{const i=t.data.Status;let a;return e.Status=i,"Rejected"===i?(a=`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`,console.log(`Subpolicy ${e.SubPolicyId} is rejected, fetching reviewer version...`)):(a=`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/version/`,console.log(`Subpolicy ${e.SubPolicyId} is not rejected, fetching user version...`)),He.A.get(a).then(t=>{const a=t.data.version||"u1";return console.log(`Subpolicy ${e.SubPolicyId} version: ${a} for status: ${i}`),e.version=a,e}).catch(t=>(console.error(`Error fetching version for subpolicy ${e.SubPolicyId}:`,t),e.version="u1",e))}).catch(t=>(console.error(`Error fetching subpolicy status for ${e.SubPolicyId}:`,t),e.version="u1",e)):(e.version="u1",Promise.resolve(e)));Promise.all(e).then(e=>{o.ExtractedData.subpolicies=e,this.completeApprovalSelection(o)}).catch(e=>{console.error("Error updating subpolicy versions:",e),this.completeApprovalSelection(o)})}else this.completeApprovalSelection(o)}else{const t=JSON.parse(JSON.stringify(e));t.version=s,t.dbStatus=a,t.ExtractedData&&a&&(t.ExtractedData.Status=a),this.processSubpolicyVersions(t)}}).catch(t=>{console.error("Error fetching latest approval:",t);const i=JSON.parse(JSON.stringify(e));i.version=s,i.dbStatus=a,i.ExtractedData&&a&&(i.ExtractedData.Status=a),this.processSubpolicyVersions(i)})}).catch(t=>{console.error("Error fetching policy status:",t);const i=JSON.parse(JSON.stringify(e));i.version=e.version||"u1",this.processSubpolicyVersions(i)})}).catch(t=>{console.error("Error fetching policy version:",t),this.completeApprovalSelection(e)})},processSubpolicyVersions(e){if(e.ExtractedData&&e.ExtractedData.subpolicies&&e.ExtractedData.subpolicies.length>0){console.log("Fetching versions for",e.ExtractedData.subpolicies.length,"subpolicies");const t=e.ExtractedData.subpolicies.map(e=>e.SubPolicyId?He.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`).then(t=>{const i=t.data.Status;let a;return e.Status=i,"Rejected"===i?(a=`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`,console.log(`Subpolicy ${e.SubPolicyId} is rejected, fetching reviewer version...`)):(a=`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/version/`,console.log(`Subpolicy ${e.SubPolicyId} is not rejected, fetching user version...`)),He.A.get(a).then(t=>{const a=t.data.version||"u1";return console.log(`Subpolicy ${e.SubPolicyId} version: ${a} for status: ${i}`),e.version=a,e}).catch(t=>(console.error(`Error fetching version for subpolicy ${e.SubPolicyId}:`,t),e.version="u1",e))}).catch(t=>(console.error(`Error fetching subpolicy status for ${e.SubPolicyId}:`,t),e.version="u1",e)):(e.version="u1",Promise.resolve(e)));Promise.all(t).then(t=>{e.ExtractedData.subpolicies=t,this.completeApprovalSelection(e)}).catch(t=>{console.error("Error updating subpolicy versions:",t),this.completeApprovalSelection(e)})}else this.completeApprovalSelection(e)},completeApprovalSelection(e){this.selectedApproval=e,console.log("Displaying policy details:",{policyId:e.PolicyId,version:e.version,dbStatus:e.dbStatus,approvedNot:e.ApprovedNot,extractedDataStatus:e.ExtractedData?.Status}),this.selectedApproval.ExtractedData&&(!0===this.selectedApproval.ApprovedNot||"Approved"===this.selectedApproval.ExtractedData.Status)&&this.selectedApproval.ExtractedData.subpolicies&&(this.selectedApproval.ExtractedData.subpolicies=this.selectedApproval.ExtractedData.subpolicies.map(e=>(e.approval||(e.approval={}),e.approval.approved=!0,e.Status="Approved",e)),this.selectedApproval.showingApprovedOnly=!0),!this.selectedApproval.ExtractedData||!1!==this.selectedApproval.ApprovedNot&&"Rejected"!==this.selectedApproval.ExtractedData.Status||(console.log("Displaying rejected policy with rejection details:",{rejectionReason:this.selectedApproval.ExtractedData.rejection_reason,cascadingRejection:this.selectedApproval.ExtractedData.cascading_rejection,rejectedSubpolicyNames:this.selectedApproval.ExtractedData.rejected_subpolicy_names}),this.selectedApproval.showingRejectedDetails=!0),this.showDetails=!0},refreshData(){if(this.loadUserTasks(),this.selectedApproval&&this.selectedApproval.PolicyId&&this.openApprovalDetails(this.selectedApproval),this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.PolicyId){const e=this.selectedPolicyForSubpolicies.PolicyId;He.A.get(`http://localhost:8000/api/policies/${e}`).then(t=>{t.data&&He.A.get(`http://localhost:8000/api/policies/${e}/version/`).then(e=>{const i=e.data.version||"u1",a={...t.data,version:i};if(t.data.ExtractedData&&t.data.ExtractedData.subpolicies){const e=t.data.ExtractedData.subpolicies.map(e=>He.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/version/`).then(t=>({subpolicyId:e.SubPolicyId,version:t.data.version||"u1"})).catch(()=>({subpolicyId:e.SubPolicyId,version:"u1"})));Promise.all(e).then(e=>{a.ExtractedData&&a.ExtractedData.subpolicies&&a.ExtractedData.subpolicies.forEach(t=>{const i=e.find(e=>e.subpolicyId===t.SubPolicyId);i&&(t.version=i.version)}),this.selectedPolicyForSubpolicies=a})}else this.selectedPolicyForSubpolicies=a}).catch(e=>{console.error("Error fetching policy version:",e)})}).catch(e=>{console.error("Error refreshing policy data:",e)})}this.showRejectedSubpolicies&&this.fetchRejectedSubpolicies()},refreshApprovals(){this.fetchPolicies()},fetchRejectedPolicies(){console.log("Fetching rejected policies..."),He.A.get(`http://localhost:8000/api/policy-approvals/rejected/${this.currentUserId}/`).then(e=>{if(console.log("Rejected policy approvals response:",e.data),e.data&&Array.isArray(e.data)&&e.data.length>0){const t=e.data.map(e=>{console.log("Processing rejected approval:",e);let t="No rejection reason provided";e.ExtractedData&&(e.ExtractedData.rejection_reason?t=e.ExtractedData.rejection_reason:"cascading"===e.ExtractedData.rejection_type?t=`Cascading rejection: ${e.ExtractedData.rejected_subpolicy_name||"subpolicy"} was rejected`:e.ExtractedData.policy_approval?.remarks&&(t=e.ExtractedData.policy_approval.remarks));const i=e.ExtractedData?.PolicyName||`Policy ${e.PolicyId?.PolicyId||e.PolicyId}`,a=e.ExtractedData?.Scope||"No Scope",s={policyId:e.PolicyId?.PolicyId||e.PolicyId,type:"POLICY",description:i,rejectionReason:t,createdDate:e.ExtractedData?.CreatedByDate||(new Date).toISOString().split("T")[0],originalPolicy:e,rejectedVersion:e.Version,cascadingRejection:e.ExtractedData?.cascading_rejection||!1,rejectedSubpolicies:e.ExtractedData?.rejected_subpolicy_names||[],ExtractedData:{...e.ExtractedData,PolicyName:i,Scope:a,rejection_reason:t}};return console.log("Processed policy for table:",s),s});this.rejectedPolicies=t,console.log("All processed rejected policies:",this.rejectedPolicies)}else console.log("No rejected policy approvals found for user"),this.rejectedPolicies=[]}).catch(e=>{console.error("Error fetching rejected policy approvals:",e),this.fetchRejectedPoliciesFallback()})},fetchRejectedPoliciesFallback(){console.log("Using fallback method to fetch rejected policies..."),He.A.get("http://localhost:8000/api/policies/").then(e=>{console.log("All policies response:",e.data);let t=e.data;if(e.data.success&&e.data.data&&(t=e.data.data),Array.isArray(t)){const e=t.filter(e=>"Rejected"===e.Status||e.subpolicies&&e.subpolicies.some(e=>"Rejected"===e.Status));console.log("Found rejected policies (fallback):",e.length),this.rejectedPolicies=e.map(e=>({policyId:e.PolicyId,type:"POLICY",description:e.PolicyName||`Policy ${e.PolicyId}`,rejectionReason:"Policy or subpolicies rejected",createdDate:e.CreatedByDate||(new Date).toISOString().split("T")[0],originalPolicy:{PolicyId:e.PolicyId,ExtractedData:{PolicyName:e.PolicyName,CreatedByName:e.CreatedByName,CreatedByDate:e.CreatedByDate,Scope:e.Scope,Status:e.Status,Objective:e.Objective,subpolicies:e.subpolicies||[]},ApprovedNot:!1}}))}}).catch(e=>{console.error("Error in fallback method:",e),this.rejectedPolicies=[]})},fetchPoliciesWithRejectedSubpolicies(){console.log("Fetching policies with rejected subpolicies..."),He.A.get("http://localhost:8000/api/policies/").then(e=>{let t;if(console.log("All policies response:",e.data),e.data.success&&e.data.data)t=e.data.data;else{if(!Array.isArray(e.data))return void console.error("Unexpected response format:",e.data);t=e.data}if(console.log("Policies data length:",t.length),Array.isArray(t)){const e=t.filter(e=>e.subpolicies&&e.subpolicies.some(e=>"Rejected"===e.Status));console.log("Found policies with rejected subpolicies:",e.length),e.length>0&&(this.rejectedPolicies=e.map(e=>({PolicyId:e.PolicyId,ExtractedData:{type:"policy",PolicyName:e.PolicyName,CreatedByName:e.CreatedByName,CreatedByDate:e.CreatedByDate,Scope:e.Scope,Status:e.Status,Objective:e.Objective,subpolicies:e.subpolicies||[]},ApprovedNot:"Rejected"!==e.Status&&null,main_policy_rejected:"Rejected"===e.Status})))}}).catch(e=>{console.error("Error fetching policies with rejected subpolicies:",e)})},submitReview(){if(!this.isComplianceApproval){const e=this.selectedApproval.PolicyId,t={ExtractedData:JSON.parse(JSON.stringify(this.selectedApproval.ExtractedData)),ApprovedNot:this.selectedApproval.ApprovedNot,UserId:this.userId,ReviewerId:this.userId};return void He.A.get(`http://localhost:8000/api/policies/${e}/version/`).then(i=>{const a=i.data.version;console.log("Current version before submission:",a);const s=this.selectedApproval.ExtractedData.subpolicies&&this.selectedApproval.ExtractedData.subpolicies.some(e=>"Rejected"===e.Status);"approve"===this.reviewDecision&&s?(this.$swal({title:"Warning",text:"One or more subpolicies are rejected. The policy will still be marked as rejected regardless of approval.",icon:"warning",confirmButtonText:"Continue"}).then(()=>{this.submitPolicyReview(e,t,a)}),this.sendPushNotification({title:"Policy Review Warning",message:"One or more subpolicies are rejected. The policy will still be marked as rejected regardless of approval.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"})):this.submitPolicyReview(e,t,a)}).catch(e=>{console.error("Error getting policy version:",e),ya.error("Error getting policy version: "+(e.response?.data?.error||e.message),"Policy Version Error"),this.sendPushNotification({title:"Policy Version Error",message:`Failed to get policy version: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})}const e={ExtractedData:JSON.parse(JSON.stringify(this.selectedApproval.ExtractedData)),ApprovedNot:this.selectedApproval.ApprovedNot};He.A.put(`http://localhost:8000/api/compliance-approvals/${this.selectedApproval.ApprovalId}/review/`,e).then(e=>{console.log("Response:",e.data),e.data.ApprovalId&&(this.selectedApproval.ApprovalId=e.data.ApprovalId,this.selectedApproval.Version=e.data.Version,e.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=e.data.ApprovedDate),ya.success("Compliance review submitted successfully!","Review Submitted"),this.sendPushNotification({title:"Compliance Review Submitted",message:"Compliance review has been submitted successfully for approval.",category:"compliance",priority:"medium",user_id:this.currentUserId||"default_user"}),this.closeApprovalDetails(),this.refreshApprovals())}).catch(e=>{console.error("Error submitting compliance review:",e),ya.error("Error submitting review: "+(e.response?.data?.error||e.message),"Review Error"),this.sendPushNotification({title:"Compliance Review Error",message:`Failed to submit compliance review: ${e.response?.data?.error||e.message}`,category:"compliance",priority:"high",user_id:this.currentUserId||"default_user"})})},submitPolicyReview(e,t,i){He.A.post(`http://localhost:8000/api/policies/${e}/submit-review/`,{...t,currentVersion:i,approved:"approve"===this.reviewDecision}).then(e=>{console.log("Policy review submitted successfully:",e.data),this.selectedApproval.Version=e.data.Version,e.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=e.data.ApprovedDate),ya.success(`Policy review submitted successfully! New version: ${e.data.Version}`,"Review Submitted"),this.sendPushNotification({title:"Policy Review Submitted",message:`Policy review has been submitted successfully with version ${e.data.Version}.`,category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"}),this.closeApprovalDetails(),this.refreshApprovals()}).catch(e=>{console.error("Error submitting review:",e),ya.error("Error submitting review: "+(e.response?.data?.error||e.message),"Submission Error"),this.sendPushNotification({title:"Policy Review Error",message:`Failed to submit policy review: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})},resubmitPolicy(e){const t=this.getPolicyId(e);console.log("=== RESUBMIT POLICY DEBUG ==="),console.log("Resubmitting policy with ID:",t),console.log("Full policy object:",e),console.log("Policy ExtractedData:",e.ExtractedData),console.log("Original policy in policy object:",e.originalPolicy);const i=e.originalPolicy||e,a=this.getPolicyId(i);console.log("Using actual policy:",i),console.log("Using actual policy ID:",a),console.log("Checking policy status before resubmission..."),He.A.get(`http://localhost:8000/api/policies/${a}/debug-status/`).then(e=>{console.log("Policy debug status:",e.data);const t=this.validatePolicyData(i);if(t.length>0)return ya.warning(`Please fix the following errors before resubmitting:\n${t.join("\n")}`,"Validation Errors"),void this.sendPushNotification({title:"Policy Validation Errors",message:`Policy validation failed: ${t.join(", ")}`,category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"});this.performPolicyResubmission(i,a)}).catch(e=>{console.error("Error checking policy status:",e),ya.warning("Error checking policy status. Proceeding with resubmission attempt.","Warning"),this.sendPushNotification({title:"Policy Status Check Warning",message:"Error checking policy status. Proceeding with resubmission attempt.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"});const t=this.validatePolicyData(i);if(t.length>0)return ya.warning(`Please fix the following errors before resubmitting:\n${t.join("\n")}`,"Validation Errors"),void this.sendPushNotification({title:"Policy Validation Errors",message:`Policy validation failed: ${t.join(", ")}`,category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"});this.performPolicyResubmission(i,a)})},performPolicyResubmission(e,t){e.ExtractedData&&e.ExtractedData.subpolicies&&e.ExtractedData.subpolicies.length>0?e.ExtractedData.subpolicies.forEach((e,t)=>{console.log(`Checking subpolicy ${t} with ID: ${e.SubPolicyId}`),e.SubPolicyName||console.warn(`SubPolicyName is missing for subpolicy ${t}`),e.Description||console.warn(`Description is missing for subpolicy ${t}`)}):console.warn("No subpolicies found in policy data or subpolicies array is not properly structured");const i={PolicyName:e.ExtractedData?.PolicyName||e.PolicyName,PolicyDescription:e.ExtractedData?.PolicyDescription||e.PolicyDescription,Scope:e.ExtractedData?.Scope||e.Scope,Objective:e.ExtractedData?.Objective||e.Objective,Department:e.ExtractedData?.Department||e.Department,Applicability:e.ExtractedData?.Applicability||e.Applicability,subpolicies:e.ExtractedData?.subpolicies||[],currentStatus:"Rejected",rejectionReason:e.ExtractedData?.rejection_reason||e.rejectionReason,currentVersion:e.Version||e.rejectedVersion};console.log("Prepared resubmission data:",i),console.log("Subpolicies in resubmission data:",i.subpolicies),console.log("Number of subpolicies:",i.subpolicies.length),console.log(`Making request to: /api/policies/${t}/resubmit-approval/`),He.A.put(`http://localhost:8000/api/policies/${t}/resubmit-approval/`,i).then(e=>{console.log("Policy resubmitted successfully:",e.data);let t=`Policy resubmitted for review! New version: ${e.data.Version}`;e.data.UserId&&(t+=` (UserId: ${e.data.UserId})`),e.data.reviewer_assigned&&(t+=` (Assigned to ReviewerId: ${e.data.ReviewerId})`),ya.success(t,"Policy Resubmitted"),this.sendPushNotification({title:"Policy Resubmitted",message:t,category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"}),this.closeEditModal(),this.fetchRejectedPolicies(),this.fetchPolicies()}).catch(e=>{console.error("Error data:",e.response?e.response.data:"No response data"),this.handleError(e,"resubmitting policy")})},validatePolicyData(e){const t=[],i=e.ExtractedData?.PolicyName||e.PolicyName,a=e.ExtractedData?.PolicyDescription||e.PolicyDescription,s=e.ExtractedData?.subpolicies||[];return i||t.push("Policy Name is required"),a||t.push("Policy Description is required"),s&&s.length>0&&s.forEach((e,i)=>{e.SubPolicyName||t.push(`Subpolicy #${i+1} is missing a name`),e.Description||t.push(`Subpolicy #${i+1} is missing a description`)}),t},handleError(e,t){console.error(`Error ${t}:`,e);let i="An unexpected error occurred";return i=e.response?e.response.data&&e.response.data.error?e.response.data.error:e.response.data&&"string"===typeof e.response.data?e.response.data:`Server error: ${e.response.status}`:e.request?"No response from server. Please check your connection.":e.message||i,ya.error(`Error ${t}: ${i}`,"Error"),this.sendPushNotification({title:"Policy Error",message:`Error ${t}: ${i}`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"}),i},approveSubpolicy(e){e.approval||(e.approval={}),e.approval.approved=!0,e.approval.remarks="",He.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`,{Status:"Approved"}).then(t=>(console.log("Subpolicy status updated successfully:",t.data),He.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/review/`,{Status:"Approved"}))).then(e=>{console.log("Subpolicy approval created successfully:",e.data),e.data.PolicyUpdated&&(console.log(`Policy status updated to: ${e.data.PolicyStatus}`),this.fetchPolicies(),this.selectedApproval&&this.selectedApproval.ExtractedData&&(this.selectedApproval.ExtractedData.Status=e.data.PolicyStatus)),this.checkAllSubpoliciesApproved()}).catch(e=>{console.error("Error approving subpolicy:",e),ya.error("Error approving subpolicy. Please try again.","Approval Error"),this.sendPushNotification({title:"Subpolicy Approval Error",message:"Error approving subpolicy. Please try again.",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})},checkAllSubpoliciesApproved(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData||!this.selectedApproval.ExtractedData.subpolicies||0===this.selectedApproval.ExtractedData.subpolicies.length)return;const e=this.selectedApproval.ExtractedData.subpolicies,t=e.every(e=>!0===e.approval?.approved);t&&(console.log("All subpolicies are approved! The policy should be automatically approved"),this.selectedApproval.ExtractedData.policy_approval||(this.selectedApproval.ExtractedData.policy_approval={}),this.selectedApproval.ExtractedData.policy_approval.approved=!0,this.selectedApproval.ApprovedNot=!0,ya.success("All subpolicies are approved! The policy has been automatically approved.","Auto-Approval"),this.sendPushNotification({title:"All Subpolicies Approved",message:"All subpolicies are approved! The policy has been automatically approved.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"}))},rejectSubpolicy(e){this.rejectingType="subpolicy",this.rejectingSubpolicy=e,this.showRejectModal=!0},cancelRejection(){this.showRejectModal=!1,this.rejectingSubpolicy=null,this.rejectingType="",this.rejectionComment=""},confirmRejection(){if("policy"===this.rejectingType&&this.rejectingPolicy){const e="object"===typeof this.rejectingPolicy.PolicyId?this.rejectingPolicy.PolicyId.PolicyId:this.rejectingPolicy.PolicyId;console.log("Rejecting policy with ID:",e),He.A.put(`http://localhost:8000/api/policies/${e}/`,{Status:"Rejected"}).then(()=>{this.rejectingPolicy.ExtractedData.Status="Rejected",this.rejectingPolicy.policy_approval={approved:!1,remarks:this.rejectionComment},this.showRejectModal=!1,this.rejectingPolicy=null,this.rejectingType="",this.rejectionComment=""}).catch(e=>{console.error("Error rejecting policy:",e),ya.error("Error rejecting policy: "+(e.response?.data?.error||e.message),"Rejection Error"),this.sendPushNotification({title:"Policy Rejection Error",message:`Error rejecting policy: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})}else if("subpolicy"===this.rejectingType&&this.rejectingSubpolicy){if(!this.rejectingSubpolicy.SubPolicyId)return console.error("Missing SubPolicyId, cannot reject subpolicy",this.rejectingSubpolicy),ya.error("Error: Cannot reject subpolicy - missing SubPolicyId","Missing ID Error"),this.sendPushNotification({title:"Subpolicy Rejection Error",message:"Cannot reject subpolicy - missing SubPolicyId",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"}),this.showRejectModal=!1,this.rejectingSubpolicy=null,this.rejectingType="",void(this.rejectionComment="");console.log("Rejecting subpolicy with ID:",this.rejectingSubpolicy.SubPolicyId),console.log("Current user info:",{userId:this.currentUserId,isAdministrator:this.isAdministrator,selectedUserId:this.selectedUserId});const e="Rejected";console.log("Sending data:",{Status:e}),He.A.put(`http://localhost:8000/api/subpolicies/${this.rejectingSubpolicy.SubPolicyId}/reject/`,{rejection_reason:this.rejectionComment,remarks:this.rejectionComment}).then(e=>{console.log("Subpolicy rejected successfully:",e.data),"cascading"===e.data.rejection_type?(console.log("Cascading rejection completed:",e.data),ya.success(e.data.popup_message||`Policy '${e.data.parent_policy_name}' and all its ${e.data.total_subpolicies_rejected} subpolicies have been rejected and saved as ${e.data.new_version}. This has been sent back to the user for revision.`,"Cascading Rejection Complete"),this.sendPushNotification({title:"Cascading Rejection Complete",message:e.data.popup_message||`Policy '${e.data.parent_policy_name}' and all its ${e.data.total_subpolicies_rejected} subpolicies have been rejected and saved as ${e.data.new_version}. This has been sent back to the user for revision.`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"}),this.approvals&&this.approvals.length>0&&this.approvals.forEach(t=>{t.ExtractedData&&t.ExtractedData.subpolicies&&t.ExtractedData.subpolicies.forEach(t=>{e.data.rejected_subpolicy_names.includes(t.SubPolicyName)&&(t.Status="Rejected",t.approval&&(t.approval.approved=!1,t.approval.remarks=this.rejectionComment))})}),console.log("Cascading rejection details:",{originalSubpolicy:e.data.original_subpolicy_name,parentPolicy:e.data.parent_policy_name,totalRejected:e.data.total_subpolicies_rejected,version:e.data.new_version,rejectedSubpolicies:e.data.rejected_subpolicy_names})):(this.rejectingSubpolicy.approval||(this.rejectingSubpolicy.approval={}),this.rejectingSubpolicy.Status="Rejected",this.rejectingSubpolicy.approval.approved=!1,this.rejectingSubpolicy.approval.remarks=this.rejectionComment,ya.success("Subpolicy rejected successfully!","Rejection Complete"),this.sendPushNotification({title:"Subpolicy Rejected",message:"Subpolicy has been rejected successfully.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"})),this.showRejectModal=!1,this.rejectingSubpolicy=null,this.rejectingType="",this.rejectionComment="",this.refreshData()}).catch(e=>{console.error("Error rejecting subpolicy:",e),console.error("Error details:",{status:e.response?.status,statusText:e.response?.statusText,data:e.response?.data,message:e.message});let t="Error rejecting subpolicy. Please try again.";401===e.response?.status?t="Authentication error. Please log in again.":403===e.response?.status?t="Access denied. You don't have permission to reject this subpolicy. Please contact your administrator.":e.response?.data?.error&&(t=e.response.data.error),ya.error(t,"Rejection Error"),this.sendPushNotification({title:"Subpolicy Rejection Error",message:t,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})}},getPolicyId(e){return e.policyId?e.policyId:e.PolicyId?"object"===typeof e.PolicyId?e.PolicyId.PolicyId:e.PolicyId:e.ApprovalId?e.ApprovalId:e.id?e.id:"Unknown"},closeApprovalDetails(){this.selectedApproval=null,this.showDetails=!1},approveCompliance(){this.selectedApproval.ExtractedData.compliance_approval||(this.selectedApproval.ExtractedData.compliance_approval={}),this.selectedApproval.ExtractedData.compliance_approval.approved=!0,this.selectedApproval.ExtractedData.compliance_approval.remarks="",this.selectedApproval.ApprovedNot=!0},rejectCompliance(){this.rejectingType="compliance",this.showRejectModal=!0},openRejectedItem(e){e.is_compliance?(this.editingCompliance=JSON.parse(JSON.stringify(e)),this.showEditComplianceModal=!0):(console.log("Opening rejected policy item for editing:",e),e.originalPolicy?this.openRejectedPolicy(e.originalPolicy):this.openRejectedPolicy(e))},closeEditComplianceModal(){this.showEditComplianceModal=!1,this.editingCompliance=null},resubmitCompliance(e){e.ExtractedData.compliance_approval&&(e.ExtractedData.compliance_approval.approved=null,e.ExtractedData.compliance_approval.remarks=""),He.A.put(`http://localhost:8000/api/compliance-approvals/resubmit/${e.ApprovalId}/`,{ExtractedData:e.ExtractedData}).then(()=>{ya.success("Compliance resubmitted for review!","Compliance Resubmitted"),this.showEditComplianceModal=!1,this.fetchRejectedPolicies(),setTimeout(()=>{window.location.reload()},500),this.sendPushNotification({title:"Compliance Resubmitted",message:"Compliance has been resubmitted for review.",category:"compliance",priority:"medium",user_id:this.currentUserId||"default_user"})}).catch(e=>{ya.error("Error resubmitting compliance","Resubmission Error"),console.error(e),this.sendPushNotification({title:"Compliance Resubmission Error",message:"Error resubmitting compliance. Please try again.",category:"compliance",priority:"high",user_id:this.currentUserId||"default_user"})})},showEditFormInline(e){console.log("Opening inline edit form for subpolicy:",e.SubPolicyId),e.originalDescription=e.Description,e.originalControl=e.Control,e.approval||(e.approval={remarks:"",approved:!1}),("Rejected"===e.Status||e.approval&&!1===e.approval.approved)&&He.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`).then(t=>{const i=t.data.version||"R1";if(console.log(`Using reviewer version ${i} for rejected subpolicy ${e.SubPolicyId}`),e.reviewerVersion=i,t.data.approval_data&&t.data.approval_data.ExtractedData&&t.data.approval_data.ExtractedData.subpolicies){const i=t.data.approval_data,a=i.ExtractedData.subpolicies.find(t=>t.SubPolicyId===e.SubPolicyId);if(a){const t=e.originalDescription,i=e.originalControl;Object.assign(e,a),e.originalDescription=t,e.originalControl=i,e.approval||(e.approval={remarks:"",approved:!1}),console.log(`Updated subpolicy ${e.SubPolicyId} with R version data for inline edit`)}}}).catch(t=>{console.error("Error fetching reviewer version:",t),e.reviewerVersion="R1"}),e.showEditForm=!0},hideEditFormInline(e){e.showEditForm=!1},resubmitSubpolicy(){if(!this.editingSubpolicy||!this.editingSubpolicy.SubPolicyId)return console.error("Missing SubPolicyId, cannot resubmit subpolicy",this.editingSubpolicy),ya.error("Error: Cannot resubmit subpolicy - missing SubPolicyId","Missing ID Error"),void this.sendPushNotification({title:"Subpolicy Resubmission Error",message:"Cannot resubmit subpolicy - missing SubPolicyId",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"});if(!this.hasChanges)return ya.warning("No changes detected. Please modify the subpolicy before resubmitting.","No Changes"),void this.sendPushNotification({title:"No Changes Detected",message:"No changes detected. Please modify the subpolicy before resubmitting.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"});const e={Control:this.editingSubpolicy.Control,Description:this.editingSubpolicy.Description,SubPolicyId:this.editingSubpolicy.SubPolicyId};He.A.put(`http://localhost:8000/api/subpolicies/${this.editingSubpolicy.SubPolicyId}/resubmit/`,e).then(e=>{console.log("Subpolicy resubmitted successfully:",e.data);const t=e.data.version;this.editingSubpolicy.Status="Under Review",this.editingSubpolicy.version=t,this.editingSubpolicy.approval||(this.editingSubpolicy.approval={}),this.editingSubpolicy.approval.approved=null,this.editingSubpolicy.resubmitted=!0,ya.success(`Subpolicy "${this.editingSubpolicy.SubPolicyName}" resubmitted successfully with version ${t}!`,"Subpolicy Resubmitted"),this.sendPushNotification({title:"Subpolicy Resubmitted",message:`Subpolicy "${this.editingSubpolicy.SubPolicyName}" resubmitted successfully with version ${t}!`,category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"}),this.closeEditSubpolicyModal(),this.fetchRejectedSubpolicies(),this.refreshData()}).catch(e=>{console.error("Error resubmitting subpolicy:",e.response||e),ya.error(`Error resubmitting subpolicy: ${e.response?.data?.error||e.message}`,"Resubmission Error"),this.sendPushNotification({title:"Subpolicy Resubmission Error",message:`Error resubmitting subpolicy: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})},updateSubpolicyReferences(e,t){if(this.selectedApproval?.ExtractedData?.subpolicies){const i=this.selectedApproval.ExtractedData.subpolicies.find(t=>t.SubPolicyId===e);i&&Object.assign(i,t)}if(this.selectedPolicyForSubpolicies?.ExtractedData?.subpolicies){const i=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.find(t=>t.SubPolicyId===e);i&&Object.assign(i,t)}const i=this.rejectedSubpolicies.find(t=>t.SubPolicyId===e);i&&Object.assign(i,t)},resubmitSubpolicyDirect(e){if(!e.SubPolicyId)return console.error("Missing SubPolicyId, cannot resubmit subpolicy",e),ya.error("Error: Cannot resubmit subpolicy - missing SubPolicyId","Missing ID Error"),void this.sendPushNotification({title:"Subpolicy Resubmission Error",message:"Cannot resubmit subpolicy - missing SubPolicyId",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"});const t=e.Description!==e.originalDescription||e.Control!==e.originalControl;if(!t)return ya.warning("No changes detected. Please modify the subpolicy before resubmitting.","No Changes"),void this.sendPushNotification({title:"No Changes Detected",message:"No changes detected. Please modify the subpolicy before resubmitting.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"});console.log("Resubmitting subpolicy with ID:",e.SubPolicyId),console.log("Changes detected in inline edit form");const i={Description:e.originalDescription,Control:e.originalControl};e.resubmitted=!0;const a={Control:e.Control,Description:e.Description,previousVersion:i,SubPolicyId:e.SubPolicyId};He.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/resubmit/`,a).then(t=>{console.log("Subpolicy resubmitted successfully:",t.data),e.Status="Under Review",e.approval||(e.approval={}),e.approval.approved=null,e.previousVersion=i,t.data.Version&&(e.version=t.data.Version),ya.success(`Subpolicy "${e.SubPolicyName}" resubmitted successfully with version ${t.data.Version||"u1"}!`,"Subpolicy Resubmitted"),this.sendPushNotification({title:"Subpolicy Resubmitted",message:`Subpolicy "${e.SubPolicyName}" resubmitted successfully with version ${t.data.Version||"u1"}!`,category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"}),this.hideEditFormInline(e),this.closeSubpoliciesModal(),this.fetchRejectedSubpolicies(),this.fetchPolicies()}).catch(e=>{console.error("Error resubmitting subpolicy:",e.response||e),ya.error(`Error resubmitting subpolicy: ${e.response?.data?.error||e.message}`,"Resubmission Error"),this.sendPushNotification({title:"Subpolicy Resubmission Error",message:`Error resubmitting subpolicy: ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})},getSubpolicyVersion(e){return e.version?e.version:e.approval&&e.approval.version?e.approval.version:"u1"},openSubpoliciesModal(e){if(this.selectedPolicyForSubpolicies=e,e.ExtractedData&&(!0===e.ApprovedNot||"Approved"===e.ExtractedData.Status)&&e.ExtractedData.subpolicies)this.selectedPolicyForSubpolicies=JSON.parse(JSON.stringify(e)),this.selectedPolicyForSubpolicies.ExtractedData.subpolicies=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.map(e=>(e.approval||(e.approval={}),e.approval.approved=!0,e.Status="Approved",e));else if(e.ExtractedData&&(!1===e.ApprovedNot||"Rejected"===e.ExtractedData.Status)&&e.ExtractedData.subpolicies){this.selectedPolicyForSubpolicies=JSON.parse(JSON.stringify(e));const t=this.getPolicyId(e);He.A.get(`http://localhost:8000/api/policies/${t}/reviewer-version/`).then(e=>{const i=e.data.version||"R1";if(console.log(`Using reviewer version: ${i} for policy ${t}`),e.data.approval_data){const t=e.data.approval_data;if(console.log("Found R version approval data:",t),t.ExtractedData){const e=this.selectedPolicyForSubpolicies;this.selectedPolicyForSubpolicies={...e,ExtractedData:t.ExtractedData,reviewerVersion:i,ApprovalId:t.ApprovalId,Version:t.Version},console.log("Updated policy data with R version data:",this.selectedPolicyForSubpolicies)}}else this.selectedPolicyForSubpolicies.reviewerVersion=i,this.fetchSubpolicyVersions()}).catch(e=>{console.error("Error fetching policy reviewer version:",e),this.fetchSubpolicyVersions()})}this.showSubpoliciesModal=!0,this.isReviewer||setTimeout(()=>{this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.forEach(e=>{("Rejected"===e.Status||e.approval&&!1===e.approval.approved)&&(e.showEditForm=!0)})},100)},fetchSubpolicyVersions(){if(this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies){const e=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.map(e=>e.SubPolicyId?He.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`).then(t=>{const i=t.data.version||"R1";if(console.log(`Subpolicy ${e.SubPolicyId} reviewer version: ${i}`),e.reviewerVersion=i,t.data.approval_data&&t.data.approval_data.ExtractedData&&t.data.approval_data.ExtractedData.subpolicies){const i=t.data.approval_data,a=i.ExtractedData.subpolicies.find(t=>t.SubPolicyId===e.SubPolicyId);a&&(Object.assign(e,a),console.log(`Updated subpolicy ${e.SubPolicyId} with R version data`))}return e}).catch(t=>(console.error(`Error fetching reviewer version for subpolicy ${e.SubPolicyId}:`,t),e.reviewerVersion="R1",e)):(e.reviewerVersion="R1",Promise.resolve(e)));Promise.all(e).then(()=>{console.log("All reviewer versions fetched for subpolicies")})}},closeSubpoliciesModal(){this.selectedPolicyForSubpolicies=null,this.showSubpoliciesModal=!1},approveSubpolicyFromModal(e){e.approval||(e.approval={}),e.approval.approved=!0,e.approval.remarks="",He.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/`,{Status:"Approved"}).then(t=>(console.log("Subpolicy status updated successfully:",t.data),He.A.put(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/review/`,{Status:"Approved"}))).then(e=>{console.log("Subpolicy approval created successfully:",e.data),e.data.PolicyUpdated&&(console.log(`Policy status updated to: ${e.data.PolicyStatus}`),this.fetchPolicies(),this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&(this.selectedPolicyForSubpolicies.ExtractedData.Status=e.data.PolicyStatus)),this.checkAllModalSubpoliciesApproved()}).catch(e=>{console.error("Error approving subpolicy:",e),ya.error("Error approving subpolicy. Please try again.","Approval Error"),this.sendPushNotification({title:"Subpolicy Approval Error",message:"Error approving subpolicy. Please try again.",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"})})},checkAllModalSubpoliciesApproved(){if(!this.selectedPolicyForSubpolicies||!this.selectedPolicyForSubpolicies.ExtractedData||!this.selectedPolicyForSubpolicies.ExtractedData.subpolicies||0===this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.length)return;const e=this.selectedPolicyForSubpolicies.ExtractedData.subpolicies,t=e.every(e=>!0===e.approval?.approved);t&&(console.log("All subpolicies in the modal are approved! The policy should be automatically approved"),this.selectedPolicyForSubpolicies.ExtractedData.policy_approval||(this.selectedPolicyForSubpolicies.ExtractedData.policy_approval={}),this.selectedPolicyForSubpolicies.ExtractedData.policy_approval.approved=!0,this.selectedPolicyForSubpolicies.ApprovedNot=!0,ya.success("All subpolicies are approved! The policy has been automatically approved.","Auto-Approval"),this.sendPushNotification({title:"All Subpolicies Approved",message:"All subpolicies are approved! The policy has been automatically approved.",category:"policy",priority:"medium",user_id:this.currentUserId||"default_user"}))},rejectSubpolicyFromModal(e){this.rejectingType="subpolicy",this.rejectingSubpolicy=e,this.showRejectModal=!0},formatDate(e){if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},isNewPolicy(e){const t=e.ExtractedData?.CreatedByDate||e.created_at;if(!t)return!1;const i=new Date(t);if(isNaN(i.getTime()))return!1;const a=new Date;return a.setDate(a.getDate()-3),i>a},openEditSubpolicyModal(e){this.editingSubpolicy=JSON.parse(JSON.stringify(e)),this.editingSubpolicy.originalDescription=e.Description,this.editingSubpolicy.originalControl=e.Control,e.SubPolicyId&&He.A.get(`http://localhost:8000/api/subpolicies/${e.SubPolicyId}/reviewer-version/`).then(t=>{const i=t.data.version||"R1";if(console.log(`Fetched reviewer version for edit modal: ${i}`),this.editingSubpolicy.reviewerVersion=i,t.data.approval_data&&t.data.approval_data.ExtractedData&&t.data.approval_data.ExtractedData.subpolicies){const i=t.data.approval_data,a=i.ExtractedData.subpolicies.find(t=>t.SubPolicyId===e.SubPolicyId);if(a){const t=this.editingSubpolicy.originalDescription,i=this.editingSubpolicy.originalControl;Object.assign(this.editingSubpolicy,a),this.editingSubpolicy.originalDescription=t,this.editingSubpolicy.originalControl=i,console.log(`Updated subpolicy ${e.SubPolicyId} with R version data for edit modal`)}}}).catch(e=>{console.error("Error fetching reviewer version:",e),this.editingSubpolicy.reviewerVersion="R1"}),this.showEditSubpolicyModal=!0,console.log("Edit modal opened with subpolicy:",this.editingSubpolicy)},closeEditSubpolicyModal(){this.showEditSubpolicyModal=!1,this.editingSubpolicy=null},findSubpolicyById(e){return this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies?this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.find(t=>t.SubPolicyId===e):null},fetchRejectedSubpolicies(){console.log("Fetching rejected subpolicies..."),He.A.get("http://localhost:8000/api/policies/").then(e=>{console.log("Received policies for subpolicy check:",e.data.length);const t=e.data;let i=[];t.forEach(e=>{if(e.subpolicies&&e.subpolicies.length>0){console.log(`Policy ${e.PolicyId} has ${e.subpolicies.length} subpolicies`);const t=e.subpolicies.filter(e=>"Rejected"===e.Status);console.log(`Policy ${e.PolicyId} has ${t.length} rejected subpolicies`),t.forEach(t=>{t.PolicyName=e.PolicyName,t.PolicyId=e.PolicyId}),i=[...i,...t]}}),console.log("Total rejected subpolicies found:",i.length),this.rejectedSubpolicies=i,!this.isReviewer&&i.length>0&&this.updateRejectedSubpoliciesView()}).catch(e=>{console.error("Error fetching rejected subpolicies:",e)})},updateRejectedSubpoliciesView(){this.rejectedSubpolicies.length>0&&(this.activeTab="rejected")},trackChanges(){console.log("Changes detected in form")},incrementVersion(e){if(!e)return"u1";const t=e.match(/u(\d+)/);if(!t)return"u1";const i=parseInt(t[1])+1;return`u${i}`},getSubpolicyRemarks(e){return e&&e.approval&&e.approval.remarks?e.approval.remarks:"No reason provided"},fetchPolicyCategories(){He.A.get("http://localhost:8000/api/policy-categories/").then(e=>{e.data.success&&e.data.data?this.policyCategories=e.data.data:Array.isArray(e.data)?this.policyCategories=e.data:console.error("Unexpected response format:",e.data)}).catch(e=>{console.error("Error fetching policy categories:",e)})},fetchPolicyTypes(){console.log("Fetching policy categories..."),He.A.get("http://localhost:8000/api/policy-categories/").then(e=>{let t;if(console.log("Policy categories response:",e.data),e.data.success&&e.data.data)t=e.data.data;else{if(!Array.isArray(e.data))return void console.error("Unexpected response format:",e.data);t=e.data}this.policyCategories=t;const i={};t.forEach(e=>{i[e.PolicyType]||(i[e.PolicyType]={categories:{}}),i[e.PolicyType].categories[e.PolicyCategory]||(i[e.PolicyType].categories[e.PolicyCategory]={subCategories:[]}),i[e.PolicyType].categories[e.PolicyCategory].subCategories.push(e.PolicySubCategory)}),this.policyCategoriesMap=i,console.log("Processed policy categories map:",this.policyCategoriesMap)}).catch(e=>{console.error("Error fetching policy categories:",e)})},initializePolicyCategoryFields(e){return console.log(`Initializing policy category fields for policy: ${e.PolicyId||"New Policy"}`),e.ExtractedData.PolicyType||(e.ExtractedData.PolicyType=""),e.ExtractedData.PolicyCategory||(e.ExtractedData.PolicyCategory=""),e.ExtractedData.PolicySubCategory||(e.ExtractedData.PolicySubCategory=""),console.log("Current policy category fields:",{PolicyType:e.ExtractedData.PolicyType,PolicyCategory:e.ExtractedData.PolicyCategory,PolicySubCategory:e.ExtractedData.PolicySubCategory}),e},openRejectedPolicy(e){console.log("Opening rejected policy for editing:",e),this.editingPolicy=JSON.parse(JSON.stringify(e)),this.initializePolicyCategoryFields(this.editingPolicy),this.showEditModal=!0},closeEditModal(){this.showEditModal=!1,this.editingPolicy=null},handlePolicyTypeChange(e){console.log(`Policy type changed to: ${e.ExtractedData.PolicyType}`),e.ExtractedData.PolicyCategory="",e.ExtractedData.PolicySubCategory=""},handlePolicyCategoryChange(e){console.log(`Policy category changed to: ${e.ExtractedData.PolicyCategory}`),e.ExtractedData.PolicySubCategory=""},transformApprovalToTask(e){if(!e)return{incidentId:"N/A",policyName:"Unknown",type:"Policy",scope:"No Scope",createdBy:"System",createdDate:"N/A",status:this.getStatusBadge("pending"),originalApproval:null};const t=this.getPolicyId(e),i=this.getApprovalStatus(e);return{incidentId:t,policyName:e.ExtractedData?.PolicyName||t,type:"subpolicy"===e.ExtractedData?.type?"Subpolicy":"Policy",scope:e.ExtractedData?.Scope||"No Scope",createdBy:e.ExtractedData?.CreatedByName||"System",createdDate:this.formatDate(e.ExtractedData?.CreatedByDate||e.created_at),status:this.getStatusBadge(i),originalApproval:e}},getApprovalStatus(e){return e?"Approved"===e.dbStatus||!0===e.ApprovedNot||"Approved"===e.ExtractedData?.Status?"approved":"Rejected"===e.dbStatus||!1===e.ApprovedNot||"Rejected"===e.ExtractedData?.Status?"rejected":"pending":"pending"},getStatusBadge(e){const t={pending:'<span class="status-badge status-pending">Pending</span>',approved:'<span class="status-badge status-approved">Approved</span>',rejected:'<span class="status-badge status-rejected">Rejected</span>'};return t[e]||t.pending},toggleSection(e){this.expandedSections[e.toLowerCase()]=!this.expandedSections[e.toLowerCase()]},handleTaskClick(e){const t=e.originalApproval;if(!t)return;const i=this.getPolicyId(t),a=t.ExtractedData?.PolicyName||i,s=this.getApprovalStatus(t),o=this.shouldShowReviewHistory(t,s);o?this.showReviewHistory(i,a,s):this.openApprovalDetails(t)},shouldShowReviewHistory(e,t){const i=e.ReviewerId===this.currentUserId,a=e.UserId===this.currentUserId,s="pending"===t;return!i&&a&&s},getPolicyStatusClass(e){const t=this.getApprovalStatus(e);switch(t){case"approved":return"status-approved";case"rejected":return"status-rejected";case"pending":default:return"status-pending"}},generateCollapsibleSections(e){if(!e||!Array.isArray(e))return[];const t=[],i=[{key:"pending",label:"Pending"},{key:"approved",label:"Approved"},{key:"rejected",label:"Rejected"}];return i.forEach(({key:i,label:a})=>{const s=e.filter(e=>"pending"===i?null===e.ApprovedNot:"approved"===i?!0===e.ApprovedNot:"rejected"===i?!1===e.ApprovedNot:void 0).map(this.transformApprovalToTask),o=this.collapsiblePagination[i].pageSize,l=this.collapsiblePagination[i].currentPage,n=Math.max(1,Math.ceil(s.length/o)),r=s.slice((l-1)*o,l*o);s.length>0&&t.push({name:a,statusClass:i,tasks:r,pagination:{currentPage:l,totalPages:n,pageSize:o,totalCount:s.length,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>{this.collapsiblePagination[i].pageSize=e,this.collapsiblePagination[i].currentPage=1},onPageChange:e=>{this.collapsiblePagination[i].currentPage=e}}})}),t},handleRejectedPolicyAction(e){console.log("Handle rejected policy action clicked:",e);const t=e.originalPolicy;console.log("Original policy data:",t),t?this.openRejectedItem(t):(console.error("No original policy found in row:",e),ya.error("Error: Could not find policy data to edit","Data Error"),this.sendPushNotification({title:"Policy Data Error",message:"Could not find policy data to edit",category:"policy",priority:"high",user_id:this.currentUserId||"default_user"}))}},computed:{policyApprovals(){return this.approvals},allTasks(){const e=this.myTasks||[],t=this.reviewerTasks||[];return[...e,...t]},pendingApprovalsCount(){return this.allTasks.filter(e=>null===e.ApprovedNot).length},approvedApprovalsCount(){return this.allTasks.filter(e=>!0===e.ApprovedNot).length},rejectedApprovalsCount(){return this.allTasks.filter(e=>!1===e.ApprovedNot).length},myTasksCount(){return this.myTasks?this.myTasks.length:0},reviewerTasksCount(){return this.reviewerTasks?this.reviewerTasks.length:0},sortedPolicies(){return[...this.approvals].sort((e,t)=>{const i=new Date(e.ExtractedData?.CreatedByDate||0),a=new Date(t.ExtractedData?.CreatedByDate||0);return a-i})},myTasksCollapsibleSections(){return this.myTasks&&Array.isArray(this.myTasks)?this.generateCollapsibleSections(this.myTasks):[]},reviewerTasksCollapsibleSections(){return this.reviewerTasks&&Array.isArray(this.reviewerTasks)?this.generateCollapsibleSections(this.reviewerTasks):[]},collapsibleTableSections(){return this.generateCollapsibleSections(this.approvals)},policyTypeOptions(){return Object.keys(this.policyCategoriesMap)},filteredPolicyCategories(){return e=>e&&this.policyCategoriesMap[e]?Object.keys(this.policyCategoriesMap[e].categories):[]},filteredPolicySubCategories(){return(e,t)=>e&&t&&this.policyCategoriesMap[e]&&this.policyCategoriesMap[e].categories[t]?this.policyCategoriesMap[e].categories[t].subCategories:[]},hasUnreviewedSubpolicies(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData||!this.selectedApproval.ExtractedData.subpolicies)return!0;const e=this.selectedApproval.ExtractedData.subpolicies;return e.some(e=>null===e.approval?.approved||void 0===e.approval?.approved)},hasRejectedSubpolicies(){return this.rejectedSubpolicies&&this.rejectedSubpolicies.length>0},hasChanges(){if(!this.editingSubpolicy)return!1;const e=this.editingSubpolicy.Description!==this.editingSubpolicy.originalDescription,t=this.editingSubpolicy.Control!==this.editingSubpolicy.originalControl;return e||t},rejectedSubpoliciesInPolicy(){return this.editingPolicy&&this.editingPolicy.ExtractedData&&this.editingPolicy.ExtractedData.subpolicies?this.editingPolicy.ExtractedData.subpolicies.filter(e=>!1===e.approval?.approved):[]},isComplianceApproval(){return"compliance"===this.selectedApproval?.ExtractedData?.type},isUserViewingReviewHistory(){if(!this.selectedApproval)return!1;const e=this.getApprovalStatus(this.selectedApproval);return this.shouldShowReviewHistory(this.selectedApproval,e)},approvalStatus(){return this.selectedApproval&&this.selectedApproval.ExtractedData?this.isComplianceApproval?this.selectedApproval.ExtractedData.compliance_approval||{approved:null,remarks:""}:this.selectedApproval.ExtractedData.policy_approval||{approved:null,remarks:""}:null},allSubpoliciesApproved(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData||!this.selectedApproval.ExtractedData.subpolicies||0===this.selectedApproval.ExtractedData.subpolicies.length)return!1;const e=this.selectedApproval.ExtractedData.subpolicies;return e.every(e=>!0===e.approval?.approved)},filteredSubpolicies(){return this.selectedPolicyForSubpolicies&&this.selectedPolicyForSubpolicies.ExtractedData&&this.selectedPolicyForSubpolicies.ExtractedData.subpolicies?this.isReviewer?this.selectedPolicyForSubpolicies.ExtractedData.subpolicies:this.selectedPolicyForSubpolicies.ExtractedData.subpolicies.filter(e=>"Rejected"===e.Status||e.approval&&!1===e.approval.approved):[]},rejectedTableData(){return this.rejectedPolicies.map(e=>{const t=this.getPolicyId(e);let i="POLICY";e.is_compliance?i="COMPLIANCE":"subpolicy"===e.type&&(i="SUBPOLICY");let a="No Description";a=e.is_compliance?e.ExtractedData?.ComplianceItemDescription||"No Description":e.ExtractedData?.PolicyName||e.description||e.ExtractedData?.Scope||`Policy ${t}`;let s="No rejection reason provided";return e.rejectionReason&&"No rejection reason provided"!==e.rejectionReason?s=e.rejectionReason:e.ExtractedData?.rejection_reason?s=e.ExtractedData.rejection_reason:e.ExtractedData?.policy_approval?.remarks?s=e.ExtractedData.policy_approval.remarks:e.ExtractedData?.cascading_rejection&&(s=`Cascading rejection due to ${e.ExtractedData.rejected_subpolicy_name||"subpolicy"} rejection`),{id:t,policyId:t,type:i,description:a,rejectionReason:s,createdDate:this.formatDate(e.ExtractedData?.CreatedByDate||e.createdDate),originalPolicy:e}})}}};const _r=(0,le.A)(Pr,[["render",vn],["__scopeId","data-v-4615ed02"]]);var Ar=_r,Sr=i(2351),Tr=i(9254);let xr={permissions:null,userRole:null,isLoaded:!1,isLoading:!1,lastFetch:null,error:null};const Fr=3e5,Vr={async init(){if(console.log("[POLICY_RBAC] Initializing RBAC system..."),xr.isLoaded&&xr.lastFetch&&Date.now()-xr.lastFetch<Fr)return console.log("[POLICY_RBAC] Using cached permissions"),xr;if(xr.isLoading)return console.log("[POLICY_RBAC] Already loading, waiting..."),await this.waitForLoad();xr.isLoading=!0,xr.error=null;try{if(!Tr.G4.isLoggedIn())throw new Error("User not logged in");const[e,t]=await Promise.all([this.fetchUserPermissions(),this.fetchUserRole()]);return xr.permissions=e,xr.userRole=t,xr.isLoaded=!0,xr.lastFetch=Date.now(),console.log("[POLICY_RBAC] RBAC initialized successfully:",xr),xr}catch(e){throw console.error("[POLICY_RBAC] Failed to initialize RBAC:",e),xr.error=e.message,e}finally{xr.isLoading=!1}},async waitForLoad(){return new Promise(e=>{const t=()=>{xr.isLoading?setTimeout(t,100):e(xr)};t()})},async fetchUserPermissions(){try{try{const e=await He.A.get("/api/user-permissions/",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("[POLICY_RBAC] Permissions fetched:",e.data),e.data}catch(e){console.warn("[POLICY_RBAC] Specific permissions endpoint failed, trying fallback:",e);const t=await He.A.get("/api/debug-permissions/",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("[POLICY_RBAC] Permissions fetched from fallback:",t.data),t.data}}catch(t){return console.error("[POLICY_RBAC] All permission endpoints failed:",t),{permissions:["policy.view","policy.list","policy.view_all"],message:"Default permissions applied due to endpoint failure"}}},async fetchUserRole(){try{try{const e=await He.A.get("http://localhost:8000/api/user-role/",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("[POLICY_RBAC] Role fetched:",e.data),e.data}catch(e){console.warn("[POLICY_RBAC] Specific role endpoint failed, trying fallback:",e);const t=await He.A.get("/api/debug-user-permissions/",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`,"Content-Type":"application/json"}});return console.log("[POLICY_RBAC] Role fetched from fallback:",t.data),{role:t.data.role||"User",is_superuser:t.data.is_superuser||!1}}}catch(t){return console.error("[POLICY_RBAC] All role endpoints failed:",t),{role:"User",is_superuser:!1,message:"Default role applied due to endpoint failure"}}},hasPermission(e){try{const t="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;if(t&&(!xr.isLoaded||!xr.permissions))return console.warn(`[POLICY_RBAC] Dev mode: Granting permission ${e} automatically`),!0;if(("policy.view"===e||"policy.list"===e||"policy.view_all"===e)&&(!xr.isLoaded||!xr.permissions))return console.warn(`[POLICY_RBAC] Granting view permission ${e} as fallback`),!0;if(!xr.isLoaded||!xr.permissions)return console.warn("[POLICY_RBAC] RBAC not loaded, denying permission:",e),!1;const i=xr.permissions.permissions?.includes(e)||!1;return console.log(`[POLICY_RBAC] Permission check: ${e} = ${i}`),i}catch(t){return console.error(`[POLICY_RBAC] Error checking permission ${e}:`,t),"policy.view"===e||"policy.list"===e||"policy.view_all"===e}},hasAnyPermission(e){return e.some(e=>this.hasPermission(e))},hasAllPermissions(e){return e.every(e=>this.hasPermission(e))},getUserRole(){return xr.userRole},getUserPermissions(){return xr.permissions},isAdmin(){return"admin"===xr.userRole?.role||!0===xr.userRole?.is_superuser},canViewPolicies(){return this.hasAnyPermission(["policy.view","policy.view_all","policy.list"])},canCreatePolicies(){return this.hasPermission("policy.create")},canEditPolicies(){return this.hasPermission("policy.edit")},canDeletePolicies(){return this.hasPermission("policy.delete")},canApprovePolicies(){return this.hasPermission("policy.approve")},canViewFrameworks(){return this.hasAnyPermission(["policy.view_framework","policy.view"])},canCreateFrameworks(){return this.hasPermission("policy.create_framework")},canUploadFrameworks(){return this.hasPermission("policy.upload_framework")},canViewAnalytics(){return this.hasPermission("policy.analytics")},canViewKPIs(){return this.hasPermission("policy.kpi")},canViewDashboard(){return this.hasPermission("policy.dashboard")},canExportData(){return this.hasPermission("policy.export")},canManageVersions(){return this.hasPermission("policy.versioning")},canTailorPolicies(){return this.hasPermission("policy.tailoring")},canManageApprovalWorkflow(){return this.hasPermission("policy.approval_workflow")},getPolicyComponentAccess(){try{if(!xr.isLoaded){const e="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname;return e?(console.warn("[POLICY_RBAC] RBAC not loaded, but in development mode. Granting all permissions."),{canViewAllPolicies:!0,canCreatePolicy:!0,canEditPolicy:!0,canDeletePolicy:!0,canApprovePolicy:!0,canViewFrameworks:!0,canCreateFramework:!0,canUploadFramework:!0,canViewAnalytics:!0,canViewKPIs:!0,canViewDashboard:!0,canExportData:!0,canManageVersions:!0,canTailorPolicies:!0,canManageApprovalWorkflow:!0,isAdmin:!0}):(console.warn("[POLICY_RBAC] RBAC not loaded, providing minimal access"),{canViewAllPolicies:!0,canCreatePolicy:!1,canEditPolicy:!1,canDeletePolicy:!1,canApprovePolicy:!1,canViewFrameworks:!0,canCreateFramework:!1,canUploadFramework:!1,canViewAnalytics:!1,canViewKPIs:!1,canViewDashboard:!1,canExportData:!1,canManageVersions:!1,canTailorPolicies:!1,canManageApprovalWorkflow:!1,isAdmin:!1})}return{canViewAllPolicies:this.canViewPolicies(),canCreatePolicy:this.canCreatePolicies(),canEditPolicy:this.canEditPolicies(),canDeletePolicy:this.canDeletePolicies(),canApprovePolicy:this.canApprovePolicies(),canViewFrameworks:this.canViewFrameworks(),canCreateFramework:this.canCreateFrameworks(),canUploadFramework:this.canUploadFrameworks(),canViewAnalytics:this.canViewAnalytics(),canViewKPIs:this.canViewKPIs(),canViewDashboard:this.canViewDashboard(),canExportData:this.canExportData(),canManageVersions:this.canManageVersions(),canTailorPolicies:this.canTailorPolicies(),canManageApprovalWorkflow:this.canManageApprovalWorkflow(),isAdmin:this.isAdmin()}}catch(e){return console.error("[POLICY_RBAC] Error getting component access:",e),{canViewAllPolicies:!0,canCreatePolicy:!1,canEditPolicy:!1,canDeletePolicy:!1,canApprovePolicy:!1,canViewFrameworks:!0,canCreateFramework:!1,canUploadFramework:!1,canViewAnalytics:!1,canViewKPIs:!1,canViewDashboard:!1,canExportData:!1,canManageVersions:!1,canTailorPolicies:!1,canManageApprovalWorkflow:!1,isAdmin:!1}}},canAccessRoute(e){const t={AllPolicies:["policy.view","policy.list"],CreatePolicy:["policy.create"],EditPolicy:["policy.edit"],PolicyApprover:["policy.approve"],PolicyDashboard:["policy.dashboard"],UploadFramework:["policy.upload_framework"],FrameworkExplorer:["policy.view_framework"],FrameworkPolicies:["policy.view_framework"],KPIDashboard:["policy.kpi"],PerformancePage:["policy.analytics"],StatusChangeRequests:["policy.approval_workflow"],TT:["policy.tailoring"],VV:["policy.versioning"]},i=t[e];return i?this.hasAnyPermission(i):(console.warn(`[POLICY_RBAC] No permissions defined for route: ${e}`),!0)},getButtonPermissions(){return{canShowCreateButton:this.canCreatePolicies(),canShowEditButton:this.canEditPolicies(),canShowDeleteButton:this.canDeletePolicies(),canShowApproveButton:this.canApprovePolicies(),canShowExportButton:this.canExportData(),canShowUploadButton:this.canUploadFrameworks(),canShowVersioningButton:this.canManageVersions(),canShowTailoringButton:this.canTailorPolicies(),canShowAnalyticsButton:this.canViewAnalytics(),canShowKPIButton:this.canViewKPIs(),canShowDashboardButton:this.canViewDashboard()}},showPolicyAccessDenied(e="access",t=null){const i={access:"access the policy module",view:"view policies",create:"create policies",edit:"edit policies",delete:"delete policies",approve:"approve policies",framework:"access frameworks",upload:"upload frameworks",analytics:"view policy analytics",kpi:"view policy KPIs",dashboard:"access policy dashboard",export:"export policy data",versioning:"manage policy versions",tailoring:"tailor policies",approval_workflow:"manage approval workflows"},a=i[e]||e,s=xr.userRole?.role||"Not assigned",o=`You don't have permission to ${a}. \n    \nYour current role: ${s}\n\nPlease contact your administrator to request the necessary permissions for policy management.`;console.log("[POLICY_RBAC] Showing access denied popup:",{operation:e,userRole:s}),Sr.O.accessDenied(o,"Policy Access Denied",t||this.defaultContactAdmin)},showViewPolicyDenied(e=null){this.showPolicyAccessDenied("view",e)},showCreatePolicyDenied(e=null){this.showPolicyAccessDenied("create",e)},showEditPolicyDenied(e=null){this.showPolicyAccessDenied("edit",e)},showDeletePolicyDenied(e=null){this.showPolicyAccessDenied("delete",e)},showApprovePolicyDenied(e=null){this.showPolicyAccessDenied("approve",e)},showFrameworkAccessDenied(e=null){this.showPolicyAccessDenied("framework",e)},showUploadFrameworkDenied(e=null){this.showPolicyAccessDenied("upload",e)},showAnalyticsDenied(e=null){this.showPolicyAccessDenied("analytics",e)},showKPIDenied(e=null){this.showPolicyAccessDenied("kpi",e)},showDashboardDenied(e=null){this.showPolicyAccessDenied("dashboard",e)},showExportDenied(e=null){this.showPolicyAccessDenied("export",e)},showVersioningDenied(e=null){this.showPolicyAccessDenied("versioning",e)},showTailoringDenied(e=null){this.showPolicyAccessDenied("tailoring",e)},showApprovalWorkflowDenied(e=null){this.showPolicyAccessDenied("approval_workflow",e)},defaultContactAdmin(){console.log("[POLICY_RBAC] Contact admin requested"),Sr.O.info("Please contact your system administrator to request access to policy management features.","Contact Administrator")},checkAccessAndExecute(e,t,i="access"){return("function"===typeof e?e():e)?(t&&t(),!0):(this.showPolicyAccessDenied(i),!1)},clearCache(){console.log("[POLICY_RBAC] Clearing RBAC cache"),xr={permissions:null,userRole:null,isLoaded:!1,isLoading:!1,lastFetch:null,error:null}},getState(){return{...xr}},isLoaded(){return xr.isLoaded},isLoading(){return xr.isLoading},getError(){return xr.error}};const Ur=()=>{const e=(0,ie.KR)(!0),t=(0,ie.KR)(null),i=(0,ie.KR)(null),a=(0,s.EW)(()=>i.value?.canViewAllPolicies||!1),o=(0,s.EW)(()=>i.value?.canCreatePolicy||!1),l=(0,s.EW)(()=>i.value?.canEditPolicy||!1),n=(0,s.EW)(()=>i.value?.canDeletePolicy||!1),r=(0,s.EW)(()=>i.value?.canApprovePolicy||!1),c=(0,s.EW)(()=>i.value?.canViewFrameworks||!1),d=(0,s.EW)(()=>i.value?.canCreateFramework||!1),u=(0,s.EW)(()=>i.value?.canUploadFramework||!1),p=(0,s.EW)(()=>i.value?.canViewAnalytics||!1),m=(0,s.EW)(()=>i.value?.canViewKPIs||!1),v=(0,s.EW)(()=>i.value?.canViewDashboard||!1),k=(0,s.EW)(()=>i.value?.canExportData||!1),h=(0,s.EW)(()=>i.value?.canManageVersions||!1),g=(0,s.EW)(()=>i.value?.canTailorPolicies||!1),y=(0,s.EW)(()=>i.value?.canManageApprovalWorkflow||!1),f=(0,s.EW)(()=>i.value?.isAdmin||!1),b=(0,s.EW)(()=>Vr.getUserRole()?.role||"Not assigned"),C=async()=>{try{e.value=!0,t.value=null,await Vr.init(),i.value=Vr.getPolicyComponentAccess(),console.log("[POLICY_RBAC_COMPOSABLE] RBAC initialized:",i.value)}catch(a){console.error("[POLICY_RBAC_COMPOSABLE] Failed to initialize RBAC:",a),t.value=a.message,i.value={canViewAllPolicies:!1,canCreatePolicy:!1,canEditPolicy:!1,canDeletePolicy:!1,canApprovePolicy:!1,canViewFrameworks:!1,canCreateFramework:!1,canUploadFramework:!1,canViewAnalytics:!1,canViewKPIs:!1,canViewDashboard:!1,canExportData:!1,canManageVersions:!1,canTailorPolicies:!1,canManageApprovalWorkflow:!1,isAdmin:!1}}finally{e.value=!1}},L=(e,t,i="access")=>Vr.checkAccessAndExecute(e,t,i),w=(e,t,i=null)=>{Vr.canAccessRoute(e)?i?i():t&&t.push({name:e}):Vr.showPolicyAccessDenied("access")},E=(e="access")=>{Vr.showPolicyAccessDenied(e)},R=(e,t="access")=>{console.error("[POLICY_RBAC_COMPOSABLE] Unauthorized access:",e),403===e.response?.status&&Vr.showPolicyAccessDenied(t)};return(0,s.sV)(()=>{C()}),{rbacLoading:e,rbacError:t,rbacState:i,canViewPolicies:a,canCreatePolicies:o,canEditPolicies:l,canDeletePolicies:n,canApprovePolicies:r,canViewFrameworks:c,canCreateFrameworks:d,canUploadFrameworks:u,canViewAnalytics:p,canViewKPIs:m,canViewDashboard:v,canExportData:k,canManageVersions:h,canTailorPolicies:g,canManageApprovalWorkflow:y,isAdmin:f,userRole:b,initializeRBAC:C,checkAndExecute:L,navigateWithPermissionCheck:w,showAccessDenied:E,handleUnauthorizedAccess:R}};const Nr={class:"policy-tabs-container single-container"},Mr={key:0,class:"loading-overlay"},Xr={key:1,class:"access-denied-container"},$r={class:"access-denied-content"},Or={class:"access-info"},jr={class:"access-actions"},Br={key:0,class:"loading-overlay"},Wr={key:1,class:"error-message"},qr={key:2,class:"pill-tabs-bar"},Qr={key:0,class:"pill-dot"},Kr={key:0,class:"pill-dot"},Jr={key:0,class:"pill-dot"},zr={key:3,class:"breadcrumbs"},Hr=["onClick"],Gr={style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center","max-width":"260px",margin:"0 auto 8px auto"}},Yr={class:"card-grid",style:{"margin-top":"8px"}},Zr=["onClick"],ec={class:"card-header"},tc={class:"card-icon"},ic={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},ac=["onClick"],sc={class:"card-content"},oc={class:"card-title"},lc={class:"card-category"},nc={class:"card-desc"},rc={class:"framework-select-container"},cc={class:"framework-select-wrapper"},dc={class:"view-toggle"},uc={key:0,class:"loading-message"},pc={key:1,class:"card-grid"},mc={class:"card-header"},vc={class:"card-icon"},kc={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},hc=["onClick"],gc={class:"card-content"},yc={class:"card-title"},fc={class:"card-category"},bc={class:"card-count"},Cc={key:0},Lc={key:1},wc={key:2,class:"loading-versions"},Ec={key:3},Rc={class:"card-desc"},Ic={key:2,class:"table-view"},Dc={class:"table-version-tags"},Pc={class:"framework-select-container"},_c={class:"framework-select-wrapper"},Ac={class:"view-toggle"},Sc={key:0,class:"loading-message"},Tc={key:1,class:"card-grid"},xc={class:"card-header"},Fc={class:"card-icon"},Vc={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Uc=["onClick"],Nc={class:"card-content"},Mc={class:"card-title"},Xc={class:"card-category"},$c={class:"card-desc"},Oc={key:2,class:"table-view"},jc={class:"card-grid"},Bc=["onClick"],Wc={class:"card-header"},qc={class:"card-icon"},Qc={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},Kc=["onClick"],Jc={class:"card-content"},zc={class:"card-title"},Hc={class:"card-category"},Gc={class:"card-count"},Yc={class:"policies-count"},Zc={key:0,class:"card-version-info"},ed={class:"card-desc"},td={class:"card-grid"},id=["onClick"],ad={class:"card-header"},sd={class:"card-icon"},od={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},ld=["onClick"],nd={class:"card-content"},rd={class:"card-title"},cd={class:"card-category"},dd={class:"card-count"},ud={class:"card-desc"},pd={class:"card-grid"},md=["onClick"],vd={class:"card-header"},kd={class:"card-icon"},hd={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},gd=["onClick"],yd={class:"card-content"},fd={class:"card-title"},bd={class:"card-category"},Cd={class:"card-count"},Ld={class:"policies-count"},wd={key:0,class:"card-version-info"},Ed={class:"card-desc"},Rd={class:"card-grid"},Id={class:"card-header"},Dd={class:"card-icon"},Pd={style:{display:"flex","justify-content":"space-between","align-items":"center",width:"100%"}},_d=["onClick"],Ad={class:"card-content"},Sd={class:"card-title"},Td={class:"card-category"},xd={class:"card-desc"},Fd={class:"modal-headerr"},Vd={class:"modal-contentt"},Ud={class:"modal-section"},Nd={key:0,class:"modal-section"},Md={class:"version-info-container"},Xd={class:"version-info-item"},$d={class:"version-info-value"},Od={class:"version-info-item"},jd={class:"version-info-value"},Bd={class:"version-info-item"},Wd={class:"version-info-value"},qd={class:"version-info-item"},Qd={class:"version-info-value"},Kd={key:1,class:"modal-section"},Jd={class:"version-list"},zd={class:"version-name"},Hd={key:2,class:"modal-section"},Gd={class:"subpolicy-list"},Yd="http://localhost:8000/api";var Zd={__name:"AllPolicies",setup(e){const{canViewPolicies:t,userRole:i,rbacLoading:o,rbacError:l,initializeRBAC:n,showAccessDenied:r}=Ur(),c=(0,ie.KR)("framework"),u=(0,ie.KR)(null),p=(0,ie.KR)(null),m=(0,ie.KR)(null),v=(0,ie.KR)(null),k=(0,ie.KR)(""),h=(0,ie.KR)("card"),g=(0,ie.KR)("card"),y=(0,ie.KR)(""),f=(0,ie.KR)(""),b=(0,ie.KR)(!1),C=(0,ie.KR)(null),L=(0,ie.KR)(!1),w=(0,ie.KR)(!1),E=(0,ie.KR)(null),R=(0,ie.KR)({lastFetched:null,data:null,frameworkFilter:null}),I=(0,ie.KR)(!1),D=(0,ie.KR)([]),P=(0,ie.KR)([]),_=(0,ie.KR)([]),A=(0,ie.KR)({lastFetched:null,data:null,frameworkFilter:null}),S=async()=>{L.value=!0,E.value=null;try{const e=await He.A.get(`${Yd}/all-policies/frameworks/`);D.value=e.data,L.value=!1}catch(e){console.error("Error fetching frameworks:",e),E.value="Failed to fetch frameworks",L.value=!1}},T=async e=>{L.value=!0,E.value=null;try{console.log(`Fetching framework versions for framework ID: ${e}`);const t=await He.A.get(`${Yd}/all-policies/frameworks/${e}/versions/`);console.log("Framework versions response:",t.data),u.value.versions||(u.value.versions=[]),u.value.versions=t.data,L.value=!1}catch(t){console.error("Error fetching framework versions:",t),t.response?(console.error("Response status:",t.response.status),console.error("Response data:",t.response.data),E.value=`Failed to fetch framework versions: ${t.response.data.error||"Server error"}`):t.request?(console.error("No response received:",t.request),E.value="Failed to fetch framework versions: No response from server"):(console.error("Error details:",t.message),E.value=`Failed to fetch framework versions: ${t.message}`),u.value&&(u.value.versions=[]),L.value=!1}},x=async e=>{L.value=!0,E.value=null;try{const t=await He.A.get(`${Yd}/all-policies/framework-versions/${e}/policies/`);p.value&&(p.value.policies=t.data),L.value=!1}catch(t){console.error("Error fetching framework version policies:",t),E.value="Failed to fetch policies",L.value=!1}},F=async()=>{w.value=!0,E.value=null;const e=y.value,t=Date.now(),i=A.value.lastFetched?t-A.value.lastFetched:null,a=A.value.data&&i&&i<6e4&&A.value.frameworkFilter===e;if(a)return console.log("Using cached policies data"),P.value=A.value.data,void(w.value=!1);console.log("Cache invalid, fetching fresh policy data");let s=`${Yd}/all-policies/policies/`;e&&(s+=`?framework_id=${e}`);try{console.log("Fetching all policies...");const i=await He.A.get(s),a=i.data;P.value=a.map(e=>({...e,version_count:e.version_count}));const o=a.length>0&&(void 0!==a[0].version_count||a[0].versions&&Array.isArray(a[0].versions));if(o){console.log("Backend already provides version info, using it directly");const i=a.map(e=>({...e,version_count:e.version_count||(e.versions?e.versions.length:0)}));return P.value=i,A.value={lastFetched:t,data:i,frameworkFilter:e},void(w.value=!1)}console.log("Fetching version info for policies in parallel");const l=a.map(e=>He.A.get(`${Yd}/all-policies/policies/${e.id}/versions/`).then(t=>t.data&&Array.isArray(t.data)?{...e,versions:t.data,version_count:t.data.length}:e).catch(t=>(console.error(`Error fetching versions for policy ${e.id}:`,t),e))),n=await Promise.all(l);P.value=n,A.value={lastFetched:t,data:n,frameworkFilter:e},console.log(`Loaded ${n.length} policies with complete version data`)}catch(o){console.error("Error fetching policies:",o),E.value="Failed to fetch policies"}finally{w.value=!1}},V=async e=>{L.value=!0,E.value=null;try{console.log(`Fetching policy versions for policy ID: ${e}`);const t=await He.A.get(`${Yd}/all-policies/policies/${e}/versions/`);console.log("Policy versions response:",t.data),m.value.versions||(m.value.versions=[]),m.value.versions=t.data,m.value&&t.data.length>0&&(m.value.version_count=t.data.length),L.value=!1}catch(t){console.error("Error fetching policy versions:",t),t.response?(console.error("Response status:",t.response.status),console.error("Response data:",t.response.data),E.value=`Failed to fetch policy versions: ${t.response.data.error||"Server error"}`):t.request?(console.error("No response received:",t.request),E.value="Failed to fetch policy versions: No response from server"):(console.error("Error details:",t.message),E.value=`Failed to fetch policy versions: ${t.message}`),m.value&&(m.value.versions=[]),L.value=!1}},U=async()=>{I.value=!0,E.value=null;const e=f.value,t=Date.now(),i=R.value.lastFetched?t-R.value.lastFetched:null,a=R.value.data&&i&&i<6e4&&R.value.frameworkFilter===e;if(a)return console.log("Using cached subpolicies data"),_.value=R.value.data,void(I.value=!1);console.log("Cache invalid, fetching fresh subpolicies data");let s=`${Yd}/all-policies/subpolicies/`;e&&(s+=`?framework_id=${e}`);try{console.log(`Fetching subpolicies from: ${s}`);const i=await He.A.get(s);console.log(`Received ${i.data.length} subpolicies`),i.data.length>0&&console.log("Sample subpolicy:",i.data[0]);const a=i.data;_.value=a,R.value={lastFetched:t,data:a,frameworkFilter:e},console.log(`Successfully loaded ${a.length} subpolicies`)}catch(o){console.error("Error fetching subpolicies:",o),o.response?(console.error("Response status:",o.response.status),console.error("Response data:",o.response.data),E.value=`Failed to fetch subpolicies: ${o.response.data.error||"Server error"}`):o.request?(console.error("No response received:",o.request),E.value="Failed to fetch subpolicies: No response from server"):(console.error("Error details:",o.message),E.value=`Failed to fetch subpolicies: ${o.message}`),_.value=[]}finally{I.value=!1}},N=async e=>{L.value=!0,E.value=null;try{console.log(`Fetching subpolicies for policy version ID: ${e}`);const t=await He.A.get(`${Yd}/all-policies/policy-versions/${e}/subpolicies/`);console.log("Subpolicies response:",t.data),v.value.subpolicies||(v.value.subpolicies=[]),v.value.subpolicies=t.data,L.value=!1}catch(t){console.error("Error fetching policy version subpolicies:",t),t.response?(console.error("Response status:",t.response.status),console.error("Response data:",t.response.data),E.value=`Failed to fetch subpolicies: ${t.response.data.error||"Server error"}`):t.request?(console.error("No response received:",t.request),E.value="Failed to fetch subpolicies: No response from server"):(console.error("Error details:",t.message),E.value=`Failed to fetch subpolicies: ${t.message}`),v.value&&(v.value.subpolicies=[]),L.value=!1}},M=e=>{u.value=e,p.value=null,m.value=null,v.value=null,e&&e.id&&(k.value=e.id.toString()),T(e.id)},X=e=>{p.value=e,m.value=null,v.value=null,x(e.id)},$=e=>{m.value=e,v.value=null,V(e.id)},O=e=>{v.value=e,N(e.id)},j=()=>{E.value=null,"policies"===c.value?(console.log("Switching to Policies tab, fetching all policies..."),F()):"subpolicies"===c.value?(console.log("Switching to Subpolicies tab, fetching all subpolicies..."),U()):"framework"===c.value&&console.log("Switching to Frameworks tab")},B=()=>{F()},W=()=>{U()},q=async()=>{try{if(!k.value)return u.value=null,p.value=null,m.value=null,void(v.value=null);const e=String(k.value);console.log(`Selecting framework ID: ${e}`);const t=D.value.find(t=>String(t.id)===e);t?(console.log(`Found framework: ${t.name}`),await(0,s.dY)(),u.value={...t},p.value=null,m.value=null,v.value=null,T(t.id)):console.error(`No framework found with ID: ${e}`)}catch(e){console.error("Error in framework selection:",e),E.value="Error selecting framework"}},Q=async e=>{L.value=!0,E.value=null;try{if(console.log("Showing details for item:",e),e&&e.id)if(e.category){console.log("Detected framework, fetching all versions for framework:",e.id);try{const t=await He.A.get(`${Yd}/all-policies/framework-versions/${e.id}/`);t.data&&Array.isArray(t.data)?(console.log("Fetched complete framework versions:",t.data.length),e.versions=t.data,K(e.id,{versions:t.data,version_count:t.data.length})):console.log("No framework versions returned")}catch(t){console.error("Error fetching framework versions:",t);try{console.log("Trying fallback endpoint for framework versions");const t=await He.A.get(`${Yd}/all-policies/frameworks/${e.id}/versions/`);e.versions=t.data,K(e.id,{versions:t.data,version_count:t.data.length})}catch(i){console.error("Error in fallback endpoint:",i),e.versions||(e.versions=[])}}}else if(e.previous_version_id||e.parent_policy_id){if(e.previous_version_id&&!e.subpolicies){console.log("Detected policy version, fetching subpolicies:",e.id);try{const t=await He.A.get(`${Yd}/all-policies/policy-versions/${e.id}/subpolicies/`);e.subpolicies=t.data}catch(t){console.error("Error fetching subpolicies:",t),e.subpolicies=[]}}else if(v.value){console.log("Detected subpolicy click, checking for complete details:",e.id);try{if(!e.full_details_loaded){console.log("Fetching complete subpolicy details");const t=await He.A.get(`${Yd}/all-policies/subpolicies/${e.id}/`);Object.assign(e,t.data),e.full_details_loaded=!0}}catch(t){console.error("Error fetching subpolicy details:",t)}}}else{console.log("Detected policy, fetching complete versions for policy:",e.id);try{const t=await He.A.get(`${Yd}/all-policies/policies/${e.id}/versions/`);if(t.data&&Array.isArray(t.data)){const i=t.data.length;console.log(`Fetched ${i} policy versions`),e.versions=t.data,e.version_count=i,K(e.id,{versions:t.data,version_count:i})}}catch(t){console.error("Error fetching policy versions:",t),e.versions||(e.versions=[])}}C.value=e,b.value=!0}catch(t){console.error("Error in showDetails:",t),E.value="Failed to load complete details"}finally{L.value=!1}},K=(e,t)=>{const i=P.value.findIndex(t=>t.id===e);-1!==i&&(P.value[i]={...P.value[i],...t}),m.value&&m.value.id===e&&(m.value={...m.value,...t})},J=()=>{b.value=!1,C.value=null},z=e=>{switch(e){case 0:u.value=null,p.value=null,m.value=null,v.value=null,k.value="",c.value="framework";break;case 1:p.value=null,m.value=null,v.value=null;break;case 2:m.value=null,v.value=null;break;case 3:v.value=null;break;default:u.value=null,p.value=null,m.value=null,v.value=null,k.value="",c.value="framework";break}},H=e=>{if(!e)return"";const t=e.toLowerCase();return t.includes("inactive")?"inactive":t.includes("active")?"active":t.includes("pending")?"pending":""},G=e=>{if(!e)return"N/A";try{const t=new Date(e);return t.toLocaleDateString()}catch(t){return e}},Y=e=>{switch((e||"").toLowerCase()){case"governance":return"fas fa-shield-alt";case"access control":return"fas fa-user-shield";case"asset management":return"fas fa-boxes";case"cryptography":return"fas fa-key";case"data management":return"fas fa-database";case"device management":return"fas fa-mobile-alt";case"risk management":return"fas fa-exclamation-triangle";case"supplier management":return"fas fa-handshake";case"business continuity":return"fas fa-business-time";case"privacy":return"fas fa-user-secret";case"system protection":return"fas fa-shield-virus";case"incident response":return"fas fa-ambulance"}},Z=(0,s.EW)(()=>{if(!D.value||0===D.value.length)return[];if(!k.value)return D.value;const e=String(k.value),t=D.value.filter(t=>String(t.id)===e);return console.log(`Framework filtering: looking for ID ${e}, found ${t.length} matches`),t.length>0?t:D.value}),ee=(0,s.EW)(()=>P.value),te=(0,s.EW)(()=>_.value),ae=(0,s.EW)(()=>{const e=[];return u.value&&e.push({id:"fw-"+u.value.id,name:u.value.name}),p.value&&e.push({id:"fwv-"+p.value.id,name:p.value.name}),m.value&&e.push({id:"policy-"+m.value.id,name:m.value.name}),v.value&&e.push({id:"policyv-"+v.value.id,name:v.value.name}),e}),se=()=>{A.value.data||(console.log("Preloading policies data in the background..."),setTimeout(()=>{F()},1e3)),R.value.data||(console.log("Preloading subpolicies data in the background..."),setTimeout(()=>{U()},2e3))};return(0,s.sV)(async()=>{try{await n(),l.value&&console.warn("[AllPolicies] RBAC initialization had errors, but proceeding with available permissions"),t.value?(S(),"policies"===c.value?F():"subpolicies"===c.value?U():se()):console.log("[AllPolicies] User does not have permission to view policies")}catch(E){console.error("[AllPolicies] Error during component initialization:",E),t.value||console.warn("[AllPolicies] Forcing view access as fallback due to RBAC error")}}),(0,s.wB)(c,j),(0,s.wB)(y,B),(0,s.wB)(f,W),(e,l)=>((0,s.uX)(),(0,s.CE)("div",Nr,[(0,ie.R1)(o)?((0,s.uX)(),(0,s.CE)("div",Mr,l[11]||(l[11]=[(0,s.Lk)("div",{class:"loading-spinner"},[(0,s.Lk)("i",{class:"fas fa-shield-alt fa-spin"}),(0,s.Lk)("span",null,"Checking access permissions...")],-1)]))):(0,ie.R1)(t)||(0,ie.R1)(o)?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[L.value?((0,s.uX)(),(0,s.CE)("div",Br,l[18]||(l[18]=[(0,s.Lk)("div",{class:"loading-spinner"},[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"}),(0,s.Lk)("span",null,"Loading...")],-1)]))):(0,s.Q3)("",!0),E.value?((0,s.uX)(),(0,s.CE)("div",Wr,[l[19]||(l[19]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(E.value),1)])):(0,s.Q3)("",!0),u.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",qr,[(0,s.Lk)("button",{class:(0,d.C4)(["pill-tab",{active:"framework"===c.value}]),onClick:l[2]||(l[2]=e=>c.value="framework")},["framework"===c.value?((0,s.uX)(),(0,s.CE)("span",Qr)):(0,s.Q3)("",!0),l[20]||(l[20]=(0,s.eW)(" Compliance Frameworks "))],2),(0,s.Lk)("button",{class:(0,d.C4)(["pill-tab",{active:"policies"===c.value}]),onClick:l[3]||(l[3]=e=>c.value="policies")},["policies"===c.value?((0,s.uX)(),(0,s.CE)("span",Kr)):(0,s.Q3)("",!0),l[21]||(l[21]=(0,s.eW)(" Policies "))],2),(0,s.Lk)("button",{class:(0,d.C4)(["pill-tab",{active:"subpolicies"===c.value}]),onClick:l[4]||(l[4]=e=>c.value="subpolicies")},["subpolicies"===c.value?((0,s.uX)(),(0,s.CE)("span",Jr)):(0,s.Q3)("",!0),l[22]||(l[22]=(0,s.eW)(" Subpolicies "))],2)])),ae.value.length?((0,s.uX)(),(0,s.CE)("div",zr,[(0,s.bF)(a.F,{name:"breadcrumb"},{default:(0,s.k6)(()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ae.value,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:e.id,class:"breadcrumb-chip"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",{class:"breadcrumb-close",onClick:(0,a.D$)(e=>z(t),["stop"])},"×",8,Hr)]))),128))]),_:1})])):(0,s.Q3)("",!0),u.value?u.value&&!p.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:5},[l[38]||(l[38]=(0,s.Lk)("div",{class:"section-header"},"Versions",-1)),(0,s.Lk)("div",jc,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(u.value.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:t=>X(e)},[(0,s.Lk)("div",Wc,[(0,s.Lk)("div",qc,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",Qc,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[36]||(l[36]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,Kc)])]),(0,s.Lk)("div",Jc,[(0,s.Lk)("div",zc,(0,d.v_)(e.name),1),(0,s.Lk)("div",Hc,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",Gc,[(0,s.Lk)("span",Yc,[l[37]||(l[37]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.eW)(" Policies: "+(0,d.v_)(e.policy_count||0),1)])]),e.previous_version_id?((0,s.uX)(),(0,s.CE)("div",Zc,[(0,s.Lk)("span",null,"Previous version: "+(0,d.v_)(e.previous_version_name),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",ed,(0,d.v_)(e.description),1)])],8,Bc))),128))])],64)):u.value&&p.value&&!m.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:6},[l[40]||(l[40]=(0,s.Lk)("div",{class:"section-header"},"Policies",-1)),(0,s.Lk)("div",td,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p.value.policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:t=>$(e)},[(0,s.Lk)("div",ad,[(0,s.Lk)("div",sd,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",od,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[39]||(l[39]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,ld)])]),(0,s.Lk)("div",nd,[(0,s.Lk)("div",rd,(0,d.v_)(e.name),1),(0,s.Lk)("div",cd,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",dd,"Versions: "+(0,d.v_)(e.version_count||(e.versions?e.versions.length:0)),1),(0,s.Lk)("div",ud,(0,d.v_)(e.description),1)])],8,id))),128))])],64)):u.value&&p.value&&m.value&&!v.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:7},[l[43]||(l[43]=(0,s.Lk)("div",{class:"section-header"},"Policy Versions",-1)),(0,s.Lk)("div",pd,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.value.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:t=>O(e)},[(0,s.Lk)("div",vd,[(0,s.Lk)("div",kd,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",hd,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[41]||(l[41]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,gd)])]),(0,s.Lk)("div",yd,[(0,s.Lk)("div",fd,(0,d.v_)(e.name),1),(0,s.Lk)("div",bd,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",Cd,[(0,s.Lk)("span",Ld,[l[42]||(l[42]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.eW)(" Subpolicies: "+(0,d.v_)(e.subpolicy_count||0),1)])]),e.previous_version_id?((0,s.uX)(),(0,s.CE)("div",wd,[(0,s.Lk)("span",null,"Previous version: "+(0,d.v_)(e.previous_version_name),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",Ed,(0,d.v_)(e.description),1)])],8,md))),128))])],64)):u.value&&p.value&&m.value&&v.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:8},[l[45]||(l[45]=(0,s.Lk)("div",{class:"section-header"},"Subpolicies",-1)),(0,s.Lk)("div",Rd,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value.subpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card"},[(0,s.Lk)("div",Id,[(0,s.Lk)("div",Dd,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",Pd,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[44]||(l[44]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,_d)])]),(0,s.Lk)("div",Ad,[(0,s.Lk)("div",Sd,(0,d.v_)(e.name),1),(0,s.Lk)("div",Td,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",xd,(0,d.v_)(e.description),1)])]))),128))])],64)):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)(s.FK,{key:4},["framework"===c.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[l[25]||(l[25]=(0,s.Lk)("div",{class:"framework-page-desc"},null,-1)),(0,s.Lk)("div",Gr,[(0,s.bF)(xa.A,{modelValue:k.value,"onUpdate:modelValue":l[5]||(l[5]=e=>k.value=e),config:{label:"Framework",options:D.value.map(e=>({label:e.name,value:e.id}))},showSearchBar:!0,onChange:q},null,8,["modelValue","config"]),l[23]||(l[23]=(0,s.Lk)("div",{class:"dropdown-helper-text"},"Select a framework to view its policies and subpolicies.",-1))]),l[26]||(l[26]=(0,s.Lk)("div",{class:"section-header",style:{"margin-bottom":"8px"}},"Frameworks",-1)),(0,s.Lk)("div",Yr,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Z.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card",onClick:t=>M(e)},[(0,s.Lk)("div",ec,[(0,s.Lk)("div",tc,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",ic,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[24]||(l[24]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,ac)])]),(0,s.Lk)("div",sc,[(0,s.Lk)("div",oc,(0,d.v_)(e.name),1),(0,s.Lk)("div",lc,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",nc,(0,d.v_)(e.description),1)])],8,Zr))),128))])],64)):"policies"===c.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",rc,[(0,s.Lk)("div",cc,[(0,s.bF)(xa.A,{modelValue:y.value,"onUpdate:modelValue":l[6]||(l[6]=e=>y.value=e),config:{label:"Framework",options:D.value.map(e=>({label:e.name,value:e.id}))},showSearchBar:!0},null,8,["modelValue","config"])]),(0,s.Lk)("div",dc,[(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-btn",{active:"table"===h.value}]),onClick:l[7]||(l[7]=e=>h.value="card"===h.value?"table":"card")},l[27]||(l[27]=[(0,s.Lk)("i",{class:"fas fa-table"},null,-1)]),2)])]),w.value&&!P.value.length?((0,s.uX)(),(0,s.CE)("div",uc,l[28]||(l[28]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.eW)(" Loading policies... ")]))):(0,s.Q3)("",!0),"card"===h.value?((0,s.uX)(),(0,s.CE)("div",pc,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ee.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card"},[(0,s.Lk)("div",mc,[(0,s.Lk)("div",vc,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",kc,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[29]||(l[29]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,hc)])]),(0,s.Lk)("div",gc,[(0,s.Lk)("div",yc,(0,d.v_)(e.name),1),(0,s.Lk)("div",fc,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",bc,[void 0!==e.version_count?((0,s.uX)(),(0,s.CE)("span",Cc," Versions: "+(0,d.v_)(e.version_count),1)):e.versions?((0,s.uX)(),(0,s.CE)("span",Lc," Versions: "+(0,d.v_)(e.versions.length),1)):w.value?((0,s.uX)(),(0,s.CE)("span",wc,l[30]||(l[30]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin fa-sm"},null,-1)]))):((0,s.uX)(),(0,s.CE)("span",Ec," Versions: 0 "))]),(0,s.Lk)("div",Rc,(0,d.v_)(e.description),1)])]))),128))])):((0,s.uX)(),(0,s.CE)("table",Ic,[l[31]||(l[31]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Name"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Versions"),(0,s.Lk)("th",null,"Description")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ee.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,d.v_)(e.name),1),(0,s.Lk)("td",null,(0,d.v_)(e.category),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["table-status-badge",H(e.status)])},(0,d.v_)(e.status),3)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",Dc,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.versions,e=>((0,s.uX)(),(0,s.CE)("span",{key:e.id,class:"table-version-tag"},(0,d.v_)(e.name),1))),128))])]),(0,s.Lk)("td",null,(0,d.v_)(e.description),1)]))),128))])]))],64)):"subpolicies"===c.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",Pc,[(0,s.Lk)("div",_c,[(0,s.bF)(xa.A,{modelValue:f.value,"onUpdate:modelValue":l[8]||(l[8]=e=>f.value=e),config:{label:"Framework",options:D.value.map(e=>({label:e.name,value:e.id}))},showSearchBar:!0},null,8,["modelValue","config"])]),(0,s.Lk)("div",Ac,[(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-btn",{active:"table"===g.value}]),onClick:l[9]||(l[9]=e=>g.value="card"===g.value?"table":"card")},l[32]||(l[32]=[(0,s.Lk)("i",{class:"fas fa-table"},null,-1)]),2)])]),I.value&&!_.value.length?((0,s.uX)(),(0,s.CE)("div",Sc,l[33]||(l[33]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.eW)(" Loading subpolicies... ")]))):(0,s.Q3)("",!0),"card"===g.value?((0,s.uX)(),(0,s.CE)("div",Tc,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(te.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"card"},[(0,s.Lk)("div",xc,[(0,s.Lk)("div",Fc,[(0,s.Lk)("i",{class:(0,d.C4)(Y(e.category))},null,2)]),(0,s.Lk)("div",Vc,[(0,s.Lk)("div",{class:(0,d.C4)(["card-status",H(e.status)]),style:{"margin-right":"auto"}},(0,d.v_)(e.status),3),(0,s.Lk)("button",{class:"pdf-icon-btn",onClick:(0,a.D$)(t=>Q(e),["stop"])},l[34]||(l[34]=[(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)]),8,Uc)])]),(0,s.Lk)("div",Nc,[(0,s.Lk)("div",Mc,(0,d.v_)(e.name),1),(0,s.Lk)("div",Xc,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",$c,(0,d.v_)(e.description),1)])]))),128))])):((0,s.uX)(),(0,s.CE)("table",Oc,[l[35]||(l[35]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Name"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Description")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(te.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,d.v_)(e.name),1),(0,s.Lk)("td",null,(0,d.v_)(e.category),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["table-status-badge",H(e.status)])},(0,d.v_)(e.status),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.description),1)]))),128))])]))],64)):(0,s.Q3)("",!0)],64)),b.value?((0,s.uX)(),(0,s.CE)("div",{key:9,class:"details-modal-overlay",onClick:J},[(0,s.Lk)("div",{class:"details-modal",onClick:l[10]||(l[10]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Fd,[(0,s.Lk)("h2",null,(0,d.v_)(C.value.name),1),(0,s.Lk)("button",{class:"modal-close",onClick:J},"×")]),(0,s.Lk)("div",Vd,[(0,s.Lk)("div",Ud,[l[46]||(l[46]=(0,s.Lk)("h3",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(C.value.description),1)]),C.value.previous_version_id?((0,s.uX)(),(0,s.CE)("div",Nd,[l[51]||(l[51]=(0,s.Lk)("h3",null,"Version Information",-1)),(0,s.Lk)("div",Md,[(0,s.Lk)("div",Xd,[l[47]||(l[47]=(0,s.Lk)("span",{class:"version-info-label"},"Version Number:",-1)),(0,s.Lk)("span",$d,(0,d.v_)(C.value.version),1)]),(0,s.Lk)("div",Od,[l[48]||(l[48]=(0,s.Lk)("span",{class:"version-info-label"},"Previous Version:",-1)),(0,s.Lk)("span",jd,(0,d.v_)(C.value.previous_version_name),1)]),(0,s.Lk)("div",Bd,[l[49]||(l[49]=(0,s.Lk)("span",{class:"version-info-label"},"Created By:",-1)),(0,s.Lk)("span",Wd,(0,d.v_)(C.value.created_by),1)]),(0,s.Lk)("div",qd,[l[50]||(l[50]=(0,s.Lk)("span",{class:"version-info-label"},"Created Date:",-1)),(0,s.Lk)("span",Qd,(0,d.v_)(G(C.value.created_date)),1)])])])):(0,s.Q3)("",!0),C.value.versions?((0,s.uX)(),(0,s.CE)("div",Kd,[(0,s.Lk)("div",Jd,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(C.value.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"version-item"},[(0,s.Lk)("span",zd,(0,d.v_)(e.name),1),(0,s.Lk)("span",{class:(0,d.C4)(["version-status",H(e.status)])},(0,d.v_)(e.status),3)]))),128))])])):(0,s.Q3)("",!0),C.value.subpolicies?((0,s.uX)(),(0,s.CE)("div",Hd,[(0,s.Lk)("div",Gd,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(C.value.subpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"subpolicy-item"},[(0,s.Lk)("h4",null,(0,d.v_)(e.name),1),(0,s.Lk)("p",null,(0,d.v_)(e.description),1),(0,s.Lk)("span",{class:(0,d.C4)(["subpolicy-status",H(e.status)])},(0,d.v_)(e.status),3)]))),128))])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0)],64)):((0,s.uX)(),(0,s.CE)("div",Xr,[(0,s.Lk)("div",$r,[l[15]||(l[15]=(0,s.Lk)("i",{class:"fas fa-shield-alt access-denied-icon"},null,-1)),l[16]||(l[16]=(0,s.Lk)("h2",null,"Access Denied",-1)),l[17]||(l[17]=(0,s.Lk)("p",null,"You don't have permission to view policies. Please contact your administrator.",-1)),(0,s.Lk)("div",Or,[l[12]||(l[12]=(0,s.Lk)("strong",null,"Your Role:",-1)),(0,s.eW)(" "+(0,d.v_)((0,ie.R1)(i)),1)]),(0,s.Lk)("div",jr,[(0,s.Lk)("button",{onClick:l[0]||(l[0]=e=>(0,ie.R1)(r)("view")),class:"btn btn-warning"},l[13]||(l[13]=[(0,s.Lk)("i",{class:"fas fa-envelope"},null,-1),(0,s.eW)(" Contact Admin ")])),(0,s.Lk)("button",{onClick:l[1]||(l[1]=t=>e.$router.push("/")),class:"btn btn-secondary"},l[14]||(l[14]=[(0,s.Lk)("i",{class:"fas fa-home"},null,-1),(0,s.eW)(" Go to Dashboard ")]))])])]))]))}};const eu=(0,le.A)(Zd,[["__scopeId","data-v-5a3fe93b"]]);var tu=eu;const iu={class:"active-policies-container"},au={class:"header-container"},su={class:"framework-dropdown"},ou={class:"policies-table-container"},lu={class:"policies-table"},nu=["onClick"],ru=["onClick"],cu={key:0},du={colspan:"7"},uu={class:"policy-document expanded"},pu={class:"policy-document-section"},mu={class:"policy-document-section"},vu={class:"policy-document-section"},ku=["onClick"],hu={key:0},gu={colspan:"7"},yu={class:"policy-document expanded"},fu={class:"policy-document-section"},bu={class:"policy-document-section"},Cu={class:"policy-document-section"},Lu={key:0,class:"empty-state"};function wu(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",iu,[(0,s.Lk)("div",au,[t[2]||(t[2]=(0,s.Lk)("h2",null,"Active Policies",-1)),(0,s.Lk)("div",su,[(0,s.bo)((0,s.Lk)("select",{id:"framework","onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedFramework=e)},t[1]||(t[1]=[(0,s.Fv)('<option value="" disabled selected hidden>Select Framework</option><option value="ISO 27001">ISO 27001</option><option value="NIST">NIST</option><option value="SOC 2">SOC 2</option><option value="GDPR">GDPR</option>',5)]),512),[[a.u1,o.selectedFramework]])])]),(0,s.Lk)("div",ou,[(0,s.Lk)("table",lu,[t[11]||(t[11]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Policy Name"),(0,s.Lk)("th",null,"Version"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Framework"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Created By"),(0,s.Lk)("th",null,"Created On")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredPolicies,e=>((0,s.uX)(),(0,s.CE)(s.FK,{key:e.id},[(0,s.Lk)("tr",null,[(0,s.Lk)("td",{onClick:t=>o.togglePolicyDocument(e.id),class:"policy-name"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),e.subpolicies&&e.subpolicies.length?((0,s.uX)(),(0,s.CE)("i",{key:0,class:(0,d.C4)(["fas fa-chevron-right expand-icon",{rotated:o.expandedPolicies.includes(e.id)}]),onClick:(0,a.D$)(t=>o.toggleSubpolicies(e.id),["stop"])},null,10,ru)):(0,s.Q3)("",!0)],8,nu),(0,s.Lk)("td",null,(0,d.v_)(e.version),1),(0,s.Lk)("td",null,(0,d.v_)(e.category),1),(0,s.Lk)("td",null,(0,d.v_)(e.framework),1),t[3]||(t[3]=(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:"status-badge active"}," Active ")],-1)),(0,s.Lk)("td",null,(0,d.v_)(e.createdBy),1),(0,s.Lk)("td",null,(0,d.v_)(e.createdOn),1)]),o.expandedDocuments.includes(e.id)?((0,s.uX)(),(0,s.CE)("tr",cu,[(0,s.Lk)("td",du,[(0,s.Lk)("div",uu,[(0,s.Lk)("div",pu,[t[4]||(t[4]=(0,s.Lk)("h4",null,"Project Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.description||"This policy establishes guidelines and requirements for "+e.name.toLowerCase()+" within the organization to ensure compliance with relevant regulations and standards."),1)]),(0,s.Lk)("div",mu,[t[5]||(t[5]=(0,s.Lk)("h4",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.scope||"This policy applies to all employees, contractors, and third-party entities that interact with organizational assets and systems."),1)]),(0,s.Lk)("div",vu,[t[6]||(t[6]=(0,s.Lk)("h4",null,"Objectives",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.objectives||"To define roles and responsibilities, establish controls, and provide guidance for maintaining compliance with "+e.framework+" standards."),1)])])])])):(0,s.Q3)("",!0),e.subpolicies&&e.subpolicies.length?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(o.getActiveSubpolicies(e),(i,a)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:`${e.id}-sub-${a}`},[(0,s.Lk)("tr",{class:(0,d.C4)(["subpolicy-row",{expanded:o.expandedPolicies.includes(e.id)}])},[(0,s.Lk)("td",{onClick:t=>o.toggleSubpolicyDocument(`${e.id}-sub-${a}`)},(0,d.v_)(i.name),9,ku),(0,s.Lk)("td",null,(0,d.v_)(i.version||e.version),1),(0,s.Lk)("td",null,(0,d.v_)(i.category||e.category),1),(0,s.Lk)("td",null,(0,d.v_)(i.framework||e.framework),1),t[7]||(t[7]=(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:"status-badge active"}," Active ")],-1)),(0,s.Lk)("td",null,(0,d.v_)(i.createdBy||e.createdBy),1),(0,s.Lk)("td",null,(0,d.v_)(i.createdOn||e.createdOn),1)],2),o.expandedDocuments.includes(`${e.id}-sub-${a}`)?((0,s.uX)(),(0,s.CE)("tr",hu,[(0,s.Lk)("td",gu,[(0,s.Lk)("div",yu,[(0,s.Lk)("div",fu,[t[8]||(t[8]=(0,s.Lk)("h4",null,"Project Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(i.description||"This is a sub-policy of "+e.name+" that focuses specifically on "+i.name.toLowerCase()+"."),1)]),(0,s.Lk)("div",bu,[t[9]||(t[9]=(0,s.Lk)("h4",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(i.scope||"This sub-policy applies to all aspects of "+i.name.toLowerCase()+" within the organization."),1)]),(0,s.Lk)("div",Cu,[t[10]||(t[10]=(0,s.Lk)("h4",null,"Objectives",-1)),(0,s.Lk)("p",null,(0,d.v_)(i.objectives||"To ensure consistent implementation and management of "+i.name+" controls in alignment with "+e.framework+"."),1)])])])])):(0,s.Q3)("",!0)],64))),128)):(0,s.Q3)("",!0)],64))),128))])]),0===o.filteredPolicies.length?((0,s.uX)(),(0,s.CE)("div",Lu,t[12]||(t[12]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1),(0,s.Lk)("p",null,"No active policies found for the selected framework",-1)]))):(0,s.Q3)("",!0)])])}var Eu={name:"ActivePolicies",setup(){const e=(0,ie.KR)(""),t=(0,ie.KR)([]),i=(0,ie.KR)([]),a=[{id:"POL-001",name:"Information Security Policy",version:"1.2",category:"Security",framework:"ISO 27001",status:"Approved",createdBy:"John Smith",createdOn:"2023-10-15",description:"This policy outlines the organization's approach to information security management.",scope:"All information assets owned, controlled, or processed by the organization.",objectives:"To establish a framework for protecting the confidentiality, integrity, and availability of information.",subpolicies:[{name:"Data Classification Policy",version:"1.1",status:"Approved",description:"Guidelines for classifying organizational data based on sensitivity and criticality."},{name:"Access Control Policy",version:"1.0",status:"Approved",description:"Rules and guidelines for controlling access to information systems and data."}]},{id:"POL-002",name:"Data Protection Policy",version:"2.0",category:"Privacy",framework:"GDPR",status:"Under Review",createdBy:"Sarah Johnson",createdOn:"2023-11-03",subpolicies:[{name:"Data Subject Rights Procedure",version:"1.2",status:"Under Review",description:"Procedures for handling data subject access requests and other rights."}]},{id:"POL-005",name:"Risk Management Policy",version:"1.3",category:"Governance",framework:"SOC 2",status:"Under Review",createdBy:"David Wilson",createdOn:"2023-11-18"},{id:"POL-006",name:"Business Continuity Policy",version:"2.1",category:"Operations",framework:"ISO 27001",status:"Approved",createdBy:"Jennifer Lee",createdOn:"2023-10-30"}],o=e=>"Approved"===e||"Under Review"===e,l=(0,s.EW)(()=>a.filter(t=>{const i=""===e.value||t.framework===e.value;return o(t.status)&&i})),n=e=>e.subpolicies?e.subpolicies.filter(e=>o(e.status)):[],r=e=>{t.value.includes(e)?t.value=t.value.filter(t=>t!==e):(t.value.push(e),u({title:"Policy Expanded",message:`Subpolicies for policy ${e} are now visible`,category:"policy",priority:"low",user_id:"default_user"}))},c=e=>{if(i.value.includes(e))i.value=i.value.filter(t=>t!==e);else{i.value.push(e);const t=a.find(t=>t.id===e);t&&u({title:"Policy Document Opened",message:`Details for policy "${t.name}" are now visible`,category:"policy",priority:"low",user_id:"default_user"})}},d=e=>{if(i.value.includes(e))i.value=i.value.filter(t=>t!==e);else{i.value.push(e);const[t,,s]=e.split("-"),o=a.find(e=>e.id===t);o&&o.subpolicies&&o.subpolicies[s]&&u({title:"Subpolicy Document Opened",message:`Details for subpolicy "${o.subpolicies[s].name}" are now visible`,category:"policy",priority:"low",user_id:"default_user"})}},u=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}};return{selectedFramework:e,policies:a,filteredPolicies:l,expandedPolicies:t,expandedDocuments:i,toggleSubpolicies:r,togglePolicyDocument:c,toggleSubpolicyDocument:d,getActiveSubpolicies:n,sendPushNotification:u}}};const Ru=(0,le.A)(Eu,[["render",wu]]);var Iu=Ru;function Du(e,t,i,a,o,l){const n=(0,s.g2)("CreateFramework");return(0,s.uX)(),(0,s.Wv)(n,{sendPushNotification:a.sendPushNotification},null,8,["sendPushNotification"])}const Pu={class:"create-framework-container"},_u={key:0,class:"framework-form-container"},Au={class:"form-row"},Su={class:"form-group"},Tu={class:"input-wrapper"},xu={class:"form-group"},Fu={class:"input-wrapper"},Vu={class:"form-row"},Uu={class:"form-group"},Nu={class:"input-wrapper"},Mu={class:"form-group"},Xu={class:"upload-input-container"},$u={class:"form-row"},Ou={class:"form-group"},ju={class:"input-wrapper"},Bu={class:"form-group"},Wu={class:"input-wrapper"},qu={class:"form-group"},Qu={class:"input-wrapper"},Ku={key:1,class:"extraction-inline-container"},Ju={class:"extraction-content"},zu={class:"extraction-header"},Hu={class:"extraction-stepper"},Gu=["onClick"],Yu={class:"extraction-body"},Zu={key:0},ep=["value"],tp=["value"],ip={key:1},ap={class:"policy-main"},sp=["value"],op=["value"],lp={key:0},np=["value"],rp={key:2},cp=["value"],dp={key:0,class:"subpolicies-group"},up=["value"],pp=["value"],mp={key:2},vp=["value"],kp=["value"],hp=["value"],gp=["value"],yp=["value"],fp=["value"],bp={style:{"text-align":"right","margin-top":"24px"}};function Cp(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Pu,[t[33]||(t[33]=(0,s.Lk)("h2",null,"Create Framework",-1)),o.showExtractionScreens?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",_u,[(0,s.Lk)("form",{class:"form-section",onSubmit:t[7]||(t[7]=(0,a.D$)((...e)=>o.handleFrameworkFormSubmit&&o.handleFrameworkFormSubmit(...e),["prevent"]))},[(0,s.Lk)("div",Au,[(0,s.Lk)("div",Su,[t[11]||(t[11]=(0,s.Lk)("label",null,"Framework ID",-1)),(0,s.Lk)("div",Tu,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o.formData.frameworkId=e),placeholder:"Enter framework id"},null,512),[[a.Jo,o.formData.frameworkId]])])]),(0,s.Lk)("div",xu,[t[12]||(t[12]=(0,s.Lk)("label",null,"Framework Name",-1)),(0,s.Lk)("div",Fu,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>o.formData.frameworkName=e),placeholder:"Enter framework name"},null,512),[[a.Jo,o.formData.frameworkName]])])])]),(0,s.Lk)("div",Vu,[(0,s.Lk)("div",Uu,[t[13]||(t[13]=(0,s.Lk)("label",null,"Version",-1)),(0,s.Lk)("div",Nu,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>o.formData.version=e),placeholder:"Enter version"},null,512),[[a.Jo,o.formData.version]])])]),(0,s.Lk)("div",Mu,[t[15]||(t[15]=(0,s.Lk)("label",null,"Upload Document",-1)),(0,s.Lk)("div",Xu,[(0,s.Lk)("input",{type:"file",id:"framework-doc",class:"file-input",onChange:t[3]||(t[3]=(...e)=>o.handleFileUpload&&o.handleFileUpload(...e))},null,32),t[14]||(t[14]=(0,s.Lk)("label",{for:"framework-doc",class:"upload-label"},[(0,s.Lk)("span",{class:"upload-text"},"Choose File")],-1))])])]),(0,s.Lk)("div",$u,[(0,s.Lk)("div",Ou,[t[16]||(t[16]=(0,s.Lk)("label",null,"Effective Start Date",-1)),(0,s.Lk)("div",ju,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[4]||(t[4]=e=>o.formData.effectiveStartDate=e)},null,512),[[a.Jo,o.formData.effectiveStartDate]])])]),(0,s.Lk)("div",Bu,[t[17]||(t[17]=(0,s.Lk)("label",null,"Effective End Date",-1)),(0,s.Lk)("div",Wu,[(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[5]||(t[5]=e=>o.formData.effectiveEndDate=e)},null,512),[[a.Jo,o.formData.effectiveEndDate]])])])]),(0,s.Lk)("div",qu,[t[18]||(t[18]=(0,s.Lk)("label",null,"Created By",-1)),(0,s.Lk)("div",Qu,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>o.formData.createdBy=e),placeholder:"Enter creator name"},null,512),[[a.Jo,o.formData.createdBy]])])]),t[19]||(t[19]=(0,s.Lk)("button",{class:"create-btn",type:"submit"},"Submit",-1))],32)])),o.showExtractionScreens&&o.extractionSlides.length>0?((0,s.uX)(),(0,s.CE)("div",Ku,[(0,s.Lk)("div",Ju,[(0,s.Lk)("div",zu,[(0,s.Lk)("div",Hu,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.extractionSlides,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:(0,d.C4)(["extraction-step",{active:o.extractionStep===i}]),onClick:e=>o.extractionStep=i,style:(0,d.Tr)({cursor:o.extractionStep!==i?"pointer":"default"})},[(0,s.eW)((0,d.v_)("framework"===e.type?"Framework":"policy"===e.type?`Policy ${void 0!==e.index?e.index+1:""}`:"Authorizer")+" ",1),o.extractionStep===i?((0,s.uX)(),(0,s.CE)("span",{key:0,class:"tab-close",onClick:t[8]||(t[8]=(0,a.D$)(e=>o.showExtractionScreens=!1,["stop"]))}," X ")):(0,s.Q3)("",!0)],14,Gu))),128))])]),(0,s.Lk)("div",Yu,["framework"===o.extractionSlides[o.extractionStep].type?((0,s.uX)(),(0,s.CE)("div",Zu,[t[20]||(t[20]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.title,readonly:""},null,8,ep),t[21]||(t[21]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:o.extractionSlides[o.extractionStep].data.description,readonly:""},null,8,tp)])):"policy"===o.extractionSlides[o.extractionStep].type?((0,s.uX)(),(0,s.CE)("div",ip,[(0,s.Lk)("div",ap,[t[22]||(t[22]=(0,s.Lk)("b",null,"Policy",-1)),t[23]||(t[23]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.title,readonly:""},null,8,sp),t[24]||(t[24]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:o.extractionSlides[o.extractionStep].data.description,readonly:""},null,8,op),o.extractionSlides[o.extractionStep].data.objective?((0,s.uX)(),(0,s.CE)("label",lp,"Objective:")):(0,s.Q3)("",!0),o.extractionSlides[o.extractionStep].data.objective?((0,s.uX)(),(0,s.CE)("textarea",{key:1,value:o.extractionSlides[o.extractionStep].data.objective,readonly:""},null,8,np)):(0,s.Q3)("",!0),o.extractionSlides[o.extractionStep].data.scope?((0,s.uX)(),(0,s.CE)("label",rp,"Scope:")):(0,s.Q3)("",!0),o.extractionSlides[o.extractionStep].data.scope?((0,s.uX)(),(0,s.CE)("textarea",{key:3,value:o.extractionSlides[o.extractionStep].data.scope,readonly:""},null,8,cp)):(0,s.Q3)("",!0)]),o.extractionSlides[o.extractionStep].data.subPolicies&&o.extractionSlides[o.extractionStep].data.subPolicies.length?((0,s.uX)(),(0,s.CE)("div",dp,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.extractionSlides[o.extractionStep].data.subPolicies,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"subpolicy-card extraction-subpolicy"},[(0,s.Lk)("b",null,"Sub Policy "+(0,d.v_)(i+1),1),t[25]||(t[25]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:e.title,readonly:""},null,8,up),t[26]||(t[26]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:e.description,readonly:""},null,8,pp)]))),128))])):(0,s.Q3)("",!0)])):"authorizer"===o.extractionSlides[o.extractionStep].type?((0,s.uX)(),(0,s.CE)("div",mp,[t[27]||(t[27]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.title,readonly:""},null,8,vp),t[28]||(t[28]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.Lk)("textarea",{value:o.extractionSlides[o.extractionStep].data.description,readonly:""},null,8,kp),t[29]||(t[29]=(0,s.Lk)("label",null,"Created By:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.createdBy,readonly:""},null,8,hp),t[30]||(t[30]=(0,s.Lk)("label",null,"Created date:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.createdDate,readonly:""},null,8,gp),t[31]||(t[31]=(0,s.Lk)("label",null,"Authorized By:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.authorizedBy,readonly:""},null,8,yp),t[32]||(t[32]=(0,s.Lk)("label",null,"Assign task for authorization:",-1)),(0,s.Lk)("input",{value:o.extractionSlides[o.extractionStep].data.assignTask,readonly:""},null,8,fp)])):(0,s.Q3)("",!0),(0,s.Lk)("div",bp,[o.extractionStep<o.extractionSlides.length-1?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"create-btn",style:{"min-width":"100px"},onClick:t[9]||(t[9]=e=>o.extractionStep=o.extractionStep+1)}," Next > ")):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"create-btn",style:{"min-width":"100px"},onClick:t[10]||(t[10]=(...e)=>o.handleExtractionComplete&&o.handleExtractionComplete(...e))}," Done "))])])])])):(0,s.Q3)("",!0)])}var Lp=JSON.parse('{"d9":{"title":"Sample Framework","description":"This is a sample framework description."},"R3":[{"title":"Policy 1","description":"Description for Policy 1","objective":"Objective for Policy 1","scope":"Scope for Policy 1","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 2","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 3","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 4","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]},{"title":"Policy 5","description":"Description for Policy 2","objective":"Objective for Policy 2","scope":"Scope for Policy 2","subPolicies":[{"title":"Sub Policy 1","description":"Description for Sub Policy 1"},{"title":"Sub Policy 2","description":"Description for Sub Policy 2"},{"title":"Sub Policy 3","description":"Description for Sub Policy 3"}]}],"Kn":{"title":"Authorization Title","description":"Authorization Description","createdBy":"User Name","createdDate":"2024-06-01","authorizedBy":"Authorizer Name","assignTask":"Task Name"}}'),wp={name:"CreateFramework",props:{sendPushNotification:{type:Function,required:!0}},setup(e){const t=(0,ie.KR)(!1),i=(0,ie.KR)(0),a=(0,ie.KR)([]),s=(0,ie.KR)({frameworkId:"",frameworkName:"",version:"",document:null,effectiveStartDate:"",effectiveEndDate:"",createdBy:""}),o=e=>{s.value.document=e.target.files[0]},l=async()=>{try{if(!s.value.frameworkId||!s.value.frameworkName||!s.value.version)return void await e.sendPushNotification({title:"Framework Creation Failed",message:"Please fill in all required fields (Framework ID, Framework Name, and Version)",category:"framework",priority:"high",user_id:s.value.createdBy||"default_user"});if(!s.value.document)return void await e.sendPushNotification({title:"Framework Creation Failed",message:"Please upload a framework document",category:"framework",priority:"high",user_id:s.value.createdBy||"default_user"});console.log("Processing framework creation...",s.value),await e.sendPushNotification({title:"Framework Created Successfully",message:`Framework "${s.value.frameworkName}" has been created successfully. Document processing initiated.`,category:"framework",priority:"medium",user_id:s.value.createdBy||"default_user"});const o=[];Lp.d9&&o.push({type:"framework",data:Lp.d9}),Lp.R3&&Array.isArray(Lp.R3)&&Lp.R3.forEach((e,t)=>{o.push({type:"policy",data:e,index:t})}),Lp.Kn&&o.push({type:"authorizer",data:Lp.Kn}),a.value=o,t.value=!0,i.value=0}catch(o){console.error("Error creating framework:",o),await e.sendPushNotification({title:"Framework Creation Failed",message:`Failed to create framework: ${o.message||"Unknown error occurred"}`,category:"framework",priority:"high",user_id:s.value.createdBy||"default_user"})}},n=async()=>{try{await e.sendPushNotification({title:"Framework Processing Complete",message:`Framework "${s.value.frameworkName}" has been processed and extracted successfully.`,category:"framework",priority:"medium",user_id:s.value.createdBy||"default_user"}),t.value=!1}catch(i){console.error("Error completing extraction:",i),await e.sendPushNotification({title:"Framework Processing Error",message:`Error completing framework processing: ${i.message||"Unknown error occurred"}`,category:"framework",priority:"high",user_id:s.value.createdBy||"default_user"})}};return{showExtractionScreens:t,extractionStep:i,extractionSlides:a,formData:s,handleFileUpload:o,handleFrameworkFormSubmit:l,handleExtractionComplete:n}}};const Ep=(0,le.A)(wp,[["render",Cp]]);var Rp=Ep,Ip={name:"FrameworkWrapper",components:{CreateFramework:Rp},setup(){const e=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}};return{sendPushNotification:e}}};const Dp=(0,le.A)(Ip,[["render",Du]]);var Pp=Dp;const _p={class:"VV-page-wrapper"},Ap={class:"VV-toggle-group"},Sp={key:0,class:"VV-top-dropdowns"},Tp={key:1,class:"VV-top-dropdowns"},xp={key:2},Fp={class:"VV-container"},Vp={class:"VV-form-group"},Up={class:"VV-form-group"},Np={class:"VV-row"},Mp={class:"VV-form-group VV-half"},Xp={class:"VV-form-group VV-half"},$p={class:"VV-row"},Op={class:"VV-form-group VV-half"},jp={class:"VV-form-group VV-half"},Bp={class:"VV-row"},Wp={class:"VV-form-group VV-half"},qp={class:"VV-form-group VV-half"},Qp={class:"VV-row"},Kp={class:"VV-form-group VV-half"},Jp=["value"],zp={class:"VV-form-group VV-half"},Hp=["value"],Gp={class:"VV-policy-tabs-container"},Yp={class:"VV-policy-tabs-row"},Zp={class:"VV-policy-tabs"},em=["onClick"],tm={key:0,class:"VV-policy-form-container"},im={key:0,class:"TT-excluded-message"},am={class:"VV-row"},sm={class:"VV-form-group VV-half"},om={class:"VV-form-group VV-half"},lm={class:"VV-form-group"},nm={class:"VV-row"},rm={class:"VV-form-group VV-half"},cm={class:"VV-form-group VV-half"},dm={class:"VV-form-group"},um={class:"VV-row"},pm={class:"VV-form-group VV-half"},mm={class:"VV-form-group VV-half"},vm={class:"VV-row"},km={class:"VV-form-group VV-half"},hm=["disabled"],gm=["value"],ym={class:"VV-form-group VV-half"},fm=["disabled"],bm=["value"],Cm={class:"VV-row"},Lm={class:"VV-form-group VV-half"},wm=["disabled"],Em=["value"],Rm={class:"VV-form-group VV-half"},Im={class:"form-row"},Dm={class:"form-group entities-group"},Pm={class:"entities-dropdown"},_m={class:"entity-content"},Am={key:0,class:"loading-text"},Sm={key:1,class:"entity-tag all-tag"},Tm={key:2,class:"placeholder"},xm={key:3,class:"entity-count"},Fm={key:0,class:"entities-options"},Vm={key:0,class:"entities-loading"},Um={key:1,class:"entities-error"},Nm=["onClick"],Mm=["checked","onChange"],Xm={class:"entity-label"},$m={class:"VV-row"},Om={class:"VV-form-group VV-half"},jm={class:"VV-form-group VV-half"},Bm={key:0,class:"VV-row"},Wm={class:"VV-form-group VV-half"},qm=["value"],Qm={class:"VV-form-group VV-half"},Km=["value"],Jm={class:"VV-form-group"},zm={key:0,class:"VV-subpolicy-tabs-container"},Hm={class:"VV-subpolicy-tabs-row"},Gm={class:"VV-subpolicy-tabs"},Ym=["onClick"],Zm={key:0,class:"VV-subpolicy-form-container"},ev={key:0,class:"TT-excluded-message"},tv={key:1},iv={class:"VV-form-group"},av={class:"VV-form-group"},sv={class:"VV-form-group"},ov={class:"VV-form-group"},lv={key:3},nv={key:4,class:"VV-universal-submit-wrapper"},rv={class:"version-type-options"},cv={class:"version-type-option"},dv={class:"version-type-option"},uv={class:"version-modal-actions"},pv={key:6},mv={class:"VV-policy-tabs-container"},vv={class:"VV-policy-tabs-row"},kv={class:"VV-policy-tabs"},hv=["onClick"],gv={key:0,class:"VV-policy-form-container"},yv={class:"VV-row"},fv={class:"VV-form-group VV-half"},bv={class:"VV-form-group VV-half"},Cv={class:"VV-form-group"},Lv={class:"VV-row"},wv={class:"VV-form-group VV-half"},Ev={class:"VV-form-group VV-half"},Rv={class:"VV-form-group"},Iv={class:"VV-row"},Dv={class:"VV-form-group VV-half"},Pv={class:"VV-form-group VV-half"},_v={class:"VV-row"},Av={class:"VV-form-group VV-half"},Sv=["value"],Tv={class:"VV-form-group VV-half"},xv=["disabled"],Fv=["value"],Vv={class:"VV-row"},Uv={class:"VV-form-group VV-half"},Nv=["disabled"],Mv=["value"],Xv={class:"VV-form-group VV-half"},$v={class:"form-row"},Ov={class:"form-group entities-group"},jv={class:"entities-dropdown"},Bv={class:"entity-content"},Wv={key:0,class:"loading-text"},qv={key:1,class:"entity-tag all-tag"},Qv={key:2,class:"placeholder"},Kv={key:3,class:"entity-count"},Jv={key:0,class:"entities-options"},zv={key:0,class:"entities-loading"},Hv={key:1,class:"entities-error"},Gv=["onClick"],Yv=["checked","onChange"],Zv={class:"entity-label"},ek={class:"VV-row"},tk={class:"VV-form-group VV-half"},ik={class:"VV-form-group VV-half"},ak={class:"VV-row"},sk={class:"VV-form-group VV-half"},ok=["value"],lk={class:"VV-form-group VV-half"},nk=["value"],rk={class:"VV-form-group"},ck={key:0,class:"VV-subpolicy-tabs-container"},dk={class:"VV-subpolicy-tabs-row"},uk={class:"VV-subpolicy-tabs"},pk=["onClick"],mk={key:0,class:"VV-subpolicy-form-container"},vk={key:0,class:"TT-excluded-message"},kk={class:"VV-form-group"},hk={class:"VV-form-group"},gk={class:"VV-form-group"},yk={class:"VV-form-group"},fk={key:0,class:"VV-universal-submit-wrapper"};function bk(e,t,i,o,l,n){const r=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)(s.FK,null,[(0,s.Lk)("div",_p,[t[203]||(t[203]=(0,s.Lk)("div",{class:"VV-page-header"},[(0,s.Lk)("h2",null,"Policy Versioning")],-1)),(0,s.Lk)("div",Ap,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-toggle",{"VV-active":"framework"===l.selectedTab}]),onClick:t[0]||(t[0]=e=>n.selectTab("framework"))},"Framework",2),(0,s.Lk)("button",{class:(0,d.C4)(["VV-toggle",{"VV-active":"policy"===l.selectedTab}]),onClick:t[1]||(t[1]=e=>n.selectTab("policy"))},"Policy",2)]),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",Sp,[(0,s.bF)(r,{modelValue:l.selectedFramework,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:e.name})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"340px"}},null,8,["modelValue","config"])])):((0,s.uX)(),(0,s.CE)("div",Tp,[(0,s.bF)(r,{modelValue:l.selectedFramework,"onUpdate:modelValue":t[3]||(t[3]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:e.name})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"]),(0,s.bF)(r,{modelValue:l.selectedPolicy,"onUpdate:modelValue":t[4]||(t[4]=e=>l.selectedPolicy=e),config:{label:"Policy",values:l.policies.map(e=>({value:e.id,label:e.name})),defaultLabel:"Select Policy"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"])])),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",xp,[(0,s.Lk)("div",Fp,[(0,s.Lk)("form",{onSubmit:t[14]||(t[14]=(0,a.D$)((...t)=>e.submitFramework&&e.submitFramework(...t),["prevent"]))},[(0,s.Lk)("div",Vp,[t[82]||(t[82]=(0,s.Lk)("label",{class:"VV-label"},"FRAMEWORK NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[5]||(t[5]=e=>l.frameworkForm.name=e),type:"text",required:"",placeholder:"Enter Framework name"},null,512),[[a.Jo,l.frameworkForm.name]]),t[83]||(t[83]=(0,s.Lk)("small",{class:"VV-desc"},"Enter a descriptive name for your framework",-1))]),(0,s.Lk)("div",Up,[t[84]||(t[84]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[6]||(t[6]=e=>l.frameworkForm.description=e),rows:"3",required:"",placeholder:"Enter framework description"},null,512),[[a.Jo,l.frameworkForm.description]]),t[85]||(t[85]=(0,s.Lk)("small",{class:"VV-desc"},"Describe the purpose, scope, and objectives of this framework",-1))]),(0,s.Lk)("div",Np,[(0,s.Lk)("div",Mp,[t[86]||(t[86]=(0,s.Lk)("label",{class:"VV-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[7]||(t[7]=e=>l.frameworkForm.identifier=e),type:"text",required:"",placeholder:"Enter Identifier"},null,512),[[a.Jo,l.frameworkForm.identifier]]),t[87]||(t[87]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'FW-001' or 'ISO-27001'",-1))]),(0,s.Lk)("div",Xp,[t[88]||(t[88]=(0,s.Lk)("label",{class:"VV-label"},"CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[8]||(t[8]=e=>l.frameworkForm.category=e),type:"text",required:"",placeholder:"Enter category"},null,512),[[a.Jo,l.frameworkForm.category]]),t[89]||(t[89]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., Security, Compliance, Risk Management, etc.",-1))])]),(0,s.Lk)("div",$p,[(0,s.Lk)("div",Op,[t[91]||(t[91]=(0,s.Lk)("label",{class:"VV-label"},"INTERNAL/EXTERNAL *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[9]||(t[9]=e=>l.frameworkForm.internalExternal=e),required:""},t[90]||(t[90]=[(0,s.Lk)("option",{value:"",disabled:""},"Select Type",-1),(0,s.Lk)("option",{value:"Internal"},"Internal",-1),(0,s.Lk)("option",{value:"External"},"External",-1)]),512),[[a.u1,l.frameworkForm.internalExternal]]),t[92]||(t[92]=(0,s.Lk)("small",{class:"VV-desc"},"Select whether this framework is for internal or external use",-1))]),(0,s.Lk)("div",jp,[t[93]||(t[93]=(0,s.Lk)("label",{class:"VV-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"VV-input",type:"file",onChange:t[10]||(t[10]=(...e)=>n.handleFileUpload&&n.handleFileUpload(...e))},null,32),t[94]||(t[94]=(0,s.Lk)("small",{class:"VV-desc"},"Upload a supporting document for this framework (optional)",-1))])]),(0,s.Lk)("div",Bp,[(0,s.Lk)("div",Wp,[t[95]||(t[95]=(0,s.Lk)("label",{class:"VV-label"},"EFFECTIVE START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[11]||(t[11]=e=>l.frameworkForm.startDate=e),type:"date",required:""},null,512),[[a.Jo,l.frameworkForm.startDate]]),t[96]||(t[96]=(0,s.Lk)("small",{class:"VV-desc"},"Date when the framework implementation begins",-1))]),(0,s.Lk)("div",qp,[t[97]||(t[97]=(0,s.Lk)("label",{class:"VV-label"},"EFFECTIVE END DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[12]||(t[12]=e=>l.frameworkForm.endDate=e),type:"date",required:""},null,512),[[a.Jo,l.frameworkForm.endDate]]),t[98]||(t[98]=(0,s.Lk)("small",{class:"VV-desc"},"Date when the framework expires or requires review",-1))])]),(0,s.Lk)("div",Qp,[(0,s.Lk)("div",Kp,[t[99]||(t[99]=(0,s.Lk)("label",{class:"VV-label"},"CREATED BY *",-1)),(0,s.Lk)("input",{class:"VV-input",value:l.loggedInUsername,type:"text",disabled:""},null,8,Jp),t[100]||(t[100]=(0,s.Lk)("small",{class:"VV-desc"},"Automatically set to logged in user",-1))]),(0,s.Lk)("div",zp,[t[102]||(t[102]=(0,s.Lk)("label",{class:"VV-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[13]||(t[13]=e=>l.frameworkForm.reviewer=e),required:""},[t[101]||(t[101]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Hp))),128))],512),[[a.u1,l.frameworkForm.reviewer]]),t[103]||(t[103]=(0,s.Lk)("small",{class:"VV-desc"},"Select who will review this framework",-1))])])],32)]),(0,s.Lk)("div",Gp,[(0,s.Lk)("div",Yp,[(0,s.Lk)("div",Zp,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-policy-tab",{"VV-policy-tab-active":t===l.activePolicyTab,excluded:e.exclude}]),onClick:e=>l.activePolicyTab=t}," Policy "+(0,d.v_)(t+1),11,em))),128)),(0,s.Lk)("button",{class:"VV-add-policy-tab",onClick:t[15]||(t[15]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",tm,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-exclude-policy-btn",{excluded:l.policyTabs[l.activePolicyTab].exclude}]),onClick:t[16]||(t[16]=e=>n.excludePolicyTab(l.activePolicyTab))},(0,d.v_)(l.policyTabs[l.activePolicyTab].exclude?"Include":"Exclude"),3),l.policyTabs[l.activePolicyTab].exclude?((0,s.uX)(),(0,s.CE)("div",im," This policy has been excluded and will not be included in the submission. ")):((0,s.uX)(),(0,s.CE)("form",{onSubmit:t[38]||(t[38]=(0,a.D$)(t=>e.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",am,[(0,s.Lk)("div",sm,[t[104]||(t[104]=(0,s.Lk)("label",{class:"VV-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[17]||(t[17]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].name]]),t[105]||(t[105]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",om,[t[106]||(t[106]=(0,s.Lk)("label",{class:"VV-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[18]||(t[18]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].identifier]]),t[107]||(t[107]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",lm,[t[108]||(t[108]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[19]||(t[19]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].description]]),t[109]||(t[109]=(0,s.Lk)("small",{class:"VV-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",nm,[(0,s.Lk)("div",rm,[t[110]||(t[110]=(0,s.Lk)("label",{class:"VV-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[20]||(t[20]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].scope]]),t[111]||(t[111]=(0,s.Lk)("small",{class:"VV-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",cm,[t[112]||(t[112]=(0,s.Lk)("label",{class:"VV-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[21]||(t[21]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].department]]),t[113]||(t[113]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",dm,[t[114]||(t[114]=(0,s.Lk)("label",{class:"VV-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[22]||(t[22]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].objective]]),t[115]||(t[115]=(0,s.Lk)("small",{class:"VV-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",um,[(0,s.Lk)("div",pm,[t[116]||(t[116]=(0,s.Lk)("label",{class:"VV-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[23]||(t[23]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),t[117]||(t[117]=(0,s.Lk)("small",{class:"VV-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",mm,[t[118]||(t[118]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[24]||(t[24]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].applicability]]),t[119]||(t[119]=(0,s.Lk)("small",{class:"VV-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",vm,[(0,s.Lk)("div",km,[t[121]||(t[121]=(0,s.Lk)("label",{class:"VV-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[25]||(t[25]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:t[26]||(t[26]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),disabled:l.policyTabs[l.activePolicyTab].exclude,required:""},[t[120]||(t[120]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,gm))),128))],40,hm),[[a.u1,l.policyTabs[l.activePolicyTab].type]]),t[122]||(t[122]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., Security Policy, HR Policy",-1))]),(0,s.Lk)("div",ym,[t[124]||(t[124]=(0,s.Lk)("label",{class:"VV-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[27]||(t[27]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:t[28]||(t[28]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type||l.policyTabs[l.activePolicyTab].exclude,required:""},[t[123]||(t[123]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,bm))),128))],40,fm),[[a.u1,l.policyTabs[l.activePolicyTab].category]]),t[125]||(t[125]=(0,s.Lk)("small",{class:"VV-desc"},"Choose a category that best describes this policy's focus area",-1))])]),(0,s.Lk)("div",Cm,[(0,s.Lk)("div",Lm,[t[127]||(t[127]=(0,s.Lk)("label",{class:"VV-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[29]||(t[29]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),onChange:t[30]||(t[30]=e=>n.handlePolicySubCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].category||l.policyTabs[l.activePolicyTab].exclude,required:""},[t[126]||(t[126]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policySubCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Em))),128))],40,wm),[[a.u1,l.policyTabs[l.activePolicyTab].subCategory]]),t[128]||(t[128]=(0,s.Lk)("small",{class:"VV-desc"},"Provide more specific classification",-1))]),(0,s.Lk)("div",Rm,[t[130]||(t[130]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",Im,[(0,s.Lk)("div",Dm,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:t[33]||(t[33]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",Pm,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:t[31]||(t[31]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",_m,[l.loading?((0,s.uX)(),(0,s.CE)("span",Am," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",Sm," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",Tm," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",xm,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),t[129]||(t[129]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",Fm,[l.loading?((0,s.uX)(),(0,s.CE)("div",Vm," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",Um,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:t=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:t=>n.handleEntitySelection(l.activePolicyTab,e.id,t.target.checked),onClick:t[32]||(t[32]=(0,a.D$)(()=>{},["stop"]))},null,40,Mm),(0,s.Lk)("span",Xm,(0,d.v_)(e.label),1)],10,Nm))),128))])):(0,s.Q3)("",!0)])])])]),t[131]||(t[131]=(0,s.Lk)("small",{class:"VV-desc"},"Select the locations/entities this policy applies to",-1))])]),(0,s.Lk)("div",$m,[(0,s.Lk)("div",Om,[t[132]||(t[132]=(0,s.Lk)("label",{class:"VV-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[34]||(t[34]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].startDate]]),t[133]||(t[133]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",jm,[t[134]||(t[134]=(0,s.Lk)("label",{class:"VV-label"},"END DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[35]||(t[35]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date",required:""},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].endDate]]),t[135]||(t[135]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy expires or requires review/renewal",-1))])]),"policy"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",Bm,[(0,s.Lk)("div",Wm,[t[136]||(t[136]=(0,s.Lk)("label",{class:"VV-label"},"CREATED BY *",-1)),(0,s.Lk)("input",{class:"VV-input",value:l.loggedInUsername,type:"text",disabled:""},null,8,qm),t[137]||(t[137]=(0,s.Lk)("small",{class:"VV-desc"},"Automatically set to logged in user",-1))]),(0,s.Lk)("div",Qm,[t[139]||(t[139]=(0,s.Lk)("label",{class:"VV-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[36]||(t[36]=e=>l.policyTabs[l.activePolicyTab].reviewer=e),required:""},[t[138]||(t[138]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,Km))),128))],512),[[a.u1,l.policyTabs[l.activePolicyTab].reviewer]]),t[140]||(t[140]=(0,s.Lk)("small",{class:"VV-desc"},"Select who will review this policy",-1))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Jm,[t[141]||(t[141]=(0,s.Lk)("label",{class:"VV-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"VV-input",type:"file",onChange:t[37]||(t[37]=t=>e.handlePolicyFileUpload(t,l.activePolicyTab))},null,32),t[142]||(t[142]=(0,s.Lk)("small",{class:"VV-desc"},"Upload supporting documentation (optional)",-1))])],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",zm,[(0,s.Lk)("div",Hm,[(0,s.Lk)("div",Gm,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-subpolicy-tab",{"VV-subpolicy-tab-active":t===l.policyTabs[l.activePolicyTab].activeSubPolicyTab,excluded:e.exclude}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=t}," Subpolicy "+(0,d.v_)(t+1),11,Ym))),128)),(0,s.Lk)("button",{class:"VV-add-subpolicy-tab",onClick:t[39]||(t[39]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",Zm,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-exclude-subpolicy-btn",{excluded:l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude}]),onClick:t[40]||(t[40]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},(0,d.v_)(l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?"Include":"Exclude"),3),l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?((0,s.uX)(),(0,s.CE)("div",ev," This subpolicy has been excluded and will not be included in the submission. ")):((0,s.uX)(),(0,s.CE)("form",tv,[(0,s.Lk)("div",iv,[t[143]||(t[143]=(0,s.Lk)("label",{class:"VV-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[41]||(t[41]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),t[144]||(t[144]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",av,[t[145]||(t[145]=(0,s.Lk)("label",{class:"VV-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[42]||(t[42]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),t[146]||(t[146]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",sv,[t[147]||(t[147]=(0,s.Lk)("label",{class:"VV-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[43]||(t[43]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),t[148]||(t[148]=(0,s.Lk)("small",{class:"VV-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",ov,[t[149]||(t[149]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[44]||(t[44]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),t[150]||(t[150]=(0,s.Lk)("small",{class:"VV-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):"framework"!==l.selectedTab||l.selectedFramework?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",lv)),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",nv,[(0,s.Lk)("button",{class:"VV-universal-submit-btn",onClick:t[45]||(t[45]=(0,a.D$)(e=>l.showVersionModal=!0,["prevent"]))},"Submit")])):(0,s.Q3)("",!0),l.showVersionModal?((0,s.uX)(),(0,s.CE)("div",{key:5,class:"version-modal-overlay",onClick:t[51]||(t[51]=e=>l.showVersionModal=!1)},[(0,s.Lk)("div",{class:"version-modal",onClick:t[50]||(t[50]=(0,a.D$)(()=>{},["stop"]))},[t[155]||(t[155]=(0,s.Lk)("h2",null,"Version Type",-1)),(0,s.Lk)("div",rv,[(0,s.Lk)("label",cv,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:"minor","onUpdate:modelValue":t[46]||(t[46]=e=>l.selectedVersionType=e)},null,512),[[a.XL,l.selectedVersionType]]),(0,s.Lk)("span",{class:(0,d.C4)(["radio-custom",{checked:"minor"===l.selectedVersionType}])},null,2),t[151]||(t[151]=(0,s.Lk)("span",{class:"version-type-title"},"Minor Version",-1)),t[152]||(t[152]=(0,s.Lk)("span",{class:"version-type-desc"},[(0,s.eW)("Incremental changes and improvements"),(0,s.Lk)("br"),(0,s.Lk)("span",{class:"version-type-example"},"Example: 1.0 → 1.1")],-1))]),(0,s.Lk)("label",dv,[(0,s.bo)((0,s.Lk)("input",{type:"radio",value:"major","onUpdate:modelValue":t[47]||(t[47]=e=>l.selectedVersionType=e)},null,512),[[a.XL,l.selectedVersionType]]),(0,s.Lk)("span",{class:(0,d.C4)(["radio-custom",{checked:"major"===l.selectedVersionType}])},null,2),t[153]||(t[153]=(0,s.Lk)("span",{class:"version-type-title"},"Major Version",-1)),t[154]||(t[154]=(0,s.Lk)("span",{class:"version-type-desc"},[(0,s.eW)("Significant changes or overhauls"),(0,s.Lk)("br"),(0,s.Lk)("span",{class:"version-type-example"},"Example: 1.5 → 2.0")],-1))])]),(0,s.Lk)("div",uv,[(0,s.Lk)("button",{class:"btn-primary",onClick:t[48]||(t[48]=(0,a.D$)((...e)=>n.confirmVersionType&&n.confirmVersionType(...e),["prevent"]))},"OK"),(0,s.Lk)("button",{class:"btn-secondary",onClick:t[49]||(t[49]=(0,a.D$)(e=>l.showVersionModal=!1,["prevent"]))},"Cancel")])])])):(0,s.Q3)("",!0),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",pv,[(0,s.Lk)("div",mv,[(0,s.Lk)("div",vv,[(0,s.Lk)("div",kv,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-policy-tab",{"VV-policy-tab-active":t===l.activePolicyTab,excluded:e.exclude}]),onClick:e=>l.activePolicyTab=t}," Policy "+(0,d.v_)(t+1),11,hv))),128)),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"VV-add-policy-tab",onClick:t[52]||(t[52]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")):(0,s.Q3)("",!0)])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",gv,["framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"VV-exclude-policy-btn",onClick:t[53]||(t[53]=e=>n.excludePolicyTab(l.activePolicyTab))},"Exclude")):(0,s.Q3)("",!0),((0,s.uX)(),(0,s.CE)("form",{onSubmit:t[74]||(t[74]=(0,a.D$)(t=>e.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",yv,[(0,s.Lk)("div",fv,[t[156]||(t[156]=(0,s.Lk)("label",{class:"VV-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[54]||(t[54]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].name]]),t[157]||(t[157]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",bv,[t[158]||(t[158]=(0,s.Lk)("label",{class:"VV-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[55]||(t[55]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].identifier]]),t[159]||(t[159]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",Cv,[t[160]||(t[160]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[56]||(t[56]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].description]]),t[161]||(t[161]=(0,s.Lk)("small",{class:"VV-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",Lv,[(0,s.Lk)("div",wv,[t[162]||(t[162]=(0,s.Lk)("label",{class:"VV-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[57]||(t[57]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].scope]]),t[163]||(t[163]=(0,s.Lk)("small",{class:"VV-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",Ev,[t[164]||(t[164]=(0,s.Lk)("label",{class:"VV-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[58]||(t[58]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].department]]),t[165]||(t[165]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",Rv,[t[166]||(t[166]=(0,s.Lk)("label",{class:"VV-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[59]||(t[59]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].objective]]),t[167]||(t[167]=(0,s.Lk)("small",{class:"VV-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",Iv,[(0,s.Lk)("div",Dv,[t[168]||(t[168]=(0,s.Lk)("label",{class:"VV-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[60]||(t[60]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),t[169]||(t[169]=(0,s.Lk)("small",{class:"VV-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",Pv,[t[170]||(t[170]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[61]||(t[61]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].applicability]]),t[171]||(t[171]=(0,s.Lk)("small",{class:"VV-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",_v,[(0,s.Lk)("div",Av,[t[173]||(t[173]=(0,s.Lk)("label",{class:"VV-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[62]||(t[62]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:t[63]||(t[63]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),required:""},[t[172]||(t[172]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Sv))),128))],544),[[a.u1,l.policyTabs[l.activePolicyTab].type]]),t[174]||(t[174]=(0,s.Lk)("small",{class:"VV-desc"},"e.g., Security Policy, HR Policy",-1))]),(0,s.Lk)("div",Tv,[t[176]||(t[176]=(0,s.Lk)("label",{class:"VV-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[64]||(t[64]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:t[65]||(t[65]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type,required:""},[t[175]||(t[175]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Fv))),128))],40,xv),[[a.u1,l.policyTabs[l.activePolicyTab].category]]),t[177]||(t[177]=(0,s.Lk)("small",{class:"VV-desc"},"Choose a category that best describes this policy's focus area",-1))])]),(0,s.Lk)("div",Vv,[(0,s.Lk)("div",Uv,[t[179]||(t[179]=(0,s.Lk)("label",{class:"VV-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[66]||(t[66]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),disabled:!l.policyTabs[l.activePolicyTab].category,required:""},[t[178]||(t[178]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policySubCategories,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Mv))),128))],8,Nv),[[a.u1,l.policyTabs[l.activePolicyTab].subCategory]]),t[180]||(t[180]=(0,s.Lk)("small",{class:"VV-desc"},"Provide more specific classification",-1))]),(0,s.Lk)("div",Xv,[t[182]||(t[182]=(0,s.Lk)("label",{class:"VV-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",$v,[(0,s.Lk)("div",Ov,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:t[69]||(t[69]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",jv,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:t[67]||(t[67]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",Bv,[l.loading?((0,s.uX)(),(0,s.CE)("span",Wv," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",qv," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",Qv," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",Kv,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),t[181]||(t[181]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",Jv,[l.loading?((0,s.uX)(),(0,s.CE)("div",zv," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",Hv,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:t=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:t=>n.handleEntitySelection(l.activePolicyTab,e.id,t.target.checked),onClick:t[68]||(t[68]=(0,a.D$)(()=>{},["stop"]))},null,40,Yv),(0,s.Lk)("span",Zv,(0,d.v_)(e.label),1)],10,Gv))),128))])):(0,s.Q3)("",!0)])])])]),t[183]||(t[183]=(0,s.Lk)("small",{class:"VV-desc"},"Select the locations/entities this policy applies to",-1))])]),(0,s.Lk)("div",ek,[(0,s.Lk)("div",tk,[t[184]||(t[184]=(0,s.Lk)("label",{class:"VV-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[70]||(t[70]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].startDate]]),t[185]||(t[185]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",ik,[t[186]||(t[186]=(0,s.Lk)("label",{class:"VV-label"},"END DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[71]||(t[71]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date",required:""},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].endDate]]),t[187]||(t[187]=(0,s.Lk)("small",{class:"VV-desc"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("div",ak,[(0,s.Lk)("div",sk,[t[188]||(t[188]=(0,s.Lk)("label",{class:"VV-label"},"CREATED BY *",-1)),(0,s.Lk)("input",{class:"VV-input",value:l.loggedInUsername,type:"text",disabled:""},null,8,ok),t[189]||(t[189]=(0,s.Lk)("small",{class:"VV-desc"},"Automatically set to logged in user",-1))]),(0,s.Lk)("div",lk,[t[191]||(t[191]=(0,s.Lk)("label",{class:"VV-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"VV-input","onUpdate:modelValue":t[72]||(t[72]=e=>l.policyTabs[l.activePolicyTab].reviewer=e),required:""},[t[190]||(t[190]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,nk))),128))],512),[[a.u1,l.policyTabs[l.activePolicyTab].reviewer]]),t[192]||(t[192]=(0,s.Lk)("small",{class:"VV-desc"},"Select who will review this policy",-1))])]),(0,s.Lk)("div",rk,[t[193]||(t[193]=(0,s.Lk)("label",{class:"VV-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"VV-input",type:"file",onChange:t[73]||(t[73]=t=>e.handlePolicyFileUpload(t,l.activePolicyTab))},null,32),t[194]||(t[194]=(0,s.Lk)("small",{class:"VV-desc"},"Upload supporting documentation (optional)",-1))])],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",ck,[(0,s.Lk)("div",dk,[(0,s.Lk)("div",uk,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["VV-subpolicy-tab",{"VV-subpolicy-tab-active":t===l.policyTabs[l.activePolicyTab].activeSubPolicyTab,excluded:e.exclude}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=t}," Subpolicy "+(0,d.v_)(t+1),11,pk))),128)),(0,s.Lk)("button",{class:"VV-add-subpolicy-tab",onClick:t[75]||(t[75]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",mk,[(0,s.Lk)("button",{class:(0,d.C4)(["VV-exclude-subpolicy-btn",{excluded:l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude}]),onClick:t[76]||(t[76]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},(0,d.v_)(l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?"Include":"Exclude"),3),l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].exclude?((0,s.uX)(),(0,s.CE)("div",vk," This subpolicy has been excluded and will not be included in the submission. ")):(0,s.Q3)("",!0),(0,s.Lk)("form",null,[(0,s.Lk)("div",kk,[t[195]||(t[195]=(0,s.Lk)("label",{class:"VV-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[77]||(t[77]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),t[196]||(t[196]=(0,s.Lk)("small",{class:"VV-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",hk,[t[197]||(t[197]=(0,s.Lk)("label",{class:"VV-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"VV-input","onUpdate:modelValue":t[78]||(t[78]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),t[198]||(t[198]=(0,s.Lk)("small",{class:"VV-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",gk,[t[199]||(t[199]=(0,s.Lk)("label",{class:"VV-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[79]||(t[79]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),t[200]||(t[200]=(0,s.Lk)("small",{class:"VV-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",yk,[t[201]||(t[201]=(0,s.Lk)("label",{class:"VV-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"VV-textarea","onUpdate:modelValue":t[80]||(t[80]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),t[202]||(t[202]=(0,s.Lk)("small",{class:"VV-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",fk,[(0,s.Lk)("button",{class:"VV-universal-submit-btn",onClick:t[81]||(t[81]=(0,a.D$)(e=>l.showVersionModal=!0,["prevent"]))},"Submit")])):(0,s.Q3)("",!0)],64)}var Ck=i(2972);const Lk="http://localhost:8000/api";var wk={name:"VV",components:{CustomDropdown:xa.A},data(){return{selectedTab:"framework",selectedFramework:"",selectedPolicy:"",frameworks:[],policies:[],policyTypes:[],policyCategories:[],policySubCategories:[],policyData:[],users:[],entities:[],loggedInUsername:localStorage.getItem("user_name")||"",frameworkForm:{name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:"",createdByName:localStorage.getItem("user_name")||"",reviewer:""},policyTabs:[],activePolicyTab:0,loading:!1,error:null,showVersionModal:!1,selectedVersionType:"minor"}},watch:{selectedFramework(e){this.handleFrameworkSelection(e)},selectedPolicy(e){"policy"===this.selectedTab&&this.selectedFramework&&e&&this.fetchPolicyDetails(e)},selectedTab(e){"framework"===e?(this.selectedPolicy="",this.fetchFrameworks(),this.selectedFramework&&this.handleFrameworkSelection(this.selectedFramework)):"policy"===e&&(this.selectedPolicy="",this.policyTabs=[],this.fetchFrameworks())}},async created(){try{await Promise.all([this.fetchFrameworks(),this.fetchPolicyData(),this.fetchEntities(),this.fetchUsers()])}catch(e){console.error("Error in component creation:",e),this.error="Failed to initialize component"}},methods:{selectTab(e){this.selectedTab=e},handleFileUpload(e){this.frameworkForm.file=e.target.files[0]},addSubPolicyTab(e){const t=localStorage.getItem("user_name")||"";this.policyTabs[e].subPolicies.push({id:`new-subpolicy-${Date.now()}`,name:"",identifier:"",control:"",description:"",createdByName:t,exclude:!1}),this.policyTabs[e].activeSubPolicyTab=this.policyTabs[e].subPolicies.length-1},addPolicyTab(){const e=`new-policy-${Date.now()}`;console.log("Creating new policy with ID:",e);const t="framework"===this.selectedTab?this.frameworkForm.reviewer:"",i=localStorage.getItem("user_name")||"";this.policyTabs.push({id:e,name:"",identifier:"",description:"",scope:"",department:"",objective:"",coverageRate:"",applicability:"",type:"",category:"",subCategory:"",entities:[],startDate:"",endDate:"",file:null,createdByName:i,reviewer:t,exclude:!1,subPolicies:[{id:`new-subpolicy-${Date.now()}`,name:"",identifier:"",control:"",description:"",createdByName:i,exclude:!1}],activeSubPolicyTab:0}),this.activePolicyTab=this.policyTabs.length-1},async fetchFrameworks(){try{this.loading=!0;const e=await He.A.get(`${Lk}/frameworks/`);console.log("Raw framework response:",e.data),this.frameworks=e.data.map(e=>({id:e.FrameworkId,name:e.FrameworkName,description:e.FrameworkDescription,category:e.Category,internalExternal:e.InternalExternal,startDate:e.StartDate,endDate:e.EndDate,status:e.Status})),console.log("Mapped frameworks:",this.frameworks),0===this.frameworks.length&&Ck.OQ.info("No frameworks found","No Data")}catch(e){console.error("Error fetching frameworks:",e),this.error="Failed to fetch frameworks",Ck.OQ.error("Failed to fetch frameworks","Error")}finally{this.loading=!1}},async fetchPolicyData(){try{const e=await He.A.get(`${Lk}/policy-categories/`);this.policyData=e.data,this.policyTypes=[...new Set(this.policyData.map(e=>e.PolicyType))],console.log("Fetched policy types:",this.policyTypes)}catch(e){console.error("Error fetching policy data:",e),this.error="Failed to fetch policy data",Ck.OQ.error("Failed to fetch policy data","Error")}},handlePolicyTypeChange(e,t){console.log("Policy type changed:",t);const i=this.policyTabs[e];i.type=t,i.category="",i.subCategory="",this.updatePolicyCategoriesByType(t)},handlePolicyCategoryChange(e,t){console.log("Policy category changed:",t);const i=this.policyTabs[e];i.category=t,i.subCategory="",this.updateSubCategoriesByCategory(i.type,t)},handlePolicySubCategoryChange(e,t){console.log("Policy subcategory changed:",t),this.policyTabs[e].subCategory=t},updatePolicyCategoriesByType(e){if(console.log("Updating categories for type:",e),!e||!this.policyData)return this.policyCategories=[],void(this.policySubCategories=[]);const t=this.policyData.filter(t=>t.PolicyType===e);console.log("Filtered data:",t);const i=[...new Set(t.map(e=>e.PolicyCategory))];console.log("Available categories for type:",i),this.policyCategories=i,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].category="",this.policyTabs[this.activePolicyTab].subCategory=""),this.policySubCategories=[]},updateSubCategoriesByCategory(e,t){if(console.log("Updating subcategories for type:",e,"and category:",t),!e||!t||!this.policyData)return void(this.policySubCategories=[]);const i=this.policyData.filter(i=>i.PolicyType===e&&i.PolicyCategory===t);console.log("Filtered data:",i);const a=[...new Set(i.map(e=>e.PolicySubCategory))];console.log("Available subcategories:",a),this.policySubCategories=a,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].subCategory="")},async fetchEntities(){try{this.loading=!0;const e=await He.A.get(`${Lk}/entities/`);if(console.log("Raw entities response:",e.data),!e.data.entities)throw new Error("Invalid response format");this.entities=e.data.entities.map(e=>({id:e.id,label:e.label})),console.log("Mapped entities:",this.entities)}catch(e){console.error("Error fetching entities:",e),this.error="Failed to fetch entities"}finally{this.loading=!1}},handleEntitySelection(e,t,i){if(!(e<0)&&this.policyTabs[e]){if(console.log("handleEntitySelection:",{idx:e,entityId:t,isChecked:i}),this.policyTabs[e].entities||(this.policyTabs[e].entities=[]),"all"===t)this.policyTabs[e].entities=i?"all":[];else{let a="all"===this.policyTabs[e].entities?[]:Array.isArray(this.policyTabs[e].entities)?this.policyTabs[e].entities:[];const s=Number(t);i?a.includes(s)||a.push(s):a=a.filter(e=>e!==s),this.policyTabs[e].entities=a}console.log("Updated entities:",this.policyTabs[e].entities)}},selectEntity(e,t){if(e<0||!this.policyTabs[e])return;const i="all"===t?this.isAllEntitiesSelected(e):this.isEntitySelected(e,t);this.handleEntitySelection(e,t,!i)},isEntitySelected(e,t){const i=this.policyTabs[e];return!(!i||!i.entities)&&("all"===i.entities?"all"===t:Array.isArray(i.entities)&&i.entities.includes(Number(t)))},isAllEntitiesSelected(e){const t=this.policyTabs[e];return t&&"all"===t.entities},getSelectedEntitiesCount(e){const t=this.policyTabs[e];return t&&t.entities?"all"===t.entities?this.entities.length-1:Array.isArray(t.entities)?t.entities.length:0:0},toggleEntitiesDropdown(e){if(e<0||!this.policyTabs[e])return;this.policyTabs.forEach((t,i)=>{i!==e&&(t.showEntitiesDropdown=!1)});const t=this.policyTabs[e];t.showEntitiesDropdown=!t.showEntitiesDropdown,t.showEntitiesDropdown&&this.entities.length<=1&&this.fetchEntities()},closeAllEntityDropdowns(){this.policyTabs.forEach(e=>{e.showEntitiesDropdown=!1})},async handleFrameworkSelection(e){if(!e)return this.resetForm(),void(this.policies=[]);try{this.loading=!0;const[t,i]=await Promise.all([He.A.get(`${Lk}/frameworks/${e}/`),He.A.get(`${Lk}/frameworks/${e}/get-policies/`)]);console.log("Raw framework details:",t.data),console.log("Raw framework policies:",i.data);const a=t.data;console.log("DEBUG: Framework reviewer data:",{reviewer:a.Reviewer,reviewerName:a.ReviewerName});const s=a.ReviewerName||a.Reviewer||"",o=localStorage.getItem("user_name")||"";this.frameworkForm={name:a.FrameworkName,description:a.FrameworkDescription,identifier:a.Identifier,category:a.Category,internalExternal:a.InternalExternal,file:null,startDate:a.StartDate,endDate:a.EndDate,createdByName:o,reviewer:s},console.log("DEBUG: Framework form after assignment:",{reviewer:this.frameworkForm.reviewer});const l=i.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive);this.policies=l.map(e=>({id:e.PolicyId,name:e.PolicyName}));const n=await Promise.all(l.map(async e=>{const t=await He.A.get(`${Lk}/policies/${e.PolicyId}/get-subpolicies/`),i="framework"===this.selectedTab?s:e.ReviewerName||e.Reviewer||"";return{id:e.PolicyId.toString(),name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate,file:null,createdByName:e.CreatedByName||a.CreatedByName,reviewer:i,exclude:!1,activeSubPolicyTab:0,subPolicies:t.data.map(e=>({id:e.SubPolicyId.toString(),name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status}))}}));0===n.length&&Ck.OQ.info("No approved and active policies found for this framework","No Policies"),this.policyTabs=n,this.activePolicyTab=0}catch(t){console.error("Error handling framework selection:",t),this.error="Failed to load framework details",Ck.OQ.error("Failed to load framework details","Error")}finally{this.loading=!1}},async submitFrameworkVersion(){try{if(this.loading=!0,console.log("Submitting framework version with policies:",this.policyTabs),!this.validateForm("framework"))return;const e={version_type:this.selectedVersionType,FrameworkName:this.frameworkForm.name,FrameworkDescription:this.frameworkForm.description,Category:this.frameworkForm.category,StartDate:this.frameworkForm.startDate,EndDate:this.frameworkForm.endDate,Identifier:this.frameworkForm.identifier,CreatedByName:this.frameworkForm.createdByName,ReviewerName:this.frameworkForm.reviewer,InternalExternal:this.frameworkForm.internalExternal,policies:[],new_policies:[]};this.policyTabs.forEach(t=>{if(t.exclude)return;const i={PolicyName:t.name,PolicyDescription:t.description,Department:t.department,Scope:t.scope,Objective:t.objective,Identifier:t.identifier,CoverageRate:t.coverageRate,Applicability:t.applicability,PolicyType:t.type,PolicyCategory:t.category,PolicySubCategory:t.subCategory,Entities:t.entities,StartDate:t.startDate,EndDate:t.endDate,CreatedByName:t.createdByName,ReviewerName:t.reviewer,subpolicies:[],new_subpolicies:[]};t.subPolicies.forEach(e=>{if(e.exclude)return;const a={SubPolicyName:e.name,Description:e.description,Identifier:e.identifier,Control:e.control,CreatedByName:e.createdByName||t.createdByName};e.id&&!String(e.id).startsWith("new-")?(a.original_subpolicy_id=parseInt(e.id),i.subpolicies.push(a)):i.new_subpolicies.push(a)}),t.id&&!String(t.id).startsWith("new-")?(i.original_policy_id=parseInt(t.id),e.policies.push(i)):e.new_policies.push(i)}),console.log("Submitting version data:",e);const t=await He.A.post(`${Lk}/frameworks/${this.selectedFramework}/create-version/`,e,{headers:{"Content-Type":"application/json"}});console.log("Framework version creation response:",t.data),Ck.OQ.success("Framework version created successfully!","Success"),setTimeout(()=>{this.resetForm(),window.location.href="/create-policy/versioning"},1500)}catch(e){console.error("Error submitting framework version:",e);const t=e.response?.data?.error||"Failed to submit framework version";Ck.OQ.error(t,"Error Creating Framework Version")}finally{this.loading=!1}},validateForm(e){if("framework"===e)return this.frameworkForm.name?this.frameworkForm.description?this.frameworkForm.identifier?this.frameworkForm.category?this.frameworkForm.internalExternal?this.frameworkForm.startDate?this.frameworkForm.createdByName?!!this.frameworkForm.reviewer||(Ck.OQ.warning("Reviewer is required","Validation Error"),!1):(Ck.OQ.warning("Created By is required","Validation Error"),!1):(Ck.OQ.warning("Start date is required","Validation Error"),!1):(Ck.OQ.warning("Internal/External selection is required","Validation Error"),!1):(Ck.OQ.warning("Framework category is required","Validation Error"),!1):(Ck.OQ.warning("Framework identifier is required","Validation Error"),!1):(Ck.OQ.warning("Framework description is required","Validation Error"),!1):(Ck.OQ.warning("Framework name is required","Validation Error"),!1);if("policy"===e){const e=this.policyTabs[0];return e.name?e.description?e.identifier?e.type?e.category?e.subCategory?e.createdByName?!!e.reviewer||(Ck.OQ.warning("Reviewer is required","Validation Error"),!1):(Ck.OQ.warning("Created By is required","Validation Error"),!1):(Ck.OQ.warning("Policy sub-category is required","Validation Error"),!1):(Ck.OQ.warning("Policy category is required","Validation Error"),!1):(Ck.OQ.warning("Policy type is required","Validation Error"),!1):(Ck.OQ.warning("Policy identifier is required","Validation Error"),!1):(Ck.OQ.warning("Policy description is required","Validation Error"),!1):(Ck.OQ.warning("Policy name is required","Validation Error"),!1)}return!1},resetForm(){this.frameworkForm={name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:"",createdByName:localStorage.getItem("user_name")||"",reviewer:""},this.policyTabs=[],this.activePolicyTab=0,this.selectedFramework="",this.selectedPolicy="",this.showVersionModal=!1,this.selectedVersionType="minor",this.policies=[]},async submitPolicyVersion(){try{if(this.loading=!0,console.log("Submitting policy version with data:",this.policyTabs[0]),!this.validateForm("policy"))return;const e={version_type:this.selectedVersionType,PolicyName:this.policyTabs[0].name,PolicyDescription:this.policyTabs[0].description,Department:this.policyTabs[0].department,Scope:this.policyTabs[0].scope,Objective:this.policyTabs[0].objective,Identifier:this.policyTabs[0].identifier,CoverageRate:this.policyTabs[0].coverageRate,Applicability:this.policyTabs[0].applicability,CreatedByName:this.policyTabs[0].createdByName,StartDate:this.policyTabs[0].startDate,EndDate:this.policyTabs[0].endDate,PermanentTemporary:this.policyTabs[0].permanentTemporary||"",DocURL:this.policyTabs[0].docURL||"",PolicyType:this.policyTabs[0].type,PolicyCategory:this.policyTabs[0].category,PolicySubCategory:this.policyTabs[0].subCategory,Entities:this.policyTabs[0].entities,Reviewer:this.policyTabs[0].reviewer},t=[],i=[];this.policyTabs[0].subPolicies.forEach(e=>{e.id&&!String(e.id).startsWith("new-")?t.push({original_subpolicy_id:parseInt(e.id),SubPolicyName:e.name,Description:e.description,Identifier:e.identifier,CreatedByName:e.createdByName,PermanentTemporary:e.permanentTemporary||"",Control:e.control,exclude:e.exclude||!1}):e.exclude||i.push({SubPolicyName:e.name,Description:e.description,Identifier:e.identifier,CreatedByName:e.createdByName,PermanentTemporary:e.permanentTemporary||"",Control:e.control})}),e.subpolicies=t,e.new_subpolicies=i,console.log("Submitting version data:",e);const a=await He.A.post(`${Lk}/policies/${this.selectedPolicy}/create-version/`,e);console.log("Policy version created:",a.data),Ck.OQ.success("Policy version created successfully!","Success"),setTimeout(()=>{this.resetForm(),window.location.href="/create-policy/versioning"},1500)}catch(e){console.error("Error creating policy version:",e);const t=e.response?.data?.error||"Failed to create policy version";Ck.OQ.error(t,"Error Creating Policy Version")}finally{this.loading=!1}},async confirmVersionType(){this.showVersionModal=!1,"framework"===this.selectedTab?await this.submitFrameworkVersion():"policy"===this.selectedTab&&await this.submitPolicyVersion()},async fetchUsers(){try{const e=await He.A.get(`${Lk}/users/`);console.log("Raw users response:",e.data),this.users=e.data.map(e=>({id:e.UserId,name:e.UserName})),console.log("Mapped users:",this.users)}catch(e){console.error("Error fetching users:",e),this.error="Failed to fetch users",Ck.OQ.error("Failed to fetch users","Error")}},async fetchPolicyDetails(e){if(e)try{this.loading=!0;const[t,i]=await Promise.all([He.A.get(`${Lk}/policies/${e}/`),He.A.get(`${Lk}/policies/${e}/get-subpolicies/`)]);console.log("Raw policy details:",t.data),console.log("Raw subpolicies:",i.data);const a=t.data,s=localStorage.getItem("user_name")||"";this.policyTabs=[{id:a.PolicyId,name:a.PolicyName,description:a.PolicyDescription,status:a.Status,department:a.Department,scope:a.Scope,objective:a.Objective,identifier:a.Identifier,coverageRate:a.CoverageRate,applicability:a.Applicability,type:a.PolicyType,category:a.PolicyCategory,subCategory:a.PolicySubCategory,entities:a.Entities,startDate:a.StartDate,endDate:a.EndDate,file:null,createdByName:s,reviewer:a.Reviewer,activeSubPolicyTab:0,subPolicies:i.data.map(e=>({id:e.SubPolicyId,name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status,createdByName:s}))}],this.activePolicyTab=0}catch(t){console.error("Error fetching policy details:",t),this.error="Failed to fetch policy details",Ck.OQ.error("Failed to fetch policy details","Error"),this.policyTabs=[]}finally{this.loading=!1}},excludePolicyTab(e){this.policyTabs[e]&&(this.policyTabs[e].exclude=!this.policyTabs[e].exclude,console.log(`Policy ${e} exclude status:`,this.policyTabs[e].exclude),this.policyTabs[e].exclude&&this.policyTabs[e].subPolicies.forEach(e=>{e.exclude=!0}))},excludeSubPolicyTab(e,t){this.policyTabs[e]&&this.policyTabs[e].subPolicies[t]&&(this.policyTabs[e].subPolicies[t].exclude=!this.policyTabs[e].subPolicies[t].exclude)}}};const Ek=(0,le.A)(wk,[["render",bk],["__scopeId","data-v-8b2bdbc0"]]);var Rk=Ek;i(531);const Ik={class:"tree-container"},Dk={class:"tree-header",style:{"justify-content":"center"}},Pk={class:"dropdown-container"},_k={class:"helper-text"},Ak=["viewBox"],Sk={key:0,class:"node-group"},Tk=["y"],xk=["x","y"],Fk={class:"big-node-text framework-text"},Vk={key:0},Uk=["x1","y1","x2","y2"],Nk=["x1","y1","x2","y2"],Mk=["cx","cy"],Xk=["x1","y1","x2","y2"],$k=["cx","cy"],Ok={key:1},jk=["x1","y1","x2","y2"],Bk=["cx","cy"],Wk=["x1","y1","x2","y2"],qk=["cx","cy"],Qk=["x1","y1","x2","y2"],Kk=["x1","y1","x2","y2"],Jk=["x","y"],zk=["x","y"],Hk={class:"big-node-text"},Gk={key:0},Yk=["x1","y1","x2","y2"],Zk=["x1","y1","x2","y2"],eh=["cx","cy"],th=["x1","y1","x2","y2"],ih=["cx","cy"],ah=["x1","y1","x2","y2"],sh=["cx","cy"],oh={class:"fade-in"},lh=["x","y"],nh=["x","y"],rh={class:"big-node-text"},ch="http://localhost:8000/api",dh=60;var uh={__name:"TreePolicies",setup(e){const t=(0,s.EW)(()=>{const e=Number(c.value.split(" ")[3]);return e/2-40}),i=(0,ie.KR)(1),o=(0,ie.KR)([]),l=(0,ie.KR)(""),n=(0,ie.KR)(null),r=(0,ie.KR)(!1),c=(0,s.EW)(()=>{const e=700,t=m.value.length||1,i=120,a=Math.max(e,t*i+200);return`0 0 1200 ${a}`}),u=async()=>{try{r.value=!0;const e=await He.A.get(`${ch}/frameworks/`);o.value=e.data.map(e=>({id:e.FrameworkId,title:e.FrameworkName}))}finally{r.value=!1}},p=async e=>{try{r.value=!0;const t=await He.A.get(`${ch}/frameworks/${e}/`);n.value=t.data}finally{r.value=!1}};(0,s.sV)(async()=>{await u(),o.value.length>0&&(l.value=o.value[0].title)}),(0,s.wB)(l,async e=>{if(e){const t=o.value.find(t=>t.title===e);t&&await p(t.id)}else n.value=null});const m=(0,s.EW)(()=>n.value&&n.value.policies||[]),v=(0,s.EW)(()=>{const e=m.value;if(!e.length)return[];const t=e.length,i=100,a=Number(c.value.split(" ")[3])-100-48,s=(a-i)/(t>1?t-1:1)+30;return e.map((e,t)=>{const a=i+t*s;return{id:e.PolicyId,title:e.PolicyName,x:320,y:a,subpolicies:(e.subpolicies||[]).map((t,i)=>{const s=e.subpolicies.length,o=a-(s>1?40:0),l=s>1?110:0;return{id:t.SubPolicyId,title:t.SubPolicyName,x:600,y:o+i*l}})}})}),k=(0,s.EW)(()=>v.value.flatMap(e=>e.subpolicies)),h=(0,s.EW)(()=>({label:"Framework",name:"framework",defaultValue:"Select Framework",values:o.value.map(e=>({value:e.title,label:e.title})),helperText:"Select a framework to view its policies and subpolicies."}));function g(){i.value=2}function y(){i.value=0}const f=(0,s.EW)(()=>{if(!v.value.length)return{x:dh+220+40,y:t.value+40};const e=v.value[0].y+30,i=v.value[v.value.length-1].y+30,a=dh+220+40,s=(e+i)/2;return{x:a,y:s}});return(e,o)=>((0,s.uX)(),(0,s.CE)("div",Ik,[(0,s.Lk)("div",Dk,[(0,s.Lk)("div",Pk,[(0,s.bF)(xa.A,{config:h.value,modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=e=>l.value=e),disabled:r.value},null,8,["config","modelValue","disabled"]),(0,s.Lk)("div",_k,(0,d.v_)(h.value.helperText),1)])]),(0,s.Lk)("div",{style:{display:"flex","justify-content":"center",gap:"16px","margin-bottom":"24px"}},[(0,s.Lk)("button",{class:"expand-btn",onClick:g},"EXPAND ALL"),(0,s.Lk)("button",{class:"expand-btn",onClick:y},"COLLAPSE")]),((0,s.uX)(),(0,s.CE)("svg",{class:"tree-svg",viewBox:c.value},[n.value?((0,s.uX)(),(0,s.CE)("g",Sk,[(0,s.Lk)("rect",{class:"framework-big-node",x:dh,y:t.value,width:"220",height:"80",rx:"18",fill:"#fff",stroke:"url(#frameworkBorderGradient)","stroke-width":"4"},null,8,Tk),((0,s.uX)(),(0,s.CE)("foreignObject",{x:dh+10,y:t.value+10,width:"200",height:"60"},[(0,s.Lk)("div",Fk,(0,d.v_)(n.value.FrameworkName),1)],8,xk))])):(0,s.Q3)("",!0),i.value>=1?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[o[1]||(o[1]=(0,s.Fv)('<defs data-v-741d6523><linearGradient id="frameworkGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-741d6523><stop offset="0%" style="stop-color:#4f7cff;stop-opacity:1;" data-v-741d6523></stop><stop offset="100%" style="stop-color:#4f46e5;stop-opacity:1;" data-v-741d6523></stop></linearGradient><linearGradient id="policyGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-741d6523><stop offset="0%" style="stop-color:#34d399;stop-opacity:1;" data-v-741d6523></stop><stop offset="100%" style="stop-color:#10b981;stop-opacity:1;" data-v-741d6523></stop></linearGradient><linearGradient id="subpolicyGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-741d6523><stop offset="0%" style="stop-color:#fbbf24;stop-opacity:1;" data-v-741d6523></stop><stop offset="100%" style="stop-color:#f59e0b;stop-opacity:1;" data-v-741d6523></stop></linearGradient><linearGradient id="policyBorderGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-741d6523><stop offset="0%" stop-color="#34d399" data-v-741d6523></stop><stop offset="100%" stop-color="#10b981" data-v-741d6523></stop></linearGradient><linearGradient id="subpolicyBorderGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-741d6523><stop offset="0%" stop-color="#fbbf24" data-v-741d6523></stop><stop offset="100%" stop-color="#f59e0b" data-v-741d6523></stop></linearGradient><linearGradient id="frameworkBorderGradient" x1="0%" y1="0%" x2="100%" y2="100%" data-v-741d6523><stop offset="0%" stop-color="#ff6a3d" data-v-741d6523></stop><stop offset="100%" stop-color="#ffd600" data-v-741d6523></stop></linearGradient></defs>',1)),v.value.length?((0,s.uX)(),(0,s.CE)("g",Vk,[(0,s.Lk)("line",{class:"tree-line",x1:f.value.x,y1:v.value[0].y+34,x2:f.value.x,y2:v.value[v.value.length-1].y+34},null,8,Uk),(0,s.Lk)("line",{class:"tree-line",x1:dh+220,y1:t.value+40,x2:f.value.x,y2:t.value+40},null,8,Nk),(0,s.Lk)("circle",{cx:f.value.x,cy:t.value+40,r:"6",fill:"#6b7280",opacity:"0.18"},null,8,Mk),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)("line",{key:"junction-"+e.id,class:"tree-line",x1:f.value.x,y1:e.y+34,x2:e.x,y2:e.y+34},null,8,Xk))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)("circle",{key:"junction-circle-"+e.id,cx:f.value.x,cy:e.y+34,r:"5",fill:"#6b7280",opacity:"0.18"},null,8,$k))),128))])):(0,s.Q3)("",!0),1===v.value.length?((0,s.uX)(),(0,s.CE)("g",Ok,[(0,s.Lk)("line",{class:"tree-line",x1:dh+220,y1:t.value+40,x2:f.value.x-16,y2:t.value+40},null,8,jk),(0,s.Lk)("circle",{cx:f.value.x-16,cy:t.value+40,r:"6",fill:"#6b7280",opacity:"0.18"},null,8,Bk),t.value+40!==v.value[0].y+34?((0,s.uX)(),(0,s.CE)("line",{key:0,class:"tree-line",x1:f.value.x-16,y1:t.value+40,x2:f.value.x-16,y2:v.value[0].y+34},null,8,Wk)):(0,s.Q3)("",!0),t.value+40!==v.value[0].y+34?((0,s.uX)(),(0,s.CE)("circle",{key:1,cx:f.value.x-16,cy:v.value[0].y+34,r:"6",fill:"#6b7280",opacity:"0.18"},null,8,qk)):(0,s.Q3)("",!0),(0,s.Lk)("line",{class:"tree-line",x1:f.value.x-16,y1:v.value[0].y+34,x2:v.value[0].x-16,y2:v.value[0].y+34},null,8,Qk),(0,s.Lk)("line",{class:"tree-line",x1:v.value[0].x-16,y1:v.value[0].y+34,x2:v.value[0].x,y2:v.value[0].y+34},null,8,Kk)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)("g",{key:e.id,class:"node-group"},[(0,s.Lk)("rect",{class:"big-node",x:e.x,y:e.y,width:"180",height:"60",rx:"14",fill:"#fff",stroke:"url(#policyBorderGradient)","stroke-width":"3"},null,8,Jk),((0,s.uX)(),(0,s.CE)("foreignObject",{x:e.x+8,y:e.y+8,width:"164",height:"44"},[(0,s.Lk)("div",Hk,(0,d.v_)(e.title),1)],8,zk)),e.subpolicies&&e.subpolicies.length?((0,s.uX)(),(0,s.CE)("g",Gk,[(0,s.Lk)("line",{class:"tree-line",x1:e.x+180,y1:e.y+34,x2:e.x+180+40,y2:e.y+34},null,8,Yk),(0,s.Lk)("line",{class:"tree-line",x1:e.x+180+40,y1:e.subpolicies[0].y+34,x2:e.x+180+40,y2:e.subpolicies[e.subpolicies.length-1].y+34},null,8,Zk),(0,s.Lk)("circle",{cx:e.x+180+40,cy:e.y+34,r:"5",fill:"#6b7280",opacity:"0.18"},null,8,eh),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,t=>((0,s.uX)(),(0,s.CE)("line",{key:"junction-"+e.id+"-"+t.id,class:"tree-line",x1:e.x+180+40,y1:t.y+34,x2:t.x,y2:t.y+34},null,8,th))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,t=>((0,s.uX)(),(0,s.CE)("circle",{key:"junction-circle-"+e.id+"-"+t.id,cx:e.x+180+40,cy:t.y+34,r:"4",fill:"#6b7280",opacity:"0.18"},null,8,ih))),128))])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)("g",{key:"single-sub-"+e.id},[e.subpolicies&&1===e.subpolicies.length?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("line",{class:"tree-line",x1:e.x+180,y1:e.y+34,x2:e.subpolicies[0].x,y2:e.subpolicies[0].y+34},null,8,ah),(0,s.Lk)("circle",{cx:(e.x+180+e.subpolicies[0].x)/2,cy:(e.y+34+e.subpolicies[0].y+34)/2,r:"5",fill:"#6b7280",opacity:"0.18"},null,8,sh)],64)):(0,s.Q3)("",!0)]))),128))]))),128)),(0,s.bo)((0,s.Lk)("g",oh,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)(s.FK,{key:"subs-"+e.id},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,e=>((0,s.uX)(),(0,s.CE)("g",{key:e.id,class:"node-group"},[(0,s.Lk)("rect",{class:"big-node",x:e.x,y:e.y,width:"180",height:"60",rx:"14",fill:"#fff",stroke:"url(#subpolicyBorderGradient)","stroke-width":"3"},null,8,lh),((0,s.uX)(),(0,s.CE)("foreignObject",{x:e.x+8,y:e.y+8,width:"164",height:"44"},[(0,s.Lk)("div",rh,(0,d.v_)(e.title),1)],8,nh))]))),128))],64))),128))],512),[[a.aG,i.value>=2&&k.value.length]])],64)):(0,s.Q3)("",!0)],8,Ak))]))}};const ph=(0,le.A)(uh,[["__scopeId","data-v-741d6523"]]);var mh=ph;const vh={class:"framework-explorer-container"},kh={class:"export-controls"},hh={class:"export-controls-inner"},gh={class:"summary-cards"},yh={class:"summary-card-content"},fh={class:"summary-value"},bh={class:"summary-card-content"},Ch={class:"summary-value"},Lh={class:"summary-card-content"},wh={class:"summary-value"},Eh={class:"summary-card-content"},Rh={class:"summary-value"},Ih={class:"top-controls"},Dh={class:"framework-dropdown-section"},Ph={class:"internal-external-dropdown-section"},_h={class:"entity-dropdown-section"},Ah={key:0,class:"active-filter"},Sh={class:"framework-card-grid"},Th=["onClick"],xh={class:"framework-card-header"},Fh={class:"framework-title-section"},Vh={class:"framework-card-title"},Uh={class:"framework-card-category"},Nh={class:"framework-card-desc"},Mh={class:"framework-card-actions"},Xh={class:"action-buttons"},$h=["checked","onChange"],Oh=["onClick"],jh={key:0,class:"modal-loading"},Bh={key:1,class:"modal-body simple-modal-body"},Wh={class:"framework-details simple-framework-details"},qh={class:"detail-row simple-detail-row"},Qh={class:"detail-value simple-detail-value"},Kh={class:"detail-row simple-detail-row"},Jh={class:"detail-value simple-detail-value"},zh={class:"detail-row simple-detail-row"},Hh={class:"detail-value simple-detail-value"},Gh={class:"detail-row simple-detail-row"},Yh={class:"detail-value simple-detail-value"},Zh={class:"detail-row simple-detail-row"},eg={class:"detail-value simple-detail-value"},tg={class:"detail-row simple-detail-row"},ig={class:"detail-value simple-detail-value"},ag={class:"detail-row simple-detail-row"},sg={class:"detail-value simple-detail-value"},og={class:"detail-row simple-detail-row"},lg={class:"detail-value simple-detail-value"},ng={class:"detail-row simple-detail-row"},rg={class:"detail-value simple-detail-value"},cg={class:"detail-row simple-detail-row"},dg={class:"detail-value simple-detail-value"},ug={class:"detail-row simple-detail-row"},pg={class:"detail-value simple-detail-value"},mg={class:"detail-row simple-detail-row"},vg={class:"detail-value simple-detail-value"},kg={key:0,class:"detail-row simple-detail-row"},hg=["href"],gg={key:2,class:"modal-error"};var yg={__name:"FrameworkExplorer",setup(e){const t=(0,ie.KR)([]),i=(0,ie.KR)(""),o=(0,ie.KR)(""),l=(0,ie.KR)(""),n=(0,ie.KR)([]),r=(0,ae.rd)(),c=(0,ie.KR)({active_frameworks:0,inactive_frameworks:0,active_policies:0,inactive_policies:0}),u=(0,ie.KR)(!1),p=(0,ie.KR)(null),m=(0,ie.KR)(null),v=(0,s.EW)(()=>{const e=[];if(p.value&&m.value&&e.push(`${p.value} ${m.value}s`),o.value&&e.push(o.value),l.value){const t=n.value.find(e=>e.id===l.value)?.label||l.value;e.push(t)}return e.length>0?e.join(" & "):null}),k=(0,ie.KR)(!1),h=(0,ie.KR)(!1),g=(0,ie.KR)(null),y=(0,ie.KR)(""),f=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},b=async()=>{if(i.value&&y.value)try{const t=await He.A.post(`/api/frameworks/${i.value}/export/`,{format:y.value}),{file_url:a,file_name:s}=t.data;if(!a||!s)return ya.error("Export failed: No file URL or name returned.","Export Error"),void f({title:"Framework Export Failed",message:"Export failed: No file URL or name returned.",category:"framework",priority:"high",user_id:"default_user"});try{const e=await He.A.get(a,{responseType:"blob"}),t=window.URL.createObjectURL(new Blob([e.data])),i=document.createElement("a");i.href=t,i.setAttribute("download",s),document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(t),ya.success("Export completed successfully!","Export Success"),f({title:"Framework Export Completed",message:`Framework export completed successfully in ${y.value.toUpperCase()} format.`,category:"framework",priority:"medium",user_id:"default_user"})}catch(e){ya.success("Export completed successfully!","Export Success"),f({title:"Framework Export Completed",message:`Framework export completed successfully in ${y.value.toUpperCase()} format.`,category:"framework",priority:"medium",user_id:"default_user"}),console.error(e)}}catch(t){ya.error("Export failed. Please try again.","Export Error"),f({title:"Framework Export Failed",message:`Failed to export framework: ${t.response?.data?.error||t.message}`,category:"framework",priority:"high",user_id:"default_user"}),console.error(t)}else ya.warning("Please select a framework and format.","Missing Selection")},C=e=>{if(!e)return"N/A";try{const t=new Date(e);return t.toLocaleDateString()}catch(t){return e}},L=async()=>{u.value=!0;try{const e={};l.value&&(e.entity=l.value);const i=await He.A.get("/api/framework-explorer/",{params:e});t.value=i.data.frameworks,c.value=i.data.summary}catch(e){console.error("Error fetching frameworks:",e)}finally{u.value=!1}},w=async()=>{try{const e=await He.A.get("/api/entities/");n.value=e.data.entities||[]}catch(e){console.error("Error fetching entities:",e)}},E=async e=>{g.value=null,k.value=!0,h.value=!0;try{const t=await He.A.get(`/api/frameworks/${e}/details/`);g.value=t.data}catch(t){console.error("Error fetching framework details:",t)}finally{h.value=!1}},R=()=>{k.value=!1},I=(e,t)=>{p.value===e&&m.value===t?D():(p.value=e,m.value=t)},D=()=>{p.value=null,m.value=null,o.value="",l.value=""},P=async e=>{try{if("Active"===e.status)try{const t=await He.A.get("/api/users-for-reviewer-selection/"),i=t.data;if(0===i.length)return ya.warning("No reviewers available. Please contact an administrator.","No Reviewers"),void f({title:"No Reviewers Available",message:"No reviewers available for framework deactivation. Please contact an administrator.",category:"framework",priority:"medium",user_id:"default_user"});const a=i.map(e=>({value:e.UserId,label:`${e.UserName} (${e.Email})`}));ya.select("Please select a reviewer for this framework deactivation request:","Select Reviewer",a,async t=>{if(console.log("DEBUG: Selected reviewer ID:",t,"Type:",typeof t),!t)return ya.warning("Reviewer selection is required.","Missing Information"),void f({title:"Reviewer Selection Required",message:"Reviewer selection is required for framework deactivation.",category:"framework",priority:"medium",user_id:"default_user"});ya.comment("Please provide a reason for deactivating this framework:","Framework Deactivation",async i=>{if(console.log("DEBUG: Reason provided:",i),!i||""===i.trim())return ya.warning("Deactivation reason is required.","Missing Information"),void f({title:"Deactivation Reason Required",message:"Deactivation reason is required for framework deactivation.",category:"framework",priority:"medium",user_id:"default_user"});try{console.log("DEBUG: Sending API request with data:",{reason:i.trim(),cascadeToApproved:!0,ReviewerId:t,UserId:1});const a=await He.A.post(`/api/frameworks/${e.id}/request-status-change/`,{reason:i.trim(),cascadeToApproved:!0,ReviewerId:t,UserId:1});console.log("DEBUG: API response:",a.data),ya.success("Framework deactivation request submitted. Awaiting approval.","Request Submitted"),f({title:"Framework Deactivation Request Submitted",message:`Framework "${e.name}" deactivation request submitted successfully. Awaiting approval.`,category:"framework",priority:"high",user_id:"default_user"}),await L()}catch(a){console.error("Error submitting deactivation request:",a),console.error("Error response:",a.response?.data),ya.error("Failed to submit deactivation request. Please try again.","Request Failed"),f({title:"Framework Deactivation Request Failed",message:`Failed to submit deactivation request for framework "${e.name}": ${a.response?.data?.error||a.message}`,category:"framework",priority:"high",user_id:"default_user"})}})})}catch(t){return console.error("Error fetching reviewers:",t),ya.error("Failed to fetch reviewers. Please try again.","Error"),void f({title:"Failed to Fetch Reviewers",message:`Failed to fetch reviewers for framework deactivation: ${t.response?.data?.error||t.message}`,category:"framework",priority:"high",user_id:"default_user"})}else{const t=await He.A.post(`/api/frameworks/${e.id}/toggle-status/`,{reason:"Reactivating framework",cascadeToApproved:!0});e.status=t.data.status||"Active";let i="Framework status change request submitted.";ya.success(i,"Status Update"),f({title:"Framework Activation Successful",message:`Framework "${e.name}" has been successfully activated.`,category:"framework",priority:"high",user_id:"default_user"}),await L()}}catch(t){console.error("Error toggling framework status:",t),ya.error("Failed to update framework status. Please try again.","Update Failed"),f({title:"Framework Status Update Failed",message:`Failed to update framework "${e.name}" status: ${t.response?.data?.error||t.message}`,category:"framework",priority:"high",user_id:"default_user"})}},_=(0,s.EW)(()=>{let e=t.value;return i.value?(e=e.filter(e=>e.id===parseInt(i.value)),e):(o.value&&(e=e.filter(e=>e.internalExternal===o.value)),p.value&&m.value&&("framework"===m.value?e=e.filter(e=>e.status===p.value):"policy"===m.value&&(e="Active"===p.value?e.filter(e=>e.active_policies_count>0):e.filter(e=>e.inactive_policies_count>0))),e)});function A(e){const t={name:"FrameworkPolicies",params:{frameworkId:e}};l.value&&(t.query={entity:l.value}),r.push(t)}(0,s.wB)(l,()=>{L()}),(0,s.sV)(()=>{w();const e=(0,ae.lq)().query.entity;e&&(l.value=e),L()});const S=(0,s.EW)(()=>({label:"Framework",values:[{value:"",label:"Select Framework"},...t.value.map(e=>({value:String(e.id),label:e.name}))]})),T={label:"Type",values:[{value:"",label:"All Types"},{value:"Internal",label:"Internal"},{value:"External",label:"External"}]},x=(0,s.EW)(()=>({label:"Entity",values:[{value:"",label:"All Entities"},...n.value.map(e=>({value:String(e.id),label:e.label}))]}));return(e,t)=>((0,s.uX)(),(0,s.CE)("div",vh,[(0,s.Lk)("div",kh,[(0,s.Lk)("div",hh,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),class:"export-dropdown"},t[10]||(t[10]=[(0,s.Fv)('<option value="" disabled data-v-45f77deb>Select format</option><option value="xlsx" data-v-45f77deb>Excel (.xlsx)</option><option value="pdf" data-v-45f77deb>PDF (.pdf)</option><option value="csv" data-v-45f77deb>CSV (.csv)</option><option value="json" data-v-45f77deb>JSON (.json)</option><option value="xml" data-v-45f77deb>XML (.xml)</option><option value="txt" data-v-45f77deb>Text (.txt)</option>',7)]),512),[[a.u1,y.value]]),(0,s.Lk)("button",{onClick:b}," Export ")])]),t[33]||(t[33]=(0,s.Lk)("div",{class:"page-header"},[(0,s.Lk)("h1",null,"Framework Explorer"),(0,s.Lk)("div",{class:"page-header-underline"})],-1)),(0,s.Lk)("div",gh,[(0,s.Lk)("div",{class:"summary-card active-framework",onClick:t[1]||(t[1]=e=>I("Active","framework"))},[(0,s.Lk)("div",yh,[t[11]||(t[11]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"})]),(0,s.Lk)("div",{class:"summary-label"},"Active Framework")],-1)),(0,s.Lk)("span",fh,(0,d.v_)(c.value.active_frameworks),1)])]),(0,s.Lk)("div",{class:"summary-card inactive-framework",onClick:t[2]||(t[2]=e=>I("Inactive","framework"))},[(0,s.Lk)("div",bh,[t[12]||(t[12]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-shield"})]),(0,s.Lk)("div",{class:"summary-label"},"Inactive Framework")],-1)),(0,s.Lk)("span",Ch,(0,d.v_)(c.value.inactive_frameworks),1)])]),(0,s.Lk)("div",{class:"summary-card active-policy",onClick:t[3]||(t[3]=e=>I("Active","policy"))},[(0,s.Lk)("div",Lh,[t[13]||(t[13]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-file-circle-check"})]),(0,s.Lk)("div",{class:"summary-label"},"Active Policy")],-1)),(0,s.Lk)("span",wh,(0,d.v_)(c.value.active_policies),1)])]),(0,s.Lk)("div",{class:"summary-card inactive-policy",onClick:t[4]||(t[4]=e=>I("Inactive","policy"))},[(0,s.Lk)("div",Eh,[t[14]||(t[14]=(0,s.Lk)("div",{class:"summary-icon-label"},[(0,s.Lk)("div",{class:"summary-icon-wrapper"},[(0,s.Lk)("i",{class:"fas fa-file-circle-xmark"})]),(0,s.Lk)("div",{class:"summary-label"},"Inactive Policy")],-1)),(0,s.Lk)("span",Rh,(0,d.v_)(c.value.inactive_policies),1)])])]),(0,s.Lk)("div",Ih,[(0,s.Lk)("div",Dh,[(0,s.bF)(xa.A,{config:S.value,modelValue:i.value,"onUpdate:modelValue":t[5]||(t[5]=e=>i.value=e)},null,8,["config","modelValue"])]),(0,s.Lk)("div",Ph,[(0,s.bF)(xa.A,{config:T,modelValue:o.value,"onUpdate:modelValue":t[6]||(t[6]=e=>o.value=e)},null,8,["modelValue"])]),(0,s.Lk)("div",_h,[(0,s.bF)(xa.A,{config:x.value,modelValue:l.value,"onUpdate:modelValue":t[7]||(t[7]=e=>l.value=e)},null,8,["config","modelValue"])]),v.value?((0,s.uX)(),(0,s.CE)("div",Ah,[(0,s.Lk)("span",null,"Filtered by: "+(0,d.v_)(v.value),1),(0,s.Lk)("button",{class:"clear-filter-btn",onClick:D},"Clear Filter")])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Sh,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(_.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"framework-card",onClick:t=>A(e.id)},[(0,s.Lk)("div",xh,[(0,s.Lk)("div",Fh,[t[15]||(t[15]=(0,s.Lk)("span",{class:"framework-icon"},[(0,s.Lk)("i",{class:"fas fa-book"})],-1)),(0,s.Lk)("span",Vh,(0,d.v_)(e.name),1)])]),(0,s.Lk)("div",Uh,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["framework-card-type",{"type-internal":"Internal"===(e.internalExternal||"Internal"),"type-external":"External"===(e.internalExternal||"Internal")}])}," Type: "+(0,d.v_)(e.internalExternal||"Internal"),3),(0,s.Lk)("div",Nh,(0,d.v_)(e.description),1),(0,s.Lk)("div",Mh,[(0,s.Lk)("div",Xh,[(0,s.Lk)("label",{class:"switch",onClick:t[8]||(t[8]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("input",{type:"checkbox",checked:"Active"===e.status,onChange:(0,a.D$)(t=>P(e),["stop"])},null,40,$h),t[16]||(t[16]=(0,s.Lk)("span",{class:"slider"},null,-1))]),(0,s.Lk)("span",{class:(0,d.C4)(["switch-label","Active"===e.status?"active":"inactive"])},(0,d.v_)(e.status),3)]),(0,s.Lk)("span",{class:"document-icon",onClick:(0,a.D$)(t=>E(e.id),["stop"])},t[17]||(t[17]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)]),8,Oh)])],8,Th))),128))]),k.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:R},[(0,s.Lk)("div",{class:"modal-content simple-modal",onClick:t[9]||(t[9]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"modal-close-btn simple-close",onClick:R},"×"),t[32]||(t[32]=(0,s.Lk)("div",{class:"simple-modal-header"},[(0,s.Lk)("h2",null,"Framework Details")],-1)),h.value?((0,s.uX)(),(0,s.CE)("div",jh,t[18]||(t[18]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading details... ")]))):g.value?((0,s.uX)(),(0,s.CE)("div",Bh,[(0,s.Lk)("div",Wh,[(0,s.Lk)("div",qh,[t[19]||(t[19]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Framework Name",-1)),(0,s.Lk)("span",Qh,(0,d.v_)(g.value.FrameworkName),1)]),(0,s.Lk)("div",Kh,[t[20]||(t[20]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Description",-1)),(0,s.Lk)("span",Jh,(0,d.v_)(g.value.FrameworkDescription),1)]),(0,s.Lk)("div",zh,[t[21]||(t[21]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Category",-1)),(0,s.Lk)("span",Hh,(0,d.v_)(g.value.Category),1)]),(0,s.Lk)("div",Gh,[t[22]||(t[22]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Version",-1)),(0,s.Lk)("span",Yh,(0,d.v_)(g.value.CurrentVersion),1)]),(0,s.Lk)("div",Zh,[t[23]||(t[23]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Status",-1)),(0,s.Lk)("span",eg,(0,d.v_)(g.value.Status),1)]),(0,s.Lk)("div",tg,[t[24]||(t[24]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Active/Inactive",-1)),(0,s.Lk)("span",ig,(0,d.v_)(g.value.ActiveInactive),1)]),(0,s.Lk)("div",ag,[t[25]||(t[25]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Identifier",-1)),(0,s.Lk)("span",sg,(0,d.v_)(g.value.Identifier),1)]),(0,s.Lk)("div",og,[t[26]||(t[26]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Effective Date",-1)),(0,s.Lk)("span",lg,(0,d.v_)(C(g.value.EffectiveDate)),1)]),(0,s.Lk)("div",ng,[t[27]||(t[27]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Start Date",-1)),(0,s.Lk)("span",rg,(0,d.v_)(C(g.value.StartDate)),1)]),(0,s.Lk)("div",cg,[t[28]||(t[28]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"End Date",-1)),(0,s.Lk)("span",dg,(0,d.v_)(C(g.value.EndDate)),1)]),(0,s.Lk)("div",ug,[t[29]||(t[29]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Created By",-1)),(0,s.Lk)("span",pg,(0,d.v_)(g.value.CreatedByName),1)]),(0,s.Lk)("div",mg,[t[30]||(t[30]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Created Date",-1)),(0,s.Lk)("span",vg,(0,d.v_)(C(g.value.CreatedByDate)),1)]),g.value.DocURL?((0,s.uX)(),(0,s.CE)("div",kg,[t[31]||(t[31]=(0,s.Lk)("span",{class:"detail-label simple-detail-label"},"Documentation",-1)),(0,s.Lk)("a",{href:g.value.DocURL,target:"_blank",class:"doc-link simple-detail-value"},"View Documentation",8,hg)])):(0,s.Q3)("",!0)])])):((0,s.uX)(),(0,s.CE)("div",gg," Failed to load framework details. "))])])):(0,s.Q3)("",!0),(0,s.bF)(Ta)]))}};const fg=(0,le.A)(yg,[["__scopeId","data-v-45f77deb"]]);var bg=fg;const Cg={class:"framework-policies-container"},Lg={class:"breadcrumb-tab"},wg={class:"breadcrumb-chip"},Eg={class:"top-controls"},Rg={class:"entity-dropdown-section"},Ig={class:"policy-card-grid"},Dg={class:"policy-card-header"},Pg={class:"policy-title-section"},_g={class:"policy-card-title"},Ag={class:"policy-card-meta"},Sg={class:"policy-card-category"},Tg={class:"policy-card-desc"},xg={class:"policy-card-actions"},Fg={class:"action-buttons"},Vg=["checked","onChange"],Ug=["onClick"],Ng=["onClick"],Mg={key:0,class:"modal-loading"},Xg={key:1,class:"modal-body"},$g={class:"detail-row"},Og={class:"detail-value"},jg={class:"detail-row"},Bg={class:"detail-value"},Wg={class:"detail-row"},qg={class:"detail-value"},Qg={class:"detail-row"},Kg={class:"detail-value"},Jg={class:"detail-row"},zg={class:"detail-value"},Hg={class:"detail-row"},Gg={class:"detail-value"},Yg={class:"detail-row"},Zg={class:"detail-value"},ey={class:"detail-row"},ty={class:"detail-value"},iy={class:"detail-row"},ay={class:"detail-value"},sy={class:"detail-row"},oy={class:"detail-value"},ly={class:"detail-row"},ny={class:"detail-value"},ry={class:"detail-row"},cy={class:"detail-value"},dy={class:"detail-row"},uy={class:"detail-value"},py={class:"detail-row"},my={class:"detail-value"},vy={key:0,class:"detail-row"},ky=["href"],hy={key:1,class:"subpolicies-section"},gy={class:"subpolicy-header"},yy={class:"subpolicy-name"},fy={class:"subpolicy-detail"},by={class:"subpolicy-detail"},Cy={class:"subpolicy-detail"},Ly={key:2,class:"no-subpolicies"},wy={key:2,class:"modal-error"};var Ey={__name:"FrameworkPolicies",setup(e){const t=(0,ae.rd)(),i=(0,ae.lq)(),o=i.params.frameworkId,l=(0,ie.KR)(""),n=(0,ie.KR)([]),r=(0,ie.KR)([]),c=(0,ie.KR)(""),u=(0,ie.KR)([]),p=(0,ie.KR)(!1),m=(0,ie.Kh)({}),v=(0,ie.KR)(!1),k=(0,ie.KR)(!1),h=(0,ie.KR)(null),g=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},y=e=>{if(!e)return"N/A";try{const t=new Date(e);return t.toLocaleDateString()}catch(t){return e}},f=async()=>{p.value=!0;try{const e=await He.A.get(`/api/frameworks/${o}/policies-list/`);r.value=e.data.policies,l.value=e.data.framework.name;for(const t of r.value)void 0===m[t.id]&&(m[t.id]="")}catch(e){console.error("Error fetching policies:",e),g({title:"Policy List Loading Failed",message:`Failed to load policies for framework "${l.value||"Unknown Framework"}": ${e.response?.data?.error||e.message}`,category:"policy",priority:"high",user_id:"default_user"})}finally{p.value=!1}},b=async()=>{try{const e=await He.A.get("/api/entities/");u.value=e.data.entities||[]}catch(e){console.error("Error fetching entities:",e),g({title:"Entity List Loading Failed",message:`Failed to load entities for policy filtering: ${e.response?.data?.error||e.message}`,category:"policy",priority:"medium",user_id:"default_user"})}},C=(0,s.EW)(()=>{if(!c.value)return r.value;console.log("Filtering policies with entity:",c.value),console.log("Total policies before filtering:",r.value.length);const e=r.value.filter(e=>{if(!e.Entities)return!1;if("all"===e.Entities)return!0;if("all"===c.value)return!0;if(Array.isArray(e.Entities)){const t=parseInt(c.value),i=c.value.toString();return e.Entities.includes("all")||e.Entities.includes(t)||e.Entities.includes(i)}return!1});return console.log("Filtered policies count:",e.length),console.log("Filtered policies:",e.map(e=>({name:e.name,entities:e.Entities}))),e});(0,s.wB)(C,e=>{n.value=e},{immediate:!0});const L=async e=>{h.value=null,v.value=!0,k.value=!0;try{const t=await He.A.get(`/api/policies/${e}/details/`);h.value=t.data}catch(t){console.error("Error fetching policy details:",t),g({title:"Policy Details Loading Failed",message:`Failed to load details for policy ID ${e}: ${t.response?.data?.error||t.message}`,category:"policy",priority:"medium",user_id:"default_user"})}finally{k.value=!1}},w=()=>{v.value=!1},E=async e=>{try{if("Active"===e.status)try{const t=await He.A.get("/api/users-for-reviewer-selection/"),i=t.data;if(0===i.length)return ya.warning("No reviewers available. Please contact administrator.","No Reviewers"),void g({title:"No Reviewers Available",message:"No reviewers are available for policy deactivation requests. Please contact administrator.",category:"policy",priority:"high",user_id:"default_user"});const a=i.map(e=>({value:e.UserId,label:`${e.UserName} (${e.Email})`}));ya.select("Select a reviewer for this policy deactivation request:","Select Reviewer",a,async t=>{console.log("Selected reviewer ID:",t),ya.comment("Please provide a reason for deactivating this policy:","Policy Deactivation Reason",async i=>{if(!i||""===i.trim())return ya.warning("Deactivation reason is required.","Missing Information"),void g({title:"Missing Deactivation Reason",message:"Policy deactivation request cancelled: Reason is required.",category:"policy",priority:"medium",user_id:"default_user"});try{await He.A.post(`/api/policies/${e.id}/toggle-status/`,{reason:i.trim(),ReviewerId:t,cascadeSubpolicies:!0}),ya.success("Policy deactivation request submitted. Awaiting approval.","Request Submitted"),g({title:"Policy Deactivation Request Submitted",message:`Policy "${e.name}" deactivation request has been submitted and is awaiting approval.`,category:"policy",priority:"high",user_id:"default_user"}),await f()}catch(a){console.error("Error submitting deactivation request:",a),ya.error("Failed to submit deactivation request. Please try again.","Request Failed"),g({title:"Policy Deactivation Request Failed",message:`Failed to submit deactivation request for policy "${e.name}": ${a.response?.data?.error||a.message}`,category:"policy",priority:"high",user_id:"default_user"})}})})}catch(t){console.error("Error fetching reviewers:",t),ya.error("Failed to load reviewers. Please try again.","Load Error"),g({title:"Reviewers Loading Failed",message:`Failed to load reviewers for policy deactivation: ${t.response?.data?.error||t.message}`,category:"policy",priority:"high",user_id:"default_user"})}else{const t=await He.A.post(`/api/policies/${e.id}/toggle-status/`,{cascadeSubpolicies:!0});e.status=t.data.status||"Active";let i="Policy status change request submitted.";t.data.other_versions_deactivated>0&&(i+=` ${t.data.other_versions_deactivated} previous version(s) of this policy were automatically deactivated.`),t.data.subpolicies_affected>0&&(i+=` ${t.data.subpolicies_affected} subpolicies were also activated.`),ya.success(i,"Status Update"),g({title:"Policy Activation Successful",message:`Policy "${e.name}" has been successfully activated.`,category:"policy",priority:"high",user_id:"default_user"}),await f()}}catch(t){console.error("Error toggling policy status:",t),ya.error("Failed to update policy status. Please try again.","Update Failed"),g({title:"Policy Status Update Failed",message:`Failed to update status for policy "${e.name}": ${t.response?.data?.error||t.message}`,category:"policy",priority:"high",user_id:"default_user"})}},R=async e=>{try{const t=await He.A.post(`/api/acknowledge-policy/${e.id}/`);e.isAcknowledged=!0,ya.success(t.data.message,"Policy Acknowledged"),g({title:"Policy Acknowledged",message:`Policy "${e.name}" has been successfully acknowledged.`,category:"policy",priority:"medium",user_id:"default_user"})}catch(t){console.error("Error acknowledging policy:",t),ya.error("Failed to acknowledge policy. Please try again.","Acknowledgment Failed"),g({title:"Policy Acknowledgment Failed",message:`Failed to acknowledge policy "${e.name}": ${t.response?.data?.error||t.message}`,category:"policy",priority:"medium",user_id:"default_user"})}};function I(){const e={name:"FrameworkExplorer"};c.value&&(e.query={entity:c.value}),t.push(e)}(0,s.sV)(()=>{f(),b();const e=i.query.entity;e&&(c.value=e)});const D=(0,s.EW)(()=>({label:"Entity",values:[{value:"",label:"All Entities"},...u.value.map(e=>({value:e.id,label:e.label}))]}));return(e,t)=>((0,s.uX)(),(0,s.CE)("div",Cg,[(0,s.Lk)("div",Lg,[(0,s.Lk)("span",wg,[(0,s.eW)((0,d.v_)(l.value)+" ",1),(0,s.Lk)("span",{class:"breadcrumb-close",onClick:I},"×")])]),(0,s.Lk)("h2",null,"Policies for "+(0,d.v_)(l.value),1),(0,s.Lk)("div",Eg,[(0,s.Lk)("div",Rg,[(0,s.bF)(xa.A,{config:D.value,modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),"show-search-bar":!0},null,8,["config","modelValue"])])]),(0,s.Lk)("div",Ig,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"policy-card"},[(0,s.Lk)("div",Dg,[(0,s.Lk)("div",Pg,[t[3]||(t[3]=(0,s.Lk)("span",{class:"policy-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("span",_g,(0,d.v_)(e.name),1)])]),(0,s.Lk)("div",Ag,[(0,s.Lk)("span",Sg,"Category: "+(0,d.v_)(e.category),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-card-type","External"===e.type?"external":""])}," Type: "+(0,d.v_)(e.type||"External"),3)]),(0,s.Lk)("div",Tg,(0,d.v_)(e.description),1),(0,s.Lk)("div",xg,[(0,s.Lk)("div",Fg,[(0,s.Lk)("label",{class:"switch",onClick:t[1]||(t[1]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("input",{type:"checkbox",checked:"Active"===e.status,onChange:t=>E(e)},null,40,Vg),t[4]||(t[4]=(0,s.Lk)("span",{class:"slider"},null,-1))]),"Active"===e.status?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>R(e),class:(0,d.C4)(["acknowledge-btn",{acknowledged:e.isAcknowledged}])},(0,d.v_)(e.isAcknowledged?"Acknowledged":"Acknowledge"),11,Ug)):(0,s.Q3)("",!0),(0,s.Lk)("span",{class:"document-icon",onClick:t=>L(e.id)},t[5]||(t[5]=[(0,s.Lk)("i",{class:"fas fa-file-lines"},null,-1)]),8,Ng)])])]))),128))]),v.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:w},[(0,s.Lk)("div",{class:"modal-content",onClick:t[2]||(t[2]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:"modal-header"},[t[6]||(t[6]=(0,s.Lk)("h3",null,"Policy Details",-1)),(0,s.Lk)("span",{class:"close-btn",onClick:w},"×")]),k.value?((0,s.uX)(),(0,s.CE)("div",Mg,t[7]||(t[7]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading details... ")]))):h.value?((0,s.uX)(),(0,s.CE)("div",Xg,[(0,s.Lk)("div",$g,[t[8]||(t[8]=(0,s.Lk)("span",{class:"detail-label"},"Policy Name:",-1)),(0,s.Lk)("span",Og,(0,d.v_)(h.value.PolicyName),1)]),(0,s.Lk)("div",jg,[t[9]||(t[9]=(0,s.Lk)("span",{class:"detail-label"},"Description:",-1)),(0,s.Lk)("span",Bg,(0,d.v_)(h.value.PolicyDescription),1)]),(0,s.Lk)("div",Wg,[t[10]||(t[10]=(0,s.Lk)("span",{class:"detail-label"},"Department:",-1)),(0,s.Lk)("span",qg,(0,d.v_)(h.value.Department),1)]),(0,s.Lk)("div",Qg,[t[11]||(t[11]=(0,s.Lk)("span",{class:"detail-label"},"Version:",-1)),(0,s.Lk)("span",Kg,(0,d.v_)(h.value.CurrentVersion),1)]),(0,s.Lk)("div",Jg,[t[12]||(t[12]=(0,s.Lk)("span",{class:"detail-label"},"Status:",-1)),(0,s.Lk)("span",zg,(0,d.v_)(h.value.Status),1)]),(0,s.Lk)("div",Hg,[t[13]||(t[13]=(0,s.Lk)("span",{class:"detail-label"},"Active/Inactive:",-1)),(0,s.Lk)("span",Gg,(0,d.v_)(h.value.ActiveInactive),1)]),(0,s.Lk)("div",Yg,[t[14]||(t[14]=(0,s.Lk)("span",{class:"detail-label"},"Identifier:",-1)),(0,s.Lk)("span",Zg,(0,d.v_)(h.value.Identifier),1)]),(0,s.Lk)("div",ey,[t[15]||(t[15]=(0,s.Lk)("span",{class:"detail-label"},"Start Date:",-1)),(0,s.Lk)("span",ty,(0,d.v_)(y(h.value.StartDate)),1)]),(0,s.Lk)("div",iy,[t[16]||(t[16]=(0,s.Lk)("span",{class:"detail-label"},"End Date:",-1)),(0,s.Lk)("span",ay,(0,d.v_)(y(h.value.EndDate)),1)]),(0,s.Lk)("div",sy,[t[17]||(t[17]=(0,s.Lk)("span",{class:"detail-label"},"Created By:",-1)),(0,s.Lk)("span",oy,(0,d.v_)(h.value.CreatedByName),1)]),(0,s.Lk)("div",ly,[t[18]||(t[18]=(0,s.Lk)("span",{class:"detail-label"},"Created Date:",-1)),(0,s.Lk)("span",ny,(0,d.v_)(y(h.value.CreatedByDate)),1)]),(0,s.Lk)("div",ry,[t[19]||(t[19]=(0,s.Lk)("span",{class:"detail-label"},"Applicability:",-1)),(0,s.Lk)("span",cy,(0,d.v_)(h.value.Applicability),1)]),(0,s.Lk)("div",dy,[t[20]||(t[20]=(0,s.Lk)("span",{class:"detail-label"},"Scope:",-1)),(0,s.Lk)("span",uy,(0,d.v_)(h.value.Scope),1)]),(0,s.Lk)("div",py,[t[21]||(t[21]=(0,s.Lk)("span",{class:"detail-label"},"Objective:",-1)),(0,s.Lk)("span",my,(0,d.v_)(h.value.Objective),1)]),h.value.DocURL?((0,s.uX)(),(0,s.CE)("div",vy,[t[22]||(t[22]=(0,s.Lk)("span",{class:"detail-label"},"Documentation:",-1)),(0,s.Lk)("a",{href:h.value.DocURL,target:"_blank",class:"doc-link"},"View Documentation",8,ky)])):(0,s.Q3)("",!0),h.value.subpolicies&&h.value.subpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",hy,[t[26]||(t[26]=(0,s.Lk)("h4",null,"Subpolicies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value.subpolicies,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"subpolicy-item"},[(0,s.Lk)("div",gy,[(0,s.Lk)("span",yy,(0,d.v_)(e.SubPolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["subpolicy-status",e.Status.toLowerCase()])},(0,d.v_)(e.Status),3)]),(0,s.Lk)("div",fy,[t[23]||(t[23]=(0,s.Lk)("span",{class:"subpolicy-label"},"Identifier:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.Identifier),1)]),(0,s.Lk)("div",by,[t[24]||(t[24]=(0,s.Lk)("span",{class:"subpolicy-label"},"Description:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.Description),1)]),(0,s.Lk)("div",Cy,[t[25]||(t[25]=(0,s.Lk)("span",{class:"subpolicy-label"},"Control:",-1)),(0,s.Lk)("span",null,(0,d.v_)(e.Control),1)])]))),128))])):((0,s.uX)(),(0,s.CE)("div",Ly," No subpolicies found for this policy. "))])):((0,s.uX)(),(0,s.CE)("div",wy," Failed to load policy details. "))])])):(0,s.Q3)("",!0),(0,s.bF)(Ta)]))}};const Ry=(0,le.A)(Ey,[["__scopeId","data-v-19c81540"]]);var Iy=Ry;const Dy={class:"Policy-kpi-kpi-dashboard"},Py={class:"Policy-kpi-dashboard-header"},_y={key:0,class:"Policy-kpi-loading-state"},Ay={key:1,class:"Policy-kpi-error-state"},Sy={key:2,class:"Policy-kpi-dashboard-content"},Ty={class:"Policy-kpi-kpi-section"},xy={class:"Policy-kpi-kpi-row"},Fy={class:"Policy-kpi-kpi-card"},Vy={class:"Policy-kpi-kpi-body"},Uy={class:"Policy-kpi-kpi-visualization"},Ny={class:"Policy-kpi-circular-progress-inner"},My={class:"Policy-kpi-kpi-value"},Xy={class:"Policy-kpi-kpi-details"},$y={class:"Policy-kpi-detail-item"},Oy={class:"Policy-kpi-detail-value"},jy={class:"Policy-kpi-detail-item"},By={class:"Policy-kpi-detail-value"},Wy={class:"Policy-kpi-trend-section"},qy={class:"Policy-kpi-trend-header"},Qy={class:"Policy-kpi-detail-item Policy-kpi-status-breakdown"},Ky={class:"Policy-kpi-status-row"},Jy={class:"Policy-kpi-status-value"},zy={class:"Policy-kpi-status-row"},Hy={class:"Policy-kpi-status-value"},Gy={class:"Policy-kpi-kpi-card"},Yy={class:"Policy-kpi-kpi-body"},Zy={class:"Policy-kpi-acknowledgement-table"},ef={class:"Policy-kpi-table-body"},tf={class:"Policy-kpi-policy-info"},af={class:"Policy-kpi-policy-name"},sf={class:"Policy-kpi-policy-stats"},of={class:"Policy-kpi-acknowledged-count"},lf={class:"Policy-kpi-total-users"},nf={class:"Policy-kpi-progress-container"},rf={class:"Policy-kpi-progress-bar"},cf={class:"Policy-kpi-progress-text"},df={key:1,class:"Policy-kpi-no-data"},uf={class:"Policy-kpi-kpi-card"},pf={class:"Policy-kpi-kpi-body"},mf={class:"Policy-kpi-coverage-container"},vf={class:"Policy-kpi-coverage-overview"},kf={class:"Policy-kpi-overall-coverage"},hf={class:"Policy-kpi-overall-value"},gf={class:"Policy-kpi-coverage-bars"},yf={class:"Policy-kpi-bar-header"},ff={class:"Policy-kpi-department-name"},bf={class:"Policy-kpi-department-value"},Cf={class:"Policy-kpi-bar-container"},Lf={class:"Policy-kpi-department-policies"},wf={class:"Policy-kpi-kpi-row"},Ef={class:"Policy-kpi-kpi-card"},Rf={class:"Policy-kpi-kpi-body"},If={class:"Policy-kpi-kpi-visualization"},Df={class:"Policy-kpi-donut-chart-container"},Pf={ref:"revisionDonutChart"},_f={class:"Policy-kpi-donut-center-text"},Af={class:"Policy-kpi-kpi-value"},Sf={class:"Policy-kpi-kpi-details"},Tf={class:"Policy-kpi-detail-item"},xf={class:"Policy-kpi-detail-value"},Ff={class:"Policy-kpi-detail-item"},Vf={class:"Policy-kpi-detail-value"},Uf={class:"Policy-kpi-detail-item"},Nf={class:"Policy-kpi-detail-value"},Mf={class:"Policy-kpi-kpi-card"},Xf={class:"Policy-kpi-kpi-body"},$f={class:"Policy-kpi-kpi-visualization"},Of={class:"Policy-kpi-approval-time-chart-container"},jf={ref:"approvalTimeChart"},Bf={class:"Policy-kpi-kpi-details"},Wf={class:"Policy-kpi-detail-item"},qf={class:"Policy-kpi-detail-value"},Qf={class:"Policy-kpi-trend-section"},Kf={class:"Policy-kpi-trend-header"},Jf={class:"Policy-kpi-kpi-card"},zf={class:"Policy-kpi-kpi-body"},Hf={class:"Policy-kpi-compliance-container"},Gf={class:"Policy-kpi-policy-selector"},Yf=["value"],Zf={key:0,class:"Policy-kpi-compliance-loading"},eb={key:1,class:"Policy-kpi-compliance-error"},tb={key:2,class:"Policy-kpi-compliance-content"},ib={class:"Policy-kpi-compliance-overview"},ab={class:"Policy-kpi-policy-name"},sb={class:"Policy-kpi-total-items"},ob={class:"Policy-kpi-compliance-chart"},lb={class:"Policy-kpi-simple-bar-chart"},nb={class:"Policy-kpi-horizontal-bars"},rb={class:"Policy-kpi-chart-bar"},cb={class:"Policy-kpi-bar-info"},db={class:"Policy-kpi-bar-percentage"},ub={class:"Policy-kpi-bar-track"},pb={class:"Policy-kpi-chart-bar"},mb={class:"Policy-kpi-bar-info"},vb={class:"Policy-kpi-bar-percentage"},kb={class:"Policy-kpi-bar-track"},hb={class:"Policy-kpi-chart-bar"},gb={class:"Policy-kpi-bar-info"},yb={class:"Policy-kpi-bar-percentage"},fb={class:"Policy-kpi-bar-track"},bb={key:3,class:"Policy-kpi-no-policy-selected"},Cb={key:3,class:"Policy-kpi-modal"},Lb={class:"Policy-kpi-modal-content"},wb={class:"Policy-kpi-modal-header"},Eb={class:"Policy-kpi-modal-body"},Rb={class:"Policy-kpi-revised-policies-stats"},Ib={class:"Policy-kpi-stat-item"},Db={class:"Policy-kpi-stat-value"},Pb={class:"Policy-kpi-stat-item"},_b={class:"Policy-kpi-stat-value"};function Ab(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Dy,[(0,s.Lk)("div",Py,[t[7]||(t[7]=(0,s.Lk)("h1",null,"Policy KPI Dashboard",-1)),(0,s.Lk)("button",{class:(0,d.C4)(["Policy-kpi-refresh-button",{"Policy-kpi-loading":o.loading}]),onClick:t[0]||(t[0]=(...e)=>o.fetchKPIData&&o.fetchKPIData(...e))},t[6]||(t[6]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1),(0,s.eW)(" Refresh ")]),2)]),o.loading?((0,s.uX)(),(0,s.CE)("div",_y,t[8]||(t[8]=[(0,s.Lk)("div",{class:"Policy-kpi-loader"},null,-1),(0,s.Lk)("p",null,"Loading KPI data...",-1)]))):o.error?((0,s.uX)(),(0,s.CE)("div",Ay,[t[10]||(t[10]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("p",null,(0,d.v_)(o.error),1),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>o.fetchKPIData&&o.fetchKPIData(...e)),class:"Policy-kpi-retry-button"},t[9]||(t[9]=[(0,s.Lk)("i",{class:"fas fa-redo"},null,-1),(0,s.eW)(" Retry ")]))])):((0,s.uX)(),(0,s.CE)("div",Sy,[(0,s.Lk)("div",Ty,[(0,s.Lk)("div",xy,[(0,s.Lk)("div",Fy,[t[19]||(t[19]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})]),(0,s.Lk)("h3",null,"Active Policies")],-1)),(0,s.Lk)("div",Vy,[(0,s.Lk)("div",Uy,[(0,s.Lk)("div",{class:"Policy-kpi-circular-progress",style:(0,d.Tr)({"--progress-color":o.getProgressColor,"--progress-value":3.6*o.progressPercentage+"deg"})},[(0,s.Lk)("div",Ny,[(0,s.Lk)("div",My,(0,d.v_)(o.kpiData.active_policies||0),1),t[11]||(t[11]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-label"},"Active",-1))])],4),(0,s.Lk)("div",Xy,[(0,s.Lk)("div",$y,[t[12]||(t[12]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Total Policies"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Total number of policies in the system"})],-1)),(0,s.Lk)("span",Oy,(0,d.v_)(o.kpiData.total_policies||0),1)]),(0,s.Lk)("div",jy,[t[13]||(t[13]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Active Rate"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Percentage of total policies that are currently active"})],-1)),(0,s.Lk)("span",By,(0,d.v_)(o.getUtilizationRate)+"%",1)]),(0,s.Lk)("div",Wy,[(0,s.Lk)("div",qy,[t[14]||(t[14]=(0,s.Lk)("span",{class:"Policy-kpi-trend-label"},"12 Month Trend",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["Policy-kpi-trend-indicator",o.trendDirection])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas","up"===o.trendDirection?"fa-arrow-up":"down"===o.trendDirection?"fa-arrow-down":"fa-minus"])},null,2)],2)]),t[15]||(t[15]=(0,s.Lk)("div",{class:"Policy-kpi-sparkline-container"},[(0,s.Lk)("canvas",{id:"trendChart"})],-1))]),(0,s.Lk)("div",Qy,[t[18]||(t[18]=(0,s.Lk)("div",{class:"Policy-kpi-status-title"},"Status Breakdown",-1)),(0,s.Lk)("div",Ky,[t[16]||(t[16]=(0,s.Lk)("span",{class:"Policy-kpi-status-label"},[(0,s.Lk)("span",{class:"Policy-kpi-status-dot Policy-kpi-active"}),(0,s.eW)(" Active ")],-1)),(0,s.Lk)("span",Jy,(0,d.v_)(o.kpiData.active_policies||0),1)]),(0,s.Lk)("div",zy,[t[17]||(t[17]=(0,s.Lk)("span",{class:"Policy-kpi-status-label"},[(0,s.Lk)("span",{class:"Policy-kpi-status-dot Policy-kpi-inactive"}),(0,s.eW)(" Inactive ")],-1)),(0,s.Lk)("span",Hy,(0,d.v_)(o.getInactivePolicies),1)])])])])])]),(0,s.Lk)("div",Gy,[t[21]||(t[21]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})]),(0,s.Lk)("h3",null,"Policy Acknowledgement Rate")],-1)),(0,s.Lk)("div",Yy,[(0,s.Lk)("div",Zy,[t[20]||(t[20]=(0,s.Lk)("div",{class:"Policy-kpi-table-header"},[(0,s.Lk)("span",null,"Policy Name"),(0,s.Lk)("span",null,"Acknowledgement Rate")],-1)),(0,s.Lk)("div",ef,[o.kpiData.top_acknowledged_policies?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.kpiData.top_acknowledged_policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.policy_id,class:"Policy-kpi-table-row"},[(0,s.Lk)("div",tf,[(0,s.Lk)("span",af,(0,d.v_)(e.policy_name),1),(0,s.Lk)("div",sf,[(0,s.Lk)("span",of,(0,d.v_)(e.acknowledged_count),1),(0,s.Lk)("span",lf,"/ "+(0,d.v_)(e.total_users),1)])]),(0,s.Lk)("div",nf,[(0,s.Lk)("div",rf,[(0,s.Lk)("div",{class:(0,d.C4)(["Policy-kpi-progress-fill",o.getAcknowledgementClass(e.acknowledgement_rate)]),style:(0,d.Tr)({width:e.acknowledgement_rate+"%"})},null,6)]),(0,s.Lk)("span",cf,(0,d.v_)(e.acknowledgement_rate)+"%",1)])]))),128)):((0,s.uX)(),(0,s.CE)("div",df," No acknowledgement data available "))])])])]),(0,s.Lk)("div",uf,[t[24]||(t[24]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-chart-bar"})]),(0,s.Lk)("h3",null,"Policy Coverage Rate")],-1)),(0,s.Lk)("div",pf,[(0,s.Lk)("div",mf,[(0,s.Lk)("div",vf,[(0,s.Lk)("div",kf,[t[22]||(t[22]=(0,s.Lk)("div",{class:"Policy-kpi-overall-label"},"Average Coverage",-1)),(0,s.Lk)("div",hf,(0,d.v_)(o.kpiData.coverage_metrics?.overall_coverage_rate||0)+"%",1)])]),(0,s.Lk)("div",gf,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.coverage_metrics?.department_coverage||[],e=>((0,s.uX)(),(0,s.CE)("div",{key:e.department,class:"Policy-kpi-coverage-bar-row"},[(0,s.Lk)("div",yf,[(0,s.Lk)("span",ff,(0,d.v_)(e.department),1),(0,s.Lk)("span",bf,(0,d.v_)(e.coverage_rate)+"%",1)]),(0,s.Lk)("div",Cf,[t[23]||(t[23]=(0,s.Lk)("div",{class:"Policy-kpi-bar-background"},null,-1)),(0,s.Lk)("div",{class:"Policy-kpi-bar-fill",style:(0,d.Tr)({width:e.coverage_rate+"%",backgroundColor:o.getCoverageColor(e.coverage_rate)})},null,4)]),(0,s.Lk)("div",Lf,(0,d.v_)(e.total_policies)+" policies",1)]))),128))])])])])]),(0,s.Lk)("div",wf,[(0,s.Lk)("div",Ef,[t[30]||(t[30]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-sync"})]),(0,s.Lk)("h3",null,"Policy Revision Rate")],-1)),(0,s.Lk)("div",Rf,[(0,s.Lk)("div",If,[(0,s.Lk)("div",Df,[(0,s.Lk)("canvas",Pf,null,512),(0,s.Lk)("div",_f,[(0,s.Lk)("div",Af,(0,d.v_)((o.kpiData.revision_rate||0).toFixed(2))+"%",1),t[25]||(t[25]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-label"},"Revised",-1))])]),(0,s.Lk)("div",Sf,[(0,s.Lk)("div",Tf,[t[26]||(t[26]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Revised Policies"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Number of policies that have been revised"})],-1)),(0,s.Lk)("span",xf,(0,d.v_)(o.kpiData.revised_policies||0),1)]),(0,s.Lk)("div",Ff,[t[27]||(t[27]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Unchanged Policies"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Number of policies that have not been revised"})],-1)),(0,s.Lk)("span",Vf,(0,d.v_)(o.unchangedPolicies),1)]),(0,s.Lk)("div",Uf,[t[28]||(t[28]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Time Period"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Time period for revision rate calculation"})],-1)),(0,s.Lk)("span",Nf,(0,d.v_)(o.kpiData.measurement_period||"Last Quarter"),1)]),o.kpiData.revised_policies>0?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t[2]||(t[2]=e=>o.showRevisedPolicies=!0),class:"Policy-kpi-drill-down-button"},t[29]||(t[29]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View Revised Policies ")]))):(0,s.Q3)("",!0)])])])]),(0,s.Lk)("div",Mf,[t[34]||(t[34]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})]),(0,s.Lk)("h3",null,"Average Policy Approval Time")],-1)),(0,s.Lk)("div",Xf,[(0,s.Lk)("div",$f,[(0,s.Lk)("div",Of,[(0,s.Lk)("canvas",jf,null,512)]),(0,s.Lk)("div",Bf,[(0,s.Lk)("div",Wf,[t[31]||(t[31]=(0,s.Lk)("div",{class:"Policy-kpi-detail-info"},[(0,s.Lk)("span",{class:"Policy-kpi-detail-label"},"Overall Average"),(0,s.Lk)("i",{class:"fas fa-info-circle Policy-kpi-info-icon",title:"Average time taken to approve policies"})],-1)),(0,s.Lk)("span",qf,(0,d.v_)(o.kpiData.approval_time_metrics?.overall_average||0)+" days",1)]),t[33]||(t[33]=(0,s.Fv)('<div class="Policy-kpi-detail-item" data-v-0138cb69><div class="Policy-kpi-detail-info" data-v-0138cb69><span class="Policy-kpi-detail-label" data-v-0138cb69>Measurement Period</span><i class="fas fa-info-circle Policy-kpi-info-icon" title="Time period for approval time calculation" data-v-0138cb69></i></div><span class="Policy-kpi-detail-value" data-v-0138cb69>Last 12 Months</span></div>',1)),(0,s.Lk)("div",Qf,[(0,s.Lk)("div",Kf,[t[32]||(t[32]=(0,s.Lk)("span",{class:"Policy-kpi-trend-label"},"Monthly Trend",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["Policy-kpi-trend-indicator",o.approvalTimeTrendDirection])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas","up"===o.approvalTimeTrendDirection?"fa-arrow-up":"down"===o.approvalTimeTrendDirection?"fa-arrow-down":"fa-minus"])},null,2)],2)])])])])])]),(0,s.Lk)("div",Jf,[t[44]||(t[44]=(0,s.Lk)("div",{class:"Policy-kpi-kpi-header"},[(0,s.Lk)("div",{class:"Policy-kpi-kpi-icon"},[(0,s.Lk)("i",{class:"fas fa-tasks"})]),(0,s.Lk)("h3",null,"Policy Compliance Status")],-1)),(0,s.Lk)("div",zf,[(0,s.Lk)("div",Hf,[(0,s.Lk)("div",Gf,[t[36]||(t[36]=(0,s.Lk)("label",{for:"policySelect"},"Select Policy:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.selectedPolicyId=e),onChange:t[4]||(t[4]=(...e)=>o.fetchComplianceData&&o.fetchComplianceData(...e)),id:"policySelect",class:"Policy-kpi-policy-dropdown"},[t[35]||(t[35]=(0,s.Lk)("option",{value:""},"-- Select a Policy --",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.availablePolicies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.PolicyId,value:e.PolicyId},(0,d.v_)(e.PolicyName),9,Yf))),128))],544),[[a.u1,o.selectedPolicyId]])]),o.complianceLoading?((0,s.uX)(),(0,s.CE)("div",Zf,t[37]||(t[37]=[(0,s.Lk)("div",{class:"Policy-kpi-small-loader"},null,-1),(0,s.Lk)("p",null,"Loading compliance data...",-1)]))):o.complianceError?((0,s.uX)(),(0,s.CE)("div",eb,[t[38]||(t[38]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("p",null,(0,d.v_)(o.complianceError),1)])):o.complianceData&&o.complianceData.policy_name?((0,s.uX)(),(0,s.CE)("div",tb,[(0,s.Lk)("div",ib,[(0,s.Lk)("div",ab,(0,d.v_)(o.complianceData.policy_name),1),(0,s.Lk)("div",sb,"Total Items: "+(0,d.v_)(o.complianceData.total_compliance_items),1)]),(0,s.Lk)("div",ob,[(0,s.Lk)("div",lb,[t[42]||(t[42]=(0,s.Lk)("div",{class:"Policy-kpi-chart-title"},"Compliance Distribution",-1)),(0,s.Lk)("div",nb,[(0,s.Lk)("div",rb,[(0,s.Lk)("div",cb,[t[39]||(t[39]=(0,s.Lk)("span",{class:"Policy-kpi-bar-name"},"✓ Fully Complied",-1)),(0,s.Lk)("span",db,(0,d.v_)(o.complianceData.compliance_stats?.fully_complied?.count||0)+" ("+(0,d.v_)(o.complianceData.compliance_stats?.fully_complied?.percentage||0)+"%)",1)]),(0,s.Lk)("div",ub,[(0,s.Lk)("div",{class:"Policy-kpi-bar-progress Policy-kpi-green",style:(0,d.Tr)({width:(o.complianceData.compliance_stats?.fully_complied?.percentage||0)+"%"})},null,4)])]),(0,s.Lk)("div",pb,[(0,s.Lk)("div",mb,[t[40]||(t[40]=(0,s.Lk)("span",{class:"Policy-kpi-bar-name"},"△ Partially Complied",-1)),(0,s.Lk)("span",vb,(0,d.v_)(o.complianceData.compliance_stats?.partially_complied?.count||0)+" ("+(0,d.v_)(o.complianceData.compliance_stats?.partially_complied?.percentage||0)+"%)",1)]),(0,s.Lk)("div",kb,[(0,s.Lk)("div",{class:"Policy-kpi-bar-progress Policy-kpi-orange",style:(0,d.Tr)({width:(o.complianceData.compliance_stats?.partially_complied?.percentage||0)+"%"})},null,4)])]),(0,s.Lk)("div",hb,[(0,s.Lk)("div",gb,[t[41]||(t[41]=(0,s.Lk)("span",{class:"Policy-kpi-bar-name"},"✗ Not Complied",-1)),(0,s.Lk)("span",yb,(0,d.v_)(o.complianceData.compliance_stats?.not_complied?.count||0)+" ("+(0,d.v_)(o.complianceData.compliance_stats?.not_complied?.percentage||0)+"%)",1)]),(0,s.Lk)("div",fb,[(0,s.Lk)("div",{class:"Policy-kpi-bar-progress Policy-kpi-red",style:(0,d.Tr)({width:(o.complianceData.compliance_stats?.not_complied?.percentage||0)+"%"})},null,4)])])])])])])):((0,s.uX)(),(0,s.CE)("div",bb,t[43]||(t[43]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.Lk)("p",null,"Please select a policy to view compliance statistics",-1)])))])])])])])])),o.showRevisedPolicies?((0,s.uX)(),(0,s.CE)("div",Cb,[(0,s.Lk)("div",Lb,[(0,s.Lk)("div",wb,[t[46]||(t[46]=(0,s.Lk)("h2",null,"Revised Policies",-1)),(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>o.showRevisedPolicies=!1),class:"Policy-kpi-close-button"},t[45]||(t[45]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",Eb,[(0,s.Lk)("div",Rb,[(0,s.Lk)("div",Ib,[t[47]||(t[47]=(0,s.Lk)("span",{class:"Policy-kpi-stat-label"},"Total Revisions:",-1)),(0,s.Lk)("span",Db,(0,d.v_)(o.kpiData.total_revisions),1)]),(0,s.Lk)("div",Pb,[t[48]||(t[48]=(0,s.Lk)("span",{class:"Policy-kpi-stat-label"},"Policies with Multiple Revisions:",-1)),(0,s.Lk)("span",_b,(0,d.v_)(o.kpiData.policies_with_multiple_revisions),1)])])])])])):(0,s.Q3)("",!0)])}var Sb=i(6591),Tb={name:"KPIDashboard",setup(){const e=(0,ie.KR)({}),t=(0,ie.KR)(!0),i=(0,ie.KR)(null),a=(0,ie.KR)(null),o=(0,ie.KR)(null),l=(0,ie.KR)(null),n=(0,ie.KR)(!1),r=(0,ie.KR)(null),c=(0,ie.KR)(""),d=(0,ie.KR)([]),u=(0,ie.KR)({}),p=(0,ie.KR)(!1),m=(0,ie.KR)(null),v=(0,s.EW)(()=>e.value.total_policies?Math.min(e.value.active_policies/e.value.total_policies*100,100):0),k=(0,s.EW)(()=>e.value.total_policies?Math.round(e.value.active_policies/e.value.total_policies*100):0),h=(0,s.EW)(()=>e.value.total_policies?e.value.total_policies-(e.value.active_policies||0):0),g=(0,s.EW)(()=>{const t=e.value.revision_rate||0;return t>66?"#66BB6A":t>33?"#FFA726":"#2196F3"}),y=e=>e>=80?"high":e>=50?"medium":"low",f=(0,s.EW)(()=>e.value.total_policies&&e.value.revised_policies?e.value.total_policies-e.value.revised_policies:0),b=e=>e>=90?"#66BB6A":e>=70?"#FFA726":"#EF5350",C=e=>{const t=e||0;return 0===t?"0%":Math.max(t,5)+"%"},L=(0,s.EW)(()=>{if(!e.value?.approval_time_metrics?.monthly_averages)return"neutral";const t=e.value.approval_time_metrics.monthly_averages;if(t.length<2)return"neutral";const i=t[0].average_time,a=t[t.length-1].average_time;return a>i?"up":a<i?"down":"neutral"}),w=async()=>{if(await(0,s.dY)(),o.value){a.value&&a.value.destroy();try{const t=o.value.getContext("2d");a.value=new Sb.Ay(t,{type:"doughnut",data:{labels:["Revised","Unchanged"],datasets:[{data:[e.value.revised_policies||0,f.value],backgroundColor:["#2196F3","#e9ecef"],borderWidth:0,borderRadius:3}]},options:{responsive:!0,maintainAspectRatio:!1,cutout:"75%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:function(t){const i=t.label||"",a=t.raw||0,s=e.value.total_policies||0,o=(a/s*100).toFixed(1);return`${i}: ${a} (${o}%)`}}}}}})}catch(t){console.error("Error creating chart:",t)}}else console.warn("Canvas element not found")},E=async()=>{await(0,s.dY)();const t=document.querySelector(".Policy-kpi-approval-time-chart-container canvas");if(!t)return;r.value instanceof Sb.Ay&&r.value.destroy();const i=e.value?.approval_time_metrics?.monthly_averages||[];try{r.value=new Sb.Ay(t,{type:"line",data:{labels:i.map(e=>e.month),datasets:[{label:"Average Approval Time (days)",data:i.map(e=>e.average_time),borderColor:"#2196F3",backgroundColor:"rgba(33, 150, 243, 0.1)",borderWidth:2,tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{title:e=>e[0].label,label:e=>`Average Time: ${e.raw} days`}}},scales:{x:{grid:{display:!1}},y:{beginAtZero:!0,title:{display:!0,text:"Days"}}}}})}catch(a){console.error("Error creating approval time chart:",a)}};(0,s.wB)([()=>e.value,t],async([e,t])=>{if(!t&&!i.value&&e)try{await Promise.all([w(),E()])}catch(a){console.error("Error updating charts:",a)}},{deep:!0}),(0,s.hi)(()=>{r.value instanceof Sb.Ay&&r.value.destroy(),a.value instanceof Sb.Ay&&a.value.destroy()});const R=async()=>{try{const e=await He.A.get("/api/policies/",{baseURL:"http://localhost:8000",headers:{Accept:"application/json","Content-Type":"application/json"}});e.data&&Array.isArray(e.data)&&(d.value=e.data)}catch(e){console.error("Error fetching policies:",e)}},I=async()=>{if(c.value){p.value=!0,m.value=null;try{const e=await He.A.get(`/api/policies/${c.value}/compliance-stats/`,{baseURL:"http://localhost:8000",headers:{Accept:"application/json","Content-Type":"application/json"}});u.value=e.data}catch(e){console.error("Error fetching compliance data:",e),m.value=e.response?.data?.error||"Failed to load compliance data"}finally{p.value=!1}}else u.value={}},D=async()=>{t.value=!0,i.value=null;try{console.log("Fetching KPI data...");const t=await He.A.get("/api/policy-kpis/",{baseURL:"http://localhost:8000",headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("KPI data received:",t.data),!t.data||"object"!==typeof t.data)throw new Error("Invalid response format");e.value=t.data,await w()}catch(a){console.error("Detailed error:",a.response?.data||a.message),i.value=`Failed to load KPI data: ${a.response?.data?.error||a.message}`}finally{t.value=!1}},P=(0,s.EW)(()=>e.value?.active_policies_trend?e.value.active_policies_trend.map(e=>e.count).reverse():[]),_=(0,s.EW)(()=>e.value?.active_policies_trend?e.value.active_policies_trend.map(e=>e.month).reverse():[]),A=(0,s.EW)(()=>{if(!P.value.length)return"neutral";const e=P.value[0],t=P.value[P.value.length-1];return t>e?"up":t<e?"down":"neutral"}),S=async()=>{await(0,s.dY)(),l.value&&l.value.destroy();const e=document.getElementById("trendChart");e&&(l.value=new Sb.Ay(e,{type:"line",data:{labels:_.value,datasets:[{data:P.value,borderColor:g.value,borderWidth:2,tension:.4,fill:!1,pointRadius:0,pointHoverRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{title:e=>e[0].label,label:e=>`Active Policies: ${e.raw}`}}},scales:{x:{display:!1},y:{display:!1,beginAtZero:!0}}}}))};return(0,s.wB)(()=>e.value,()=>{S()}),(0,s.sV)(async()=>{await Promise.all([D(),R()])}),{kpiData:e,loading:t,error:i,fetchKPIData:D,progressPercentage:v,getProgressColor:g,getUtilizationRate:k,getInactivePolicies:h,unchangedPolicies:f,revisionDonutChart:o,showRevisedPolicies:n,getCoverageColor:b,sparklineData:P,sparklineLabels:_,trendDirection:A,getAcknowledgementClass:y,approvalTimeChart:r,approvalTimeTrendDirection:L,selectedPolicyId:c,availablePolicies:d,complianceData:u,complianceLoading:p,complianceError:m,fetchComplianceData:I,getBarWidth:C}}};const xb=(0,le.A)(Tb,[["render",Ab],["__scopeId","data-v-0138cb69"]]);var Fb=xb;const Vb={class:"dashboard-container"},Ub={class:"dashboard-header"},Nb={class:"dashboard-controls"},Mb={key:0,class:"user-selection-container"},Xb=["value"],$b={class:"dashboard-actions"},Ob={class:"performance-summary"},jb={class:"summary-card growth"},Bb={class:"summary-content"},Wb={class:"summary-value"},qb={class:"summary-card"},Qb={class:"summary-content"},Kb={class:"summary-value"},Jb={class:"summary-card"},zb={class:"summary-content"},Hb={class:"summary-value"},Gb={class:"frameworks-table-container"},Yb={key:0,class:"no-user-selected-message"},Zb={key:1,class:"loading-message"},eC={class:"tab-navigation"},tC={class:"tab-content"},iC={key:0,class:"tab-panel"},aC={key:1,class:"tab-panel"},sC={key:0,class:"framework-details-modal"},oC={class:"framework-details-content"},lC={class:"version-pill"},nC={class:"framework-approval-section"},rC={class:"framework-status-indicator"},cC={key:0,class:"approval-date"},dC={class:"framework-actions"},uC={key:0},pC={key:1,class:"policies-section"},mC={key:0,class:"no-policies-message"},vC={class:"policy-header"},kC={class:"policy-name"},hC={class:"policy-header-actions"},gC={key:0,class:"policy-actions"},yC=["onClick","disabled","title"],fC=["onClick"],bC={class:"policy-details"},CC={key:0,class:"policy-detail-item"},LC={key:1,class:"policy-detail-item"},wC={key:2,class:"policy-detail-item"},EC={key:3,class:"policy-detail-item"},RC={key:4,class:"policy-detail-item"},IC={key:5,class:"policy-detail-item"},DC={key:6,class:"policy-detail-item"},PC={key:7,class:"policy-detail-item"},_C={key:8,class:"policy-detail-item"},AC={key:9,class:"policy-detail-item"},SC={key:10,class:"subpolicies-section"},TC={class:"subpolicies-heading"},xC={class:"subpolicy-header"},FC={class:"subpolicy-name"},VC={key:0,class:"subpolicy-actions"},UC=["onClick","disabled"],NC=["onClick","disabled"],MC={class:"subpolicy-content"},XC={key:0,class:"subpolicy-detail"},$C={key:1,class:"subpolicy-detail"},OC={key:2,class:"subpolicy-detail"},jC={key:11,class:"subpolicies-section"},BC={class:"subpolicies-heading"},WC={class:"subpolicy-header"},qC={class:"subpolicy-name"},QC={key:0,class:"subpolicy-actions"},KC=["onClick","disabled"],JC=["onClick","disabled"],zC={class:"subpolicy-content"},HC={key:0,class:"subpolicy-detail"},GC={key:1,class:"subpolicy-detail"},YC={key:2,class:"subpolicy-detail"},ZC={key:12,class:"no-subpolicies-message"},eL={key:2,class:"rejected-framework-message"},tL={key:0,class:"reject-modal"},iL={class:"reject-modal-content"},aL={class:"reject-modal-actions"},sL={key:1,class:"rejected-approvals-section"},oL={class:"table-container"},lL={class:"frameworks-table"},nL=["onClick"],rL={class:"actions-cell"},cL=["onClick"],dL=["onClick"],uL={key:2,class:"edit-framework-modal"},pL={class:"edit-framework-content"},mL={key:0},vL={class:"rejection-reason"},kL={key:1,class:"edit-policies-section"},hL={class:"form-row"},gL={class:"form-group"},yL=["onUpdate:modelValue"],fL={class:"form-group"},bL=["onUpdate:modelValue"],CL={class:"form-row"},LL={class:"form-group"},wL=["onUpdate:modelValue"],EL={class:"form-group"},RL=["onUpdate:modelValue"],IL={class:"form-row"},DL={class:"form-group"},PL=["onUpdate:modelValue","onChange"],_L=["value"],AL={class:"form-group"},SL=["onUpdate:modelValue","onChange"],TL=["value"],xL={class:"form-row"},FL={class:"form-group"},VL=["onUpdate:modelValue"],UL=["value"],NL={key:0,class:"edit-subpolicies-section"},ML={class:"form-row"},XL={class:"form-group"},$L=["onUpdate:modelValue"],OL={class:"form-group"},jL=["onUpdate:modelValue"],BL={class:"form-row"},WL={class:"form-group"},qL=["onUpdate:modelValue"],QL={class:"form-group"},KL=["onUpdate:modelValue"];function JL(e,t,i,o,l,n){const r=(0,s.g2)("CollapsibleTable"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Vb,[(0,s.Lk)("div",Ub,[t[29]||(t[29]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Framework Approver",-1)),(0,s.Lk)("div",Nb,[l.isGRCAdministrator&&l.userInitialized?((0,s.uX)(),(0,s.CE)("div",Mb,[t[26]||(t[26]=(0,s.Lk)("label",{for:"userSelect",class:"user-select-label"},"Select User:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"userSelect","onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedUserId=e),onChange:t[1]||(t[1]=(...e)=>n.onUserSelectionChange&&n.onUserSelectionChange(...e)),class:"user-select-dropdown"},[t[25]||(t[25]=(0,s.Lk)("option",{value:""},"-- Select a User --",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.availableUsers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName)+" ("+(0,d.v_)(e.Role)+") ",9,Xb))),128))],544),[[a.u1,l.selectedUserId]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",$b,[(0,s.Lk)("button",{class:"action-btn",onClick:t[2]||(t[2]=(...e)=>n.refreshData&&n.refreshData(...e))},t[27]||(t[27]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),t[28]||(t[28]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])])]),(0,s.Lk)("div",Ob,[(0,s.Lk)("div",jb,[t[31]||(t[31]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",Bb,[t[30]||(t[30]=(0,s.Lk)("div",{class:"summary-label"},"Pending Approvals",-1)),(0,s.Lk)("div",Wb,(0,d.v_)(n.pendingApprovalsCount),1)])]),(0,s.Lk)("div",qb,[t[33]||(t[33]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",Qb,[t[32]||(t[32]=(0,s.Lk)("div",{class:"summary-label"},"Approved",-1)),(0,s.Lk)("div",Kb,(0,d.v_)(n.approvedApprovalsCount),1)])]),(0,s.Lk)("div",Jb,[t[35]||(t[35]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",zb,[t[34]||(t[34]=(0,s.Lk)("div",{class:"summary-label"},"Rejected",-1)),(0,s.Lk)("div",Hb,(0,d.v_)(n.rejectedApprovalsCount),1)])])]),(0,s.Lk)("div",Gb,[l.isGRCAdministrator&&!l.selectedUserId&&l.userInitialized?((0,s.uX)(),(0,s.CE)("div",Yb,t[36]||(t[36]=[(0,s.Lk)("div",{class:"info-card"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("h3",null,"Select a User"),(0,s.Lk)("p",null,"Please select a user from the dropdown above to view their framework tasks and reviewer assignments.")],-1)]))):l.userInitialized?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",eC,[(0,s.Lk)("button",{class:(0,d.C4)(["tab-button",{active:"myTasks"===l.activeTab}]),onClick:t[3]||(t[3]=e=>l.activeTab="myTasks")},[t[38]||(t[38]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.eW)(" My Tasks ("+(0,d.v_)(n.myTasksCount)+") ",1)],2),(0,s.Lk)("button",{class:(0,d.C4)(["tab-button",{active:"reviewerTasks"===l.activeTab}]),onClick:t[4]||(t[4]=e=>l.activeTab="reviewerTasks")},[t[39]||(t[39]=(0,s.Lk)("i",{class:"fas fa-clipboard-check"},null,-1)),(0,s.eW)(" Reviewer Tasks ("+(0,d.v_)(n.reviewerTasksCount)+") ",1)],2)]),(0,s.Lk)("div",tC,["myTasks"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",iC,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.myTasksSections,e=>((0,s.uX)(),(0,s.Wv)(r,{key:e.name,"section-config":e,"table-headers":l.tableHeaders,"is-expanded":l.expandedSections[e.name],onToggle:t=>n.toggleSection(e.name),onTaskClick:n.openApprovalDetails},null,8,["section-config","table-headers","is-expanded","onToggle","onTaskClick"]))),128))])):(0,s.Q3)("",!0),"reviewerTasks"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",aC,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.reviewerTasksSections,e=>((0,s.uX)(),(0,s.Wv)(r,{key:e.name,"section-config":e,"table-headers":l.tableHeaders,"is-expanded":l.expandedSections[e.name],onToggle:t=>n.toggleSection(e.name),onTaskClick:n.openApprovalDetails},null,8,["section-config","table-headers","is-expanded","onToggle","onTaskClick"]))),128))])):(0,s.Q3)("",!0)])],64)):((0,s.uX)(),(0,s.CE)("div",Zb,t[37]||(t[37]=[(0,s.Lk)("div",{class:"info-card"},[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"}),(0,s.Lk)("h3",null,"Loading..."),(0,s.Lk)("p",null,"Initializing user permissions and loading framework data...")],-1)])))]),l.showFrameworkDetails&&l.selectedApproval?((0,s.uX)(),(0,s.CE)("div",sC,[(0,s.Lk)("div",oC,[(0,s.Lk)("h3",null,[t[40]||(t[40]=(0,s.Lk)("span",{class:"detail-type-indicator"},"Framework",-1)),(0,s.eW)(" Details: "+(0,d.v_)(n.getFrameworkId(l.selectedApproval))+" ",1),(0,s.Lk)("span",lC,"Version: "+(0,d.v_)(l.selectedApproval.version||"u1"),1)]),(0,s.Lk)("button",{class:"close-btn",onClick:t[5]||(t[5]=(...e)=>n.closeApprovalDetails&&n.closeApprovalDetails(...e))},"Close"),(0,s.Lk)("div",nC,[t[45]||(t[45]=(0,s.Lk)("h4",null,"Framework Approval",-1)),(0,s.Lk)("div",rC,[t[41]||(t[41]=(0,s.Lk)("span",{class:"status-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",{"status-approved":!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status,"status-rejected":!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status,"status-pending":null===l.selectedApproval.ApprovedNot&&"Approved"!==l.selectedApproval.ExtractedData?.Status&&"Rejected"!==l.selectedApproval.ExtractedData?.Status}])},(0,d.v_)(!0===l.selectedApproval.ApprovedNot||"Approved"===l.selectedApproval.ExtractedData?.Status?"Approved":!1===l.selectedApproval.ApprovedNot||"Rejected"===l.selectedApproval.ExtractedData?.Status?"Rejected":"Under Review"),3),l.selectedApproval.ApprovedDate?((0,s.uX)(),(0,s.CE)("span",cC," (Approved on: "+(0,d.v_)(n.formatDate(l.selectedApproval.ApprovedDate))+") ",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",dC,[l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"approve-btn",onClick:t[6]||(t[6]=e=>n.approveFramework())},t[42]||(t[42]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve ")]))):(0,s.Q3)("",!0),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"reject-btn",onClick:t[7]||(t[7]=e=>n.rejectFramework())},t[43]||(t[43]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject ")]))):(0,s.Q3)("",!0),l.isReviewer&&null!==l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"submit-btn",onClick:t[8]||(t[8]=e=>n.submitReview())},t[44]||(t[44]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.eW)(" Submit Review ")]))):(0,s.Q3)("",!0)])]),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",uC,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.ExtractedData,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"framework-detail-row"},["policies"!==i&&"framework_approval"!==i&&"type"!==i&&"totalPolicies"!==i&&"totalSubpolicies"!==i?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("strong",null,(0,d.v_)(n.formatFieldName(i))+":",1),t[46]||(t[46]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(e),1)],64)):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),l.selectedApproval&&l.selectedApproval.ExtractedData&&l.selectedApproval.ExtractedData.policies?((0,s.uX)(),(0,s.CE)("div",pC,[(0,s.Lk)("h4",null,"Framework Policies ("+(0,d.v_)(l.selectedApproval.ExtractedData.policies.length)+")",1),0===l.selectedApproval.ExtractedData.policies.length?((0,s.uX)(),(0,s.CE)("div",mC,t[47]||(t[47]=[(0,s.Lk)("p",null,"No policies found in this framework.",-1)]))):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedApproval.ExtractedData.policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.PolicyId,class:"policy-item"},[(0,s.Lk)("div",vC,[(0,s.Lk)("h5",kC,(0,d.v_)(e.PolicyName||"Unnamed Policy"),1),(0,s.Lk)("div",hC,[(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{"status-approved":"Approved"===e.Status,"status-rejected":"Rejected"===e.Status,"status-pending":"Under Review"===e.Status||!e.Status}])},(0,d.v_)(e.Status||"Under Review"),3),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",gC,[(0,s.Lk)("button",{class:"approve-policy-btn",onClick:t=>n.approvePolicy(e),disabled:!n.canApprovePolicy(e),title:n.canApprovePolicy(e)?"Approve Policy":"All subpolicies must be approved first"},t[48]||(t[48]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]),8,yC),(0,s.Lk)("button",{class:"reject-policy-btn",onClick:t=>n.rejectPolicy(e)},t[49]||(t[49]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,fC)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",bC,[e.PolicyDescription?((0,s.uX)(),(0,s.CE)("div",CC,[t[50]||(t[50]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.PolicyDescription),1)])):(0,s.Q3)("",!0),e.Objective?((0,s.uX)(),(0,s.CE)("div",LC,[t[51]||(t[51]=(0,s.Lk)("strong",null,"Objective:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Objective),1)])):(0,s.Q3)("",!0),e.Scope?((0,s.uX)(),(0,s.CE)("div",wC,[t[52]||(t[52]=(0,s.Lk)("strong",null,"Scope:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Scope),1)])):(0,s.Q3)("",!0),e.Department?((0,s.uX)(),(0,s.CE)("div",EC,[t[53]||(t[53]=(0,s.Lk)("strong",null,"Department:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Department),1)])):(0,s.Q3)("",!0),e.Applicability?((0,s.uX)(),(0,s.CE)("div",RC,[t[54]||(t[54]=(0,s.Lk)("strong",null,"Applicability:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Applicability),1)])):(0,s.Q3)("",!0),e.Identifier?((0,s.uX)(),(0,s.CE)("div",IC,[t[55]||(t[55]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Identifier),1)])):(0,s.Q3)("",!0),e.CoverageRate?((0,s.uX)(),(0,s.CE)("div",DC,[t[56]||(t[56]=(0,s.Lk)("strong",null,"Coverage Rate:",-1)),(0,s.eW)(" "+(0,d.v_)(e.CoverageRate)+"% ",1)])):(0,s.Q3)("",!0),e.PolicyType?((0,s.uX)(),(0,s.CE)("div",PC,[t[57]||(t[57]=(0,s.Lk)("strong",null,"Policy Type:",-1)),(0,s.eW)(" "+(0,d.v_)(e.PolicyType),1)])):(0,s.Q3)("",!0),e.PolicyCategory?((0,s.uX)(),(0,s.CE)("div",_C,[t[58]||(t[58]=(0,s.Lk)("strong",null,"Policy Category:",-1)),(0,s.eW)(" "+(0,d.v_)(e.PolicyCategory),1)])):(0,s.Q3)("",!0),e.PolicySubCategory?((0,s.uX)(),(0,s.CE)("div",AC,[t[59]||(t[59]=(0,s.Lk)("strong",null,"Policy Sub Category:",-1)),(0,s.eW)(" "+(0,d.v_)(e.PolicySubCategory),1)])):(0,s.Q3)("",!0),e.subpolicies&&Array.isArray(e.subpolicies)&&e.subpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",SC,[(0,s.Lk)("h6",TC,[t[60]||(t[60]=(0,s.Lk)("i",{class:"fas fa-list-ul"},null,-1)),(0,s.eW)(" Sub-Policies ("+(0,d.v_)(e.subpolicies.length)+") ",1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,i=>((0,s.uX)(),(0,s.CE)("div",{key:i.SubPolicyId||i.id,class:"subpolicy-item"},[(0,s.Lk)("div",xC,[(0,s.Lk)("div",FC,[(0,s.Lk)("strong",null,(0,d.v_)(i.SubPolicyName||i.name||i.Identifier||"Unnamed Subpolicy"),1)]),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",VC,[(0,s.Lk)("button",{class:(0,d.C4)(["approve-btn",{approved:"Approved"===i.Status}]),onClick:t=>n.approveSubpolicy(e,i),disabled:"Approved"===i.Status},t[61]||(t[61]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]),10,UC),(0,s.Lk)("button",{class:(0,d.C4)(["reject-btn",{rejected:"Rejected"===i.Status}]),onClick:t=>n.rejectSubpolicy(e,i),disabled:"Rejected"===i.Status},t[62]||(t[62]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),10,NC)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",MC,[i.Description?((0,s.uX)(),(0,s.CE)("div",XC,[t[63]||(t[63]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(i.Description),1)])):(0,s.Q3)("",!0),i.Control?((0,s.uX)(),(0,s.CE)("div",$C,[t[64]||(t[64]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(i.Control),1)])):(0,s.Q3)("",!0),i.Identifier?((0,s.uX)(),(0,s.CE)("div",OC,[t[65]||(t[65]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(i.Identifier),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["subpolicy-status",n.getStatusClass(i.Status||"Under Review")])}," Status: "+(0,d.v_)(i.Status||"Under Review"),3)])]))),128))])):e.SubPolicies&&Array.isArray(e.SubPolicies)&&e.SubPolicies.length>0?((0,s.uX)(),(0,s.CE)("div",jC,[(0,s.Lk)("h6",BC,[t[66]||(t[66]=(0,s.Lk)("i",{class:"fas fa-list-ul"},null,-1)),(0,s.eW)(" Sub-Policies ("+(0,d.v_)(e.SubPolicies.length)+") ",1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.SubPolicies,i=>((0,s.uX)(),(0,s.CE)("div",{key:i.SubPolicyId||i.id,class:"subpolicy-item"},[(0,s.Lk)("div",WC,[(0,s.Lk)("div",qC,[(0,s.Lk)("strong",null,(0,d.v_)(i.SubPolicyName||i.name||i.Identifier||"Unnamed Subpolicy"),1)]),l.isReviewer&&null===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",QC,[(0,s.Lk)("button",{class:(0,d.C4)(["approve-btn",{approved:"Approved"===i.Status}]),onClick:t=>n.approveSubpolicy(e,i),disabled:"Approved"===i.Status},t[67]||(t[67]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]),10,KC),(0,s.Lk)("button",{class:(0,d.C4)(["reject-btn",{rejected:"Rejected"===i.Status}]),onClick:t=>n.rejectSubpolicy(e,i),disabled:"Rejected"===i.Status},t[68]||(t[68]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),10,JC)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",zC,[i.Description?((0,s.uX)(),(0,s.CE)("div",HC,[t[69]||(t[69]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(i.Description),1)])):(0,s.Q3)("",!0),i.Control?((0,s.uX)(),(0,s.CE)("div",GC,[t[70]||(t[70]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(i.Control),1)])):(0,s.Q3)("",!0),i.Identifier?((0,s.uX)(),(0,s.CE)("div",YC,[t[71]||(t[71]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(i.Identifier),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["subpolicy-status",n.getStatusClass(i.Status||"Under Review")])}," Status: "+(0,d.v_)(i.Status||"Under Review"),3)])]))),128))])):((0,s.uX)(),(0,s.CE)("div",ZC,t[72]||(t[72]=[(0,s.Lk)("p",null,[(0,s.Lk)("em",null,"No sub-policies found for this policy.")],-1)])))])]))),128))])):(0,s.Q3)("",!0),!1===l.selectedApproval.ApprovedNot?((0,s.uX)(),(0,s.CE)("div",eL,t[73]||(t[73]=[(0,s.Lk)("div",{class:"rejection-note"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" This framework has been rejected. All policies and subpolicies within this framework have been automatically rejected. ")],-1)]))):(0,s.Q3)("",!0)]),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",tL,[(0,s.Lk)("div",iL,[t[74]||(t[74]=(0,s.Lk)("h4",null,"Rejection Reason",-1)),(0,s.Lk)("p",null,"Please provide a reason for rejecting this "+(0,d.v_)(l.currentRejectionType),1),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.rejectionComment=e),class:"rejection-comment",placeholder:"Enter your comments here..."},null,512),[[a.Jo,l.rejectionComment]]),(0,s.Lk)("div",aL,[(0,s.Lk)("button",{class:"cancel-btn",onClick:t[10]||(t[10]=(...e)=>n.cancelRejection&&n.cancelRejection(...e))},"Cancel"),(0,s.Lk)("button",{class:"confirm-btn",onClick:t[11]||(t[11]=(...e)=>n.confirmRejection&&n.confirmRejection(...e))},"Confirm Rejection")])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),l.rejectedFrameworks.length?((0,s.uX)(),(0,s.CE)("div",sL,[t[85]||(t[85]=(0,s.Lk)("h3",null,"Rejected Frameworks (Edit & Resubmit)",-1)),(0,s.Lk)("div",oL,[(0,s.Lk)("table",lL,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",{onClick:t[12]||(t[12]=e=>n.sortRejected("FrameworkId"))},t[75]||(t[75]=[(0,s.eW)("FRAMEWORK ID "),(0,s.Lk)("i",{class:"fas fa-sort"},null,-1)])),(0,s.Lk)("th",{onClick:t[13]||(t[13]=e=>n.sortRejected("FrameworkName"))},t[76]||(t[76]=[(0,s.eW)("NAME "),(0,s.Lk)("i",{class:"fas fa-sort"},null,-1)])),(0,s.Lk)("th",{onClick:t[14]||(t[14]=e=>n.sortRejected("Category"))},t[77]||(t[77]=[(0,s.eW)("CATEGORY "),(0,s.Lk)("i",{class:"fas fa-sort"},null,-1)])),(0,s.Lk)("th",{onClick:t[15]||(t[15]=e=>n.sortRejected("CreatedByName"))},t[78]||(t[78]=[(0,s.eW)("CREATED BY "),(0,s.Lk)("i",{class:"fas fa-sort"},null,-1)])),(0,s.Lk)("th",{onClick:t[16]||(t[16]=e=>n.sortRejected("CreatedByDate"))},t[79]||(t[79]=[(0,s.eW)("CREATED DATE "),(0,s.Lk)("i",{class:"fas fa-sort"},null,-1)])),t[80]||(t[80]=(0,s.Lk)("th",null,"STATUS",-1)),t[81]||(t[81]=(0,s.Lk)("th",null,"ACTIONS",-1))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.sortedRejectedFrameworks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.FrameworkId},[(0,s.Lk)("td",null,[(0,s.Lk)("a",{href:"#",class:"framework-id-link",onClick:(0,a.D$)(t=>n.openRejectedItem(e),["prevent"])},(0,d.v_)(n.getFrameworkId(e)),9,nL)]),(0,s.Lk)("td",null,(0,d.v_)(e.ExtractedData.FrameworkName),1),(0,s.Lk)("td",null,(0,d.v_)(e.ExtractedData.Category||"No Category"),1),(0,s.Lk)("td",null,(0,d.v_)(e.ExtractedData.CreatedByName),1),(0,s.Lk)("td",null,(0,d.v_)(n.formatDate(e.ExtractedData.CreatedByDate)),1),t[84]||(t[84]=(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:"status-badge rejected"},"Rejected")],-1)),(0,s.Lk)("td",rL,[(0,s.Lk)("button",{class:"view-btn",onClick:t=>n.openApprovalDetails({originalData:e})},t[82]||(t[82]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,cL),(0,s.Lk)("button",{class:"edit-btn",onClick:t=>n.openRejectedItem(e)},t[83]||(t[83]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,dL)])]))),128))])])])])):(0,s.Q3)("",!0),l.showEditModal&&l.editingFramework?((0,s.uX)(),(0,s.CE)("div",uL,[(0,s.Lk)("div",pL,[(0,s.Lk)("h3",null,"Edit & Resubmit Framework: "+(0,d.v_)(n.getFrameworkId(l.editingFramework)),1),(0,s.Lk)("button",{class:"close-btn",onClick:t[17]||(t[17]=(...e)=>n.closeEditModal&&n.closeEditModal(...e))},"Close"),(0,s.Lk)("div",null,[t[86]||(t[86]=(0,s.Lk)("label",null,"Framework Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.editingFramework.ExtractedData.FrameworkName=e)},null,512),[[a.Jo,l.editingFramework.ExtractedData.FrameworkName]])]),(0,s.Lk)("div",null,[t[87]||(t[87]=(0,s.Lk)("label",null,"Framework Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[19]||(t[19]=e=>l.editingFramework.ExtractedData.FrameworkDescription=e)},null,512),[[a.Jo,l.editingFramework.ExtractedData.FrameworkDescription]])]),(0,s.Lk)("div",null,[t[88]||(t[88]=(0,s.Lk)("label",null,"Category:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>l.editingFramework.ExtractedData.Category=e)},null,512),[[a.Jo,l.editingFramework.ExtractedData.Category]])]),(0,s.Lk)("div",null,[t[89]||(t[89]=(0,s.Lk)("label",null,"Effective Date:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[21]||(t[21]=e=>l.editingFramework.ExtractedData.EffectiveDate=e)},null,512),[[a.Jo,l.editingFramework.ExtractedData.EffectiveDate]])]),(0,s.Lk)("div",null,[t[90]||(t[90]=(0,s.Lk)("label",null,"Start Date:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[22]||(t[22]=e=>l.editingFramework.ExtractedData.StartDate=e)},null,512),[[a.Jo,l.editingFramework.ExtractedData.StartDate]])]),(0,s.Lk)("div",null,[t[91]||(t[91]=(0,s.Lk)("label",null,"End Date:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[23]||(t[23]=e=>l.editingFramework.ExtractedData.EndDate=e)},null,512),[[a.Jo,l.editingFramework.ExtractedData.EndDate]])]),l.editingFramework.rejection_reason?((0,s.uX)(),(0,s.CE)("div",mL,[t[92]||(t[92]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",vL,(0,d.v_)(l.editingFramework.rejection_reason),1)])):(0,s.Q3)("",!0),l.editingFramework.ExtractedData.policies?((0,s.uX)(),(0,s.CE)("div",kL,[t[108]||(t[108]=(0,s.Lk)("h4",null,"Edit Policies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.editingFramework.ExtractedData.policies,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"edit-policy-item"},[(0,s.Lk)("h5",null,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("div",hL,[(0,s.Lk)("div",gL,[t[93]||(t[93]=(0,s.Lk)("label",null,"Policy Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.PolicyName=t},null,8,yL),[[a.Jo,e.PolicyName]])]),(0,s.Lk)("div",fL,[t[94]||(t[94]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.PolicyDescription=t},null,8,bL),[[a.Jo,e.PolicyDescription]])])]),(0,s.Lk)("div",CL,[(0,s.Lk)("div",LL,[t[95]||(t[95]=(0,s.Lk)("label",null,"Objective:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Objective=t},null,8,wL),[[a.Jo,e.Objective]])]),(0,s.Lk)("div",EL,[t[96]||(t[96]=(0,s.Lk)("label",null,"Scope:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Scope=t},null,8,RL),[[a.Jo,e.Scope]])])]),(0,s.Lk)("div",IL,[(0,s.Lk)("div",DL,[t[98]||(t[98]=(0,s.Lk)("label",null,"Policy Type:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.PolicyType=t,class:"form-control",onChange:t=>n.handlePolicyTypeChange(e)},[t[97]||(t[97]=(0,s.Lk)("option",{value:""},"Select Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.policyTypeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,_L))),128))],40,PL),[[a.u1,e.PolicyType]])]),(0,s.Lk)("div",AL,[t[100]||(t[100]=(0,s.Lk)("label",null,"Policy Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.PolicyCategory=t,class:"form-control",onChange:t=>n.handlePolicyCategoryChange(e)},[t[99]||(t[99]=(0,s.Lk)("option",{value:""},"Select Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicyCategories(e.PolicyType),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,TL))),128))],40,SL),[[a.u1,e.PolicyCategory]])])]),(0,s.Lk)("div",xL,[(0,s.Lk)("div",FL,[t[102]||(t[102]=(0,s.Lk)("label",null,"Policy Sub Category:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.PolicySubCategory=t,class:"form-control"},[t[101]||(t[101]=(0,s.Lk)("option",{value:""},"Select Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredPolicySubCategories(e.PolicyType,e.PolicyCategory),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,UL))),128))],8,VL),[[a.u1,e.PolicySubCategory]])])]),e.subpolicies?((0,s.uX)(),(0,s.CE)("div",NL,[t[107]||(t[107]=(0,s.Lk)("h6",null,"Edit Sub-Policies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subpolicies,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"edit-subpolicy-item"},[(0,s.Lk)("div",ML,[(0,s.Lk)("div",XL,[t[103]||(t[103]=(0,s.Lk)("label",null,"Sub-Policy Name:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.SubPolicyName=t},null,8,$L),[[a.Jo,e.SubPolicyName]])]),(0,s.Lk)("div",OL,[t[104]||(t[104]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Description=t},null,8,jL),[[a.Jo,e.Description]])])]),(0,s.Lk)("div",BL,[(0,s.Lk)("div",WL,[t[105]||(t[105]=(0,s.Lk)("label",null,"Control:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Control=t},null,8,qL),[[a.Jo,e.Control]])]),(0,s.Lk)("div",QL,[t[106]||(t[106]=(0,s.Lk)("label",null,"Identifier:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.Identifier=t},null,8,KL),[[a.Jo,e.Identifier]])])])]))),128))])):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"resubmit-btn",onClick:t[24]||(t[24]=e=>n.resubmitFramework(l.editingFramework))},"Resubmit for Review")])])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var zL={name:"FrameworkApprover",components:{PopupModal:Ta,CollapsibleTable:zn},data(){return{approvals:[],selectedApproval:null,showFrameworkDetails:!1,showRejectModal:!1,rejectionComment:"",currentRejectionType:"framework",currentRejectionItem:null,rejectedFrameworks:[],showEditModal:!1,editingFramework:null,currentUserId:null,selectedUserId:null,isGRCAdministrator:!1,availableUsers:[],userInitialized:!1,isReviewer:!0,policyCategories:[],policyCategoriesMap:{},expandedSections:{"Under Review":!0,Approved:!0,Rejected:!0},tableHeaders:[{key:"id",label:"Framework ID",sortable:!0,width:"150px"},{key:"name",label:"Name",sortable:!0},{key:"category",label:"Category",sortable:!0},{key:"createdBy",label:"Created By",sortable:!0},{key:"createdDate",label:"Created Date",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"actions",label:"Actions",width:"120px"}],rejectedSortConfig:{key:"CreatedByDate",direction:"desc"},activeTab:"myTasks"}},mounted(){this.initializeUser()},methods:{async initializeUser(){try{console.log("Initializing user and checking role...");const e=await He.A.get("http://localhost:8000/api/user-role/");if(console.log("User role API response:",e.data),e.data.success){this.currentUserId=e.data.user_id;const t=e.data.role;console.log("User role received:",t),this.isGRCAdministrator="GRC Administrator"===t,console.log("Is GRC Administrator:",this.isGRCAdministrator),this.isGRCAdministrator?(console.log("User is GRC Administrator, fetching all users for dropdown..."),await this.fetchUsers(),this.selectedUserId=null):(console.log("User is not GRC Administrator, setting selected user to current user"),this.selectedUserId=this.currentUserId,this.fetchFrameworks(),this.fetchRejectedFrameworks()),this.userInitialized=!0,this.fetchPolicyTypes()}else console.error("User role API did not return success:",e.data),console.log("Using fallback user role for testing..."),this.currentUserId=2,this.isGRCAdministrator=!1,this.selectedUserId=this.currentUserId,this.userInitialized=!0,this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.fetchPolicyTypes()}catch(e){console.error("Error initializing user:",e),console.log("Using fallback user role due to error..."),this.currentUserId=2,this.isGRCAdministrator=!1,this.selectedUserId=this.currentUserId,this.userInitialized=!0,this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.fetchPolicyTypes()}},async fetchUsers(){try{console.log("Fetching users for dropdown...");const e=await He.A.get("http://localhost:8000/api/users-for-dropdown/");console.log("Users API response:",e.data),Array.isArray(e.data)?this.availableUsers=e.data:e.data&&e.data.success&&Array.isArray(e.data.data)?this.availableUsers=e.data.data:this.availableUsers=e.data||[],console.log("Available users loaded:",this.availableUsers.length,"users"),0===this.availableUsers.length&&(console.error("No users found in database"),alert("Error: No users found. Please contact administrator."))}catch(e){console.error("Error fetching users:",e),this.availableUsers=[],alert("Error: Could not load users list. Please contact administrator.")}},onUserSelectionChange(){console.log("User selection changed to:",this.selectedUserId),this.selectedUserId?(this.fetchFrameworks(),this.fetchRejectedFrameworks()):(this.approvals=[],this.rejectedFrameworks=[])},fetchFrameworks(){console.log("Fetching frameworks...");const e=this.selectedUserId||this.currentUserId;if(console.log("Using user ID for API:",e),!e)return void console.warn("No user ID available for fetching frameworks");const t={include_all_status:!0,...(!this.isGRCAdministrator||this.selectedUserId)&&{user_id:e}};He.A.get("http://localhost:8000/api/frameworks/",{params:t}).then(e=>{console.log("Frameworks response:",e.data),this.approvals=e.data.map(e=>{let t=e.CurrentVersion?.toString()||"u1";return{FrameworkId:e.FrameworkId,ExtractedData:{type:"framework",FrameworkName:e.FrameworkName,CreatedByName:e.CreatedByName,CreatedByDate:e.CreatedByDate,Category:e.Category,Status:e.Status,FrameworkDescription:e.FrameworkDescription,EffectiveDate:e.EffectiveDate,StartDate:e.StartDate,EndDate:e.EndDate,Identifier:e.Identifier,DocURL:e.DocURL,Reviewer:e.Reviewer,InternalExternal:e.InternalExternal},ApprovedNot:"Approved"===e.Status||"Rejected"!==e.Status&&null,version:t}}).filter(e=>"Under Review"===e.ExtractedData.Status||"Approved"===e.ExtractedData.Status||"Rejected"===e.ExtractedData.Status),console.log("Processed frameworks for approval:",this.approvals)}).catch(e=>{console.error("Error fetching frameworks:",e)})},openApprovalDetails(e){const t=e.originalData;if(!t)return;if(this.selectedApproval&&this.selectedApproval.FrameworkId===t.FrameworkId)return this.showFrameworkDetails=!this.showFrameworkDetails,void(this.showFrameworkDetails||(this.selectedApproval=null));const i=this.getFrameworkId(t);if(null===t.ApprovedNot){const e={...t,ExtractedData:{...t.ExtractedData,FrameworkName:t.ExtractedData.FrameworkName||"",CreatedByName:t.ExtractedData.CreatedByName||"",CreatedByDate:t.ExtractedData.CreatedByDate||"",Category:t.ExtractedData.Category||"",Status:"Under Review",FrameworkDescription:t.ExtractedData.FrameworkDescription||"",EffectiveDate:t.ExtractedData.EffectiveDate||"",StartDate:t.ExtractedData.StartDate||"",EndDate:t.ExtractedData.EndDate||"",Identifier:t.ExtractedData.Identifier||"",DocURL:t.ExtractedData.DocURL||"",Reviewer:t.ExtractedData.Reviewer||"",InternalExternal:t.ExtractedData.InternalExternal||"Internal",policies:[]}};return this.selectedApproval=e,this.showFrameworkDetails=!0,void He.A.get(`http://localhost:8000/api/frameworks/${i}/get-policies/`).then(e=>{if(console.log("Framework policies:",e.data),e.data){const t=e.data.map(e=>({...e,Status:e.Status||"Under Review",subpolicies:[]}));this.selectedApproval.ExtractedData.policies=t;const i=t.map(e=>He.A.get(`http://localhost:8000/api/policies/${e.PolicyId}/get-subpolicies/`).then(t=>{if(console.log(`Subpolicies for policy ${e.PolicyId}:`,t.data),t.data){const i=this.selectedApproval.ExtractedData.policies.find(t=>t.PolicyId===e.PolicyId);i&&(i.subpolicies=t.data.map(e=>({...e,Status:e.Status||"Under Review"})),console.log(`Updated policy ${e.PolicyId} with ${t.data.length} subpolicies`))}}).catch(t=>{console.error(`Error fetching subpolicies for policy ${e.PolicyId}:`,t)}));Promise.all(i).then(()=>{console.log("All policies and subpolicies loaded")}).catch(e=>{console.error("Error loading some subpolicies:",e)})}}).catch(e=>{console.error("Error fetching policies:",e),ya.error("Error loading policies. Please try again.","Loading Error")})}He.A.get(`http://localhost:8000/api/framework-approvals/latest/${i}/`).then(e=>{if(console.log("Latest framework approval:",e.data),e.data&&e.data.ExtractedData){const i=e.data,a={...t,...i,ExtractedData:i.ExtractedData};!0===a.ApprovedNot&&a.ExtractedData&&"Approved"===a.ExtractedData.Status&&a.ExtractedData.policies&&a.ExtractedData.policies.forEach(e=>{"Approved"!==e.Status&&(e.Status="Approved"),e.subpolicies&&e.subpolicies.forEach(e=>{"Approved"!==e.Status&&(e.Status="Approved")})}),this.selectedApproval=a,this.showFrameworkDetails=!0,this.$nextTick(()=>{this.$refs.frameworkDetailsContent&&(this.$refs.frameworkDetailsContent.scrollTop=0)})}else console.error("Invalid approval data received:",e.data),ya.error("Error: Could not load framework approval details","Loading Error")}).catch(e=>{this.handleError(e,"loading framework approval details")})},refreshData(){this.fetchFrameworks(),this.selectedApproval&&this.selectedApproval.FrameworkId&&this.openApprovalDetails(this.selectedApproval)},formatDate(e){if(!e)return"";const t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},isNewFramework(e){const t=e.ExtractedData?.CreatedByDate||e.created_at;if(!t)return!1;const i=new Date(t);if(isNaN(i.getTime()))return!1;const a=new Date;return a.setDate(a.getDate()-3),i>a},getFrameworkId(e){return e.FrameworkId?"object"===typeof e.FrameworkId?e.FrameworkId.FrameworkId:e.FrameworkId:e.ApprovalId},closeApprovalDetails(){this.selectedApproval=null,this.showFrameworkDetails=!1},approveFramework(){this.selectedApproval&&this.selectedApproval.FrameworkId?(this.selectedApproval.ExtractedData.framework_approval||(this.selectedApproval.ExtractedData.framework_approval={}),this.selectedApproval.ExtractedData.framework_approval.approved=!0,this.selectedApproval.ExtractedData.framework_approval.remarks="",this.selectedApproval.ApprovedNot=!0,this.selectedApproval.ExtractedData.Status="Approved"):console.error("No framework selected for approval")},rejectFramework(){this.currentRejectionType="framework",this.currentRejectionItem=null,this.showRejectModal=!0},cancelRejection(){this.showRejectModal=!1,this.rejectionComment="",this.currentRejectionType="framework",this.currentRejectionItem=null},confirmRejection(){if(!this.rejectionComment.trim())return void ya.warning("Please provide a rejection reason","Missing Reason");const e=this.getFrameworkId(this.selectedApproval);if("subpolicy"===this.currentRejectionType&&this.currentRejectionItem){const{policy:t,subpolicy:i}=this.currentRejectionItem;He.A.put(`http://localhost:8000/api/frameworks/${e}/policies/${t.PolicyId}/subpolicies/${i.SubPolicyId}/approve-reject/`,{approved:!1,rejection_reason:this.rejectionComment,submit_review:!0}).then(e=>{console.log("Subpolicy rejected successfully:",e.data),i.Status="Rejected",t.Status="Rejected",t.subpolicies&&t.subpolicies.forEach(e=>{e.Status="Rejected"}),this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ApprovedNot=!1,ya.success("Subpolicy rejected. Framework has been rejected and sent back for revision.","Subpolicy Rejected"),this.cancelRejection(),this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.closeApprovalDetails()}).catch(e=>{this.handleError(e,"rejecting subpolicy")})}else if("policy"===this.currentRejectionType&&this.currentRejectionItem){const t=this.currentRejectionItem;He.A.put(`http://localhost:8000/api/frameworks/${e}/policies/${t.PolicyId}/approve-reject/`,{approved:!1,rejection_reason:this.rejectionComment,submit_review:!0}).then(e=>{console.log("Policy rejected successfully:",e.data),t.Status="Rejected",t.subpolicies&&t.subpolicies.forEach(e=>{e.Status="Rejected"}),this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ApprovedNot=!1,ya.success("Policy rejected. Framework has been rejected and sent back for revision.","Policy Rejected"),this.cancelRejection(),this.fetchFrameworks(),this.fetchRejectedFrameworks(),this.closeApprovalDetails()}).catch(e=>{this.handleError(e,"rejecting policy")})}else if("framework"===this.currentRejectionType){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return console.error("No framework selected for rejection"),void this.cancelRejection();this.selectedApproval.ExtractedData.framework_approval||(this.selectedApproval.ExtractedData.framework_approval={}),this.selectedApproval.ExtractedData.framework_approval.approved=!1,this.selectedApproval.ExtractedData.framework_approval.remarks=this.rejectionComment,this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ApprovedNot=!1,this.submitFrameworkReview(!1,this.rejectionComment),this.cancelRejection()}},handleError(e,t){console.error(`Error ${t}:`,e);let i="An unexpected error occurred";return i=e.response?e.response.data&&e.response.data.error?e.response.data.error:e.response.data&&"string"===typeof e.response.data?e.response.data:`Server error: ${e.response.status}`:e.request?"No response from server. Please check your connection.":e.message||i,ya.error(`Error ${t}: ${i}`,"Error"),i},submitFrameworkReview(e,t=""){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return void console.error("No framework selected for review submission");const i=this.getFrameworkId(this.selectedApproval);console.log(`Submitting framework review for framework ${i}`,{approved:e,remarks:t});const a={ExtractedData:JSON.parse(JSON.stringify(this.selectedApproval.ExtractedData)),ApprovedNot:e,remarks:t,UserId:this.currentUserId,ReviewerId:this.currentUserId,currentVersion:this.selectedApproval.version||"u1"};!0===e&&a.ExtractedData.policies&&a.ExtractedData.policies.forEach(e=>{e.Status="Approved",e.ActiveInactive="Active",e.subpolicies&&e.subpolicies.forEach(e=>{e.Status="Approved"})}),!0===e&&(a.ExtractedData.ActiveInactive="Active"),!1===e&&t&&(a.ExtractedData.framework_approval||(a.ExtractedData.framework_approval={}),a.ExtractedData.framework_approval.remarks=t),He.A.post(`http://localhost:8000/api/frameworks/${i}/submit-review/`,a).then(t=>{console.log("Framework review submitted successfully:",t.data),this.selectedApproval.ApprovedNot=e,this.selectedApproval.Version=t.data.Version,e?(this.selectedApproval.ExtractedData.Status="Approved",t.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=t.data.ApprovedDate),this.selectedApproval.ExtractedData.policies&&this.selectedApproval.ExtractedData.policies.forEach(e=>{e.Status="Approved",e.subpolicies&&e.subpolicies.forEach(e=>{e.Status="Approved"})}),ya.success("Framework approved successfully!","Framework Approved")):(this.selectedApproval.ExtractedData.Status="Rejected",ya.success("Framework rejected successfully!","Framework Rejected")),this.fetchFrameworks()}).catch(e=>{this.handleError(e,"submitting framework review")})},fetchRejectedFrameworks(){console.log("Fetching rejected frameworks...");const e=this.selectedUserId||this.currentUserId;console.log("Using user ID for rejected frameworks:",e),e?He.A.get("http://localhost:8000/api/frameworks/rejected/",{params:{user_id:e}}).then(e=>{console.log("Rejected frameworks response:",e.data),this.rejectedFrameworks=e.data.map(e=>(e.ExtractedData||(e.ExtractedData={}),e))}).catch(e=>{console.error("Error fetching rejected frameworks:",e)}):console.warn("No user ID available for fetching rejected frameworks")},openRejectedItem(e){console.log("Opening rejected framework for editing:",e),this.editingFramework=JSON.parse(JSON.stringify(e)),this.editingFramework.ExtractedData||(this.editingFramework.ExtractedData={}),this.editingFramework.ExtractedData.policies?(console.log(`Found ${this.editingFramework.ExtractedData.policies.length} policies in framework`),this.editingFramework.ExtractedData.policies.forEach(e=>{e.PolicyType||(e.PolicyType=""),e.PolicyCategory||(e.PolicyCategory=""),e.PolicySubCategory||(e.PolicySubCategory=""),console.log(`Policy ${e.PolicyId} category fields:`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),e.subpolicies||(e.subpolicies=[])})):(console.warn("No policies found in rejected framework, initializing empty policies array"),this.editingFramework.ExtractedData.policies=[]),this.showEditModal=!0},closeEditModal(){this.showEditModal=!1,this.editingFramework=null},resubmitFramework(e){const t=this.getFrameworkId(e);console.log("Resubmitting framework with ID:",t),console.log("Framework data before preparing:",e);const i=this.validateFrameworkData(e);if(i.length>0)return void ya.warning(`Please fix the following errors before resubmitting:\n${i.join("\n")}`,"Validation Errors");e.ExtractedData.policies&&e.ExtractedData.policies.length>0?e.ExtractedData.policies.forEach((e,t)=>{console.log(`Checking policy ${t} with ID: ${e.PolicyId}`),console.log("Policy category fields:",{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),e.subpolicies&&e.subpolicies.length>0?e.subpolicies.forEach((e,i)=>{console.log(`Checking subpolicy ${i} with ID: ${e.SubPolicyId}`),e.SubPolicyName||console.warn(`SubpolicyName is missing for subpolicy ${i} in policy ${t}`),e.Description||console.warn(`Description is missing for subpolicy ${i} in policy ${t}`)}):console.log(`Policy ${t} has no subpolicies or they are not properly structured`)}):console.warn("No policies found in framework data or policies array is not properly structured");const a={FrameworkName:e.ExtractedData.FrameworkName,FrameworkDescription:e.ExtractedData.FrameworkDescription,Category:e.ExtractedData.Category,EffectiveDate:e.ExtractedData.EffectiveDate,StartDate:e.ExtractedData.StartDate,EndDate:e.ExtractedData.EndDate,policies:e.ExtractedData.policies?e.ExtractedData.policies.map(e=>{console.log(`Processing policy ${e.PolicyId} for resubmission with category fields:`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory});const t={...e,PolicyId:e.PolicyId,PolicyName:e.PolicyName,PolicyDescription:e.PolicyDescription,Status:e.Status,StartDate:e.StartDate,EndDate:e.EndDate,Department:e.Department,Objective:e.Objective,Scope:e.Scope,Applicability:e.Applicability,Identifier:e.Identifier,CoverageRate:e.CoverageRate,PolicyType:e.PolicyType||"",PolicyCategory:e.PolicyCategory||"",PolicySubCategory:e.PolicySubCategory||"",subpolicies:e.subpolicies||[]};return t}):[]};console.log("Prepared resubmission data:",a),console.log("Policies in resubmission data:",a.policies),console.log("Number of policies:",a.policies.length),console.log("Final resubmission data to be sent:",JSON.stringify(a)),a.policies&&a.policies.length>0&&(console.log("CRITICAL - Policy category fields in final resubmission data:"),a.policies.forEach((e,t)=>{e.PolicyType=e.PolicyType||"",e.PolicyCategory=e.PolicyCategory||"",e.PolicySubCategory=e.PolicySubCategory||"",console.log(`Policy ${t} (${e.PolicyId}):`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory})})),He.A.put(`http://localhost:8000/api/frameworks/${t}/resubmit-approval/`,a).then(e=>{console.log("Framework resubmitted successfully:",e.data),ya.success(`Framework resubmitted for review! New version: ${e.data.Version}`,"Framework Resubmitted"),this.closeEditModal(),this.fetchRejectedFrameworks(),this.fetchFrameworks()}).catch(e=>{console.error("Error data:",e.response?e.response.data:"No response data"),this.handleError(e,"resubmitting framework")})},formatFieldName(e){return e.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase()).trim()},approvePolicy(e){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return void console.error("No framework selected for policy approval");if(e.subpolicies&&e.subpolicies.length>0){const t=e.subpolicies.every(e=>"Approved"===e.Status);if(!t)return void ya.warning("All subpolicies must be approved before approving the policy","Subpolicies Not Approved")}const t=this.getFrameworkId(this.selectedApproval);He.A.put(`http://localhost:8000/api/frameworks/${t}/policies/${e.PolicyId}/approve-reject/`,{approved:!0,submit_review:!1}).then(t=>{console.log("Policy approved successfully:",t.data),e.Status="Approved";const i=this.selectedApproval.ExtractedData.policies.every(e=>"Approved"===e.Status||e.subpolicies&&e.subpolicies.every(e=>"Approved"===e.Status));i&&(this.selectedApproval.ExtractedData.Status="Ready for Final Approval"),ya.success("Policy approved successfully!","Policy Approved")}).catch(e=>{this.handleError(e,"approving policy")})},rejectPolicy(e){this.selectedApproval&&this.selectedApproval.FrameworkId?(this.currentRejectionType="policy",this.currentRejectionItem=e,this.showRejectModal=!0):console.error("No framework selected for policy rejection")},rejectSubpolicy(e,t){this.selectedApproval&&this.selectedApproval.FrameworkId?(this.currentRejectionType="subpolicy",this.currentRejectionItem={policy:e,subpolicy:t},this.showRejectModal=!0):console.error("No framework selected for subpolicy rejection")},canApprovePolicy(e){return"Approved"!==e.Status&&"Rejected"!==e.Status&&(!(e.subpolicies&&e.subpolicies.length>0)||e.subpolicies.every(e=>"Approved"===e.Status))},approveSubpolicy(e,t){if(!this.selectedApproval||!this.selectedApproval.FrameworkId)return void console.error("No framework selected for subpolicy approval");const i=this.getFrameworkId(this.selectedApproval);He.A.put(`http://localhost:8000/api/frameworks/${i}/policies/${e.PolicyId}/subpolicies/${t.SubPolicyId}/approve-reject/`,{approved:!0,submit_review:!1}).then(i=>{console.log("Subpolicy approved successfully:",i.data),t.Status="Approved";const a=e.subpolicies&&e.subpolicies.every(e=>"Approved"===e.Status);a?(e.Status="Ready for Approval",ya.success("All subpolicies approved. Policy is now ready for approval.","Subpolicies Approved")):ya.success("Subpolicy approved successfully!","Subpolicy Approved")}).catch(e=>{this.handleError(e,"approving subpolicy")})},areAllSubpoliciesApproved(e){return!e.subpolicies||0===e.subpolicies.length||e.subpolicies.every(e=>"Approved"===e.Status)},areAllPoliciesApproved(){return!!this.selectedApproval?.ExtractedData?.policies&&this.selectedApproval.ExtractedData.policies.every(e=>"Approved"===e.Status||e.subpolicies&&e.subpolicies.every(e=>"Approved"===e.Status))},getFrameworkApprovalStatus(){if(!this.selectedApproval||!this.selectedApproval.ExtractedData)return"Unknown";const e=this.selectedApproval.ExtractedData.policies||[];if(0===e.length)return"No Policies";const t=e.filter(e=>"Approved"===e.Status).length,i=e.filter(e=>"Rejected"===e.Status).length,a=e.length;return i>0?`Rejected (${i}/${a} policies rejected)`:t===a?`Ready for Final Approval (${t}/${a} policies approved)`:`Under Review (${t}/${a} policies approved)`},canApproveFramework(){return!(!this.selectedApproval||!this.selectedApproval.ExtractedData)&&(null===this.selectedApproval.ApprovedNot&&this.areAllPoliciesApproved())},approveEntireFramework(){this.selectedApproval&&this.selectedApproval.FrameworkId?this.canApproveFramework()?ya.confirm("Are you sure you want to give final approval to this entire framework?","Confirm Final Approval",()=>{this.proceedWithFrameworkApproval()}):ya.warning("All policies must be approved before approving the framework","Policies Not Approved"):console.error("No framework selected for entire framework approval")},proceedWithFrameworkApproval(){const e=this.getFrameworkId(this.selectedApproval);He.A.put(`http://localhost:8000/api/frameworks/${e}/approve-final/`).then(e=>{console.log("Framework approved successfully:",e.data),this.selectedApproval.ExtractedData.Status="Approved",this.selectedApproval.ApprovedNot=!0,e.data.ApprovedDate&&(this.selectedApproval.ApprovedDate=e.data.ApprovedDate),this.selectedApproval.ExtractedData.policies&&this.selectedApproval.ExtractedData.policies.forEach(e=>{e.Status="Approved",e.subpolicies&&e.subpolicies.forEach(e=>{e.Status="Approved"})}),ya.success("Framework approved successfully!","Framework Approved"),this.fetchFrameworks()}).catch(e=>{this.handleError(e,"approving entire framework")})},submitReview(){console.log("submitReview called with approval:",this.selectedApproval),this.selectedApproval&&null!==this.selectedApproval.ApprovedNot?(console.log("Delegating to submitFrameworkReview with approval status:",this.selectedApproval.ApprovedNot),this.submitFrameworkReview(this.selectedApproval.ApprovedNot)):console.error("Cannot submit review - no approval or approval status set")},validateFrameworkData(e){const t=[];return e.ExtractedData.FrameworkName||t.push("Framework Name is required"),e.ExtractedData.FrameworkDescription||t.push("Framework Description is required"),e.ExtractedData.policies&&e.ExtractedData.policies.length>0&&e.ExtractedData.policies.forEach((e,i)=>{e.PolicyName||t.push(`Policy #${i+1} is missing a name`),console.log(`Validating policy #${i+1} category fields:`,{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),e.subpolicies&&e.subpolicies.length>0&&e.subpolicies.forEach((a,s)=>{a.SubPolicyName||t.push(`Subpolicy #${s+1} in Policy "${e.PolicyName||`#${i+1}`}" is missing a name`)})}),t},fetchPolicyTypes(){console.log("Fetching policy categories..."),He.A.get("http://localhost:8000/api/policy-categories/").then(e=>{console.log("Policy categories response:",e.data),this.policyCategories=e.data;const t={};e.data.forEach(e=>{t[e.PolicyType]||(t[e.PolicyType]={categories:{}}),t[e.PolicyType].categories[e.PolicyCategory]||(t[e.PolicyType].categories[e.PolicyCategory]={subCategories:[]}),t[e.PolicyType].categories[e.PolicyCategory].subCategories.push(e.PolicySubCategory)}),this.policyCategoriesMap=t,console.log("Processed policy categories map:",this.policyCategoriesMap)}).catch(e=>{console.error("Error fetching policy categories:",e)})},initializePolicyCategoryFields(e){return console.log(`Initializing policy category fields for policy: ${e.PolicyId||"New Policy"}`),console.log("Current policy category fields:",{PolicyType:e.PolicyType,PolicyCategory:e.PolicyCategory,PolicySubCategory:e.PolicySubCategory}),this.$watch(()=>e.PolicyType,(t,i)=>{t!==i&&(console.log(`Policy type changed from ${i} to ${t}, resetting category and subcategory`),e.PolicyCategory="",e.PolicySubCategory="")}),this.$watch(()=>e.PolicyCategory,(t,i)=>{t!==i&&(console.log(`Policy category changed from ${i} to ${t}, resetting subcategory`),e.PolicySubCategory="")}),e},handlePolicyTypeChange(e){console.log(`Policy type changed to: ${e.PolicyType}`),e.PolicyCategory="",e.PolicySubCategory=""},handlePolicyCategoryChange(e){console.log(`Policy category changed to: ${e.PolicyCategory}`),e.PolicySubCategory=""},toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]},mapFrameworkToTableRow(e){return{id:this.getFrameworkId(e),name:e.ExtractedData.FrameworkName,category:e.ExtractedData.Category||"No Category",createdBy:e.ExtractedData.CreatedByName||"System",createdDate:this.formatDate(e.ExtractedData.CreatedByDate||e.created_at),status:this.getStatusBadge(e),actions:"VIEW DETAILS",originalData:e}},getStatusBadge(e){const t=!0===e.ApprovedNot?"Approved":!1===e.ApprovedNot?"Rejected":"Pending";return`<span class="status-badge ${t.toLowerCase()}">${t}</span>`},sortRejected(e){this.rejectedSortConfig.key===e?this.rejectedSortConfig.direction="asc"===this.rejectedSortConfig.direction?"desc":"asc":(this.rejectedSortConfig.key=e,this.rejectedSortConfig.direction="asc")},checkPolicyApprovalStatus(e){if(!e.subpolicies||0===e.subpolicies.length)return;const t=e.subpolicies.every(e=>"Approved"===e.Status);t&&(e.Status="Approved")},getStatusClass(e){return{"status-approved":"Approved"===e,"status-rejected":"Rejected"===e,"status-pending":"Under Review"===e||!e}},isMyFramework(e){const t=this.selectedUserId||this.currentUserId;return!!t&&(e.ExtractedData.CreatedBy===t||e.ExtractedData.CreatedByName===this.getCurrentUserName())},isReviewerFramework(e){const t=this.selectedUserId||this.currentUserId;return!!t&&(!!this.isGRCAdministrator||(e.ExtractedData.Reviewer===t||e.ExtractedData.ReviewerName===this.getCurrentUserName()||this.isReviewer&&null===e.ApprovedNot))},getCurrentUserName(){if(this.selectedUserId&&this.availableUsers.length>0){const e=this.availableUsers.find(e=>e.UserId===this.selectedUserId);return e?e.UserName:""}return localStorage.getItem("user_name")||""},getMyTasksFrameworks(){return this.userInitialized?this.isGRCAdministrator&&!this.selectedUserId?[]:this.approvals.filter(e=>this.isMyFramework(e)):[]},getReviewerTasksFrameworks(){return this.userInitialized?this.isGRCAdministrator&&!this.selectedUserId?[]:this.approvals.filter(e=>this.isReviewerFramework(e)&&!this.isMyFramework(e)):[]}},computed:{pendingApprovalsCount(){return this.approvals.filter(e=>null===e.ApprovedNot).length},approvedApprovalsCount(){return this.approvals.filter(e=>!0===e.ApprovedNot).length},rejectedApprovalsCount(){return this.approvals.filter(e=>!1===e.ApprovedNot).length},sortedFrameworks(){return[...this.approvals].sort((e,t)=>{const i=new Date(e.ExtractedData?.CreatedByDate||0),a=new Date(t.ExtractedData?.CreatedByDate||0);return a-i})},policyTypeOptions(){return Object.keys(this.policyCategoriesMap)},filteredPolicyCategories(){return e=>e&&this.policyCategoriesMap[e]?Object.keys(this.policyCategoriesMap[e].categories):[]},filteredPolicySubCategories(){return(e,t)=>e&&t&&this.policyCategoriesMap[e]&&this.policyCategoriesMap[e].categories[t]?this.policyCategoriesMap[e].categories[t].subCategories:[]},sortedRejectedFrameworks(){return[...this.rejectedFrameworks].sort((e,t)=>{const i=this.rejectedSortConfig.key;let a=i.includes(".")?i.split(".").reduce((e,t)=>e?.[t],e):e[i],s=i.includes(".")?i.split(".").reduce((e,t)=>e?.[t],t):t[i];return"CreatedByDate"===i&&(a=new Date(a||0),s=new Date(s||0)),"string"===typeof a&&(a=a.toLowerCase(),s=s.toLowerCase()),"asc"===this.rejectedSortConfig.direction?a>s?1:-1:a<s?1:-1})},myTasksSections(){const e=this.getMyTasksFrameworks(),t=[{name:"Under Review",statusClass:"pending",tasks:e.filter(e=>null===e.ApprovedNot).map(this.mapFrameworkToTableRow)},{name:"Approved",statusClass:"approved",tasks:e.filter(e=>!0===e.ApprovedNot).map(this.mapFrameworkToTableRow)},{name:"Rejected",statusClass:"rejected",tasks:e.filter(e=>!1===e.ApprovedNot).map(this.mapFrameworkToTableRow)}];return t},reviewerTasksSections(){const e=this.getReviewerTasksFrameworks(),t=[{name:"Under Review",statusClass:"pending",tasks:e.filter(e=>null===e.ApprovedNot).map(this.mapFrameworkToTableRow)},{name:"Approved",statusClass:"approved",tasks:e.filter(e=>!0===e.ApprovedNot).map(this.mapFrameworkToTableRow)},{name:"Rejected",statusClass:"rejected",tasks:e.filter(e=>!1===e.ApprovedNot).map(this.mapFrameworkToTableRow)}];return t},myTasksCount(){return this.getMyTasksFrameworks().length},reviewerTasksCount(){return this.getReviewerTasksFrameworks().length}}};const HL=(0,le.A)(zL,[["render",JL],["__scopeId","data-v-5a72593c"]]);var GL=HL;const YL={class:"dashboard-container"},ZL={class:"filter-section"},ew={class:"filter-group"},tw={key:0,class:"loading-indicator"},iw={key:1,class:"no-requests"},aw={key:2},sw={class:"framework-grid"},ow={class:"framework-header"},lw={class:"category-tag"},nw={class:"framework-description"},rw={class:"framework-footer"},cw={class:"status-toggle"},dw=["checked"],uw={class:"actions"},pw=["onClick"],mw={key:3,class:"framework-details-modal"},vw={class:"framework-details-content"},kw={class:"detail-type-indicator"},hw={class:"version-pill"},gw={class:"framework-approval-section"},yw={class:"approval-status-indicator"},fw={key:0,class:"framework-actions"},bw={key:1,class:"approval-result"},Cw={key:0,class:"approval-remarks"},Lw={key:1,class:"approval-date"},ww={class:"request-details"},Ew={class:"framework-detail-row"},Rw={class:"framework-detail-row"},Iw={class:"framework-detail-row"},Dw={class:"framework-detail-row"},Pw={class:"framework-detail-row"},_w={key:0,class:"framework-detail-row"},Aw={key:0,class:"policy-count"},Sw={key:1,class:"framework-detail-row"},Tw={key:0,class:"policy-count"},xw={key:0,class:"affected-policies-section"},Fw={class:"section-description"},Vw={key:0},Uw={key:1},Nw={class:"policies-list"},Mw={class:"policy-header"},Xw={class:"policy-name"},$w={class:"policy-details"},Ow={key:0,class:"policy-detail-item"},jw={key:1,class:"policy-detail-item"},Bw={key:2,class:"policy-detail-item"},Ww={class:"policy-header"},qw={class:"policy-name"},Qw={class:"policy-details"},Kw={key:0,class:"policy-detail-item"},Jw={key:1,class:"policy-detail-item"},zw={key:2,class:"policy-detail-item"},Hw={key:0,class:"affected-policies-summary"},Gw={key:1,class:"no-policies-message"},Yw={key:2,class:"approval-implications"},Zw={class:"implication-item warning"},eE={class:"implication-text"},tE={key:0};var iE={__name:"StatusChangeRequests",setup(e){const t=(0,ie.KR)([]),i=(0,ie.KR)(!1),a=(0,ie.KR)(!1),o=(0,ie.KR)(null),l=(0,ie.KR)(""),n=(0,ie.KR)([]),r=(0,s.EW)(()=>({label:"Filter by Reviewer",name:"reviewer",values:[{value:"",label:"All Reviewers"},...n.value.map(e=>({value:e.UserId,label:`${e.UserName} (${e.Email})`}))],defaultValue:"All Reviewers"})),c=(0,s.EW)(()=>t.value.filter(e=>"Pending Approval"===e.Status)),u=[{key:"name",label:"Name"},{key:"type",label:"Type"},{key:"category",label:"Category/Department"},{key:"date",label:"Request Date"},{key:"reason",label:"Reason"},{key:"actions",label:"Actions"}],p=(0,s.EW)(()=>c.value.map(e=>({...e,name:e.FrameworkName||e.PolicyName,type:"policy"===e.ItemType?"POLICY STATUS CHANGE":"FRAMEWORK STATUS CHANGE",category:e.Category||e.Department,date:m(e.RequestDate),reason:e.Reason}))),m=e=>{if(!e)return"N/A";try{const t=new Date(e);return t.toLocaleDateString()}catch(t){return e}},v=e=>{const t={};return e.forEach(e=>{!0===e.ApprovedNot?(t[e.FrameworkName]="Approved",e.Status="Approved"):!1===e.ApprovedNot?(t[e.FrameworkName]="Rejected",e.Status="Rejected"):(t[e.FrameworkName]="Pending Approval",e.Status="Pending Approval")}),e.forEach(e=>{e.Status=t[e.FrameworkName],e.AffectedPolicies&&e.AffectedPolicies.forEach(t=>{"Approved"===e.Status?t.ActiveInactive="Inactive":"Rejected"===e.Status&&(t.ActiveInactive="Active")})}),e},k=async()=>{i.value=!0;try{const[e,i]=await Promise.all([He.A.get("/api/framework-status-change-requests/"),He.A.get("/api/policy-status-change-requests/")]),a=v(e.data),s=i.data.map(e=>({...e,RequestType:"Policy Status Change",ItemType:"policy"})),o=[...a,...s];o.forEach(e=>{e.ItemType||(e.ItemType="framework")}),t.value=o.sort((e,t)=>{const i=new Date(e.RequestDate||0),a=new Date(t.RequestDate||0);return a-i})}catch(e){console.error("Error fetching status change requests:",e)}finally{i.value=!1}},h=e=>{o.value=e,a.value=!0},g=()=>{o.value=null,a.value=!1},y=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},f=async e=>{const t=e.FrameworkName||e.PolicyName,i="policy"===e.ItemType?"policy":"framework",a="policy"===e.ItemType?e.CascadeToSubpolicies?" This will also make all subpolicies inactive.":"":e.CascadeToApproved?" This will also make all approved policies inactive.":"";ya.confirm(`Are you sure you want to approve changing the status of "${t}" to Inactive?${a}`,"Confirm Approval",async()=>{ya.comment("Enter any remarks (optional):","Approval Remarks",async a=>{try{const s="policy"===e.ItemType?`/api/policy-approvals/${e.ApprovalId}/approve-status-change/`:`/api/framework-approvals/${e.ApprovalId}/approve-status-change/`;await He.A.post(s,{approved:!0,remarks:a||"Status change approved"});const o="policy"===e.ItemType?e.SubpolicyCount:e.PolicyCount,l="policy"===e.ItemType?"subpolicies":"policies";await y({title:"Status Change Request Approved",message:`${i.charAt(0).toUpperCase()+i.slice(1)} "${t}" has been set to Inactive.${o>0?` ${o} ${l} were also made inactive.`:""}`,category:"status_change",priority:"high",user_id:"default_user"}),ya.success(`${i.charAt(0).toUpperCase()+i.slice(1)} "${t}" has been set to Inactive.${o>0?` ${o} ${l} were also made inactive.`:""}`,"Status Changed"),g(),await k()}catch(s){console.error("Error approving status change request:",s),await y({title:"Status Change Approval Failed",message:`Failed to approve status change request for "${t}". Please try again.`,category:"status_change",priority:"high",user_id:"default_user"}),ya.error("Failed to approve status change request. Please try again.","Approval Failed")}})})},b=async e=>{const t=e.FrameworkName||e.PolicyName,i="policy"===e.ItemType?"policy":"framework";ya.confirm(`Are you sure you want to reject the status change request for "${t}"? The ${i} will remain Active.`,"Confirm Rejection",async()=>{ya.comment("Enter rejection reason (optional):","Rejection Reason",async a=>{try{const s="policy"===e.ItemType?`/api/policy-approvals/${e.ApprovalId}/approve-status-change/`:`/api/framework-approvals/${e.ApprovalId}/approve-status-change/`;await He.A.post(s,{approved:!1,remarks:a||"Status change rejected"}),await y({title:"Status Change Request Rejected",message:`Status change request for "${t}" has been rejected. The ${i} remains Active.`,category:"status_change",priority:"medium",user_id:"default_user"}),ya.success(`Status change request for "${t}" has been rejected. The ${i} remains Active.`,"Request Rejected"),g(),await k()}catch(s){console.error("Error rejecting status change request:",s),await y({title:"Status Change Rejection Failed",message:`Failed to reject status change request for "${t}". Please try again.`,category:"status_change",priority:"high",user_id:"default_user"}),ya.error("Failed to reject status change request. Please try again.","Rejection Failed")}})})};(0,s.sV)(()=>{k(),C()});const C=async()=>{try{const e=await He.A.get("/api/users-for-reviewer-selection/");n.value=e.data}catch(e){console.error("Error fetching reviewers:",e)}},L=async e=>{l.value=e.value,i.value=!0;try{let e,i;l.value?(e=await He.A.get(`/api/status-change-requests-by-reviewer/${l.value}/`),i=await He.A.get(`/api/policy-status-change-requests-by-reviewer/${l.value}/`)):(e=await He.A.get("/api/framework-status-change-requests/"),i=await He.A.get("/api/policy-status-change-requests/"));const a=v(e.data),s=i.data.map(e=>({...e,RequestType:"Policy Status Change",ItemType:"policy"})),o=s,n=[...a,...o];n.forEach(e=>{e.ItemType||(e.ItemType="framework")}),t.value=n.sort((e,t)=>{const i=new Date(e.RequestDate||0),a=new Date(t.RequestDate||0);return a-i})}catch(a){console.error("Error filtering requests by reviewer:",a)}finally{i.value=!1}};return(e,n)=>((0,s.uX)(),(0,s.CE)("div",YL,[(0,s.Lk)("div",{class:"dashboard-header"},[n[4]||(n[4]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Status Change Approval Tasks",-1)),(0,s.Lk)("div",{class:"dashboard-actions"},[(0,s.Lk)("button",{class:"action-btn",onClick:k},n[3]||(n[3]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)]))])]),(0,s.Lk)("div",ZL,[(0,s.Lk)("div",ew,[(0,s.bF)(xa.A,{config:r.value,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=e=>l.value=e),onChange:L},null,8,["config","modelValue"])])]),i.value?((0,s.uX)(),(0,s.CE)("div",tw,n[5]||(n[5]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading status change requests... ")]))):0===t.value.length?((0,s.uX)(),(0,s.CE)("div",iw,n[6]||(n[6]=[(0,s.Lk)("p",null,"No status change requests found.",-1)]))):((0,s.uX)(),(0,s.CE)("div",aw,[c.value.length>0?((0,s.uX)(),(0,s.Wv)(zn,{key:0,sectionConfig:{name:"Pending",statusClass:"pending",tasks:p.value},tableHeaders:u,isExpanded:!0,onTaskClick:h},null,8,["sectionConfig"])):(0,s.Q3)("",!0),(0,s.Lk)("div",sw,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.value.filter(e=>"Pending Approval"!==e.Status),e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ApprovalId,class:"framework-card"},[(0,s.Lk)("div",ow,[(0,s.Lk)("i",{class:(0,d.C4)("policy"===e.ItemType?"fas fa-file-alt":"fas fa-book")},null,2),(0,s.Lk)("span",null,(0,d.v_)(e.FrameworkName||e.PolicyName),1)]),(0,s.Lk)("div",lw,(0,d.v_)("policy"===e.ItemType?"Department":"Category")+": "+(0,d.v_)(e.Category||e.Department),1),(0,s.Lk)("div",nw,(0,d.v_)(e.Reason),1),(0,s.Lk)("div",rw,[(0,s.Lk)("div",cw,[(0,s.Lk)("input",{type:"checkbox",checked:"Approved"===e.Status,disabled:""},null,8,dw),(0,s.Lk)("span",{class:(0,d.C4)(["switch-label",{active:"Rejected"===e.Status||"Pending Approval"===e.Status,inactive:"Approved"===e.Status}])},(0,d.v_)("Approved"===e.Status?"Inactive":"Rejected"===e.Status?"Active":"Pending"),3)]),(0,s.Lk)("div",uw,[(0,s.Lk)("button",{class:"view-btn",onClick:t=>h(e)},n[7]||(n[7]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,pw)])])]))),128))])])),a.value&&o.value?((0,s.uX)(),(0,s.CE)("div",mw,[(0,s.Lk)("div",vw,[(0,s.Lk)("span",{class:"close-x",onClick:g,title:"Close"},"×"),(0,s.Lk)("h3",null,[(0,s.Lk)("span",kw,(0,d.v_)("policy"===o.value.ItemType?"POLICY":"FRAMEWORK")+" STATUS CHANGE REQUEST ",1),(0,s.eW)(" Details: "+(0,d.v_)(o.value.FrameworkName||o.value.PolicyName)+" ",1),(0,s.Lk)("span",hw,"Version: "+(0,d.v_)(o.value.Version),1)]),(0,s.Lk)("div",gw,[n[13]||(n[13]=(0,s.Lk)("h4",null,"Status Change Approval",-1)),n[14]||(n[14]=(0,s.Lk)("div",{class:"framework-status-indicator"},[(0,s.Lk)("span",{class:"status-label"},"Request Type:"),(0,s.Lk)("span",{class:"status-value status-inactive"}," Change Status to Inactive ")],-1)),(0,s.Lk)("div",yw,[n[8]||(n[8]=(0,s.Lk)("span",{class:"status-label"},"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-value",{"status-approved":"Approved"===o.value.Status,"status-inactive":"Rejected"===o.value.Status,"status-pending":"Pending Approval"===o.value.Status}])},(0,d.v_)(o.value.Status),3)]),"Pending Approval"===o.value.Status?((0,s.uX)(),(0,s.CE)("div",fw,[(0,s.Lk)("button",{class:"approve-btn",onClick:n[1]||(n[1]=e=>f(o.value))},n[9]||(n[9]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve (Make Inactive) ")])),(0,s.Lk)("button",{class:"reject-btn",onClick:n[2]||(n[2]=e=>b(o.value))},n[10]||(n[10]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject (Keep Active) ")]))])):((0,s.uX)(),(0,s.CE)("div",bw,[o.value.Remarks?((0,s.uX)(),(0,s.CE)("div",Cw,[n[11]||(n[11]=(0,s.Lk)("strong",null,"Remarks:",-1)),(0,s.eW)(" "+(0,d.v_)(o.value.Remarks),1)])):(0,s.Q3)("",!0),o.value.ApprovedDate?((0,s.uX)(),(0,s.CE)("div",Lw,[n[12]||(n[12]=(0,s.Lk)("strong",null,"Date:",-1)),(0,s.eW)(" "+(0,d.v_)(m(o.value.ApprovedDate)),1)])):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",ww,[(0,s.Lk)("div",Ew,[(0,s.Lk)("strong",null,(0,d.v_)("policy"===o.value.ItemType?"Policy":"Framework")+" Name:",1),(0,s.Lk)("span",null,(0,d.v_)(o.value.FrameworkName||o.value.PolicyName),1)]),(0,s.Lk)("div",Rw,[(0,s.Lk)("strong",null,(0,d.v_)("policy"===o.value.ItemType?"Department":"Category")+":",1),(0,s.Lk)("span",null,(0,d.v_)(o.value.Category||o.value.Department),1)]),(0,s.Lk)("div",Iw,[n[15]||(n[15]=(0,s.Lk)("strong",null,"Request Date:",-1)),n[16]||(n[16]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(m(o.value.RequestDate)),1)]),(0,s.Lk)("div",Dw,[n[17]||(n[17]=(0,s.Lk)("strong",null,"Current Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)({"status-active":"Rejected"===o.value.Status||"Pending Approval"===o.value.Status,"status-inactive":"Approved"===o.value.Status})},(0,d.v_)("Approved"===o.value.Status?"Inactive":"Active"),3)]),(0,s.Lk)("div",Pw,[n[18]||(n[18]=(0,s.Lk)("strong",null,"Reason for Change:",-1)),n[19]||(n[19]=(0,s.eW)()),(0,s.Lk)("span",null,(0,d.v_)(o.value.Reason),1)]),"framework"===o.value.ItemType?((0,s.uX)(),(0,s.CE)("div",_w,[n[20]||(n[20]=(0,s.Lk)("strong",null,"Cascade to Policies:",-1)),(0,s.Lk)("span",{class:(0,d.C4)({"cascade-yes":o.value.CascadeToApproved,"cascade-no":!o.value.CascadeToApproved})},[(0,s.eW)((0,d.v_)(o.value.CascadeToApproved?"Yes":"No")+" ",1),o.value.PolicyCount>0?((0,s.uX)(),(0,s.CE)("span",Aw," ("+(0,d.v_)(o.value.PolicyCount)+" policies will be affected) ",1)):(0,s.Q3)("",!0)],2)])):(0,s.Q3)("",!0),"policy"===o.value.ItemType?((0,s.uX)(),(0,s.CE)("div",Sw,[n[21]||(n[21]=(0,s.Lk)("strong",null,"Cascade to Subpolicies:",-1)),(0,s.Lk)("span",{class:(0,d.C4)({"cascade-yes":o.value.CascadeToSubpolicies,"cascade-no":!o.value.CascadeToSubpolicies})},[(0,s.eW)((0,d.v_)(o.value.CascadeToSubpolicies?"Yes":"No")+" ",1),o.value.SubpolicyCount>0?((0,s.uX)(),(0,s.CE)("span",Tw," ("+(0,d.v_)(o.value.SubpolicyCount)+" subpolicies will be affected) ",1)):(0,s.Q3)("",!0)],2)])):(0,s.Q3)("",!0)]),o.value.AffectedPolicies&&o.value.AffectedPolicies.length>0||o.value.AffectedSubpolicies&&o.value.AffectedSubpolicies.length>0?((0,s.uX)(),(0,s.CE)("div",xw,[(0,s.Lk)("h4",null,(0,d.v_)("policy"===o.value.ItemType?"Affected Subpolicies":"Affected Policies"),1),(0,s.Lk)("p",Fw,["Approved"===o.value.Status?((0,s.uX)(),(0,s.CE)("span",Vw," The following "+(0,d.v_)("policy"===o.value.ItemType?"subpolicies":"policies")+" have been set to Inactive: ",1)):((0,s.uX)(),(0,s.CE)("span",Uw," The following "+(0,d.v_)("policy"===o.value.ItemType?"subpolicies":"policies")+" will become inactive if this request is approved: ",1))]),(0,s.Lk)("div",Nw,["framework"===o.value.ItemType?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.value.AffectedPolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.PolicyId,class:"policy-item"},[(0,s.Lk)("div",Mw,[(0,s.Lk)("span",Xw,(0,d.v_)(e.PolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{active:"Approved"!==o.value.Status,inactive:"Approved"===o.value.Status}])},(0,d.v_)("Approved"===o.value.Status?"Inactive":"Active"),3)]),(0,s.Lk)("div",$w,[e.Identifier?((0,s.uX)(),(0,s.CE)("div",Ow,[n[22]||(n[22]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Identifier),1)])):(0,s.Q3)("",!0),e.Department?((0,s.uX)(),(0,s.CE)("div",jw,[n[23]||(n[23]=(0,s.Lk)("strong",null,"Department:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Department),1)])):(0,s.Q3)("",!0),e.Description?((0,s.uX)(),(0,s.CE)("div",Bw,[n[24]||(n[24]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)])):(0,s.Q3)("",!0)])]))),128)):(0,s.Q3)("",!0),"policy"===o.value.ItemType?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(o.value.AffectedSubpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.SubPolicyId,class:"policy-item"},[(0,s.Lk)("div",Ww,[(0,s.Lk)("span",qw,(0,d.v_)(e.SubPolicyName),1),(0,s.Lk)("span",{class:(0,d.C4)(["policy-status",{active:"Approved"!==o.value.Status,inactive:"Approved"===o.value.Status}])},(0,d.v_)("Approved"===o.value.Status?"Inactive":"Active"),3)]),(0,s.Lk)("div",Qw,[e.Identifier?((0,s.uX)(),(0,s.CE)("div",Kw,[n[25]||(n[25]=(0,s.Lk)("strong",null,"Identifier:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Identifier),1)])):(0,s.Q3)("",!0),e.Control?((0,s.uX)(),(0,s.CE)("div",Jw,[n[26]||(n[26]=(0,s.Lk)("strong",null,"Control:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Control),1)])):(0,s.Q3)("",!0),e.Description?((0,s.uX)(),(0,s.CE)("div",zw,[n[27]||(n[27]=(0,s.Lk)("strong",null,"Description:",-1)),(0,s.eW)(" "+(0,d.v_)(e.Description),1)])):(0,s.Q3)("",!0)])]))),128)):(0,s.Q3)("",!0)]),"Approved"!==o.value.Status?((0,s.uX)(),(0,s.CE)("div",Hw,n[28]||(n[28]=[(0,s.Lk)("div",{class:"summary-warning"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.Lk)("span",null,[(0,s.eW)("All of these policies will be changed to "),(0,s.Lk)("strong",null,"Inactive"),(0,s.eW)(" if the request is approved.")])],-1)]))):(0,s.Q3)("",!0)])):o.value.CascadeToApproved?((0,s.uX)(),(0,s.CE)("div",Gw,n[29]||(n[29]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.Lk)("span",null,"No active policies found that would be affected by this change.",-1)]))):(0,s.Q3)("",!0),"Pending Approval"===o.value.Status?((0,s.uX)(),(0,s.CE)("div",Yw,[n[37]||(n[37]=(0,s.Lk)("h4",null,"Approval Implications",-1)),(0,s.Lk)("div",Zw,[n[36]||(n[36]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("div",eE,[n[32]||(n[32]=(0,s.Lk)("strong",null,"If approved:",-1)),n[33]||(n[33]=(0,s.eW)(" The framework will become ")),n[34]||(n[34]=(0,s.Lk)("span",{class:"status-inactive"},"Inactive",-1)),n[35]||(n[35]=(0,s.eW)(". ")),o.value.CascadeToApproved&&o.value.PolicyCount>0?((0,s.uX)(),(0,s.CE)("span",tE,[n[30]||(n[30]=(0,s.eW)(" Additionally, ")),(0,s.Lk)("strong",null,(0,d.v_)(o.value.PolicyCount)+" approved policies",1),n[31]||(n[31]=(0,s.eW)(" will also become inactive. "))])):(0,s.Q3)("",!0)])]),n[38]||(n[38]=(0,s.Lk)("div",{class:"implication-item info"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("div",{class:"implication-text"},[(0,s.Lk)("strong",null,"If rejected:"),(0,s.eW)(" The framework will remain "),(0,s.Lk)("span",{class:"status-approved"},"Active"),(0,s.eW)(" and no changes will be made. ")])],-1))])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.bF)(Ta)]))}};const aE=(0,le.A)(iE,[["__scopeId","data-v-bec5300c"]]);var sE=aE;const oE={class:"TT-page-wrapper"},lE={class:"TT-toggle-group"},nE={key:0,class:"TT-top-dropdowns"},rE={key:1,class:"TT-top-dropdowns"},cE={key:2},dE={class:"TT-container"},uE={class:"TT-form-group"},pE={class:"TT-form-group"},mE={class:"TT-row"},vE={class:"TT-form-group TT-half"},kE={class:"TT-form-group TT-half"},hE={class:"TT-row"},gE={class:"TT-form-group TT-half"},yE={class:"TT-form-group TT-half"},fE={class:"TT-row"},bE={class:"TT-form-group TT-half"},CE={class:"TT-form-group TT-half"},LE={class:"TT-row"},wE={class:"TT-form-group TT-half"},EE=["value"],RE={class:"TT-form-group TT-half"},IE=["value"],DE={class:"TT-policy-tabs-container"},PE={class:"TT-policy-tabs-row"},_E={class:"TT-policy-tabs"},AE=["onClick"],SE={key:0,class:"TT-policy-form-container"},TE={class:"TT-row"},xE={class:"TT-form-group TT-half"},FE={class:"TT-form-group TT-half"},VE={class:"TT-form-group"},UE={class:"TT-row"},NE={class:"TT-form-group TT-half"},ME={class:"TT-form-group TT-half"},XE={class:"TT-form-group"},$E={class:"TT-row"},OE={class:"TT-form-group TT-half"},jE={class:"TT-form-group TT-half"},BE={class:"TT-row"},WE={class:"TT-form-group TT-half"},qE=["disabled"],QE=["value"],KE={class:"TT-form-group TT-half"},JE=["disabled"],zE=["value"],HE={class:"TT-row"},GE={class:"TT-form-group TT-half"},YE=["disabled"],ZE=["value"],eR={class:"TT-form-group TT-half"},tR={class:"form-row"},iR={class:"form-group entities-group"},aR={class:"entities-dropdown"},sR={class:"entity-content"},oR={key:0,class:"loading-text"},lR={key:1,class:"entity-tag all-tag"},nR={key:2,class:"placeholder"},rR={key:3,class:"entity-count"},cR={key:0,class:"entities-options"},dR={key:0,class:"entities-loading"},uR={key:1,class:"entities-error"},pR=["onClick"],mR=["checked","onChange"],vR={class:"entity-label"},kR={key:0,class:"TT-error-text"},hR={class:"TT-row"},gR={class:"TT-form-group TT-half"},yR={class:"TT-form-group TT-half"},fR={class:"TT-form-group"},bR={key:0,class:"TT-subpolicy-tabs-container"},CR={class:"TT-subpolicy-tabs-row"},LR={class:"TT-subpolicy-tabs"},wR=["onClick"],ER={key:0,class:"TT-subpolicy-form-container"},RR={class:"TT-form-group"},IR={class:"TT-form-group"},DR={class:"TT-form-group"},PR={class:"TT-form-group"},_R={key:3},AR={key:4,class:"TT-universal-submit-wrapper"},SR={key:5},TR={class:"TT-policy-tabs-container"},xR={class:"TT-policy-tabs-row"},FR={class:"TT-policy-tabs"},VR=["onClick"],UR={key:0,class:"TT-policy-form-container"},NR={class:"TT-row"},MR={class:"TT-form-group TT-half"},XR={class:"TT-form-group TT-half"},$R={class:"TT-form-group"},OR={class:"TT-row"},jR={class:"TT-form-group TT-half"},BR={class:"TT-form-group TT-half"},WR={class:"TT-form-group"},qR={class:"TT-row"},QR={class:"TT-form-group TT-half"},KR={class:"TT-form-group TT-half"},JR={class:"TT-row"},zR={class:"TT-form-group TT-half"},HR=["disabled"],GR=["value"],YR={class:"TT-form-group TT-half"},ZR=["disabled"],eI=["value"],tI={class:"TT-row"},iI={class:"TT-form-group TT-half"},aI=["disabled"],sI=["value"],oI={class:"TT-form-group TT-half"},lI={class:"form-row"},nI={class:"form-group entities-group"},rI={class:"entities-dropdown"},cI={class:"entity-content"},dI={key:0,class:"loading-text"},uI={key:1,class:"entity-tag all-tag"},pI={key:2,class:"placeholder"},mI={key:3,class:"entity-count"},vI={key:0,class:"entities-options"},kI={key:0,class:"entities-loading"},hI={key:1,class:"entities-error"},gI=["onClick"],yI=["checked","onChange"],fI={class:"entity-label"},bI={class:"TT-row"},CI={class:"TT-form-group TT-half"},LI={class:"TT-form-group TT-half"},wI={class:"TT-form-group"},EI={key:0,class:"TT-row"},RI={class:"TT-form-group TT-half"},II=["value"],DI={class:"TT-form-group TT-half"},PI=["value"],_I={key:0,class:"TT-subpolicy-tabs-container"},AI={class:"TT-subpolicy-tabs-row"},SI={class:"TT-subpolicy-tabs"},TI=["onClick"],xI={key:0,class:"TT-subpolicy-form-container"},FI={class:"TT-form-group"},VI={class:"TT-form-group"},UI={class:"TT-form-group"},NI={class:"TT-form-group"},MI={key:6,class:"TT-universal-submit-wrapper"};function XI(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)("div",oE,[(0,s.bF)(r),t[179]||(t[179]=(0,s.Lk)("div",{class:"tt-page-header"},[(0,s.Lk)("h2",null,"Tailoring & Templating"),(0,s.Lk)("p",{class:"tt-page-description"},"Only Internal Frameworks can be tailored")],-1)),(0,s.Lk)("div",lE,[(0,s.Lk)("button",{class:(0,d.C4)(["TT-toggle",{"TT-active":"framework"===l.selectedTab}]),onClick:t[0]||(t[0]=e=>n.selectTab("framework"))},"Framework",2),(0,s.Lk)("button",{class:(0,d.C4)(["TT-toggle",{"TT-active":"policy"===l.selectedTab}]),onClick:t[1]||(t[1]=e=>n.selectTab("policy"))},"Policy",2)]),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",nE,[(0,s.bF)(c,{modelValue:l.selectedFramework,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:`${e.name} (${e.category||"No Category"}) - ${e.status||"No Status"}`})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"340px"}},null,8,["modelValue","config"])])):((0,s.uX)(),(0,s.CE)("div",rE,[(0,s.bF)(c,{modelValue:l.selectedFramework,"onUpdate:modelValue":t[3]||(t[3]=e=>l.selectedFramework=e),config:{label:"Framework",values:l.frameworks.map(e=>({value:e.id,label:`${e.name} (${e.category||"No Category"}) - ${e.status||"No Status"}`})),defaultLabel:"Select Framework"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"]),(0,s.bF)(c,{modelValue:l.selectedPolicy,"onUpdate:modelValue":t[4]||(t[4]=e=>l.selectedPolicy=e),config:{label:"Policy",values:l.policies.map(e=>({value:e.id,label:`${e.name} (${e.status||"No Status"})`})),defaultLabel:"Select Policy"},showSearchBar:!0,style:{"min-width":"300px","max-width":"360px",width:"360px"}},null,8,["modelValue","config"])])),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",cE,[(0,s.Lk)("div",dE,[(0,s.Lk)("form",{onSubmit:t[14]||(t[14]=(0,a.D$)((...t)=>e.submitFramework&&e.submitFramework(...t),["prevent"]))},[(0,s.Lk)("div",uE,[t[76]||(t[76]=(0,s.Lk)("label",{class:"TT-label"},"FRAMEWORK NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[5]||(t[5]=e=>l.frameworkForm.name=e),type:"text",required:"",placeholder:"Enter Framework name"},null,512),[[a.Jo,l.frameworkForm.name]]),t[77]||(t[77]=(0,s.Lk)("small",{class:"TT-desc"},"Enter a descriptive name for your framework",-1))]),(0,s.Lk)("div",pE,[t[78]||(t[78]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[6]||(t[6]=e=>l.frameworkForm.description=e),rows:"3",required:"",placeholder:"Enter framework description"},null,512),[[a.Jo,l.frameworkForm.description]]),t[79]||(t[79]=(0,s.Lk)("small",{class:"TT-desc"},"Describe the purpose, scope, and objectives of this framework",-1))]),(0,s.Lk)("div",mE,[(0,s.Lk)("div",vE,[t[80]||(t[80]=(0,s.Lk)("label",{class:"TT-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[7]||(t[7]=e=>l.frameworkForm.identifier=e),type:"text",required:"",placeholder:"Enter Identifier"},null,512),[[a.Jo,l.frameworkForm.identifier]]),t[81]||(t[81]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'FW-001' or 'ISO-27001'",-1))]),(0,s.Lk)("div",kE,[t[82]||(t[82]=(0,s.Lk)("label",{class:"TT-label"},"CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[8]||(t[8]=e=>l.frameworkForm.category=e),type:"text",required:"",placeholder:"Enter category"},null,512),[[a.Jo,l.frameworkForm.category]]),t[83]||(t[83]=(0,s.Lk)("small",{class:"TT-desc"},"e.g., Security, Compliance, Risk Management, etc.",-1))])]),(0,s.Lk)("div",hE,[(0,s.Lk)("div",gE,[t[85]||(t[85]=(0,s.Lk)("label",{class:"TT-label"},"INTERNAL/EXTERNAL *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[9]||(t[9]=e=>l.frameworkForm.internalExternal=e),required:""},t[84]||(t[84]=[(0,s.Lk)("option",{value:"",disabled:""},"Select Type",-1),(0,s.Lk)("option",{value:"Internal"},"Internal",-1),(0,s.Lk)("option",{value:"External"},"External",-1)]),512),[[a.u1,l.frameworkForm.internalExternal]]),t[86]||(t[86]=(0,s.Lk)("small",{class:"TT-desc"},"Select whether this framework is for internal or external use",-1))]),(0,s.Lk)("div",yE,[t[87]||(t[87]=(0,s.Lk)("label",{class:"TT-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"TT-input",type:"file",onChange:t[10]||(t[10]=(...e)=>n.handleFileUpload&&n.handleFileUpload(...e))},null,32),t[88]||(t[88]=(0,s.Lk)("small",{class:"TT-desc"},"Upload a supporting document for this framework (optional)",-1))])]),(0,s.Lk)("div",fE,[(0,s.Lk)("div",bE,[t[89]||(t[89]=(0,s.Lk)("label",{class:"TT-label"},"EFFECTIVE START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[11]||(t[11]=e=>l.frameworkForm.startDate=e),type:"date",required:""},null,512),[[a.Jo,l.frameworkForm.startDate]]),t[90]||(t[90]=(0,s.Lk)("small",{class:"TT-desc"},"Date when the framework implementation begins",-1))]),(0,s.Lk)("div",CE,[t[91]||(t[91]=(0,s.Lk)("label",{class:"TT-label"},"EFFECTIVE END DATE",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[12]||(t[12]=e=>l.frameworkForm.endDate=e),type:"date"},null,512),[[a.Jo,l.frameworkForm.endDate]]),t[92]||(t[92]=(0,s.Lk)("small",{class:"TT-desc"},"Date when the framework expires or requires review",-1))])]),(0,s.Lk)("div",LE,[(0,s.Lk)("div",wE,[t[93]||(t[93]=(0,s.Lk)("label",{class:"TT-label"},"CREATED BY *",-1)),(0,s.Lk)("input",{class:"TT-input",value:l.loggedInUsername,type:"text",disabled:""},null,8,EE),t[94]||(t[94]=(0,s.Lk)("small",{class:"TT-desc"},"Automatically set to logged in user",-1))]),(0,s.Lk)("div",RE,[t[96]||(t[96]=(0,s.Lk)("label",{class:"TT-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[13]||(t[13]=e=>l.frameworkForm.reviewer=e),required:""},[t[95]||(t[95]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,IE))),128))],512),[[a.u1,l.frameworkForm.reviewer]]),t[97]||(t[97]=(0,s.Lk)("small",{class:"TT-desc"},"Select who will review this framework",-1))])])],32)]),(0,s.Lk)("div",DE,[(0,s.Lk)("div",PE,[(0,s.Lk)("div",_E,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-policy-tab",{"TT-policy-tab-active":t===l.activePolicyTab}]),onClick:e=>l.activePolicyTab=t}," Policy "+(0,d.v_)(t+1),11,AE))),128)),(0,s.Lk)("button",{class:"TT-add-policy-tab",onClick:t[15]||(t[15]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",SE,[(0,s.Lk)("button",{class:"TT-exclude-policy-btn",onClick:t[16]||(t[16]=e=>n.excludePolicyTab(l.activePolicyTab))},"Exclude"),((0,s.uX)(),(0,s.CE)("form",{onSubmit:t[37]||(t[37]=(0,a.D$)(e=>n.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",TE,[(0,s.Lk)("div",xE,[t[98]||(t[98]=(0,s.Lk)("label",{class:"TT-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[17]||(t[17]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].name]]),t[99]||(t[99]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",FE,[t[100]||(t[100]=(0,s.Lk)("label",{class:"TT-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[18]||(t[18]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].identifier]]),t[101]||(t[101]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",VE,[t[102]||(t[102]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[19]||(t[19]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].description]]),t[103]||(t[103]=(0,s.Lk)("small",{class:"TT-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",UE,[(0,s.Lk)("div",NE,[t[104]||(t[104]=(0,s.Lk)("label",{class:"TT-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[20]||(t[20]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].scope]]),t[105]||(t[105]=(0,s.Lk)("small",{class:"TT-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",ME,[t[106]||(t[106]=(0,s.Lk)("label",{class:"TT-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[21]||(t[21]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].department]]),t[107]||(t[107]=(0,s.Lk)("small",{class:"TT-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",XE,[t[108]||(t[108]=(0,s.Lk)("label",{class:"TT-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[22]||(t[22]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].objective]]),t[109]||(t[109]=(0,s.Lk)("small",{class:"TT-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",$E,[(0,s.Lk)("div",OE,[t[110]||(t[110]=(0,s.Lk)("label",{class:"TT-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[23]||(t[23]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),t[111]||(t[111]=(0,s.Lk)("small",{class:"TT-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",jE,[t[112]||(t[112]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[24]||(t[24]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].applicability]]),t[113]||(t[113]=(0,s.Lk)("small",{class:"TT-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",BE,[(0,s.Lk)("div",WE,[t[115]||(t[115]=(0,s.Lk)("label",{class:"TT-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[25]||(t[25]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:t[26]||(t[26]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),disabled:l.policyTabs[l.activePolicyTab].exclude,required:""},[t[114]||(t[114]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,QE))),128))],40,qE),[[a.u1,l.policyTabs[l.activePolicyTab].type]])]),(0,s.Lk)("div",KE,[t[117]||(t[117]=(0,s.Lk)("label",{class:"TT-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[27]||(t[27]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:t[28]||(t[28]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type||l.policyTabs[l.activePolicyTab].exclude,required:""},[t[116]||(t[116]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getCategoriesForType(l.policyTabs[l.activePolicyTab].type),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,zE))),128))],40,JE),[[a.u1,l.policyTabs[l.activePolicyTab].category]])])]),(0,s.Lk)("div",HE,[(0,s.Lk)("div",GE,[t[119]||(t[119]=(0,s.Lk)("label",{class:"TT-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[29]||(t[29]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),onChange:t[30]||(t[30]=e=>n.handlePolicySubCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].category||l.policyTabs[l.activePolicyTab].exclude,required:""},[t[118]||(t[118]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSubCategoriesForCategory(l.policyTabs[l.activePolicyTab].type,l.policyTabs[l.activePolicyTab].category),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,ZE))),128))],40,YE),[[a.u1,l.policyTabs[l.activePolicyTab].subCategory]])]),(0,s.Lk)("div",eR,[t[121]||(t[121]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",tR,[(0,s.Lk)("div",iR,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:t[33]||(t[33]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",aR,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:t[31]||(t[31]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",sR,[l.loading?((0,s.uX)(),(0,s.CE)("span",oR," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",lR," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",nR," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",rR,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),t[120]||(t[120]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",cR,[l.loading?((0,s.uX)(),(0,s.CE)("div",dR," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",uR,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:t=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:t=>n.handleEntitySelection(l.activePolicyTab,e.id,t.target.checked),onClick:t[32]||(t[32]=(0,a.D$)(()=>{},["stop"]))},null,40,mR),(0,s.Lk)("span",vR,(0,d.v_)(e.label),1)],10,pR))),128))])):(0,s.Q3)("",!0)])])])]),l.error&&l.error.includes("entities")?((0,s.uX)(),(0,s.CE)("small",kR,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",hR,[(0,s.Lk)("div",gR,[t[122]||(t[122]=(0,s.Lk)("label",{class:"TT-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[34]||(t[34]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].startDate]]),t[123]||(t[123]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",yR,[t[124]||(t[124]=(0,s.Lk)("label",{class:"TT-label"},"END DATE",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[35]||(t[35]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].endDate]]),t[125]||(t[125]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("div",fR,[t[126]||(t[126]=(0,s.Lk)("label",{class:"TT-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"TT-input",type:"file",onChange:t[36]||(t[36]=e=>n.handlePolicyFileUpload(e,l.activePolicyTab))},null,32),t[127]||(t[127]=(0,s.Lk)("small",{class:"TT-desc"},"Upload supporting documentation (optional)",-1))])],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",bR,[(0,s.Lk)("div",CR,[(0,s.Lk)("div",LR,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-subpolicy-tab",{"TT-subpolicy-tab-active":t===l.policyTabs[l.activePolicyTab].activeSubPolicyTab}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=t}," Subpolicy "+(0,d.v_)(t+1),11,wR))),128)),(0,s.Lk)("button",{class:"TT-add-subpolicy-tab",onClick:t[38]||(t[38]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",ER,[(0,s.Lk)("button",{class:"TT-exclude-subpolicy-btn",onClick:t[39]||(t[39]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},"Exclude"),(0,s.Lk)("form",null,[(0,s.Lk)("div",RR,[t[128]||(t[128]=(0,s.Lk)("label",{class:"TT-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[40]||(t[40]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),t[129]||(t[129]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",IR,[t[130]||(t[130]=(0,s.Lk)("label",{class:"TT-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[41]||(t[41]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),t[131]||(t[131]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",DR,[t[132]||(t[132]=(0,s.Lk)("label",{class:"TT-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[42]||(t[42]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),t[133]||(t[133]=(0,s.Lk)("small",{class:"TT-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",PR,[t[134]||(t[134]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[43]||(t[43]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),t[135]||(t[135]=(0,s.Lk)("small",{class:"TT-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):"framework"!==l.selectedTab||l.selectedFramework?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",_R)),"framework"===l.selectedTab&&l.selectedFramework?((0,s.uX)(),(0,s.CE)("div",AR,[(0,s.Lk)("button",{class:"TT-universal-submit-btn",onClick:t[44]||(t[44]=(...e)=>n.submitTailoredFramework&&n.submitTailoredFramework(...e))},"Submit")])):(0,s.Q3)("",!0),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",SR,[(0,s.Lk)("div",TR,[(0,s.Lk)("div",xR,[(0,s.Lk)("div",FR,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-policy-tab",{"TT-policy-tab-active":t===l.activePolicyTab}]),onClick:e=>l.activePolicyTab=t}," Policy "+(0,d.v_)(t+1),11,VR))),128)),"framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"TT-add-policy-tab",onClick:t[45]||(t[45]=(...e)=>n.addPolicyTab&&n.addPolicyTab(...e))},"+ Add Policy")):(0,s.Q3)("",!0)])]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",UR,["framework"===l.selectedTab?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"TT-exclude-policy-btn",onClick:t[46]||(t[46]=e=>n.excludePolicyTab(l.activePolicyTab))},"Exclude")):(0,s.Q3)("",!0),((0,s.uX)(),(0,s.CE)("form",{onSubmit:t[68]||(t[68]=(0,a.D$)(e=>n.submitPolicy(l.activePolicyTab),["prevent"])),key:l.policyTabs[l.activePolicyTab].id},[(0,s.Lk)("div",NR,[(0,s.Lk)("div",MR,[t[136]||(t[136]=(0,s.Lk)("label",{class:"TT-label"},"POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[47]||(t[47]=e=>l.policyTabs[l.activePolicyTab].name=e),type:"text",required:"",placeholder:"Enter policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].name]]),t[137]||(t[137]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear, descriptive name",-1))]),(0,s.Lk)("div",XR,[t[138]||(t[138]=(0,s.Lk)("label",{class:"TT-label"},"POLICY IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[48]||(t[48]=e=>l.policyTabs[l.activePolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter policy identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].identifier]]),t[139]||(t[139]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'POL-001'",-1))])]),(0,s.Lk)("div",$R,[t[140]||(t[140]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[49]||(t[49]=e=>l.policyTabs[l.activePolicyTab].description=e),rows:"3",required:"",placeholder:"Enter policy description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].description]]),t[141]||(t[141]=(0,s.Lk)("small",{class:"TT-desc"},"Describe the policy's purpose, requirements, and key provisions",-1))]),(0,s.Lk)("div",OR,[(0,s.Lk)("div",jR,[t[142]||(t[142]=(0,s.Lk)("label",{class:"TT-label"},"SCOPE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[50]||(t[50]=e=>l.policyTabs[l.activePolicyTab].scope=e),type:"text",required:"",placeholder:"Enter policy scope"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].scope]]),t[143]||(t[143]=(0,s.Lk)("small",{class:"TT-desc"},"Specify what areas/processes/systems policy applies to",-1))]),(0,s.Lk)("div",BR,[t[144]||(t[144]=(0,s.Lk)("label",{class:"TT-label"},"DEPARTMENT *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[51]||(t[51]=e=>l.policyTabs[l.activePolicyTab].department=e),type:"text",required:"",placeholder:"Enter department"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].department]]),t[145]||(t[145]=(0,s.Lk)("small",{class:"TT-desc"},"e.g., IT, HR, Finance, Legal, Operations",-1))])]),(0,s.Lk)("div",WR,[t[146]||(t[146]=(0,s.Lk)("label",{class:"TT-label"},"OBJECTIVE *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[52]||(t[52]=e=>l.policyTabs[l.activePolicyTab].objective=e),rows:"3",required:"",placeholder:"Enter policy objective"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].objective]]),t[147]||(t[147]=(0,s.Lk)("small",{class:"TT-desc"},"Explain what this policy is designed to accomplish",-1))]),(0,s.Lk)("div",qR,[(0,s.Lk)("div",QR,[t[148]||(t[148]=(0,s.Lk)("label",{class:"TT-label"},"COVERAGE RATE (%) *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[53]||(t[53]=e=>l.policyTabs[l.activePolicyTab].coverageRate=e),type:"number",min:"0",max:"100",step:"0.01",required:"",placeholder:"Enter coverage rate"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].coverageRate]]),t[149]||(t[149]=(0,s.Lk)("small",{class:"TT-desc"},"Range: 0-100, step: 0.01",-1))]),(0,s.Lk)("div",KR,[t[150]||(t[150]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABILITY *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[54]||(t[54]=e=>l.policyTabs[l.activePolicyTab].applicability=e),type:"text",required:"",placeholder:"Enter applicability"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].applicability]]),t[151]||(t[151]=(0,s.Lk)("small",{class:"TT-desc"},"Define the target audience, roles, or entities",-1))])]),(0,s.Lk)("div",JR,[(0,s.Lk)("div",zR,[t[153]||(t[153]=(0,s.Lk)("label",{class:"TT-label"},"POLICY TYPE *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[55]||(t[55]=e=>l.policyTabs[l.activePolicyTab].type=e),onChange:t[56]||(t[56]=e=>n.handlePolicyTypeChange(l.activePolicyTab,e.target.value)),disabled:l.policyTabs[l.activePolicyTab].exclude,required:""},[t[152]||(t[152]=(0,s.Lk)("option",{value:""},"Select Policy Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTypes,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,GR))),128))],40,HR),[[a.u1,l.policyTabs[l.activePolicyTab].type]])]),(0,s.Lk)("div",YR,[t[155]||(t[155]=(0,s.Lk)("label",{class:"TT-label"},"POLICY CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[57]||(t[57]=e=>l.policyTabs[l.activePolicyTab].category=e),onChange:t[58]||(t[58]=e=>n.handlePolicyCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].type||l.policyTabs[l.activePolicyTab].exclude,required:""},[t[154]||(t[154]=(0,s.Lk)("option",{value:""},"Select Policy Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getCategoriesForType(l.policyTabs[l.activePolicyTab].type),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,eI))),128))],40,ZR),[[a.u1,l.policyTabs[l.activePolicyTab].category]])])]),(0,s.Lk)("div",tI,[(0,s.Lk)("div",iI,[t[157]||(t[157]=(0,s.Lk)("label",{class:"TT-label"},"POLICY SUB CATEGORY *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[59]||(t[59]=e=>l.policyTabs[l.activePolicyTab].subCategory=e),onChange:t[60]||(t[60]=e=>n.handlePolicySubCategoryChange(l.activePolicyTab,e.target.value)),disabled:!l.policyTabs[l.activePolicyTab].category||l.policyTabs[l.activePolicyTab].exclude,required:""},[t[156]||(t[156]=(0,s.Lk)("option",{value:""},"Select Policy Sub Category",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSubCategoriesForCategory(l.policyTabs[l.activePolicyTab].type,l.policyTabs[l.activePolicyTab].category),e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,sI))),128))],40,aI),[[a.u1,l.policyTabs[l.activePolicyTab].subCategory]])]),(0,s.Lk)("div",oI,[t[159]||(t[159]=(0,s.Lk)("label",{class:"TT-label"},"APPLICABLE ENTITIES *",-1)),(0,s.Lk)("div",lI,[(0,s.Lk)("div",nI,[(0,s.Lk)("div",{class:"entities-multi-select",onClick:t[63]||(t[63]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",rI,[(0,s.Lk)("div",{class:(0,d.C4)(["selected-entities",{active:l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown,error:l.error&&l.error.includes("entities")}]),onClick:t[61]||(t[61]=e=>n.toggleEntitiesDropdown(l.activePolicyTab))},[(0,s.Lk)("div",cI,[l.loading?((0,s.uX)(),(0,s.CE)("span",dI," Loading entities... ")):n.isAllEntitiesSelected(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",uI," All Locations ")):0===n.getSelectedEntitiesCount(l.activePolicyTab)?((0,s.uX)(),(0,s.CE)("span",pI," Select entities... ")):((0,s.uX)(),(0,s.CE)("span",mI,(0,d.v_)(n.getSelectedEntitiesCount(l.activePolicyTab))+" location(s) selected ",1))]),t[158]||(t[158]=(0,s.Lk)("i",{class:"fas fa-chevron-down dropdown-arrow"},null,-1))],2),l.policyTabs[l.activePolicyTab]?.showEntitiesDropdown?((0,s.uX)(),(0,s.CE)("div",vI,[l.loading?((0,s.uX)(),(0,s.CE)("div",kI," Loading entities... ")):l.error?((0,s.uX)(),(0,s.CE)("div",hI,(0,d.v_)(l.error),1)):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.entities,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:(0,d.C4)(["entity-option",{"all-option":"all"===e.id}]),onClick:t=>n.selectEntity(l.activePolicyTab,e.id)},[(0,s.Lk)("input",{type:"checkbox",checked:"all"===e.id?n.isAllEntitiesSelected(l.activePolicyTab):n.isEntitySelected(l.activePolicyTab,e.id),onChange:t=>n.handleEntitySelection(l.activePolicyTab,e.id,t.target.checked),onClick:t[62]||(t[62]=(0,a.D$)(()=>{},["stop"]))},null,40,yI),(0,s.Lk)("span",fI,(0,d.v_)(e.label),1)],10,gI))),128))])):(0,s.Q3)("",!0)])])])])])]),(0,s.Lk)("div",bI,[(0,s.Lk)("div",CI,[t[160]||(t[160]=(0,s.Lk)("label",{class:"TT-label"},"START DATE *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[64]||(t[64]=e=>l.policyTabs[l.activePolicyTab].startDate=e),type:"date",required:""},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].startDate]]),t[161]||(t[161]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy takes effect",-1))]),(0,s.Lk)("div",LI,[t[162]||(t[162]=(0,s.Lk)("label",{class:"TT-label"},"END DATE",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[65]||(t[65]=e=>l.policyTabs[l.activePolicyTab].endDate=e),type:"date"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].endDate]]),t[163]||(t[163]=(0,s.Lk)("small",{class:"TT-desc"},"Date when this policy expires or requires review/renewal",-1))])]),(0,s.Lk)("div",wI,[t[164]||(t[164]=(0,s.Lk)("label",{class:"TT-label"},"UPLOAD DOCUMENT",-1)),(0,s.Lk)("input",{class:"TT-input",type:"file",onChange:t[66]||(t[66]=e=>n.handlePolicyFileUpload(e,l.activePolicyTab))},null,32),t[165]||(t[165]=(0,s.Lk)("small",{class:"TT-desc"},"Upload supporting documentation (optional)",-1))]),"policy"===l.selectedTab?((0,s.uX)(),(0,s.CE)("div",EI,[(0,s.Lk)("div",RI,[t[166]||(t[166]=(0,s.Lk)("label",{class:"TT-label"},"CREATED BY *",-1)),(0,s.Lk)("input",{class:"TT-input",value:l.loggedInUsername,type:"text",disabled:""},null,8,II),t[167]||(t[167]=(0,s.Lk)("small",{class:"TT-desc"},"Automatically set to logged in user",-1))]),(0,s.Lk)("div",DI,[t[169]||(t[169]=(0,s.Lk)("label",{class:"TT-label"},"REVIEWER *",-1)),(0,s.bo)((0,s.Lk)("select",{class:"TT-input","onUpdate:modelValue":t[67]||(t[67]=e=>l.policyTabs[l.activePolicyTab].reviewer=e),required:""},[t[168]||(t[168]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.name},(0,d.v_)(e.name),9,PI))),128))],512),[[a.u1,l.policyTabs[l.activePolicyTab].reviewer]]),t[170]||(t[170]=(0,s.Lk)("small",{class:"TT-desc"},"Select who will review this policy",-1))])])):(0,s.Q3)("",!0)],32))])):(0,s.Q3)("",!0)]),l.policyTabs.length&&l.policyTabs[l.activePolicyTab]?((0,s.uX)(),(0,s.CE)("div",_I,[(0,s.Lk)("div",AI,[(0,s.Lk)("div",SI,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policyTabs[l.activePolicyTab].subPolicies,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["TT-subpolicy-tab",{"TT-subpolicy-tab-active":t===l.policyTabs[l.activePolicyTab].activeSubPolicyTab}]),onClick:e=>l.policyTabs[l.activePolicyTab].activeSubPolicyTab=t}," Subpolicy "+(0,d.v_)(t+1),11,TI))),128)),(0,s.Lk)("button",{class:"TT-add-subpolicy-tab",onClick:t[69]||(t[69]=e=>n.addSubPolicyTab(l.activePolicyTab))},"+ Add Sub Policy")])]),l.policyTabs[l.activePolicyTab].subPolicies&&l.policyTabs[l.activePolicyTab].subPolicies.length?((0,s.uX)(),(0,s.CE)("div",xI,[(0,s.Lk)("button",{class:"TT-exclude-subpolicy-btn",onClick:t[70]||(t[70]=e=>n.excludeSubPolicyTab(l.activePolicyTab,l.policyTabs[l.activePolicyTab].activeSubPolicyTab))},"Exclude"),(0,s.Lk)("form",null,[(0,s.Lk)("div",FI,[t[171]||(t[171]=(0,s.Lk)("label",{class:"TT-label"},"SUB POLICY NAME *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[71]||(t[71]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name=e),type:"text",required:"",placeholder:"Enter sub policy name"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].name]]),t[172]||(t[172]=(0,s.Lk)("small",{class:"TT-desc"},"Use a clear name that describes this sub-policy's specific focus",-1))]),(0,s.Lk)("div",VI,[t[173]||(t[173]=(0,s.Lk)("label",{class:"TT-label"},"IDENTIFIER *",-1)),(0,s.bo)((0,s.Lk)("input",{class:"TT-input","onUpdate:modelValue":t[72]||(t[72]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier=e),type:"text",required:"",placeholder:"Enter identifier"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].identifier]]),t[174]||(t[174]=(0,s.Lk)("small",{class:"TT-desc"},"Use a unique code like 'SUB-001' or append to parent policy ID",-1))]),(0,s.Lk)("div",UI,[t[175]||(t[175]=(0,s.Lk)("label",{class:"TT-label"},"CONTROL *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[73]||(t[73]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control=e),rows:"3",required:"",placeholder:"Enter control"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].control]]),t[176]||(t[176]=(0,s.Lk)("small",{class:"TT-desc"},"Specify the control mechanisms, procedures, or safeguards to be implemented",-1))]),(0,s.Lk)("div",NI,[t[177]||(t[177]=(0,s.Lk)("label",{class:"TT-label"},"DESCRIPTION *",-1)),(0,s.bo)((0,s.Lk)("textarea",{class:"TT-textarea","onUpdate:modelValue":t[74]||(t[74]=e=>l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description=e),rows:"3",required:"",placeholder:"Enter description"},null,512),[[a.Jo,l.policyTabs[l.activePolicyTab].subPolicies[l.policyTabs[l.activePolicyTab].activeSubPolicyTab].description]]),t[178]||(t[178]=(0,s.Lk)("small",{class:"TT-desc"},"Explain the intent, requirements, or significance of this sub-policy",-1))])])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),"policy"===l.selectedTab&&l.selectedFramework&&l.selectedPolicy?((0,s.uX)(),(0,s.CE)("div",MI,[(0,s.Lk)("button",{class:"TT-universal-submit-btn",onClick:t[75]||(t[75]=(...e)=>n.submitTailoredPolicy&&n.submitTailoredPolicy(...e))},"Submit")])):(0,s.Q3)("",!0)])}const $I="http://localhost:8000/api";var OI={name:"TT",components:{CustomDropdown:xa.A,PopupModal:Ta},data(){return{selectedTab:"framework",selectedFramework:"",selectedPolicy:"",frameworks:[],policies:[],policyTypes:[],policyCategories:[],policySubCategories:[],policyData:[],users:[],loggedInUsername:localStorage.getItem("user_name")||"",frameworkForm:{name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:"",createdByName:"",reviewer:""},policyTabs:[],activePolicyTab:0,loading:!1,error:null,entities:[]}},watch:{selectedFramework(e){"framework"===this.selectedTab?this.handleFrameworkSelection(e):"policy"===this.selectedTab&&e&&(console.log("Framework selected in policy tab:",e),this.fetchPoliciesByFramework(e))},selectedPolicy(e){"policy"===this.selectedTab&&this.selectedFramework&&e&&(console.log("Policy selected:",e),this.fetchPolicyDetails(e))},selectedTab(e){"framework"===e?(this.selectedPolicy="",this.fetchFrameworks(),this.selectedFramework&&this.handleFrameworkSelection(this.selectedFramework)):"policy"===e&&(this.selectedPolicy="",this.policyTabs=[],this.fetchFrameworks())},"policyTabs[activePolicyTab].type":{immediate:!0,handler(e){console.log("Policy type changed to:",e),this.updatePolicyCategoriesByType(e)}},"policyTabs[activePolicyTab].category":{immediate:!0,handler(e){console.log("Policy category changed to:",e);const t=this.policyTabs[this.activePolicyTab]?.type;this.updateSubCategoriesByCategory(t,e)}}},async created(){try{await Promise.all([this.fetchFrameworks(),this.fetchPolicyCategories(),this.fetchEntities(),this.fetchUsers()])}catch(e){console.error("Error in component creation:",e),this.error="Failed to initialize component"}},methods:{selectTab(e){this.selectedTab=e},handleFileUpload(e){this.frameworkForm.file=e.target.files[0]},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async fetchFrameworks(){try{this.loading=!0;const e=await He.A.get(`${$I}/frameworks/`);console.log("Raw framework response:",e.data);const t=e.data.map(e=>({id:e.FrameworkId,name:e.FrameworkName,description:e.FrameworkDescription,category:e.Category,internalExternal:e.InternalExternal,startDate:e.StartDate,endDate:e.EndDate,status:e.Status}));this.frameworks="framework"===this.selectedTab?t.filter(e=>"Internal"===e.internalExternal):t,console.log("Mapped frameworks:",this.frameworks)}catch(e){console.error("Error fetching frameworks:",e),this.error="Failed to fetch frameworks"}finally{this.loading=!1}},async fetchPoliciesByFramework(e){try{this.loading=!0;const t=await He.A.get(`${$I}/frameworks/${e}/get-policies/`);console.log("Raw policies response:",t.data),this.policies=t.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive).map(e=>({id:e.PolicyId,name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate})),console.log("Mapped and filtered policies:",this.policies)}catch(t){console.error("Error fetching policies:",t),this.error="Failed to fetch policies"}finally{this.loading=!1}},async fetchPolicyDetails(e){try{this.loading=!0,console.log("Fetching policy details for ID:",e);const[t,i]=await Promise.all([He.A.get(`${$I}/policies/${e}/`),He.A.get(`${$I}/policies/${e}/get-subpolicies/`)]);console.log("Raw policy details:",t.data),console.log("Raw subpolicies:",i.data);const a=t.data,s=i.data.map(e=>({id:e.SubPolicyId,name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status})),o={id:a.PolicyId,name:a.PolicyName,description:a.PolicyDescription,status:a.Status,department:a.Department,scope:a.Scope,objective:a.Objective,identifier:a.Identifier,coverageRate:a.CoverageRate,applicability:a.Applicability,type:a.PolicyType,category:a.PolicyCategory,subCategory:a.PolicySubCategory,entities:a.Entities,startDate:a.StartDate,endDate:a.EndDate,file:null,createdByName:a.CreatedByName,reviewer:a.Reviewer,subPolicies:s,activeSubPolicyTab:0};console.log("Created policy tab:",o),this.policyTabs=[o],this.activePolicyTab=0,console.log("Updated policyTabs:",this.policyTabs),console.log("Active policy tab index:",this.activePolicyTab)}catch(t){console.error("Error fetching policy details:",t),this.error="Failed to fetch policy details",this.policyTabs=[],this.activePolicyTab=0}finally{this.loading=!1}},async submitTailoredFramework(){if(this.validateForm("framework"))try{this.loading=!0;const e={title:this.frameworkForm.name,description:this.frameworkForm.description,identifier:this.frameworkForm.identifier,category:this.frameworkForm.category,internalExternal:this.frameworkForm.internalExternal,startDate:this.frameworkForm.startDate,endDate:this.frameworkForm.endDate,createdByName:this.loggedInUsername,reviewer:this.frameworkForm.reviewer,policies:this.policyTabs.map(e=>{let t=e.entities;return Array.isArray(t)&&(t=Array.from(t).map(Number)),(!t||Array.isArray(t)&&0===t.length)&&(t=[]),{title:e.name,description:e.description,identifier:e.identifier,department:e.department,scope:e.scope,objective:e.objective,coverageRate:e.coverageRate,applicability:e.applicability,PolicyType:e.type,PolicyCategory:e.category,PolicySubCategory:e.subCategory,Entities:t,startDate:e.startDate,endDate:e.endDate,createdByName:"framework"===this.selectedTab?this.loggedInUsername:e.createdByName,reviewer:"framework"===this.selectedTab?this.frameworkForm.reviewer:e.reviewer,subPolicies:e.subPolicies.map(t=>({title:t.name,identifier:t.identifier,description:t.description,control:t.control,createdByName:"framework"===this.selectedTab?this.loggedInUsername:e.createdByName}))}})};console.log("Submitting framework data:",e);const t=await He.A.post(`${$I}/tailoring/create-framework/`,e,{headers:{"Content-Type":"application/json"}});console.log("Framework creation response:",t.data),this.$emit("framework-created"),this.resetForm(),this.error=null,fa.success("Framework created successfully!","Success"),this.sendPushNotification({title:"New Framework Created",message:`A new framework "${this.frameworkForm.name}" has been created in the Tailoring & Templating module.`,category:"framework",priority:"high",user_id:this.loggedInUsername||"default_user"})}catch(e){console.error("Error submitting framework:",e),this.error=e.response?.data?.error||"Failed to submit framework",fa.error(this.error,"Error Creating Framework"),this.sendPushNotification({title:"Framework Creation Failed",message:`Failed to create framework "${this.frameworkForm.name}": ${this.error}`,category:"framework",priority:"high",user_id:this.loggedInUsername||"default_user"})}finally{this.loading=!1}},async submitPolicy(e){if(this.validateForm("policy"))try{this.loading=!0;const t=new FormData,i=this.policyTabs[e];Object.keys(i).forEach(e=>{"file"===e&&i[e]?t.append("file",i[e]):"subPolicies"!==e&&"activeSubPolicyTab"!==e&&t.append(e,i[e])}),i.subPolicies.forEach((e,i)=>{Object.keys(e).forEach(a=>{t.append(`subPolicies[${i}][${a}]`,e[a])})}),await He.A.post(`${$I}/tailoring/create-policy/`,t,{headers:{"Content-Type":"multipart/form-data"}}),this.$emit("policy-created"),this.resetForm()}catch(t){console.error("Error submitting policy:",t),this.error="Failed to submit policy"}finally{this.loading=!1}},async handleFrameworkSelection(e){if(console.log("handleFrameworkSelection called with:",e),!e)return console.log("No framework selected, resetting form"),void this.resetForm();try{this.loading=!0;const[t,i]=await Promise.all([He.A.get(`${$I}/frameworks/${e}/`),He.A.get(`${$I}/frameworks/${e}/get-policies/`)]);console.log("Raw framework details:",t.data),console.log("Raw framework policies:",i.data);const a=t.data;if(this.frameworkForm={name:a.FrameworkName,description:a.FrameworkDescription,identifier:a.Identifier,category:a.Category,internalExternal:a.InternalExternal,file:null,startDate:a.StartDate,endDate:a.EndDate,createdByName:a.CreatedByName,reviewer:a.Reviewer},this.policies=i.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive).map(e=>({id:e.PolicyId,name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate})),"framework"===this.selectedTab){const e=await Promise.all(i.data.filter(e=>"Approved"===e.Status&&"Active"===e.ActiveInactive).map(async e=>{const t=await He.A.get(`${$I}/policies/${e.PolicyId}/get-subpolicies/`);return{id:e.PolicyId,name:e.PolicyName,description:e.PolicyDescription,status:e.Status,department:e.Department,scope:e.Scope,objective:e.Objective,identifier:e.Identifier,coverageRate:e.CoverageRate,applicability:e.Applicability,type:e.PolicyType,category:e.PolicyCategory,subCategory:e.PolicySubCategory,entities:e.Entities,startDate:e.StartDate,endDate:e.EndDate,file:null,createdByName:e.CreatedByName,reviewer:e.Reviewer,activeSubPolicyTab:0,subPolicies:t.data.map(e=>({id:e.SubPolicyId,name:e.SubPolicyName,identifier:e.Identifier,control:e.Control,description:e.Description,status:e.Status}))}}));this.policyTabs=e,this.activePolicyTab=0}else this.policyTabs=[],this.activePolicyTab=0;this.selectedPolicy=""}catch(t){console.error("Error handling framework selection:",t),this.error="Failed to load framework details"}finally{this.loading=!1}},handlePolicyFileUpload(e,t){this.policyTabs[t].file=e.target.files[0]},addPolicyTab(){const e="framework"===this.selectedTab?this.frameworkForm.reviewer:"";this.policyTabs.push({id:Date.now(),name:"",identifier:"",description:"",scope:"",department:"",objective:"",coverageRate:"",applicability:"",type:"",category:"",subCategory:"",entities:[],showEntitiesDropdown:!1,startDate:"",endDate:"",file:null,createdByName:this.loggedInUsername,reviewer:e,subPolicies:[{id:Date.now(),name:"",identifier:"",control:"",description:"",createdByName:this.loggedInUsername}],activeSubPolicyTab:0}),this.activePolicyTab=this.policyTabs.length-1},excludePolicyTab(e){if(this.policyTabs.length>1){const t=this.activePolicyTab;this.policyTabs.splice(e,1),t>=this.policyTabs.length?this.activePolicyTab=this.policyTabs.length-1:t>e&&(this.activePolicyTab=t-1),console.log(`Policy ${e} excluded. Active tab adjusted to: ${this.activePolicyTab}`)}else this.resetForm()},addSubPolicyTab(e){const t=this.policyTabs[e];this.policyTabs[e].subPolicies.push({id:Date.now(),name:"",identifier:"",control:"",description:"",createdByName:t.createdByName}),this.policyTabs[e].activeSubPolicyTab=this.policyTabs[e].subPolicies.length-1},excludeSubPolicyTab(e,t){const i=this.policyTabs[e].subPolicies;if(i.length>1){const a=this.policyTabs[e].activeSubPolicyTab;i.splice(t,1),a>=i.length?this.policyTabs[e].activeSubPolicyTab=i.length-1:a>t&&(this.policyTabs[e].activeSubPolicyTab=a-1),console.log(`Subpolicy ${t} excluded from policy ${e}. Active subpolicy tab adjusted to: ${this.policyTabs[e].activeSubPolicyTab}`)}else this.policyTabs[e].subPolicies=[],this.policyTabs[e].activeSubPolicyTab=0},resetForm(){console.log("resetForm called"),this.frameworkForm={name:"",description:"",identifier:"",category:"",internalExternal:"",file:null,startDate:"",endDate:""},this.policyTabs=[],this.activePolicyTab=0,console.log("Policy tabs reset:",this.policyTabs),console.log("Active policy tab reset:",this.activePolicyTab),this.selectedFramework="",this.selectedPolicy=""},async fetchPolicyCategories(){try{this.loading=!0;const e=await He.A.get(`${$I}/policy-categories/`);console.log("Raw policy categories response:",e.data),this.policyData=e.data,this.policyTypes=[...new Set(e.data.map(e=>e.PolicyType))],console.log("Available policy types:",this.policyTypes)}catch(e){console.error("Error fetching policy categories:",e),this.error="Failed to fetch policy categories"}finally{this.loading=!1}},getCategoriesForType(e){if(!e||!this.policyData)return[];const t=this.policyData.filter(t=>t.PolicyType===e).map(e=>e.PolicyCategory);return[...new Set(t)]},getSubCategoriesForCategory(e,t){if(!e||!t||!this.policyData)return[];const i=this.policyData.filter(i=>i.PolicyType===e&&i.PolicyCategory===t).map(e=>e.PolicySubCategory);return[...new Set(i)]},handlePolicyTypeChange(e,t){console.log("Policy type changed:",t);const i=this.policyTabs[e];i.PolicyType=t,i.PolicyCategory="",i.PolicySubCategory="",this.policyCategories=this.getCategoriesForType(t),console.log("Updated categories:",this.policyCategories)},handlePolicyCategoryChange(e,t){console.log("Policy category changed:",t);const i=this.policyTabs[e];i.PolicyCategory=t,i.PolicySubCategory="",this.policySubCategories=this.getSubCategoriesForCategory(i.PolicyType,t),console.log("Updated subcategories:",this.policySubCategories)},handlePolicySubCategoryChange(e,t){console.log("Policy subcategory changed:",t),this.policyTabs[e].PolicySubCategory=t},updatePolicyCategoriesByType(e){if(console.log("Updating categories for type:",e),!e||!this.policyData)return this.policyCategories=[],void(this.policySubCategories=[]);const t=this.policyData.filter(t=>t.PolicyType===e);console.log("Filtered data:",t);const i=[...new Set(t.map(e=>e.PolicyCategory))];console.log("Available categories for type:",i),this.policyCategories=i,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].category="",this.policyTabs[this.activePolicyTab].subCategory=""),this.policySubCategories=[]},updateSubCategoriesByCategory(e,t){if(console.log("Updating subcategories for type:",e,"and category:",t),!e||!t||!this.policyData)return void(this.policySubCategories=[]);const i=this.policyData.filter(i=>i.PolicyType===e&&i.PolicyCategory===t);console.log("Filtered data:",i);const a=[...new Set(i.map(e=>e.PolicySubCategory))];console.log("Available subcategories:",a),this.policySubCategories=a,this.policyTabs[this.activePolicyTab]&&(this.policyTabs[this.activePolicyTab].subCategory="")},async fetchEntities(){try{this.loading=!0;const e=await He.A.get(`${$I}/entities/`);if(console.log("Raw entities response:",e.data),!e.data.entities)throw new Error("Invalid response format");this.entities=e.data.entities.map(e=>({id:e.id,label:e.label})),console.log("Mapped entities:",this.entities)}catch(e){console.error("Error fetching entities:",e),this.error="Failed to fetch entities"}finally{this.loading=!1}},handleEntitySelection(e,t,i){if(!(e<0)&&this.policyTabs[e]){if(console.log("handleEntitySelection:",{idx:e,entityId:t,isChecked:i}),this.policyTabs[e].entities||(this.policyTabs[e].entities=[]),"all"===t)this.policyTabs[e].entities=i?"all":[];else{let a="all"===this.policyTabs[e].entities?[]:Array.isArray(this.policyTabs[e].entities)?this.policyTabs[e].entities:[];const s=Number(t);i?a.includes(s)||a.push(s):a=a.filter(e=>e!==s),this.policyTabs[e].entities=a}console.log("Updated entities:",this.policyTabs[e].entities)}},selectEntity(e,t){if(e<0||!this.policyTabs[e])return;const i="all"===t?this.isAllEntitiesSelected(e):this.isEntitySelected(e,t);this.handleEntitySelection(e,t,!i)},isEntitySelected(e,t){const i=this.policyTabs[e];return!(!i||!i.entities)&&("all"===i.entities?"all"===t:Array.isArray(i.entities)&&i.entities.includes(Number(t)))},isAllEntitiesSelected(e){const t=this.policyTabs[e];return t&&"all"===t.entities},getSelectedEntitiesCount(e){const t=this.policyTabs[e];return t&&t.entities?"all"===t.entities?this.entities.length-1:Array.isArray(t.entities)?t.entities.length:0:0},toggleEntitiesDropdown(e){if(e<0||!this.policyTabs[e])return;this.policyTabs.forEach((t,i)=>{i!==e&&(t.showEntitiesDropdown=!1)});const t=this.policyTabs[e];t.showEntitiesDropdown=!t.showEntitiesDropdown,t.showEntitiesDropdown&&this.entities.length<=1&&this.fetchEntities()},closeAllEntityDropdowns(){this.policyTabs.forEach(e=>{e.showEntitiesDropdown=!1})},handleClickOutside(e){const t=document.querySelectorAll(".entities-multi-select");t.forEach(t=>{t.contains(e.target)||this.closeAllEntityDropdowns()})},async fetchUsers(){try{const e=await He.A.get(`${$I}/users/`);console.log("Raw users response:",e.data),this.users=e.data.map(e=>({id:e.UserId,name:e.UserName})),console.log("Mapped users:",this.users)}catch(e){console.error("Error fetching users:",e),this.error="Failed to fetch users"}},handleCreatedByNameChange(){if("policy"===this.selectedTab&&this.policyTabs[this.activePolicyTab]){const e=this.policyTabs[this.activePolicyTab].createdByName;this.policyTabs[this.activePolicyTab].subPolicies.forEach(t=>{t.createdByName=e})}},async submitTailoredPolicy(){if(console.log("submitTailoredPolicy called"),console.log("policyTabs:",this.policyTabs),console.log("activePolicyTab:",this.activePolicyTab),console.log("selectedFramework:",this.selectedFramework),console.log("selectedPolicy:",this.selectedPolicy),!this.policyTabs||0===this.policyTabs.length)return console.error("No policy tabs available"),void fa.error("No policy data available. Please select a policy first.","Validation Error");if(this.activePolicyTab<0||this.activePolicyTab>=this.policyTabs.length)return console.error("Invalid active policy tab index:",this.activePolicyTab,"length:",this.policyTabs.length),void fa.error("Invalid policy tab selected. Please select a valid policy.","Validation Error");const e=this.policyTabs[this.activePolicyTab];if(console.log("Current policy:",e),!e)return console.error("Current policy is undefined"),void fa.error("Selected policy is invalid. Please try again.","Validation Error");if(this.validateForm("policy"))try{this.loading=!0;const t=parseFloat(e.coverageRate);if(isNaN(t)||t<0||t>100)throw new Error("Coverage Rate must be a number between 0 and 100");const i={TargetFrameworkId:this.selectedFramework,PolicyName:e.name,PolicyDescription:e.description,Department:e.department,Scope:e.scope,Objective:e.objective,CoverageRate:t,Applicability:e.applicability,PolicyType:e.type,PolicyCategory:e.category,PolicySubCategory:e.subCategory,Entities:e.entities,StartDate:e.startDate,EndDate:e.endDate,CreatedByName:this.loggedInUsername,Reviewer:e.reviewer,Identifier:e.identifier,subpolicies:e.subPolicies?e.subPolicies.map(e=>({SubPolicyName:e.name,Identifier:e.identifier,Description:e.description,Control:e.control,exclude:!1})):[]};console.log("Submitting policy data:",i);const a=await He.A.post(`${$I}/tailoring/create-policy/`,i,{headers:{"Content-Type":"application/json"}});console.log("Policy creation response:",a.data),this.$emit("policy-created"),this.resetForm(),this.error=null,fa.success("Policy created successfully!","Success"),this.sendPushNotification({title:"New Policy Created",message:`A new policy "${e.name}" has been created in the Tailoring & Templating module.`,category:"policy",priority:"high",user_id:this.loggedInUsername||"default_user"})}catch(t){console.error("Error submitting policy:",t),this.error=t.response?.data?.error||"Failed to submit policy",fa.error(this.error,"Error Creating Policy"),this.sendPushNotification({title:"Policy Creation Failed",message:`Failed to create policy "${e.name}": ${this.error}`,category:"policy",priority:"high",user_id:this.loggedInUsername||"default_user"})}finally{this.loading=!1}},validateForm(e){if("framework"===e)return this.frameworkForm.name?this.frameworkForm.description?this.frameworkForm.identifier?this.frameworkForm.category?this.frameworkForm.internalExternal?this.frameworkForm.startDate?this.loggedInUsername?!!this.frameworkForm.reviewer||(fa.warning("Reviewer is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Reviewer is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("You must be logged in to create a framework","Validation Error"),this.sendPushNotification({title:"Authentication Error",message:"You must be logged in to create a framework",category:"framework",priority:"high",user_id:"default_user"}),!1):(fa.warning("Start date is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Start date is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Internal/External selection is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Internal/External selection is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Framework category is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Framework category is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Framework identifier is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Framework identifier is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Framework description is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Framework description is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Framework name is required","Validation Error"),this.sendPushNotification({title:"Framework Validation Error",message:"Framework name is required for framework creation",category:"framework",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1);if("policy"===e){if(!this.policyTabs||0===this.policyTabs.length)return fa.warning("No policy data available. Please select a policy first.","Validation Error"),!1;if(this.activePolicyTab<0||this.activePolicyTab>=this.policyTabs.length)return fa.warning("Invalid policy tab selected. Please select a valid policy.","Validation Error"),!1;const e=this.policyTabs[this.activePolicyTab];return e?e.name?e.description?e.identifier?e.department?e.scope?e.objective?e.coverageRate?e.applicability?e.type?e.category?e.subCategory?e.startDate?this.loggedInUsername?e.reviewer?!(!e.entities||Array.isArray(e.entities)&&0===e.entities.length)||(fa.warning("At least one entity must be selected","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"At least one entity must be selected for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Reviewer is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Reviewer is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("You must be logged in to create a policy","Validation Error"),this.sendPushNotification({title:"Authentication Error",message:"You must be logged in to create a policy",category:"policy",priority:"high",user_id:"default_user"}),!1):(fa.warning("Start Date is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Start Date is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Policy Sub Category is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Policy Sub Category is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Policy Category is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Policy Category is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Policy Type is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Policy Type is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Applicability is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Applicability is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Coverage Rate is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Coverage Rate is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Objective is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Objective is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Scope is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Scope is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Department is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Department is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Policy identifier is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Policy identifier is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Policy description is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Policy description is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Policy name is required","Validation Error"),this.sendPushNotification({title:"Policy Validation Error",message:"Policy name is required for policy creation",category:"policy",priority:"medium",user_id:this.loggedInUsername||"default_user"}),!1):(fa.warning("Selected policy is invalid. Please try again.","Validation Error"),!1)}return!1},updateLoggedInUsername(){this.loggedInUsername=localStorage.getItem("user_name")||""}},mounted(){document.addEventListener("click",this.handleClickOutside),window.addEventListener("userDataUpdated",this.updateLoggedInUsername)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside),window.removeEventListener("userDataUpdated",this.updateLoggedInUsername)}};const jI=(0,le.A)(OI,[["render",XI],["__scopeId","data-v-2fcca310"]]);var BI=jI;const WI={class:"assign-audit-page"},qI={class:"audit-content"},QI={class:"audit-tabs"},KI=["disabled","onClick"],JI={class:"tab-number"},zI={key:0,class:"tab-content"},HI={class:"dynamic-fields-row"},GI={class:"dynamic-field-col"},YI={class:"narrow-dropdown"},ZI={key:0,class:"compliance-scope-desc"},eD={key:1,class:"tab-content"},tD={class:"dynamic-fields-row"},iD={class:"dynamic-field-col"},aD={class:"dynamic-field-col"},sD={class:"dynamic-field-col"},oD=["onClick"],lD={key:2,class:"tab-content"},nD={class:"team-assignments-section"},rD={class:"member-header"},cD={class:"collapsible-section"},dD=["onClick"],uD={class:"dynamic-fields-row"},pD={class:"dynamic-field-col"},mD={class:"dynamic-field-col"},vD={class:"dynamic-field-col"},kD={class:"reports-section"},hD={class:"reports-row"},gD={class:"reports-col"},yD=["onClick"],fD={key:0,class:"selected-reports"},bD={class:"selected-reports-list"},CD={class:"report-title"},LD={class:"report-info"},wD=["onClick"],ED={class:"collapsible-section"},RD=["onClick"],ID={class:"dynamic-fields-row"},DD={class:"dynamic-field-col"},PD=["onUpdate:modelValue"],_D={class:"dynamic-field-col"},AD=["onUpdate:modelValue"],SD={class:"dynamic-fields-row"},TD={class:"dynamic-field-col"},xD={class:"dynamic-field-col"},FD={class:"dynamic-fields-row"},VD={class:"dynamic-field-col"},UD={class:"dynamic-field-col"},ND={class:"dynamic-field-col"},MD={key:0,class:"compliance-preview"},XD={class:"preview-content"},$D={key:0},OD={key:1},jD={key:0,class:"compliance-scope-desc"},BD={key:3,class:"tab-content"},WD={class:"review-actions"},qD={class:"team-review-section"},QD={class:"member-header"},KD={class:"collapsible-section"},JD=["onClick"],zD={key:0,class:"review-content"},HD={class:"review-item"},GD={class:"review-value"},YD={key:0,class:"review-item"},ZD={class:"review-value"},eP={class:"review-item"},tP={class:"review-value"},iP={key:1,class:"review-item"},aP={class:"review-reports-list"},sP={class:"report-title"},oP={class:"report-info"},lP=["onClick"],nP={key:1,class:"edit-content"},rP={class:"dynamic-fields-row"},cP={class:"dynamic-field-col"},dP={class:"dynamic-field-col"},uP={class:"dynamic-field-col"},pP={class:"reports-section"},mP={class:"reports-row"},vP={class:"reports-col"},kP=["onClick"],hP={key:0,class:"selected-reports"},gP={class:"selected-reports-list"},yP={class:"report-title"},fP={class:"report-info"},bP=["onClick"],CP=["onClick"],LP={class:"collapsible-section"},wP=["onClick"],EP={key:0,class:"review-content"},RP={class:"review-item"},IP={class:"review-value"},DP={class:"review-item"},PP={class:"review-value"},_P={class:"review-item"},AP={class:"review-value"},SP={class:"review-item"},TP={class:"review-value"},xP={class:"review-item"},FP={class:"review-value"},VP={class:"review-item"},UP={class:"review-value"},NP={class:"review-item"},MP={class:"review-value"},XP=["onClick"],$P={key:1,class:"edit-content"},OP={class:"dynamic-fields-row"},jP={class:"dynamic-field-col"},BP=["onUpdate:modelValue"],WP={class:"dynamic-field-col"},qP=["onUpdate:modelValue"],QP={class:"dynamic-fields-row"},KP={class:"dynamic-field-col"},JP={class:"dynamic-field-col"},zP={class:"dynamic-fields-row"},HP={class:"dynamic-field-col"},GP={class:"dynamic-field-col"},YP={class:"dynamic-field-col"},ZP=["onClick"],e_={class:"collapsible-section"},t_=["onClick"],i_={key:0,class:"review-content"},a_={class:"review-item"},s_={class:"review-value"},o_={class:"review-item"},l_={class:"review-value"},n_={class:"review-item"},r_={class:"review-value"},c_=["onClick"],d_={key:1,class:"edit-content"},u_={class:"dynamic-fields-row"},p_={class:"dynamic-field-col"},m_={class:"dynamic-field-col"},v_={class:"dynamic-field-col"},k_=["onClick"],h_={key:0,class:"compliance-preview"},g_={class:"preview-content"},y_={key:0},f_={key:1},b_={key:0,class:"compliance-scope-desc"},C_={class:"tab-navigation"},L_=["disabled"],w_=["disabled"],E_={key:0,class:"modal-overlay"},R_={class:"modal-content"},I_={class:"modal-header"},D_={class:"modal-body"},P_={key:0,class:"loading"},__={key:1,class:"error-message"},A_={key:2,class:"no-reports"},S_={key:3,class:"reports-list"},T_={class:"report-label"},x_=["value"],F_={class:"report-info"},V_={class:"report-title"},U_={class:"report-details"},N_={class:"modal-footer"},M_=["disabled"];function X_(e,t,i,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("TextareaInput"),u=(0,s.g2)("SelectInput"),p=(0,s.g2)("DateInput");return(0,s.uX)(),(0,s.CE)("div",WI,[(0,s.Lk)("div",qI,[t[90]||(t[90]=(0,s.Lk)("h1",{class:"audit-title"},"Audit Assignment",-1)),(0,s.Lk)("div",QI,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.tabs,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:t,class:(0,d.C4)(["tab-button",{active:l.currentTab===t,disabled:!n.isTabEnabled(t)}]),disabled:!n.isTabEnabled(t),onClick:e=>n.isTabEnabled(t)&&(l.currentTab=t)},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",JI,(0,d.v_)(t+1),1)],10,KI))),128))]),0===l.currentTab?((0,s.uX)(),(0,s.CE)("div",zI,[t[12]||(t[12]=(0,s.Lk)("h2",null,"Framework Selection",-1)),(0,s.Lk)("div",HI,[(0,s.Lk)("div",GI,[t[10]||(t[10]=(0,s.Lk)("label",{class:"dynamic-label"},"Framework",-1)),t[11]||(t[11]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the framework under which this audit is being conducted.",-1)),(0,s.Lk)("div",YI,[(0,s.bF)(r,{modelValue:l.auditData.framework,"onUpdate:modelValue":t[0]||(t[0]=e=>l.auditData.framework=e),config:{name:"Framework",label:"Framework",values:l.frameworks.map(e=>({value:e.FrameworkId,label:e.FrameworkName})),defaultValue:"Select Framework"},onChange:n.onFrameworkChange},null,8,["modelValue","config","onChange"])]),l.auditData.framework&&!l.auditData.policy?((0,s.uX)(),(0,s.CE)("div",ZI," Will include permanent compliances from all policies and subpolicies under this framework ")):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),1===l.currentTab?((0,s.uX)(),(0,s.CE)("div",eD,[t[20]||(t[20]=(0,s.Lk)("h2",null,"Team Creation",-1)),(0,s.Lk)("button",{class:"add-member-btn",onClick:t[1]||(t[1]=(...e)=>n.addTeamMember&&n.addTeamMember(...e))},t[13]||(t[13]=[(0,s.Lk)("span",{class:"plus-icon"},"+",-1),(0,s.eW)(" Add Team Member ")])),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.teamMembers,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"team-member-card"},[(0,s.Lk)("div",tD,[(0,s.Lk)("div",iD,[t[14]||(t[14]=(0,s.Lk)("label",{class:"dynamic-label"},"Auditor",-1)),t[15]||(t[15]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the auditor responsible for this audit.",-1)),(0,s.bF)(r,{modelValue:e.auditor,"onUpdate:modelValue":t=>e.auditor=t,config:{name:"Auditor",label:"Auditor",values:l.users.map(e=>({value:e.UserId,label:e.UserName})),defaultValue:"Select Auditor"},showSearchBar:!0,error:n.getFieldError("auditor",i)},null,8,["modelValue","onUpdate:modelValue","config","error"])]),(0,s.Lk)("div",aD,[t[16]||(t[16]=(0,s.Lk)("label",{class:"dynamic-label"},"Role",-1)),t[17]||(t[17]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the role of the auditor in this audit.",-1)),(0,s.bF)(r,{modelValue:e.role,"onUpdate:modelValue":t=>e.role=t,config:{name:"Role",label:"Role",values:l.roles.map(e=>({value:e,label:e})),defaultValue:"Select Role"},showSearchBar:!0,error:n.getFieldError("role",i)},null,8,["modelValue","onUpdate:modelValue","config","error"])]),(0,s.Lk)("div",sD,[t[18]||(t[18]=(0,s.Lk)("label",{class:"dynamic-label"},"Primary Responsibilities",-1)),t[19]||(t[19]=(0,s.Lk)("div",{class:"dynamic-desc"},"Describe the main responsibilities for this team member.",-1)),(0,s.bF)(c,{modelValue:e.responsibilities,"onUpdate:modelValue":t=>e.responsibilities=t,label:"Primary Responsibilities",placeholder:"Enter responsibilities...",error:n.getFieldError("responsibilities",i),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])])]),i>0?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"remove-member-btn",onClick:e=>n.removeTeamMember(i)}," Remove ",8,oD)):(0,s.Q3)("",!0)]))),128))])):(0,s.Q3)("",!0),2===l.currentTab?((0,s.uX)(),(0,s.CE)("div",lD,[t[47]||(t[47]=(0,s.Lk)("h2",null,"Policy Assignment & Audit Details",-1)),(0,s.Lk)("div",nD,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.teamMembers,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"team-assignment-card"},[(0,s.Lk)("div",rD,[(0,s.Lk)("h4",null,(0,d.v_)(n.getUserName(e.auditor)||"Team Member")+" - "+(0,d.v_)(e.role),1)]),(0,s.Lk)("div",cD,[(0,s.Lk)("div",{class:"section-header",onClick:t=>n.toggleSection(e,"policyAssignment")},[t[21]||(t[21]=(0,s.Lk)("h5",null,"Policy Assignment",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isPolicyAssignmentExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,dD),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isPolicyAssignmentExpanded}])},[(0,s.Lk)("div",uD,[(0,s.Lk)("div",pD,[t[22]||(t[22]=(0,s.Lk)("label",{class:"dynamic-label"},"Assigned Policy",-1)),t[23]||(t[23]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the policy to be audited by this team member.",-1)),(0,s.bF)(r,{modelValue:e.assignedPolicy,"onUpdate:modelValue":t=>e.assignedPolicy=t,config:{name:"Assigned Policy",label:"Assigned Policy",values:l.policies.map(e=>({value:e.PolicyId,label:e.PolicyName})),defaultValue:"Select Policy"},showSearchBar:!0,error:n.getFieldError("assignedPolicy",i),onChange:e=>n.onMemberPolicyChange(i)},null,8,["modelValue","onUpdate:modelValue","config","error","onChange"])]),(0,s.Lk)("div",mD,[t[24]||(t[24]=(0,s.Lk)("label",{class:"dynamic-label"},"Sub Policy",-1)),t[25]||(t[25]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select specific sub policy if applicable.",-1)),(0,s.bF)(r,{modelValue:e.assignedSubPolicy,"onUpdate:modelValue":t=>e.assignedSubPolicy=t,config:{name:"Sub Policy",label:"Sub Policy",values:n.getMemberSubpolicies(i).map(e=>({value:e.SubPolicyId,label:e.SubPolicyName})),defaultValue:"Select Sub Policy"},showSearchBar:!0,onChange:e=>n.onSubPolicyChange(i)},null,8,["modelValue","onUpdate:modelValue","config","onChange"])]),(0,s.Lk)("div",vD,[t[26]||(t[26]=(0,s.Lk)("label",{class:"dynamic-label"},"Reviewer",-1)),t[27]||(t[27]=(0,s.Lk)("div",{class:"dynamic-desc"},"Choose the reviewer who will review this audit.",-1)),(0,s.bF)(r,{modelValue:e.reviewer,"onUpdate:modelValue":t=>e.reviewer=t,config:{name:"Reviewer",label:"Reviewer",values:l.users.map(e=>({value:e.UserId,label:e.UserName})),defaultValue:"Select Reviewer"},showSearchBar:!0,error:n.getFieldError("reviewer",i)},null,8,["modelValue","onUpdate:modelValue","config","error"])])]),(0,s.Lk)("div",kD,[(0,s.Lk)("div",hD,[(0,s.Lk)("div",gD,[(0,s.Lk)("button",{class:"reports-btn",onClick:t=>n.showReportsModal(e)},t[28]||(t[28]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1),(0,s.eW)(" Attach Reports ")]),8,yD)])]),n.getSelectedReportsForMember(e).length>0?((0,s.uX)(),(0,s.CE)("div",fD,[t[30]||(t[30]=(0,s.Lk)("h6",null,"Selected Reports:",-1)),(0,s.Lk)("div",bD,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSelectedReportsForMember(e),i=>((0,s.uX)(),(0,s.CE)("div",{key:i.ReportId,class:"selected-report-item"},[(0,s.Lk)("span",CD,"Report #"+(0,d.v_)(i.ReportId),1),(0,s.Lk)("span",LD,(0,d.v_)(i.AuditorName)+" - "+(0,d.v_)(n.formatDate(i.CompletionDate)),1),(0,s.Lk)("button",{class:"remove-report-btn",onClick:t=>n.removeReport(e,i.ReportId)},t[29]||(t[29]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,wD)]))),128))])])):(0,s.Q3)("",!0)])],2)]),(0,s.Lk)("div",ED,[(0,s.Lk)("div",{class:"section-header",onClick:t=>n.toggleSection(e,"auditDetails")},[t[31]||(t[31]=(0,s.Lk)("h5",null,"Audit Details",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isAuditDetailsExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,RD),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isAuditDetailsExpanded}])},[(0,s.Lk)("div",ID,[(0,s.Lk)("div",DD,[t[32]||(t[32]=(0,s.Lk)("label",{class:"dynamic-label"},"Audit Title",-1)),t[33]||(t[33]=(0,s.Lk)("div",{class:"dynamic-desc"},"Enter a concise title for this audit assignment.",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.auditTitle=t,class:"dynamic-input",placeholder:"Enter audit title..."},null,8,PD),[[a.Jo,e.auditTitle]])]),(0,s.Lk)("div",_D,[t[34]||(t[34]=(0,s.Lk)("label",{class:"dynamic-label"},"Business Unit",-1)),t[35]||(t[35]=(0,s.Lk)("div",{class:"dynamic-desc"},"Mention the business unit or process area being audited.",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.businessUnit=t,class:"dynamic-input",placeholder:"Enter business unit..."},null,8,AD),[[a.Jo,e.businessUnit]])])]),(0,s.Lk)("div",SD,[(0,s.Lk)("div",TD,[t[36]||(t[36]=(0,s.Lk)("label",{class:"dynamic-label"},"Scope",-1)),t[37]||(t[37]=(0,s.Lk)("div",{class:"dynamic-desc"},"Specify the boundaries and extent of the audit.",-1)),(0,s.bF)(c,{modelValue:e.scope,"onUpdate:modelValue":t=>e.scope=t,label:"Scope",placeholder:"Enter scope...",error:n.getFieldError("scope",i),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",xD,[t[38]||(t[38]=(0,s.Lk)("label",{class:"dynamic-label"},"Objective",-1)),t[39]||(t[39]=(0,s.Lk)("div",{class:"dynamic-desc"},"State the main goals or objectives of the audit.",-1)),(0,s.bF)(c,{modelValue:e.objective,"onUpdate:modelValue":t=>e.objective=t,label:"Objective",placeholder:"Enter objective...",error:n.getFieldError("objective",i),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])])]),(0,s.Lk)("div",FD,[(0,s.Lk)("div",VD,[t[40]||(t[40]=(0,s.Lk)("label",{class:"dynamic-label"},"Type",-1)),t[41]||(t[41]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select whether the audit is Internal or External.",-1)),(0,s.bF)(u,{modelValue:e.type,"onUpdate:modelValue":t=>e.type=t,options:[{value:"I",label:"Internal"},{value:"E",label:"External"},{value:"S",label:"Self-Audit"}],label:"Type",placeholder:"Select Type",error:n.getFieldError("type",i)},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",UD,[t[42]||(t[42]=(0,s.Lk)("label",{class:"dynamic-label"},"Frequency",-1)),t[43]||(t[43]=(0,s.Lk)("div",{class:"dynamic-desc"},"How often should this audit occur?",-1)),(0,s.bF)(u,{modelValue:e.frequency,"onUpdate:modelValue":t=>e.frequency=t,options:[{value:"0",label:"Only Once"},{value:"1",label:"Daily"},{value:"60",label:"Every 2 Months"},{value:"120",label:"Every 4 Months"},{value:"182",label:"Half Yearly"},{value:"365",label:"Yearly"},{value:"365a",label:"Annually"}],label:"Frequency",placeholder:"Select Frequency",error:n.getFieldError("frequency",i)},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",ND,[t[44]||(t[44]=(0,s.Lk)("label",{class:"dynamic-label"},"Due Date",-1)),t[45]||(t[45]=(0,s.Lk)("div",{class:"dynamic-desc"},"Select the due date for this audit.",-1)),(0,s.bF)(p,{modelValue:e.dueDate,"onUpdate:modelValue":t=>e.dueDate=t,label:"Due Date",placeholder:"Select due date",error:n.getFieldError("dueDate",i)},null,8,["modelValue","onUpdate:modelValue","error"])])])],2)]),e.assignedPolicy?((0,s.uX)(),(0,s.CE)("div",MD,[t[46]||(t[46]=(0,s.Lk)("div",{class:"preview-header"},"Compliance Items to be Audited:",-1)),(0,s.Lk)("div",XD,[(0,s.Lk)("div",{class:(0,d.C4)(["compliance-count",{loading:l.complianceCountLoading[`${e.assignedPolicy}-loading`]}])},[l.complianceCountLoading[`${e.assignedPolicy}-loading`]?((0,s.uX)(),(0,s.CE)("span",$D,"Loading...")):((0,s.uX)(),(0,s.CE)("span",OD,(0,d.v_)(n.getComplianceCount(e.assignedPolicy,e.assignedSubPolicy))+" items",1))],2),e.assignedSubPolicy?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",jD," Will include permanent compliances from all subpolicies under this policy "))])])):(0,s.Q3)("",!0)]))),128))])])):(0,s.Q3)("",!0),3===l.currentTab?((0,s.uX)(),(0,s.CE)("div",BD,[t[89]||(t[89]=(0,s.Lk)("h2",null,"Review & Assign",-1)),(0,s.Lk)("div",WD,[(0,s.Lk)("button",{class:"expand-all-btn",onClick:t[2]||(t[2]=(...e)=>n.expandAllSections&&n.expandAllSections(...e))},t[48]||(t[48]=[(0,s.Lk)("i",{class:"fas fa-expand-alt"},null,-1),(0,s.eW)(" Expand All Sections ")]))]),(0,s.Lk)("div",qD,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.teamMembers,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"team-review-card"},[(0,s.Lk)("div",QD,[(0,s.Lk)("h4",null,(0,d.v_)(n.getUserName(e.auditor)||"Team Member")+" - "+(0,d.v_)(e.role),1)]),(0,s.Lk)("div",KD,[(0,s.Lk)("div",{class:"section-header",onClick:t=>n.toggleSection(e,"reviewPolicy")},[t[49]||(t[49]=(0,s.Lk)("h5",null,"Policy Assignment",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isReviewPolicyExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,JD),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isReviewPolicyExpanded}])},[e.isPolicyEditMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",zD,[(0,s.Lk)("div",HD,[t[50]||(t[50]=(0,s.Lk)("span",{class:"review-label"},"Assigned Policy:",-1)),(0,s.Lk)("span",GD,(0,d.v_)(n.getPolicyName(e.assignedPolicy)),1)]),e.assignedSubPolicy?((0,s.uX)(),(0,s.CE)("div",YD,[t[51]||(t[51]=(0,s.Lk)("span",{class:"review-label"},"Sub Policy:",-1)),(0,s.Lk)("span",ZD,(0,d.v_)(n.getSubPolicyName(e.assignedSubPolicy)),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",eP,[t[52]||(t[52]=(0,s.Lk)("span",{class:"review-label"},"Reviewer:",-1)),(0,s.Lk)("span",tP,(0,d.v_)(n.getUserName(e.reviewer)),1)]),n.getSelectedReportsForMember(e).length>0?((0,s.uX)(),(0,s.CE)("div",iP,[t[53]||(t[53]=(0,s.Lk)("span",{class:"review-label"},"Attached Reports:",-1)),(0,s.Lk)("div",aP,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSelectedReportsForMember(e),e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ReportId,class:"review-report-item"},[(0,s.Lk)("span",sP,"Report #"+(0,d.v_)(e.ReportId),1),(0,s.Lk)("span",oP,(0,d.v_)(e.AuditorName)+" - "+(0,d.v_)(n.formatDate(e.CompletionDate)),1)]))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"edit-section-btn",onClick:t=>n.togglePolicyEditMode(e)},t[54]||(t[54]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,lP)])),e.isPolicyEditMode?((0,s.uX)(),(0,s.CE)("div",nP,[(0,s.Lk)("div",rP,[(0,s.Lk)("div",cP,[t[55]||(t[55]=(0,s.Lk)("label",{class:"dynamic-label"},"Assigned Policy",-1)),(0,s.bF)(r,{modelValue:e.assignedPolicy,"onUpdate:modelValue":t=>e.assignedPolicy=t,config:{name:"Assigned Policy",label:"Assigned Policy",values:l.policies.map(e=>({value:e.PolicyId,label:e.PolicyName})),defaultValue:"Select Policy"},showSearchBar:!0,error:n.getFieldError("assignedPolicy",i),onChange:e=>n.onMemberPolicyChange(i)},null,8,["modelValue","onUpdate:modelValue","config","error","onChange"])]),(0,s.Lk)("div",dP,[t[56]||(t[56]=(0,s.Lk)("label",{class:"dynamic-label"},"Sub Policy",-1)),(0,s.bF)(r,{modelValue:e.assignedSubPolicy,"onUpdate:modelValue":t=>e.assignedSubPolicy=t,config:{name:"Sub Policy",label:"Sub Policy",values:n.getMemberSubpolicies(i).map(e=>({value:e.SubPolicyId,label:e.SubPolicyName})),defaultValue:"Select Sub Policy"},showSearchBar:!0,onChange:e=>n.onSubPolicyChange(i)},null,8,["modelValue","onUpdate:modelValue","config","onChange"])]),(0,s.Lk)("div",uP,[t[57]||(t[57]=(0,s.Lk)("label",{class:"dynamic-label"},"Reviewer",-1)),(0,s.bF)(r,{modelValue:e.reviewer,"onUpdate:modelValue":t=>e.reviewer=t,config:{name:"Reviewer",label:"Reviewer",values:l.users.map(e=>({value:e.UserId,label:e.UserName})),defaultValue:"Select Reviewer"},showSearchBar:!0,error:n.getFieldError("reviewer",i)},null,8,["modelValue","onUpdate:modelValue","config","error"])])]),(0,s.Lk)("div",pP,[(0,s.Lk)("div",mP,[(0,s.Lk)("div",vP,[(0,s.Lk)("button",{class:"reports-btn",onClick:t=>n.showReportsModal(e)},t[58]||(t[58]=[(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1),(0,s.eW)(" Attach Reports ")]),8,kP)])]),n.getSelectedReportsForMember(e).length>0?((0,s.uX)(),(0,s.CE)("div",hP,[t[60]||(t[60]=(0,s.Lk)("h6",null,"Selected Reports:",-1)),(0,s.Lk)("div",gP,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getSelectedReportsForMember(e),i=>((0,s.uX)(),(0,s.CE)("div",{key:i.ReportId,class:"selected-report-item"},[(0,s.Lk)("span",yP,"Report #"+(0,d.v_)(i.ReportId),1),(0,s.Lk)("span",fP,(0,d.v_)(i.AuditorName)+" - "+(0,d.v_)(n.formatDate(i.CompletionDate)),1),(0,s.Lk)("button",{class:"remove-report-btn",onClick:t=>n.removeReport(e,i.ReportId)},t[59]||(t[59]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,bP)]))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{class:"save-section-btn",onClick:t=>n.togglePolicyEditMode(e)},t[61]||(t[61]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save ")]),8,CP)])):(0,s.Q3)("",!0)],2)]),(0,s.Lk)("div",LP,[(0,s.Lk)("div",{class:"section-header",onClick:t=>n.toggleSection(e,"reviewDetails")},[t[62]||(t[62]=(0,s.Lk)("h5",null,"Audit Details",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isReviewDetailsExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,wP),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isReviewDetailsExpanded}])},[e.isDetailsEditMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",EP,[(0,s.Lk)("div",RP,[t[63]||(t[63]=(0,s.Lk)("span",{class:"review-label"},"Audit Title:",-1)),(0,s.Lk)("span",IP,(0,d.v_)(e.auditTitle||"Not specified"),1)]),(0,s.Lk)("div",DP,[t[64]||(t[64]=(0,s.Lk)("span",{class:"review-label"},"Business Unit:",-1)),(0,s.Lk)("span",PP,(0,d.v_)(e.businessUnit||"Not specified"),1)]),(0,s.Lk)("div",_P,[t[65]||(t[65]=(0,s.Lk)("span",{class:"review-label"},"Scope:",-1)),(0,s.Lk)("span",AP,(0,d.v_)(e.scope),1)]),(0,s.Lk)("div",SP,[t[66]||(t[66]=(0,s.Lk)("span",{class:"review-label"},"Objective:",-1)),(0,s.Lk)("span",TP,(0,d.v_)(e.objective),1)]),(0,s.Lk)("div",xP,[t[67]||(t[67]=(0,s.Lk)("span",{class:"review-label"},"Type:",-1)),(0,s.Lk)("span",FP,(0,d.v_)(n.getAuditTypeLabel(e.type)),1)]),(0,s.Lk)("div",VP,[t[68]||(t[68]=(0,s.Lk)("span",{class:"review-label"},"Frequency:",-1)),(0,s.Lk)("span",UP,(0,d.v_)(n.getFrequencyLabel(e.frequency)),1)]),(0,s.Lk)("div",NP,[t[69]||(t[69]=(0,s.Lk)("span",{class:"review-label"},"Due Date:",-1)),(0,s.Lk)("span",MP,(0,d.v_)(n.formatDate(e.dueDate)),1)]),(0,s.Lk)("button",{class:"edit-section-btn",onClick:t=>n.toggleDetailsEditMode(e)},t[70]||(t[70]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,XP)])),e.isDetailsEditMode?((0,s.uX)(),(0,s.CE)("div",$P,[(0,s.Lk)("div",OP,[(0,s.Lk)("div",jP,[t[71]||(t[71]=(0,s.Lk)("label",{class:"dynamic-label"},"Audit Title",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.auditTitle=t,class:"dynamic-input",placeholder:"Enter audit title..."},null,8,BP),[[a.Jo,e.auditTitle]])]),(0,s.Lk)("div",WP,[t[72]||(t[72]=(0,s.Lk)("label",{class:"dynamic-label"},"Business Unit",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>e.businessUnit=t,class:"dynamic-input",placeholder:"Enter business unit..."},null,8,qP),[[a.Jo,e.businessUnit]])])]),(0,s.Lk)("div",QP,[(0,s.Lk)("div",KP,[t[73]||(t[73]=(0,s.Lk)("label",{class:"dynamic-label"},"Scope",-1)),(0,s.bF)(c,{modelValue:e.scope,"onUpdate:modelValue":t=>e.scope=t,label:"Scope",placeholder:"Enter scope...",error:n.getFieldError("scope",i),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",JP,[t[74]||(t[74]=(0,s.Lk)("label",{class:"dynamic-label"},"Objective",-1)),(0,s.bF)(c,{modelValue:e.objective,"onUpdate:modelValue":t=>e.objective=t,label:"Objective",placeholder:"Enter objective...",error:n.getFieldError("objective",i),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])])]),(0,s.Lk)("div",zP,[(0,s.Lk)("div",HP,[t[75]||(t[75]=(0,s.Lk)("label",{class:"dynamic-label"},"Type",-1)),(0,s.bF)(u,{modelValue:e.type,"onUpdate:modelValue":t=>e.type=t,options:[{value:"I",label:"Internal"},{value:"E",label:"External"},{value:"S",label:"Self-Audit"}],label:"Type",placeholder:"Select Type",error:n.getFieldError("type",i)},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",GP,[t[76]||(t[76]=(0,s.Lk)("label",{class:"dynamic-label"},"Frequency",-1)),(0,s.bF)(u,{modelValue:e.frequency,"onUpdate:modelValue":t=>e.frequency=t,options:[{value:"0",label:"Only Once"},{value:"1",label:"Daily"},{value:"60",label:"Every 2 Months"},{value:"120",label:"Every 4 Months"},{value:"182",label:"Half Yearly"},{value:"365",label:"Yearly"},{value:"365a",label:"Annually"}],label:"Frequency",placeholder:"Select Frequency",error:n.getFieldError("frequency",i)},null,8,["modelValue","onUpdate:modelValue","error"])]),(0,s.Lk)("div",YP,[t[77]||(t[77]=(0,s.Lk)("label",{class:"dynamic-label"},"Due Date",-1)),(0,s.bF)(p,{modelValue:e.dueDate,"onUpdate:modelValue":t=>e.dueDate=t,label:"Due Date",placeholder:"Select due date",error:n.getFieldError("dueDate",i)},null,8,["modelValue","onUpdate:modelValue","error"])])]),(0,s.Lk)("button",{class:"save-section-btn",onClick:t=>n.toggleDetailsEditMode(e)},t[78]||(t[78]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save ")]),8,ZP)])):(0,s.Q3)("",!0)],2)]),(0,s.Lk)("div",e_,[(0,s.Lk)("div",{class:"section-header",onClick:t=>n.toggleSection(e,"reviewTeam")},[t[79]||(t[79]=(0,s.Lk)("h5",null,"Team Member Details",-1)),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.isReviewTeamExpanded?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,t_),(0,s.Lk)("div",{class:(0,d.C4)(["section-content",{collapsed:!e.isReviewTeamExpanded}])},[e.isTeamEditMode?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",i_,[(0,s.Lk)("div",a_,[t[80]||(t[80]=(0,s.Lk)("span",{class:"review-label"},"Auditor:",-1)),(0,s.Lk)("span",s_,(0,d.v_)(n.getUserName(e.auditor)),1)]),(0,s.Lk)("div",o_,[t[81]||(t[81]=(0,s.Lk)("span",{class:"review-label"},"Role:",-1)),(0,s.Lk)("span",l_,(0,d.v_)(e.role),1)]),(0,s.Lk)("div",n_,[t[82]||(t[82]=(0,s.Lk)("span",{class:"review-label"},"Responsibilities:",-1)),(0,s.Lk)("span",r_,(0,d.v_)(e.responsibilities),1)]),(0,s.Lk)("button",{class:"edit-section-btn",onClick:t=>n.toggleTeamEditMode(e)},t[83]||(t[83]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,c_)])),e.isTeamEditMode?((0,s.uX)(),(0,s.CE)("div",d_,[(0,s.Lk)("div",u_,[(0,s.Lk)("div",p_,[t[84]||(t[84]=(0,s.Lk)("label",{class:"dynamic-label"},"Auditor",-1)),(0,s.bF)(r,{modelValue:e.auditor,"onUpdate:modelValue":t=>e.auditor=t,config:{name:"Auditor",label:"Auditor",values:l.users.map(e=>({value:e.UserId,label:e.UserName})),defaultValue:"Select Auditor"},showSearchBar:!0,error:n.getFieldError("auditor",i)},null,8,["modelValue","onUpdate:modelValue","config","error"])]),(0,s.Lk)("div",m_,[t[85]||(t[85]=(0,s.Lk)("label",{class:"dynamic-label"},"Role",-1)),(0,s.bF)(u,{modelValue:e.role,"onUpdate:modelValue":t=>e.role=t,options:l.roles.map(e=>({value:e,label:e})),label:"Role",placeholder:"Select Role"},null,8,["modelValue","onUpdate:modelValue","options"])]),(0,s.Lk)("div",v_,[t[86]||(t[86]=(0,s.Lk)("label",{class:"dynamic-label"},"Responsibilities",-1)),(0,s.bF)(c,{modelValue:e.responsibilities,"onUpdate:modelValue":t=>e.responsibilities=t,label:"Responsibilities",placeholder:"Enter responsibilities...",error:n.getFieldError("responsibilities",i),rows:"3"},null,8,["modelValue","onUpdate:modelValue","error"])])]),(0,s.Lk)("button",{class:"save-section-btn",onClick:t=>n.toggleTeamEditMode(e)},t[87]||(t[87]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save ")]),8,k_)])):(0,s.Q3)("",!0)],2)]),e.assignedPolicy?((0,s.uX)(),(0,s.CE)("div",h_,[t[88]||(t[88]=(0,s.Lk)("div",{class:"preview-header"},"Compliance Items to be Audited:",-1)),(0,s.Lk)("div",g_,[(0,s.Lk)("div",{class:(0,d.C4)(["compliance-count",{loading:l.complianceCountLoading[`${e.assignedPolicy}-loading`]}])},[l.complianceCountLoading[`${e.assignedPolicy}-loading`]?((0,s.uX)(),(0,s.CE)("span",y_,"Loading...")):((0,s.uX)(),(0,s.CE)("span",f_,(0,d.v_)(n.getComplianceCount(e.assignedPolicy,e.assignedSubPolicy))+" items",1))],2),e.assignedSubPolicy?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",b_," Will include permanent compliances from all subpolicies under this policy "))])])):(0,s.Q3)("",!0)]))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",C_,[l.currentTab>0?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"nav-button prev",onClick:t[3]||(t[3]=e=>l.currentTab--)}," Previous ")):(0,s.Q3)("",!0),l.currentTab<l.tabs.length-1?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"nav-button next",onClick:t[4]||(t[4]=(...e)=>n.nextTab&&n.nextTab(...e)),disabled:!n.canProceed}," Next ",8,L_)):(0,s.Q3)("",!0),l.currentTab===l.tabs.length-1?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"nav-button assign",onClick:t[5]||(t[5]=(...e)=>n.submitAudit&&n.submitAudit(...e)),disabled:!n.canAssign||l.assigning},(0,d.v_)(l.assigning?"Assigning...":"Assign Audit"),9,w_)):(0,s.Q3)("",!0)])]),l.showingReportsModal?((0,s.uX)(),(0,s.CE)("div",E_,[(0,s.Lk)("div",R_,[(0,s.Lk)("div",I_,[t[91]||(t[91]=(0,s.Lk)("h2",null,"Select Reports",-1)),(0,s.Lk)("button",{class:"close-btn",onClick:t[6]||(t[6]=(...e)=>n.closeReportsModal&&n.closeReportsModal(...e))},"×")]),(0,s.Lk)("div",D_,[l.loadingReports?((0,s.uX)(),(0,s.CE)("div",P_," Loading reports... ")):l.reportsError?((0,s.uX)(),(0,s.CE)("div",__,(0,d.v_)(l.reportsError),1)):0===l.availableReports.length?((0,s.uX)(),(0,s.CE)("div",A_," No reports available for this selection. ")):((0,s.uX)(),(0,s.CE)("div",S_,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.availableReports,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ReportId,class:"report-item"},[(0,s.Lk)("label",T_,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",value:e.ReportId,"onUpdate:modelValue":t[7]||(t[7]=e=>l.selectedReports=e)},null,8,x_),[[a.lH,l.selectedReports]]),(0,s.Lk)("div",F_,[(0,s.Lk)("div",V_,"Report #"+(0,d.v_)(e.ReportId),1),(0,s.Lk)("div",U_,[(0,s.Lk)("span",null,(0,d.v_)(e.AuditorName),1),(0,s.Lk)("span",null,(0,d.v_)(n.formatDate(e.CompletionDate)),1)])])])]))),128))]))]),(0,s.Lk)("div",N_,[(0,s.Lk)("button",{class:"cancel-btn",onClick:t[8]||(t[8]=(...e)=>n.closeReportsModal&&n.closeReportsModal(...e))},"Cancel"),(0,s.Lk)("button",{class:"save-btn",onClick:t[9]||(t[9]=(...e)=>n.saveSelectedReports&&n.saveSelectedReports(...e)),disabled:0===l.selectedReports.length}," Save ",8,M_)])])])):(0,s.Q3)("",!0)])}var $_={methods:{validateString(e,t={}){const{required:i=!0,minLength:a=1,maxLength:s=255,fieldName:o="Field"}=t;if(!e&&i)return`${o} is required`;if(e){if(e.length<a)return`${o} must be at least ${a} characters`;if(e.length>s)return`${o} cannot exceed ${s} characters`}return null},validateId(e,t="ID"){if(!e)return`${t} is required`;const i=parseInt(e);return isNaN(i)||i<1?`${t} must be a valid positive number`:null},validateDate(e,t="Date"){if(!e)return`${t} is required`;const i=new Date(e);if(isNaN(i.getTime()))return`${t} must be a valid date`;const a=new Date;return a.setHours(0,0,0,0),i<a?`${t} cannot be in the past`:null},validateAuditType(e){const t=["I","E","S"];return t.includes(e)?null:"Invalid audit type. Must be Internal, External, or Self-Audit"},validateFrequency(e){const t=["0","1","60","120","182","365","365a"];return t.includes(e)?null:"Invalid frequency value"},validateTeamMember(e){const t={},i=this.validateId(e.auditor,"Auditor");i&&(t.auditor=i);const a=this.validateString(e.role,{fieldName:"Role",minLength:2,maxLength:100});a&&(t.role=a);const s=this.validateString(e.responsibilities,{fieldName:"Responsibilities",minLength:10,maxLength:500});s&&(t.responsibilities=s);const o=this.validateId(e.assignedPolicy,"Policy");o&&(t.assignedPolicy=o);const l=this.validateId(e.reviewer,"Reviewer");l&&(t.reviewer=l);const n=this.validateString(e.scope,{fieldName:"Scope",minLength:10,maxLength:1e3});n&&(t.scope=n);const r=this.validateString(e.objective,{fieldName:"Objective",minLength:10,maxLength:1e3});r&&(t.objective=r);const c=this.validateAuditType(e.type);c&&(t.type=c);const d=this.validateFrequency(e.frequency);d&&(t.frequency=d);const u=this.validateDate(e.dueDate,"Due Date");return u&&(t.dueDate=u),Object.keys(t).length>0?t:null}}};const O_=["for"],j_={key:0,class:"required"},B_={class:"input-wrapper"},W_={key:1,class:"helper-text"},q_={key:2,class:"error-text"};var Q_={__name:"BaseInput",props:{id:{type:String,required:!0},label:{type:String,default:""},required:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""}},setup(e){const t=e,i=(0,s.EW)(()=>!!t.errorMessage);return(t,a)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["form-group",{"form-group-error":i.value}])},[e.label?((0,s.uX)(),(0,s.CE)("label",{key:0,for:e.id,class:"form-label"},[(0,s.eW)((0,d.v_)(e.label)+" ",1),e.required?((0,s.uX)(),(0,s.CE)("span",j_,"*")):(0,s.Q3)("",!0)],8,O_)):(0,s.Q3)("",!0),(0,s.Lk)("div",B_,[(0,s.RG)(t.$slots,"default")]),e.helperText?((0,s.uX)(),(0,s.CE)("small",W_,(0,d.v_)(e.helperText),1)):(0,s.Q3)("",!0),e.errorMessage?((0,s.uX)(),(0,s.CE)("small",q_,(0,d.v_)(e.errorMessage),1)):(0,s.Q3)("",!0)],2))}};const K_=(0,le.A)(Q_,[["__scopeId","data-v-64a6f058"]]);var J_=K_;const z_=["id","value","required","disabled","name"],H_={key:0,value:"",disabled:""},G_=["value","disabled"];var Y_={__name:"SelectInput",props:{id:{type:String,required:!0},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"Select an option"},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},options:{type:Array,default:()=>[],validator:e=>e.every(e=>"object"===typeof e&&"value"in e&&"label"in e)},name:{type:String,default:""}},emits:["update:modelValue","change","blur","focus"],setup(e,{emit:t}){const i=e,a=t,o=(0,s.EW)(()=>!!i.errorMessage),l=e=>{a("update:modelValue",e.target.value),a("change",e)},n=e=>{a("blur",e)},r=e=>{a("focus",e)};return(t,i)=>((0,s.uX)(),(0,s.Wv)(J_,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("select",{id:e.id,value:e.modelValue,required:e.required,disabled:e.disabled,name:e.name,class:(0,d.C4)(["select-input",{"input-error":o.value,"input-disabled":e.disabled}]),onChange:l,onBlur:n,onFocus:r},[e.placeholder?((0,s.uX)(),(0,s.CE)("option",H_,(0,d.v_)(e.placeholder),1)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.options,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value,disabled:e.disabled},(0,d.v_)(e.label),9,G_))),128))],42,z_)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const Z_=(0,le.A)(Y_,[["__scopeId","data-v-41e820b8"]]);var eA=Z_;const tA=["id","value","placeholder","required","disabled","readonly","rows","cols","maxlength","minlength","name"];var iA={__name:"TextareaInput",props:{id:{type:String,required:!0},modelValue:{type:String,default:""},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},rows:{type:Number,default:4},cols:{type:Number,default:null},maxlength:{type:Number,default:null},minlength:{type:Number,default:null},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:t}){const i=e,a=t,o=(0,s.EW)(()=>!!i.errorMessage),l=e=>{a("update:modelValue",e.target.value)},n=e=>{a("blur",e)},r=e=>{a("focus",e)};return(t,i)=>((0,s.uX)(),(0,s.Wv)(J_,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("textarea",{id:e.id,value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,rows:e.rows,cols:e.cols,maxlength:e.maxlength,minlength:e.minlength,name:e.name,class:(0,d.C4)(["textarea-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,tA)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const aA=(0,le.A)(iA,[["__scopeId","data-v-24543950"]]);var sA=aA;const oA=["id","type","value","placeholder","required","disabled","readonly","min","max","name"];var lA={__name:"DateInput",props:{id:{type:String,required:!0},modelValue:{type:String,default:""},type:{type:String,default:"date",validator:e=>["date","time","datetime-local","month","week"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},min:{type:String,default:""},max:{type:String,default:""},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:t}){const i=e,a=t,o=(0,s.EW)(()=>!!i.errorMessage),l=e=>{a("update:modelValue",e.target.value)},n=e=>{a("blur",e)},r=e=>{a("focus",e)};return(t,i)=>((0,s.uX)(),(0,s.Wv)(J_,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("input",{id:e.id,type:e.type,value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,min:e.min,max:e.max,name:e.name,class:(0,d.C4)(["date-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,oA)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const nA=(0,le.A)(lA,[["__scopeId","data-v-e06e25e4"]]);var rA=nA,cA={name:"AssignAudit",mixins:[$_],components:{SelectInput:eA,CustomDropdown:xa.A,TextareaInput:sA,DateInput:rA},data(){return{currentTab:0,tabs:[{name:"Framework Selection",required:["framework"]},{name:"Team Creation",required:[]},{name:"Policy Assignment",required:[]},{name:"Review & Assign",required:["scope","objective","type","frequency","dueDate"]}],auditData:{framework:"",policy:"",subPolicy:"",auditor:"",role:"",reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",responsibilities:""},frameworks:[],policies:[],subpolicies:[],users:[],roles:["Chief Audit Executive (CAE) / Audit Director","Audit Manager","Senior Audit Manager","IT Audit Manager","Operational Audit Manager","Compliance Audit Manager","Senior Auditor","Lead Auditor","Financial Auditor","Operational Auditor","IT Systems Auditor","Staff Auditor","Junior Auditor","Audit Reviewer","Quality Assurance Reviewer","Forensic Auditor","Regulatory Compliance Auditor","Risk Auditor","External Audit Coordinator","Regulatory Examiner Liaison","Audit Technology Specialist","Continuous Auditing Specialist","Audit Committee Secretary","Board Reporting Specialist"],assigning:!1,teamMembers:[{auditor:"",role:"",responsibilities:"",assignedPolicy:"",assignedSubPolicy:"",memberSubpolicies:[],reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",reports:"",isPolicyAssignmentExpanded:!0,isAuditDetailsExpanded:!0,isReviewPolicyExpanded:!0,isReviewDetailsExpanded:!0,isReviewTeamExpanded:!0,isPolicyEditMode:!1,isDetailsEditMode:!1,isTeamEditMode:!1}],memberComplianceCounts:{},complianceCountLoading:{},showingReportsModal:!1,loadingReports:!1,reportsError:null,availableReports:[],selectedReports:[],currentMember:null,validationErrors:{},fieldErrors:{}}},computed:{canProceed(){return 0===this.currentTab?!!this.auditData.framework:1===this.currentTab?this.teamMembers.some(e=>e.auditor&&e.role&&e.responsibilities):2!==this.currentTab||this.teamMembers.every(e=>e.assignedPolicy&&e.reviewer&&e.scope&&e.objective&&e.type&&e.frequency&&e.dueDate)},canAssign(){if(!this.auditData.framework)return!1;const e=this.teamMembers.some(e=>{const t=e.auditor&&e.role&&e.responsibilities,i=e.assignedPolicy&&e.reviewer,a=e.scope&&e.objective&&e.type&&e.frequency&&e.dueDate;return t&&i&&a});return e},getFieldError(){return(e,t=null)=>null!==t&&this.validationErrors.teamMembers?this.validationErrors.teamMembers[t]?.[e]:this.validationErrors[e]}},methods:{checkAssignAuditPermission(){Tr.wr.showAssignAuditDenied()},handleAssignAuditClick(){this.submitAudit()},async fetchFrameworks(){try{const e=await He.A.get("/api/frameworks/");this.frameworks=e.data}catch(e){if(console.error("Error fetching frameworks:",e),Tr.wr.handleApiError(e,"audit framework access"))return;this.frameworks=[]}},async fetchUsers(){try{const e=await He.A.get("/api/users/");this.users=e.data}catch(e){if(console.error("Error fetching users:",e),Tr.wr.handleApiError(e,"audit user access"))return;this.users=[]}},async onFrameworkChange(){if(this.auditData.policy="",this.auditData.subPolicy="",this.policies=[],this.subpolicies=[],this.auditData.framework)try{const e=await He.A.get("/api/policies/",{params:{framework_id:this.auditData.framework}});this.policies=e.data}catch(e){console.error("Error fetching policies:",e),this.policies=[]}},async onPolicyChange(){if(this.auditData.subPolicy="",this.subpolicies=[],this.auditData.policy)try{const e=await He.A.get("/api/subpolicies/",{params:{policy_id:this.auditData.policy}});this.subpolicies=e.data}catch(e){console.error("Error fetching subpolicies:",e),this.subpolicies=[]}},addTeamMember(){this.teamMembers.push({auditor:"",role:"",responsibilities:"",assignedPolicy:"",assignedSubPolicy:"",memberSubpolicies:[],reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",reports:"",isPolicyAssignmentExpanded:!0,isAuditDetailsExpanded:!0,isReviewPolicyExpanded:!0,isReviewDetailsExpanded:!0,isReviewTeamExpanded:!0,isPolicyEditMode:!1,isDetailsEditMode:!1,isTeamEditMode:!1})},removeTeamMember(e){this.teamMembers.splice(e,1)},validateForm(){this.validationErrors={},this.fieldErrors={};const e=this.validateId(this.auditData.framework,"Framework");e&&(this.validationErrors.framework=e);const t=[];return this.teamMembers.forEach((e,i)=>{const a=this.validateTeamMember(e);a&&(t[i]=a)}),t.length>0&&(this.validationErrors.teamMembers=t),0===Object.keys(this.validationErrors).length},async submitAudit(){if(!this.assigning)try{this.assigning=!0;const e=this.teamMembers[0],t={title:e.auditTitle,scope:e.scope,objective:e.objective,business_unit:e.businessUnit,role:e.role,responsibility:e.responsibilities,team_members:this.teamMembers.map(e=>e.auditor),reviewer:e.reviewer,framework_id:this.auditData.framework,policy_id:e.assignedPolicy||null,subpolicy_id:e.assignedSubPolicy||null,due_date:e.dueDate,frequency:e.frequency,audit_type:e.type,reports:e.reports||""},i=await He.A.post("/api/create-audit/",t);if(!(i.data.audits_created>0))throw new Error("No audits were created");this.$popup.success(`Successfully created ${i.data.audits_created} audit(s)`),await this.sendPushNotification({title:"Audit Assigned",message:`Successfully created ${i.data.audits_created} audit(s).`,category:"audit",priority:"high",user_id:"default_user"}),this.resetForm()}catch(e){if(console.error("Error in submitAudit:",e),Tr.wr.handleApiError(e,"audit assignment"))return;const t=e.response?.data?.error||"Please try again.";e.response?.data?.details&&this.handleBackendValidationErrors(e.response.data.details),this.$popup.error("Error assigning audits: "+t),await this.sendPushNotification({title:"Audit Assignment Failed",message:`Error assigning audits: ${t}`,category:"audit",priority:"high",user_id:"default_user"}),console.error("Error in submitAudit:",e)}finally{this.assigning=!1}},handleBackendValidationErrors(e){try{const t=JSON.parse(e);this.validationErrors=t}catch(t){this.validationErrors.general=e}},resetForm(){this.auditData={framework:""},this.teamMembers=[{auditor:"",role:"",responsibilities:"",assignedPolicy:"",assignedSubPolicy:"",memberSubpolicies:[],reviewer:"",auditTitle:"",scope:"",objective:"",businessUnit:"",type:"",frequency:"",dueDate:"",reports:"",isPolicyAssignmentExpanded:!0,isAuditDetailsExpanded:!0,isReviewPolicyExpanded:!0,isReviewDetailsExpanded:!0,isReviewTeamExpanded:!0,isPolicyEditMode:!1,isDetailsEditMode:!1,isTeamEditMode:!1}],this.currentTab=0},getUserName(e){const t=this.users.find(t=>t.UserId===e);return t?t.UserName:""},getPolicyName(e){const t=this.policies.find(t=>t.PolicyId===e);return t?t.PolicyName:"Not Assigned"},getSubPolicyName(e){const t=this.teamMembers.find(t=>t.memberSubpolicies.some(t=>t.SubPolicyId===e));if(t){const i=t.memberSubpolicies.find(t=>t.SubPolicyId===e);return i?i.SubPolicyName:"Not Assigned"}return"Not Assigned"},async onMemberPolicyChange(e){const t=this.teamMembers[e];if(t.assignedSubPolicy="",t.memberSubpolicies=[],t.assignedPolicy)try{this.complianceCountLoading={...this.complianceCountLoading,[`${t.assignedPolicy}-loading`]:!0};const i=await He.A.get("/api/subpolicies/",{params:{policy_id:t.assignedPolicy}});t.memberSubpolicies=i.data,await this.fetchComplianceCount(e)}catch(i){if(console.error("Error in onMemberPolicyChange:",i),Tr.wr.handleApiError(i,"audit subpolicy access"))return}finally{this.complianceCountLoading={...this.complianceCountLoading,[`${t.assignedPolicy}-loading`]:!1}}},async fetchComplianceCount(e){const t=this.teamMembers[e];if(t&&t.assignedPolicy)try{const e=await He.A.get("/api/compliance-count/",{params:{policy_id:t.assignedPolicy,subpolicy_id:t.assignedSubPolicy||""}}),i=`${t.assignedPolicy}-${t.assignedSubPolicy||""}`;this.memberComplianceCounts={...this.memberComplianceCounts,[i]:e.data.count||0}}catch(i){if(console.error("Error fetching compliance count:",i),Tr.wr.handleApiError(i,"audit compliance count access"))return;const e=`${t.assignedPolicy}-${t.assignedSubPolicy||""}`;this.memberComplianceCounts={...this.memberComplianceCounts,[e]:0}}},async onSubPolicyChange(e){const t=this.teamMembers[e];if(t&&t.assignedPolicy)try{this.complianceCountLoading={...this.complianceCountLoading,[`${t.assignedPolicy}-loading`]:!0},await this.fetchComplianceCount(e)}catch(i){console.error("Error in onSubPolicyChange:",i)}finally{this.complianceCountLoading={...this.complianceCountLoading,[`${t.assignedPolicy}-loading`]:!1}}},getMemberSubpolicies(e){return this.teamMembers[e].memberSubpolicies},getComplianceCount(e,t){if(!e)return 0;const i=`${e}-${t||""}`;return this.memberComplianceCounts[i]||0},async showReportsModal(e){this.currentMember=e,this.showingReportsModal=!0,this.loadingReports=!0,this.reportsError=null,this.selectedReports=[];try{const t=new URLSearchParams({framework_id:this.auditData.framework,policy_id:e.assignedPolicy||"",subpolicy_id:e.assignedSubPolicy||""}),i=await He.A.get("/api/audit-reports/check/",{params:t});this.availableReports=i.data.reports||[]}catch(t){console.error("Error fetching reports:",t),this.reportsError="Failed to load reports. Please try again."}finally{this.loadingReports=!1}},closeReportsModal(){this.showingReportsModal=!1,this.currentMember=null,this.selectedReports=[],this.availableReports=[],this.reportsError=null},async saveSelectedReports(){try{if(0===this.selectedReports.length)return;const e=new URLSearchParams;e.append("report_ids",this.selectedReports.join(","));const t=await He.A.get("/api/audit-reports/details/",{params:e}),i=t.data.reports,a={reports:i.map((e,t)=>({[`Report_${t+1}`]:{ReportId:e.report_id,Report:e.report,AuditorName:e.auditor_name,CompletionDate:e.completion_date,PolicyId:this.currentMember.assignedPolicy||null,SubPolicyId:this.currentMember.assignedSubPolicy||null,FrameworkId:this.auditData.framework}}))};this.currentMember.reports=JSON.stringify(a),await this.sendPushNotification({title:"Reports Attached",message:"Reports have been attached to the audit assignment.",category:"audit",priority:"medium",user_id:"default_user"}),this.closeReportsModal()}catch(e){console.error("Error saving reports:",e),this.$popup.error("Error saving reports. Please try again."),await this.sendPushNotification({title:"Report Attachment Failed",message:"Error saving reports. Please try again.",category:"audit",priority:"high",user_id:"default_user"})}},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleDateString()},getSelectedReportsForMember(e){if(!e.reports)return[];try{const t=JSON.parse(e.reports);return t.reports.map((e,t)=>{const i=`Report_${t+1}`;return{ReportId:e[i].ReportId,Report:e[i].Report,AuditorName:e[i].AuditorName||"Unknown",CompletionDate:e[i].CompletionDate}})}catch(t){return console.error("Error parsing reports:",t),[]}},removeReport(e,t){try{if(!e.reports)return;const i=JSON.parse(e.reports),a=i.reports.filter(e=>{const i=Object.keys(e)[0];return e[i].ReportId!==t});i.reports=a,e.reports=JSON.stringify(i)}catch(i){console.error("Error removing report:",i)}},toggleSection(e,t){console.log(`Toggling section: ${t}`,e),"policyAssignment"===t?e.isPolicyAssignmentExpanded=!e.isPolicyAssignmentExpanded:"auditDetails"===t?e.isAuditDetailsExpanded=!e.isAuditDetailsExpanded:"reviewPolicy"===t?(e.isReviewPolicyExpanded=!e.isReviewPolicyExpanded,console.log("Review Policy expanded:",e.isReviewPolicyExpanded)):"reviewDetails"===t?(e.isReviewDetailsExpanded=!e.isReviewDetailsExpanded,console.log("Review Details expanded:",e.isReviewDetailsExpanded)):"reviewTeam"===t&&(e.isReviewTeamExpanded=!e.isReviewTeamExpanded,console.log("Review Team expanded:",e.isReviewTeamExpanded))},togglePolicyEditMode(e){e.isPolicyEditMode=!e.isPolicyEditMode},toggleDetailsEditMode(e){e.isDetailsEditMode=!e.isDetailsEditMode},toggleTeamEditMode(e){e.isTeamEditMode=!e.isTeamEditMode},nextTab(){this.currentTab++,this.resetCollapsibleSections()},resetCollapsibleSections(){this.teamMembers.forEach(e=>{e.isPolicyAssignmentExpanded=!0,e.isAuditDetailsExpanded=!0,e.isReviewPolicyExpanded=!0,e.isReviewDetailsExpanded=!0,e.isReviewTeamExpanded=!0,e.isPolicyEditMode=!1,e.isDetailsEditMode=!1,e.isTeamEditMode=!1})},getAuditTypeLabel(e){switch(e){case"I":return"Internal";case"E":return"External";case"S":return"Self-Audit";default:return e||"Not specified"}},getFrequencyLabel(e){switch(e){case"0":return"Only Once";case"1":return"Daily";case"60":return"Every 2 Months";case"120":return"Every 4 Months";case"182":return"Half Yearly";case"365":return"Yearly";case"365a":return"Annually";default:return e||"Not specified"}},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},expandAllSections(){this.teamMembers.forEach(e=>{e.isPolicyAssignmentExpanded=!0,e.isAuditDetailsExpanded=!0,e.isReviewPolicyExpanded=!0,e.isReviewDetailsExpanded=!0,e.isReviewTeamExpanded=!0,e.isPolicyEditMode=!1,e.isDetailsEditMode=!1,e.isTeamEditMode=!1})},isTabEnabled(e){return 0===e||(e===this.currentTab||!(e!==this.currentTab+1||!this.canProceed))}},watch:{teamMembers:{deep:!0,handler(e){e.forEach((e,t)=>{e.assignedSubPolicy&&this.onSubPolicyChange(t)})}},currentTab:function(e){3===e&&this.$nextTick(()=>{this.resetCollapsibleSections(),console.log("Reset collapsible sections for Review & Assign tab")})}},mounted(){this.fetchFrameworks(),this.fetchUsers()}};const dA=(0,le.A)(cA,[["render",X_],["__scopeId","data-v-832844a2"]]);var uA=dA,pA=i(6216);const mA={class:"reviewer-page"},vA={key:0,class:"loading"},kA={key:1,class:"error-message"},hA={key:2,class:"no-data"},gA={class:"progress-bar"},yA={class:"progress-text"},fA=["onUpdate:modelValue","onChange"],bA={key:1},CA=["onClick"],LA={key:2},wA=["onClick"],EA={key:0,class:"approved-rejected-badge rejected",style:{display:"block","margin-top":"5px"}},RA={key:3},IA=["disabled","onClick"];function DA(e,t,i,o,l,n){const r=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",mA,[t[5]||(t[5]=(0,s.Lk)("h1",{class:"reviewer-title"},"Review Audit",-1)),l.loading?((0,s.uX)(),(0,s.CE)("div",vA,t[1]||(t[1]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading review tasks...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",kA,[(0,s.Lk)("p",null,(0,d.v_)(l.error),1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.fetchReviewTasks&&n.fetchReviewTasks(...e)),class:"btn-retry"},"Retry")])):0===l.audits.length?((0,s.uX)(),(0,s.CE)("div",hA,t[2]||(t[2]=[(0,s.Lk)("p",null,"No review tasks found",-1)]))):((0,s.uX)(),(0,s.Wv)(r,{key:3,title:"Review Tasks",data:n.filteredAudits,columns:l.columns,filters:l.filters,uniqueKey:"audit_id",showPagination:!0,defaultPageSize:10},{"cell-completion_percentage":(0,s.k6)(({row:e})=>[(0,s.Lk)("div",gA,[(0,s.Lk)("div",{class:(0,d.C4)(["progress-fill",n.getProgressClass(e.completion_percentage)]),style:(0,d.Tr)({width:`${e.completion_percentage}%`})},null,6)]),(0,s.Lk)("span",yA,(0,d.v_)(e.completion_percentage)+"%",1)]),"cell-policy":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(e.policy||"All Policies"),1)]),"cell-subpolicy":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(e.subpolicy||"All Subpolicies"),1)]),"cell-review_status":(0,s.k6)(({row:e})=>["Under review"===e.status&&"Yet to Start"!==e.review_status&&"In Review"!==e.review_status&&"Reject"!==e.review_status?(0,s.bo)(((0,s.uX)(),(0,s.CE)("select",{key:0,"onUpdate:modelValue":t=>e.review_status=t,onChange:t=>n.updateReviewStatus(e),class:"review-status-select"},t[3]||(t[3]=[(0,s.Lk)("option",{value:"Accept"},"Accept",-1),(0,s.Lk)("option",{value:"Reject"},"Reject",-1)]),40,fA)),[[a.u1,e.review_status]]):"Yet to Start"===e.review_status&&"Under review"===e.status?((0,s.uX)(),(0,s.CE)("span",bA,[(0,s.Lk)("button",{onClick:t=>n.startReview(e),class:"btn-review",title:"Start review process"}," Start ",8,CA)])):"In Review"!==e.review_status&&"Reject"!==e.review_status||"Under review"!==e.status?((0,s.uX)(),(0,s.CE)("span",RA,(0,d.v_)(e.review_status),1)):((0,s.uX)(),(0,s.CE)("span",LA,[(0,s.Lk)("button",{onClick:t=>n.openReviewDialog(e),class:"btn-review btn-in-progress",title:"Edit review in progress"}," Edit Review ",8,wA),"Rejected"===e.approved_rejected?((0,s.uX)(),(0,s.CE)("span",EA," Rejected ")):(0,s.Q3)("",!0)])),!e.approved_rejected||"Reject"===e.review_status&&"Under review"===e.status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",{key:4,class:(0,d.C4)(["approved-rejected-badge",n.getApprovedRejectedClass(e.approved_rejected)])},(0,d.v_)(e.approved_rejected),3))]),"cell-download":(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"btn-download",disabled:!n.canDownload(e),onClick:t=>n.downloadAuditReport(e.audit_id),title:"Download Audit Report"},t[4]||(t[4]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Download ")]),8,IA)]),_:1},8,["data","columns","filters"]))])}var PA=i(6604);const _A=PA.FH.baseURL||"/api";var AA={name:"ReviewerPage",components:{DynamicTable:Hn.A},data(){return{audits:[],loading:!0,error:null,searchQuery:"",statusFilter:"",columns:[{key:"audit_id",label:"ID"},{key:"framework",label:"Framework"},{key:"policy",label:"Policy",slot:!0},{key:"subpolicy",label:"Subpolicy",slot:!0},{key:"auditor",label:"Auditor"},{key:"duedate",label:"Due Date"},{key:"completion_percentage",label:"Progress",slot:!0},{key:"status",label:"Audit Status"},{key:"review_status",label:"Review Status",slot:!0},{key:"download",label:"Download",slot:!0}],filters:[{name:"statusFilter",label:"Filter by Status",type:"select",values:[{value:"",label:"All Statuses"},{value:"Yet to Start",label:"Yet to Start"},{value:"In Review",label:"In Review"},{value:"Accept",label:"Accepted"},{value:"Reject",label:"Rejected"}],defaultValue:"",filterFunction:(e,t)=>!t||e.review_status===t}]}},computed:{filteredAudits(){let e=this.audits;if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>{const i=[e.framework,e.policy,e.subpolicy,e.auditor,e.status,e.review_status].filter(Boolean).map(e=>e.toLowerCase());return i.some(e=>e.includes(t))})}return e}},created(){this.fetchReviewTasks()},methods:{async fetchReviewTasks(){this.loading=!0,this.error=null;try{console.log("Fetching review tasks...");const e=await PA.FH.getMyReviews();this.audits=e.data.audits,console.log(`Fetched ${this.audits.length} review tasks`)}catch(e){console.error("Error fetching review tasks:",e),Tr.wr.handleApiError(e,"review tasks access")?this.error="Access denied":this.error=e.response?.data?.error||"Failed to load review tasks. Please try again.",await this.sendPushNotification({title:"Review Tasks Load Failed",message:this.error,category:"review",priority:"high",user_id:"default_user"})}finally{this.loading=!1}},getProgressClass(e){return e<30?"progress-low":e<70?"progress-medium":"progress-high"},getApprovedRejectedClass(e){return"Approved"===e?"approved":"Rejected"===e?"rejected":""},canDownload(e){return"Accept"===e.review_status||"ACCEPTED"===e.status||"APPROVED"===e.status},async downloadAuditReport(e){try{console.log(`Downloading audit report for audit ${e}`),this.$popup.success("Generating audit report..."),await this.sendPushNotification({title:"Audit Report Generation",message:`Audit report for audit ID ${e} is being generated.`,category:"audit",priority:"medium",user_id:"default_user"});const t=`${_A}/generate-audit-report/${e}/`;console.log(`Downloading report from URL: ${t}`),window.open(t,"_blank"),this.$popup.success("Report download initiated"),await this.sendPushNotification({title:"Audit Report Download",message:`Audit report for audit ID ${e} download initiated.`,category:"audit",priority:"medium",user_id:"default_user"})}catch(t){if(console.error("Error initiating report download:",t),Tr.wr.handleApiError(t,"audit report download"))return;const e=t.message||"Failed to download report. Please try again.";this.$popup.error(e),await this.sendPushNotification({title:"Audit Report Download Failed",message:e,category:"audit",priority:"high",user_id:"default_user"})}},startReview(e){e.review_status="In Review",this.updateReviewStatus(e),this.openReviewDialog(e)},openReviewDialog(e){console.log(`Opening review for audit ${e.audit_id}`);const t=!0===e.justUpdatedToUnderReview;t?(console.log("This is a fresh review after status change, adding freshReview parameter"),this.$router.push(`/reviewer/task/${e.audit_id}?freshReview=true`)):this.$router.push(`/reviewer/task/${e.audit_id}`)},async updateReviewStatus(e){try{console.log(`Updating review status for audit ${e.audit_id} to ${e.review_status}`);let a=!1;if("Under review"!==e.status){console.log(`Audit status is currently ${e.status}, updating to 'Under review' first`);try{console.log(`Making direct POST request to ${_A}/audits/${e.audit_id}/status/`);const t=await He.A.post(`${_A}/audits/${e.audit_id}/status/`,{status:"Under review"});console.log("Status update response:",t.data),e.status="Under review",e.justUpdatedToUnderReview=!0,console.log("Audit status updated to Under review"),a=!0}catch(t){console.error("Error updating audit status with direct axios:",t),console.error("Status code:",t.response?.status),console.error("Error message:",t.response?.data||t.message);try{console.log("Trying fallback to api.updateAuditStatus...");const t=await PA.FH.updateAuditStatus(e.audit_id,{status:"Under review"});console.log("Fallback status update successful:",t.data),e.status="Under review",e.justUpdatedToUnderReview=!0,console.log("Audit status updated to Under review via fallback"),a=!0}catch(i){throw console.error("Both direct and fallback status update methods failed:",i),this.$popup.error(`Failed to update audit status. Please try again later. Error: ${i.message||"Unknown error"}`),i}}}let s="";if("Reject"===e.review_status){if(s=await this.$popup.comment("Please provide rejection comments:","Rejection Comments"),null===s)return this.fetchReviewTasks(),void await this.sendPushNotification({title:"Review Rejection Cancelled",message:`Rejection for audit ID ${e.audit_id} was cancelled by the user.`,category:"review",priority:"low",user_id:"default_user"})}else if("Accept"===e.review_status&&(s=await this.$popup.comment("Please provide any approval comments (optional):","Approval Comments"),null===s))return this.fetchReviewTasks(),void await this.sendPushNotification({title:"Review Approval Cancelled",message:`Approval for audit ID ${e.audit_id} was cancelled by the user.`,category:"review",priority:"low",user_id:"default_user"});const o=await PA.FH.updateReviewStatus(e.audit_id,{review_status:e.review_status,review_comments:s});console.log("Review status updated successfully:",o.data),e.review_comments=s,"Accept"===e.review_status&&o.data.audit_status&&(e.status=o.data.audit_status),this.$popup.success("Review status updated successfully!"),await this.sendPushNotification({title:"Review Status Updated",message:`Review status for audit ID ${e.audit_id} updated to ${e.review_status}.`,category:"review",priority:"medium",user_id:"default_user"}),a&&"In Review"===e.review_status&&(console.log("Automatically opening review dialog after status update"),this.openReviewDialog(e))}catch(a){console.error("Error updating review status:",a),this.fetchReviewTasks(),this.$popup.error(a.response?.data?.error||"Failed to update review status. Please try again."),await this.sendPushNotification({title:"Review Status Update Failed",message:`Failed to update review status for audit ID ${e.audit_id}. Error: ${a.response?.data?.error||a.message}`,category:"review",priority:"high",user_id:"default_user"})}},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}}}};const SA=(0,le.A)(AA,[["render",DA],["__scopeId","data-v-1bfb26c8"]]);var TA=SA;const xA={class:"audit_task-view"},FA={key:0,class:"audit_error-message"},VA={key:1,class:"audit_loading"},UA={key:2,class:"audit_content"},NA={class:"audit-details"},MA={class:"audit_details-container"},XA={class:"audit_detail-item"},$A={class:"audit_detail-item"},OA={class:"audit_detail-item"},jA={class:"audit_detail-item"},BA={class:"audit_hierarchy-details"},WA={class:"audit_hierarchy-item"},qA={class:"audit_hierarchy-item"},QA={class:"audit_hierarchy-item"},KA={class:"audit_compliance-section"},JA={class:"audit_compliance-header-row"},zA={class:"audit_compliance-tabs"},HA=["onClick"],GA={key:0,class:"audit_compliance-details"},YA={class:"audit_compliance-header"},ZA={class:"audit_compliance-row"},eS={class:"audit_form-group"},tS={key:0,class:"audit_error-message"},iS={class:"audit_form-group"},aS={class:"audit_form-group"},sS={key:0,class:"audit_error-message"},oS={class:"audit_compliance-row"},lS={class:"audit_form-group"},nS={class:"audit_form-group"},rS={class:"audit_form-group"},cS={class:"audit_compliance-row"},dS={class:"audit_form-group"},uS={class:"audit_form-group"},pS={class:"audit_form-group"},mS={class:"audit_compliance-row"},vS={class:"audit_form-group"},kS=["value"],hS={class:"audit_form-group"},gS={key:0,class:"audit_corrective-actions-container"},yS={class:"audit_risk-header"},fS={class:"audit_mitigation-actions"},bS={class:"audit_mitigation-checkbox"},CS=["value"],LS={class:"audit_mitigation-text"},wS={key:1,class:"audit_no-actions"},ES={class:"audit_compliance-row"},RS={class:"audit_form-group"},IS={class:"audit_form-group small-input"},DS={class:"audit_form-group"},PS={class:"audit_compliance-row"},_S={class:"audit_form-group checkbox-group"},AS={key:0,class:"audit_form-group"},SS={class:"audit_form-group"},TS={class:"audit_compliance-row"},xS={class:"audit_form-group"},FS={class:"audit_form-group"},VS={class:"audit_evidence-footer"},US={class:"audit_form-group"},NS={class:"audit_upload-container"},MS={key:0,class:"audit_uploaded-files"},XS={class:"audit_file-name"},$S={key:0,class:"audit_version-badge-small"},OS=["href"],jS=["onClick"],BS={key:1,class:"audit_upload-progress"},WS={class:"audit_progress-bar"},qS={class:"audit_floating-save-container"},QS=["disabled"],KS={class:"audit_save-text"},JS={class:"audit_evidence-section"},zS={class:"audit_upload-container"},HS={key:0,class:"audit_uploaded-files"},GS={class:"audit_file-name"},YS={key:0,class:"audit_version-badge-small"},ZS=["href"],eT=["onClick"],tT={key:1,class:"audit_upload-progress"},iT={class:"audit_progress-bar"},aT={class:"audit_overall-comments-section"},sT={class:"audit_form-group"},oT={class:"audit_overall-review-comments-section"},lT=["disabled"],nT={key:0,class:"audit_version-info"},rT={class:"audit_version-badge"},cT={class:"audit_version-number"},dT={class:"audit_version-type"},uT={key:0,class:"audit_last-saved"},pT={class:"audit_saved-time"},mT={key:1,class:"audit_version-info"},vT={class:"audit_modal-header"},kT={class:"audit_modal-footer"},hT=["disabled"],gT={class:"audit_modal-header"},yT={class:"audit_modal-body"},fT={class:"audit_form-row"},bT={class:"audit_form-group"},CT={key:0,class:"audit_error-message"},LT={class:"audit_form-group"},wT={key:0,class:"audit_error-message"},ET={class:"audit_form-group"},RT={class:"audit_form-row"},IT={class:"audit_form-group"},DT={class:"audit_form-group"},PT={class:"audit_form-row"},_T={class:"audit_form-group"},AT={class:"audit_form-group"},ST={class:"audit_form-row"},TT={class:"audit_form-group"},xT={class:"audit_radio-group"},FT={class:"audit_radio-label"},VT={class:"audit_radio-label"},UT={class:"audit_form-group"},NT={class:"audit_form-group"},MT={class:"audit_form-row"},XT={class:"audit_form-group"},$T={class:"audit_form-group"},OT={class:"audit_modal-footer"},jT=["disabled"];function BT(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",xA,[(0,s.Lk)("button",{class:"audit_back-button",onClick:t[0]||(t[0]=t=>e.$router.back())},"Go back"),l.error?((0,s.uX)(),(0,s.CE)("div",FA,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.retryFetch&&n.retryFetch(...e)),class:"audit_retry-button"},"Retry")])):l.loading?((0,s.uX)(),(0,s.CE)("div",VA," Loading audit details... ")):l.auditDetails?((0,s.uX)(),(0,s.CE)("div",UA,[(0,s.Lk)("div",NA,[t[105]||(t[105]=(0,s.Lk)("h1",null,"Audit Details",-1)),(0,s.Lk)("div",MA,[(0,s.Lk)("div",XA,[t[71]||(t[71]=(0,s.Lk)("h3",null,"Title",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.title),1)]),(0,s.Lk)("div",$A,[t[72]||(t[72]=(0,s.Lk)("h3",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.scope),1)]),(0,s.Lk)("div",OA,[t[73]||(t[73]=(0,s.Lk)("h3",null,"Objective",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.objective),1)]),(0,s.Lk)("div",jA,[t[74]||(t[74]=(0,s.Lk)("h3",null,"Business Unit",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.business_unit),1)])]),(0,s.Lk)("div",BA,[(0,s.Lk)("div",WA,[t[75]||(t[75]=(0,s.Lk)("h3",null,"Framework",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.framework_name),1)]),t[78]||(t[78]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"→",-1)),(0,s.Lk)("div",qA,[t[76]||(t[76]=(0,s.Lk)("h3",null,"Policy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.policy_name),1)]),t[79]||(t[79]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"→",-1)),(0,s.Lk)("div",QA,[t[77]||(t[77]=(0,s.Lk)("h3",null,"Subpolicy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.subpolicy_name),1)])]),(0,s.Lk)("div",KA,[(0,s.Lk)("div",JA,[t[81]||(t[81]=(0,s.Lk)("h2",null,"Compliance Items",-1)),(0,s.Lk)("button",{onClick:t[2]||(t[2]=e=>l.showAddComplianceModal=!0),class:"audit_add-compliance-button"},t[80]||(t[80]=[(0,s.Lk)("span",{class:"audit_add-icon"},"+",-1),(0,s.eW)(" Add Compliance ")]))]),(0,s.Lk)("div",zA,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditDetails.compliances,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["audit_tab-button",{active:l.selectedComplianceIndex===t}]),onClick:i=>n.selectCompliance(e,t)}," Compliance "+(0,d.v_)(t+1),11,HA))),128))]),n.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",GA,[(0,s.Lk)("div",YA,[(0,s.Lk)("h3",null,(0,d.v_)(n.selectedCompliance.description),1)]),(0,s.Lk)("div",ZA,[(0,s.Lk)("div",eS,[t[83]||(t[83]=(0,s.Lk)("label",null,"Compliance Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>n.selectedCompliance.status=e),onChange:t[4]||(t[4]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},t[82]||(t[82]=[(0,s.Lk)("option",{value:"2"},"Fully Compliant",-1),(0,s.Lk)("option",{value:"1"},"Partially Compliant",-1),(0,s.Lk)("option",{value:"0"},"Not Compliant",-1),(0,s.Lk)("option",{value:"3"},"Not Applicable",-1)]),544),[[a.u1,n.selectedCompliance.status]]),n.getFieldError("status",l.selectedComplianceIndex)?((0,s.uX)(),(0,s.CE)("div",tS,(0,d.v_)(n.getFieldError("status",l.selectedComplianceIndex)),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",iS,[t[85]||(t[85]=(0,s.Lk)("label",null,"Type of Findings",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>n.selectedCompliance.major_minor=e),onChange:t[6]||(t[6]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},t[84]||(t[84]=[(0,s.Lk)("option",{value:""},"Select Type",-1),(0,s.Lk)("option",{value:"0"},"Minor",-1),(0,s.Lk)("option",{value:"1"},"Major",-1)]),544),[[a.u1,n.selectedCompliance.major_minor]])]),(0,s.Lk)("div",aS,[t[86]||(t[86]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=e=>n.selectedCompliance.severity_rating=e),onInput:t[8]||(t[8]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),min:"1",max:"10",class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.severity_rating]]),n.getFieldError("severity_rating",l.selectedComplianceIndex)?((0,s.uX)(),(0,s.CE)("div",sS,(0,d.v_)(n.getFieldError("severity_rating",l.selectedComplianceIndex)),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",oS,[(0,s.Lk)("div",lS,[t[87]||(t[87]=(0,s.Lk)("label",null,"What to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>n.selectedCompliance.what_to_verify=e),onInput:t[10]||(t[10]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.what_to_verify]])]),(0,s.Lk)("div",nS,[t[88]||(t[88]=(0,s.Lk)("label",null,"How to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>n.selectedCompliance.how_to_verify=e),onInput:t[12]||(t[12]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.how_to_verify]])]),(0,s.Lk)("div",rS,[t[89]||(t[89]=(0,s.Lk)("label",null,"Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>n.selectedCompliance.impact=e),onInput:t[14]||(t[14]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.impact]])])]),(0,s.Lk)("div",cS,[(0,s.Lk)("div",dS,[t[90]||(t[90]=(0,s.Lk)("label",null,"Why to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[15]||(t[15]=e=>n.selectedCompliance.why_to_verify=e),onInput:t[16]||(t[16]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.why_to_verify]])]),(0,s.Lk)("div",uS,[t[91]||(t[91]=(0,s.Lk)("label",null,"Details of Findings",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[17]||(t[17]=e=>n.selectedCompliance.details_of_finding=e),onInput:t[18]||(t[18]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.details_of_finding]])]),(0,s.Lk)("div",pS,[t[92]||(t[92]=(0,s.Lk)("label",null,"Underlying Cause",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[19]||(t[19]=e=>n.selectedCompliance.underlying_cause=e),onInput:t[20]||(t[20]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.underlying_cause]])])]),(0,s.Lk)("div",mS,[(0,s.Lk)("div",vS,[t[93]||(t[93]=(0,s.Lk)("label",null,"Predictive Risks",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>n.selectedCompliance.selected_risks=e),class:"audit_form-control",multiple:"",onChange:t[22]||(t[22]=(...e)=>n.updateCorrectiveActions&&n.updateCorrectiveActions(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectedCompliance.risks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e},(0,d.v_)(e.title)+" ("+(0,d.v_)(e.category)+") ",9,kS))),128))],544),[[a.u1,n.selectedCompliance.selected_risks]])]),(0,s.Lk)("div",hS,[t[94]||(t[94]=(0,s.Lk)("label",null,"Corrective Actions",-1)),n.selectedCompliance.selected_risks&&n.selectedCompliance.selected_risks.length>0?((0,s.uX)(),(0,s.CE)("div",gS,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectedCompliance.selected_risks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"audit_risk-mitigation"},[(0,s.Lk)("div",yS,[(0,s.Lk)("strong",null,(0,d.v_)(e.title),1)]),(0,s.Lk)("div",fS,[(0,s.Lk)("label",bS,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[23]||(t[23]=e=>n.selectedCompliance.selected_mitigations=e),value:{risk_id:e.id,mitigation:e.mitigation},onChange:t[24]||(t[24]=(...e)=>n.handleMitigationChange&&n.handleMitigationChange(...e))},null,40,CS),[[a.lH,n.selectedCompliance.selected_mitigations]]),(0,s.Lk)("span",LS,(0,d.v_)(e.mitigation),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",wS," Select risks to view corrective actions "))])]),(0,s.Lk)("div",ES,[(0,s.Lk)("div",RS,[t[95]||(t[95]=(0,s.Lk)("label",null,"Suggested Action Plan",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[25]||(t[25]=e=>n.selectedCompliance.suggested_action_plan=e),onInput:t[26]||(t[26]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.suggested_action_plan]])]),(0,s.Lk)("div",IS,[t[96]||(t[96]=(0,s.Lk)("label",null,"Responsible for Plan",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[27]||(t[27]=e=>n.selectedCompliance.responsible_for_plan=e),onInput:t[28]||(t[28]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.responsible_for_plan]])]),(0,s.Lk)("div",DS,[t[97]||(t[97]=(0,s.Lk)("label",null,"Mitigation Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[29]||(t[29]=e=>n.selectedCompliance.mitigation_date=e),onChange:t[30]||(t[30]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.mitigation_date]])])]),(0,s.Lk)("div",PS,[(0,s.Lk)("div",_S,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[31]||(t[31]=e=>n.selectedCompliance.re_audit=e),onChange:t[32]||(t[32]=(...e)=>n.onFieldChange&&n.onFieldChange(...e))},null,544),[[a.lH,n.selectedCompliance.re_audit]]),t[98]||(t[98]=(0,s.eW)(" Re-audit Required "))])]),n.selectedCompliance.re_audit?((0,s.uX)(),(0,s.CE)("div",AS,[t[99]||(t[99]=(0,s.Lk)("label",null,"Re-audit Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[33]||(t[33]=e=>n.selectedCompliance.re_audit_date=e),onChange:t[34]||(t[34]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.re_audit_date]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",SS,[t[100]||(t[100]=(0,s.Lk)("label",null,"Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[35]||(t[35]=e=>n.selectedCompliance.comments=e),onInput:t[36]||(t[36]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control"},null,544),[[a.Jo,n.selectedCompliance.comments]])])]),(0,s.Lk)("div",TS,[(0,s.Lk)("div",xS,[t[102]||(t[102]=(0,s.Lk)("label",null,"Review Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[37]||(t[37]=e=>n.selectedCompliance.review_status=e),disabled:"",class:"audit_form-control disabled"},t[101]||(t[101]=[(0,s.Lk)("option",{value:"in_review"},"In Review",-1),(0,s.Lk)("option",{value:"accept"},"Accept",-1),(0,s.Lk)("option",{value:"reject"},"Reject",-1)]),512),[[a.u1,n.selectedCompliance.review_status]])]),(0,s.Lk)("div",FS,[t[103]||(t[103]=(0,s.Lk)("label",null,"Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[38]||(t[38]=e=>n.selectedCompliance.review_comments=e),disabled:"",class:"audit_form-control disabled",placeholder:"Review comments will appear here..."},null,512),[[a.Jo,n.selectedCompliance.review_comments]])])]),(0,s.Lk)("div",VS,[(0,s.Lk)("div",US,[t[104]||(t[104]=(0,s.Lk)("label",null,"Compliance Evidence",-1)),(0,s.Lk)("div",NS,[(0,s.Lk)("input",{type:"file",onChange:t[39]||(t[39]=(...e)=>n.handleComplianceFileUpload&&n.handleComplianceFileUpload(...e)),ref:"complianceFileInput",multiple:"",style:{display:"none"}},null,544),(0,s.Lk)("button",{onClick:t[40]||(t[40]=t=>e.$refs.complianceFileInput.click()),class:"audit_upload-button"}," Upload Compliance Evidence "),n.selectedCompliance.evidence_files&&n.selectedCompliance.evidence_files.length>0?((0,s.uX)(),(0,s.CE)("div",MS,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.selectedCompliance.evidence_files,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["audit_file-item",{"from-version":e.fromVersion}])},[(0,s.Lk)("span",XS,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",$S,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"👁️",8,OS)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:e=>n.removeComplianceFile(t),class:"audit_remove-file-btn"},"×",8,jS)],2))),128))])):(0,s.Q3)("",!0),l.complianceUploadProgress>0&&l.complianceUploadProgress<100?((0,s.uX)(),(0,s.CE)("div",BS,[(0,s.Lk)("div",WS,[(0,s.Lk)("div",{class:"audit_progress-fill",style:(0,d.Tr)({width:l.complianceUploadProgress+"%"})},null,4)]),(0,s.Lk)("span",null,(0,d.v_)(l.complianceUploadProgress)+"%",1)])):(0,s.Q3)("",!0)])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",qS,[(0,s.Lk)("button",{onClick:t[41]||(t[41]=(...e)=>n.saveCompliance&&n.saveCompliance(...e)),class:"audit_floating-save-button",disabled:l.isSaving},[(0,s.Lk)("span",KS,(0,d.v_)(l.isSaving?"Saving Version...":"Save Changes"),1)],8,QS)])])]),(0,s.Lk)("div",JS,[t[106]||(t[106]=(0,s.Lk)("h3",null,"Audit Evidence",-1)),(0,s.Lk)("div",zS,[(0,s.Lk)("input",{type:"file",onChange:t[42]||(t[42]=(...e)=>n.handleAuditFileUpload&&n.handleAuditFileUpload(...e)),ref:"auditFileInput",multiple:"",style:{display:"none"}},null,544),(0,s.Lk)("button",{onClick:t[43]||(t[43]=t=>e.$refs.auditFileInput.click()),class:"audit_upload-button audit_audit-upload"}," Upload Audit Evidence "),l.auditEvidenceFiles&&l.auditEvidenceFiles.length>0?((0,s.uX)(),(0,s.CE)("div",HS,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditEvidenceFiles,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["audit_file-item",{"from-version":e.fromVersion}])},[(0,s.Lk)("span",GS,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",YS,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"👁️",8,ZS)):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:e=>n.removeAuditFile(t),class:"audit_remove-file-btn"},"×",8,eT)],2))),128))])):(0,s.Q3)("",!0),l.auditUploadProgress>0&&l.auditUploadProgress<100?((0,s.uX)(),(0,s.CE)("div",tT,[(0,s.Lk)("div",iT,[(0,s.Lk)("div",{class:"audit_progress-fill",style:(0,d.Tr)({width:l.auditUploadProgress+"%"})},null,4)]),(0,s.Lk)("span",null,(0,d.v_)(l.auditUploadProgress)+"%",1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",aT,[t[107]||(t[107]=(0,s.Lk)("h3",null,"Overall Audit Comments",-1)),(0,s.Lk)("div",sT,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[44]||(t[44]=e=>l.overallAuditComments=e),onInput:t[45]||(t[45]=(...e)=>n.onFieldChange&&n.onFieldChange(...e)),class:"audit_form-control audit_overall-comments-textarea",placeholder:"Enter overall comments about this audit...",rows:"4"},null,544),[[a.Jo,l.overallAuditComments]])])]),(0,s.Lk)("div",oT,[t[108]||(t[108]=(0,s.Lk)("h3",null,"Overall Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[46]||(t[46]=e=>l.overallReviewComments=e),disabled:l.isAuditFrozen,class:"audit_form-control",placeholder:"Enter overall review comments...",rows:"4"},null,8,lT),[[a.Jo,l.overallReviewComments]])]),l.currentVersion?((0,s.uX)(),(0,s.CE)("div",nT,[(0,s.Lk)("div",rT,[t[109]||(t[109]=(0,s.Lk)("span",{class:"audit_version-label"},"Current Version:",-1)),(0,s.Lk)("span",cT,(0,d.v_)(l.currentVersion),1),(0,s.Lk)("span",dT,(0,d.v_)(n.getVersionType(l.currentVersion)),1)]),l.lastSavedTime?((0,s.uX)(),(0,s.CE)("div",uT,[t[110]||(t[110]=(0,s.Lk)("span",{class:"audit_saved-label"},"Last Saved:",-1)),(0,s.Lk)("span",pT,(0,d.v_)(n.formatDateTime(l.lastSavedTime)),1)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",mT,t[111]||(t[111]=[(0,s.Lk)("div",{class:"audit_version-badge"},[(0,s.Lk)("span",{class:"audit_version-label"},"Status:"),(0,s.Lk)("span",{class:"audit_version-number new-audit"},"New Audit"),(0,s.Lk)("span",{class:"audit_version-type"},"No versions saved yet")],-1)])))])):(0,s.Q3)("",!0),l.showReviewModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"audit_modal-overlay",onClick:t[51]||(t[51]=(...e)=>n.closeReviewModal&&n.closeReviewModal(...e))},[(0,s.Lk)("div",{class:"audit_modal-content",onClick:t[50]||(t[50]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",vT,[t[112]||(t[112]=(0,s.Lk)("h3",null,"Update Audit Status",-1)),(0,s.Lk)("button",{onClick:t[47]||(t[47]=(...e)=>n.closeReviewModal&&n.closeReviewModal(...e)),class:"audit_close-button"},"×")]),t[113]||(t[113]=(0,s.Lk)("div",{class:"audit_modal-body"},[(0,s.Lk)("div",{class:"audit_success-message"},[(0,s.Lk)("h4",null,"Changes Saved Successfully"),(0,s.Lk)("p",null,"You have saved the following changes:")]),(0,s.Lk)("div",{class:"audit_review-question"},[(0,s.Lk)("h4",null,"Do you want to send this audit for review?"),(0,s.Lk)("p",{class:"audit_review-note"},[(0,s.Lk)("em",null,'This will change the audit status from "Work In Progress" to "Under Review"')])])],-1)),(0,s.Lk)("div",kT,[(0,s.Lk)("button",{onClick:t[48]||(t[48]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_btn-secondary"},"No, Keep Editing"),(0,s.Lk)("button",{onClick:t[49]||(t[49]=(...e)=>n.sendForReview&&n.sendForReview(...e)),class:"audit_btn-primary",disabled:l.isSendingForReview},(0,d.v_)(l.isSendingForReview?"Sending...":"Yes, Send for Review"),9,hT)])])])):(0,s.Q3)("",!0),l.showAddComplianceModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"audit_modal-overlay",onClick:t[70]||(t[70]=(...e)=>n.closeAddComplianceModal&&n.closeAddComplianceModal(...e))},[(0,s.Lk)("div",{class:"audit_modal-content audit_add-compliance-modal",onClick:t[69]||(t[69]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",gT,[t[114]||(t[114]=(0,s.Lk)("h3",null,"Add New Compliance",-1)),(0,s.Lk)("button",{onClick:t[52]||(t[52]=(...e)=>n.closeAddComplianceModal&&n.closeAddComplianceModal(...e)),class:"audit_close-button"},"×")]),(0,s.Lk)("div",yT,[(0,s.Lk)("form",{onSubmit:t[66]||(t[66]=(0,a.D$)((...e)=>n.submitNewCompliance&&n.submitNewCompliance(...e),["prevent"]))},[(0,s.Lk)("div",fT,[(0,s.Lk)("div",bT,[t[115]||(t[115]=(0,s.Lk)("label",null,"Identifier*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[53]||(t[53]=e=>l.newCompliance.identifier=e),required:"",class:"audit_form-control"},null,512),[[a.Jo,l.newCompliance.identifier]]),n.getFieldError("identifier")?((0,s.uX)(),(0,s.CE)("div",CT,(0,d.v_)(n.getFieldError("identifier")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",LT,[t[116]||(t[116]=(0,s.Lk)("label",null,"Compliance Title*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[54]||(t[54]=e=>l.newCompliance.complianceTitle=e),required:"",class:"audit_form-control"},null,512),[[a.Jo,l.newCompliance.complianceTitle]]),n.getFieldError("complianceTitle")?((0,s.uX)(),(0,s.CE)("div",wT,(0,d.v_)(n.getFieldError("complianceTitle")),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",ET,[t[117]||(t[117]=(0,s.Lk)("label",null,"Compliance Description*",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[55]||(t[55]=e=>l.newCompliance.complianceItemDescription=e),required:"",class:"audit_form-control",rows:"3"},null,512),[[a.Jo,l.newCompliance.complianceItemDescription]])]),(0,s.Lk)("div",RT,[(0,s.Lk)("div",IT,[t[118]||(t[118]=(0,s.Lk)("label",null,"Compliance Type*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[56]||(t[56]=e=>l.newCompliance.complianceType=e),required:"",class:"audit_form-control"},null,512),[[a.Jo,l.newCompliance.complianceType]])]),(0,s.Lk)("div",DT,[t[119]||(t[119]=(0,s.Lk)("label",null,"Scope*",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[57]||(t[57]=e=>l.newCompliance.scope=e),required:"",class:"audit_form-control"},null,512),[[a.Jo,l.newCompliance.scope]])])]),(0,s.Lk)("div",PT,[(0,s.Lk)("div",_T,[t[120]||(t[120]=(0,s.Lk)("label",null,"Objective*",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[58]||(t[58]=e=>l.newCompliance.objective=e),required:"",class:"audit_form-control",rows:"2"},null,512),[[a.Jo,l.newCompliance.objective]])]),(0,s.Lk)("div",AT,[t[121]||(t[121]=(0,s.Lk)("label",null,"Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[59]||(t[59]=e=>l.newCompliance.impact=e),class:"audit_form-control",rows:"2"},null,512),[[a.Jo,l.newCompliance.impact]])])]),(0,s.Lk)("div",ST,[(0,s.Lk)("div",TT,[t[124]||(t[124]=(0,s.Lk)("label",null,"Is Risk?",-1)),(0,s.Lk)("div",xT,[(0,s.Lk)("label",FT,[(0,s.bo)((0,s.Lk)("input",{type:"radio","onUpdate:modelValue":t[60]||(t[60]=e=>l.newCompliance.isRisk=e),value:1},null,512),[[a.XL,l.newCompliance.isRisk]]),t[122]||(t[122]=(0,s.eW)(" Yes "))]),(0,s.Lk)("label",VT,[(0,s.bo)((0,s.Lk)("input",{type:"radio","onUpdate:modelValue":t[61]||(t[61]=e=>l.newCompliance.isRisk=e),value:0},null,512),[[a.XL,l.newCompliance.isRisk]]),t[123]||(t[123]=(0,s.eW)(" No "))])])]),(0,s.Lk)("div",UT,[t[126]||(t[126]=(0,s.Lk)("label",null,"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[62]||(t[62]=e=>l.newCompliance.criticality=e),class:"audit_form-control"},t[125]||(t[125]=[(0,s.Lk)("option",{value:"high"},"High",-1),(0,s.Lk)("option",{value:"medium"},"Medium",-1),(0,s.Lk)("option",{value:"low"},"Low",-1)]),512),[[a.u1,l.newCompliance.criticality]])]),(0,s.Lk)("div",NT,[t[128]||(t[128]=(0,s.Lk)("label",null,"Probability",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[63]||(t[63]=e=>l.newCompliance.probability=e),class:"audit_form-control"},t[127]||(t[127]=[(0,s.Lk)("option",{value:"high"},"High",-1),(0,s.Lk)("option",{value:"medium"},"Medium",-1),(0,s.Lk)("option",{value:"low"},"Low",-1)]),512),[[a.u1,l.newCompliance.probability]])])]),(0,s.Lk)("div",MT,[(0,s.Lk)("div",XT,[t[129]||(t[129]=(0,s.Lk)("label",null,"Possible Damage",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[64]||(t[64]=e=>l.newCompliance.possibleDamage=e),class:"audit_form-control",rows:"2"},null,512),[[a.Jo,l.newCompliance.possibleDamage]])]),(0,s.Lk)("div",$T,[t[130]||(t[130]=(0,s.Lk)("label",null,"Mitigation",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[65]||(t[65]=e=>l.newCompliance.mitigation=e),class:"audit_form-control",rows:"2"},null,512),[[a.Jo,l.newCompliance.mitigation]])])]),t[131]||(t[131]=(0,s.Lk)("div",{class:"audit_form-note"},[(0,s.Lk)("p",null,[(0,s.Lk)("strong",null,"Note:"),(0,s.eW)(" Fields marked with * are required")]),(0,s.Lk)("p",null,'This compliance will be added as "Temporary" and associated with the current audit.')],-1))],32)]),(0,s.Lk)("div",OT,[(0,s.Lk)("button",{onClick:t[67]||(t[67]=(...e)=>n.closeAddComplianceModal&&n.closeAddComplianceModal(...e)),class:"audit_btn-secondary"},"Cancel"),(0,s.Lk)("button",{onClick:t[68]||(t[68]=(...e)=>n.submitNewCompliance&&n.submitNewCompliance(...e)),class:"audit_btn-primary",disabled:l.isAddingCompliance},(0,d.v_)(l.isAddingCompliance?"Adding...":"Add Compliance"),9,jT)])])])):(0,s.Q3)("",!0)])}var WT={name:"TaskView",mixins:[$_],data(){return{auditDetails:null,error:null,loading:!0,selectedComplianceIndex:null,auditEvidenceFiles:[],complianceUploadProgress:0,auditUploadProgress:0,currentVersion:null,lastSavedTime:null,isSaving:!1,hasUnsavedChanges:!1,overallAuditComments:"",showReviewModal:!1,isSendingForReview:!1,savedVersionData:null,showAddComplianceModal:!1,isAddingCompliance:!1,newCompliance:{identifier:"",complianceTitle:"",complianceItemDescription:"",complianceType:"",scope:"",objective:"",impact:"",isRisk:0,possibleDamage:"",mitigation:"",criticality:"medium",probability:"medium"},isAuditFrozen:!1,overallReviewComments:"",validationErrors:{},fieldErrors:{}}},computed:{selectedCompliance(){return this.auditDetails?.compliances?this.auditDetails.compliances[this.selectedComplianceIndex]:null}},watch:{auditDetails:{handler(e,t){t&&e&&(this.hasUnsavedChanges=!0)},deep:!0},auditEvidenceFiles:{handler(){this.hasUnsavedChanges=!0},deep:!0}},methods:{formatDateTime(e){return e?new Date(e).toLocaleString():""},getVersionType(e){return e?e.startsWith("A")?"Auditor Version":e.startsWith("R")?"Reviewer Version":"Unknown Version":""},extractFilenameFromUrl(e){if(!e)return null;try{const t=e.split("/"),i=t[t.length-1];return decodeURIComponent(i)}catch(t){return console.warn("Error extracting filename from URL:",e,t),null}},async handleComplianceFileUpload(e){const t=Array.from(e.target.files);if(0===t.length)return;this.complianceUploadProgress=0,this.onFieldChange();const i=[];try{for(let s=0;s<t.length;s++){const e=t[s],a=new FormData;a.append("file",e),a.append("userId","current-user"),a.append("documentType","evidence"),a.append("compliance_id",this.selectedCompliance.id),a.append("audit_id",this.$route.params.auditId),a.append("fileName",e.name);const o=await fetch("http://localhost:8000/api/upload-evidence-s3/",{method:"POST",body:a,credentials:"include"});if(!o.ok){const e=await o.json();throw new Error(e.error||"Upload failed")}const l=await o.json();l.success&&(i.push(l.file.url),this.selectedCompliance.evidence_files.push({name:e.name,url:l.file.url,uploadedAt:(new Date).toISOString(),fromVersion:!1})),this.complianceUploadProgress=Math.round(100*(s+1)/t.length)}const e=this.selectedCompliance.evidence?this.selectedCompliance.evidence.split(",").filter(e=>e.trim()):[],a=[...e];i.forEach(e=>{a.includes(e)||a.push(e)}),this.selectedCompliance.evidence_urls=a.join(","),this.selectedCompliance.evidence=this.selectedCompliance.evidence_urls,console.log("Updated evidence URLs:",this.selectedCompliance.evidence),this.complianceUploadProgress=100,this.hasUnsavedChanges=!0,setTimeout(()=>{this.complianceUploadProgress=0},2e3),this.$toast?.success(`${t.length} compliance evidence file(s) uploaded successfully`),await this.sendPushNotification({title:"Compliance Evidence Uploaded",message:`${t.length} compliance evidence file(s) uploaded for compliance: ${this.selectedCompliance.description}`,category:"compliance",priority:"medium",user_id:"current-user"})}catch(a){if(console.error("Error uploading compliance files:",a),Tr.wr.handleApiError(a,"compliance file upload"))return void(this.complianceUploadProgress=0);this.$toast?.error("Failed to upload compliance evidence files"),this.complianceUploadProgress=0,await this.sendPushNotification({title:"Compliance Evidence Upload Failed",message:`Failed to upload compliance evidence file(s) for compliance: ${this.selectedCompliance?.description||""}`,category:"compliance",priority:"high",user_id:"current-user"})}e.target.value=""},async handleAuditFileUpload(e){const t=Array.from(e.target.files);if(0===t.length)return;this.auditUploadProgress=0,this.onFieldChange();const i=[];try{for(let s=0;s<t.length;s++){const e=t[s],a=new FormData;a.append("file",e),a.append("userId","current-user"),a.append("documentType","audit_evidence"),a.append("audit_id",this.$route.params.auditId),a.append("fileName",e.name);const o=await fetch("http://localhost:8000/api/upload-evidence-s3/",{method:"POST",body:a,credentials:"include"});if(!o.ok){const e=await o.json();throw new Error(e.error||"Upload failed")}const l=await o.json();l.success&&(i.push(l.file.url),this.auditEvidenceFiles.push({name:e.name,url:l.file.url,uploadedAt:(new Date).toISOString(),fromVersion:!1})),this.auditUploadProgress=Math.round(100*(s+1)/t.length)}const e=this.auditDetails.evidence_urls?this.auditDetails.evidence_urls.split(",").filter(e=>e.trim()):[],a=[...e];i.forEach(e=>{a.includes(e)||a.push(e)}),this.auditDetails.evidence_urls=a.join(","),console.log("Updated audit evidence URLs:",this.auditDetails.evidence_urls),this.auditUploadProgress=100,this.hasUnsavedChanges=!0,setTimeout(()=>{this.auditUploadProgress=0},2e3),this.$toast?.success(`${t.length} audit evidence file(s) uploaded successfully`),await this.sendPushNotification({title:"Audit Evidence Uploaded",message:`${t.length} audit evidence file(s) uploaded for audit: ${this.auditDetails?.title||""}`,category:"audit",priority:"medium",user_id:"current-user"})}catch(a){console.error("Error uploading audit files:",a),this.$toast?.error("Failed to upload audit evidence files"),this.auditUploadProgress=0,await this.sendPushNotification({title:"Audit Evidence Upload Failed",message:`Failed to upload audit evidence file(s) for audit: ${this.auditDetails?.title||""}`,category:"audit",priority:"high",user_id:"current-user"})}e.target.value=""},removeComplianceFile(e){const t=this.selectedCompliance.evidence_files[e];if(this.selectedCompliance.evidence_files.splice(e,1),t&&t.url){const e=this.selectedCompliance.evidence.split(",").filter(e=>e.trim()),i=e.filter(e=>e!==t.url);this.selectedCompliance.evidence=i.join(","),this.selectedCompliance.evidence_urls=this.selectedCompliance.evidence,console.log("Updated evidence URLs after removal:",this.selectedCompliance.evidence)}this.onFieldChange()},removeAuditFile(e){const t=this.auditEvidenceFiles[e];if(this.auditEvidenceFiles.splice(e,1),t&&t.url){const e=this.auditDetails.evidence_urls.split(",").filter(e=>e.trim()),i=e.filter(e=>e!==t.url);this.auditDetails.evidence_urls=i.join(","),console.log("Updated audit evidence URLs after removal:",this.auditDetails.evidence_urls)}this.onFieldChange()},async fetchAuditDetails(){this.loading=!0,this.error=null;try{this.error=null;const e=this.$route.params.auditId;if(!e)return void(this.error="No audit ID provided");console.log("Fetching details for audit:",e);const t=await PA.FH.getAuditTaskDetails(e);if(this.auditDetails=t.data,this.auditDetails.compliances.forEach(e=>{if(e.selected_risks=e.selected_risks||[],e.selected_mitigations=e.selected_mitigations||[],e.risks=e.risks||[],e.evidence_files=[],e.evidence_urls=e.evidence||"",e.evidence){const t=e.evidence.split(",").filter(e=>e.trim());e.evidence_files=t.map((e,t)=>{const i=this.extractFilenameFromUrl(e)||`Evidence ${t+1}`;return{name:i,url:e.trim(),uploadedAt:null,fromVersion:this.auditDetails.loaded_from_version||!1}})}}),this.auditEvidenceFiles=[],this.auditDetails.evidence_urls){const e=this.auditDetails.evidence_urls.split(",").filter(e=>e.trim());this.auditEvidenceFiles=e.map((e,t)=>{const i=this.extractFilenameFromUrl(e)||`Audit Evidence ${t+1}`;return{name:i,url:e.trim(),uploadedAt:null,fromVersion:this.auditDetails.loaded_from_version||!1}})}this.auditDetails.current_version&&(this.currentVersion=this.auditDetails.current_version,this.lastSavedTime=this.auditDetails.version_date,console.log(`Loaded version: ${this.currentVersion} from ${this.lastSavedTime}`),this.auditDetails.loaded_from_version?this.$toast?.info(`Loaded data from ${this.getVersionType(this.currentVersion)} ${this.currentVersion}`):"A1"===this.currentVersion&&this.$toast?.success(`Initial version ${this.currentVersion} created successfully`)),this.overallAuditComments=this.auditDetails.overall_audit_comments||"",this.overallReviewComments=this.auditDetails.overall_review_comments||"",this.hasUnsavedChanges=!0,this.auditDetails.compliances&&this.auditDetails.compliances.length>0&&null===this.selectedComplianceIndex&&this.selectCompliance(this.auditDetails.compliances[0],0),console.log(`Loaded ${this.auditDetails.compliances?this.auditDetails.compliances.length:0} compliances`)}catch(e){console.error("Error fetching audit details:",e),Tr.wr.handleApiError(e,"audit task details access")?this.error="Access denied":this.error=e.response?.data?.error||"Failed to load audit details"}finally{this.loading=!1}},retryFetch(){this.fetchAuditDetails()},getStatusClass(e){switch(e){case"2":return"status-completed";case"1":return"status-progress";case"0":return"status-pending";default:return"status-pending"}},getStatusText(e){switch(e){case"2":return"Completed";case"1":return"In Progress";case"0":return"Not Started";default:return"Not Started"}},updateCorrectiveActions(){this.selectedCompliance.selected_mitigations=[],this.hasUnsavedChanges=!0,this.onFieldChange()},handleMitigationChange(){this.hasUnsavedChanges=!0},onFieldChange(){this.hasUnsavedChanges=!0,this.selectedCompliance&&null!==this.selectedComplianceIndex&&(this.fieldErrors[this.selectedComplianceIndex]&&(this.fieldErrors[this.selectedComplianceIndex]={}),this.validateComplianceField("status",this.selectedCompliance.status,this.selectedComplianceIndex),this.validateComplianceField("severity_rating",this.selectedCompliance.severity_rating,this.selectedComplianceIndex),this.validateComplianceField("major_minor",this.selectedCompliance.major_minor,this.selectedComplianceIndex))},async saveCompliance(){if(console.log("Save button clicked!"),console.log("isSaving state:",this.isSaving),this.isSaving)return;const e=this.validateAuditData();if(console.log("Validation result:",e),console.log("Field errors:",this.fieldErrors),console.log("Validation errors:",this.validationErrors),!e){console.log("Validation failed - showing specific errors");let e="Validation errors found:";Object.keys(this.validationErrors).length>0&&(e+=" "+Object.values(this.validationErrors).join(", "));for(const t in this.fieldErrors)Object.keys(this.fieldErrors[t]).length>0&&(e+=` Compliance ${parseInt(t)+1}: `+Object.values(this.fieldErrors[t]).join(", "));return this.$toast?.error(e),void await this.sendPushNotification({title:"Audit Save Validation Error",message:e,category:"audit",priority:"high",user_id:"current-user"})}console.log("Starting save operation...");try{this.isSaving=!0;const e=e=>{if(!e)return"";if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;try{const t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString().split("T")[0]}catch(t){console.warn("Could not parse date:",e)}return e},t={};console.log("Processing compliances:",this.auditDetails.compliances.length),this.auditDetails.compliances.forEach(i=>{console.log("Processing compliance:",i.id,"mitigation_date:",i.mitigation_date),t[i.id]={description:i.description,status:i.status,evidence:i.evidence||"",comments:i.comments||"",how_to_verify:i.how_to_verify||"",impact:i.impact||"",recommendation:i.recommendation||"",details_of_finding:i.details_of_finding||"",major_minor:i.major_minor||"",severity_rating:i.severity_rating||"",why_to_verify:i.why_to_verify||"",what_to_verify:i.what_to_verify||"",underlying_cause:i.underlying_cause||"",suggested_action_plan:i.suggested_action_plan||"",responsible_for_plan:i.responsible_for_plan||"",mitigation_date:e(i.mitigation_date),re_audit:i.re_audit||!1,re_audit_date:e(i.re_audit_date),selected_risks:i.selected_risks||[],selected_mitigations:i.selected_mitigations||[],review_status:i.review_status||"in_review",review_comments:i.review_comments||""},console.log("Formatted mitigation_date for compliance",i.id,":",t[i.id].mitigation_date)});const i=this.auditEvidenceFiles.map(e=>e.url).join(",");console.log("Audit evidence URLs being saved:",i);const a={user_id:1050,compliances:t,audit_evidence_urls:i||this.auditDetails.evidence_urls||"",audit_title:this.auditDetails.title||"",audit_scope:this.auditDetails.scope||"",audit_objective:this.auditDetails.objective||"",business_unit:this.auditDetails.business_unit||"",overall_comments:this.overallAuditComments||""};console.log("Payload to be sent:",JSON.stringify(a,null,2));const s=this.$route.params.auditId;console.log("Calling api.saveVersion with auditId:",s);const o=await PA.FH.saveVersion(s,a);if(console.log("Save response received:",o),!o.data.success)throw new Error("Failed to save audit version");this.savedVersionData={version:o.data.version,data:o.data.data},this.hasUnsavedChanges=!1,this.currentVersion=o.data.version,this.lastSavedTime=(new Date).toISOString(),this.validationErrors={},this.fieldErrors={},console.log("Saved version:",o.data.version),console.log("Version data:",o.data.data),this.showReviewModal=!0,this.$toast?.success(`Audit version ${this.currentVersion} saved successfully`),await this.sendPushNotification({title:"Audit Version Saved",message:`Audit version ${this.currentVersion} saved successfully for audit: ${this.auditDetails?.title||""}`,category:"audit",priority:"medium",user_id:"current-user"})}catch(t){console.error("Error saving audit version:",t),400===t.response?.status&&t.response?.data?.error?t.response.data.error.includes("Validation error")?(this.$toast?.error("Validation error: "+t.response.data.error),await this.sendPushNotification({title:"Audit Save Validation Error",message:"Validation error: "+t.response.data.error,category:"audit",priority:"high",user_id:"current-user"})):(this.$toast?.error(t.response.data.error),await this.sendPushNotification({title:"Audit Save Error",message:t.response.data.error,category:"audit",priority:"high",user_id:"current-user"})):(this.$toast?.error("Failed to save audit version: "+(t.response?.data?.error||t.message)),await this.sendPushNotification({title:"Audit Save Error",message:"Failed to save audit version: "+(t.response?.data?.error||t.message),category:"audit",priority:"high",user_id:"current-user"}))}finally{this.isSaving=!1}},selectCompliance(e,t){console.log("Selecting compliance:",e.id,"at index:",t),this.selectedComplianceIndex=t,this.onFieldChange(),console.log("Selected compliance is now:",this.selectedCompliance?.id)},closeReviewModal(){this.showReviewModal=!1,this.savedVersionData=null},keepEditing(){this.closeReviewModal(),this.$toast?.success(`Audit version ${this.currentVersion} saved successfully`)},async sendForReview(){if(!this.isSendingForReview)try{this.isSendingForReview=!0;const e=this.$route.params.auditId,t=await PA.FH.sendForReview(e,{version:this.currentVersion});if(!t.data.success)throw new Error("Failed to send audit for review");this.closeReviewModal(),this.$toast?.success("Audit sent for review successfully"),await this.sendPushNotification({title:"Audit Sent for Review",message:`Audit "${this.auditDetails?.title||""}" sent for review (version: ${this.currentVersion})`,category:"audit",priority:"high",user_id:"current-user"})}catch(e){if(console.error("Error sending audit for review:",e),Tr.wr.handleApiError(e,"audit review submission"))return;this.$toast?.error("Failed to send audit for review: "+(e.response?.data?.error||e.message)),await this.sendPushNotification({title:"Audit Review Send Failed",message:"Failed to send audit for review: "+(e.response?.data?.error||e.message),category:"audit",priority:"high",user_id:"current-user"})}finally{this.isSendingForReview=!1}},closeAddComplianceModal(){this.showAddComplianceModal=!1,this.newCompliance={identifier:"",complianceTitle:"",complianceItemDescription:"",complianceType:"",scope:"",objective:"",impact:"",isRisk:0,possibleDamage:"",mitigation:"",criticality:"medium",probability:"medium"}},async submitNewCompliance(){if(!this.isAddingCompliance){if(!this.validateNewComplianceForm())return this.$toast?.error("Please fix validation errors before submitting"),void await this.sendPushNotification({title:"Compliance Add Validation Error",message:"Please fix validation errors before submitting",category:"compliance",priority:"high",user_id:"current-user"});try{this.isAddingCompliance=!0;const e=this.$route.params.auditId,t={identifier:this.newCompliance.identifier,complianceTitle:this.newCompliance.complianceTitle,complianceItemDescription:this.newCompliance.complianceItemDescription,complianceType:this.newCompliance.complianceType,scope:this.newCompliance.scope,objective:this.newCompliance.objective,impact:this.newCompliance.impact||"",isRisk:Number(this.newCompliance.isRisk||0),possibleDamage:this.newCompliance.possibleDamage||"",mitigation:this.newCompliance.mitigation||"",criticality:this.newCompliance.criticality||"medium",probability:this.newCompliance.probability||"medium",permanentTemporary:"Temporary",createdByName:"1050",createdByDate:(new Date).toISOString().split("T")[0]};console.log("Submitting compliance data:",t);const i=await PA.FH.addComplianceToAudit(e,t);if(!i.data.success)throw new Error(i.data.error||"Failed to add compliance");if(this.$toast?.success("Compliance added successfully"),this.closeAddComplianceModal(),console.log("Refreshing audit details with the latest data including the new compliance"),await this.fetchAuditDetails(),this.auditDetails&&this.auditDetails.compliances&&this.auditDetails.compliances.length>0){const e=this.auditDetails.compliances.length-1;this.selectCompliance(this.auditDetails.compliances[e],e),this.currentVersion&&(this.$toast?.info(`Updated to version ${this.currentVersion} with the added compliance`),await this.sendPushNotification({title:"Audit Version Updated",message:`Updated to version ${this.currentVersion} with the added compliance`,category:"audit",priority:"medium",user_id:"current-user"}))}await this.sendPushNotification({title:"Compliance Added",message:`Compliance "${this.newCompliance.complianceTitle}" added to audit: ${this.auditDetails?.title||""}`,category:"compliance",priority:"medium",user_id:"current-user"})}catch(e){if(console.error("Error adding compliance:",e),Tr.wr.handleApiError(e,"compliance addition"))return;let t="Failed to add compliance";400===e.response?.status&&e.response?.data?.error?t=e.response.data.error.includes("Validation error")?"Validation error: "+e.response.data.error:e.response.data.error:e.response?.data?.error?(t+=": "+e.response.data.error,console.error("Server error details:",e.response.data)):e.message&&(t+=": "+e.message),this.$toast?.error(t),await this.sendPushNotification({title:"Compliance Add Error",message:t,category:"compliance",priority:"high",user_id:"current-user"})}finally{this.isAddingCompliance=!1}}},validateComplianceField(e,t,i=null){const a={};switch(e){case"status":{const e=this.validateComplianceStatus(t);e&&(a.status=e);break}case"severity_rating":if(null!==t&&""!==t){const e=parseInt(t);(isNaN(e)||e<1||e>10)&&(a.severity_rating="Severity rating must be between 1 and 10")}break;case"major_minor":t&&!["0","1"].includes(t)&&(a.major_minor="Invalid finding type");break;case"comments":case"how_to_verify":case"impact":case"details_of_finding":case"underlying_cause":case"suggested_action_plan":case"why_to_verify":case"what_to_verify":{const i=this.validateString(t,{required:!1,minLength:0,maxLength:"comments"===e||"details_of_finding"===e||"suggested_action_plan"===e?2e3:1e3,fieldName:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())});i&&(a[e]=i);break}case"responsible_for_plan":{const i=this.validateString(t,{required:!1,minLength:0,maxLength:200,fieldName:"Responsible for Plan"});i&&(a[e]=i);break}case"mitigation_date":case"re_audit_date":if(t){const i=this.validateDate(t,e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()));i&&(a[e]=i)}break}return null!==i&&(this.fieldErrors[i]||(this.fieldErrors[i]={}),Object.keys(a).length>0?this.fieldErrors[i]={...this.fieldErrors[i],...a}:delete this.fieldErrors[i][e]),0===Object.keys(a).length},validateComplianceStatus(e){const t=["0","1","2","3"];return t.includes(e)?null:"Invalid compliance status"},validateNewComplianceForm(){const e={},t=["identifier","complianceTitle","complianceItemDescription","complianceType","scope","objective"];t.forEach(t=>{const i=this.newCompliance[t];i&&""!==i.trim()||(e[t]=`${t.replace(/([A-Z])/g," $1").toLowerCase()} is required`)});const i=this.validateString(this.newCompliance.identifier,{fieldName:"Identifier",minLength:1,maxLength:100});i&&(e.identifier=i);const a=this.validateString(this.newCompliance.complianceTitle,{fieldName:"Compliance Title",minLength:1,maxLength:200});a&&(e.complianceTitle=a);const s=this.validateString(this.newCompliance.complianceItemDescription,{fieldName:"Compliance Description",minLength:1,maxLength:2e3});s&&(e.complianceItemDescription=s);const o=this.validateString(this.newCompliance.complianceType,{fieldName:"Compliance Type",minLength:1,maxLength:100});o&&(e.complianceType=o);const l=this.validateString(this.newCompliance.scope,{fieldName:"Scope",minLength:1,maxLength:500});l&&(e.scope=l);const n=this.validateString(this.newCompliance.objective,{fieldName:"Objective",minLength:1,maxLength:1e3});if(n&&(e.objective=n),this.newCompliance.impact){const t=this.validateString(this.newCompliance.impact,{fieldName:"Impact",required:!1,maxLength:1e3});t&&(e.impact=t)}if(this.newCompliance.possibleDamage){const t=this.validateString(this.newCompliance.possibleDamage,{fieldName:"Possible Damage",required:!1,maxLength:1e3});t&&(e.possibleDamage=t)}if(this.newCompliance.mitigation){const t=this.validateString(this.newCompliance.mitigation,{fieldName:"Mitigation",required:!1,maxLength:1e3});t&&(e.mitigation=t)}const r=["high","medium","low"];return r.includes(this.newCompliance.criticality)||(e.criticality="Criticality must be high, medium, or low"),r.includes(this.newCompliance.probability)||(e.probability="Probability must be high, medium, or low"),0!==this.newCompliance.isRisk&&1!==this.newCompliance.isRisk&&(e.isRisk="Is Risk must be yes or no"),this.validationErrors=e,0===Object.keys(e).length},validateAuditData(){const e={};if(this.overallAuditComments){const t=this.validateString(this.overallAuditComments,{fieldName:"Overall Audit Comments",required:!1,maxLength:5e3});t&&(e.overallAuditComments=t)}this.auditEvidenceFiles&&this.auditEvidenceFiles.length>20&&(e.auditEvidenceFiles="Too many audit evidence files (maximum 20)"),this.fieldErrors={},this.auditDetails&&this.auditDetails.compliances&&this.auditDetails.compliances.forEach((e,t)=>{e.severity_rating&&""!==e.severity_rating&&this.validateComplianceField("severity_rating",e.severity_rating,t),e.status&&this.validateComplianceField("status",e.status,t),e.major_minor&&this.validateComplianceField("major_minor",e.major_minor,t)});let t=!1;for(const i in this.fieldErrors)if(Object.keys(this.fieldErrors[i]).length>0){t=!0;break}return console.log("Basic validation errors:",e),console.log("Has field errors:",t),0===Object.keys(e).length&&!t},getFieldError(e,t=null){return null!==t&&this.fieldErrors[t]?this.fieldErrors[t][e]:this.validationErrors[e]},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}}},mounted(){this.fetchAuditDetails()}};const qT=(0,le.A)(WT,[["render",BT],["__scopeId","data-v-228a2a84"]]);var QT=qT;const KT={class:"audit_task-view"},JT={key:0,class:"audit_error-message"},zT={key:1,class:"audit_loading"},HT={key:2,class:"audit_content"},GT={class:"audit_audit-details"},YT={class:"audit_details-container"},ZT={class:"audit_detail-item"},ex={class:"audit_detail-item"},tx={class:"audit_detail-item"},ix={class:"audit_detail-item"},ax={class:"audit_hierarchy-details"},sx={class:"audit_hierarchy-item"},ox={class:"audit_hierarchy-item"},lx={class:"audit_hierarchy-item"},nx={class:"audit_compliance-section"},rx={class:"audit_compliance-tabs"},cx=["onClick"],dx={key:0,class:"audit_compliance-details"},ux={class:"audit_compliance-header"},px={class:"audit_compliance-row"},mx={class:"audit_form-group"},vx={class:"audit_form-group"},kx={class:"audit_form-group"},hx={class:"audit_compliance-row"},gx={class:"audit_form-group"},yx={class:"audit_form-group"},fx={class:"audit_form-group"},bx={class:"audit_compliance-row"},Cx={class:"audit_form-group"},Lx={class:"audit_form-group"},wx={class:"audit_form-group"},Ex={class:"audit_compliance-row"},Rx={class:"audit_form-group"},Ix=["value"],Dx={class:"audit_form-group"},Px={key:0,class:"audit_corrective-actions-container"},_x={class:"audit_risk-header"},Ax={class:"audit_mitigation-actions"},Sx={class:"audit_mitigation-checkbox"},Tx=["value"],xx={class:"audit_mitigation-text"},Fx={key:1,class:"audit_no-actions"},Vx={class:"audit_compliance-row"},Ux={class:"audit_form-group"},Nx={class:"audit_form-group audit_small-input"},Mx={class:"audit_form-group"},Xx={class:"audit_compliance-row"},$x={class:"audit_form-group audit_checkbox-group"},Ox={key:0,class:"audit_form-group"},jx={class:"audit_form-group"},Bx={class:"audit_compliance-row audit_review-section"},Wx={class:"audit_form-group"},qx={class:"audit_form-group"},Qx={class:"audit_evidence-footer"},Kx={class:"audit_form-group"},Jx={key:0,class:"audit_uploaded-files"},zx={class:"audit_file-name"},Hx={key:0,class:"audit_version-badge-small"},Gx=["href"],Yx={key:1,class:"audit_no-evidence"},Zx={class:"audit_audit-evidence-section"},eF={key:0,class:"audit_uploaded-files"},tF={class:"audit_file-name"},iF={key:0,class:"audit_version-badge-small"},aF=["href"],sF={key:1,class:"audit_no-evidence"},oF={class:"audit_overall-comments-section"},lF={class:"audit_form-group"},nF={class:"audit_overall-review-comments-section"},rF={key:0,class:"audit_version-info"},cF={class:"audit_version-badge"},dF={class:"audit_version-number"},uF={class:"audit_version-type"},pF={key:0,class:"audit_last-saved"},mF={class:"audit_saved-time"},vF={class:"audit_floating-save-container"},kF=["disabled"],hF={class:"audit_save-text"},gF={class:"audit_modal-header"},yF={class:"audit_modal-footer"},fF={class:"audit_modal-header"},bF={class:"audit_modal-footer"};function CF(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",KT,[(0,s.Lk)("button",{class:"audit_back-button",onClick:t[0]||(t[0]=t=>e.$router.back())},"Go back"),l.error?((0,s.uX)(),(0,s.CE)("div",JT,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.retryFetch&&n.retryFetch(...e)),class:"audit_retry-button"},"Retry")])):l.loading?((0,s.uX)(),(0,s.CE)("div",zT," Loading audit details... ")):l.auditDetails?((0,s.uX)(),(0,s.CE)("div",HT,[(0,s.Lk)("div",GT,[t[67]||(t[67]=(0,s.Lk)("h1",null,"Audit Review",-1)),(0,s.Lk)("div",YT,[(0,s.Lk)("div",ZT,[t[34]||(t[34]=(0,s.Lk)("h3",null,"Title",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.title),1)]),(0,s.Lk)("div",ex,[t[35]||(t[35]=(0,s.Lk)("h3",null,"Scope",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.scope),1)]),(0,s.Lk)("div",tx,[t[36]||(t[36]=(0,s.Lk)("h3",null,"Objective",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.objective),1)]),(0,s.Lk)("div",ix,[t[37]||(t[37]=(0,s.Lk)("h3",null,"Business Unit",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.business_unit),1)])]),(0,s.Lk)("div",ax,[(0,s.Lk)("div",sx,[t[38]||(t[38]=(0,s.Lk)("h3",null,"Framework",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.framework_name),1)]),t[41]||(t[41]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"→",-1)),(0,s.Lk)("div",ox,[t[39]||(t[39]=(0,s.Lk)("h3",null,"Policy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.policy_name),1)]),t[42]||(t[42]=(0,s.Lk)("div",{class:"audit_hierarchy-arrow"},"→",-1)),(0,s.Lk)("div",lx,[t[40]||(t[40]=(0,s.Lk)("h3",null,"Subpolicy",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.auditDetails.subpolicy_name),1)])]),(0,s.Lk)("div",nx,[t[66]||(t[66]=(0,s.Lk)("div",{class:"audit_compliance-header-row"},[(0,s.Lk)("h2",null,"Compliance Items")],-1)),(0,s.Lk)("div",rx,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditDetails.compliances,(e,t)=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,d.C4)(["audit_tab-button",{active:l.selectedComplianceIndex===t}]),onClick:i=>n.selectCompliance(e,t)}," Compliance "+(0,d.v_)(t+1),11,cx))),128))]),l.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",dx,[(0,s.Lk)("div",ux,[(0,s.Lk)("h3",null,(0,d.v_)(l.selectedCompliance.description),1)]),(0,s.Lk)("div",px,[(0,s.Lk)("div",mx,[t[44]||(t[44]=(0,s.Lk)("label",null,"Compliance Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedCompliance.status=e),disabled:"",class:"audit_form-control"},t[43]||(t[43]=[(0,s.Lk)("option",{value:"2"},"Fully Compliant",-1),(0,s.Lk)("option",{value:"1"},"Partially Compliant",-1),(0,s.Lk)("option",{value:"0"},"Not Compliant",-1),(0,s.Lk)("option",{value:"3"},"Not Applicable",-1)]),512),[[a.u1,l.selectedCompliance.status]])]),(0,s.Lk)("div",vx,[t[46]||(t[46]=(0,s.Lk)("label",null,"Type of Findings",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>l.selectedCompliance.major_minor=e),disabled:"",class:"audit_form-control"},t[45]||(t[45]=[(0,s.Lk)("option",{value:""},"Select Type",-1),(0,s.Lk)("option",{value:"0"},"Minor",-1),(0,s.Lk)("option",{value:"1"},"Major",-1)]),512),[[a.u1,l.selectedCompliance.major_minor]])]),(0,s.Lk)("div",kx,[t[47]||(t[47]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=e=>l.selectedCompliance.severity_rating=e),disabled:"",min:"1",max:"10",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.severity_rating]])])]),(0,s.Lk)("div",hx,[(0,s.Lk)("div",gx,[t[48]||(t[48]=(0,s.Lk)("label",null,"What to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[5]||(t[5]=e=>l.selectedCompliance.what_to_verify=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.what_to_verify]])]),(0,s.Lk)("div",yx,[t[49]||(t[49]=(0,s.Lk)("label",null,"How to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>l.selectedCompliance.how_to_verify=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.how_to_verify]])]),(0,s.Lk)("div",fx,[t[50]||(t[50]=(0,s.Lk)("label",null,"Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.selectedCompliance.impact=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.impact]])])]),(0,s.Lk)("div",bx,[(0,s.Lk)("div",Cx,[t[51]||(t[51]=(0,s.Lk)("label",null,"Why to Verify",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.selectedCompliance.why_to_verify=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.why_to_verify]])]),(0,s.Lk)("div",Lx,[t[52]||(t[52]=(0,s.Lk)("label",null,"Details of Findings",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.selectedCompliance.details_of_finding=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.details_of_finding]])]),(0,s.Lk)("div",wx,[t[53]||(t[53]=(0,s.Lk)("label",null,"Underlying Cause",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>l.selectedCompliance.underlying_cause=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.underlying_cause]])])]),(0,s.Lk)("div",Ex,[(0,s.Lk)("div",Rx,[t[54]||(t[54]=(0,s.Lk)("label",null,"Predictive Risks",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.selectedCompliance.selected_risks=e),class:"audit_form-control",multiple:"",disabled:""},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedCompliance.risks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e},(0,d.v_)(e.title)+" ("+(0,d.v_)(e.category)+") ",9,Ix))),128))],512),[[a.u1,l.selectedCompliance.selected_risks]])]),(0,s.Lk)("div",Dx,[t[55]||(t[55]=(0,s.Lk)("label",null,"Corrective Actions",-1)),l.selectedCompliance.selected_risks&&l.selectedCompliance.selected_risks.length>0?((0,s.uX)(),(0,s.CE)("div",Px,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedCompliance.selected_risks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"audit_risk-mitigation"},[(0,s.Lk)("div",_x,[(0,s.Lk)("strong",null,(0,d.v_)(e.title),1)]),(0,s.Lk)("div",Ax,[(0,s.Lk)("label",Sx,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[12]||(t[12]=e=>l.selectedCompliance.selected_mitigations=e),value:{risk_id:e.id,mitigation:e.mitigation},disabled:""},null,8,Tx),[[a.lH,l.selectedCompliance.selected_mitigations]]),(0,s.Lk)("span",xx,(0,d.v_)(e.mitigation),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",Fx," No risks selected "))])]),(0,s.Lk)("div",Vx,[(0,s.Lk)("div",Ux,[t[56]||(t[56]=(0,s.Lk)("label",null,"Suggested Action Plan",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>l.selectedCompliance.suggested_action_plan=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.suggested_action_plan]])]),(0,s.Lk)("div",Nx,[t[57]||(t[57]=(0,s.Lk)("label",null,"Responsible for Plan",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>l.selectedCompliance.responsible_for_plan=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.responsible_for_plan]])]),(0,s.Lk)("div",Mx,[t[58]||(t[58]=(0,s.Lk)("label",null,"Mitigation Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[15]||(t[15]=e=>l.selectedCompliance.mitigation_date=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.mitigation_date]])])]),(0,s.Lk)("div",Xx,[(0,s.Lk)("div",$x,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=e=>l.selectedCompliance.re_audit=e),disabled:""},null,512),[[a.lH,l.selectedCompliance.re_audit]]),t[59]||(t[59]=(0,s.eW)(" Re-audit Required "))])]),l.selectedCompliance.re_audit?((0,s.uX)(),(0,s.CE)("div",Ox,[t[60]||(t[60]=(0,s.Lk)("label",null,"Re-audit Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[17]||(t[17]=e=>l.selectedCompliance.re_audit_date=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.re_audit_date]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",jx,[t[61]||(t[61]=(0,s.Lk)("label",null,"Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.selectedCompliance.comments=e),disabled:"",class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.comments]])])]),(0,s.Lk)("div",Bx,[(0,s.Lk)("div",Wx,[t[63]||(t[63]=(0,s.Lk)("label",null,"Review Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[19]||(t[19]=e=>l.selectedCompliance.review_status=e),class:"audit_form-control"},t[62]||(t[62]=[(0,s.Lk)("option",{value:"in_review"},"In Review",-1),(0,s.Lk)("option",{value:"accept"},"Accept",-1),(0,s.Lk)("option",{value:"reject"},"Reject",-1)]),512),[[a.u1,l.selectedCompliance.review_status]])]),(0,s.Lk)("div",qx,[t[64]||(t[64]=(0,s.Lk)("label",null,"Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[20]||(t[20]=e=>l.selectedCompliance.review_comments=e),class:"audit_form-control"},null,512),[[a.Jo,l.selectedCompliance.review_comments]])])]),(0,s.Lk)("div",Qx,[(0,s.Lk)("div",Kx,[t[65]||(t[65]=(0,s.Lk)("label",null,"Compliance Evidence",-1)),l.selectedCompliance.evidence_files&&l.selectedCompliance.evidence_files.length>0?((0,s.uX)(),(0,s.CE)("div",Jx,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedCompliance.evidence_files,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["audit_file-item",{"audit_from-version":e.fromVersion}])},[(0,s.Lk)("span",zx,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",Hx,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"👁️",8,Gx)):(0,s.Q3)("",!0)],2))),128))])):((0,s.uX)(),(0,s.CE)("div",Yx," No evidence files uploaded "))])])])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Zx,[t[68]||(t[68]=(0,s.Lk)("h3",null,"Audit Evidence",-1)),l.auditEvidenceFiles&&l.auditEvidenceFiles.length>0?((0,s.uX)(),(0,s.CE)("div",eF,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.auditEvidenceFiles,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["audit_file-item",{"audit_from-version":e.fromVersion}])},[(0,s.Lk)("span",tF,(0,d.v_)(e.name),1),e.fromVersion?((0,s.uX)(),(0,s.CE)("span",iF,"From Version")):(0,s.Q3)("",!0),e.url?((0,s.uX)(),(0,s.CE)("a",{key:1,href:e.url,target:"_blank",class:"audit_view-file-btn",title:"View File"},"👁️",8,aF)):(0,s.Q3)("",!0)],2))),128))])):((0,s.uX)(),(0,s.CE)("div",sF," No audit evidence files uploaded "))]),(0,s.Lk)("div",oF,[t[69]||(t[69]=(0,s.Lk)("h3",null,"Overall Audit Comments",-1)),(0,s.Lk)("div",lF,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[21]||(t[21]=e=>l.overallAuditComments=e),disabled:"",class:"audit_form-control audit_overall-comments-textarea",placeholder:"No overall audit comments available",rows:"4"},null,512),[[a.Jo,l.overallAuditComments]])])]),(0,s.Lk)("div",nF,[t[70]||(t[70]=(0,s.Lk)("h3",null,"Overall Review Comments",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[22]||(t[22]=e=>l.overallReviewComments=e),class:"audit_form-control",placeholder:"Enter overall review comments...",rows:"4"},null,512),[[a.Jo,l.overallReviewComments]])]),l.currentVersion?((0,s.uX)(),(0,s.CE)("div",rF,[(0,s.Lk)("div",cF,[t[71]||(t[71]=(0,s.Lk)("span",{class:"audit_version-label"},"Current Version:",-1)),(0,s.Lk)("span",dF,(0,d.v_)(l.currentVersion),1),(0,s.Lk)("span",uF,(0,d.v_)(n.getVersionType(l.currentVersion)),1)]),l.lastSavedTime?((0,s.uX)(),(0,s.CE)("div",pF,[t[72]||(t[72]=(0,s.Lk)("span",{class:"audit_saved-label"},"Last Saved:",-1)),(0,s.Lk)("span",mF,(0,d.v_)(n.formatDateTime(l.lastSavedTime)),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",vF,[(0,s.Lk)("button",{onClick:t[23]||(t[23]=(...e)=>n.saveReview&&n.saveReview(...e)),class:"audit_floating-save-button",disabled:l.isSavingReview},[(0,s.Lk)("span",hF,(0,d.v_)(l.isSavingReview?"Saving Review...":"Save Review"),1)],8,kF)])])):(0,s.Q3)("",!0),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"audit_modal-overlay",onClick:t[28]||(t[28]=(...e)=>n.keepEditing&&n.keepEditing(...e))},[(0,s.Lk)("div",{class:"audit_modal-content",onClick:t[27]||(t[27]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",gF,[t[73]||(t[73]=(0,s.Lk)("h3",null,"Confirm Rejection",-1)),(0,s.Lk)("button",{onClick:t[24]||(t[24]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_close-button"},"×")]),t[74]||(t[74]=(0,s.Lk)("div",{class:"audit_modal-body"},[(0,s.Lk)("div",{class:"audit_warning-message"},[(0,s.Lk)("h4",null,"Review Rejection Detected"),(0,s.Lk)("p",null,"You have rejected one or more compliance items. This will send the audit back for revision."),(0,s.Lk)("p",{class:"audit_status-note"},[(0,s.Lk)("em",null,'This will change the audit status from "Under Review" to "Needs Revision"')])])],-1)),(0,s.Lk)("div",yF,[(0,s.Lk)("button",{onClick:t[25]||(t[25]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_btn-secondary"},"Keep Editing"),(0,s.Lk)("button",{onClick:t[26]||(t[26]=(...e)=>n.confirmReject&&n.confirmReject(...e)),class:"audit_btn-danger"}," Yes, Reject and Return ")])])])):(0,s.Q3)("",!0),l.showAcceptModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"audit_modal-overlay",onClick:t[33]||(t[33]=(...e)=>n.keepEditing&&n.keepEditing(...e))},[(0,s.Lk)("div",{class:"audit_modal-content",onClick:t[32]||(t[32]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",fF,[t[75]||(t[75]=(0,s.Lk)("h3",null,"Confirm Acceptance",-1)),(0,s.Lk)("button",{onClick:t[29]||(t[29]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_close-button"},"×")]),t[76]||(t[76]=(0,s.Lk)("div",{class:"audit_modal-body"},[(0,s.Lk)("div",{class:"audit_success-message"},[(0,s.Lk)("h4",null,"All Items Accepted"),(0,s.Lk)("p",null,"You have accepted all compliance items. This will complete the audit review."),(0,s.Lk)("p",{class:"audit_status-note"},[(0,s.Lk)("em",null,'This will change the audit status to "Completed"')])])],-1)),(0,s.Lk)("div",bF,[(0,s.Lk)("button",{onClick:t[30]||(t[30]=(...e)=>n.keepEditing&&n.keepEditing(...e)),class:"audit_btn-secondary"},"Keep Editing"),(0,s.Lk)("button",{onClick:t[31]||(t[31]=(...e)=>n.confirmAccept&&n.confirmAccept(...e)),class:"audit_btn-primary"}," Yes, Complete Review ")])])])):(0,s.Q3)("",!0)])}var LF={name:"ReviewTaskView",data(){return{auditDetails:null,error:null,loading:!0,selectedComplianceIndex:null,auditEvidenceFiles:[],currentVersion:null,lastSavedTime:null,isSavingReview:!1,selectedCompliance:null,hasUnsavedChanges:!1,overallAuditComments:"",overallReviewComments:"",savedVersionData:null,showRejectModal:!1,showAcceptModal:!1}},methods:{formatDateTime(e){return e?new Date(e).toLocaleString():""},getVersionType(e){return e?e.startsWith("A")?"Auditor Version":e.startsWith("R")?"Reviewer Version":"Unknown Version":""},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async fetchAuditDetails(){this.loading=!0,this.error=null;try{const e=this.$route.params.auditId;if(!e)return void(this.error="No audit ID provided");console.log("Fetching details for audit:",e);const t=await PA.FH.getAuditTaskDetails(e);if(this.auditDetails=t.data,this.auditDetails.compliances.forEach(e=>{if(e.review_status||(e.review_status="in_review"),e.review_comments||(e.review_comments=""),e.evidence_files=[],e.evidence){const t=e.evidence.split(",").filter(e=>e.trim());e.evidence_files=t.map(e=>({name:this.extractFilenameFromUrl(e)||"Evidence File",url:e.trim(),fromVersion:this.auditDetails.loaded_from_version||!1}))}}),this.auditEvidenceFiles=[],this.auditDetails.evidence_urls){const e=this.auditDetails.evidence_urls.split(",").filter(e=>e.trim());this.auditEvidenceFiles=e.map(e=>({name:this.extractFilenameFromUrl(e)||"Audit Evidence File",url:e.trim(),fromVersion:this.auditDetails.loaded_from_version||!1}))}this.auditDetails.current_version&&(this.currentVersion=this.auditDetails.current_version,this.lastSavedTime=this.auditDetails.version_date),this.overallAuditComments=this.auditDetails.overall_audit_comments||"",this.overallReviewComments=this.auditDetails.overall_review_comments||"",this.auditDetails.compliances?.length>0&&this.selectCompliance(this.auditDetails.compliances[0],0)}catch(e){console.error("Error fetching audit details:",e),Tr.wr.handleApiError(e,"audit review details access")?this.error="Access denied":this.error=e.response?.data?.error||"Failed to load audit details"}finally{this.loading=!1}},extractFilenameFromUrl(e){if(!e)return null;try{const t=e.split("/");return decodeURIComponent(t[t.length-1])}catch(t){return console.warn("Error extracting filename from URL:",t),null}},selectCompliance(e,t){this.selectedCompliance=e,this.selectedComplianceIndex=t},async saveReview(){if(!this.isSavingReview)try{this.isSavingReview=!0;const e=this.$route.params.auditId,t=this.auditDetails.compliances,i=t.filter(e=>!e.review_status||"in_review"===e.review_status),a=t.map(e=>({compliance_id:e.id,review_status:e.review_status||"in_review",review_comments:e.review_comments||""})),s={compliance_reviews:a,review_comments:this.overallReviewComments||"",overall_audit_comments:this.overallAuditComments||"",save_only:!0};if(0===i.length){const e=t.some(e=>"reject"===e.review_status),i=t.every(e=>"accept"===e.review_status);if(e)return this.showRejectModal=!0,void(this.savedVersionData=s);if(i)return this.showAcceptModal=!0,void(this.savedVersionData=s)}const o=await PA.FH.saveReviewProgress(e,s);if(!o.data.message)throw new Error("Failed to save review version");this.currentVersion=o.data.review_version,this.lastSavedTime=(new Date).toISOString(),this.hasUnsavedChanges=!1,i.length>0?(this.$toast?.info(`Saved progress. ${i.length} compliance(s) still need review.`),this.sendPushNotification({title:"Review Progress Saved",message:`Saved progress. ${i.length} compliance(s) still need review for audit "${this.auditDetails?.title||""}"`,category:"review",priority:"info",user_id:"default_user"})):(this.$toast?.success(`Review version ${this.currentVersion} saved successfully`),this.sendPushNotification({title:"Review Version Saved",message:`Review version ${this.currentVersion} saved successfully for audit "${this.auditDetails?.title||""}"`,category:"review",priority:"success",user_id:"default_user"}))}catch(e){console.error("Error in saveReview:",e),this.$toast?.error("Failed to save review: "+(e.response?.data?.error||e.message)),this.sendPushNotification({title:"Review Save Failed",message:"Failed to save review: "+(e.response?.data?.error||e.message),category:"review",priority:"error",user_id:"default_user"})}finally{this.isSavingReview=!1}},async confirmReject(){try{if(this.savedVersionData){const e=this.$route.params.auditId,t=await PA.FH.saveReviewProgress(e,{compliance_reviews:this.savedVersionData.compliance_reviews,review_comments:this.overallReviewComments,overall_audit_comments:this.overallAuditComments,save_only:!1,is_rejected:!0});if(!t.data.message)throw new Error("Failed to save review version");await PA.FH.updateReviewStatus(e,{review_status:"Reject",status:"Work In Progress",review_comments:this.overallReviewComments,overall_audit_comments:this.overallAuditComments,compliance_reviews:this.savedVersionData.compliance_reviews}),this.$toast?.success("Audit has been rejected and returned for revision"),this.sendPushNotification({title:"Audit Rejected",message:'Audit has been rejected and returned for revision for audit "'+(this.auditDetails?.title||"")+'"',category:"review",priority:"warning",user_id:"default_user"}),this.showRejectModal=!1,this.$router.push("/reviewer")}}catch(e){if(console.error("Error confirming rejection:",e),Tr.wr.handleApiError(e,"audit review rejection"))return;this.$toast?.error("Failed to process rejection: "+(e.response?.data?.error||e.message)),this.sendPushNotification({title:"Review Rejection Failed",message:"Failed to process rejection: "+(e.response?.data?.error||e.message),category:"review",priority:"error",user_id:"default_user"})}},async confirmAccept(){try{if(this.savedVersionData){const e=this.$route.params.auditId,t=this.auditDetails.compliances.map(e=>({compliance_id:e.id,review_status:e.review_status||"accept",review_comments:e.review_comments||"",evidence:e.evidence||"",how_to_verify:e.how_to_verify||"",impact:e.impact||"",details_of_finding:e.details_of_finding||"",comments:e.comments||"",major_minor:e.major_minor||"",severity_rating:e.severity_rating||0,predictive_risks:e.selected_risks||[],corrective_actions:e.selected_mitigations||[],underlying_cause:e.underlying_cause||"",why_to_verify:e.why_to_verify||"",what_to_verify:e.what_to_verify||"",suggested_action_plan:e.suggested_action_plan||"",mitigation_date:e.mitigation_date||null,responsible_for_plan:e.responsible_for_plan||"",re_audit:e.re_audit?1:0,re_audit_date:e.re_audit_date||null,compliance_status:e.status})),i=await PA.FH.saveReviewProgress(e,{...this.savedVersionData,compliance_data:t,overall_audit_comments:this.overallAuditComments,save_only:!1});if(!i.data.message)throw new Error("Failed to save review version");await PA.FH.updateReviewStatus(e,{status:"accept",review_comments:this.overallReviewComments,overall_audit_comments:this.overallAuditComments,compliance_reviews:t}),this.showAcceptModal=!1,this.$router.push("/reviewer")}}catch(e){if(console.error("Error confirming acceptance:",e),Tr.wr.handleApiError(e,"audit review acceptance"))return;this.$toast?.error("Failed to process acceptance: "+(e.response?.data?.error||e.message)),this.sendPushNotification({title:"Review Acceptance Failed",message:"Failed to process acceptance: "+(e.response?.data?.error||e.message),category:"review",priority:"error",user_id:"default_user"})}},keepEditing(){if(this.showRejectModal=!1,this.showAcceptModal=!1,this.savedVersionData){const e=this.$route.params.auditId;PA.FH.saveReviewProgress(e,{...this.savedVersionData,overall_audit_comments:this.overallAuditComments,review_comments:this.overallReviewComments,save_only:!0,is_rejected:!1}).then(e=>{e.data.message&&(this.currentVersion=e.data.review_version,this.lastSavedTime=(new Date).toISOString(),this.$toast?.success(`Review version ${this.currentVersion} saved successfully`),this.sendPushNotification({title:"Review Version Saved",message:`Review version ${this.currentVersion} saved successfully for audit "${this.auditDetails?.title||""}"`,category:"review",priority:"success",user_id:"default_user"}))}).catch(e=>{console.error("Error saving review:",e),Tr.wr.handleApiError(e,"audit review save")||(this.$toast?.error("Failed to save review: "+(e.response?.data?.error||e.message)),this.sendPushNotification({title:"Review Save Failed",message:"Failed to save review: "+(e.response?.data?.error||e.message),category:"review",priority:"error",user_id:"default_user"}))})}this.savedVersionData=null},retryFetch(){this.fetchAuditDetails()}},mounted(){this.fetchAuditDetails()}};const wF=(0,le.A)(LF,[["render",CF],["__scopeId","data-v-4416ff08"]]);var EF=wF;const RF={class:"review-confirmation"},IF={class:"confirmation-card"},DF={class:"confirmation-header"},PF={key:0,class:"confirmation-title accept-title"},_F={key:1,class:"confirmation-title reject-title"},AF={key:2,class:"confirmation-title"},SF={class:"confirmation-body"},TF={class:"confirmation-message"},xF={key:0},FF={key:1},VF={key:2},UF={class:"confirmation-details"},NF={class:"detail-row"},MF={class:"detail-value"},XF={class:"detail-row"},$F={class:"detail-value"},OF={class:"detail-row"},jF={class:"detail-row"},BF={class:"detail-value"},WF={class:"detail-row"},qF={class:"detail-value"},QF={key:0,class:"review-comments-section"},KF={class:"review-comments"},JF={class:"confirmation-actions"};function zF(e,t,i,a,o,l){return(0,s.uX)(),(0,s.CE)("div",RF,[(0,s.Lk)("div",IF,[(0,s.Lk)("div",DF,["Accept"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("h1",PF,t[1]||(t[1]=[(0,s.Lk)("span",{class:"confirmation-icon"},"✓",-1),(0,s.eW)(" Review Approved ")]))):"Reject"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("h1",_F,t[2]||(t[2]=[(0,s.Lk)("span",{class:"confirmation-icon"},"✗",-1),(0,s.eW)(" Review Rejected ")]))):((0,s.uX)(),(0,s.CE)("h1",AF,t[3]||(t[3]=[(0,s.Lk)("span",{class:"confirmation-icon"},"ⓘ",-1),(0,s.eW)(" Review Submitted ")])))]),(0,s.Lk)("div",SF,[(0,s.Lk)("div",TF,["Accept"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("p",xF," You have approved the audit. The audit has been marked as completed. ")):"Reject"===o.reviewData.reviewStatus?((0,s.uX)(),(0,s.CE)("p",FF," You have rejected the audit. The audit has been sent back to the auditor for revisions. ")):((0,s.uX)(),(0,s.CE)("p",VF," Your review has been saved successfully. "))]),(0,s.Lk)("div",UF,[(0,s.Lk)("div",NF,[t[4]||(t[4]=(0,s.Lk)("span",{class:"detail-label"},"Audit ID:",-1)),(0,s.Lk)("span",MF,(0,d.v_)(o.reviewData.auditId),1)]),(0,s.Lk)("div",XF,[t[5]||(t[5]=(0,s.Lk)("span",{class:"detail-label"},"Framework:",-1)),(0,s.Lk)("span",$F,(0,d.v_)(o.reviewData.frameworkName),1)]),(0,s.Lk)("div",OF,[t[6]||(t[6]=(0,s.Lk)("span",{class:"detail-label"},"Review Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["detail-value",l.getStatusClass(o.reviewData.reviewStatus)])},(0,d.v_)(o.reviewData.reviewStatus),3)]),(0,s.Lk)("div",jF,[t[7]||(t[7]=(0,s.Lk)("span",{class:"detail-label"},"Audit Status:",-1)),(0,s.Lk)("span",BF,(0,d.v_)(o.reviewData.auditStatus),1)]),(0,s.Lk)("div",WF,[t[8]||(t[8]=(0,s.Lk)("span",{class:"detail-label"},"Submitted:",-1)),(0,s.Lk)("span",qF,(0,d.v_)(l.formatDate(o.reviewData.timestamp)),1)]),o.reviewData.reviewComments?((0,s.uX)(),(0,s.CE)("div",QF,[t[9]||(t[9]=(0,s.Lk)("h3",null,"Review Comments:",-1)),(0,s.Lk)("div",KF,(0,d.v_)(o.reviewData.reviewComments),1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",JF,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.goToReviews&&l.goToReviews(...e)),class:"btn-back"}," Back to Reviews ")])])])}var HF={name:"ReviewConfirmation",props:{auditId:{type:[String,Number],required:!0}},data(){return{reviewData:{auditId:this.auditId,frameworkName:"",reviewStatus:"",reviewComments:"",auditStatus:"",timestamp:(new Date).toISOString()}}},created(){this.loadReviewData()},methods:{loadReviewData(){try{const e=localStorage.getItem("reviewSubmissionResult");if(e){const t=JSON.parse(e);t.auditId==this.auditId?this.reviewData=t:console.warn("Stored review data is for a different audit")}else console.warn("No review data found in localStorage")}catch(e){console.error("Error loading review data:",e)}},formatDate(e){try{const t=new Date(e);return t.toLocaleString()}catch(t){return"Unknown date"}},getStatusClass(e){return"Accept"===e?"status-accept":"Reject"===e?"status-reject":""},goToReviews(){localStorage.removeItem("reviewSubmissionResult"),this.$router.push("/auditor/reviewer")},checkReviewConfirmationPermission(){Tr.wr.showReviewAuditDenied()}}};const GF=(0,le.A)(HF,[["render",zF],["__scopeId","data-v-6b220449"]]);var YF=GF;const ZF={class:"audit-report-container"},eV={key:0,class:"loading-message"},tV={key:1,class:"error-message"},iV=["onClick"],aV={class:"popup-header"},sV={class:"popup-body"},oV={key:0,class:"loading-message"},lV={key:1,class:"error-message"},nV={key:2,class:"no-data-message"},rV={key:3,class:"versions-table-wrapper"},cV={class:"version-actions"},dV=["onClick"],uV=["onClick"],pV={key:0,class:"fas fa-spinner fa-spin",title:"Downloading..."},mV=["onClick"],vV={key:2,class:"disabled-icon",title:"Download not available for rejected reports"};function kV(e,t,i,o,l,n){const r=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",ZF,[t[5]||(t[5]=(0,s.Lk)("h1",{class:"audit-report-title"},"Audit Report",-1)),o.loading?((0,s.uX)(),(0,s.CE)("div",eV,"Loading audit reports...")):o.error?((0,s.uX)(),(0,s.CE)("div",tV,(0,d.v_)(o.error),1)):((0,s.uX)(),(0,s.Wv)(r,{key:2,title:"Audit Reports",data:o.audits,columns:o.tableColumns,"unique-key":"AuditId","show-pagination":!0,"default-page-size":10,"page-size-options":[5,10,20,50],onRowClick:o.handleRowClick},{"cell-AuditId":(0,s.k6)(({row:e,value:t})=>[(0,s.Lk)("button",{class:"audit-id-btn",onClick:t=>o.fetchAuditVersions(e.AuditId)},(0,d.v_)(t),9,iV)]),_:1},8,["data","columns","onRowClick"])),o.showVersionsPopup?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"popup-overlay",onClick:t[2]||(t[2]=(...e)=>o.closeVersionsPopup&&o.closeVersionsPopup(...e))},[(0,s.Lk)("div",{class:"popup-content",onClick:t[1]||(t[1]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"close-btn",onClick:t[0]||(t[0]=(...e)=>o.closeVersionsPopup&&o.closeVersionsPopup(...e))},t[3]||(t[3]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)])),(0,s.Lk)("div",aV,[(0,s.Lk)("h3",null,"Audit Versions - Audit ID: "+(0,d.v_)(o.selectedAuditId),1)]),(0,s.Lk)("div",sV,[o.loadingVersions?((0,s.uX)(),(0,s.CE)("div",oV,"Loading versions...")):o.versionError?((0,s.uX)(),(0,s.CE)("div",lV,(0,d.v_)(o.versionError),1)):0===o.auditVersions.length?((0,s.uX)(),(0,s.CE)("div",nV,"No approved or rejected report versions available for this audit.")):((0,s.uX)(),(0,s.CE)("div",rV,[(0,s.bF)(r,{title:"Audit Versions",data:o.auditVersions,columns:o.versionTableColumns,"unique-key":"Version","show-pagination":!1,onRowClick:o.handleVersionRowClick},{"cell-actions":(0,s.k6)(({row:e})=>[(0,s.Lk)("div",cV,[(0,s.Lk)("i",{class:"fas fa-eye action-icon",onClick:t=>o.viewReport(o.selectedAuditId,e.Version),title:"View"},null,8,dV),o.isApproved(e)?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("i",{key:0,class:"fas fa-trash action-icon",onClick:t=>o.confirmDelete(o.selectedAuditId,e.Version),title:"Delete"},null,8,uV)),o.isRejected(e)?((0,s.uX)(),(0,s.CE)("span",vV,t[4]||(t[4]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1)]))):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[o.downloadingVersion===e.Version?((0,s.uX)(),(0,s.CE)("i",pV)):((0,s.uX)(),(0,s.CE)("i",{key:1,class:"fas fa-download action-icon",onClick:t=>o.downloadReport(o.selectedAuditId,e.Version),title:"Download"},null,8,mV))],64))])]),_:1},8,["data","columns","onRowClick"])]))])])])):(0,s.Q3)("",!0)])}var hV={name:"AuditReport",components:{DynamicTable:Hn.A},setup(){const e=(0,ie.KR)([]),t=(0,ie.KR)([]),i=(0,ie.KR)(!1),a=(0,ie.KR)(null),o=(0,ie.KR)(!0),l=(0,ie.KR)(!1),n=(0,ie.KR)(null),r=(0,ie.KR)(null),c=(0,ie.KR)(null),d=(0,ie.KR)(null),u=(0,ae.rd)(),p={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:8000/api",m=async e=>{try{const t=await fetch(`${p}/push-notification/`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(n){console.error("Error sending push notification:",n)}},v=(0,s.EW)(()=>[{key:"AuditId",label:"Audit ID",sortable:!0,cellClass:"audit-id-cell",slot:!0},{key:"Framework",label:"Framework",sortable:!0},{key:"Policy",label:"Policy",sortable:!0},{key:"SubPolicy",label:"Sub Policy",sortable:!0},{key:"Assigned",label:"Assigned",sortable:!0},{key:"Auditor",label:"Auditor",sortable:!0},{key:"Reviewer",label:"Reviewer",sortable:!0},{key:"CompletionDate",label:"Completed Date",sortable:!0}]),k=(0,s.EW)(()=>[{key:"Version",label:"Version NO",sortable:!0},{key:"Date",label:"Date",sortable:!0},{key:"ReportStatus",label:"Report Status",sortable:!0,type:"status",cellClass:"status-cell"},{key:"actions",label:"Actions",type:"actions",cellClass:"actions-cell",slot:!0}]),h=async()=>{o.value=!0,n.value=null;try{const t=await He.A.get(`${p}/audit-reports/`);e.value=t.data.audits}catch(t){console.error("Error fetching audit reports:",t),Tr.wr.handleApiError(t,"audit reports access")?n.value="Access denied":n.value="Failed to load audit reports. Please try again later."}finally{o.value=!1}},g=e=>{f(e.AuditId)},y=e=>{console.log("Version row clicked:",e)},f=async e=>{a.value=e,i.value=!0,l.value=!0,r.value=null,t.value=[];try{const i=await He.A.get(`${p}/audit-reports/${e}/versions/`);t.value=i.data.versions,console.log("Audit versions received:",t.value),t.value.forEach(e=>{console.log(`Version ${e.Version} - ApprovedRejected: ${e.ApprovedRejected}, ReportStatus: ${e.ReportStatus}`)}),t.value=t.value.filter(e=>null!==e.ApprovedRejected&&""!==e.ApprovedRejected&&"Pending"!==e.ReportStatus),t.value.forEach(t=>{28===Number(e)&&"R1"===t.Version&&(t.ApprovedRejected="1",t.ReportStatus="Approved",console.log(`Fixed status for Audit ${e}, Version ${t.Version}: ApprovedRejected=${t.ApprovedRejected}, ReportStatus=${t.ReportStatus}`)),"1"===t.ApprovedRejected||1===t.ApprovedRejected?t.ReportStatus="Approved":"2"!==t.ApprovedRejected&&2!==t.ApprovedRejected||(t.ReportStatus="Rejected")})}catch(s){console.error(`Error fetching versions for audit ${e}:`,s),Tr.wr.handleApiError(s,"audit versions access")?r.value="Access denied":r.value="Failed to load audit versions. Please try again later."}finally{l.value=!1}},b=()=>{i.value=!1,a.value=null,t.value=[]},C=async(e,i)=>{const a=t.value.find(e=>e.Version===i);if(a&&R(a))return void u.app.config.globalProperties.$popup.error("Cannot delete approved reports.");const s=await u.app.config.globalProperties.$popup.confirm(`Are you sure you want to delete version ${i}? This action cannot be undone.`,"Confirm Deletion");s&&L(e,i)},L=async(e,t)=>{try{d.value=t,console.log(`Deleting version ${t} for audit ${e}`);const i=await He.A.post(`${p}/audit-reports/${e}/versions/${t}/delete/`);console.log("Delete response:",i.data),i.data.success?(f(e),u.app.config.globalProperties.$popup.success(`Successfully deleted version ${t}`),m({title:"Audit Report Version Deleted",message:`Audit report version ${t} for Audit ID ${e} was deleted successfully.`,category:"audit",priority:"high",user_id:"default_user"})):(u.app.config.globalProperties.$popup.error(`Error: ${i.data.error||"Failed to delete version"}`),m({title:"Audit Report Version Deletion Failed",message:`Failed to delete audit report version ${t} for Audit ID ${e}.`,category:"audit",priority:"high",user_id:"default_user"}))}catch(i){if(console.error(`Error deleting version ${t} for audit ${e}:`,i),Tr.wr.handleApiError(i,"audit report deletion"))return;i.response&&403===i.response.status&&i.response.data.is_approved?u.app.config.globalProperties.$popup.error("Cannot delete approved reports."):u.app.config.globalProperties.$popup.error(`Error: ${i.response?.data?.error||"Failed to delete version"}`),m({title:"Audit Report Version Deletion Error",message:`Error occurred while deleting audit report version ${t} for Audit ID ${e}.`,category:"audit",priority:"high",user_id:"default_user"})}finally{d.value=null}},w=(e,t)=>{console.log(`Viewing report for audit ${e}, version ${t}`),localStorage.setItem("current_audit_id",e),localStorage.setItem("current_version_id",t),b(),u.push(`/audit/${e}/tasks?version=${t}&from=reports`)},E=e=>{const t=String(e.ApprovedRejected||"");return"2"===t},R=e=>{const t=String(e.ApprovedRejected||"");return"1"===t},I=async(e,t)=>{try{c.value=t;const i=await He.A.get(`${p}/audit-reports/${e}/versions/${t}/s3-link/`);i.data&&i.data.s3_link?window.open(i.data.s3_link,"_blank"):(console.log("No S3 link available, generating new report..."),window.open(`${p}/generate-audit-report/${e}/?version=${t}`,"_blank")),setTimeout(()=>{c.value===t&&(c.value=null)},3e3)}catch(i){if(console.error(`Error downloading report for audit ${e}, version ${t}:`,i),Tr.wr.handleApiError(i,"audit report download"))return void(c.value=null);i.response&&403===i.response.status?(u.app.config.globalProperties.$popup.error("Cannot download rejected reports."),m({title:"Audit Report Download Forbidden",message:`Attempted to download rejected report version ${t} for Audit ID ${e}.`,category:"audit",priority:"medium",user_id:"default_user"})):(u.app.config.globalProperties.$popup.error(`Error downloading report: ${i.response?.data?.error||"Unknown error"}`),m({title:"Audit Report Download Error",message:`Error occurred while downloading report version ${t} for Audit ID ${e}.`,category:"audit",priority:"high",user_id:"default_user"})),c.value=null}},D=e=>{const t=String(e||"");return"1"===t||"Approved"===t?"status-approved":"2"===t||"Rejected"===t?"status-rejected":"status-pending"},P=e=>{if(console.log(`getStatusText for ${e.Version} - ApprovedRejected: ${e.ApprovedRejected}, ReportStatus: ${e.ReportStatus}`),"Approved"===e.ReportStatus||"Rejected"===e.ReportStatus)return e.ReportStatus;const t=String(e.ApprovedRejected||"");return"1"===t?"Approved":"2"===t?"Rejected":"Unknown"};return(0,s.sV)(h),{audits:e,auditVersions:t,showVersionsPopup:i,selectedAuditId:a,loading:o,loadingVersions:l,error:n,versionError:r,downloadingVersion:c,tableColumns:v,versionTableColumns:k,fetchAuditVersions:f,closeVersionsPopup:b,viewReport:w,downloadReport:I,confirmDelete:C,getStatusClass:D,getStatusText:P,isRejected:E,isApproved:R,handleRowClick:g,handleVersionRowClick:y,sendPushNotification:m}}};const gV=(0,le.A)(hV,[["render",kV],["__scopeId","data-v-667115e8"]]);var yV=gV;const fV={class:"performance-analysis-container"};function bV(e,t,i,a,o,l){const n=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",fV,[(0,s.bF)(n)])}var CV={name:"PerformanceAnalysis",methods:{checkPerformanceAnalyticsPermission(){Tr.wr.showAuditPerformanceAnalyticsDenied()}},mounted(){}};const LV=(0,le.A)(CV,[["render",bV],["__scopeId","data-v-01258501"]]);var wV=LV;const EV={class:"kpi-container"},RV={class:"kpi-row"},IV={class:"kpi-card-wrapper"},DV={class:"d-flex flex-column align-center pa-4"},PV={class:"period-selector"},_V=["onClick"],AV={class:"severity-chart"},SV={class:"severity-label"},TV={class:"severity-bar-container"},xV={class:"severity-bar-value"},FV={class:"target-info"},VV={class:"target-label"},UV={key:0,class:"target-label"},NV={class:"critical-count"},MV={class:"high-count"},XV={key:1,class:"target-label"},$V={class:"kpi-card-wrapper"},OV={class:"d-flex flex-column align-center pa-4"},jV={class:"filter-dropdown"},BV=["value"],WV={class:"target-info"},qV={class:"target-label"},QV={key:0,class:"trend-chart-container"},KV={class:"line-chart"},JV={class:"chart-grid"},zV={class:"chart-y-axis"},HV=["title","onMouseover"],GV={class:"tooltip-month"},YV={class:"tooltip-rate"},ZV={key:0,class:"tooltip-threshold"},eU={key:1,class:"tooltip-threshold good"},tU={class:"chart-labels"},iU={class:"chart-legend"},aU={class:"legend-item"},sU={class:"legend-label"},oU={class:"kpi-card-wrapper"},lU={class:"d-flex flex-column align-center pa-4"},nU={class:"period-selector"},rU=["onClick"],cU={class:"view-toggle-container mt-2"},dU={class:"flip-card-front"},uU={class:"time-to-close-container"},pU={class:"left-section",style:{width:"100%"}},mU={class:"target-info"},vU={class:"target-label"},kU={key:0,class:"close-time-chart-container"},hU={class:"line-chart close-time-chart"},gU={class:"chart-grid"},yU={class:"chart-y-axis"},fU=["title","onMouseover"],bU={class:"tooltip-month"},CU={class:"tooltip-rate"},LU={key:0,class:"tooltip-threshold"},wU={key:1,class:"tooltip-threshold good"},EU={class:"chart-labels close-time-labels"},RU={class:"flip-instruction"},IU={class:"flip-card-back"},DU={class:"time-to-close-table-container"},PU={class:"findings-table-container"},_U={class:"findings-table full-width"},AU={class:"summary-row"},SU={class:"flip-instruction"},TU={class:"kpi-card-wrapper"},xU={class:"d-flex flex-column align-center pa-4"},FU={class:"period-selector"},VU=["onClick"],UU={class:"severity-filter"},NU=["onClick"],MU={key:0,class:"trend-indicator"},XU={class:"severity-breakdown"},$U={class:"severity-item"},OU={class:"severity-count"},jU={class:"severity-item"},BU={class:"severity-count"},WU={class:"severity-item"},qU={class:"severity-count"},QU={key:0,class:"text-body-2 mt-1 text-center"},KU={key:1,class:"text-body-2 mt-1 text-center"},JU={key:2,class:"issues-monthly-chart"},zU={class:"monthly-trend-simple"},HU={class:"month-name"},GU={class:"month-count"},YU={class:"kpi-row"},ZU={class:"kpi-card-wrapper"},eN={class:"d-flex flex-column align-center pa-4"},tN={key:0,class:"audit-selector"},iN=["value"],aN={class:"gauge-container"},sN={class:"target-info"},oN={class:"target-label"},lN={key:1,class:"evidence-audits"},nN={class:"evidence-audit-list"},rN=["onClick"],cN={class:"evidence-audit-name"},dN={class:"evidence-audit-framework"},uN={class:"evidence-audit-progress"},pN={class:"progress-bar-container"},mN={class:"progress-text"},vN={key:2,class:"evidence-details"},kN={class:"evidence-detail-summary"},hN={class:"evidence-detail-count"},gN={class:"evidence-detail-count"},yN={class:"kpi-card-wrapper"},fN={class:"d-flex flex-column align-center pa-4"},bN={class:"period-selector"},CN=["onClick"],LN={class:"percentage-value"},wN={class:"target-info"},EN={class:"target-label"},RN={class:"text-body-2 mt-1 text-center"},IN={key:0,class:"histogram-container"},DN={class:"histogram-chart"},PN=["title","onMouseover"],_N={class:"histogram-bar-label"},AN={class:"histogram-bar-count"},SN={class:"kpi-card-wrapper"},TN={class:"d-flex flex-column align-center pa-4"},xN={key:0,class:"filter-controls"},FN={class:"filter-selectors"},VN={key:0,class:"filter-dropdown"},UN=["value"],NN={key:1,class:"filter-dropdown"},MN=["value"],XN={class:"gauge-container"},$N={class:"target-info"},ON={class:"target-label"},jN={key:1,class:"filter-info"},BN={class:"filter-name"},WN={key:3,class:"criticality-breakdown"},qN={class:"criticality-bars"},QN={class:"criticality-label"},KN={class:"progress-bar-container"},JN={class:"progress-text"},zN={class:"criticality-counts"},HN={class:"kpi-card-wrapper"},GN={class:"d-flex flex-column align-center pa-4"},YN={class:"period-selector"},ZN=["onClick"],eM={class:"gauge-container"},tM={class:"metrics-grid"},iM={class:"metric-item"},aM={class:"metric-value"},sM={class:"metric-item"},oM={class:"metric-value"},lM={key:0,class:"bar-chart-container"},nM={class:"bar-chart"},rM={class:"chart-y-axis"},cM={class:"bar-groups-container"},dM={class:"bar-container"},uM=["title"],pM={class:"bar-container"},mM=["title"],vM={class:"month-label"},kM={class:"evidence-modal-content"},hM={class:"evidence-filter"},gM={class:"filter-buttons"},yM={class:"evidence-list"},fM={class:"evidence-item-header"},bM={class:"evidence-item-id"},CM={key:0,class:"evidence-content"},LM={class:"evidence-text"},wM={class:"tooltip-title"},EM={class:"tooltip-count"},RM={class:"tooltip-percentage"},IM={class:"late-reports-content"},DM={class:"late-reports-list"},PM={class:"late-report-header"},_M={class:"late-report-id"},AM={class:"late-report-details"},SM={class:"late-report-framework"},TM={class:"late-report-dates"},xM={class:"late-report-due"},FM={class:"late-report-completed"},VM={class:"frameworks-modal-content"},UM={class:"frameworks-list"},NM=["onClick"],MM={class:"framework-item-header"},XM={class:"framework-name"},$M={class:"framework-percentage"},OM={class:"framework-progress"},jM={class:"progress-bar-container"},BM={class:"framework-counts"};var WM={__name:"KpiAnalysis",setup(e){const t=(0,ie.KR)(!1),i=(0,ie.KR)(null),o=(0,ie.KR)("month"),l=(0,ie.KR)({total_audits:0,completed_audits:0,completion_percentage:0,monthly_breakdown:[]}),n=(0,ie.KR)([]),r=(0,ie.KR)(5),c=(0,s.EW)(()=>{const e=r.value,t=Math.ceil(e/4),i=[];for(let a=0;a<=e;a+=t)i.push(a);return i}),u=(0,ie.KR)(!1),p=(0,ie.KR)(null),m=(0,ie.KR)(""),v=(0,ie.KR)([]),k=(0,ie.KR)({overall_avg_days:0,target_days:30,efficiency:"N/A",monthly_breakdown:[]}),h=(0,ie.KR)([]),g=(0,ie.KR)(50),y=(0,ie.KR)(!1),f=(0,ie.KR)({}),b=(0,ie.KR)({month:"",avg_cycle_days:0}),C=(0,ie.KR)(!1),L=(0,ie.KR)(null),w=(0,ie.KR)("year"),E=(0,ie.KR)({avg_findings_per_audit:0,low_threshold:2,high_threshold:5,rating:"N/A",top_audits:[]}),R=(0,ie.KR)(!1),I=(0,ie.KR)(null),D=(0,ie.KR)("year"),P=(0,ie.KR)("number"),_=(0,ie.KR)(!1),A=(0,ie.KR)({avg_close_days:0,target_days:14,efficiency:"N/A",oldest_findings:[],monthly_trend:[],closed_count:0,total_count:0,closure_rate:0}),S=(0,ie.KR)([]),T=(0,ie.KR)(50),x=(0,ie.KR)(!1),F=(0,ie.KR)({}),V=(0,ie.KR)({month:"",avg_close_days:0}),U=(0,ie.KR)(!1),N=(0,ie.KR)(null),M=(0,ie.KR)("year"),X=(0,ie.KR)("all"),$=(0,ie.KR)({total_count:0,trend_direction:"stable",trend_percentage:0,selected_severity:"all",severity_breakdown:[],top_areas:[],monthly_trend:[]}),O=(0,ie.KR)(!1),j=(0,ie.KR)(null),B=(0,ie.KR)("year"),W=(0,ie.KR)({severity_distribution:[],total_issues:0,most_common:null,major_count:0,minor_count:0}),q=(0,ie.KR)(!1),Q=(0,ie.KR)(null),K=(0,ie.KR)({completion_percentage:0,evidence_collected:0,total_findings:0,rating:"N/A",color:"info"}),J=(0,ie.KR)([]),z=(0,ie.KR)([]),H=(0,ie.KR)(""),G=(0,ie.KR)([]),Y=(0,ie.KR)("all"),Z=(0,ie.KR)(!1),ee=(0,ie.KR)(!1),te=(0,ie.KR)(null),ae=(0,ie.KR)("year"),se=(0,ie.KR)({percent_on_time:0,on_time_count:0,total_reports:0,avg_days_difference:0}),oe=(0,ie.KR)([]),le=(0,ie.KR)([]),ne=(0,ie.KR)(!1),re=(0,ie.KR)({}),ce=(0,ie.KR)({label:"",count:0,percentage:0}),de=(0,ie.KR)(!1),ue=(0,ie.KR)(!1),pe=(0,ie.KR)(null),me=(0,ie.KR)({total_defined:0,implemented_count:0,readiness_percentage:0,rating:"N/A",color:"info"}),ve=(0,ie.KR)([]),ke=(0,ie.KR)([]),he=(0,ie.KR)([]),ge=(0,ie.KR)(""),ye=(0,ie.KR)(""),fe=(0,ie.KR)(!1),be=(0,s.EW)(()=>{const e=l.value.completion_percentage||0;return e>=80?"success":e>=50?"warning":"error"}),Ce=(0,s.EW)(()=>{const e=k.value.overall_avg_days||0,t=k.value.target_days||30;return e<=t?"efficiency-good":e<=1.5*t?"efficiency-warning":"efficiency-poor"}),Le=(0,s.EW)(()=>{const e=A.value.efficiency||"";return"Good"===e?"close-time-good":"Fair"===e?"close-time-fair":"close-time-poor"}),we=(0,s.EW)(()=>{const e=$.value.trend_direction||"stable";return"down"===e?"issues-trend-good":"up"===e?"issues-trend-bad":"issues-trend-neutral"}),Ee=(0,s.EW)(()=>{const e=$.value.trend_direction||"stable";return"down"===e?"success":"up"===e?"error":"info"}),Re=(e,t)=>e/t*100+"%",Ie=(0,s.EW)(()=>{const e=K.value.completion_percentage||0;return e>=80?"success":e>=50?"warning":"error"}),De=(0,s.EW)(()=>{const e=K.value.rating||"";return"Excellent"===e?"evidence-excellent":"Good"===e?"evidence-good":"Fair"===e?"evidence-fair":"evidence-poor"}),Pe=(0,s.EW)(()=>{const e=z.value.filter(e=>e.has_evidence).length,t=z.value.length-e;return{withEvidence:e,withoutEvidence:t}}),_e=(0,s.EW)(()=>"all"===Y.value?z.value:"with"===Y.value?z.value.filter(e=>e.has_evidence):z.value.filter(e=>!e.has_evidence)),Ae=(0,s.EW)(()=>se.value.color||"info"),Se=(0,s.EW)(()=>{const e=se.value.rating||"";return"Excellent"===e?"timeliness-excellent":"Good"===e?"timeliness-good":"Fair"===e?"timeliness-fair":"timeliness-poor"}),Te=(0,s.EW)(()=>{const e=g.value,t=Math.ceil(e/5),i=[];for(let a=0;a<=e;a+=t)i.push(a);return i}),xe=(0,s.EW)(()=>{const e=T.value,t=Math.ceil(e/4),i=[];for(let a=0;a<=e;a+=t)i.push(a);return i}),Fe=async()=>{t.value=!0,i.value=null;try{const e=await He.A.get(`http://localhost:8000/api/kpi/audit-completion/?period=${o.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch audit metrics");l.value=e.data.data.metrics,n.value=e.data.data.monthly_breakdown||[],r.value=e.data.data.chart_max||5}catch(e){console.error("Error fetching audit metrics:",e),i.value="Failed to load audit metrics"}finally{t.value=!1}},Ve=async()=>{u.value=!0,p.value=null;try{let e="http://localhost:8000/api/kpi/audit-cycle-time/";m.value&&(e+=`?framework_id=${m.value}`);const t=await He.A.get(e);if(!t.data.success||!t.data.data)throw new Error(t.data.message||"Failed to fetch cycle time metrics");if(k.value=t.data.data.metrics,v.value=t.data.data.frameworks||[],h.value=t.data.data.monthly_breakdown||[],h.value.length>0){const e=Math.max(...h.value.map(e=>e.avg_cycle_days),k.value.target_days);g.value=Math.ceil(1.2*e)}}catch(e){console.error("Error fetching cycle time metrics:",e),p.value="Failed to load cycle time data"}finally{u.value=!1}},Ue=async()=>{C.value=!0,L.value=null;try{const e=await He.A.get(`http://localhost:8000/api/kpi/finding-rate/?period=${w.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch finding rate metrics");E.value=e.data.data.metrics,E.value.top_audits=e.data.data.top_audits||[]}catch(e){console.error("Error fetching finding rate metrics:",e),L.value="Failed to load finding rate data"}finally{C.value=!1}},Ne=async()=>{R.value=!0,I.value=null;try{const[e,t]=await Promise.all([He.A.get(`http://localhost:8000/api/kpi/time-to-close/?period=${D.value}`),He.A.get(`http://localhost:8000/api/kpi/closure-rate/?period=${D.value}`)]);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch time to close metrics");if(A.value=e.data.data.metrics,A.value.oldest_findings=e.data.data.oldest_findings||[],S.value=e.data.data.monthly_trend||[],S.value.length>0){const e=Math.max(...S.value.map(e=>e.avg_close_days),A.value.target_days);T.value=Math.ceil(1.25*e)}if(t.data.success&&t.data.data){const e=t.data.data.metrics;A.value.closed_count=e.closed_count||0,A.value.total_count=e.opened_count||0,A.value.closure_rate=e.closure_rate||0;const i=t.data.data.monthly_trend||[];S.value.length>0&&i.length>0&&(S.value=S.value.map(e=>{const t=i.find(t=>t.month===e.month);return t?{...e,closed_count:t.closed_count||0,total_count:t.opened_count||0,closure_rate:t.rate||0}:e}))}}catch(e){console.error("Error fetching time to close metrics:",e),I.value="Failed to load time to close data"}finally{R.value=!1}},Me=async()=>{U.value=!0,N.value=null;try{const e=await He.A.get(`http://localhost:8000/api/kpi/non-compliance-issues/?period=${M.value}&severity=${X.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch issues metrics");$.value=e.data.data.metrics,$.value.severity_breakdown=e.data.data.severity_breakdown||[],$.value.top_areas=e.data.data.top_areas||[],$.value.monthly_trend=e.data.data.monthly_trend||[]}catch(e){console.error("Error fetching issues metrics:",e),N.value="Failed to load issues data"}finally{U.value=!1}},Xe=async()=>{O.value=!0,j.value=null;try{const e=await He.A.get(`http://localhost:8000/api/kpi/severity-distribution/?period=${B.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch severity metrics");W.value=e.data.data.metrics,W.value.severity_distribution=e.data.data.severity_distribution||[]}catch(e){console.error("Error fetching severity metrics:",e),j.value="Failed to load severity data"}finally{O.value=!1}},$e=async()=>{q.value=!0,Q.value=null;try{let e="http://localhost:8000/api/kpi/evidence-completion/";H.value&&(e+=`?audit_id=${H.value}`);const t=await He.A.get(e);if(!t.data.success||!t.data.data)throw new Error(t.data.message||"Failed to fetch evidence metrics");K.value=t.data.data.metrics,J.value=t.data.data.audit_breakdown||[],z.value=t.data.data.evidence_details||[],0===G.value.length&&J.value.length>0&&(G.value=J.value.map(e=>({id:e.audit_id,name:e.framework_name||"Unknown Framework"})))}catch(e){console.error("Error fetching evidence metrics:",e),Q.value="Failed to load evidence data"}finally{q.value=!1}},Oe=e=>e>=90?"#4CAF50":e>=70?"#3f51b5":e>=50?"#FF9800":"#f44336",je=async e=>{o.value=e,await Fe()},Be=async()=>{await Ve()},We=async e=>{D.value=e,await Ne()},qe=()=>{_.value=!_.value},Qe=async e=>{M.value=e,await Me()},Ke=async e=>{X.value=e,await Me()},Je=async e=>{B.value=e,await Xe()},ze=async()=>{await $e()},Ge=e=>e?e.split(" ")[0]:"",Ye=e=>`${e}%`,Ze=(e,t)=>{ce.value={label:e.label,count:e.count,percentage:e.percentage};const i=t.target.getBoundingClientRect();re.value={left:`${i.left+window.scrollX+10}px`,top:i.top+window.scrollY-70+"px"},ne.value=!0},et=()=>{ne.value=!1},tt=e=>e<=0?"late-report-early":e<=7?"late-report-on-time":e<=14?"late-report-late":"late-report-very-late",it=async()=>{ee.value=!0,te.value=null;try{const e=await He.A.get(`http://localhost:8000/api/kpi/report-timeliness/?period=${ae.value}`);if(!e.data.success||!e.data.data)throw new Error(e.data.message||"Failed to fetch timeliness metrics");se.value=e.data.data.metrics,oe.value=e.data.data.histogram||[],le.value=e.data.data.late_reports||[]}catch(e){console.error("Error fetching timeliness metrics:",e),te.value="Failed to load timeliness data"}finally{ee.value=!1}},at=async e=>{ae.value=e,await it()},st=async()=>{ue.value=!0,pe.value=null;try{let e="http://localhost:8000/api/kpi/compliance-readiness/";ge.value?e+=`?framework_id=${ge.value}`:ye.value&&(e+=`?policy_id=${ye.value}`);const t=await He.A.get(e);if(!t.data.success||!t.data.data)throw new Error(t.data.message||"Failed to fetch readiness metrics");me.value=t.data.data.metrics,ve.value=t.data.data.frameworks||[],ke.value=t.data.data.policies||[],he.value=t.data.data.criticality_breakdown||[]}catch(e){console.error("Error fetching readiness metrics:",e),pe.value="Failed to load readiness data"}finally{ue.value=!1}},ot=async e=>{ge.value=e,ye.value="",await st()},lt=async e=>{ye.value=e,ge.value="",await st()},nt=async()=>{ge.value="",ye.value="",await st()},rt=(0,s.EW)(()=>{const e=me.value.rating||"";return"Excellent"===e?"readiness-excellent":"Good"===e?"readiness-good":"Fair"===e?"readiness-fair":"readiness-poor"}),ct=e=>e>=90?"#4CAF50":e>=75?"#3f51b5":e>=50?"#FF9800":"#f44336",dt=e=>{switch(e){case"Critical":return"#d32f2f";case"High":return"#f44336";case"Medium":return"#FF9800";case"Low":return"#4caf50";default:return"#9e9e9e"}},ut=e=>{const t=h.value[e],i=h.value[e+1];if(!t||!i)return{};const a=e/(h.value.length-1)*100,s=t.avg_cycle_days/g.value*100,o=(e+1)/(h.value.length-1)*100,l=i.avg_cycle_days/g.value*100,n=Math.sqrt(Math.pow(o-a,2)+Math.pow(l-s,2)),r=180*Math.atan2(l-s,o-a)/Math.PI;return{width:`${n}%`,left:`${a}%`,bottom:`${s}%`,transform:`rotate(${r}deg)`,transformOrigin:"left bottom"}},pt=e=>{const t=h.value[e],i=h.value[e+1];return!(!t||!i)&&(t.avg_cycle_days>k.value.target_days||i.avg_cycle_days>k.value.target_days)},mt=(e,t)=>{const i=h.value[e];if(!i)return;b.value={month:i.month,avg_cycle_days:i.avg_cycle_days};const a=t.target.getBoundingClientRect();f.value={left:`${a.left+window.scrollX+10}px`,top:a.top+window.scrollY-70+"px"},y.value=!0},vt=()=>{y.value=!1},kt=e=>{const t=S.value[e],i=S.value[e+1];if(!t||!i)return{};const a=e/(S.value.length-1)*100,s=t.avg_close_days/T.value*100,o=(e+1)/(S.value.length-1)*100,l=i.avg_close_days/T.value*100,n=Math.sqrt(Math.pow(o-a,2)+Math.pow(l-s,2)),r=180*Math.atan2(l-s,o-a)/Math.PI;return{width:`${n}%`,left:`${a}%`,bottom:`${s}%`,transform:`rotate(${r}deg)`,transformOrigin:"left bottom"}},ht=e=>{const t=S.value[e],i=S.value[e+1];return!(!t||!i)&&(t.avg_close_days>A.value.target_days||i.avg_close_days>A.value.target_days)},gt=(e,t)=>{const i=S.value[e];if(!i)return;V.value={month:i.month,avg_close_days:i.avg_close_days};const a=t.target.getBoundingClientRect();F.value={left:`${a.left+window.scrollX+10}px`,top:a.top+window.scrollY-70+"px"},x.value=!0},yt=()=>{x.value=!1};(0,s.sV)(()=>{Fe(),Ve(),Ue(),Ne(),Me(),Xe(),$e(),it(),st()});const ft=e=>"Unspecified"===e?"NA":e,bt=(0,s.EW)(()=>{const e=A.value.avg_close_days||0,t=A.value.target_days||14;if(e<=0||t<=0)return 0;const i=Math.min(200,Math.max(0,t/e*100));return Math.round(i)}),Ct=e=>$.value.severity_breakdown.find(t=>t.severity===e)?.count||0;return(e,C)=>{const L=(0,s.g2)("v-card-item"),w=(0,s.g2)("v-icon"),E=(0,s.g2)("v-card-text"),ie=(0,s.g2)("v-card"),Fe=(0,s.g2)("v-progress-circular"),Ve=(0,s.g2)("v-spacer"),Ue=(0,s.g2)("v-btn"),Ne=(0,s.g2)("v-card-title"),Me=(0,s.g2)("v-dialog");return(0,s.uX)(),(0,s.CE)("div",EV,[(0,s.Lk)("div",RV,[(0,s.Lk)("div",IV,[(0,s.bF)(ie,{loading:O.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",DV,[(0,s.Lk)("div",PV,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:B.value===e}]),onClick:t=>Je(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,_V)),64))]),(0,s.Lk)("div",AV,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(W.value.severity_distribution,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"severity-bar"},[(0,s.Lk)("div",SV,(0,d.v_)(ft(e.severity)),1),(0,s.Lk)("div",TV,[(0,s.Lk)("div",{class:"severity-bar-fill",style:(0,d.Tr)({width:Re(e.count,W.value.total_issues),backgroundColor:e.color})},null,4),(0,s.Lk)("span",xV,(0,d.v_)(e.count),1)])]))),128))]),C[25]||(C[25]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Severity of Issues",-1)),(0,s.Lk)("div",FV,[(0,s.Lk)("div",VV,"Most common: "+(0,d.v_)(ft(W.value.most_common)||"None"),1),W.value.major_count>0?((0,s.uX)(),(0,s.CE)("div",UV,[(0,s.Lk)("span",NV,(0,d.v_)(W.value.major_count),1),C[23]||(C[23]=(0,s.eW)(" Major, ")),(0,s.Lk)("span",MV,(0,d.v_)(W.value.minor_count),1),C[24]||(C[24]=(0,s.eW)(" Minor issues "))])):((0,s.uX)(),(0,s.CE)("div",XV,"No major issues found"))])])]),_:1}),j.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[26]||(C[26]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[26]}),(0,s.eW)(" "+(0,d.v_)(j.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",$V,[(0,s.bF)(ie,{loading:u.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",OV,[(0,s.Lk)("div",jV,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[0]||(C[0]=e=>m.value=e),onChange:Be,class:"filter-select"},[C[27]||(C[27]=(0,s.Lk)("option",{value:""},"All Frameworks",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,BV))),128))],544),[[a.u1,m.value]])]),(0,s.Lk)("div",{class:(0,d.C4)(["time-badge",Ce.value])},[(0,s.eW)((0,d.v_)(k.value.overall_avg_days||0)+" ",1),C[28]||(C[28]=(0,s.Lk)("span",{class:"time-unit"},"days",-1))],2),C[32]||(C[32]=(0,s.Lk)("div",{class:"text-h6 mt-4 text-center"},"Audit Cycle Time",-1)),(0,s.Lk)("div",WV,[(0,s.Lk)("div",qV,"Target: "+(0,d.v_)(k.value.target_days||30)+" days",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Ce.value])},(0,d.v_)(k.value.efficiency||"N/A"),3)]),h.value.length>0?((0,s.uX)(),(0,s.CE)("div",QV,[C[31]||(C[31]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Cycle Time Trend",-1)),(0,s.Lk)("div",KV,[(0,s.Lk)("div",JV,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Te.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"chart-grid-line",style:(0,d.Tr)({bottom:e/g.value*100+"%"})},null,4))),128))]),(0,s.Lk)("div",zV,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(Te.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"chart-y-label",style:(0,d.Tr)({bottom:e/g.value*100+"%"})},(0,d.v_)(e),5))),128))]),(0,s.Lk)("div",{class:"threshold-line",style:(0,d.Tr)({bottom:k.value.target_days/g.value*100+"%"})},null,4),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["chart-point",{"point-above-threshold":e.avg_cycle_days>k.value.target_days}]),style:(0,d.Tr)({left:t/(h.value.length-1)*100+"%",bottom:e.avg_cycle_days/g.value*100+"%"}),title:`${e.month}: ${e.avg_cycle_days} days`,onMouseover:e=>mt(t,e),onMouseleave:C[1]||(C[1]=e=>vt())},null,46,HV))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value.slice(0,-1),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:`line-${t}`,class:(0,d.C4)(["chart-line",{"line-above-threshold":pt(t)}]),style:(0,d.Tr)(ut(t))},null,6))),128)),y.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"chart-tooltip",style:(0,d.Tr)(f.value)},[(0,s.Lk)("div",GV,(0,d.v_)(b.value.month),1),(0,s.Lk)("div",YV,(0,d.v_)(b.value.avg_cycle_days)+" days",1),b.value.avg_cycle_days>k.value.target_days?((0,s.uX)(),(0,s.CE)("div",ZV,(0,d.v_)(b.value.avg_cycle_days-k.value.target_days)+" days above target ",1)):((0,s.uX)(),(0,s.CE)("div",eU,(0,d.v_)(k.value.target_days-b.value.avg_cycle_days)+" days below target ",1))],4)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",tU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:`label-${t}`,class:"chart-label",style:(0,d.Tr)({left:t/(h.value.length-1)*100+"%",transform:"translateX(-50%)"})},(0,d.v_)(Ge(e.month)),5))),128))]),(0,s.Lk)("div",iU,[C[30]||(C[30]=(0,s.Lk)("div",{class:"legend-item"},[(0,s.Lk)("div",{class:"legend-color cycle-time-color"}),(0,s.Lk)("div",{class:"legend-label"},"Cycle Time")],-1)),(0,s.Lk)("div",aU,[C[29]||(C[29]=(0,s.Lk)("div",{class:"legend-color threshold-color"},null,-1)),(0,s.Lk)("div",sU,"Target ("+(0,d.v_)(k.value.target_days)+" days)",1)])])])):(0,s.Q3)("",!0)])]),_:1}),p.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[33]||(C[33]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[33]}),(0,s.eW)(" "+(0,d.v_)(p.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",oU,[(0,s.bF)(ie,{loading:R.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",lU,[(0,s.Lk)("div",nU,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:D.value===e}]),onClick:t=>We(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,rU)),64))]),(0,s.Lk)("div",cU,[(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-button",{active:"number"===P.value}]),onClick:C[2]||(C[2]=e=>P.value="number")}," Days ",2),(0,s.Lk)("button",{class:(0,d.C4)(["view-toggle-button",{active:"percentage"===P.value}]),onClick:C[3]||(C[3]=e=>P.value="percentage")}," Percentage ",2)]),(0,s.Lk)("div",{class:"flip-card-container",onClick:qe},[(0,s.Lk)("div",{class:(0,d.C4)(["flip-card",{flipped:_.value}])},[(0,s.Lk)("div",dU,[(0,s.Lk)("div",uU,[(0,s.Lk)("div",pU,[(0,s.Lk)("div",{class:(0,d.C4)(["time-badge",Le.value])},["number"===P.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(A.value.avg_close_days||0)+" ",1),C[34]||(C[34]=(0,s.Lk)("span",{class:"time-unit"},"days",-1))],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,d.v_)(bt.value)+"% ",1)],64))],2),C[36]||(C[36]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Time to Close",-1)),(0,s.Lk)("div",mU,[(0,s.Lk)("div",vU,"Target: "+(0,d.v_)(A.value.target_days||14)+" days",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Le.value])},(0,d.v_)(A.value.efficiency||"N/A"),3)]),S.value.length>0?((0,s.uX)(),(0,s.CE)("div",kU,[C[35]||(C[35]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Trend",-1)),(0,s.Lk)("div",hU,[(0,s.Lk)("div",gU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(xe.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"chart-grid-line",style:(0,d.Tr)({bottom:e/T.value*100+"%"})},null,4))),128))]),(0,s.Lk)("div",yU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(xe.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"chart-y-label",style:(0,d.Tr)({bottom:e/T.value*100+"%"})},["number"===P.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e),1)],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,d.v_)(Math.round(e/A.value.target_days*100))+"% ",1)],64))],4))),128))]),(0,s.Lk)("div",{class:"threshold-line",style:(0,d.Tr)({bottom:A.value.target_days/T.value*100+"%"})},null,4),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["chart-point",{"point-above-threshold":e.avg_close_days>A.value.target_days}]),style:(0,d.Tr)({left:t/(S.value.length-1)*100+"%",bottom:e.avg_close_days/T.value*100+"%"}),title:`${e.month}: ${e.avg_close_days} days`,onMouseover:e=>gt(t,e),onMouseleave:C[4]||(C[4]=e=>yt())},null,46,fU))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.value.slice(0,-1),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:`line-${t}`,class:(0,d.C4)(["chart-line",{"line-above-threshold":ht(t)}]),style:(0,d.Tr)(kt(t))},null,6))),128)),x.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"chart-tooltip",style:(0,d.Tr)(F.value)},[(0,s.Lk)("div",bU,(0,d.v_)(V.value.month),1),(0,s.Lk)("div",CU,["number"===P.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(V.value.avg_close_days)+" days ",1)],64)):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.eW)((0,d.v_)(Math.round(V.value.avg_close_days/A.value.target_days*100))+"% ",1)],64))]),V.value.avg_close_days>A.value.target_days?((0,s.uX)(),(0,s.CE)("div",LU,(0,d.v_)(V.value.avg_close_days-A.value.target_days)+" days above target ",1)):((0,s.uX)(),(0,s.CE)("div",wU,(0,d.v_)(A.value.target_days-V.value.avg_close_days)+" days below target ",1))],4)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",EU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:`label-${t}`,class:"chart-label",style:(0,d.Tr)({left:t/(S.value.length-1)*100+"%",transform:"translateX(-50%)"})},(0,d.v_)(Ge(e.month)),5))),128))])])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",RU,[(0,s.bF)(w,{small:"",class:"mr-1"},{default:(0,s.k6)(()=>C[37]||(C[37]=[(0,s.eW)("mdi-flip-horizontal")])),_:1,__:[37]}),C[38]||(C[38]=(0,s.eW)(" Click to view detailed table "))])]),(0,s.Lk)("div",IU,[(0,s.Lk)("div",DU,[C[41]||(C[41]=(0,s.Lk)("div",{class:"section-title"},"Time to Close Details",-1)),(0,s.Lk)("div",PU,[(0,s.Lk)("table",_U,[C[40]||(C[40]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Month"),(0,s.Lk)("th",null,"Avg Days"),(0,s.Lk)("th",null,"Target"),(0,s.Lk)("th",null,"Variance"),(0,s.Lk)("th",null,"Closed"),(0,s.Lk)("th",null,"Total"),(0,s.Lk)("th",null,"Rate")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(S.value,(e,t)=>((0,s.uX)(),(0,s.CE)("tr",{key:t,class:(0,d.C4)({"critical-age":e.avg_close_days>1.5*A.value.target_days,"warning-age":e.avg_close_days>A.value.target_days&&e.avg_close_days<=1.5*A.value.target_days,"good-age":e.avg_close_days<=A.value.target_days})},[(0,s.Lk)("td",null,(0,d.v_)(e.month),1),(0,s.Lk)("td",null,(0,d.v_)(e.avg_close_days.toFixed(1)),1),(0,s.Lk)("td",null,(0,d.v_)(A.value.target_days),1),(0,s.Lk)("td",{class:(0,d.C4)({"negative-variance":e.avg_close_days>A.value.target_days,"positive-variance":e.avg_close_days<=A.value.target_days})},(0,d.v_)((e.avg_close_days-A.value.target_days).toFixed(1)),3),(0,s.Lk)("td",null,(0,d.v_)(e.closed_count||0),1),(0,s.Lk)("td",null,(0,d.v_)(e.total_count||0),1),(0,s.Lk)("td",null,(0,d.v_)(e.closure_rate?e.closure_rate.toFixed(1)+"%":"N/A"),1)],2))),128))]),(0,s.Lk)("tfoot",null,[(0,s.Lk)("tr",AU,[C[39]||(C[39]=(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,"Overall")],-1)),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(A.value.avg_close_days.toFixed(1)),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(A.value.target_days),1)]),(0,s.Lk)("td",{class:(0,d.C4)({"negative-variance":A.value.avg_close_days>A.value.target_days,"positive-variance":A.value.avg_close_days<=A.value.target_days})},[(0,s.Lk)("strong",null,(0,d.v_)((A.value.avg_close_days-A.value.target_days).toFixed(1)),1)],2),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(A.value.closed_count||0),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(A.value.total_count||0),1)]),(0,s.Lk)("td",null,[(0,s.Lk)("strong",null,(0,d.v_)(A.value.closure_rate?A.value.closure_rate.toFixed(1)+"%":"N/A"),1)])])])])])]),(0,s.Lk)("div",SU,[(0,s.bF)(w,{small:"",class:"mr-1"},{default:(0,s.k6)(()=>C[42]||(C[42]=[(0,s.eW)("mdi-flip-horizontal")])),_:1,__:[42]}),C[43]||(C[43]=(0,s.eW)(" Click to view chart "))])])],2)])])]),_:1}),I.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[44]||(C[44]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[44]}),(0,s.eW)(" "+(0,d.v_)(I.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",TU,[(0,s.bF)(ie,{loading:U.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",xU,[(0,s.Lk)("div",FU,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:M.value===e}]),onClick:t=>Qe(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,VU)),64))]),(0,s.Lk)("div",UU,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["all","major","minor","none"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["severity-button",{active:X.value===e}]),onClick:t=>Ke(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,NU)),64))]),(0,s.Lk)("div",{class:(0,d.C4)(["issues-badge",we.value])},[(0,s.eW)((0,d.v_)($.value.total_count||0)+" ",1),"stable"!==$.value.trend_direction?((0,s.uX)(),(0,s.CE)("span",MU,[(0,s.bF)(w,{size:"small",color:Ee.value},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)("up"===$.value.trend_direction?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1},8,["color"]),(0,s.eW)(" "+(0,d.v_)(Math.abs($.value.trend_percentage))+"% ",1)])):(0,s.Q3)("",!0)],2),C[49]||(C[49]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Non-Compliance Issues",-1)),(0,s.Lk)("div",XU,[(0,s.Lk)("div",$U,[C[45]||(C[45]=(0,s.Lk)("div",{class:"severity-name"},"Major:",-1)),(0,s.Lk)("div",OU,(0,d.v_)(Ct("Major")),1)]),(0,s.Lk)("div",jU,[C[46]||(C[46]=(0,s.Lk)("div",{class:"severity-name"},"Minor:",-1)),(0,s.Lk)("div",BU,(0,d.v_)(Ct("Minor")),1)]),(0,s.Lk)("div",WU,[C[47]||(C[47]=(0,s.Lk)("div",{class:"severity-name"},"None:",-1)),(0,s.Lk)("div",qU,(0,d.v_)(Ct("None")),1)])]),$.value.top_areas&&$.value.top_areas.length?((0,s.uX)(),(0,s.CE)("div",QU," Top area: "+(0,d.v_)($.value.top_areas[0].compliance_name)+" ("+(0,d.v_)($.value.top_areas[0].count)+" issues) ",1)):((0,s.uX)(),(0,s.CE)("div",KU," No top areas identified ")),$.value.monthly_trend&&$.value.monthly_trend.length?((0,s.uX)(),(0,s.CE)("div",JU,[C[48]||(C[48]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Trend",-1)),(0,s.Lk)("div",zU,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)($.value.monthly_trend.slice(-2),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"month-item"},[(0,s.Lk)("div",HU,(0,d.v_)(Ge(e.month)),1),(0,s.Lk)("div",GU,(0,d.v_)(e.count),1)]))),128))])])):(0,s.Q3)("",!0)])]),_:1}),N.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[50]||(C[50]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[50]}),(0,s.eW)(" "+(0,d.v_)(N.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])])]),(0,s.Lk)("div",YU,[(0,s.Lk)("div",ZU,[(0,s.bF)(ie,{loading:q.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",eN,[G.value.length>0?((0,s.uX)(),(0,s.CE)("div",tN,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[5]||(C[5]=e=>H.value=e),class:"audit-select",onChange:ze},[C[51]||(C[51]=(0,s.Lk)("option",{value:""},"All Audits",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(G.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id}," Audit #"+(0,d.v_)(e.id)+" - "+(0,d.v_)(e.name),9,iN))),128))],544),[[a.u1,H.value]])])):(0,s.Q3)("",!0),(0,s.Lk)("div",aN,[(0,s.bF)(Fe,{"model-value":K.value.completion_percentage||0,size:130,width:15,color:Ie.value,class:"gauge-chart"},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(K.value.completion_percentage||0)+"% ",1)]),_:1},8,["model-value","color"])]),C[54]||(C[54]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Evidence Collection",-1)),(0,s.Lk)("div",sN,[(0,s.Lk)("div",oN,(0,d.v_)(K.value.evidence_collected||0)+" of "+(0,d.v_)(K.value.total_findings||0)+" findings have evidence",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",De.value])},(0,d.v_)(K.value.rating||"N/A"),3)]),!H.value&&J.value.length>0?((0,s.uX)(),(0,s.CE)("div",lN,[C[52]||(C[52]=(0,s.Lk)("div",{class:"evidence-audits-title"},"Top Audits by Evidence Completion",-1)),(0,s.Lk)("div",nN,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(J.value.slice(0,3),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"evidence-audit-item",onClick:t=>{H.value=e.audit_id,ze()}},[(0,s.Lk)("div",cN,"Audit #"+(0,d.v_)(e.audit_id),1),(0,s.Lk)("div",dN,(0,d.v_)(e.framework_name),1),(0,s.Lk)("div",uN,[(0,s.Lk)("div",pN,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:`${e.completion_percentage}%`,backgroundColor:Oe(e.completion_percentage)})},null,4)]),(0,s.Lk)("span",mN,(0,d.v_)(e.completion_percentage)+"%",1)])],8,rN))),128))])])):(0,s.Q3)("",!0),H.value&&z.value.length>0?((0,s.uX)(),(0,s.CE)("div",vN,[C[53]||(C[53]=(0,s.Lk)("div",{class:"evidence-details-title"},"Evidence Details",-1)),(0,s.Lk)("div",kN,[(0,s.Lk)("div",hN,(0,d.v_)(Pe.value.withEvidence)+" with evidence",1),(0,s.Lk)("div",gN,(0,d.v_)(Pe.value.withoutEvidence)+" without evidence",1)]),(0,s.Lk)("button",{class:"view-all-button",onClick:C[6]||(C[6]=e=>Z.value=!0)}," View All Evidence ")])):(0,s.Q3)("",!0)])]),_:1}),Q.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[55]||(C[55]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[55]}),(0,s.eW)(" "+(0,d.v_)(Q.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",yN,[(0,s.bF)(ie,{loading:ee.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",fN,[(0,s.Lk)("div",bN,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["month","quarter","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:ae.value===e}]),onClick:t=>at(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,CN)),64))]),(0,s.Lk)("div",{class:"percentage-display",style:(0,d.Tr)({color:Ae.value})},[(0,s.Lk)("span",LN,(0,d.v_)(se.value.percent_on_time||0)+"%",1)],4),C[57]||(C[57]=(0,s.Lk)("div",{class:"text-h6 mt-3 text-center"},"Report Timeliness",-1)),(0,s.Lk)("div",wN,[(0,s.Lk)("div",EN,(0,d.v_)(se.value.on_time_count||0)+" of "+(0,d.v_)(se.value.total_reports||0)+" reports on time",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",Se.value])},(0,d.v_)(se.value.rating||"N/A"),3)]),(0,s.Lk)("div",RN,(0,d.v_)(se.value.avg_days_difference>0?"Avg "+se.value.avg_days_difference+" days late":"Avg "+Math.abs(se.value.avg_days_difference)+" days early"),1),oe.value.length>0?((0,s.uX)(),(0,s.CE)("div",IN,[C[56]||(C[56]=(0,s.Lk)("div",{class:"histogram-title"},"Report Submission Timeliness",-1)),(0,s.Lk)("div",DN,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(oe.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"histogram-bar",title:`${e.label}: ${e.count} reports (${e.percentage}%)`,onMouseover:t=>Ze(e,t),onMouseleave:C[7]||(C[7]=e=>et())},[(0,s.Lk)("div",{class:"histogram-bar-fill",style:(0,d.Tr)({height:Ye(e.percentage),backgroundColor:e.color})},null,4),(0,s.Lk)("div",_N,(0,d.v_)(e.label),1),(0,s.Lk)("div",AN,(0,d.v_)(e.count),1)],40,PN))),128))])])):(0,s.Q3)("",!0),le.value.length>0?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"view-late-button",onClick:C[8]||(C[8]=e=>de.value=!0)}," View "+(0,d.v_)(le.value.length)+" Late Reports ",1)):(0,s.Q3)("",!0)])]),_:1}),te.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[58]||(C[58]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[58]}),(0,s.eW)(" "+(0,d.v_)(te.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",SN,[(0,s.bF)(ie,{loading:ue.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",TN,[ve.value.length>0||ke.value.length>0?((0,s.uX)(),(0,s.CE)("div",xN,[(0,s.Lk)("div",FN,[ve.value.length>0?((0,s.uX)(),(0,s.CE)("div",VN,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[9]||(C[9]=e=>ge.value=e),onChange:C[10]||(C[10]=e=>ot(ge.value)),class:"filter-select"},[C[59]||(C[59]=(0,s.Lk)("option",{value:""},"All Frameworks",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ve.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.framework_id,value:e.framework_id},(0,d.v_)(e.name),9,UN))),128))],544),[[a.u1,ge.value]])])):(0,s.Q3)("",!0),ke.value.length>0?((0,s.uX)(),(0,s.CE)("div",NN,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":C[11]||(C[11]=e=>ye.value=e),onChange:C[12]||(C[12]=e=>lt(ye.value)),class:"filter-select"},[C[60]||(C[60]=(0,s.Lk)("option",{value:""},"All Policies",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ke.value,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.policy_id,value:e.policy_id},(0,d.v_)(e.name),9,MN))),128))],544),[[a.u1,ye.value]])])):(0,s.Q3)("",!0)]),ge.value||ye.value?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:nt,class:"reset-filter-button"}," Reset Filters ")):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.Lk)("div",XN,[(0,s.bF)(Fe,{"model-value":me.value.readiness_percentage||0,size:150,width:15,color:me.value.color||"info",class:"gauge-chart"},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(me.value.readiness_percentage||0)+"% ",1)]),_:1},8,["model-value","color"])]),C[62]||(C[62]=(0,s.Lk)("div",{class:"text-h6 mt-4 text-center"},"Compliance Readiness",-1)),(0,s.Lk)("div",$N,[(0,s.Lk)("div",ON,(0,d.v_)(me.value.implemented_count||0)+" of "+(0,d.v_)(me.value.total_defined||0)+" controls implemented ",1),(0,s.Lk)("div",{class:(0,d.C4)(["efficiency-badge",rt.value])},(0,d.v_)(me.value.rating||"N/A"),3)]),ge.value||ye.value?((0,s.uX)(),(0,s.CE)("div",jN,[(0,s.Lk)("div",BN,(0,d.v_)(ge.value?"Framework: "+(ve.value.find(e=>e.framework_id==ge.value)?.name||""):"Policy: "+(ke.value.find(e=>e.policy_id==ye.value)?.name||"")),1)])):(0,s.Q3)("",!0),!ge.value&&!ye.value&&ve.value.length>0?((0,s.uX)(),(0,s.CE)("button",{key:2,class:"view-breakdown-button",onClick:C[13]||(C[13]=e=>fe.value=!0)}," View Framework Breakdown ")):(0,s.Q3)("",!0),he.value.length>0?((0,s.uX)(),(0,s.CE)("div",WN,[C[61]||(C[61]=(0,s.Lk)("div",{class:"breakdown-title"},"Breakdown by Criticality",-1)),(0,s.Lk)("div",qN,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(he.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"criticality-bar-item"},[(0,s.Lk)("div",QN,(0,d.v_)(e.criticality),1),(0,s.Lk)("div",KN,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:`${e.readiness_percentage}%`,backgroundColor:dt(e.criticality)})},null,4),(0,s.Lk)("span",JN,(0,d.v_)(e.readiness_percentage)+"%",1)]),(0,s.Lk)("div",zN,(0,d.v_)(e.implemented_count)+" / "+(0,d.v_)(e.total_defined),1)]))),128))])])):(0,s.Q3)("",!0)])]),_:1}),pe.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[63]||(C[63]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[63]}),(0,s.eW)(" "+(0,d.v_)(pe.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])]),(0,s.Lk)("div",HN,[(0,s.bF)(ie,{loading:t.value,class:"kpi-card",elevation:"2"},{default:(0,s.k6)(()=>[(0,s.bF)(L,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",GN,[(0,s.Lk)("div",YN,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["day","week","month","year"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["period-button",{active:o.value===e}]),onClick:t=>je(e)},(0,d.v_)(e.charAt(0).toUpperCase()+e.slice(1)),11,ZN)),64))]),(0,s.Lk)("div",eM,[(0,s.bF)(Fe,{"model-value":l.value.completion_percentage||0,size:150,width:15,color:be.value,class:"gauge-chart"},{default:(0,s.k6)(()=>[(0,s.eW)((0,d.v_)(l.value.completion_percentage||0)+"% ",1)]),_:1},8,["model-value","color"])]),C[68]||(C[68]=(0,s.Lk)("div",{class:"text-h6 mt-4 text-center"},"Audit Completion",-1)),(0,s.Lk)("div",tM,[(0,s.Lk)("div",iM,[(0,s.Lk)("div",aM,(0,d.v_)(l.value.total_audits||0),1),C[64]||(C[64]=(0,s.Lk)("div",{class:"metric-label"},"Planned",-1))]),(0,s.Lk)("div",sM,[(0,s.Lk)("div",oM,(0,d.v_)(l.value.completed_audits||0),1),C[65]||(C[65]=(0,s.Lk)("div",{class:"metric-label"},"Completed",-1))])]),n.value.length>0?((0,s.uX)(),(0,s.CE)("div",lM,[C[66]||(C[66]=(0,s.Lk)("div",{class:"chart-title"},"Monthly Audit Completion",-1)),(0,s.Lk)("div",nM,[(0,s.Lk)("div",rM,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"y-axis-label",style:(0,d.Tr)({bottom:e/r.value*100+"%"})},(0,d.v_)(e),5))),128))]),(0,s.Lk)("div",cM,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"bar-group"},[(0,s.Lk)("div",dM,[(0,s.Lk)("div",{class:"bar planned-bar",style:(0,d.Tr)({height:e.planned/r.value*100+"%",opacity:e.planned>0?1:.3}),title:`Planned: ${e.planned}`},null,12,uM)]),(0,s.Lk)("div",pM,[(0,s.Lk)("div",{class:"bar completed-bar",style:(0,d.Tr)({height:e.completed/r.value*100+"%",opacity:e.completed>0?1:.3}),title:`Completed: ${e.completed}`},null,12,mM)]),(0,s.Lk)("div",vM,(0,d.v_)(e.month),1)]))),128))])]),C[67]||(C[67]=(0,s.Lk)("div",{class:"chart-legend"},[(0,s.Lk)("div",{class:"legend-item"},[(0,s.Lk)("div",{class:"legend-color planned-color"}),(0,s.Lk)("div",{class:"legend-label"},"Planned")]),(0,s.Lk)("div",{class:"legend-item"},[(0,s.Lk)("div",{class:"legend-color completed-color"}),(0,s.Lk)("div",{class:"legend-label"},"Completed")])],-1))])):(0,s.Q3)("",!0)])]),_:1}),i.value?((0,s.uX)(),(0,s.Wv)(E,{key:0,class:"error-text"},{default:(0,s.k6)(()=>[(0,s.bF)(w,{color:"error",class:"mr-2"},{default:(0,s.k6)(()=>C[69]||(C[69]=[(0,s.eW)("mdi-alert-circle")])),_:1,__:[69]}),(0,s.eW)(" "+(0,d.v_)(i.value),1)]),_:1})):(0,s.Q3)("",!0)]),_:1},8,["loading"])])]),(0,s.bF)(Me,{modelValue:Z.value,"onUpdate:modelValue":C[18]||(C[18]=e=>Z.value=e),"max-width":"800px"},{default:(0,s.k6)(()=>[(0,s.bF)(ie,null,{default:(0,s.k6)(()=>[(0,s.bF)(Ne,{class:"modal-title"},{default:(0,s.k6)(()=>[(0,s.eW)(" Evidence Details for Audit #"+(0,d.v_)(H.value)+" ",1),(0,s.bF)(Ve),(0,s.bF)(Ue,{icon:"",onClick:C[14]||(C[14]=e=>Z.value=!1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>C[70]||(C[70]=[(0,s.eW)("mdi-close")])),_:1,__:[70]})]),_:1})]),_:1}),(0,s.bF)(E,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",kM,[(0,s.Lk)("div",hM,[C[71]||(C[71]=(0,s.Lk)("label",{class:"filter-label"},"Show:",-1)),(0,s.Lk)("div",gM,[(0,s.Lk)("button",{class:(0,d.C4)(["filter-button",{active:"all"===Y.value}]),onClick:C[15]||(C[15]=e=>Y.value="all")}," All ",2),(0,s.Lk)("button",{class:(0,d.C4)(["filter-button",{active:"with"===Y.value}]),onClick:C[16]||(C[16]=e=>Y.value="with")}," With Evidence ",2),(0,s.Lk)("button",{class:(0,d.C4)(["filter-button",{active:"without"===Y.value}]),onClick:C[17]||(C[17]=e=>Y.value="without")}," Without Evidence ",2)])]),(0,s.Lk)("div",yM,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(_e.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["evidence-item",{"has-evidence":e.has_evidence}])},[(0,s.Lk)("div",fM,[(0,s.Lk)("div",bM,"Finding #"+(0,d.v_)(e.finding_id)+" (Compliance #"+(0,d.v_)(e.compliance_id)+")",1),(0,s.Lk)("div",{class:(0,d.C4)(["evidence-status",{"status-positive":e.has_evidence,"status-negative":!e.has_evidence}])},(0,d.v_)(e.has_evidence?"Evidence Provided":"No Evidence"),3)]),e.has_evidence?((0,s.uX)(),(0,s.CE)("div",CM,[(0,s.Lk)("div",LM,(0,d.v_)(e.evidence),1)])):(0,s.Q3)("",!0)],2))),128))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),ne.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"histogram-tooltip",style:(0,d.Tr)(re.value)},[(0,s.Lk)("div",wM,(0,d.v_)(ce.value.label),1),(0,s.Lk)("div",EM,(0,d.v_)(ce.value.count)+" reports",1),(0,s.Lk)("div",RM,(0,d.v_)(ce.value.percentage)+"% of total",1)],4)):(0,s.Q3)("",!0),(0,s.bF)(Me,{modelValue:de.value,"onUpdate:modelValue":C[20]||(C[20]=e=>de.value=e),"max-width":"800px"},{default:(0,s.k6)(()=>[(0,s.bF)(ie,null,{default:(0,s.k6)(()=>[(0,s.bF)(Ne,{class:"modal-title"},{default:(0,s.k6)(()=>[C[73]||(C[73]=(0,s.eW)(" Late Audit Reports ")),(0,s.bF)(Ve),(0,s.bF)(Ue,{icon:"",onClick:C[19]||(C[19]=e=>de.value=!1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>C[72]||(C[72]=[(0,s.eW)("mdi-close")])),_:1,__:[72]})]),_:1})]),_:1,__:[73]}),(0,s.bF)(E,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",IM,[(0,s.Lk)("div",DM,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(le.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"late-report-item"},[(0,s.Lk)("div",PM,[(0,s.Lk)("div",_M,"Audit #"+(0,d.v_)(e.audit_id),1),(0,s.Lk)("div",{class:(0,d.C4)(["late-report-days",tt(e.days_late)])},(0,d.v_)(e.days_late)+" days late ",3)]),(0,s.Lk)("div",AM,[(0,s.Lk)("div",SM,(0,d.v_)(e.framework_name),1),(0,s.Lk)("div",TM,[(0,s.Lk)("span",xM,"Due: "+(0,d.v_)(e.due_date),1),(0,s.Lk)("span",FM,"Completed: "+(0,d.v_)(e.completion_date),1)])])]))),128))])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),(0,s.bF)(Me,{modelValue:fe.value,"onUpdate:modelValue":C[22]||(C[22]=e=>fe.value=e),"max-width":"800px"},{default:(0,s.k6)(()=>[(0,s.bF)(ie,null,{default:(0,s.k6)(()=>[(0,s.bF)(Ne,{class:"modal-title"},{default:(0,s.k6)(()=>[C[75]||(C[75]=(0,s.eW)(" Framework Compliance Readiness ")),(0,s.bF)(Ve),(0,s.bF)(Ue,{icon:"",onClick:C[21]||(C[21]=e=>fe.value=!1)},{default:(0,s.k6)(()=>[(0,s.bF)(w,null,{default:(0,s.k6)(()=>C[74]||(C[74]=[(0,s.eW)("mdi-close")])),_:1,__:[74]})]),_:1})]),_:1,__:[75]}),(0,s.bF)(E,null,{default:(0,s.k6)(()=>[(0,s.Lk)("div",VM,[(0,s.Lk)("div",UM,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(ve.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"framework-item",onClick:t=>{ot(e.framework_id),fe.value=!1}},[(0,s.Lk)("div",MM,[(0,s.Lk)("div",XM,(0,d.v_)(e.name),1),(0,s.Lk)("div",$M,(0,d.v_)(e.readiness_percentage)+"% ",1)]),(0,s.Lk)("div",OM,[(0,s.Lk)("div",jM,[(0,s.Lk)("div",{class:"progress-bar-fill",style:(0,d.Tr)({width:`${e.readiness_percentage}%`,backgroundColor:ct(e.readiness_percentage)})},null,4)])]),(0,s.Lk)("div",BM,(0,d.v_)(e.implemented_count)+" of "+(0,d.v_)(e.total_defined)+" controls implemented ",1)],8,NM))),128))])])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};const qM=WM;var QM=qM;const KM={class:"dashboard-container"},JM={class:"dashboard-header"},zM={class:"dashboard-actions"},HM={class:"performance-summary"},GM={class:"summary-card growth"},YM={class:"summary-content"},ZM={class:"summary-value"},eX={class:"summary-card"},tX={class:"summary-content"},iX={class:"summary-value"},aX={class:"summary-card"},sX={class:"summary-content"},oX={class:"summary-value"},lX={class:"summary-card"},nX={class:"summary-content"},rX={class:"summary-value"},cX={class:"dashboard-main-row dashboard-main-row-3col"},dX={class:"dashboard-main-col asset-performance-col"},uX={class:"chart-card tabbed-chart-card"},pX={class:"card-header"},mX={class:"chart-controls"},vX={class:"axis-selectors"},kX=["disabled"],hX=["disabled"],gX={class:"chart-tabs"},yX=["onClick","title","disabled"],fX={class:"chart-container"},bX={key:0,class:"chart-loading"},CX={class:"dashboard-main-col recent-activity-col"},LX={class:"activity-card"},wX={class:"card-header"},EX={key:0,class:"activity-loading"},RX={key:1,class:"activity-empty"},IX={key:2,class:"activity-list"},DX={class:"activity-content"},PX={class:"activity-title"},_X={class:"activity-desc"},AX={class:"activity-time"};function SX(e,t,i,o,l,n){const r=(0,s.g2)("LineChart"),c=(0,s.g2)("Bar"),u=(0,s.g2)("Doughnut");return(0,s.uX)(),(0,s.CE)("div",KM,[(0,s.Lk)("div",JM,[t[6]||(t[6]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Auditor Dashboard",-1)),(0,s.Lk)("div",zM,[(0,s.Lk)("button",{class:"action-btn",onClick:t[0]||(t[0]=(...e)=>o.refreshData&&o.refreshData(...e))},t[4]||(t[4]=[(0,s.Lk)("i",{class:"fas fa-sync-alt"},null,-1)])),t[5]||(t[5]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",HM,[(0,s.Lk)("div",GM,[t[9]||(t[9]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-check"})],-1)),(0,s.Lk)("div",YM,[t[8]||(t[8]=(0,s.Lk)("div",{class:"summary-label"},"Audit Completion Rate",-1)),(0,s.Lk)("div",ZM,[(0,s.Lk)("span",{class:(0,d.C4)({positive:o.auditCompletionData.is_positive_change,negative:!o.auditCompletionData.is_positive_change})},(0,d.v_)(o.auditCompletionData.is_positive_change?"+":"-")+(0,d.v_)(Math.abs(o.auditCompletionData.current_month_rate).toFixed(1))+"% ",3),t[7]||(t[7]=(0,s.Lk)("span",{class:"period"},"this month",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.auditCompletionData.is_positive_change,negative:!o.auditCompletionData.is_positive_change}])},(0,d.v_)(o.auditCompletionData.is_positive_change?"+":"-")+(0,d.v_)(Math.abs(o.auditCompletionData.change_in_rate).toFixed(2))+"% vs last month ",3)])]),(0,s.Lk)("div",eX,[t[11]||(t[11]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-tasks"})],-1)),(0,s.Lk)("div",tX,[t[10]||(t[10]=(0,s.Lk)("div",{class:"summary-label"},"Total Audits",-1)),(0,s.Lk)("div",iX,(0,d.v_)(o.totalAuditsData.total_current_month),1),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.totalAuditsData.is_positive_change,negative:!o.totalAuditsData.is_positive_change}])},(0,d.v_)(o.totalAuditsData.is_positive_change?"+":"-")+(0,d.v_)(Math.abs(o.totalAuditsData.change_in_total))+" this month ",3)])]),(0,s.Lk)("div",aX,[t[13]||(t[13]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-hourglass-half"})],-1)),(0,s.Lk)("div",sX,[t[12]||(t[12]=(0,s.Lk)("div",{class:"summary-label"},"Open Audits",-1)),(0,s.Lk)("div",oX,(0,d.v_)(o.openAuditsData.open_this_week),1),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.openAuditsData.is_improvement,negative:!o.openAuditsData.is_improvement}])},(0,d.v_)(o.openAuditsData.is_improvement?"+":"-")+(0,d.v_)(Math.abs(o.openAuditsData.change_in_open))+" since last week ",3)])]),(0,s.Lk)("div",lX,[t[15]||(t[15]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",nX,[t[14]||(t[14]=(0,s.Lk)("div",{class:"summary-label"},"Completed Audits",-1)),(0,s.Lk)("div",rX,(0,d.v_)(o.completedAuditsData.this_week_count),1),(0,s.Lk)("div",{class:(0,d.C4)(["summary-trend",{positive:o.completedAuditsData.is_improvement,negative:!o.completedAuditsData.is_improvement}])},(0,d.v_)(o.completedAuditsData.is_improvement?"+":"")+(0,d.v_)(o.completedAuditsData.change_in_completed)+" this week ",3)])])]),(0,s.Lk)("div",cX,[(0,s.Lk)("div",dX,[(0,s.Lk)("div",uX,[(0,s.Lk)("div",pX,[t[18]||(t[18]=(0,s.Lk)("span",{class:"chart-title"},"Audit performance",-1)),(0,s.Lk)("div",mX,[(0,s.Lk)("div",vX,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.selectedXAxis=e),class:"axis-select",disabled:o.isLoading},t[16]||(t[16]=[(0,s.Lk)("option",{value:"time"},"Time",-1),(0,s.Lk)("option",{value:"frameworks"},"Frameworks",-1),(0,s.Lk)("option",{value:"categories"},"Categories",-1),(0,s.Lk)("option",{value:"status"},"Status",-1)]),8,kX),[[a.u1,o.selectedXAxis]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.selectedYAxis=e),class:"axis-select",disabled:o.isLoading},t[17]||(t[17]=[(0,s.Lk)("option",{value:"completion"},"Performance",-1),(0,s.Lk)("option",{value:"compliance"},"Compliance Rate",-1),(0,s.Lk)("option",{value:"findings"},"Finding Count",-1)]),8,hX),[[a.u1,o.selectedYAxis]])]),(0,s.Lk)("div",gX,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.chartTypes,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.type,class:(0,d.C4)(["chart-tab-btn",{active:o.activeChart===e.type}]),onClick:t=>o.activeChart=e.type,title:e.label,disabled:o.isLoading},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon)},null,2)],10,yX))),128))])])]),(0,s.Lk)("div",fX,[o.isLoading?((0,s.uX)(),(0,s.CE)("div",bX,t[19]||(t[19]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading chart data...",-1)]))):"line"===o.activeChart?((0,s.uX)(),(0,s.Wv)(r,{key:1,data:o.lineChartData,options:o.lineChartOptions},null,8,["data","options"])):"bar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:2,data:o.barChartData,options:o.barChartOptions},null,8,["data","options"])):"doughnut"===o.activeChart?((0,s.uX)(),(0,s.Wv)(u,{key:3,data:o.donutChartData,options:o.donutChartOptions},null,8,["data","options"])):"horizontalBar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:4,data:o.horizontalBarChartData,options:o.horizontalBarChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",CX,[(0,s.Lk)("div",LX,[(0,s.Lk)("div",wX,[t[20]||(t[20]=(0,s.Lk)("h3",null,"Recent Audit Activity",-1)),(0,s.Lk)("button",{class:"card-action",onClick:t[3]||(t[3]=(...e)=>o.fetchRecentActivities&&o.fetchRecentActivities(...e))},[(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-sync-alt",{"fa-spin":o.isLoadingActivities}])},null,2)])]),o.isLoadingActivities&&o.isEmpty(o.recentActivities)?((0,s.uX)(),(0,s.CE)("div",EX,t[21]||(t[21]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading activities...",-1)]))):o.isEmpty(o.filteredActivities)?((0,s.uX)(),(0,s.CE)("div",RX,t[22]||(t[22]=[(0,s.Lk)("p",null,"No recent activities found",-1)]))):((0,s.uX)(),(0,s.CE)("div",IX,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredActivities,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"activity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["activity-icon",o.getActivityIconClass(e.type)])},[(0,s.Lk)("i",{class:(0,d.C4)(o.getActivityIcon(e.type))},null,2)],2),(0,s.Lk)("div",DX,[(0,s.Lk)("div",PX,(0,d.v_)(e.title||"Activity"),1),(0,s.Lk)("div",_X,(0,d.v_)(e.description||"No description available"),1),(0,s.Lk)("div",AX,(0,d.v_)(e.time_ago||"Recently"),1)])]))),128))]))])])])])}Ze.t1.register(Ze.Bs,Ze.E8,Ze.PP,Ze.kc,Ze.FN,Ze.No,Ze.m_,Ze.s$);var TX={name:"AuditorDashboard",components:{Doughnut:et.nu,Bar:et.yP,LineChart:et.N1},setup(){const e=(0,ie.KR)(!1),t=(0,ie.KR)(!1),i=(0,ie.Kh)({current_month_rate:0,previous_month_rate:0,change_in_rate:0,is_positive_change:!0}),a=(0,ie.Kh)({total_current_month:0,total_previous_month:0,change_in_total:0,is_positive_change:!0}),o=(0,ie.Kh)({open_this_week:0,open_last_week:0,change_in_open:0,percent_change:0,is_improvement:!0}),l=(0,ie.Kh)({this_week_count:0,last_week_count:0,change_in_completed:0,percent_change:0,is_improvement:!0}),n=(0,ie.Kh)({completion_trend:[],compliance_trend:[],finding_trend:[],framework_performance:[],category_performance:[],status_distribution:{}}),r=(0,ie.KR)([]),c=async()=>{try{const e=await He.A.get("/api/dashboard/audit-completion-rate/");e.data&&(i.current_month_rate=e.data.current_month_rate,i.previous_month_rate=e.data.previous_month_rate,i.change_in_rate=e.data.change_in_rate,i.is_positive_change=e.data.is_positive_change)}catch(e){if(console.error("Error fetching audit completion rate:",e),Tr.wr.handleApiError(e,"audit completion rate access"))return}},d=async()=>{try{const e=await He.A.get("/api/dashboard/total-audits/");e.data&&(a.total_current_month=e.data.total_current_month,a.total_previous_month=e.data.total_previous_month,a.change_in_total=e.data.change_in_total,a.is_positive_change=e.data.is_positive_change)}catch(e){if(console.error("Error fetching total audits:",e),Tr.wr.handleApiError(e,"audit total audits access"))return}},u=async()=>{try{const e=await He.A.get("/api/dashboard/open-audits/");e.data&&(o.open_this_week=e.data.open_this_week,o.open_last_week=e.data.open_last_week,o.change_in_open=e.data.change_in_open,o.percent_change=e.data.percent_change,o.is_improvement=e.data.is_improvement)}catch(e){if(console.error("Error fetching open audits:",e),Tr.wr.handleApiError(e,"audit open audits access"))return}},p=async()=>{try{const e=await He.A.get("/api/dashboard/completed-audits/");e.data&&(l.this_week_count=e.data.this_week_count,l.last_week_count=e.data.last_week_count,l.change_in_completed=e.data.change_in_completed,l.percent_change=e.data.percent_change,l.is_improvement=e.data.is_improvement)}catch(e){if(console.error("Error fetching completed audits:",e),Tr.wr.handleApiError(e,"audit completed audits access"))return}},m=async()=>{y(h.value,g.value);try{try{const e=await He.A.get("/api/dashboard/audit-completion-trend/");e.data&&(n.completion_trend=e.data)}catch(e){console.error("Error fetching completion trend data:",e)}try{const e=await He.A.get("/api/dashboard/audit-compliance-trend/");e.data&&(n.compliance_trend=e.data)}catch(e){console.error("Error fetching compliance trend data:",e)}try{const e=await He.A.get("/api/dashboard/audit-finding-trend/");e.data&&(n.finding_trend=e.data)}catch(e){console.error("Error fetching finding trend data:",e)}try{const e=await He.A.get("/api/dashboard/framework-performance/");e.data&&(n.framework_performance=e.data)}catch(e){console.error("Error fetching framework performance data:",e)}try{const e=await He.A.get("/api/dashboard/category-performance/");e.data&&(n.category_performance=e.data)}catch(e){console.error("Error fetching category performance data:",e)}try{const e=await He.A.get("/api/dashboard/status-distribution/");e.data&&(n.status_distribution=e.data)}catch(e){console.error("Error fetching status distribution data:",e)}}catch(e){console.error("Error fetching chart data:",e)}finally{y(h.value,g.value)}},v=async()=>{t.value=!0;try{const e=await He.A.get("/api/dashboard/recent-audit-activities/");e.data?r.value=e.data:r.value=[]}catch(e){console.error("Error fetching recent activities:",e),r.value=[{type:"completed",audit_id:0,title:"Sample Activity",description:"Recent activities will appear here",time_ago:"Recently"},{type:"review",audit_id:0,title:"Review Activity",description:"Sample review activity",time_ago:"Recently"},{type:"due",audit_id:0,title:"Due Date Approaching",description:"Sample upcoming deadline",time_ago:"Soon"}]}finally{t.value=!1}},k=async()=>{e.value=!0;try{await Promise.all([c(),d(),u(),p(),m(),v()])}catch(t){console.error("Error refreshing dashboard data:",t)}finally{e.value=!1}};(0,s.sV)(()=>{k()});const h=(0,ie.KR)("time"),g=(0,ie.KR)("completion");(0,s.wB)([h,g],([t,i])=>{e.value=!0,setTimeout(()=>{y(t,i),e.value=!1},300)});const y=(e,t)=>{const{labels:i,datasets:a}=f(e,t);w.labels=i,w.datasets=[{label:b(t),data:a[0].data,fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}],D.labels=i,a.length>1?D.datasets=a.map(e=>({...e,stack:"Stack 0",borderRadius:4})):D.datasets=[{label:b(t),data:a[0].data,backgroundColor:a[0].backgroundColor||"#4ade80",borderRadius:4}],R.labels=i;const s=a[0].multipleColors||["#4ade80","#fbbf24","#f87171","#60a5fa","#a78bfa","#c084fc","#f472b6","#fb7185","#34d399","#38bdf8"];R.datasets=[{data:a[0].data,backgroundColor:Array.isArray(a[0].backgroundColor)?a[0].backgroundColor:a[0].data.map((e,t)=>s[t%s.length]),borderWidth:0,hoverOffset:5}],_.labels=i,"status"===e||1===a.length?_.datasets=[{label:b(t),data:a[0].data,backgroundColor:Array.isArray(a[0].backgroundColor)?a[0].backgroundColor:a[0].data.map((e,t)=>s[t%s.length]),borderRadius:6,barPercentage:.5,categoryPercentage:.7}]:_.datasets=a.map(e=>({...e,borderRadius:6,barPercentage:.5,categoryPercentage:.7}))},f=(e,t)=>{let i=[],a=[];if("time"===e){if(i=n.completion_trend.length>0?n.completion_trend.map(e=>e.month):["Jan","Feb","Mar","Apr","May","Jun","Jul"],"completion"===t){const e=n.completion_trend.length>0?n.completion_trend.map(e=>e.completion_rate):[65,70,75,78,82,85,88];a=[{label:"Completion Rate",data:e,backgroundColor:"#4ade80"}]}else if("compliance"===t){const e=n.compliance_trend.length>0?n.compliance_trend.map(e=>e.compliance_rate):[92,90,88,86,89,91,93];a=[{label:"Compliance Rate",data:e,backgroundColor:"#60a5fa"}]}else if("findings"===t){const e=n.finding_trend.length>0?n.finding_trend.map(e=>e.major_findings):[5,4,6,8,6,5,6],t=n.finding_trend.length>0?n.finding_trend.map(e=>e.minor_findings):[10,8,12,14,10,9,11];a=[{label:"Major Findings",data:e,backgroundColor:"#f87171"},{label:"Minor Findings",data:t,backgroundColor:"#fbbf24"}]}}else if("frameworks"===e){const e=n.framework_performance.length>0?n.framework_performance:[{framework:"ISO 27001",framework_id:1,completion_rate:65,completed:12,in_progress:3,yet_to_start:2},{framework:"NIST 800-53",framework_id:2,completion_rate:70,completed:10,in_progress:4,yet_to_start:1},{framework:"GDPR",framework_id:3,completion_rate:75,completed:8,in_progress:6,yet_to_start:2},{framework:"PCI DSS",framework_id:4,completion_rate:82,completed:14,in_progress:2,yet_to_start:1},{framework:"HIPAA",framework_id:5,completion_rate:78,completed:9,in_progress:5,yet_to_start:3}];if(i=e.map(e=>e.framework),"completion"===t){const t=e.map(e=>e.completion_rate),i=["#4ade80","#60a5fa","#fbbf24","#f87171","#a78bfa","#c084fc","#f472b6"];a=[{label:"Completion Rate",data:t,backgroundColor:"#4ade80",borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",multipleColors:i}]}else"compliance"!==t&&"findings"!==t||(a=[{label:"Completed",data:e.map(e=>e.completed),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"In Progress",data:e.map(e=>e.in_progress),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4},{label:"Yet To Start",data:e.map(e=>e.yet_to_start),backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4}])}else if("categories"===e){const e=n.category_performance.length>0?n.category_performance:[{category:"Information Security",completion_rate:86,total:25,completed:21},{category:"Data Protection",completion_rate:92,total:18,completed:16},{category:"Risk Assessment",completion_rate:78,total:15,completed:12},{category:"Access Control",completion_rate:84,total:20,completed:17},{category:"Change Management",completion_rate:73,total:12,completed:9}];i=e.map(e=>e.category);const s=["#4ade80","#60a5fa","#fbbf24","#f87171","#a78bfa","#c084fc","#f472b6"];if("completion"===t||"compliance"===t){const t=e.map(e=>e.completion_rate);a=[{label:"Completion Rate",data:t,backgroundColor:"#4ade80",borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",multipleColors:s}]}else"findings"===t&&(a=[{label:"Completed",data:e.map(e=>e.completed),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Remaining",data:e.map(e=>e.total-e.completed),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4}])}else if("status"===e){const e=Object.keys(n.status_distribution).length>0?n.status_distribution:{completed:53,in_progress:32,yet_to_start:15,completed_percent:53,in_progress_percent:32,yet_to_start_percent:15};i=["Completed","In Progress","Yet To Start"];const t=[e.completed_percent||0,e.in_progress_percent||0,e.yet_to_start_percent||0];a=[{label:"Distribution",data:t,backgroundColor:["#4ade80","#fbbf24","#f87171"]}]}return{labels:i,datasets:a}},b=e=>{switch(e){case"completion":return"Completion Rate";case"compliance":return"Compliance Rate";case"findings":return"Finding Count";default:return"Value"}},C=[{type:"line",icon:"fas fa-chart-line",label:"Line"},{type:"bar",icon:"fas fa-chart-bar",label:"Bar"},{type:"doughnut",icon:"fas fa-dot-circle",label:"Donut"},{type:"horizontalBar",icon:"fas fa-align-left",label:"Horizontal Bar"}],L=(0,ie.KR)("line"),w=(0,ie.Kh)({labels:["Jan","Feb","Mar","Apr","May","Jun","Jul"],datasets:[{label:"Audit Completion Rate",data:[65,70,75,78,82,85,88],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}),E={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:11}}},x:{grid:{display:!1},ticks:{font:{size:11},maxRotation:45,minRotation:0}}},animation:{duration:1500,easing:"easeOutQuart"}},R=(0,ie.Kh)({labels:["Completed","In Progress","Yet To Start"],datasets:[{data:[53,32,15],backgroundColor:["#4ade80","#fbbf24","#f87171"],borderWidth:0,hoverOffset:5}]}),I={cutout:"70%",plugins:{legend:{display:!0,position:"right",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeOutCubic"}},D=(0,ie.Kh)({labels:["ISO 27001","NIST 800-53"],datasets:[{label:"Completed",data:[12,10],backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"In Progress",data:[3,4],backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4},{label:"Yet To Start",data:[2,1],backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4}]}),P={plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#222",font:{size:10},maxRotation:45,minRotation:0}},y:{stacked:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}},beginAtZero:!0}},animation:{duration:1e3,easing:"easeInOutQuart"}},_=(0,ie.Kh)({labels:["Information Security","Data Protection","Risk Assessment","Access Control","Change Management"],datasets:[{label:"Completion Rate (%)",data:[86,92,78,84,73],backgroundColor:"#4ade80",borderRadius:6,barPercentage:.5,categoryPercentage:.7}]}),A={indexAxis:"y",plugins:{legend:{display:!0,position:"top",labels:{boxWidth:12,usePointStyle:!0,font:{size:11}}},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",borderColor:"#e2e8f0",borderWidth:1,padding:10,boxPadding:4,bodyFont:{size:12},titleFont:{size:13,weight:"bold"}}},scales:{x:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:10}},stacked:!0},y:{grid:{display:!1},ticks:{color:"#222",font:{size:10}},stacked:!0}},maintainAspectRatio:!1,animation:{duration:1e3,easing:"easeInOutQuart"}},S=e=>{switch(e){case"completed":return"fas fa-check-circle";case"review":return"fas fa-sync-alt";case"due":return"fas fa-exclamation-circle";default:return"fas fa-info-circle"}},T=e=>{switch(e){case"completed":return"";case"review":return"update";case"due":return"alert";default:return""}},x=e=>!e||!Array.isArray(e)||0===e.length,F=(0,s.EW)(()=>r.value&&Array.isArray(r.value)?r.value.filter(e=>null!==e&&void 0!==e):[]);return{isLoading:e,isLoadingActivities:t,auditCompletionData:i,totalAuditsData:a,openAuditsData:o,completedAuditsData:l,chartData:n,recentActivities:r,refreshData:k,fetchRecentActivities:v,getActivityIcon:S,getActivityIconClass:T,isEmpty:x,lineChartData:w,lineChartOptions:E,donutChartData:R,donutChartOptions:I,barChartData:D,barChartOptions:P,horizontalBarChartData:_,horizontalBarChartOptions:A,chartTypes:C,activeChart:L,selectedXAxis:h,selectedYAxis:g,filteredActivities:F}}};const xX=(0,le.A)(TX,[["render",SX],["__scopeId","data-v-4e61a38d"]]);var FX=xX;const VX={class:"upload-framework-container"},UX={class:"step-indicator"},NX={key:0,class:"back-button-container"},MX={class:"upload-section"},XX={key:1,class:"or-divider"},$X={key:2,class:"default-data-section"},OX={class:"default-data-content"},jX=["disabled"],BX={key:3,class:"file-preview"},WX={class:"file-info"},qX={class:"file-details"},QX={class:"upload-actions"},KX=["disabled"],JX={key:4,class:"processing-section"},zX={class:"processing-header"},HX={class:"processing-animation-container"},GX={class:"document-processing-visual"},YX={class:"extraction-particles"},ZX={class:"processing-details-enhanced"},e$={class:"main-status"},t$={class:"document-info"},i$={key:0,class:"current-section"},a$={class:"section-indicator"},s$={class:"processing-stages"},o$={class:"processing-activity"},l$={class:"activity-dots"},n$={class:"progress-container"},r$={class:"progress-bar"},c$={class:"progress-text"},d$={class:"processing-details"},u$={class:"detail-item"},p$={class:"detail-item"},m$={key:5,class:"completion-section"},v$={class:"completion-actions"},k$={key:6,class:"extraction-section"},h$={class:"extraction-header"},g$={class:"ai-extraction-container"},y$={class:"ai-brain-visual"},f$={class:"neural-network"},b$={class:"data-flow"},C$={class:"ai-processing-details"},L$={class:"main-status"},w$={class:"ai-stages"},E$={class:"progress-container"},R$={class:"progress-bar"},I$={class:"progress-text"},D$={key:7,class:"policy-review-section"},P$={class:"policy-summary"},_$={class:"summary-card"},A$={class:"summary-content"},S$={class:"summary-card"},T$={class:"summary-content"},x$={class:"review-actions"},F$={key:8,class:"policy-details-section"},V$={class:"professional-layout"},U$={class:"info-section framework-section"},N$={class:"form-grid"},M$={class:"form-field"},X$={class:"form-field"},$$={class:"form-field full-width"},O$={class:"form-field"},j$={class:"form-field"},B$={class:"form-field"},W$={class:"info-section policy-section"},q$={class:"section-title"},Q$={class:"form-grid"},K$={class:"form-field"},J$=["onUpdate:modelValue"],z$={class:"form-field"},H$=["onUpdate:modelValue"],G$={class:"form-field"},Y$=["onUpdate:modelValue"],Z$={class:"form-field"},eO=["onUpdate:modelValue"],tO={class:"form-field"},iO=["onUpdate:modelValue","placeholder"],aO={class:"form-field"},sO=["onUpdate:modelValue"],oO={class:"form-field"},lO=["onUpdate:modelValue"],nO={class:"form-field"},rO=["onUpdate:modelValue"],cO={class:"form-field full-width"},dO=["onUpdate:modelValue"],uO={class:"form-field"},pO=["onUpdate:modelValue"],mO={class:"section-title"},vO={class:"section-badge"},kO={class:"form-grid"},hO={class:"form-field"},gO=["onUpdate:modelValue"],yO={class:"form-field"},fO=["onUpdate:modelValue"],bO={class:"form-field full-width"},CO=["onUpdate:modelValue"],LO={class:"form-field"},wO=["onUpdate:modelValue"],EO={class:"form-field"},RO=["onUpdate:modelValue"],IO={class:"form-field full-width"},DO=["onUpdate:modelValue"],PO={class:"form-field"},_O=["onUpdate:modelValue"],AO={class:"form-field"},SO=["onUpdate:modelValue"],TO={class:"form-field"},xO=["onUpdate:modelValue"],FO={class:"form-field"},VO=["onUpdate:modelValue"],UO={class:"form-field"},NO=["onUpdate:modelValue"],MO={class:"form-field"},XO={class:"file-upload-wrapper"},$O=["id","onChange"],OO=["for"],jO={key:0,class:"file-name"},BO={class:"compliance-header"},WO={class:"compliance-title"},qO={class:"policy-ref"},QO={class:"compliance-stats"},KO={class:"compliance-count"},JO=["onClick"],zO={key:0,class:"compliance-grid"},HO={class:"compliance-card-header"},GO={class:"compliance-identifier"},YO={class:"compliance-letter"},ZO={class:"compliance-number"},ej={class:"compliance-actions"},tj=["onClick"],ij={class:"compliance-form-grid"},aj={class:"form-field"},sj=["onUpdate:modelValue"],oj={class:"form-field"},lj=["onUpdate:modelValue"],nj={class:"form-field full-width"},rj=["onUpdate:modelValue"],cj={class:"form-field"},dj=["onUpdate:modelValue"],uj={class:"form-field"},pj=["onUpdate:modelValue"],mj={class:"form-field full-width"},vj={class:"file-upload-wrapper"},kj=["id","onChange"],hj=["for"],gj={key:0,class:"file-name"},yj={class:"global-actions"},fj={key:10,class:"congratulations-modal"},bj={class:"congratulations-container"},Cj={class:"congratulations-actions"},Lj={key:11,class:"global-notification success"},wj={class:"notification-content"},Ej={class:"notification-message"},Rj={key:12,class:"content-viewer-modal"},Ij={class:"content-viewer-container"},Dj={class:"content-viewer-header"},Pj={class:"content-viewer-body"},_j={class:"search-box"},Aj={class:"section-list"},Sj=["onClick"],Tj={class:"section-checkbox"},xj=["onUpdate:modelValue","onChange"],Fj={key:0,class:"section-content"},Vj={class:"subsection-checkbox"},Uj=["onUpdate:modelValue","onChange"],Nj={class:"content-viewer-footer"},Mj={key:13,class:"policy-extractor-modal"},Xj={class:"policy-extractor-container"},$j={class:"policy-extractor-header"},Oj={class:"policy-actions"},jj={class:"policy-extractor-body"},Bj={class:"policy-table-container"},Wj={key:0,class:"policy-table"},qj={class:"control-cell"},Qj={class:"actions-cell"},Kj=["onClick"],Jj=["onClick"],zj={key:0,class:"detail-row"},Hj={colspan:"5"},Gj={class:"policy-details-container"},Yj={class:"policy-details-section"},Zj={class:"detail-content"},eB={class:"policy-details-section"},tB={class:"detail-content"},iB={class:"policy-details-section"},aB={class:"detail-content control-content"},sB={key:0},oB={key:1},lB={class:"policy-details-section"},nB={class:"detail-content"},rB={class:"policy-details-section"},cB={class:"detail-content"},dB={key:1,class:"no-policies-message"},uB={key:14,class:"policy-edit-modal"},pB={class:"policy-edit-container"},mB={class:"policy-edit-header"},vB={class:"policy-edit-actions"},kB={class:"policy-edit-body"},hB={class:"policy-field"},gB={class:"policy-field"},yB={class:"policy-field"},fB={class:"policy-field"},bB={class:"policy-field"},CB={class:"policy-field"};function LB(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",VX,[(0,s.Lk)("div",UX,[(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:1===o.currentStep,completed:o.currentStep>1}])},t[37]||(t[37]=[(0,s.Lk)("div",{class:"step-number"},"1",-1),(0,s.Lk)("div",{class:"step-label"},"Upload Document",-1)]),2),t[43]||(t[43]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:2===o.currentStep,completed:o.currentStep>2}])},t[38]||(t[38]=[(0,s.Lk)("div",{class:"step-number"},"2",-1),(0,s.Lk)("div",{class:"step-label"},"Processing",-1)]),2),t[44]||(t[44]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:3===o.currentStep,completed:o.currentStep>3}])},t[39]||(t[39]=[(0,s.Lk)("div",{class:"step-number"},"3",-1),(0,s.Lk)("div",{class:"step-label"},"Content Selection",-1)]),2),t[45]||(t[45]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:4===o.currentStep,completed:o.currentStep>4}])},t[40]||(t[40]=[(0,s.Lk)("div",{class:"step-number"},"4",-1),(0,s.Lk)("div",{class:"step-label"},"Policy Extraction",-1)]),2),t[46]||(t[46]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:5===o.currentStep,completed:o.currentStep>5}])},t[41]||(t[41]=[(0,s.Lk)("div",{class:"step-number"},"5",-1),(0,s.Lk)("div",{class:"step-label"},"Review Policies",-1)]),2),t[47]||(t[47]=(0,s.Lk)("div",{class:"step-divider"},null,-1)),(0,s.Lk)("div",{class:(0,d.C4)(["step-item",{active:6===o.currentStep,completed:o.currentStep>6}])},t[42]||(t[42]=[(0,s.Lk)("div",{class:"step-number"},"6",-1),(0,s.Lk)("div",{class:"step-label"},"Edit Policy Details",-1)]),2)]),o.currentStep>1&&!o.isProcessing?((0,s.uX)(),(0,s.CE)("div",NX,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>o.goBack&&o.goBack(...e)),class:"back-btn"},t[48]||(t[48]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])):(0,s.Q3)("",!0),t[158]||(t[158]=(0,s.Lk)("div",{class:"header"},[(0,s.Lk)("h1",null,"Upload Framework"),(0,s.Lk)("p",null,"Upload framework documents to the system")],-1)),(0,s.Lk)("div",MX,[1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["upload-area",{"drag-over":o.isDragOver}]),onDrop:t[2]||(t[2]=(...e)=>o.handleDrop&&o.handleDrop(...e)),onDragover:t[3]||(t[3]=(0,a.D$)(e=>o.isDragOver=!0,["prevent"])),onDragleave:t[4]||(t[4]=e=>o.isDragOver=!1),onClick:t[5]||(t[5]=(...e)=>o.triggerFileInput&&o.triggerFileInput(...e))},[t[49]||(t[49]=(0,s.Lk)("div",{class:"upload-content"},[(0,s.Lk)("div",{class:"upload-icon-container"},[(0,s.Lk)("i",{class:"fas fa-cloud-upload-alt upload-icon"})]),(0,s.Lk)("h3",null,"Drag & Drop your framework file here"),(0,s.Lk)("p",null,"or click to browse files"),(0,s.Lk)("div",{class:"supported-formats"},[(0,s.Lk)("small",null,"Supported formats: PDF, DOC, DOCX, TXT, XLS, XLSX")])],-1)),(0,s.Lk)("input",{ref:"fileInput",type:"file",onChange:t[1]||(t[1]=(...e)=>o.handleFileSelect&&o.handleFileSelect(...e)),accept:".pdf,.doc,.docx,.txt,.xls,.xlsx",style:{display:"none"}},null,544)],34)):(0,s.Q3)("",!0),1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",XX,t[50]||(t[50]=[(0,s.Lk)("div",{class:"divider-line"},null,-1),(0,s.Lk)("span",{class:"divider-text"},"OR",-1),(0,s.Lk)("div",{class:"divider-line"},null,-1)]))):(0,s.Q3)("",!0),1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",$X,[(0,s.Lk)("div",OX,[t[52]||(t[52]=(0,s.Lk)("div",{class:"default-icon-container"},[(0,s.Lk)("i",{class:"fas fa-database default-icon"})],-1)),t[53]||(t[53]=(0,s.Lk)("h3",null,"Load Default Framework Data",-1)),t[54]||(t[54]=(0,s.Lk)("p",null,"Use pre-loaded NIST framework data for quick testing",-1)),(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>o.loadDefaultData&&o.loadDefaultData(...e)),disabled:o.isLoadingDefault,class:"load-default-btn"},[t[51]||(t[51]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.isLoadingDefault?"Loading Default Data...":"Load Default Data"),1)],8,jX)])])):(0,s.Q3)("",!0),o.selectedFile&&1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",BX,[(0,s.Lk)("div",WX,[t[56]||(t[56]=(0,s.Lk)("div",{class:"file-icon-container"},[(0,s.Lk)("i",{class:"fas fa-file file-icon"})],-1)),(0,s.Lk)("div",qX,[(0,s.Lk)("h4",null,(0,d.v_)(o.selectedFile.name),1),(0,s.Lk)("p",null,(0,d.v_)(o.formatFileSize(o.selectedFile.size)),1)]),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>o.removeFile&&o.removeFile(...e)),class:"remove-btn"},t[55]||(t[55]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",QX,[(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>o.uploadFile&&o.uploadFile(...e)),disabled:!o.selectedFile||o.isUploading,class:"upload-btn"},[t[57]||(t[57]=(0,s.Lk)("i",{class:"fas fa-upload"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.isUploading?"Uploading...":"Upload Framework"),1)],8,KX)])])):(0,s.Q3)("",!0),2===o.currentStep?((0,s.uX)(),(0,s.CE)("div",JX,[(0,s.Lk)("div",zX,[(0,s.Lk)("div",HX,[(0,s.Lk)("div",GX,[t[58]||(t[58]=(0,s.Fv)('<div class="document-icon" data-v-bbfad2e8><i class="fas fa-file-pdf" data-v-bbfad2e8></i></div><div class="processing-waves" data-v-bbfad2e8><div class="wave wave-1" data-v-bbfad2e8></div><div class="wave wave-2" data-v-bbfad2e8></div><div class="wave wave-3" data-v-bbfad2e8></div></div>',2)),(0,s.Lk)("div",YX,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(6,e=>(0,s.Lk)("div",{class:"particle",key:e})),64))])])]),t[66]||(t[66]=(0,s.Lk)("h3",null,"Processing Framework Document",-1)),(0,s.Lk)("div",ZX,[(0,s.Lk)("p",e$,(0,d.v_)(o.processingStatus.message||"Extracting document sections..."),1),(0,s.Lk)("div",t$,[t[59]||(t[59]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.Lk)("span",null,"Analyzing: "+(0,d.v_)(o.uploadedFileName),1)]),o.processingStatus.currentSection?((0,s.uX)(),(0,s.CE)("div",i$,[(0,s.Lk)("div",a$,[t[60]||(t[60]=(0,s.Lk)("i",{class:"fas fa-cog fa-spin"},null,-1)),(0,s.Lk)("span",null,"Processing: "+(0,d.v_)(o.processingStatus.currentSection),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",s$,[(0,s.Lk)("div",{class:(0,d.C4)(["stage",{active:o.processingStatus.progress>=20}])},t[61]||(t[61]=[(0,s.Lk)("div",{class:"stage-dot"},null,-1),(0,s.Lk)("span",null,"Text Extraction",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["stage",{active:o.processingStatus.progress>=40}])},t[62]||(t[62]=[(0,s.Lk)("div",{class:"stage-dot"},null,-1),(0,s.Lk)("span",null,"Structure Analysis",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["stage",{active:o.processingStatus.progress>=60}])},t[63]||(t[63]=[(0,s.Lk)("div",{class:"stage-dot"},null,-1),(0,s.Lk)("span",null,"Section Identification",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["stage",{active:o.processingStatus.progress>=80}])},t[64]||(t[64]=[(0,s.Lk)("div",{class:"stage-dot"},null,-1),(0,s.Lk)("span",null,"Content Organization",-1)]),2)]),(0,s.Lk)("div",o$,[(0,s.Lk)("div",l$,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(3,e=>(0,s.Lk)("div",{class:"dot",key:e})),64))]),t[65]||(t[65]=(0,s.Lk)("span",null,"Processing framework sections",-1))])])]),(0,s.Lk)("div",n$,[(0,s.Lk)("div",r$,[(0,s.Lk)("div",{class:"progress-fill",style:(0,d.Tr)({width:o.processingStatus.progress+"%"})},null,4)]),(0,s.Lk)("div",c$,(0,d.v_)(o.processingStatus.progress||0)+"%",1)]),(0,s.Lk)("div",d$,[(0,s.Lk)("div",u$,[t[67]||(t[67]=(0,s.Lk)("i",{class:"fas fa-file-pdf"},null,-1)),(0,s.Lk)("span",null,"File: "+(0,d.v_)(o.uploadedFileName),1)]),(0,s.Lk)("div",p$,[t[68]||(t[68]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.Lk)("span",null,"Started: "+(0,d.v_)(o.processingStartTime),1)])])])):(0,s.Q3)("",!0),3===o.currentStep?((0,s.uX)(),(0,s.CE)("div",m$,[t[70]||(t[70]=(0,s.Lk)("div",{class:"completion-icon-container"},[(0,s.Lk)("div",{class:"success-circle"},[(0,s.Lk)("i",{class:"fas fa-check"})])],-1)),t[71]||(t[71]=(0,s.Lk)("div",{class:"completion-header"},[(0,s.Lk)("h3",null,"Processing Complete!"),(0,s.Lk)("p",null,"Your framework document has been successfully processed and extracted.")],-1)),(0,s.Lk)("div",v$,[(0,s.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>o.viewExtractedContent&&o.viewExtractedContent(...e)),class:"view-content-btn"},t[69]||(t[69]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View Extracted Content ")]))])])):(0,s.Q3)("",!0),4===o.currentStep?((0,s.uX)(),(0,s.CE)("div",k$,[(0,s.Lk)("div",h$,[(0,s.Lk)("div",g$,[(0,s.Lk)("div",y$,[t[72]||(t[72]=(0,s.Lk)("div",{class:"brain-core"},[(0,s.Lk)("i",{class:"fas fa-brain"})],-1)),(0,s.Lk)("div",f$,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(8,e=>(0,s.Lk)("div",{class:"neuron",key:e})),64))]),(0,s.Lk)("div",b$,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(12,e=>(0,s.Lk)("div",{class:"data-bit",key:e})),64))])])]),t[77]||(t[77]=(0,s.Lk)("h3",null,"AI Policy Extraction",-1)),(0,s.Lk)("div",C$,[(0,s.Lk)("p",L$,(0,d.v_)(o.policyExtractionMessage),1),(0,s.Lk)("div",w$,[(0,s.Lk)("div",{class:(0,d.C4)(["ai-stage",{active:o.policyExtractionProgress>=25}])},t[73]||(t[73]=[(0,s.Lk)("div",{class:"ai-stage-icon"},[(0,s.Lk)("i",{class:"fas fa-search"})],-1),(0,s.Lk)("span",null,"Analyzing Content",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["ai-stage",{active:o.policyExtractionProgress>=50}])},t[74]||(t[74]=[(0,s.Lk)("div",{class:"ai-stage-icon"},[(0,s.Lk)("i",{class:"fas fa-robot"})],-1),(0,s.Lk)("span",null,"AI Processing",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["ai-stage",{active:o.policyExtractionProgress>=75}])},t[75]||(t[75]=[(0,s.Lk)("div",{class:"ai-stage-icon"},[(0,s.Lk)("i",{class:"fas fa-filter"})],-1),(0,s.Lk)("span",null,"Policy Extraction",-1)]),2),(0,s.Lk)("div",{class:(0,d.C4)(["ai-stage",{active:o.policyExtractionProgress>=100}])},t[76]||(t[76]=[(0,s.Lk)("div",{class:"ai-stage-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1),(0,s.Lk)("span",null,"Validation",-1)]),2)])])]),(0,s.Lk)("div",E$,[(0,s.Lk)("div",R$,[(0,s.Lk)("div",{class:"progress-fill",style:(0,d.Tr)({width:o.policyExtractionProgress+"%"})},null,4)]),(0,s.Lk)("div",I$,(0,d.v_)(o.policyExtractionProgress||0)+"%",1)]),t[78]||(t[78]=(0,s.Fv)('<div class="extraction-details" data-v-bbfad2e8><div class="detail-item" data-v-bbfad2e8><i class="fas fa-file-alt" data-v-bbfad2e8></i><span data-v-bbfad2e8>Analyzing selected sections...</span></div><div class="detail-item" data-v-bbfad2e8><i class="fas fa-robot" data-v-bbfad2e8></i><span data-v-bbfad2e8>AI Processing in progress</span></div></div>',1))])):(0,s.Q3)("",!0),5===o.currentStep?((0,s.uX)(),(0,s.CE)("div",D$,[t[85]||(t[85]=(0,s.Lk)("div",{class:"review-header"},[(0,s.Lk)("div",{class:"review-icon-container"},[(0,s.Lk)("div",{class:"success-circle"},[(0,s.Lk)("i",{class:"fas fa-check"})])]),(0,s.Lk)("h3",null,"Policy Extraction Complete!"),(0,s.Lk)("p",null,"Your policies have been successfully extracted and are ready for review.")],-1)),(0,s.Lk)("div",P$,[(0,s.Lk)("div",_$,[t[80]||(t[80]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("div",A$,[(0,s.Lk)("h4",null,(0,d.v_)(o.extractedPoliciesCount),1),t[79]||(t[79]=(0,s.Lk)("p",null,"Policies Extracted",-1))])]),(0,s.Lk)("div",S$,[t[82]||(t[82]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-layer-group"})],-1)),(0,s.Lk)("div",T$,[(0,s.Lk)("h4",null,(0,d.v_)(o.selectedSectionsCount),1),t[81]||(t[81]=(0,s.Lk)("p",null,"Sections Processed",-1))])])]),(0,s.Lk)("div",x$,[(0,s.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>o.viewPolicyExtractor&&o.viewPolicyExtractor(...e)),class:"view-policies-btn"},t[83]||(t[83]=[(0,s.Lk)("i",{class:"fas fa-table"},null,-1),(0,s.eW)(" View Extracted Policies ")])),(0,s.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>o.resetUpload&&o.resetUpload(...e)),class:"upload-another-btn"},t[84]||(t[84]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Upload Another Document ")]))])])):(0,s.Q3)("",!0),6===o.currentStep?((0,s.uX)(),(0,s.CE)("div",F$,[t[131]||(t[131]=(0,s.Lk)("div",{class:"details-header"},[(0,s.Lk)("h3",null,"Framework & Policy Configuration"),(0,s.Lk)("p",null,"Configure framework details, policies, and compliance requirements")],-1)),(0,s.Lk)("div",V$,[(0,s.Lk)("div",U$,[t[92]||(t[92]=(0,s.Lk)("div",{class:"section-title"},[(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Framework Information")])],-1)),(0,s.Lk)("div",N$,[(0,s.Lk)("div",M$,[t[86]||(t[86]=(0,s.Lk)("label",null,"Framework Title",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>o.policyDetails.title=e),placeholder:"e.g., ISO 27001"},null,512),[[a.Jo,o.policyDetails.title]])]),(0,s.Lk)("div",X$,[t[87]||(t[87]=(0,s.Lk)("label",null,"Category",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>o.policyDetails.category=e),placeholder:"e.g., Security"},null,512),[[a.Jo,o.policyDetails.category]])]),(0,s.Lk)("div",$$,[t[88]||(t[88]=(0,s.Lk)("label",null,"Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[14]||(t[14]=e=>o.policyDetails.description=e),placeholder:"Information security, cyber security and privacy protection..."},null,512),[[a.Jo,o.policyDetails.description]])]),(0,s.Lk)("div",O$,[t[89]||(t[89]=(0,s.Lk)("label",null,"Effective Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[15]||(t[15]=e=>o.policyDetails.effectiveDate=e)},null,512),[[a.Jo,o.policyDetails.effectiveDate]])]),(0,s.Lk)("div",j$,[t[90]||(t[90]=(0,s.Lk)("label",null,"Start Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[16]||(t[16]=e=>o.policyDetails.startDate=e)},null,512),[[a.Jo,o.policyDetails.startDate]])]),(0,s.Lk)("div",B$,[t[91]||(t[91]=(0,s.Lk)("label",null,"End Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[17]||(t[17]=e=>o.policyDetails.endDate=e)},null,512),[[a.Jo,o.policyDetails.endDate]])])])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.uniqueSectionNames,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:"section-"+i,class:"policy-management-container"},[(0,s.Lk)("div",W$,[(0,s.Lk)("div",q$,[(0,s.Lk)("h4",null,[t[93]||(t[93]=(0,s.Lk)("i",{class:"fas fa-shield-alt"},null,-1)),(0,s.eW)(" Policy "+(0,d.v_)(i+1)+" - "+(0,d.v_)(e),1)])]),(0,s.Lk)("div",Q$,[(0,s.Lk)("div",K$,[t[94]||(t[94]=(0,s.Lk)("label",null,"Document URL",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].documentUrl=t,placeholder:"https://policy-document-url.com"},null,8,J$),[[a.Jo,o.policyFormData[e].documentUrl]])]),(0,s.Lk)("div",z$,[t[95]||(t[95]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].identifier=t,placeholder:"e.g., ISO"},null,8,H$),[[a.Jo,o.policyFormData[e].identifier]])]),(0,s.Lk)("div",G$,[t[96]||(t[96]=(0,s.Lk)("label",null,"Created By",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].createdBy=t,placeholder:"John Doe"},null,8,Y$),[[a.Jo,o.policyFormData[e].createdBy]])]),(0,s.Lk)("div",Z$,[t[97]||(t[97]=(0,s.Lk)("label",null,"Reviewer",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].reviewer=t,placeholder:"Jane Smith"},null,8,eO),[[a.Jo,o.policyFormData[e].reviewer]])]),(0,s.Lk)("div",tO,[t[98]||(t[98]=(0,s.Lk)("label",null,"Policy Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].policyName=t,placeholder:"Enter policy name for "+e},null,8,iO),[[a.Jo,o.policyFormData[e].policyName]])]),(0,s.Lk)("div",aO,[t[99]||(t[99]=(0,s.Lk)("label",null,"Department",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].department=t,placeholder:"Enter department"},null,8,sO),[[a.Jo,o.policyFormData[e].department]])]),(0,s.Lk)("div",oO,[t[100]||(t[100]=(0,s.Lk)("label",null,"Scope",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].scope=t,placeholder:"Enter policy scope"},null,8,lO),[[a.Jo,o.policyFormData[e].scope]])]),(0,s.Lk)("div",nO,[t[101]||(t[101]=(0,s.Lk)("label",null,"Applicability",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t=>o.policyFormData[e].applicability=t,placeholder:"Enter applicability"},null,8,rO),[[a.Jo,o.policyFormData[e].applicability]])]),(0,s.Lk)("div",cO,[t[102]||(t[102]=(0,s.Lk)("label",null,"Objective",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>o.policyFormData[e].objective=t,placeholder:"Enter policy objective"},null,8,dO),[[a.Jo,o.policyFormData[e].objective]])]),(0,s.Lk)("div",uO,[t[103]||(t[103]=(0,s.Lk)("label",null,"Coverage Rate (%)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>o.policyFormData[e].coverageRate=t,placeholder:"Enter coverage rate",min:"0",max:"100"},null,8,pO),[[a.Jo,o.policyFormData[e].coverageRate]])])])]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies.filter(t=>t.section_name===e),(i,l)=>((0,s.uX)(),(0,s.CE)("div",{key:"subpolicy-"+e+"-"+l,class:"info-section sub-policy-section"},[(0,s.Lk)("div",mO,[(0,s.Lk)("h4",null,[t[104]||(t[104]=(0,s.Lk)("i",{class:"fas fa-file-contract"},null,-1)),(0,s.eW)(" Sub-Policy "+(0,d.v_)(l+1)+" - "+(0,d.v_)(i.Sub_policy_id||"N/A"),1)]),(0,s.Lk)("span",vO,(0,d.v_)(e),1)]),(0,s.Lk)("div",kO,[(0,s.Lk)("div",hO,[t[105]||(t[105]=(0,s.Lk)("label",null,"Policy Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.sub_policy_name=e,placeholder:"Enter policy name"},null,8,gO),[[a.Jo,i.sub_policy_name]])]),(0,s.Lk)("div",yO,[t[106]||(t[106]=(0,s.Lk)("label",null,"Policy Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.Sub_policy_id=e,placeholder:"Enter policy identifier"},null,8,fO),[[a.Jo,i.Sub_policy_id]])]),(0,s.Lk)("div",bO,[t[107]||(t[107]=(0,s.Lk)("label",null,"Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e=>i.control=e,placeholder:"Enter policy description",rows:"4"},null,8,CO),[[a.Jo,i.control]])]),(0,s.Lk)("div",LO,[t[108]||(t[108]=(0,s.Lk)("label",null,"Scope",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.scope=e,placeholder:"Enter policy scope"},null,8,wO),[[a.Jo,i.scope]])]),(0,s.Lk)("div",EO,[t[109]||(t[109]=(0,s.Lk)("label",null,"Department",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.department=e,placeholder:"Enter department"},null,8,RO),[[a.Jo,i.department]])]),(0,s.Lk)("div",IO,[t[110]||(t[110]=(0,s.Lk)("label",null,"Objective",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e=>i.objective=e,placeholder:"Enter policy objective",rows:"3"},null,8,DO),[[a.Jo,i.objective]])]),(0,s.Lk)("div",PO,[t[111]||(t[111]=(0,s.Lk)("label",null,"Applicability",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.applicability=e,placeholder:"Enter applicability"},null,8,_O),[[a.Jo,i.applicability]])]),(0,s.Lk)("div",AO,[t[112]||(t[112]=(0,s.Lk)("label",null,"Coverage Rate (%)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":e=>i.coverage_rate=e,placeholder:"Enter coverage rate",min:"0",max:"100"},null,8,SO),[[a.Jo,i.coverage_rate]])]),(0,s.Lk)("div",TO,[t[113]||(t[113]=(0,s.Lk)("label",null,"Related Controls",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>i.related_controls=e,placeholder:"Enter related controls"},null,8,xO),[[a.Jo,i.related_controls]])]),(0,s.Lk)("div",FO,[t[114]||(t[114]=(0,s.Lk)("label",null,"Start Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e=>i.start_date=e},null,8,VO),[[a.Jo,i.start_date]])]),(0,s.Lk)("div",UO,[t[115]||(t[115]=(0,s.Lk)("label",null,"End Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e=>i.end_date=e},null,8,NO),[[a.Jo,i.end_date]])]),(0,s.Lk)("div",MO,[t[117]||(t[117]=(0,s.Lk)("label",null,"Upload Document",-1)),(0,s.Lk)("div",XO,[(0,s.Lk)("input",{type:"file",id:"file-"+e+"-"+l,onChange:e=>o.handleSubPolicyFileUpload(e,o.policies.indexOf(i)),accept:".pdf,.doc,.docx,.txt"},null,40,$O),(0,s.Lk)("label",{for:"file-"+e+"-"+l,class:"file-upload-label"},t[116]||(t[116]=[(0,s.Lk)("i",{class:"fas fa-upload"},null,-1),(0,s.eW)(" Choose File ")]),8,OO),i.uploaded_file?((0,s.uX)(),(0,s.CE)("span",jO,(0,d.v_)(i.uploaded_file.name),1)):(0,s.Q3)("",!0)])])])]))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies.filter(t=>t.section_name===e),(i,l)=>((0,s.uX)(),(0,s.CE)("div",{key:"compliance-"+e+"-"+l,class:"compliance-management-section"},[(0,s.Lk)("div",BO,[(0,s.Lk)("div",WO,[t[118]||(t[118]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-check-circle"}),(0,s.eW)(" Compliance Management")],-1)),(0,s.Lk)("span",qO,(0,d.v_)(i.Sub_policy_id||"Sub-Policy "+(l+1)),1)]),(0,s.Lk)("div",QO,[(0,s.Lk)("span",KO,(0,d.v_)(o.complianceData[`${e}_${i.Sub_policy_id}`]?.length||0)+" Items ",1),(0,s.Lk)("button",{onClick:t=>o.addComplianceItem(`${e}_${i.Sub_policy_id}`),class:"add-compliance-btn"},t[119]||(t[119]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Item ")]),8,JO)])]),o.complianceData[`${e}_${i.Sub_policy_id}`]?((0,s.uX)(),(0,s.CE)("div",zO,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.complianceData[`${e}_${i.Sub_policy_id}`],(n,r)=>((0,s.uX)(),(0,s.CE)("div",{key:"compliance-item-"+r,class:"compliance-card"},[(0,s.Lk)("div",HO,[(0,s.Lk)("div",GO,[(0,s.Lk)("span",YO,(0,d.v_)(n.letter)+")",1),(0,s.Lk)("span",ZO,"Item "+(0,d.v_)(r+1),1)]),(0,s.Lk)("div",ej,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge","status-"+n.status])},(0,d.v_)(n.status),3),o.complianceData[`${e}_${i.Sub_policy_id}`].length>1?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>o.removeComplianceItem(`${e}_${i.Sub_policy_id}`,r),class:"remove-compliance-btn"},t[120]||(t[120]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,tj)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",ij,[(0,s.Lk)("div",aj,[t[121]||(t[121]=(0,s.Lk)("label",null,"Compliance Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>n.name=e,placeholder:"Enter compliance name"},null,8,sj),[[a.Jo,n.name]])]),(0,s.Lk)("div",oj,[t[123]||(t[123]=(0,s.Lk)("label",null,"Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":e=>n.status=e,class:"status-select"},t[122]||(t[122]=[(0,s.Lk)("option",{value:"pending"},"Pending",-1),(0,s.Lk)("option",{value:"in-progress"},"In Progress",-1),(0,s.Lk)("option",{value:"completed"},"Completed",-1),(0,s.Lk)("option",{value:"not-applicable"},"Not Applicable",-1)]),8,lj),[[a.u1,n.status]])]),(0,s.Lk)("div",nj,[t[124]||(t[124]=(0,s.Lk)("label",null,"Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":e=>n.description=e,placeholder:"Enter compliance description",rows:"3"},null,8,rj),[[a.Jo,n.description]])]),(0,s.Lk)("div",cj,[t[125]||(t[125]=(0,s.Lk)("label",null,"Assignee",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>n.assignee=e,placeholder:"Enter assignee name"},null,8,dj),[[a.Jo,n.assignee]])]),(0,s.Lk)("div",uj,[t[126]||(t[126]=(0,s.Lk)("label",null,"Due Date",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":e=>n.dueDate=e},null,8,pj),[[a.Jo,n.dueDate]])]),(0,s.Lk)("div",mj,[t[128]||(t[128]=(0,s.Lk)("label",null,"Evidence Document",-1)),(0,s.Lk)("div",vj,[(0,s.Lk)("input",{type:"file",id:"compliance-file-"+e+"-"+l+"-"+r,onChange:t=>o.handleComplianceFileUpload(t,`${e}_${i.Sub_policy_id}`,r),accept:".pdf,.doc,.docx,.txt,.jpg,.png"},null,40,kj),(0,s.Lk)("label",{for:"compliance-file-"+e+"-"+l+"-"+r,class:"file-upload-label"},t[127]||(t[127]=[(0,s.Lk)("i",{class:"fas fa-upload"},null,-1),(0,s.eW)(" Upload Evidence ")]),8,hj),n.evidence?((0,s.uX)(),(0,s.CE)("span",gj,(0,d.v_)(n.evidence.name),1)):(0,s.Q3)("",!0)])])])]))),128))])):(0,s.Q3)("",!0)]))),128))]))),128)),(0,s.Lk)("div",yj,[(0,s.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>o.saveAllDetails&&o.saveAllDetails(...e)),class:"save-btn primary"},t[129]||(t[129]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save All Details ")])),(0,s.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>o.resetAllForms&&o.resetAllForms(...e)),class:"reset-btn secondary"},t[130]||(t[130]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset All Forms ")]))])])])):(0,s.Q3)("",!0),o.uploadStatus&&1===o.currentStep?((0,s.uX)(),(0,s.CE)("div",{key:9,class:(0,d.C4)(["status-message",o.uploadStatus.type])},[(0,s.Lk)("i",{class:(0,d.C4)("success"===o.uploadStatus.type?"fas fa-check-circle":"fas fa-exclamation-circle")},null,2),(0,s.eW)(" "+(0,d.v_)(o.uploadStatus.message),1)],2)):(0,s.Q3)("",!0),o.showCongratulationsModal?((0,s.uX)(),(0,s.CE)("div",fj,[(0,s.Lk)("div",bj,[t[133]||(t[133]=(0,s.Fv)('<div class="congratulations-header" data-v-bbfad2e8><div class="congratulations-icon-container" data-v-bbfad2e8><i class="fas fa-check-circle" data-v-bbfad2e8></i></div><h2 data-v-bbfad2e8>Congratulations!</h2><p class="congratulations-message" data-v-bbfad2e8>Your framework has been successfully added to the system.</p></div><div class="congratulations-content" data-v-bbfad2e8><p data-v-bbfad2e8>You have completed all the steps to add a new framework to your GRC system.</p><p data-v-bbfad2e8>Your framework is now ready to be used for compliance management.</p></div>',2)),(0,s.Lk)("div",Cj,[(0,s.Lk)("button",{onClick:t[20]||(t[20]=(...e)=>o.goToPolicyDashboard&&o.goToPolicyDashboard(...e)),class:"ok-btn"},t[132]||(t[132]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Go to Policy Dashboard ")]))])])])):(0,s.Q3)("",!0),o.uploadStatus&&"success"===o.uploadStatus.type&&o.currentStep>1?((0,s.uX)(),(0,s.CE)("div",Lj,[(0,s.Lk)("div",wj,[t[135]||(t[135]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.Lk)("div",Ej,(0,d.v_)(o.uploadStatus.message),1),(0,s.Lk)("button",{onClick:t[21]||(t[21]=e=>o.uploadStatus=null),class:"notification-close"},t[134]||(t[134]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))])])):(0,s.Q3)("",!0),o.showContentViewer?((0,s.uX)(),(0,s.CE)("div",Rj,[(0,s.Lk)("div",Ij,[(0,s.Lk)("div",Dj,[t[137]||(t[137]=(0,s.Lk)("h3",null,"Framework Content Viewer",-1)),(0,s.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>o.closeContentViewer&&o.closeContentViewer(...e)),class:"close-btn"},t[136]||(t[136]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))]),(0,s.Lk)("div",Pj,[(0,s.Lk)("div",_j,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[23]||(t[23]=e=>o.searchQuery=e),placeholder:"Search sections..."},null,512),[[a.Jo,o.searchQuery]])]),(0,s.Lk)("div",Aj,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredSections,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"section-item"},[(0,s.Lk)("div",{class:"section-header",onClick:t=>o.toggleSection(e.id)},[(0,s.Lk)("div",Tj,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.selected=t,onChange:t=>o.updateSelection(e)},null,40,xj),[[a.lH,e.selected]]),(0,s.Lk)("span",null,(0,d.v_)(e.title),1)]),(0,s.Lk)("i",{class:(0,d.C4)(["fas",e.expanded?"fa-chevron-down":"fa-chevron-right"])},null,2)],8,Sj),e.expanded?((0,s.uX)(),(0,s.CE)("div",Fj,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.subsections,(t,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"subsection-item"},[(0,s.Lk)("div",Vj,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":e=>t.selected=e,onChange:t=>o.updateSubsectionSelection(e)},null,40,Uj),[[a.lH,t.selected]]),(0,s.Lk)("span",null,(0,d.v_)(t.title),1)])]))),128))])):(0,s.Q3)("",!0)]))),128))])]),(0,s.Lk)("div",Nj,[(0,s.Lk)("button",{onClick:t[24]||(t[24]=(...e)=>o.selectAllSections&&o.selectAllSections(...e)),class:"select-all-btn"},"Select All"),(0,s.Lk)("button",{onClick:t[25]||(t[25]=(...e)=>o.deselectAllSections&&o.deselectAllSections(...e)),class:"deselect-all-btn"},"Deselect All"),(0,s.Lk)("button",{onClick:t[26]||(t[26]=(...e)=>o.saveSelectedSections&&o.saveSelectedSections(...e)),class:"save-selection-btn"},"Save Selection")])])])):(0,s.Q3)("",!0),o.showPolicyExtractor?((0,s.uX)(),(0,s.CE)("div",Mj,[(0,s.Lk)("div",Xj,[(0,s.Lk)("div",$j,[t[140]||(t[140]=(0,s.Lk)("h3",null,"Extracted Policies",-1)),(0,s.Lk)("div",Oj,[(0,s.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>o.saveAllPolicies&&o.saveAllPolicies(...e)),class:"save-all-btn"},t[138]||(t[138]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save All ")])),(0,s.Lk)("button",{onClick:t[28]||(t[28]=(...e)=>o.closePolicyExtractor&&o.closePolicyExtractor(...e)),class:"close-btn"},t[139]||(t[139]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))])]),(0,s.Lk)("div",jj,[(0,s.Lk)("div",Bj,[o.policies.length>0?((0,s.uX)(),(0,s.CE)("table",Wj,[t[147]||(t[147]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Section"),(0,s.Lk)("th",null,"Control ID"),(0,s.Lk)("th",null,"Policy Name"),(0,s.Lk)("th",null,"Control"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies,(e,i)=>((0,s.uX)(),(0,s.CE)(s.FK,{key:i},[(0,s.Lk)("tr",{class:(0,d.C4)({"expanded-row":o.expandedRows[i]})},[(0,s.Lk)("td",null,(0,d.v_)(e.section_name||"N/A"),1),(0,s.Lk)("td",null,(0,d.v_)(e.Sub_policy_id||"N/A"),1),(0,s.Lk)("td",null,(0,d.v_)(e.sub_policy_name||"N/A"),1),(0,s.Lk)("td",qj,(0,d.v_)(e.control?e.control.length>100?e.control.substring(0,100)+"...":e.control:"N/A"),1),(0,s.Lk)("td",Qj,[(0,s.Lk)("button",{onClick:e=>o.toggleExpandRow(i),class:"view-btn"},[(0,s.Lk)("i",{class:(0,d.C4)(o.expandedRows[i]?"fas fa-chevron-up":"fas fa-eye")},null,2),(0,s.eW)(" "+(0,d.v_)(o.expandedRows[i]?"Hide":"View"),1)],8,Kj),(0,s.Lk)("button",{onClick:t=>o.editPolicy(e,i),class:"edit-btn"},t[141]||(t[141]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1),(0,s.eW)(" Edit ")]),8,Jj)])],2),o.expandedRows[i]?((0,s.uX)(),(0,s.CE)("tr",zj,[(0,s.Lk)("td",Hj,[(0,s.Lk)("div",Gj,[(0,s.Lk)("div",Yj,[t[142]||(t[142]=(0,s.Lk)("h4",null,"Control ID",-1)),(0,s.Lk)("div",Zj,(0,d.v_)(e.Sub_policy_id||"N/A"),1)]),(0,s.Lk)("div",eB,[t[143]||(t[143]=(0,s.Lk)("h4",null,"Policy Name",-1)),(0,s.Lk)("div",tB,(0,d.v_)(e.sub_policy_name||"N/A"),1)]),(0,s.Lk)("div",iB,[t[144]||(t[144]=(0,s.Lk)("h4",null,"Control",-1)),(0,s.Lk)("div",aB,[o.getFormattedControl(e.control).length>0?((0,s.uX)(),(0,s.CE)("div",sB,[(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.getFormattedControl(e.control),(e,t)=>((0,s.uX)(),(0,s.CE)("li",{key:t},(0,d.v_)(e),1))),128))])])):((0,s.uX)(),(0,s.CE)("div",oB,(0,d.v_)(e.control||"N/A"),1))])]),(0,s.Lk)("div",lB,[t[145]||(t[145]=(0,s.Lk)("h4",null,"Related Controls",-1)),(0,s.Lk)("div",nB,(0,d.v_)(e.related_controls||"N/A"),1)]),(0,s.Lk)("div",rB,[t[146]||(t[146]=(0,s.Lk)("h4",null,"Control Enhancements",-1)),(0,s.Lk)("div",cB,(0,d.v_)(e.control_enhancements||"N/A"),1)])])])])):(0,s.Q3)("",!0)],64))),128))])])):((0,s.uX)(),(0,s.CE)("div",dB,t[148]||(t[148]=[(0,s.Lk)("p",null,"No policies found. Please try processing the document again.",-1)])))])])])])):(0,s.Q3)("",!0),o.showPolicyDetail?((0,s.uX)(),(0,s.CE)("div",uB,[(0,s.Lk)("div",pB,[(0,s.Lk)("div",mB,[t[151]||(t[151]=(0,s.Lk)("h3",null,"Edit Policy",-1)),(0,s.Lk)("div",vB,[(0,s.Lk)("button",{onClick:t[29]||(t[29]=(...e)=>o.savePolicy&&o.savePolicy(...e)),class:"save-btn"},t[149]||(t[149]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save ")])),(0,s.Lk)("button",{onClick:t[30]||(t[30]=(...e)=>o.closePolicyDetail&&o.closePolicyDetail(...e)),class:"close-btn"},t[150]||(t[150]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]))])]),(0,s.Lk)("div",kB,[(0,s.Lk)("div",hB,[t[152]||(t[152]=(0,s.Lk)("label",null,"Section",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=e=>o.currentPolicy.section_name=e)},null,512),[[a.Jo,o.currentPolicy.section_name]])]),(0,s.Lk)("div",gB,[t[153]||(t[153]=(0,s.Lk)("label",null,"Control ID",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=e=>o.currentPolicy.Sub_policy_id=e)},null,512),[[a.Jo,o.currentPolicy.Sub_policy_id]])]),(0,s.Lk)("div",yB,[t[154]||(t[154]=(0,s.Lk)("label",null,"Policy Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[33]||(t[33]=e=>o.currentPolicy.sub_policy_name=e)},null,512),[[a.Jo,o.currentPolicy.sub_policy_name]])]),(0,s.Lk)("div",fB,[t[155]||(t[155]=(0,s.Lk)("label",null,"Control",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[34]||(t[34]=e=>o.currentPolicy.control=e),rows:"8"},null,512),[[a.Jo,o.currentPolicy.control]])]),(0,s.Lk)("div",bB,[t[156]||(t[156]=(0,s.Lk)("label",null,"Related Controls",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[35]||(t[35]=e=>o.currentPolicy.related_controls=e)},null,512),[[a.Jo,o.currentPolicy.related_controls]])]),(0,s.Lk)("div",CB,[t[157]||(t[157]=(0,s.Lk)("label",null,"Control Enhancements",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[36]||(t[36]=e=>o.currentPolicy.control_enhancements=e),rows:"5"},null,512),[[a.Jo,o.currentPolicy.control_enhancements]])])])])])):(0,s.Q3)("",!0)])])}var wB={name:"UploadFramework",setup(){const e=(0,ie.KR)(null),t=(0,ie.KR)(!1),i=(0,ie.KR)(!1),a=(0,ie.KR)(!1),o=(0,ie.KR)(!1),l=(0,ie.KR)(!1),n=(0,ie.KR)(null),r=(0,ie.KR)(null),c=(0,ie.KR)({progress:0,message:""}),d=(0,ie.KR)(null),u=(0,ie.KR)(""),p=(0,ie.KR)("");let m=null;const v=(0,ie.KR)(1),k=(0,ie.KR)([1]),h=(0,ie.KR)(!1),g=(0,ie.KR)([]),y=(0,ie.KR)(""),f=(0,ie.KR)(!1),b=(0,ie.KR)(!1),C=(0,ie.KR)(""),L=(0,ie.KR)(0),w=(0,ie.KR)(!1),E=(0,ie.KR)([]),R=(0,ie.KR)(0),I=(0,ie.KR)(0),D=(0,ie.KR)(!1),P=(0,ie.KR)({}),_=(0,ie.KR)(null),A=(0,ie.KR)(!1),S=(0,ie.KR)({}),T=(0,ie.KR)({title:"",description:"",category:"",effectiveDate:"",startDate:"",endDate:""}),x=(0,ie.KR)({}),F=(0,ie.KR)({}),V=(0,ie.KR)(!1),U=(0,s.EW)(()=>{if(!y.value)return g.value;const e=y.value.toLowerCase();return g.value.filter(t=>t.title.toLowerCase().includes(e)||t.subsections.some(t=>t.title.toLowerCase().includes(e)))}),N=(0,s.EW)(()=>{if(!E.value||0===E.value.length)return[];const e=[...new Set(E.value.map(e=>e.section_name).filter(e=>e))];return e.sort()}),M=async()=>{a.value=!0,n.value=null;try{const e=[{section_name:"Access Control",Sub_policy_id:"AC-1",sub_policy_name:"Access Control Policy and Procedures",control:"a. Develop, document, and disseminate access control policy. b. Review and update the current access control policy. c. Designate an official to manage the access control policy and procedures.",scope:"Organization-wide",department:"IT Security",objective:"Establish access control framework",applicability:"All systems",coverage_rate:100,related_controls:"AC-2, AC-3",start_date:"2024-01-01",end_date:"2024-12-31"},{section_name:"Access Control",Sub_policy_id:"AC-2",sub_policy_name:"Account Management",control:"a. Identify and select account types. b. Assign account managers. c. Establish conditions for group membership. d. Monitor the use of accounts.",scope:"System accounts",department:"IT Security",objective:"Manage system accounts",applicability:"Information systems",coverage_rate:95,related_controls:"AC-1, AC-3",start_date:"2024-01-01",end_date:"2024-12-31"},{section_name:"Audit and Accountability",Sub_policy_id:"AU-1",sub_policy_name:"Audit and Accountability Policy",control:"a. Develop, document, and disseminate audit policy. b. Review and update the current audit policy. c. Designate an official to manage the audit policy.",scope:"Organization-wide",department:"Compliance",objective:"Establish audit framework",applicability:"All systems and processes",coverage_rate:100,related_controls:"AU-2, AU-3",start_date:"2024-01-01",end_date:"2024-12-31"}];E.value=e,R.value=e.length,I.value=2,u.value="NIST.SP.800-53r5.pdf",ve(),ge(),v.value=6,n.value={type:"success",message:"Default NIST framework data loaded successfully!"},setTimeout(()=>{n.value=null},3e3)}catch(e){n.value={type:"error",message:"Failed to load default data. Please try again."}}finally{a.value=!1}},X=()=>{r.value.click()},$=t=>{const i=t.target.files[0];i&&(e.value=i,n.value=null)},O=i=>{i.preventDefault(),t.value=!1;const a=i.dataTransfer.files[0];a&&(e.value=a,n.value=null)},j=()=>{e.value=null,n.value=null,r.value.value=""},B=e=>{if(0===e)return"0 Bytes";const t=1024,i=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,a)).toFixed(2))+" "+i[a]},W=async()=>{if(!e.value)return;i.value=!0,n.value=null;const t=new FormData;t.append("file",e.value);try{const e=await He.A.post("/api/upload-framework/",t,{headers:{"Content-Type":"multipart/form-data"}});u.value=e.data.filename,p.value=(new Date).toLocaleTimeString(),e.data.processing&&e.data.task_id?(o.value=!0,d.value=e.data.task_id,Q(2),q(e.data.task_id)):(n.value={type:"success",message:`File "${e.data.filename}" uploaded successfully!`},setTimeout(()=>{j(),n.value=null},3e3))}catch(a){n.value={type:"error",message:a.response?.data?.error||"Upload failed. Please try again."}}finally{i.value=!1}},q=(e,t=null)=>{d.value=e;let i=0;m=setInterval(async()=>{try{const a=await He.A.get(`/api/processing-status/${e}/`);void 0!==a.data.progress?c.value=a.data:i<20?(i+=2,c.value={progress:Math.floor(i),message:"Initializing document processing...",currentSection:"Starting extraction"}):i<40?(i+=1.5,c.value={progress:Math.floor(i),message:"Extracting document structure...",currentSection:"THE FUNDAMENTALS"}):i<60?(i+=1,c.value={progress:Math.floor(i),message:"Processing control sections...",currentSection:"ACCESS CONTROL"}):i<80?(i+=.8,c.value={progress:Math.floor(i),message:"Extracting policy controls...",currentSection:"AUDIT AND ACCOUNTABILITY"}):i<95?(i+=.5,c.value={progress:Math.floor(i),message:"Finalizing extraction...",currentSection:"Completing processing"}):(i=100,c.value={progress:100,message:"Processing complete!",currentSection:"Finished"}),c.value.progress>=100&&(clearInterval(m),o.value=!1,l.value=!0,t?t():(Q(3),J(e)))}catch(a){console.error("Error fetching progress:",a),404===a.response?.status&&(clearInterval(m),o.value=!1,n.value={type:"error",message:"Processing task not found or expired"},v.value=1)}},1500)},Q=e=>{e!==v.value&&(k.value.push(v.value),v.value=e)},K=()=>{v.value=Math.max(1,v.value-1)},J=async e=>{try{const t=await He.A.get(`/api/get-sections/${e}/`);g.value=t.data.map((e,t)=>{const i=e.subsections.filter(e=>e.name.startsWith("txt_chunks/")&&e.name.endsWith(".txt")),a=i.map((e,t)=>({id:t,title:e.name.replace("txt_chunks/extracted_","").replace(".txt","").replace(/_/g," "),originalName:e.name,content:e.content,selected:!1}));return{id:t,title:e.name,selected:!1,expanded:!1,subsections:a}}).filter(e=>e.subsections.length>0)}catch(t){console.error("Error fetching extracted content:",t)}},z=()=>{h.value=!0},H=()=>{h.value=!1},G=e=>{const t=g.value.find(t=>t.id===e);t&&(t.expanded=!t.expanded)},Y=e=>{e.subsections.forEach(t=>{t.selected=e.selected})},Z=e=>{e.selected=e.subsections.every(e=>e.selected)},ee=()=>{g.value.forEach(e=>{e.selected=!0,e.subsections.forEach(e=>{e.selected=!0})})},te=()=>{g.value.forEach(e=>{e.selected=!1,e.subsections.forEach(e=>{e.selected=!1})})},ae=async()=>{try{const e=g.value.filter(e=>e.selected||e.subsections.some(e=>e.selected)).map(e=>({name:e.title,subsections:e.subsections.filter(e=>e.selected).map(e=>({name:e.originalName,content:e.content}))})).filter(e=>e.subsections.length>0);if(0===e.length)return void alert("No sections selected. Please select at least one item.");I.value=e.reduce((e,t)=>e+t.subsections.length,0);const t=await He.A.post("/api/create-checked-structure/",{task_id:d.value,sections:e});200===t.status&&(H(),Q(4),b.value=!0,C.value="Initializing policy extraction...",L.value=0,se())}catch(e){console.error("Error saving selected sections:",e),alert("Error saving selected sections: "+e.message)}},se=()=>{let e=setInterval(async()=>{try{const t=await He.A.get(`/api/policy-extraction-progress/${d.value}/`),i=t.data.progress||0,a=t.data.message||"Processing...";L.value=Math.floor(i),C.value=a,i>=100&&(clearInterval(e),L.value=100,C.value="Policy extraction complete!",setTimeout(async()=>{f.value=!0,b.value=!1,await oe(),Q(5)},1e3))}catch(t){console.error("Error checking extraction status:",t);try{const t=await He.A.get(`/api/processing-status/${d.value}/`);t.data.progress>=100&&(clearInterval(e),L.value=100,C.value="Policy extraction complete!",setTimeout(async()=>{f.value=!0,b.value=!1,await oe(),Q(5)},1e3))}catch(i){console.error("Error with fallback status check:",i),b.value=!1,clearInterval(e)}}},2e3)},oe=async()=>{try{const e=await He.A.get(`/api/get-extracted-policies/${d.value}/`);E.value=e.data.policies||[],R.value=e.data.total_policies||E.value.length,console.log("Fetched policies:",E.value.length)}catch(e){console.error("Error fetching policies:",e),E.value=[],R.value=0}},le=async()=>{try{const e=await He.A.get(`/api/extracted-policies/${d.value}/`);e.data.policies&&(E.value=e.data.policies,R.value=e.data.total_policies||E.value.length,ke(),Q(6))}catch(e){console.error("Error loading extracted policies:",e),n.value={type:"error",message:"Failed to load extracted policies. Please try again."}}},ne=()=>{w.value=!1},re=(e,t)=>{P.value={...e},_.value=t,D.value=!0},ce=async()=>{try{null!==_.value&&(E.value[_.value]={...P.value});const e=await He.A.post("/api/save-single-policy/",{policy:P.value,task_id:d.value});200===e.status&&(D.value=!1,n.value={type:"success",message:`Policy "${P.value.Sub_policy_id}" saved successfully!`},setTimeout(()=>{n.value=null},5e3))}catch(e){console.error("Error saving policy:",e),n.value={type:"error",message:e.response?.data?.error||"Failed to save policy. Please try again."}}},de=async()=>{try{const e=await He.A.post("/api/save-policies/",{policies:E.value,task_id:d.value,filename:`policies_${d.value}`});200===e.status&&(n.value={type:"success",message:`All policies saved successfully! (${E.value.length} policies)`},setTimeout(()=>{n.value=null},5e3))}catch(e){console.error("Error saving all policies:",e),n.value={type:"error",message:e.response?.data?.error||"Failed to save policies. Please try again."}}},ue=()=>{D.value=!1,P.value={},_.value=null},pe=e=>{S.value={...S.value,[e]:!S.value[e]}},me=e=>e?/^\s*[\d*-]+\s+/.test(e)?e.split("\n").filter(e=>e.trim()).map(e=>e.trim()):e.split(/\.\s+|\.\n/).filter(e=>e.trim()).map(e=>e.trim()+(e.endsWith(".")?"":".")):[],ve=()=>{const e={};N.value.forEach(t=>{x.value[t]?e[t]=x.value[t]:e[t]={documentUrl:"",identifier:"",createdBy:"",reviewer:"",policyName:"",department:"",scope:"",applicability:"",objective:"",coverageRate:0}}),x.value=e},ke=()=>{x.value={},N.value.forEach(e=>{x.value[e]={documentUrl:"",identifier:"",createdBy:"",reviewer:"",policyName:"",department:"",scope:"",applicability:"",objective:"",coverageRate:0}})},he=e=>{if(!e||""===e.trim())return[];const t=/([a-z])[.)](\s*)/gi,i=[];let a;while(null!==(a=t.exec(e)))i.push({letter:a[1].toLowerCase(),index:a.index,matchLength:a[0].length});if(0===i.length)return e.trim().length<5?[]:[{id:"compliance_1",letter:"a",name:e.substring(0,100)+(e.length>100?"...":""),description:e,status:"pending",assignee:"",dueDate:"",evidence:null}];const s=i.map((t,a)=>{const s=t.index+t.matchLength,o=a<i.length-1?i[a+1].index:e.length,l=e.substring(s,o).trim();return l.length<5?null:{id:`compliance_${a+1}`,letter:t.letter,name:l.substring(0,100)+(l.length>100?"...":""),description:l,status:"pending",assignee:"",dueDate:"",evidence:null}}).filter(e=>null!==e);return s},ge=()=>{const e={};E.value.forEach(t=>{if(!t.control||""===t.control.trim())return;const i=`${t.section_name}_${t.Sub_policy_id}`,a=he(t.control);a.length>0&&(e[i]=a)}),F.value=e},ye=(e,t,i)=>{const a=e.target.files[0];a&&F.value[t]&&F.value[t][i]&&(F.value[t][i].evidence=a)},fe=e=>{F.value[e]||(F.value[e]=[]);const t=F.value[e].length,i={id:`compliance_${t+1}`,letter:String.fromCharCode(97+t),name:"",description:"",status:"pending",assignee:"",dueDate:"",evidence:null};F.value[e].push(i)},be=(e,t)=>{F.value[e]&&F.value[e].length>1&&(F.value[e].splice(t,1),F.value[e].forEach((e,t)=>{e.letter=String.fromCharCode(97+t),e.id=`compliance_${t+1}`}))},Ce=(e,t)=>{const i=e.target.files[0];i&&E.value[t]&&(E.value[t].uploaded_file=i)},Le=async()=>{try{const t={task_id:d.value||"default_task",framework_details:T.value,policy_forms:x.value,sub_policies:E.value,compliance_data:F.value,unique_sections:N.value},i=await He.A.post("/api/save-complete-policy-package/",t);if(200===i.status)try{const e=await He.A.post("/api/save-framework-to-database/",{task_id:d.value||"default_task"});200===e.status&&(n.value={type:"success",message:`Framework "${T.value.title}" has been created successfully!`},V.value=!0,setTimeout(()=>{n.value=null},8e3))}catch(e){console.error("Error saving to database:",e),n.value={type:"warning",message:"Files saved successfully, but database save failed."}}}catch(t){console.error("Error saving complete package:",t),n.value={type:"error",message:t.response?.data?.error||"Failed to save package. Please try again."}}},we=()=>{T.value={title:"",description:"",category:"",effectiveDate:"",startDate:"",endDate:""},x.value={},ve(),E.value.forEach(e=>{e.scope="",e.department="",e.objective="",e.applicability="",e.coverage_rate=0,e.start_date="",e.end_date="",e.uploaded_file=null})},Ee=()=>{e.value=null,o.value=!1,a.value=!1,l.value=!1,n.value=null,c.value={progress:0,message:""},d.value=null,u.value="",p.value="",r.value.value="",g.value=[],h.value=!1,f.value=!1,b.value=!1,C.value="",L.value=0,w.value=!1,E.value=[],R.value=0,I.value=0,v.value=1,k.value=[1]},Re=()=>{V.value=!1,window.location.href="/policy-dashboard"};return(0,s.wB)(E,()=>{E.value.length>0&&(ve(),ge())},{immediate:!0}),(0,s.hi)(()=>{m&&clearInterval(m)}),{selectedFile:e,isDragOver:t,isUploading:i,isLoadingDefault:a,isProcessing:o,processingComplete:l,uploadStatus:n,fileInput:r,processingStatus:c,uploadedFileName:u,processingStartTime:p,showContentViewer:h,sections:g,searchQuery:y,filteredSections:U,policyExtractionComplete:f,policyExtractionInProgress:b,policyExtractionMessage:C,policyExtractionProgress:L,showPolicyExtractor:w,policies:E,extractedPoliciesCount:R,selectedSectionsCount:I,currentStep:v,triggerFileInput:X,handleFileSelect:$,handleDrop:O,removeFile:j,formatFileSize:B,uploadFile:W,loadDefaultData:M,resetUpload:Ee,viewExtractedContent:z,closeContentViewer:H,toggleSection:G,updateSelection:Y,updateSubsectionSelection:Z,selectAllSections:ee,deselectAllSections:te,saveSelectedSections:ae,viewPolicyExtractor:le,closePolicyExtractor:ne,goBack:K,goToStep:Q,showPolicyDetail:D,currentPolicy:P,currentPolicyIndex:_,isEditing:A,editPolicy:re,savePolicy:ce,saveAllPolicies:de,expandedRows:S,toggleExpandRow:pe,getFormattedControl:me,policyDetails:T,saveAllDetails:Le,closePolicyDetail:ue,handleSubPolicyFileUpload:Ce,resetAllForms:we,uniqueSectionNames:N,policyFormData:x,initializePolicyFormData:ve,initializeDynamicForms:ke,complianceData:F,getComplianceItems:he,initializeComplianceData:ge,handleComplianceFileUpload:ye,addComplianceItem:fe,removeComplianceItem:be,showCongratulationsModal:V,goToPolicyDashboard:Re}}};const EB=(0,le.A)(wB,[["render",LB],["__scopeId","data-v-bbfad2e8"]]);var RB=EB;const IB={class:"incident-form-page incident"},DB={class:"incident-form-box"},PB={class:"incident-title-description-section"},_B={class:"section-header"},AB=["disabled"],SB={class:"title-description-fields"},TB={class:"field-title required"},xB=["aria-invalid"],FB={key:0,class:"validation-error"},VB={class:"field-description required"},UB=["aria-invalid"],NB={key:0,class:"validation-error"},MB={class:"field-third"},XB=["aria-invalid"],$B={key:0,class:"validation-error"},OB={class:"field-third required"},jB=["aria-invalid"],BB={key:0,class:"validation-error"},WB={class:"field-third required"},qB=["aria-invalid"],QB={key:0,class:"validation-error"},KB={class:"field-third required"},JB=["aria-invalid"],zB={key:0,class:"validation-error"},HB={class:"field-third required"},GB=["aria-invalid"],YB={class:"selected-items"},ZB={key:0,class:"placeholder"},eW=["onClick"],tW={key:0,class:"dropdown-panel"},iW={class:"search-box"},aW={class:"options-list"},sW={key:0,class:"no-options"},oW=["onClick"],lW=["checked"],nW={key:0,class:"validation-error"},rW={class:"field-third"},cW=["aria-invalid"],dW={key:0,class:"validation-error"},uW={class:"field-third"},pW=["aria-invalid"],mW={key:0,class:"validation-error"},vW={class:"field-third"},kW={key:0,class:"validation-error"},hW={class:"field-third"},gW={class:"multi-select-dropdown"},yW={class:"selected-items"},fW={key:0,class:"placeholder"},bW=["onClick"],CW={key:0,class:"dropdown-panel"},LW={class:"search-box"},wW={class:"options-list"},EW={key:0,class:"no-options"},RW=["onClick"],IW=["checked"],DW={key:0,class:"validation-error"},PW={class:"field-third"},_W={key:0,class:"validation-error"},AW={class:"field-third"},SW={key:0,class:"validation-error"},TW={class:"field-third"},xW={class:"field-third"},FW={key:0,class:"validation-error"},VW={class:"field-third"},UW={key:0,class:"validation-error"},NW={class:"field-third"},MW={key:0,class:"validation-error"},XW={class:"field-third"},$W={key:0,class:"validation-error"},OW={class:"field-third"},jW={key:0,class:"validation-error"},BW={class:"field-third"},WW={key:0,class:"validation-error"},qW={class:"field-third"},QW={key:0,class:"validation-error"},KW={class:"field-third"},JW={key:0,class:"validation-error"},zW={class:"field-third"},HW={key:0,class:"field-full compliance-mapping-section"},GW={class:"field-full"},YW={key:0,class:"compliance-loading"},ZW={key:1,class:"no-compliances-available"},eq={key:2,class:"compliance-dropdown"},tq={key:0,class:"compliance-info"},iq={key:1,class:"compliance-info"},aq={class:"compliance-options-container"},sq=["onClick"],oq={class:"compliance-checkbox"},lq=["id","value","checked","onChange"],nq=["for"],rq={class:"compliance-content"},cq={class:"compliance-header"},dq={class:"compliance-details"},uq={class:"framework-name"},pq={class:"policy-name"},mq={key:0,class:"compliance-mitigation"},vq={key:3,class:"no-compliances"},kq={key:0,class:"selected-compliance"},hq={class:"compliance-card"},gq={class:"compliance-card-header"},yq={class:"compliance-card-body"},fq={key:0},bq={key:1},Cq={key:1,class:"incident-status-info"},Lq={class:"status-details"},wq={class:"status-item"},Eq={key:0,class:"status-item"},Rq={class:"value"},Iq={key:1,class:"status-item"},Dq={key:2,class:"status-item"},Pq={class:"incident-form-actions"},_q=["disabled","title"];function Aq(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",IB,[t[142]||(t[142]=(0,s.Lk)("div",{class:"incident-form-page-header"},[(0,s.Lk)("h1",{class:"incident-form-page-title"},"Create New Incident")],-1)),(0,s.Lk)("div",DB,[(0,s.Lk)("form",{onSubmit:t[76]||(t[76]=(0,a.D$)((...e)=>o.validateAndSubmit&&o.validateAndSubmit(...e),["prevent"])),class:"incident-create-form"},[(0,s.Lk)("div",PB,[(0,s.Lk)("div",_B,[t[78]||(t[78]=(0,s.Lk)("h3",null,[(0,s.Lk)("i",{class:"fas fa-edit"}),(0,s.eW)("Incident Overview")],-1)),(0,s.Lk)("button",{type:"button",onClick:t[0]||(t[0]=(...e)=>o.generateAnalysis&&o.generateAnalysis(...e)),class:"generate-analysis-btn",disabled:o.isGeneratingAnalysis},t[77]||(t[77]=[(0,s.Lk)("i",{class:"fas fa-magic"},null,-1),(0,s.eW)(" Generate Analysis ")]),8,AB)]),(0,s.Lk)("div",SB,[(0,s.Lk)("label",TB,[t[79]||(t[79]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-heading"}),(0,s.eW)("Incident Title")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>o.formData.IncidentTitle=e),onInput:t[2]||(t[2]=(...e)=>o.validateIncidentTitle&&o.validateIncidentTitle(...e)),onBlur:t[3]||(t[3]=(...e)=>o.validateIncidentTitle&&o.validateIncidentTitle(...e)),"aria-invalid":!!o.validationErrors.IncidentTitle,class:(0,d.C4)({error:o.validationErrors.IncidentTitle}),required:""},null,42,xB),[[a.Jo,o.formData.IncidentTitle]]),t[80]||(t[80]=(0,s.Lk)("div",{class:"field-helper-tip"}," Provide a clear, concise title that summarizes the incident ",-1)),o.validationErrors.IncidentTitle?((0,s.uX)(),(0,s.CE)("div",FB,(0,d.v_)(o.validationErrors.IncidentTitle),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",VB,[t[81]||(t[81]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-align-left"}),(0,s.eW)("Description")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.formData.Description=e),onInput:t[5]||(t[5]=(...e)=>o.validateDescription&&o.validateDescription(...e)),onBlur:t[6]||(t[6]=(...e)=>o.validateDescription&&o.validateDescription(...e)),"aria-invalid":!!o.validationErrors.Description,class:(0,d.C4)({error:o.validationErrors.Description}),required:""},null,42,UB),[[a.Jo,o.formData.Description]]),t[82]||(t[82]=(0,s.Lk)("div",{class:"field-helper-tip"}," Describe what happened in detail: What was the nature of the incident? How was it discovered? What systems or processes were affected? Include timeline if known... ",-1)),o.validationErrors.Description?((0,s.uX)(),(0,s.CE)("div",NB,(0,d.v_)(o.validationErrors.Description),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("label",MB,[t[84]||(t[84]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-tag"}),(0,s.eW)("Origin")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>o.formData.Origin=e),onChange:t[8]||(t[8]=(...e)=>o.validateOrigin&&o.validateOrigin(...e)),"aria-invalid":!!o.validationErrors.Origin,class:(0,d.C4)({error:o.validationErrors.Origin}),title:"Select how this incident was discovered or reported"},t[83]||(t[83]=[(0,s.Lk)("option",{value:""},"Select Origin",-1),(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Audit Finding"},"Audit Finding",-1),(0,s.Lk)("option",{value:"System Generated"},"System Generated",-1)]),42,XB),[[a.u1,o.formData.Origin]]),o.validationErrors.Origin?((0,s.uX)(),(0,s.CE)("div",$B,(0,d.v_)(o.validationErrors.Origin),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",OB,[t[85]||(t[85]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-calendar"}),(0,s.eW)("Date")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[9]||(t[9]=e=>o.formData.Date=e),onInput:t[10]||(t[10]=(...e)=>o.validateDate&&o.validateDate(...e)),onBlur:t[11]||(t[11]=(...e)=>o.validateDate&&o.validateDate(...e)),"aria-invalid":!!o.validationErrors.Date,class:(0,d.C4)({error:o.validationErrors.Date}),title:"Date when the incident occurred or was discovered",required:""},null,42,jB),[[a.Jo,o.formData.Date]]),o.validationErrors.Date?((0,s.uX)(),(0,s.CE)("div",BB,(0,d.v_)(o.validationErrors.Date),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",WB,[t[86]||(t[86]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-clock"}),(0,s.eW)("Time")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"time","onUpdate:modelValue":t[12]||(t[12]=e=>o.formData.Time=e),onInput:t[13]||(t[13]=(...e)=>o.validateTime&&o.validateTime(...e)),onBlur:t[14]||(t[14]=(...e)=>o.validateTime&&o.validateTime(...e)),"aria-invalid":!!o.validationErrors.Time,class:(0,d.C4)({error:o.validationErrors.Time}),title:"Time when the incident occurred or was discovered",required:""},null,42,qB),[[a.Jo,o.formData.Time]]),o.validationErrors.Time?((0,s.uX)(),(0,s.CE)("div",QB,(0,d.v_)(o.validationErrors.Time),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",KB,[t[88]||(t[88]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)("Risk Priority")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>o.formData.RiskPriority=e),onChange:t[16]||(t[16]=(...e)=>o.validateRiskPriority&&o.validateRiskPriority(...e)),"aria-invalid":!!o.validationErrors.RiskPriority,class:(0,d.C4)({error:o.validationErrors.RiskPriority,"priority-select":!0}),title:"Assess the severity level of this incident",required:""},t[87]||(t[87]=[(0,s.Lk)("option",{value:""},"Select Priority",-1),(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),42,JB),[[a.u1,o.formData.RiskPriority]]),o.validationErrors.RiskPriority?((0,s.uX)(),(0,s.CE)("div",zB,(0,d.v_)(o.validationErrors.RiskPriority),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",HB,[t[90]||(t[90]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)("Risk Category")],-1)),(0,s.Lk)("div",{class:(0,d.C4)(["multi-select-dropdown",{error:o.validationErrors.RiskCategory}])},[(0,s.Lk)("div",{class:(0,d.C4)(["multi-select-input",{error:o.validationErrors.RiskCategory}]),onClick:t[17]||(t[17]=(...e)=>o.toggleCategoryDropdown&&o.toggleCategoryDropdown(...e)),"aria-invalid":!!o.validationErrors.RiskCategory},[(0,s.Lk)("div",YB,[0===o.selectedCategories.length?((0,s.uX)(),(0,s.CE)("span",ZB," Select categories or type to add new... ")):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.selectedCategories,e=>((0,s.uX)(),(0,s.CE)("span",{key:e,class:"selected-item"},[(0,s.eW)((0,d.v_)(e)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:(0,a.D$)(t=>o.removeCategory(e),["stop"])},null,8,eW)]))),128))]),(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-chevron-down dropdown-arrow",{rotated:o.showCategoryDropdown}])},null,2)],10,GB),o.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",tW,[(0,s.Lk)("div",iW,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>o.categorySearchTerm=e),onInput:t[19]||(t[19]=(...e)=>o.filterCategories&&o.filterCategories(...e)),onKeydown:t[20]||(t[20]=(0,a.jR)((0,a.D$)((...e)=>o.addCustomCategory&&o.addCustomCategory(...e),["prevent"]),["enter"])),placeholder:"Search categories or type new...",class:"search-input"},null,544),[[a.Jo,o.categorySearchTerm]]),o.categorySearchTerm&&!o.availableCategories.includes(o.categorySearchTerm)?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:t[21]||(t[21]=(0,a.D$)((...e)=>o.addCustomCategory&&o.addCustomCategory(...e),["stop"])),class:"add-new-btn"},[t[89]||(t[89]=(0,s.Lk)("i",{class:"fas fa-plus"},null,-1)),(0,s.eW)(' Add "'+(0,d.v_)(o.categorySearchTerm)+'" ',1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",aW,[0!==o.filteredCategories.length||o.categorySearchTerm?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",sW," No categories available ")),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"option-item",onClick:t=>o.toggleCategory(e)},[(0,s.Lk)("input",{type:"checkbox",checked:o.selectedCategories.includes(e)},null,8,lW),(0,s.Lk)("span",null,(0,d.v_)(e),1)],8,oW))),128))])])):(0,s.Q3)("",!0)],2),o.validationErrors.RiskCategory?((0,s.uX)(),(0,s.CE)("div",nW,(0,d.v_)(o.validationErrors.RiskCategory),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",rW,[t[92]||(t[92]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-radiation-alt"}),(0,s.eW)("Criticality")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[22]||(t[22]=e=>o.formData.Criticality=e),onChange:t[23]||(t[23]=(...e)=>o.validateCriticality&&o.validateCriticality(...e)),"aria-invalid":!!o.validationErrors.Criticality,class:(0,d.C4)({error:o.validationErrors.Criticality}),title:"Rate the overall criticality level of this incident"},t[91]||(t[91]=[(0,s.Fv)('<option value="">Select Criticality</option><option value="Critical">Critical</option><option value="High">High</option><option value="Medium">Medium</option><option value="Low">Low</option>',5)]),42,cW),[[a.u1,o.formData.Criticality]]),o.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("div",dW,(0,d.v_)(o.validationErrors.Criticality),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",uW,[t[93]||(t[93]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-dollar-sign"}),(0,s.eW)("Cost of Incident")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[24]||(t[24]=e=>o.formData.CostOfIncident=e),onInput:t[25]||(t[25]=(...e)=>o.validateCost&&o.validateCost(...e)),onBlur:t[26]||(t[26]=(...e)=>o.validateCost&&o.validateCost(...e)),"aria-invalid":!!o.validationErrors.CostOfIncident,class:(0,d.C4)({error:o.validationErrors.CostOfIncident})},null,42,pW),[[a.Jo,o.formData.CostOfIncident]]),t[94]||(t[94]=(0,s.Lk)("div",{class:"field-helper-tip"}," Estimate the financial impact or cost of this incident (e.g., $50,000, €25,000.50, 100000) ",-1)),o.validationErrors.CostOfIncident?((0,s.uX)(),(0,s.CE)("div",mW,(0,d.v_)(o.validationErrors.CostOfIncident),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",vW,[t[95]||(t[95]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)("Possible Damage")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[27]||(t[27]=e=>o.formData.PossibleDamage=e),onInput:t[28]||(t[28]=(...e)=>o.validatePossibleDamage&&o.validatePossibleDamage(...e)),onBlur:t[29]||(t[29]=(...e)=>o.validatePossibleDamage&&o.validatePossibleDamage(...e))},null,544),[[a.Jo,o.formData.PossibleDamage]]),t[96]||(t[96]=(0,s.Lk)("div",{class:"field-helper-tip"}," Describe potential damage that could result from this incident (e.g., Data loss, customer trust impact, regulatory fines, business disruption, reputation damage...) ",-1)),o.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",kW,(0,d.v_)(o.validationErrors.PossibleDamage),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",hW,[t[98]||(t[98]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)("Business Unit")],-1)),(0,s.Lk)("div",gW,[(0,s.Lk)("div",{class:"multi-select-input",onClick:t[30]||(t[30]=(...e)=>o.toggleBusinessUnitDropdown&&o.toggleBusinessUnitDropdown(...e))},[(0,s.Lk)("div",yW,[0===o.selectedBusinessUnits.length?((0,s.uX)(),(0,s.CE)("span",fW," Select business units or type to add new... ")):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.selectedBusinessUnits,e=>((0,s.uX)(),(0,s.CE)("span",{key:e,class:"selected-item"},[(0,s.eW)((0,d.v_)(e)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:(0,a.D$)(t=>o.removeBusinessUnit(e),["stop"])},null,8,bW)]))),128))]),(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-chevron-down dropdown-arrow",{rotated:o.showBusinessUnitDropdown}])},null,2)]),o.showBusinessUnitDropdown?((0,s.uX)(),(0,s.CE)("div",CW,[(0,s.Lk)("div",LW,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=e=>o.businessUnitSearchTerm=e),onInput:t[32]||(t[32]=(...e)=>o.filterBusinessUnits&&o.filterBusinessUnits(...e)),onKeydown:t[33]||(t[33]=(0,a.jR)((0,a.D$)((...e)=>o.addCustomBusinessUnit&&o.addCustomBusinessUnit(...e),["prevent"]),["enter"])),placeholder:"Search business units or type new...",class:"search-input"},null,544),[[a.Jo,o.businessUnitSearchTerm]]),o.businessUnitSearchTerm&&!o.availableBusinessUnits.includes(o.businessUnitSearchTerm)?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",onClick:t[34]||(t[34]=(0,a.D$)((...e)=>o.addCustomBusinessUnit&&o.addCustomBusinessUnit(...e),["stop"])),class:"add-new-btn"},[t[97]||(t[97]=(0,s.Lk)("i",{class:"fas fa-plus"},null,-1)),(0,s.eW)(' Add "'+(0,d.v_)(o.businessUnitSearchTerm)+'" ',1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",wW,[0!==o.filteredBusinessUnits.length||o.businessUnitSearchTerm?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",EW," No business units available ")),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredBusinessUnits,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"option-item",onClick:t=>o.toggleBusinessUnit(e)},[(0,s.Lk)("input",{type:"checkbox",checked:o.selectedBusinessUnits.includes(e)},null,8,IW),(0,s.Lk)("span",null,(0,d.v_)(e),1)],8,RW))),128))])])):(0,s.Q3)("",!0)]),o.validationErrors.AffectedBusinessUnit?((0,s.uX)(),(0,s.CE)("div",DW,(0,d.v_)(o.validationErrors.AffectedBusinessUnit),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",PW,[t[99]||(t[99]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-map-marker-alt"}),(0,s.eW)("Location")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[35]||(t[35]=e=>o.formData.GeographicLocation=e),onInput:t[36]||(t[36]=(...e)=>o.validateGeographicLocation&&o.validateGeographicLocation(...e)),onBlur:t[37]||(t[37]=(...e)=>o.validateGeographicLocation&&o.validateGeographicLocation(...e))},null,544),[[a.Jo,o.formData.GeographicLocation]]),t[100]||(t[100]=(0,s.Lk)("div",{class:"field-helper-tip"}," Specify the geographic location where the incident occurred (e.g., New York Office, London Branch, Remote/Cloud, Data Center - Dallas...) ",-1)),o.validationErrors.GeographicLocation?((0,s.uX)(),(0,s.CE)("div",_W,(0,d.v_)(o.validationErrors.GeographicLocation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",AW,[t[101]||(t[101]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-server"}),(0,s.eW)("Systems Involved")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[38]||(t[38]=e=>o.formData.SystemsAssetsInvolved=e),onInput:t[39]||(t[39]=(...e)=>o.validateSystemsInvolved&&o.validateSystemsInvolved(...e)),onBlur:t[40]||(t[40]=(...e)=>o.validateSystemsInvolved&&o.validateSystemsInvolved(...e))},null,544),[[a.Jo,o.formData.SystemsAssetsInvolved]]),t[102]||(t[102]=(0,s.Lk)("div",{class:"field-helper-tip"}," List the systems, applications, or assets involved in the incident (e.g., Customer CRM, Payment Gateway, Email Server, Database XYZ, Network Infrastructure...) ",-1)),o.validationErrors.SystemsAssetsInvolved?((0,s.uX)(),(0,s.CE)("div",SW,(0,d.v_)(o.validationErrors.SystemsAssetsInvolved),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",TW,[t[104]||(t[104]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-tags"}),(0,s.eW)("Incident Classification")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[41]||(t[41]=e=>o.formData.IncidentClassification=e),onChange:t[42]||(t[42]=(...e)=>o.onClassificationChange&&o.onClassificationChange(...e)),title:"Classify the type of incident for proper handling and escalation"},t[103]||(t[103]=[(0,s.Fv)('<option value="">Select Classification</option><option value="NonConformance">NonConformance</option><option value="Control GAP">Control GAP</option><option value="Risk">Risk</option><option value="Issue">No Issue</option>',5)]),544),[[a.u1,o.formData.IncidentClassification]])]),(0,s.Lk)("label",xW,[t[105]||(t[105]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)("Initial Impact Assessment")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[43]||(t[43]=e=>o.formData.InitialImpactAssessment=e),onInput:t[44]||(t[44]=(...e)=>o.validateInitialImpact&&o.validateInitialImpact(...e)),onBlur:t[45]||(t[45]=(...e)=>o.validateInitialImpact&&o.validateInitialImpact(...e))},null,544),[[a.Jo,o.formData.InitialImpactAssessment]]),t[106]||(t[106]=(0,s.Lk)("div",{class:"field-helper-tip"}," Describe the immediate and potential impacts: operational disruption, customer impact, data exposure, service availability, compliance implications... ",-1)),o.validationErrors.InitialImpactAssessment?((0,s.uX)(),(0,s.CE)("div",FW,(0,d.v_)(o.validationErrors.InitialImpactAssessment),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",VW,[t[107]||(t[107]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)("Mitigation Steps")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[46]||(t[46]=e=>o.formData.Mitigation=e),onInput:t[47]||(t[47]=(...e)=>o.validateMitigation&&o.validateMitigation(...e)),onBlur:t[48]||(t[48]=(...e)=>o.validateMitigation&&o.validateMitigation(...e))},null,544),[[a.Jo,o.formData.Mitigation]]),t[108]||(t[108]=(0,s.Lk)("div",{class:"field-helper-tip"}," Detail the immediate actions taken and planned mitigation steps: containment measures, system isolation, patches applied, temporary workarounds... ",-1)),o.validationErrors.Mitigation?((0,s.uX)(),(0,s.CE)("div",UW,(0,d.v_)(o.validationErrors.Mitigation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",NW,[t[109]||(t[109]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-comments"}),(0,s.eW)("Comments")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[49]||(t[49]=e=>o.formData.Comments=e),onInput:t[50]||(t[50]=(...e)=>o.validateComments&&o.validateComments(...e)),onBlur:t[51]||(t[51]=(...e)=>o.validateComments&&o.validateComments(...e))},null,544),[[a.Jo,o.formData.Comments]]),t[110]||(t[110]=(0,s.Lk)("div",{class:"field-helper-tip"}," Additional observations, context, or relevant information not covered elsewhere... ",-1)),o.validationErrors.Comments?((0,s.uX)(),(0,s.CE)("div",MW,(0,d.v_)(o.validationErrors.Comments),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",XW,[t[111]||(t[111]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-users"}),(0,s.eW)("Internal Contacts")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[52]||(t[52]=e=>o.formData.InternalContacts=e),onInput:t[53]||(t[53]=(...e)=>o.validateInternalContacts&&o.validateInternalContacts(...e)),onBlur:t[54]||(t[54]=(...e)=>o.validateInternalContacts&&o.validateInternalContacts(...e))},null,544),[[a.Jo,o.formData.InternalContacts]]),t[112]||(t[112]=(0,s.Lk)("div",{class:"field-helper-tip"}," Names and roles of internal staff involved (e.g., John Smith (IT Manager), Sarah Jones (Security Lead)...) ",-1)),o.validationErrors.InternalContacts?((0,s.uX)(),(0,s.CE)("div",$W,(0,d.v_)(o.validationErrors.InternalContacts),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",OW,[t[113]||(t[113]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)("External Parties")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[55]||(t[55]=e=>o.formData.ExternalPartiesInvolved=e),onInput:t[56]||(t[56]=(...e)=>o.validateExternalParties&&o.validateExternalParties(...e)),onBlur:t[57]||(t[57]=(...e)=>o.validateExternalParties&&o.validateExternalParties(...e))},null,544),[[a.Jo,o.formData.ExternalPartiesInvolved]]),t[114]||(t[114]=(0,s.Lk)("div",{class:"field-helper-tip"}," External organizations, vendors, customers, or partners affected (e.g., ABC Vendor, Customer Portal Users, Third-party Service Provider...) ",-1)),o.validationErrors.ExternalPartiesInvolved?((0,s.uX)(),(0,s.CE)("div",jW,(0,d.v_)(o.validationErrors.ExternalPartiesInvolved),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",BW,[t[115]||(t[115]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-gavel"}),(0,s.eW)("Regulatory Bodies")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[58]||(t[58]=e=>o.formData.RegulatoryBodies=e),onInput:t[59]||(t[59]=(...e)=>o.validateRegulatoryBodies&&o.validateRegulatoryBodies(...e)),onBlur:t[60]||(t[60]=(...e)=>o.validateRegulatoryBodies&&o.validateRegulatoryBodies(...e))},null,544),[[a.Jo,o.formData.RegulatoryBodies]]),t[116]||(t[116]=(0,s.Lk)("div",{class:"field-helper-tip"}," Relevant regulatory authorities (e.g., SEC, GDPR Authority, FINRA, HIPAA, PCI DSS Council...) ",-1)),o.validationErrors.RegulatoryBodies?((0,s.uX)(),(0,s.CE)("div",WW,(0,d.v_)(o.validationErrors.RegulatoryBodies),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",qW,[t[117]||(t[117]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)("Violated Policies/Procedures")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[61]||(t[61]=e=>o.formData.RelevantPoliciesProceduresViolated=e),onInput:t[62]||(t[62]=(...e)=>o.validateViolatedPolicies&&o.validateViolatedPolicies(...e)),onBlur:t[63]||(t[63]=(...e)=>o.validateViolatedPolicies&&o.validateViolatedPolicies(...e))},null,544),[[a.Jo,o.formData.RelevantPoliciesProceduresViolated]]),t[118]||(t[118]=(0,s.Lk)("div",{class:"field-helper-tip"}," List specific policies, procedures, or standards that were violated (e.g., Data Protection Policy section 3.2, Access Control Procedure, Change Management Process...) ",-1)),o.validationErrors.RelevantPoliciesProceduresViolated?((0,s.uX)(),(0,s.CE)("div",QW,(0,d.v_)(o.validationErrors.RelevantPoliciesProceduresViolated),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",KW,[t[119]||(t[119]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-times-circle"}),(0,s.eW)("Control Failures")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[64]||(t[64]=e=>o.formData.ControlFailures=e),onInput:t[65]||(t[65]=(...e)=>o.validateControlFailures&&o.validateControlFailures(...e)),onBlur:t[66]||(t[66]=(...e)=>o.validateControlFailures&&o.validateControlFailures(...e))},null,544),[[a.Jo,o.formData.ControlFailures]]),t[120]||(t[120]=(0,s.Lk)("div",{class:"field-helper-tip"}," Identify failed controls (e.g., firewall misconfiguration, inadequate access controls, missing monitoring, failed backup procedures...) ",-1)),o.validationErrors.ControlFailures?((0,s.uX)(),(0,s.CE)("div",JW,(0,d.v_)(o.validationErrors.ControlFailures),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("label",zW,[t[121]||(t[121]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-lightbulb"}),(0,s.eW)("Lessons Learned")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[67]||(t[67]=e=>o.formData.LessonsLearned=e),title:"Document key insights and lessons learned from this incident for future prevention"},null,512),[[a.Jo,o.formData.LessonsLearned]]),t[122]||(t[122]=(0,s.Lk)("div",{class:"field-helper-tip"}," What can be learned from this incident? What should be done differently next time? What processes need improvement? What preventive measures can be implemented... ",-1))]),o.showComplianceMapping?((0,s.uX)(),(0,s.CE)("div",HW,[(0,s.Lk)("label",GW,[t[127]||(t[127]=(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-link"}),(0,s.eW)("Map to Existing Compliance")],-1)),(0,s.Lk)("div",{class:"compliance-selector",onClick:t[73]||(t[73]=(0,a.D$)(()=>{},["stop"]))},[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[68]||(t[68]=e=>o.complianceSearchTerm=e),placeholder:"Search compliances by description, policy name, or framework...",onInput:t[69]||(t[69]=(...e)=>o.filterCompliances&&o.filterCompliances(...e)),onFocus:t[70]||(t[70]=e=>o.showDropdown=!0),onBlur:t[71]||(t[71]=(...e)=>o.hideDropdownDelayed&&o.hideDropdownDelayed(...e)),class:"compliance-search",title:"Search and select a compliance requirement to link with this incident"},null,544),[[a.Jo,o.complianceSearchTerm]]),o.loadingCompliances?((0,s.uX)(),(0,s.CE)("div",YW,t[123]||(t[123]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading compliances... ")]))):0===o.compliances.length?((0,s.uX)(),(0,s.CE)("div",ZW,t[124]||(t[124]=[(0,s.Lk)("div",{class:"external-risk-message"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.Lk)("div",null,[(0,s.Lk)("strong",null,"No Compliances Available"),(0,s.Lk)("p",null,[(0,s.eW)("This incident will be saved as an "),(0,s.Lk)("strong",null,"External Risk"),(0,s.eW)(" since no compliance items are available in the system.")])])],-1)]))):o.showDropdown&&o.filteredCompliances.length>0?((0,s.uX)(),(0,s.CE)("div",eq,[o.complianceSearchTerm?((0,s.uX)(),(0,s.CE)("div",iq,[(0,s.Lk)("small",null,[t[126]||(t[126]=(0,s.Lk)("i",{class:"fas fa-search"},null,-1)),(0,s.eW)(" Found "+(0,d.v_)(o.filteredCompliances.length)+' compliance(s) matching "'+(0,d.v_)(o.complianceSearchTerm)+'"',1)])])):((0,s.uX)(),(0,s.CE)("div",tq,[(0,s.Lk)("small",null,[t[125]||(t[125]=(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1)),(0,s.eW)(" Showing "+(0,d.v_)(o.filteredCompliances.length)+" total compliances. Use search to filter results.",1)])])),(0,s.Lk)("div",aq,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,onClick:t=>o.selectCompliance(e),class:(0,d.C4)(["compliance-option",{selected:o.formData.ComplianceId===e.ComplianceId}])},[(0,s.Lk)("div",oq,[(0,s.Lk)("input",{type:"radio",id:"compliance-"+e.ComplianceId,value:e.ComplianceId,checked:o.formData.ComplianceId===e.ComplianceId,onClick:t[72]||(t[72]=(0,a.D$)(()=>{},["stop"])),onChange:t=>o.selectCompliance(e)},null,40,lq),(0,s.Lk)("label",{for:"compliance-"+e.ComplianceId,class:"radio-label"},null,8,nq)]),(0,s.Lk)("div",rq,[(0,s.Lk)("div",cq,[(0,s.Lk)("strong",null,(0,d.v_)(e.ComplianceItemDescription),1),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality","criticality-"+(e.Criticality||"medium").toLowerCase()])},(0,d.v_)(e.Criticality),3)]),(0,s.Lk)("div",dq,[(0,s.Lk)("span",uq,(0,d.v_)(e.SubPolicy?.Policy?.Framework?.FrameworkName||"No Framework"),1),(0,s.Lk)("span",pq,(0,d.v_)(e.SubPolicy?.Policy?.PolicyName||"No Policy"),1)]),e.Mitigation&&"string"===typeof e.Mitigation?((0,s.uX)(),(0,s.CE)("div",mq,[(0,s.Lk)("small",null,(0,d.v_)(o.safeSubstring(e.Mitigation,100)),1)])):(0,s.Q3)("",!0)])],10,sq))),128))])])):!o.loadingCompliances&&o.complianceSearchTerm&&o.showDropdown?((0,s.uX)(),(0,s.CE)("div",vq,' No compliances found matching "'+(0,d.v_)(o.complianceSearchTerm)+'" ',1)):(0,s.Q3)("",!0)])]),o.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",kq,[t[134]||(t[134]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-check-circle"}),(0,s.eW)(" Selected Compliance")],-1)),(0,s.Lk)("div",hq,[(0,s.Lk)("div",gq,[(0,s.Lk)("strong",null,(0,d.v_)(o.selectedCompliance.ComplianceItemDescription),1),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality","criticality-"+(o.selectedCompliance.Criticality||"medium").toLowerCase()])},(0,d.v_)(o.selectedCompliance.Criticality),3)]),(0,s.Lk)("div",yq,[(0,s.Lk)("p",null,[t[128]||(t[128]=(0,s.Lk)("strong",null,"Framework:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.SubPolicy?.Policy?.Framework?.FrameworkName||"N/A"),1)]),(0,s.Lk)("p",null,[t[129]||(t[129]=(0,s.Lk)("strong",null,"Policy:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.SubPolicy?.Policy?.PolicyName||"N/A"),1)]),(0,s.Lk)("p",null,[t[130]||(t[130]=(0,s.Lk)("strong",null,"Sub Policy:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.SubPolicy?.SubPolicyName||"N/A"),1)]),o.selectedCompliance.Mitigation&&"string"===typeof o.selectedCompliance.Mitigation?((0,s.uX)(),(0,s.CE)("p",fq,[t[131]||(t[131]=(0,s.Lk)("strong",null,"Mitigation:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.Mitigation),1)])):(0,s.Q3)("",!0),o.selectedCompliance.PossibleDamage&&"string"===typeof o.selectedCompliance.PossibleDamage?((0,s.uX)(),(0,s.CE)("p",bq,[t[132]||(t[132]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedCompliance.PossibleDamage),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{type:"button",onClick:t[74]||(t[74]=(...e)=>o.clearCompliance&&o.clearCompliance(...e)),class:"clear-compliance-btn"},t[133]||(t[133]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Clear Selection ")]))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),o.showComplianceMapping?((0,s.uX)(),(0,s.CE)("div",Cq,[t[139]||(t[139]=(0,s.Lk)("div",{class:"status-header"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("strong",null,"Incident Information")],-1)),(0,s.Lk)("div",Lq,[(0,s.Lk)("div",wq,[t[135]||(t[135]=(0,s.Lk)("span",{class:"label"},"Type:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["value","incident-type-"+o.incidentType.toLowerCase().replace(/[^a-z]/g,"-")])},(0,d.v_)(o.incidentType),3)]),o.selectedCompliance?((0,s.uX)(),(0,s.CE)("div",Eq,[t[136]||(t[136]=(0,s.Lk)("span",{class:"label"},"Linked Compliance:",-1)),(0,s.Lk)("span",Rq,(0,d.v_)(o.selectedCompliance.ComplianceItemDescription),1)])):o.showComplianceMapping&&0===o.compliances.length?((0,s.uX)(),(0,s.CE)("div",Iq,t[137]||(t[137]=[(0,s.Lk)("span",{class:"label"},"Note:",-1),(0,s.Lk)("span",{class:"value warning"},"No compliance items available - saving as external risk",-1)]))):o.showComplianceMapping?((0,s.uX)(),(0,s.CE)("div",Dq,t[138]||(t[138]=[(0,s.Lk)("span",{class:"label"},"Note:",-1),(0,s.Lk)("span",{class:"value"},"No compliance selected - will save as external risk",-1)]))):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Pq,[(0,s.Lk)("button",{type:"button",onClick:t[75]||(t[75]=(...e)=>o.cancel&&o.cancel(...e)),class:"incident-cancel-btn"},t[140]||(t[140]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Cancel ")])),(0,s.Lk)("button",{type:"submit",class:"incident-submit-btn",disabled:!o.isReadyToSubmit,title:o.isReadyToSubmit?`Create ${o.incidentType}`:"Please fill in all required fields"},[t[141]||(t[141]=(0,s.Lk)("i",{class:"fas fa-save"},null,-1)),(0,s.eW)(" Create "+(0,d.v_)(o.incidentType),1)],8,_q)])],32)]),(0,s.bF)(r)])}var Sq={name:"CreateIncident",components:{PopupModal:Ck.wA},setup(){const e=(0,ae.rd)(),t=(0,ie.KR)({IncidentTitle:"",Description:"",Mitigation:"",Date:"",Time:"",Origin:"",Comments:"",RiskCategory:"",RiskPriority:"",Status:"Open",AffectedBusinessUnit:"",SystemsAssetsInvolved:"",GeographicLocation:"",Criticality:"",TimelineOfEvents:"",InitialImpactAssessment:"",InternalContacts:"",ExternalPartiesInvolved:"",RegulatoryBodies:"",RelevantPoliciesProceduresViolated:"",ControlFailures:"",LessonsLearned:"",CostOfIncident:"",PossibleDamage:"",RepeatedNot:!1,ReopenedNot:!1,IncidentClassification:"",ComplianceId:null}),i=(0,ie.KR)({}),a=(0,ie.KR)(!1),o=(0,ie.KR)([]),l=(0,ie.KR)(""),n=(0,ie.KR)(null),r=(0,ie.KR)(!1),c=(0,ie.KR)(!1),d=(0,ie.KR)([]),u=(0,ie.KR)([]),p=(0,ie.KR)(""),m=(0,ie.KR)(!1),v=(0,ie.KR)([]),k=(0,ie.KR)([]),h=(0,ie.KR)([]),g=(0,ie.KR)(""),y=(0,ie.KR)(!1),f=(0,ie.KR)([]),b=(e,t=100)=>e&&"string"===typeof e?e.length>t?e.substring(0,t)+"...":e:"",C=(0,s.EW)(()=>"NonConformance"===t.value.IncidentClassification||"Control GAP"===t.value.IncidentClassification),L=(0,s.EW)(()=>l.value?o.value.filter(e=>{const t=l.value.toLowerCase();return e.ComplianceItemDescription&&"string"===typeof e.ComplianceItemDescription&&e.ComplianceItemDescription.toLowerCase().includes(t)||e.Identifier&&"string"===typeof e.Identifier&&e.Identifier.toLowerCase().includes(t)||e.SubPolicy?.Policy?.PolicyName&&"string"===typeof e.SubPolicy.Policy.PolicyName&&e.SubPolicy.Policy.PolicyName.toLowerCase().includes(t)||e.SubPolicy?.Policy?.Framework?.FrameworkName&&"string"===typeof e.SubPolicy.Policy.Framework.FrameworkName&&e.SubPolicy.Policy.Framework.FrameworkName.toLowerCase().includes(t)}):o.value),w=(0,s.EW)(()=>C.value?0===o.value.length?"External Risk":n.value?"Compliance-Linked Incident":"External Risk":"Regular Incident"),E=(0,s.EW)(()=>{const e=t.value.IncidentTitle&&t.value.Description&&t.value.Date&&t.value.Time&&t.value.RiskPriority&&u.value.length>0,a=0===Object.keys(i.value).length,s=e&&a;return s||(console.log("=== FORM NOT READY - DEBUG INFO ==="),console.log("Missing required fields:",{IncidentTitle:!t.value.IncidentTitle,Description:!t.value.Description,Date:!t.value.Date,Time:!t.value.Time,RiskPriority:!t.value.RiskPriority,Categories:0===u.value.length}),console.log("Validation errors:",i.value),console.log("Has required fields:",e),console.log("Has no errors:",a)),s}),R=/^[a-zA-Z0-9\s\-_.,!?():;/\\@#$%&*+=<>[\]{}|~`"']*$/,I=/^[a-zA-Z0-9\s\-_.,!?()]*$/,D=/^[a-zA-Z0-9\s\-_.,!?()&]*$/,P=/^[$£€]?[0-9]+(\.[0-9]{1,2})?$/,_=(e,t,i={})=>{const{required:a=!1,minLength:s=0,maxLength:o=255,pattern:l=null}=i;if(a&&(!e||""===e.trim()))return`${t} is required`;if(!a&&(!e||""===e.trim()))return null;const n=e.trim();return n.length<s?`${t} must be at least ${s} characters`:n.length>o?`${t} must be no more than ${o} characters`:l&&!l.test(n)?`${t} contains invalid characters`:null},A=()=>{const e=t.value.CostOfIncident;e&&!P.test(e.toString().trim())?i.value.CostOfIncident="Must be a valid currency amount (e.g., $100.50, 250.75)":delete i.value.CostOfIncident},S=()=>{const e=_(t.value.IncidentTitle,"Incident Title",{required:!0,minLength:3,maxLength:255,pattern:R});e?i.value.IncidentTitle=e:delete i.value.IncidentTitle},T=()=>{const e=_(t.value.Description,"Description",{required:!0,minLength:10,maxLength:2e3,pattern:R});e?i.value.Description=e:delete i.value.Description},x=()=>{const e=["Manual","Audit Finding","System Generated"];t.value.Origin?e.includes(t.value.Origin)?delete i.value.Origin:i.value.Origin="Must be one of: Manual, Audit Finding, System Generated":delete i.value.Origin},F=()=>{t.value.Date?delete i.value.Date:i.value.Date="Date is required"},V=()=>{t.value.Time?delete i.value.Time:i.value.Time="Time is required"},U=()=>{const e=["High","Medium","Low"];t.value.RiskPriority?e.includes(t.value.RiskPriority)?delete i.value.RiskPriority:i.value.RiskPriority="Must be one of: High, Medium, Low":i.value.RiskPriority="Risk priority is required"},N=()=>{if(0===u.value.length)i.value.RiskCategory="At least one risk category is required";else{const e=u.value.filter(e=>{const t=e&&e.length<=100&&D.test(e);return!t});e.length>0?i.value.RiskCategory="One or more categories contain invalid characters or are too long":delete i.value.RiskCategory}},M=()=>{const e=["Critical","High","Medium","Low"];t.value.Criticality&&!e.includes(t.value.Criticality)?i.value.Criticality="Must be one of: Critical, High, Medium, Low":delete i.value.Criticality},X=()=>{const e=_(t.value.PossibleDamage,"Possible Damage",{maxLength:1e3,pattern:R});e?i.value.PossibleDamage=e:delete i.value.PossibleDamage},$=()=>{if(h.value.length>0){const e=h.value.filter(e=>!e||e.length>100||!I.test(e));e.length>0?i.value.AffectedBusinessUnit="One or more business units contain invalid characters or are too long":delete i.value.AffectedBusinessUnit}else delete i.value.AffectedBusinessUnit},O=()=>{const e=_(t.value.GeographicLocation,"Geographic Location",{maxLength:100,pattern:I});e?i.value.GeographicLocation=e:delete i.value.GeographicLocation},j=()=>{const e=_(t.value.SystemsAssetsInvolved,"Systems Involved",{maxLength:500,pattern:R});e?i.value.SystemsAssetsInvolved=e:delete i.value.SystemsAssetsInvolved},B=()=>{const e=_(t.value.InitialImpactAssessment,"Initial Impact Assessment",{maxLength:2e3,pattern:R});e?i.value.InitialImpactAssessment=e:delete i.value.InitialImpactAssessment},W=()=>{const e=_(t.value.Mitigation,"Mitigation Steps",{maxLength:2e3,pattern:R});e?i.value.Mitigation=e:delete i.value.Mitigation},q=()=>{const e=_(t.value.Comments,"Comments",{maxLength:1e3,pattern:R});e?i.value.Comments=e:delete i.value.Comments},Q=()=>{const e=_(t.value.InternalContacts,"Internal Contacts",{maxLength:500,pattern:R});e?i.value.InternalContacts=e:delete i.value.InternalContacts},K=()=>{const e=_(t.value.ExternalPartiesInvolved,"External Parties",{maxLength:500,pattern:R});e?i.value.ExternalPartiesInvolved=e:delete i.value.ExternalPartiesInvolved},J=()=>{const e=_(t.value.RegulatoryBodies,"Regulatory Bodies",{maxLength:500,pattern:R});e?i.value.RegulatoryBodies=e:delete i.value.RegulatoryBodies},z=()=>{const e=_(t.value.RelevantPoliciesProceduresViolated,"Violated Policies/Procedures",{maxLength:1e3,pattern:R});e?i.value.RelevantPoliciesProceduresViolated=e:delete i.value.RelevantPoliciesProceduresViolated},H=()=>{const e=_(t.value.ControlFailures,"Control Failures",{maxLength:1e3,pattern:R});e?i.value.ControlFailures=e:delete i.value.ControlFailures},G=()=>{i.value={};const e=["IncidentTitle","Description","Origin","Date","Time","RiskPriority"];let a=!0;for(const s of e)t.value[s]&&("string"!==typeof t.value[s]||t.value[s].trim())||(i.value[s]=`${s.replace(/([A-Z])/g," $1").trim()} is required`,a=!1);return 0===u.value.length&&(i.value.RiskCategory="At least one risk category is required",a=!1),a},Y=()=>{console.log("Validation errors:",i.value),Object.entries(i.value).forEach(([e,t])=>{console.log(`${e}: ${t}`)})},Z=async()=>{if(!(o.value.length>0)){r.value=!0;try{const e=await He.A.get("/api/incident-compliances/");if(e.data.success){o.value=e.data.data,console.log("Loaded compliances:",o.value.length);const t=o.value.filter(e=>e.Mitigation&&"string"!==typeof e.Mitigation||e.PossibleDamage&&"string"!==typeof e.PossibleDamage||e.ComplianceItemDescription&&"string"!==typeof e.ComplianceItemDescription);t.length>0&&console.warn("Found compliances with invalid data types:",t)}else console.error("Failed to fetch compliances:",e.data.message)}catch(e){console.error("Error fetching compliances:",e),Tr.wr.handleApiError(e,"view compliances")||Ck.OQ.error("Failed to load compliances. Please try again.")}finally{r.value=!1}}},ee=()=>{C.value?(Z(),c.value=!1):(t.value.ComplianceId=null,n.value=null,l.value="",c.value=!1)},te=e=>{t.value.ComplianceId=e.ComplianceId,n.value=e,l.value="",c.value=!1,!t.value.PossibleDamage&&e.PossibleDamage&&"string"===typeof e.PossibleDamage&&(t.value.PossibleDamage=e.PossibleDamage),!t.value.Mitigation&&e.Mitigation&&"string"===typeof e.Mitigation&&(t.value.Mitigation=e.Mitigation),!t.value.Criticality&&e.Criticality&&"string"===typeof e.Criticality&&(t.value.Criticality=e.Criticality),console.log("Selected compliance:",e.ComplianceId,e.ComplianceItemDescription),console.log("Dropdown closed after selection")},se=()=>{t.value.ComplianceId=null,n.value=null,l.value="",c.value=!1,console.log("Compliance selection cleared")},oe=()=>{l.value.length>0&&(c.value=!0)},le=()=>{setTimeout(()=>{c.value=!1},150)},ne=async()=>{if(console.log("=== SUBMIT ATTEMPT ==="),!G())return console.log("Form validation failed"),Y(),void Ck.OQ.error("Please correct the validation errors before submitting. Check the console for details.");console.log("Form validation passed, submitting..."),await re()},re=async()=>{try{const i={...t.value};n.value&&t.value.ComplianceId?console.log("Compliance selected:",n.value.ComplianceItemDescription):(i.ComplianceId=null,console.log("No compliance selected - saving as external risk")),console.log("Submitting incident with data:",i);const a=await He.A.post("/api/incidents/create/",i);201===a.status&&(Ck.OQ.success("Incident created successfully! It has been saved to the incidents table and will be escalated to risk management when needed."),setTimeout(()=>{e.push("/incident/incident")},2e3))}catch(a){if(console.error("Error creating incident:",a),!Tr.wr.handleApiError(a,"create incidents"))if(a.response&&a.response.data){const e=a.response.data;Object.keys(e).forEach(t=>{i.value[t]=Array.isArray(e[t])?e[t][0]:e[t]}),Ck.OQ.error("Please correct the validation errors and try again.")}else Ck.OQ.error("Error creating incident. Please try again.")}},ce=()=>{e.push("/incident/incident")},de=async()=>{if(t.value.IncidentTitle&&t.value.Description)if(t.value.IncidentTitle.trim().length<3)Ck.OQ.error("Incident title must be at least 3 characters long.");else if(t.value.Description.trim().length<10)Ck.OQ.error("Incident description must be at least 10 characters long.");else{a.value=!0;try{Ck.OQ.info("Generating analysis... This may take a few moments.");const e=await He.A.post("api/incidents/generate-analysis/",{title:t.value.IncidentTitle.trim(),description:t.value.Description.trim()},{timeout:6e4});if(!e.data.success||!e.data.analysis)throw new Error(e.data.error||"Analysis failed");{const a=e.data.analysis;if(console.log("Analysis received:",a),console.log("possibleDamage type:",typeof a.possibleDamage,"value:",a.possibleDamage),console.log("initialImpactAssessment type:",typeof a.initialImpactAssessment,"value:",a.initialImpactAssessment),console.log("mitigationSteps type:",typeof a.mitigationSteps,"value:",a.mitigationSteps),console.log("systemsInvolved type:",typeof a.systemsInvolved,"value:",a.systemsInvolved),a.riskPriority){const e={P0:"High",P1:"High",P2:"Medium",P3:"Low"};t.value.RiskPriority=e[a.riskPriority]||a.riskPriority}if(a.criticality&&(t.value.Criticality=a.criticality),a.costOfIncident&&(t.value.CostOfIncident=a.costOfIncident),a.possibleDamage)if("string"===typeof a.possibleDamage)t.value.PossibleDamage=a.possibleDamage;else if("object"===typeof a.possibleDamage){const e=Object.entries(a.possibleDamage).map(([e,t])=>`${e}: ${t}`).join("\n");t.value.PossibleDamage=e}if(a.systemsInvolved&&(Array.isArray(a.systemsInvolved)?t.value.SystemsAssetsInvolved=a.systemsInvolved.join(", "):"string"===typeof a.systemsInvolved&&(t.value.SystemsAssetsInvolved=a.systemsInvolved)),a.initialImpactAssessment)if("string"===typeof a.initialImpactAssessment)t.value.InitialImpactAssessment=a.initialImpactAssessment;else if("object"===typeof a.initialImpactAssessment){const e=Object.entries(a.initialImpactAssessment).map(([e,t])=>`${e}: ${t}`).join("\n");t.value.InitialImpactAssessment=e}if(a.mitigationSteps)if(Array.isArray(a.mitigationSteps))t.value.Mitigation=a.mitigationSteps.join("\n");else if("object"===typeof a.mitigationSteps){const e=Object.entries(a.mitigationSteps).map(([e,t])=>`${e}: ${t}`).join("\n");t.value.Mitigation=e}if(a.comments&&(t.value.Comments=a.comments),a.violatedPolicies&&(Array.isArray(a.violatedPolicies)?t.value.RelevantPoliciesProceduresViolated=a.violatedPolicies.join("\n"):"string"===typeof a.violatedPolicies&&(t.value.RelevantPoliciesProceduresViolated=a.violatedPolicies)),a.procedureControlFailures&&(Array.isArray(a.procedureControlFailures)?t.value.ControlFailures=a.procedureControlFailures.join("\n"):"string"===typeof a.procedureControlFailures&&(t.value.ControlFailures=a.procedureControlFailures)),a.lessonsLearned&&(Array.isArray(a.lessonsLearned)?t.value.LessonsLearned=a.lessonsLearned.join("\n"):"string"===typeof a.lessonsLearned&&(t.value.LessonsLearned=a.lessonsLearned)),a.riskCategory||a.category){const e=a.riskCategory||a.category;if(u.value=[],"string"===typeof e){const t=e.split(/[,;|&]/).map(e=>e.trim()).filter(e=>e.length>0);for(const e of t)d.value.some(t=>t.toLowerCase()===e.toLowerCase())||d.value.push(e),u.value.includes(e)||u.value.push(e);ge()}}console.log("Final form values after analysis:"),console.log("PossibleDamage:",t.value.PossibleDamage),console.log("InitialImpactAssessment:",t.value.InitialImpactAssessment),console.log("Mitigation:",t.value.Mitigation),console.log("SystemsAssetsInvolved:",t.value.SystemsAssetsInvolved),console.log("RelevantPoliciesProceduresViolated:",t.value.RelevantPoliciesProceduresViolated),console.log("ControlFailures:",t.value.ControlFailures),console.log("LessonsLearned:",t.value.LessonsLearned),Object.keys(i.value).forEach(e=>{t.value[e]&&t.value[e].toString().trim()&&delete i.value[e]}),Ck.OQ.success("Analysis completed! Form fields have been populated with AI-generated insights. Please review and modify as needed before saving.")}}catch(e){if(console.error("Error generating analysis:",e),!Tr.wr.handleApiError(e,"generate incident analysis")){let t="Failed to generate analysis. ";"ECONNABORTED"===e.code?t+="Request timed out. The server took too long to respond. Please try again or fill the form manually.":e.response&&e.response.data&&e.response.data.error?t+=e.response.data.error:e.message?t+=e.message:t+="Please try again or fill the form manually.",Ck.OQ.error(t)}}finally{a.value=!1}}else Ck.OQ.error("Please enter both incident title and description before generating analysis.")},ue=async()=>{try{const e=await He.A.get("/api/categories/");d.value=e.data,v.value=e.data}catch(e){console.error("Error fetching categories:",e),Tr.wr.handleApiError(e,"view categories")||Ck.OQ.error("Failed to load categories. Please try again.")}},pe=()=>{m.value=!m.value,m.value&&(v.value=d.value)},me=()=>{const e=p.value.toLowerCase();v.value=d.value.filter(t=>t.toLowerCase().includes(e))},ve=e=>{u.value.includes(e)?u.value=u.value.filter(t=>t!==e):u.value.push(e),ge()},ke=e=>{u.value=u.value.filter(t=>t!==e),ge()},he=async()=>{const e=p.value.trim();if(console.log("Adding custom category:",e),e&&!d.value.some(t=>t.toLowerCase()===e.toLowerCase()))try{console.log("Posting new category to API:",e);const t=await He.A.post("/api/categories/add/",{value:e});console.log("API response:",t.data);const a=t.data.value||e;d.value.includes(a)||(d.value.push(a),console.log("Added to available categories:",a)),u.value.includes(a)||(u.value.push(a),console.log("Added to selected categories:",a)),p.value="",v.value=d.value,ge(),setTimeout(()=>{u.value.length>0&&(delete i.value.RiskCategory,console.log("Force cleared RiskCategory validation error"))},100),Ck.OQ.success(`Category "${a}" added successfully!`)}catch(t){console.error("Error adding category:",t),Tr.wr.handleApiError(t,"add categories")||Ck.OQ.error("Failed to add category. Please try again.")}else if(e&&d.value.some(t=>t.toLowerCase()===e.toLowerCase())){const t=d.value.find(t=>t.toLowerCase()===e.toLowerCase());console.log("Category already exists, selecting:",t),u.value.includes(t)||(u.value.push(t),ge()),p.value=""}else e?console.log("Category already selected:",e):console.log("Empty category name provided")},ge=()=>{t.value.RiskCategory=u.value.join(", "),N()},ye=async()=>{try{const e=await He.A.get("/api/business-units/");k.value=e.data,f.value=e.data}catch(e){console.error("Error fetching business units:",e),Tr.wr.handleApiError(e,"view business units")||Ck.OQ.error("Failed to load business units. Please try again.")}},fe=()=>{y.value=!y.value,y.value&&(f.value=k.value)},be=()=>{const e=g.value.toLowerCase();f.value=k.value.filter(t=>t.toLowerCase().includes(e))},Ce=e=>{h.value.includes(e)?h.value=h.value.filter(t=>t!==e):h.value.push(e),Ee()},Le=e=>{h.value=h.value.filter(t=>t!==e),Ee()},we=async()=>{const e=g.value.trim();if(console.log("Adding custom business unit:",e),e&&!k.value.some(t=>t.toLowerCase()===e.toLowerCase()))try{console.log("Posting new business unit to API:",e);const t=await He.A.post("/api/business-units/add/",{value:e});console.log("API response:",t.data);const a=t.data.value||e;k.value.includes(a)||(k.value.push(a),console.log("Added to available business units:",a)),h.value.includes(a)||(h.value.push(a),console.log("Added to selected business units:",a)),g.value="",f.value=k.value,Ee(),setTimeout(()=>{delete i.value.AffectedBusinessUnit,console.log("Force cleared AffectedBusinessUnit validation error")},100),Ck.OQ.success(`Business unit "${a}" added successfully!`)}catch(t){console.error("Error adding business unit:",t),Tr.wr.handleApiError(t,"add business units")||Ck.OQ.error("Failed to add business unit. Please try again.")}else if(e&&k.value.some(t=>t.toLowerCase()===e.toLowerCase())){const t=k.value.find(t=>t.toLowerCase()===e.toLowerCase());console.log("Business unit already exists, selecting:",t),h.value.includes(t)||(h.value.push(t),Ee()),g.value=""}else e?console.log("Business unit already selected:",e):console.log("Empty business unit name provided")},Ee=()=>{t.value.AffectedBusinessUnit=h.value.join(", "),$()},Re=()=>{t.value.RiskCategory&&(u.value=t.value.RiskCategory.split(", ").filter(e=>e.trim())),t.value.AffectedBusinessUnit&&(h.value=t.value.AffectedBusinessUnit.split(", ").filter(e=>e.trim()))};return(0,s.sV)(()=>{ue(),ye(),Re();const e=e=>{const t=document.querySelector(".compliance-selector"),i=document.querySelector(".multi-select-dropdown");t&&!t.contains(e.target)&&(c.value=!1),i&&!e.target.closest(".multi-select-dropdown")&&(m.value=!1,y.value=!1)};document.addEventListener("click",e),(0,s.hi)(()=>{document.removeEventListener("click",e)})}),{formData:t,validationErrors:i,compliances:o,complianceSearchTerm:l,selectedCompliance:n,loadingCompliances:r,showDropdown:c,showComplianceMapping:C,filteredCompliances:L,availableCategories:d,selectedCategories:u,categorySearchTerm:p,showCategoryDropdown:m,filteredCategories:v,availableBusinessUnits:k,selectedBusinessUnits:h,businessUnitSearchTerm:g,showBusinessUnitDropdown:y,filteredBusinessUnits:f,safeSubstring:b,onClassificationChange:ee,selectCompliance:te,clearCompliance:se,filterCompliances:oe,hideDropdownDelayed:le,isGeneratingAnalysis:a,fetchCategories:ue,toggleCategoryDropdown:pe,filterCategories:me,toggleCategory:ve,removeCategory:ke,addCustomCategory:he,updateFormDataCategories:ge,fetchBusinessUnits:ye,toggleBusinessUnitDropdown:fe,filterBusinessUnits:be,toggleBusinessUnit:Ce,removeBusinessUnit:Le,addCustomBusinessUnit:we,updateFormDataBusinessUnits:Ee,initializeSelectedData:Re,validateCost:A,validateIncidentTitle:S,validateDescription:T,validateOrigin:x,validateDate:F,validateTime:V,validateRiskPriority:U,validateRiskCategory:N,validateCriticality:M,validatePossibleDamage:X,validateBusinessUnit:$,validateGeographicLocation:O,validateSystemsInvolved:j,validateInitialImpact:B,validateMitigation:W,validateComments:q,validateInternalContacts:Q,validateExternalParties:K,validateRegulatoryBodies:J,validateViolatedPolicies:z,validateControlFailures:H,validateAndSubmit:ne,submitForm:re,cancel:ce,generateAnalysis:de,incidentType:w,isReadyToSubmit:E}}};const Tq=(0,le.A)(Sq,[["render",Aq]]);var xq=Tq;const Fq={class:"incident-dashboard-wrapper"},Vq={class:"kpi-row"},Uq={class:"kpi-card"},Nq={class:"kpi-value"},Mq={class:"unit"},Xq={class:"kpi-chart"},$q={class:"line-chart"},Oq={viewBox:"0 0 300 60",preserveAspectRatio:"none"},jq=["d"],Bq=["cx","cy"],Wq=["cx","cy","onMouseover"],qq={key:0,class:"tooltip-content"},Qq={class:"tooltip-header"},Kq={class:"tooltip-value"},Jq={class:"tooltip-details"},zq={class:"tooltip-count"},Hq={key:0},Gq={key:1},Yq={key:2,class:"tooltip-no-data"},Zq={key:0,class:"tooltip-incidents-list"},eQ={class:"tooltip-incident-title"},tQ={class:"tooltip-incident-time"},iQ={key:0,class:"tooltip-more"},aQ={class:"chart-months"},sQ={class:"kpi-card"},oQ={class:"kpi-value"},lQ={class:"unit"},nQ={class:"kpi-chart"},rQ={class:"line-chart"},cQ={viewBox:"0 0 300 60",preserveAspectRatio:"none"},dQ=["d"],uQ=["cx","cy"],pQ=["cx","cy","onMouseover"],mQ={class:"chart-months"},vQ={class:"kpi-card"},kQ={class:"kpi-value"},hQ={class:"unit"},gQ={class:"kpi-chart"},yQ={class:"line-chart"},fQ={viewBox:"0 0 300 60",preserveAspectRatio:"none"},bQ=["d"],CQ=["cx","cy"],LQ=["cx","cy","onMouseover"],wQ={class:"chart-months"},EQ={class:"kpi-row"},RQ={class:"kpi-card expanded-card"},IQ={class:"kpi-value"},DQ={class:"unit"},PQ={class:"kpi-card expanded-card"},_Q={class:"kpi-value"},AQ={class:"unit"},SQ={class:"kpi-chart"},TQ={class:"line-chart"},xQ={viewBox:"0 0 300 60",preserveAspectRatio:"none"},FQ=["d"],VQ=["cx","cy"],UQ=["cx","cy","onMouseover"],NQ={class:"chart-months"},MQ={class:"kpi-row"},XQ={class:"kpi-card"},$Q={class:"kpi-value"},OQ={class:"kpi-chart"},jQ={class:"bar-chart vertical"},BQ={class:"tooltip"},WQ={key:0,class:"tooltip-incidents"},qQ={key:0},QQ={key:0},KQ={class:"kpi-card"},JQ={class:"kpi-value"},zQ={class:"kpi-chart"},HQ={class:"progress-bar"},GQ={class:"chart-values"},YQ={class:"kpi-card"},ZQ={class:"kpi-value"},eK={class:"unit"},tK={class:"kpi-chart"},iK={class:"progress-bar"},aK={class:"kpi-row"},sK={class:"kpi-card"},oK={class:"kpi-value"},lK={class:"unit"},nK={class:"kpi-chart"},rK={class:"donut-chart"},cK={class:"kpi-card"},dK={class:"kpi-value"},uK={class:"unit"},pK={class:"kpi-chart"},mK={class:"progress-bar"},vK={class:"kpi-card"},kK={class:"kpi-value"},hK={class:"cost-breakdown"},gK={class:"kpi-row"},yK={class:"kpi-card expanded-card"},fK={class:"kpi-chart pie-chart-container"},bK={viewBox:"0 0 100 100",class:"pie-chart-svg",style:{width:"80px",height:"80px"}},CK=["stroke-dasharray"],LK=["stroke-dasharray","stroke-dashoffset"],wK=["stroke-dasharray","stroke-dashoffset"],EK={key:0,class:"pie-tooltip-content"},RK={class:"pie-tooltip-header"},IK={class:"pie-tooltip-value"},DK={class:"pie-tooltip-count"},PK={class:"chart-legend"},_K={class:"legend-item"},AK={class:"legend-item"},SK={class:"legend-item"},TK={class:"kpi-card expanded-card"},xK={class:"kpi-chart small-donut-container",id:"origin-chart-container"},FK={viewBox:"0 0 100 100",class:"donut-chart-svg",style:{width:"60px",height:"60px"}},VK=["stroke","stroke-dasharray","stroke-dashoffset","onMouseover"],UK={x:"50",y:"56","text-anchor":"middle","font-size":"8","font-weight":"bold"},NK={key:0,class:"origin-tooltip-content"},MK={class:"origin-tooltip-header"},XK={class:"origin-tooltip-value"},$K={class:"origin-tooltip-count"},OK={class:"chart-legend"},jK={class:"legend-text"},BK={class:"kpi-row"},WK={class:"kpi-card root-cause-card"},qK={class:"kpi-chart bar-chart-container"},QK={class:"horizontal-bar-chart"},KK={class:"h-bar-label"},JK={class:"h-bar-track"},zK=["onMouseover"],HK={class:"h-bar-value"},GK={key:0,class:"root-cause-tooltip-content"},YK={class:"root-cause-tooltip-header"},ZK={class:"root-cause-tooltip-value"},eJ={class:"root-cause-tooltip-count"},tJ={class:"kpi-card threat-types-card"},iJ={class:"kpi-chart bar-chart-container"},aJ={class:"vertical-bar-chart"},sJ={class:"v-bar-label"},oJ={class:"v-bar-value"},lJ={key:1,class:"no-data-message"},nJ={class:"kpi-row"},rJ={class:"kpi-card incident-volume-card"},cJ={class:"kpi-value"},dJ={class:"trend-chart"},uJ={width:"100%",height:"80",viewBox:"0 0 400 80",preserveAspectRatio:"none"},pJ=["d"],mJ={class:"trend-labels"},vJ={class:"kpi-card escalation-rate-card"},kJ={class:"kpi-value"},hJ={class:"kpi-chart stacked-bar-container"},gJ={class:"stacked-bar"},yJ={class:"stacked-bar-legend"},fJ={class:"legend-item"},bJ={class:"legend-label"},CJ={class:"legend-item"},LJ={class:"legend-label"},wJ={key:0,class:"stacked-tooltip-content"},EJ={class:"tooltip-header"},RJ={class:"tooltip-value"},IJ={class:"kpi-card repeat-rate-card"},DJ={class:"kpi-value"},PJ={class:"kpi-chart donut-chart-container"},_J={class:"donut-chart repeat-donut"},AJ={class:"donut-hole"},SJ={class:"donut-hole-text"},TJ={class:"chart-legend"},xJ={class:"legend-item"},FJ={class:"legend-item"};function VJ(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Fq,[(0,s.Lk)("div",Vq,[(0,s.Lk)("div",Uq,[t[20]||(t[20]=(0,s.Lk)("h3",null,"Mean Time to Detect (MTTD)",-1)),(0,s.Lk)("div",Nq,[(0,s.eW)((0,d.v_)(o.kpiData.mttd.value),1),(0,s.Lk)("span",Mq,(0,d.v_)(o.kpiData.mttd.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.mttd.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.mttd.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.mttd.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",Xq,[(0,s.Lk)("div",$q,[((0,s.uX)(),(0,s.CE)("svg",Oq,[o.kpiData.mttd.trend&&o.kpiData.mttd.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.mttd.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,jq)):(0,s.Q3)("",!0),o.kpiData.mttd.trend&&o.kpiData.mttd.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.mttd.trend.map(e=>e.minutes)),(e,i)=>((0,s.uX)(),(0,s.CE)("g",{key:"mttd-point-"+i,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,Bq),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.mttd.trend[i]),onMouseout:t[0]||(t[0]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,Wq)]))),128)):(0,s.Q3)("",!0)])),(0,s.Lk)("div",{id:"chart-tooltip",class:"chart-tooltip",style:(0,d.Tr)(o.tooltipStyle)},[o.activeTooltip?((0,s.uX)(),(0,s.CE)("div",qq,[(0,s.Lk)("div",Qq,(0,d.v_)(o.activeTooltip.month),1),(0,s.Lk)("div",Kq,(0,d.v_)(o.activeTooltip.minutes)+" "+(0,d.v_)(o.kpiData.mttd.unit),1),(0,s.Lk)("div",Jq,[(0,s.Lk)("div",zq,[t[16]||(t[16]=(0,s.Lk)("strong",null,"Incidents:",-1)),(0,s.eW)(" "+(0,d.v_)(o.activeTooltip.count||0),1)]),o.activeTooltip.fastest&&o.activeTooltip.count>0?((0,s.uX)(),(0,s.CE)("div",Hq,[t[17]||(t[17]=(0,s.Lk)("strong",null,"Fastest:",-1)),(0,s.eW)(" "+(0,d.v_)(o.activeTooltip.fastest)+" "+(0,d.v_)(o.kpiData.mttd.unit),1)])):(0,s.Q3)("",!0),o.activeTooltip.slowest&&o.activeTooltip.count>0?((0,s.uX)(),(0,s.CE)("div",Gq,[t[18]||(t[18]=(0,s.Lk)("strong",null,"Slowest:",-1)),(0,s.eW)(" "+(0,d.v_)(o.activeTooltip.slowest)+" "+(0,d.v_)(o.kpiData.mttd.unit),1)])):(0,s.Q3)("",!0),o.activeTooltip.count&&0!==o.activeTooltip.count?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Yq,"No incidents in this period"))]),o.activeTooltip.details&&o.activeTooltip.details.length>0?((0,s.uX)(),(0,s.CE)("div",Zq,[t[19]||(t[19]=(0,s.Lk)("div",{class:"tooltip-list-header"},"Recent incidents:",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.activeTooltip.details.slice(0,3),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"tooltip-incident-item"},[(0,s.Lk)("div",eQ,(0,d.v_)(e.title||"Untitled Incident"),1),(0,s.Lk)("div",tQ,(0,d.v_)(e.minutes)+" "+(0,d.v_)(o.kpiData.mttd.unit),1)]))),128)),o.activeTooltip.details.length>3?((0,s.uX)(),(0,s.CE)("div",iQ," + "+(0,d.v_)(o.activeTooltip.details.length-3)+" more ",1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",aQ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.mttd.trend,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"mttd-month-"+t},(0,d.v_)(e.month),1))),128))])])]),(0,s.Lk)("div",sQ,[t[21]||(t[21]=(0,s.Lk)("h3",null,"Mean Time to Respond (MTTR)",-1)),(0,s.Lk)("div",oQ,[(0,s.eW)((0,d.v_)(o.kpiData.mttr.value.toFixed(1)),1),(0,s.Lk)("span",lQ,(0,d.v_)(o.kpiData.mttr.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.mttr.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.mttr.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.mttr.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",nQ,[(0,s.Lk)("div",rQ,[((0,s.uX)(),(0,s.CE)("svg",cQ,[o.kpiData.mttr.trend&&o.kpiData.mttr.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.mttr.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,dQ)):(0,s.Q3)("",!0),o.kpiData.mttr.trend&&o.kpiData.mttr.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.mttr.trend.map(e=>e.minutes)),(e,i)=>((0,s.uX)(),(0,s.CE)("g",{key:"mttr-point-"+i,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,uQ),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.mttr.trend[i]),onMouseout:t[1]||(t[1]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,pQ)]))),128)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",mQ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.mttr.trend,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"mttr-month-"+t},(0,d.v_)(e.month),1))),128))])])]),(0,s.Lk)("div",vQ,[t[22]||(t[22]=(0,s.Lk)("h3",null,"Mean Time to Contain (MTTC)",-1)),(0,s.Lk)("div",kQ,[(0,s.eW)((0,d.v_)(Number(o.kpiData.mttc.value).toFixed(1)),1),(0,s.Lk)("span",hQ,(0,d.v_)(o.kpiData.mttc.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.mttc.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.mttc.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.mttc.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",gQ,[(0,s.Lk)("div",yQ,[((0,s.uX)(),(0,s.CE)("svg",fQ,[o.kpiData.mttc.trend&&o.kpiData.mttc.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.mttc.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,bQ)):(0,s.Q3)("",!0),o.kpiData.mttc.trend&&o.kpiData.mttc.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.mttc.trend.map(e=>e.minutes)),(e,i)=>((0,s.uX)(),(0,s.CE)("g",{key:"mttc-point-"+i,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,CQ),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.mttc.trend[i]),onMouseout:t[2]||(t[2]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,LQ)]))),128)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",wQ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.mttc.trend,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"mttc-month-"+t},(0,d.v_)(e.month),1))),128))])])])]),(0,s.Lk)("div",EQ,[(0,s.Lk)("div",RQ,[t[24]||(t[24]=(0,s.Lk)("h3",null,"Mean Time to Resolve (MTTRv)",-1)),(0,s.Lk)("div",IQ,[(0,s.eW)((0,d.v_)(o.kpiData.mttrv.value),1),(0,s.Lk)("span",DQ,(0,d.v_)(o.kpiData.mttrv.unit),1),t[23]||(t[23]=(0,s.Lk)("span",{class:"value-change negative"},[(0,s.Lk)("i",{class:"fas fa-caret-down"}),(0,s.eW)("2.0%")],-1))]),t[25]||(t[25]=(0,s.Fv)('<div class="kpi-chart" data-v-ba40ffbc><div class="line-chart" data-v-ba40ffbc><svg viewBox="0 0 300 60" preserveAspectRatio="none" data-v-ba40ffbc><path d="M0,20 C25,25 50,20 75,15 C100,10 125,15 150,20 C175,25 200,20 225,15 C250,10 275,15 300,20" fill="none" stroke="#3498db" stroke-width="2" data-v-ba40ffbc></path><circle cx="0" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="50" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="100" cy="10" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="150" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="200" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="250" cy="10" r="3" fill="#3498db" data-v-ba40ffbc></circle><circle cx="300" cy="20" r="3" fill="#3498db" data-v-ba40ffbc></circle></svg></div><div class="chart-months" data-v-ba40ffbc><span data-v-ba40ffbc>Jan</span><span data-v-ba40ffbc>Feb</span><span data-v-ba40ffbc>Mar</span><span data-v-ba40ffbc>Apr</span><span data-v-ba40ffbc>May</span><span data-v-ba40ffbc>Jun</span></div></div>',1))]),(0,s.Lk)("div",PQ,[t[26]||(t[26]=(0,s.Lk)("h3",null,"First Response Time",-1)),(0,s.Lk)("div",_Q,[(0,s.eW)((0,d.v_)(o.kpiData.firstResponseTime.value),1),(0,s.Lk)("span",AQ,(0,d.v_)(o.kpiData.firstResponseTime.unit),1),(0,s.Lk)("span",{class:(0,d.C4)(["value-change",o.kpiData.firstResponseTime.change_percentage>0?"positive":"negative"])},[(0,s.Lk)("i",{class:(0,d.C4)(o.kpiData.firstResponseTime.change_percentage>0?"fas fa-caret-up":"fas fa-caret-down")},null,2),(0,s.eW)(" "+(0,d.v_)(Math.abs(o.kpiData.firstResponseTime.change_percentage))+"% ",1)],2)]),(0,s.Lk)("div",SQ,[(0,s.Lk)("div",TQ,[((0,s.uX)(),(0,s.CE)("svg",xQ,[o.kpiData.firstResponseTime.trend&&o.kpiData.firstResponseTime.trend.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:l.generateTrendPath(o.kpiData.firstResponseTime.trend.map(e=>e.minutes)),fill:"none",stroke:"#3498db","stroke-width":"2"},null,8,FQ)):(0,s.Q3)("",!0),o.kpiData.firstResponseTime.trend&&o.kpiData.firstResponseTime.trend.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(l.getTrendPoints(o.kpiData.firstResponseTime.trend.map(e=>e.minutes)),(e,i)=>((0,s.uX)(),(0,s.CE)("g",{key:"first-response-point-"+i,class:"data-point-group"},[(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"3",fill:"#3498db",class:"data-point"},null,8,VQ),(0,s.Lk)("circle",{cx:e.x,cy:e.y,r:"8",fill:"transparent",class:"hover-area",onMouseover:e=>l.showTooltip(e,o.kpiData.firstResponseTime.trend[i]),onMouseout:t[3]||(t[3]=(...e)=>l.hideTooltip&&l.hideTooltip(...e))},null,40,UQ)]))),128)):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",NQ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.firstResponseTime.trend,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"first-response-month-"+t},(0,d.v_)(e.month),1))),128))])])])]),(0,s.Lk)("div",MQ,[(0,s.Lk)("div",XQ,[t[27]||(t[27]=(0,s.Lk)("h3",null,"Number of Incidents Detected",-1)),(0,s.Lk)("div",$Q,(0,d.v_)(o.kpiData.incidentsDetected.value),1),(0,s.Lk)("div",OQ,[(0,s.Lk)("div",jQ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentsDetected.byDay,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"incident-bar-"+t,class:"bar tooltip-container",style:(0,d.Tr)({height:l.calculateBarHeight(e,o.kpiData.incidentsDetected.byDay)})},[(0,s.Lk)("div",BQ,[(0,s.Lk)("strong",null,(0,d.v_)(o.kpiData.incidentsDetected.details&&o.kpiData.incidentsDetected.details[t]?.day)+": "+(0,d.v_)(e),1),e>0?((0,s.uX)(),(0,s.CE)("div",WQ,[o.kpiData.incidentsDetected.details&&o.kpiData.incidentsDetected.details[t]?.incidents.length>0?((0,s.uX)(),(0,s.CE)("div",qQ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentsDetected.details[t]?.incidents.slice(0,3),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"tooltip-incident"},(0,d.v_)(e.title),1))),128)),o.kpiData.incidentsDetected.details&&o.kpiData.incidentsDetected.details[t]?.incidents.length>3?((0,s.uX)(),(0,s.CE)("div",QQ," + "+(0,d.v_)(o.kpiData.incidentsDetected.details[t]?.incidents.length-3)+" more ",1)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])],4))),128))])]),t[28]||(t[28]=(0,s.Lk)("div",{class:"chart-labels"},[(0,s.Lk)("span",null,"M"),(0,s.Lk)("span",null,"T"),(0,s.Lk)("span",null,"W"),(0,s.Lk)("span",null,"T"),(0,s.Lk)("span",null,"F"),(0,s.Lk)("span",null,"S"),(0,s.Lk)("span",null,"S")],-1))]),(0,s.Lk)("div",KQ,[t[29]||(t[29]=(0,s.Lk)("h3",null,"Number of Reopened Incidents",-1)),(0,s.Lk)("div",JQ,(0,d.v_)(o.kpiData.reopenedIncidents.value),1),(0,s.Lk)("div",zQ,[(0,s.Lk)("div",HQ,[(0,s.Lk)("div",{class:"progress",style:(0,d.Tr)({width:o.kpiData.reopenedIncidents.percentage+"%"})},null,4)])]),(0,s.Lk)("div",GQ,[(0,s.Lk)("span",null,(0,d.v_)(o.kpiData.reopenedIncidents.percentage.toFixed(1))+"% of total incidents",1)])]),(0,s.Lk)("div",YQ,[t[30]||(t[30]=(0,s.Lk)("h3",null,"Incident Closure Rate",-1)),(0,s.Lk)("div",ZQ,[(0,s.eW)((0,d.v_)(Math.round(o.kpiData.closureRate.value)),1),(0,s.Lk)("span",eK,(0,d.v_)(o.kpiData.closureRate.unit),1)]),(0,s.Lk)("div",tK,[(0,s.Lk)("div",iK,[(0,s.Lk)("div",{class:"progress",style:(0,d.Tr)({width:o.kpiData.closureRate.value+"%"})},null,4)])])])]),(0,s.Lk)("div",aK,[(0,s.Lk)("div",sK,[t[33]||(t[33]=(0,s.Lk)("h3",null,"False Positive Rate",-1)),(0,s.Lk)("div",oK,[(0,s.eW)((0,d.v_)(Math.round(o.kpiData.falsePositiveRate.value)),1),(0,s.Lk)("span",lK,(0,d.v_)(o.kpiData.falsePositiveRate.unit),1)]),(0,s.Lk)("div",nK,[(0,s.Lk)("div",rK,[t[32]||(t[32]=(0,s.Lk)("div",{class:"donut-hole"},null,-1)),(0,s.Lk)("div",{class:"donut-chart",style:(0,d.Tr)(`--percentage: ${o.kpiData.falsePositiveRate.value};`)},t[31]||(t[31]=[(0,s.Lk)("div",{class:"donut-hole"},null,-1)]),4)])])]),(0,s.Lk)("div",cK,[t[34]||(t[34]=(0,s.Lk)("h3",null,"Detection Accuracy",-1)),(0,s.Lk)("div",dK,[(0,s.eW)((0,d.v_)(Math.round(o.kpiData.detectionAccuracy.value)),1),(0,s.Lk)("span",uK,(0,d.v_)(o.kpiData.detectionAccuracy.unit),1)]),(0,s.Lk)("div",pK,[(0,s.Lk)("div",mK,[(0,s.Lk)("div",{class:"progress",style:(0,d.Tr)({width:o.kpiData.detectionAccuracy.value+"%"})},null,4)])])]),(0,s.Lk)("div",vK,[t[35]||(t[35]=(0,s.Lk)("h3",null,"Cost per Incident",-1)),(0,s.Lk)("div",kK,"₹"+(0,d.v_)(o.kpiData.costData.total_cost_k||"0")+"K",1),(0,s.Lk)("div",hK,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.costData.by_severity,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["cost-bar",e.severity.toLowerCase()])},(0,d.v_)(e.label),3))),128))])])]),(0,s.Lk)("div",gK,[(0,s.Lk)("div",yK,[t[40]||(t[40]=(0,s.Lk)("h3",null,"Percentage of Incidents by Severity",-1)),(0,s.Lk)("div",fK,[((0,s.uX)(),(0,s.CE)("svg",bK,[t[36]||(t[36]=(0,s.Lk)("circle",{cx:"50",cy:"50",r:"40",fill:"white"},null,-1)),(0,s.Lk)("circle",{r:"40",cx:"50",cy:"50",fill:"transparent",stroke:"#84cc16","stroke-width":"40","stroke-dasharray":`${2.51*o.kpiData.incidentsBySeverity.low} ${100*2.51-2.51*o.kpiData.incidentsBySeverity.low}`,"stroke-dashoffset":"0",transform:"rotate(-90 50 50)",class:"pie-segment-path",onMouseover:t[4]||(t[4]=e=>l.showPieTooltip(e,"Low",o.kpiData.incidentsBySeverity.low)),onMouseout:t[5]||(t[5]=(...e)=>l.hidePieTooltip&&l.hidePieTooltip(...e))},null,40,CK),(0,s.Lk)("circle",{r:"40",cx:"50",cy:"50",fill:"transparent",stroke:"#facc15","stroke-width":"40","stroke-dasharray":`${2.51*o.kpiData.incidentsBySeverity.medium} ${100*2.51-2.51*o.kpiData.incidentsBySeverity.medium}`,"stroke-dashoffset":""+2.51*(100-o.kpiData.incidentsBySeverity.low),transform:"rotate(-90 50 50)",class:"pie-segment-path",onMouseover:t[6]||(t[6]=e=>l.showPieTooltip(e,"Medium",o.kpiData.incidentsBySeverity.medium)),onMouseout:t[7]||(t[7]=(...e)=>l.hidePieTooltip&&l.hidePieTooltip(...e))},null,40,LK),(0,s.Lk)("circle",{r:"40",cx:"50",cy:"50",fill:"transparent",stroke:"#f97316","stroke-width":"40","stroke-dasharray":`${2.51*o.kpiData.incidentsBySeverity.high} ${100*2.51-2.51*o.kpiData.incidentsBySeverity.high}`,"stroke-dashoffset":""+2.51*(100-o.kpiData.incidentsBySeverity.low-o.kpiData.incidentsBySeverity.medium),transform:"rotate(-90 50 50)",class:"pie-segment-path",onMouseover:t[8]||(t[8]=e=>l.showPieTooltip(e,"High",o.kpiData.incidentsBySeverity.high)),onMouseout:t[9]||(t[9]=(...e)=>l.hidePieTooltip&&l.hidePieTooltip(...e))},null,40,wK)])),(0,s.Lk)("div",{id:"pie-tooltip",class:"pie-tooltip",style:(0,d.Tr)(o.pieTooltipStyle)},[o.activePieTooltip?((0,s.uX)(),(0,s.CE)("div",EK,[(0,s.Lk)("div",RK,(0,d.v_)(o.activePieTooltip.severity),1),(0,s.Lk)("div",IK,(0,d.v_)(o.activePieTooltip.percentage)+"%",1),(0,s.Lk)("div",DK,"Count: "+(0,d.v_)(Math.round(o.activePieTooltip.count)),1)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",PK,[(0,s.Lk)("div",_K,[t[37]||(t[37]=(0,s.Lk)("span",{class:"legend-color high"},null,-1)),(0,s.eW)("High ("+(0,d.v_)(o.kpiData.incidentsBySeverity.high)+"%) ",1)]),(0,s.Lk)("div",AK,[t[38]||(t[38]=(0,s.Lk)("span",{class:"legend-color medium"},null,-1)),(0,s.eW)("Medium ("+(0,d.v_)(o.kpiData.incidentsBySeverity.medium)+"%) ",1)]),(0,s.Lk)("div",SK,[t[39]||(t[39]=(0,s.Lk)("span",{class:"legend-color low"},null,-1)),(0,s.eW)("Low ("+(0,d.v_)(o.kpiData.incidentsBySeverity.low)+"%) ",1)])])]),(0,s.Lk)("div",TK,[t[43]||(t[43]=(0,s.Lk)("h3",null,"Incident Origin Distribution",-1)),(0,s.Lk)("div",xK,[((0,s.uX)(),(0,s.CE)("svg",FK,[t[41]||(t[41]=(0,s.Lk)("circle",{cx:"50",cy:"50",r:"40",fill:"white"},null,-1)),o.kpiData.incidentOrigins&&o.kpiData.incidentOrigins.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.kpiData.incidentOrigins,(e,i)=>((0,s.uX)(),(0,s.CE)("circle",{key:"origin-"+i,r:"25",cx:"50",cy:"50",fill:"transparent",stroke:l.getOriginColor(e.origin),"stroke-width":"12","stroke-dasharray":`${2.51*e.percentage} ${100*2.51-2.51*e.percentage}`,"stroke-dashoffset":l.getStrokeDashOffset(i),transform:"rotate(-90 50 50)",class:"donut-segment-path",onMouseover:t=>l.showOriginTooltip(t,e.origin,e.percentage,e.count),onMouseout:t[10]||(t[10]=(...e)=>l.hideOriginTooltip&&l.hideOriginTooltip(...e))},null,40,VK))),128)):(0,s.Q3)("",!0),t[42]||(t[42]=(0,s.Lk)("text",{x:"50",y:"47","text-anchor":"middle","font-size":"6","font-weight":"bold"},"Total",-1)),(0,s.Lk)("text",UK,(0,d.v_)(o.incidentCounts.total),1)])),(0,s.Lk)("div",{id:"origin-tooltip",class:"origin-tooltip",style:(0,d.Tr)(o.originTooltipStyle)},[o.activeOriginTooltip?((0,s.uX)(),(0,s.CE)("div",NK,[(0,s.Lk)("div",MK,(0,d.v_)(o.activeOriginTooltip.origin),1),(0,s.Lk)("div",XK,(0,d.v_)(o.activeOriginTooltip.percentage)+"%",1),(0,s.Lk)("div",$K,"Count: "+(0,d.v_)(o.activeOriginTooltip.count),1)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",OK,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentOrigins,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"legend-"+t,class:"legend-item"},[(0,s.Lk)("span",{class:"legend-color",style:(0,d.Tr)({backgroundColor:l.getOriginColor(e.origin)})},null,4),(0,s.Lk)("span",jK,(0,d.v_)(e.origin.length>8?e.origin.substring(0,8)+"...":e.origin),1)]))),128))])])]),(0,s.Lk)("div",BK,[(0,s.Lk)("div",WK,[t[44]||(t[44]=(0,s.Lk)("h3",null,"Incident Root Cause Categories",-1)),(0,s.Lk)("div",qK,[(0,s.Lk)("div",QK,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.rootCauseCategories,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"h-bar-item"},[(0,s.Lk)("div",KK,(0,d.v_)(i),1),(0,s.Lk)("div",JK,[(0,s.Lk)("div",{class:"h-bar-progress",style:(0,d.Tr)({width:e+"%"}),onMouseover:t=>l.showRootCauseTooltip(t,i,e),onMouseout:t[11]||(t[11]=(...e)=>l.hideRootCauseTooltip&&l.hideRootCauseTooltip(...e))},null,44,zK)]),(0,s.Lk)("div",HK,(0,d.v_)(e)+"%",1)]))),128))]),(0,s.Lk)("div",{class:"root-cause-tooltip",style:(0,d.Tr)(o.rootCauseTooltipStyle)},[o.activeRootCauseTooltip?((0,s.uX)(),(0,s.CE)("div",GK,[(0,s.Lk)("div",YK,(0,d.v_)(o.activeRootCauseTooltip.category),1),(0,s.Lk)("div",ZK,(0,d.v_)(o.activeRootCauseTooltip.percentage)+"%",1),(0,s.Lk)("div",eJ,"Count: "+(0,d.v_)(Math.round(o.activeRootCauseTooltip.count)),1)])):(0,s.Q3)("",!0)],4)])]),(0,s.Lk)("div",tJ,[t[45]||(t[45]=(0,s.Lk)("h3",null,"Volume of Incident Types",-1)),(0,s.Lk)("div",iJ,[(0,s.Lk)("div",aJ,[Array.isArray(o.kpiData.incidentTypes)&&o.kpiData.incidentTypes.length>0?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:0},(0,s.pI)(o.kpiData.incidentTypes.slice(0,5),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"type-"+t,class:"v-bar-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["v-bar-progress","type-color-"+t%5]),style:(0,d.Tr)({height:l.calculateBarHeight(e.count,o.kpiData.incidentTypes.map(e=>e.count))})},null,6),(0,s.Lk)("div",sJ,(0,d.v_)(e.type),1),(0,s.Lk)("div",oJ,(0,d.v_)(e.count),1)]))),128)):((0,s.uX)(),(0,s.CE)("div",lJ," No incident type data available "))])])])]),(0,s.Lk)("div",nJ,[(0,s.Lk)("div",rJ,[t[46]||(t[46]=(0,s.Lk)("h3",null,"Incident Volume",-1)),(0,s.Lk)("div",cJ,(0,d.v_)(o.kpiData.incidentVolume.total||0),1),(0,s.Lk)("div",dJ,[((0,s.uX)(),(0,s.CE)("svg",uJ,[(0,s.Lk)("path",{d:l.getVolumeTrendPath(o.kpiData.incidentVolume.trend),fill:"rgba(33, 150, 243, 0.2)",stroke:"#2196F3","stroke-width":"2"},null,8,pJ)])),(0,s.Lk)("div",mJ,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.kpiData.incidentVolume.trend,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:t},(0,d.v_)(e.day),1))),128))])])]),(0,s.Lk)("div",vJ,[t[50]||(t[50]=(0,s.Lk)("h3",null,"Incident Escalation Rate",-1)),(0,s.Lk)("div",kJ,[(0,s.eW)((0,d.v_)(o.kpiData.escalationRate.value||0),1),t[47]||(t[47]=(0,s.Lk)("span",{class:"unit"},"%",-1))]),(0,s.Lk)("div",hJ,[(0,s.Lk)("div",gJ,[(0,s.Lk)("div",{class:"stacked-segment audit",style:(0,d.Tr)({width:o.kpiData.escalationRate.audit+"%"}),onMouseover:t[12]||(t[12]=e=>l.showStackedTooltip(e,"Audit",o.kpiData.escalationRate.audit)),onMouseout:t[13]||(t[13]=(...e)=>l.hideStackedTooltip&&l.hideStackedTooltip(...e))},null,36),(0,s.Lk)("div",{class:"stacked-segment manual",style:(0,d.Tr)({width:o.kpiData.escalationRate.manual+"%"}),onMouseover:t[14]||(t[14]=e=>l.showStackedTooltip(e,"Manual",o.kpiData.escalationRate.manual)),onMouseout:t[15]||(t[15]=(...e)=>l.hideStackedTooltip&&l.hideStackedTooltip(...e))},null,36)]),(0,s.Lk)("div",yJ,[(0,s.Lk)("div",fJ,[t[48]||(t[48]=(0,s.Lk)("span",{class:"legend-color audit"},null,-1)),(0,s.Lk)("span",bJ,"Audit ("+(0,d.v_)(o.kpiData.escalationRate.audit)+"%)",1)]),(0,s.Lk)("div",CJ,[t[49]||(t[49]=(0,s.Lk)("span",{class:"legend-color manual"},null,-1)),(0,s.Lk)("span",LJ,"Manual ("+(0,d.v_)(o.kpiData.escalationRate.manual)+"%)",1)])])]),(0,s.Lk)("div",{class:"stacked-tooltip",style:(0,d.Tr)(o.stackedTooltipStyle)},[o.activeStackedTooltip?((0,s.uX)(),(0,s.CE)("div",wJ,[(0,s.Lk)("div",EJ,(0,d.v_)(o.activeStackedTooltip.type),1),(0,s.Lk)("div",RJ,(0,d.v_)(o.activeStackedTooltip.percentage)+"%",1)])):(0,s.Q3)("",!0)],4)]),(0,s.Lk)("div",IJ,[t[54]||(t[54]=(0,s.Lk)("h3",null,"Repeat Incident Rate",-1)),(0,s.Lk)("div",DJ,[(0,s.eW)((0,d.v_)(o.kpiData.repeatRate.value||0),1),t[51]||(t[51]=(0,s.Lk)("span",{class:"unit"},"%",-1))]),(0,s.Lk)("div",PJ,[(0,s.Lk)("div",_J,[(0,s.Lk)("div",{class:"donut-segment new",style:(0,d.Tr)({"--start-angle":"0deg","--end-angle":3.6*o.kpiData.repeatRate.new+"deg"})},null,4),(0,s.Lk)("div",{class:"donut-segment repeat",style:(0,d.Tr)({"--start-angle":3.6*o.kpiData.repeatRate.new+"deg","--end-angle":"360deg"})},null,4),(0,s.Lk)("div",AJ,[(0,s.Lk)("div",SJ,(0,d.v_)(o.kpiData.repeatRate.value)+"%",1)])])]),(0,s.Lk)("div",TJ,[(0,s.Lk)("div",xJ,[t[52]||(t[52]=(0,s.Lk)("span",{class:"legend-color new"},null,-1)),(0,s.eW)("New ("+(0,d.v_)(o.kpiData.repeatRate.new)+"%)",1)]),(0,s.Lk)("div",FJ,[t[53]||(t[53]=(0,s.Lk)("span",{class:"legend-color repeat"},null,-1)),(0,s.eW)("Repeat ("+(0,d.v_)(o.kpiData.repeatRate.repeat)+"%)",1)])])])]),(0,s.bF)(n)])}var UJ={name:"IncidentDashboard",components:{PopupModal:Ck.wA},data(){return{loading:!0,kpiData:{mttd:{value:0,unit:"hours",trend:[],change_percentage:0},mttr:{value:0,unit:"hours",trend:[],change_percentage:0},mttc:{value:0,unit:"hours",trend:[],change_percentage:0},mttrv:{value:0,unit:"hours",trend:[]},firstResponseTime:{value:0,unit:"hours",trend:[]},escalationTime:{value:0,unit:"hours",trend:[]},incidentsDetected:{value:0,byDay:[0,0,0,0,0,0,0]},reopenedIncidents:{value:0,percentage:0},closureRate:{value:0,unit:"%"},falsePositiveRate:{value:0,unit:"%"},detectionAccuracy:{value:0,unit:"%"},slaComplianceRate:{value:0,unit:"%"},incidentsBySeverity:{high:0,medium:0,low:0},rootCauseCategories:{},incidentTypes:[],incidentVolume:{total:0,trend:[]},escalationRate:{value:0,audit:0,manual:0},repeatRate:{value:0,new:0,repeat:0},incidentOrigins:[],averageCost:null,totalCost:null,costCount:null,costData:{total_cost:0,by_severity:[]}},incidentCounts:{total:0,pending:0,accepted:0,rejected:0,resolved:0},tooltipStyle:{display:"none",left:"0px",top:"0px"},activeTooltip:null,pieTooltipStyle:{display:"none",left:"0px",top:"0px"},activePieTooltip:null,rootCauseTooltipStyle:{display:"none",left:"0px",top:"0px"},activeRootCauseTooltip:null,originTooltipStyle:{display:"none",left:"0px",top:"0px"},activeOriginTooltip:null,stackedTooltipStyle:{display:"none",left:"0px",top:"0px"},activeStackedTooltip:null}},methods:{async fetchKPIData(){try{this.loading=!0,console.log("Starting to fetch KPI data");try{console.log("Fetching MTTD data from /api/incident/mttd/");const e=await He.A.get("/api/incident/mttd/",{params:{timeRange:"all"}});if(e.data){const t=e.data.value,i=parseFloat(t),a=e.data.trend.map(e=>({month:e.month,minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]}));console.log("Processed trend data:",a),this.kpiData.mttd={value:i,unit:e.data.unit,trend:a,change_percentage:e.data.change_percentage||0},console.log("Updated MTTD in kpiData:",this.kpiData.mttd)}}catch(e){console.error("Error fetching MTTD data:",e)}try{console.log("Fetching MTTR data from /api/incident/mttr/");const e=await He.A.get("/api/incident/mttr/",{params:{timeRange:"all"}});if(e.data){const t=e.data.mttr;console.log("Raw MTTR value from API:",t);const i=t/60;console.log("Converted MTTR value to hours:",i);const a=(e.data.chart_data||[]).map(e=>({month:e.date.substring(0,7),minutes:(e.value||0)/60,count:e.count||0}));this.kpiData.mttr={value:i,unit:"hours",trend:a,change_percentage:e.data.change_percentage||0},console.log("Updated MTTR in kpiData:",this.kpiData.mttr)}}catch(t){console.error("Error fetching MTTR data:",t)}try{console.log("Fetching MTTC data from /api/incident/mttc/");const e=await He.A.get("/api/incident/mttc/",{params:{timeRange:"all"}});if(e.data){console.log("Raw MTTC response:",e.data);const t=e.data.value,i=parseFloat(t);console.log("Parsed MTTC value:",i),this.kpiData.mttc={value:i,unit:e.data.unit||"hours",trend:Array.isArray(e.data.trend)?e.data.trend.map(e=>({month:e.month||"",minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]})):[],change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated MTTC in kpiData:",this.kpiData.mttc)}else console.warn("MTTC response has no data")}catch(i){console.error("Error fetching MTTC data:",i)}try{console.log("Fetching MTTRv data from /api/incident/mttrv/");const e=await He.A.get("/api/incident/mttrv/",{params:{timeRange:"all"}});if(e.data){const t=e.data.value,i=parseFloat(t),a=Array.isArray(e.data.trend)?e.data.trend.map(e=>({month:e.month||"",minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]})):[];this.kpiData.mttrv={value:i,unit:e.data.unit||"hours",trend:a},console.log("Updated MTTRv in kpiData:",this.kpiData.mttrv)}}catch(a){console.error("Error fetching MTTRv data:",a)}try{console.log("Fetching False Positive Rate data from /api/incident/false-positive-rate/");const e=await He.A.get("/api/incident/false-positive-rate/",{params:{timeRange:"all"}});if(e.data){console.log("Raw False Positive Rate response:",e.data);const t=e.data.value,i=parseFloat(t);console.log("Parsed False Positive Rate value:",i),this.kpiData.falsePositiveRate={value:i,unit:e.data.unit||"%",change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated falsePositiveRate in kpiData:",this.kpiData.falsePositiveRate)}else console.warn("False Positive Rate response has no data")}catch(s){console.error("Error fetching False Positive Rate data:",s)}try{console.log("Fetching Detection Accuracy data from /api/incident/detection-accuracy/");const e=await He.A.get("/api/incident/detection-accuracy/",{params:{timeRange:"all"}});if(e.data){console.log("Raw Detection Accuracy response:",e.data);const t=e.data.value,i=parseFloat(t);this.kpiData.detectionAccuracy={value:i,unit:e.data.unit||"%",change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated detectionAccuracy in kpiData:",this.kpiData.detectionAccuracy)}else console.warn("Detection Accuracy response has no data")}catch(a){console.error("Error fetching Detection Accuracy data:",a)}try{console.log("Fetching Incident Closure Rate data from /api/incident/incident-closure-rate/");const e=await He.A.get("/api/incident/incident-closure-rate/",{params:{timeRange:"all"}});if(e.data){console.log("Raw Incident Closure Rate response:",e.data);const t=e.data.value,i=parseFloat(t);this.kpiData.closureRate={value:i,unit:e.data.unit||"%",change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated closureRate in kpiData:",this.kpiData.closureRate)}else console.warn("Incident Closure Rate response has no data")}catch(a){console.error("Error fetching Incident Closure Rate data:",a)}try{console.log("Fetching reopened incidents count data");const e=await He.A.get("/api/incident/reopened-count/");e.data&&(this.kpiData.reopenedIncidents.value=e.data.reopened_incidents||0,this.kpiData.reopenedIncidents.percentage=e.data.percentage_reopened||0)}catch(a){console.error("Error fetching reopened incidents:",a)}try{console.log("Fetching First Response Time data from /api/incident/first-response-time/");const e=await He.A.get("/api/incident/first-response-time/",{params:{timeRange:"all"}});if(e.data){console.log("Raw First Response Time data:",e.data);const t=e.data.value,i=parseFloat(t),a=Array.isArray(e.data.trend)?e.data.trend.map(e=>({month:e.month||"",minutes:parseFloat(e.minutes||0),count:e.count||0,fastest:e.fastest||0,slowest:e.slowest||0,details:e.details||[]})):[];this.kpiData.firstResponseTime={value:i,unit:e.data.unit||"hours",trend:a,change_percentage:parseFloat(e.data.change_percentage||0)},console.log("Updated firstResponseTime in kpiData:",this.kpiData.firstResponseTime)}}catch(a){console.error("Error fetching First Response Time data:",a)}try{console.log("Fetching incident count data from /api/incident/count/");const e=await He.A.get("/api/incident/count/",{params:{timeRange:"all"}});if(console.log("Incident count response:",JSON.stringify(e.data)),e.data){const t=e.data.value,i=e.data.byDay,a=e.data.details||[];this.kpiData.incidentsDetected={value:t,byDay:i,details:a},console.log("Updated incident count:",this.kpiData.incidentsDetected.value),console.log("Day distribution:",this.kpiData.incidentsDetected.byDay)}}catch(o){console.error("Error fetching incident count data:",o)}try{console.log("Fetching incidents by severity data");const e=await He.A.get("/api/incident/by-severity/");if(e.data&&e.data.data){console.log("Raw severity response:",e.data);const t={high:0,medium:0,low:0};e.data.data.forEach(e=>{const i=e.severity.toLowerCase();i in t&&(t[i]=e.percentage)}),this.kpiData.incidentsBySeverity=t,console.log("Updated incidents by severity:",this.kpiData.incidentsBySeverity)}}catch(l){console.error("Error fetching incidents by severity:",l)}try{console.log("Fetching incident root causes data");const e=await He.A.get("/api/incident/root-causes/");if(e.data&&e.data.data){console.log("Raw root causes response:",e.data);const t={};e.data.data.forEach(e=>{t[e.category]=e.percentage}),this.kpiData.rootCauseCategories=t,console.log("Updated root cause categories:",this.kpiData.rootCauseCategories)}}catch(n){console.error("Error fetching incident root causes:",n)}try{console.log("Fetching incident origins data");const e=await He.A.get("/api/incident/origins/");e.data&&e.data.data&&(console.log("Raw origins response:",e.data),this.kpiData.incidentOrigins=e.data.data,console.log("Updated incident origins:",this.kpiData.incidentOrigins))}catch(r){console.error("Error fetching incident origins:",r)}try{console.log("Fetching incident types data");const e=await He.A.get("/api/incident/types/");e.data&&e.data.data&&(console.log("Raw incident types response:",e.data),this.kpiData.incidentTypes=e.data.data,console.log("Updated incident types:",this.kpiData.incidentTypes))}catch(c){console.error("Error fetching incident types:",c)}try{const e=await He.A.get("/api/incident/incident-volume/");this.kpiData.incidentVolume=e.data}catch(a){console.error("Error fetching incident volume:",a)}try{console.log("Fetching escalation rate data");const e=await He.A.get("/api/incident/escalation-rate/");e.data&&(this.kpiData.escalationRate={value:e.data.value||0,audit:e.data.audit||0,manual:e.data.manual||0},console.log("Updated escalation rate:",this.kpiData.escalationRate))}catch(a){console.error("Error fetching escalation rate:",a)}try{console.log("Fetching cost per incident data");const e=await He.A.get("/api/incident/cost/");e.data&&(console.log("Cost data response:",e.data),this.kpiData.costData={total_cost:e.data.total_cost||0,total_cost_k:e.data.total_cost_k||0,display_total:e.data.display_total||"0",by_severity:Array.isArray(e.data.by_severity)?e.data.by_severity.map(e=>({severity:e.severity||"Unknown",cost:e.cost||0,cost_k:e.cost_k||0,label:e.label||e.severity})):[]},console.log("Updated costData:",this.kpiData.costData))}catch(a){console.error("Error fetching cost per incident:",a)}try{console.log("Fetching repeat rate data");const e=await He.A.get("/api/incident/repeat-rate/");e.data&&(this.kpiData.repeatRate={value:e.data.value||0,new:e.data.new||0,repeat:e.data.repeat||0},console.log("Updated repeat rate:",this.kpiData.repeatRate))}catch(a){console.error("Error fetching repeat rate:",a)}this.loading=!1}catch(a){console.error("Error in fetchKPIData:",a),Ck.OQ.error("Error loading dashboard data. Please try again later."),this.loading=!1}},generateTrendPath(e){if(!e||0===e.length)return"";const t=Math.max(...e),i=Math.min(...e),a=t-i||1,s=300,o=60,l=10,n=10,r=o-l-n,c=s/(e.length-1||1);let d="M0,"+(o-n-(e[0]-i)/a*r);for(let u=1;u<e.length;u++){const t=u*c,s=o-n-(e[u]-i)/a*r;d+=` L${t},${s}`}return d},getTrendPoints(e){if(!e||0===e.length)return[];const t=Math.max(...e),i=Math.min(...e),a=t-i||1,s=300,o=60,l=10,n=10,r=o-l-n,c=s/(e.length-1||1);return e.map((e,t)=>({x:t*c,y:o-n-(e-i)/a*r}))},fetchIncidentCounts(){console.log("Fetching incident counts"),fetch("/api/incidents/counts/").then(e=>e.json()).then(e=>{console.log("Received incident counts:",e),this.incidentCounts=e}).catch(e=>{console.error("Error fetching incident counts:",e)})},calculateBarHeight(e,t){if(!t||0===t.length||!e)return"0%";const i=Math.max(...t);return 0===i?"0%":e/i*85+"%"},showTooltip(e,t){const i=e.target.closest(".line-chart").getBoundingClientRect(),a=i.width,s=e.clientX-i.left,o=e.clientY-i.top;let l,n;const r=150;s<r/2?(l=s+10,this.tooltipStyle.transform="translateX(0)"):s>a-r/2?(l=s-10,this.tooltipStyle.transform="translateX(-100%)"):(l=s,this.tooltipStyle.transform="translateX(-50%)"),n=Math.max(5,o-70),this.tooltipStyle={display:"block",left:`${l}px`,top:`${n}px`,transform:this.tooltipStyle.transform,zIndex:1e3},this.activeTooltip=t},hideTooltip(){this.tooltipStyle={display:"none",left:"0px",top:"0px"},this.activeTooltip=null},fetchMTTR(){console.log("Fetching MTTR data");const e=this.selectedTimeRange;fetch(`/api/incident/mttr/?timeRange=${e}`).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{console.log("MTTR data received:",e),this.mttr=e.mttr,this.mttrChartData=e.chart_data,this.mttrChangePercentage=e.change_percentage,this.$nextTick(()=>{this.renderMTTRChart()})}).catch(e=>{console.error("Error fetching MTTR data:",e)})},renderMTTRChart(){if(!this.mttrChartData||0===this.mttrChartData.length)return;const e=this.$refs.mttrChart;if(!e)return;while(e.firstChild)e.removeChild(e.firstChild);const t=300,i=60,a=5,s=t-2*a,o=i-2*a,l=this.mttrChartData.map(e=>e.value),n=this.mttrChartData.map(e=>e.date),r=this.mttrChartData.map(e=>e.count),c=Math.min(...l),d=Math.max(...l),u=e=>a+e/(l.length-1)*s,p=e=>i-a-(e-c)/(d-c)*o;let m="";l.forEach((e,t)=>{const i=u(t),a=p(e);m+=(0===t?"M":"L")+i+","+a});const v=document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d",m),v.setAttribute("fill","none"),v.setAttribute("stroke","#3498db"),v.setAttribute("stroke-width","2"),e.appendChild(v),l.forEach((t,i)=>{const a=document.createElementNS("http://www.w3.org/2000/svg","circle"),s=u(i),o=p(t);a.setAttribute("cx",s),a.setAttribute("cy",o),a.setAttribute("r","4"),a.setAttribute("fill","#3498db");const l=n[i],c=r[i];a.addEventListener("mouseover",e=>{const i=document.getElementById("mttr-tooltip");i.innerHTML=`<strong>Date:</strong> ${l}<br><strong>MTTR:</strong> ${t} mins<br><strong>Incidents:</strong> ${c}`;const a=e.target.getBoundingClientRect(),s=i.getBoundingClientRect(),o=window.innerWidth;let n=a.left;n+s.width>o-20&&(n=a.left-s.width),i.style.left=`${n}px`,i.style.top=a.top-s.height-10+"px",i.style.display="block"}),a.addEventListener("mouseout",()=>{document.getElementById("mttr-tooltip").style.display="none"}),e.appendChild(a)})},refreshData(){this.fetchMTTD(),this.fetchIncidentsCount(),this.fetchMTTR()},showPieTooltip(e,t,i){const a=this.incidentCounts.total||100,s=i/100*a,o=e.target.closest(".pie-chart-container").getBoundingClientRect(),l=e.clientX-o.left,n=e.clientY-o.top;this.pieTooltipStyle={display:"block",left:`${l}px`,top:n-60+"px"},this.activePieTooltip={severity:t,percentage:i,count:s}},hidePieTooltip(){this.pieTooltipStyle={display:"none",left:"0px",top:"0px"},this.activePieTooltip=null},showRootCauseTooltip(e,t,i){const a=this.incidentCounts.total||100,s=i/100*a,o=e.target.getBoundingClientRect(),l=o.left+o.width/2,n=o.top-10;this.rootCauseTooltipStyle={display:"block",left:`${l}px`,top:n-60+"px"},this.activeRootCauseTooltip={category:t,percentage:i,count:s}},hideRootCauseTooltip(){this.rootCauseTooltipStyle={display:"none",left:"0px",top:"0px"},this.activeRootCauseTooltip=null},getOriginColor(e){const t={Manual:"#ffd166",SIEM:"#118ab2",Unknown:"#073b4c","Audit Finding":"#ef476f",System:"#06d6a0",User:"#4361ee",Automated:"#ff6b6b"};return t[e]||"#95a5a6"},getStrokeDashOffset(e){let t=0;for(let i=0;i<e;i++)t+=2.51*this.kpiData.incidentOrigins[i].percentage;return t},showOriginTooltip(e,t,i,a){try{const s=e.target.closest(".small-donut-container");if(!s)return void console.warn("Could not find chart container for tooltip positioning");const o=s.getBoundingClientRect(),l=e.clientX-o.left,n=e.clientY-o.top;this.originTooltipStyle={display:"block",left:`${l}px`,top:n-10+"px",zIndex:2e3},this.activeOriginTooltip={origin:t,percentage:i,count:a}}catch(s){console.error("Error showing origin tooltip:",s),this.hideOriginTooltip()}},hideOriginTooltip(){this.originTooltipStyle={display:"none",left:"0px",top:"0px"},this.activeOriginTooltip=null},getVolumeTrendPath(e){if(!e||0===e.length)return"";const t=400,i=80,a=5,s=Math.max(...e.map(e=>e.count),1),o=e.map((o,l)=>{const n=a+l*(t-2*a)/(e.length-1),r=i-a-o.count/s*(i-2*a);return`${n},${r}`}),l=`M${o.join(" L")}`,n=`${l} L${t-a},${i-a} L${a},${i-a} Z`;return n},showStackedTooltip(e,t,i){const a=e.target.getBoundingClientRect();this.stackedTooltipStyle={display:"block",left:a.left+a.width/2+"px",top:a.top-40+"px"},this.activeStackedTooltip={type:t,percentage:i}},hideStackedTooltip(){this.stackedTooltipStyle={display:"none",left:"0px",top:"0px"},this.activeStackedTooltip=null},fetchIncidentCost(){console.log("Fetching incident cost data..."),He.A.get("/api/incident/cost/").then(e=>{console.log("Cost data received:",e.data),this.kpiData.costData=e.data}).catch(e=>{console.error("Error fetching incident cost:",e)})},formatCurrency(e){if(!e)return"0";const t=e/1e3;return t}},mounted(){this.fetchKPIData(),this.fetchIncidentCounts()}};const NJ=(0,le.A)(UJ,[["render",VJ],["__scopeId","data-v-ba40ffbc"]]);var MJ=NJ,XJ=i(9554);const $J={class:"incident-details-page"},OJ={class:"incident-details-header"},jJ={key:0,class:"incident-loading-state"},BJ={key:1,class:"incident-error-state"},WJ={key:2,class:"incident-details-content"},qJ={class:"incident-header-section"},QJ={class:"incident-title-container"},KJ={class:"incident-title-section"},JJ={class:"incident-title"},zJ={class:"incident-id"},HJ={class:"incident-status-container"},GJ={key:0,class:"incident-status-badge incident-scheduled"},YJ={key:1,class:"incident-status-badge incident-rejected"},ZJ={key:2,class:"incident-status-badge incident-assigned"},ez={key:3,class:"incident-status-badge incident-approved"},tz={key:4,class:"incident-status-badge incident-active"},iz={key:5,class:"incident-status-badge incident-under-review"},az={key:6,class:"incident-status-badge incident-completed"},sz={key:7,class:"incident-status-badge incident-closed"},oz={key:8,class:"incident-status-badge incident-open"},lz={class:"incident-details-section"},nz={class:"incident-basic-info-grid"},rz={class:"incident-detail-item"},cz={class:"incident-detail-item"},dz={class:"incident-detail-item"},uz={class:"incident-detail-item"},pz={class:"incident-detail-value"},mz={class:"incident-detail-item"},vz={class:"incident-detail-value"},kz={class:"incident-detail-item"},hz={class:"incident-detail-value"},gz={class:"incident-details-section"},yz={class:"incident-description-content"},fz={class:"incident-detail-value incident-description-value"},bz={class:"incident-details-section"},Cz={class:"incident-impact-grid"},Lz={class:"incident-detail-item"},wz={class:"incident-detail-value"},Ez={class:"incident-detail-item"},Rz={class:"incident-detail-value"},Iz={class:"incident-detail-item"},Dz={class:"incident-detail-value"},Pz={class:"incident-detail-item"},_z={class:"incident-detail-value"},Az={class:"incident-detail-item incident-full-width"},Sz={class:"incident-detail-value incident-description-style"},Tz={class:"incident-detail-item incident-full-width"},xz={class:"incident-detail-value incident-description-style"},Fz={class:"incident-details-section"},Vz={class:"incident-impact-grid"},Uz={class:"incident-detail-item incident-full-width"},Nz={class:"incident-detail-value incident-description-style"},Mz={class:"incident-detail-item incident-full-width"},Xz={class:"incident-detail-value incident-description-style"},$z={class:"incident-detail-item incident-full-width"},Oz={class:"incident-detail-value incident-description-style"},jz={class:"incident-details-section"},Bz={class:"incident-compliance-grid"},Wz={class:"incident-detail-item"},qz={class:"incident-detail-value incident-description-style"},Qz={class:"incident-detail-item"},Kz={class:"incident-detail-value incident-description-style"},Jz={class:"incident-details-section"},zz={class:"incident-response-grid"},Hz={class:"incident-response-item mitigation-section"},Gz={class:"incident-section-content"},Yz={class:"incident-response-item comments-section"},Zz={class:"incident-section-content"},eH={class:"incident-response-item lessons-section"},tH={class:"incident-section-content"},iH={class:"incident-details-section"},aH={class:"incident-basic-info-grid"},sH={class:"incident-detail-item"},oH={class:"incident-detail-item"},lH={class:"incident-details-footer"},nH={key:0},rH={key:1},cH={class:"incident-status-badge incident-rejected"},dH={key:2},uH={key:3},pH={key:4},mH={key:5},vH={key:6},kH={key:7},hH={key:8,class:"incident-action-buttons"},gH={key:0,class:"no-permission-message"};function yH(e,t,i,a,o,l){const n=(0,s.g2)("router-link"),r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",$J,[(0,s.Lk)("div",OJ,[(0,s.bF)(n,{to:"/incident/incident",class:"incident-back-link"},{default:(0,s.k6)(()=>t[2]||(t[2]=[(0,s.Lk)("span",{class:"incident-back-arrow"},"←",-1),(0,s.Lk)("span",{class:"back-text"},"Back to Incidents",-1)])),_:1,__:[2]})]),o.loading?((0,s.uX)(),(0,s.CE)("div",jJ," Loading incident details... ")):o.error?((0,s.uX)(),(0,s.CE)("div",BJ,(0,d.v_)(o.error),1)):o.incident?((0,s.uX)(),(0,s.CE)("div",WJ,[(0,s.Lk)("div",qJ,[(0,s.Lk)("div",QJ,[(0,s.Lk)("div",KJ,[(0,s.Lk)("h1",JJ,(0,d.v_)(o.incident.IncidentTitle),1),(0,s.Lk)("div",zJ,"Incident #"+(0,d.v_)(o.incident?.IncidentId),1)]),(0,s.Lk)("div",HJ,["Scheduled"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",GJ,"Mitigated to Risk")):"Rejected"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",YJ,(0,d.v_)("RISK"===o.incident.RejectionSource?"Rejected from Risk":"Rejected as Incident"),1)):"Assigned"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",ZJ,"Assigned")):"Approved"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",ez,"Approved")):"Active"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",tz,"Active")):"Under Review"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",iz,"Under Review")):"Completed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",az,"Completed")):"Closed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("span",sz,"Closed")):((0,s.uX)(),(0,s.CE)("span",oz,"Open"))])])]),(0,s.Lk)("div",lz,[t[9]||(t[9]=(0,s.Lk)("h2",{class:"incident-section-title"},"Basic Information",-1)),(0,s.Lk)("div",nz,[(0,s.Lk)("div",rz,[t[3]||(t[3]=(0,s.Lk)("span",{class:"incident-detail-label"},"Priority",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-priority-badge",l.getPriorityClass(o.incident.RiskPriority)])},(0,d.v_)(o.incident.RiskPriority||"Not Set"),3)]),(0,s.Lk)("div",cz,[t[4]||(t[4]=(0,s.Lk)("span",{class:"incident-detail-label"},"Category",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-category-badge",l.getRiskCategoryClass(o.incident.RiskCategory)])},(0,d.v_)(o.incident.RiskCategory||"Not Set"),3)]),(0,s.Lk)("div",dz,[t[5]||(t[5]=(0,s.Lk)("span",{class:"incident-detail-label"},"Origin",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-origin-badge",l.getOriginClass(o.incident.Origin)])},(0,d.v_)(o.incident.Origin||"Not Set"),3)]),(0,s.Lk)("div",uz,[t[6]||(t[6]=(0,s.Lk)("span",{class:"incident-detail-label"},"Criticality",-1)),(0,s.Lk)("span",pz,(0,d.v_)(o.incident.Criticality||"Not Set"),1)]),(0,s.Lk)("div",mz,[t[7]||(t[7]=(0,s.Lk)("span",{class:"incident-detail-label"},"Date",-1)),(0,s.Lk)("span",vz,(0,d.v_)(l.formatDate(o.incident.Date)),1)]),(0,s.Lk)("div",kz,[t[8]||(t[8]=(0,s.Lk)("span",{class:"incident-detail-label"},"Time",-1)),(0,s.Lk)("span",hz,(0,d.v_)(o.incident.Time||"Not Set"),1)])])]),(0,s.Lk)("div",gz,[t[10]||(t[10]=(0,s.Lk)("h2",{class:"incident-section-title"},"Description",-1)),(0,s.Lk)("div",yz,[(0,s.Lk)("div",fz,(0,d.v_)(o.incident.Description||"No description provided"),1)])]),(0,s.Lk)("div",bz,[t[17]||(t[17]=(0,s.Lk)("h2",{class:"incident-section-title"},"Impact & Assessment",-1)),(0,s.Lk)("div",Cz,[(0,s.Lk)("div",Lz,[t[11]||(t[11]=(0,s.Lk)("span",{class:"incident-detail-label"},"Affected Business Unit",-1)),(0,s.Lk)("span",wz,(0,d.v_)(o.incident.AffectedBusinessUnit||"Not specified"),1)]),(0,s.Lk)("div",Ez,[t[12]||(t[12]=(0,s.Lk)("span",{class:"incident-detail-label"},"Systems/Assets Involved",-1)),(0,s.Lk)("span",Rz,(0,d.v_)(o.incident.SystemsAssetsInvolved||"Not specified"),1)]),(0,s.Lk)("div",Iz,[t[13]||(t[13]=(0,s.Lk)("span",{class:"incident-detail-label"},"Geographic Location",-1)),(0,s.Lk)("span",Dz,(0,d.v_)(o.incident.GeographicLocation||"Not specified"),1)]),(0,s.Lk)("div",Pz,[t[14]||(t[14]=(0,s.Lk)("span",{class:"incident-detail-label"},"Cost of Incident",-1)),(0,s.Lk)("span",_z,(0,d.v_)(o.incident.CostOfIncident||"Not specified"),1)]),(0,s.Lk)("div",Az,[t[15]||(t[15]=(0,s.Lk)("span",{class:"incident-detail-label"},"Initial Impact Assessment",-1)),(0,s.Lk)("div",Sz,(0,d.v_)(o.incident.InitialImpactAssessment||"No assessment provided"),1)]),(0,s.Lk)("div",Tz,[t[16]||(t[16]=(0,s.Lk)("span",{class:"incident-detail-label"},"Possible Damage",-1)),(0,s.Lk)("div",xz,(0,d.v_)(o.incident.PossibleDamage||"No damage assessment provided"),1)])])]),(0,s.Lk)("div",Fz,[t[21]||(t[21]=(0,s.Lk)("h2",{class:"incident-section-title"},"Contacts & Involved Parties",-1)),(0,s.Lk)("div",Vz,[(0,s.Lk)("div",Uz,[t[18]||(t[18]=(0,s.Lk)("span",{class:"incident-detail-label"},"Internal Contacts",-1)),(0,s.Lk)("div",Nz,(0,d.v_)(o.incident.InternalContacts||"No internal contacts specified"),1)]),(0,s.Lk)("div",Mz,[t[19]||(t[19]=(0,s.Lk)("span",{class:"incident-detail-label"},"External Parties Involved",-1)),(0,s.Lk)("div",Xz,(0,d.v_)(o.incident.ExternalPartiesInvolved||"No external parties specified"),1)]),(0,s.Lk)("div",$z,[t[20]||(t[20]=(0,s.Lk)("span",{class:"incident-detail-label"},"Regulatory Bodies",-1)),(0,s.Lk)("div",Oz,(0,d.v_)(o.incident.RegulatoryBodies||"No regulatory bodies involved"),1)])])]),(0,s.Lk)("div",jz,[t[24]||(t[24]=(0,s.Lk)("h2",{class:"incident-section-title"},"Compliance & Controls",-1)),(0,s.Lk)("div",Bz,[(0,s.Lk)("div",Wz,[t[22]||(t[22]=(0,s.Lk)("span",{class:"incident-detail-label"},"Relevant Policies/Procedures Violated",-1)),(0,s.Lk)("div",qz,(0,d.v_)(o.incident.RelevantPoliciesProceduresViolated||"No violations identified"),1)]),(0,s.Lk)("div",Qz,[t[23]||(t[23]=(0,s.Lk)("span",{class:"incident-detail-label"},"Control Failures",-1)),(0,s.Lk)("div",Kz,(0,d.v_)(o.incident.ControlFailures||"No control failures identified"),1)])])]),(0,s.Lk)("div",Jz,[t[28]||(t[28]=(0,s.Lk)("h2",{class:"incident-section-title"},"Response & Resolution",-1)),(0,s.Lk)("div",zz,[(0,s.Lk)("div",Hz,[t[25]||(t[25]=(0,s.Lk)("div",{class:"incident-section-header"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Mitigation Plan ")],-1)),(0,s.Lk)("div",Gz,(0,d.v_)(o.incident.Mitigation||"No mitigation plan provided"),1)]),(0,s.Lk)("div",Yz,[t[26]||(t[26]=(0,s.Lk)("div",{class:"incident-section-header"},[(0,s.Lk)("i",{class:"fas fa-comments"}),(0,s.eW)(" Comments ")],-1)),(0,s.Lk)("div",Zz,(0,d.v_)(o.incident.Comments||"No comments available"),1)]),(0,s.Lk)("div",eH,[t[27]||(t[27]=(0,s.Lk)("div",{class:"incident-section-header"},[(0,s.Lk)("i",{class:"fas fa-lightbulb"}),(0,s.eW)(" Lessons Learned ")],-1)),(0,s.Lk)("div",tH,(0,d.v_)(o.incident.LessonsLearned||"No lessons learned documented"),1)])])]),(0,s.Lk)("div",iH,[t[31]||(t[31]=(0,s.Lk)("h2",{class:"incident-section-title"},"Additional Information",-1)),(0,s.Lk)("div",aH,[(0,s.Lk)("div",sH,[t[29]||(t[29]=(0,s.Lk)("span",{class:"incident-detail-label"},"Repeated Incident",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-flag-badge",o.incident.RepeatedNot?"incident-flag-yes":"incident-flag-no"])},(0,d.v_)(o.incident.RepeatedNot?"Yes":"No"),3)]),(0,s.Lk)("div",oH,[t[30]||(t[30]=(0,s.Lk)("span",{class:"incident-detail-label"},"Reopened Incident",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["incident-flag-badge",o.incident.ReopenedNot?"incident-flag-yes":"incident-flag-no"])},(0,d.v_)(o.incident.ReopenedNot?"Yes":"No"),3)])])]),(0,s.Lk)("div",lH,["Scheduled"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",nH,t[32]||(t[32]=[(0,s.Lk)("span",{class:"incident-status-badge incident-scheduled"},"Mitigated to Risk",-1)]))):"Rejected"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",rH,[(0,s.Lk)("span",cH,(0,d.v_)("RISK"===o.incident.RejectionSource?"Rejected from Risk":"Rejected as Incident"),1)])):"Assigned"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",dH,t[33]||(t[33]=[(0,s.Lk)("span",{class:"incident-status-badge incident-assigned"},"Assigned",-1)]))):"Approved"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",uH,t[34]||(t[34]=[(0,s.Lk)("span",{class:"incident-status-badge incident-approved"},"Approved",-1)]))):"Active"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",pH,t[35]||(t[35]=[(0,s.Lk)("span",{class:"incident-status-badge incident-active"},"Active",-1)]))):"Under Review"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",mH,t[36]||(t[36]=[(0,s.Lk)("span",{class:"incident-status-badge incident-under-review"},"Under Review",-1)]))):"Completed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",vH,t[37]||(t[37]=[(0,s.Lk)("span",{class:"incident-status-badge incident-completed"},"Completed",-1)]))):"Closed"===o.incident.Status?((0,s.uX)(),(0,s.CE)("div",kH,t[38]||(t[38]=[(0,s.Lk)("span",{class:"incident-status-badge incident-closed"},"Closed",-1)]))):((0,s.uX)(),(0,s.CE)("div",hH,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>l.openSolveModal&&l.openSolveModal(...e)),class:"incident-solve-btn"},t[39]||(t[39]=[(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1),(0,s.eW)(" ESCALATE TO RISK ")])),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.openRejectModal&&l.openRejectModal(...e)),class:"incident-no-btn"},t[40]||(t[40]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" REJECT INCIDENT ")])),e.canEscalateIncident()||e.canEditIncident()?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",gH,t[41]||(t[41]=[(0,s.Lk)("i",{class:"fas fa-lock"},null,-1),(0,s.Lk)("span",null,"No actions available - insufficient permissions",-1)])))]))])])):(0,s.Q3)("",!0),(0,s.bF)(r)])}var fH=i(766),bH={name:"IncidentDetails",components:{PopupModal:Ck.wA},mixins:[fH.r],data(){return{incident:null,loading:!0,error:null}},async created(){await this.fetchIncidentDetails()},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async fetchIncidentDetails(){try{this.loading=!0,this.error=null;const e=this.$route.params.id;if(console.log("Fetching incident:",e),this.logUserAction("VIEW_INCIDENT_DETAILS","incident",e),!this.canViewIncident())return console.warn("❌ Permission denied for viewing incident details"),void(this.error="You do not have permission to view incident details.");console.log("✅ Permission granted for viewing incident details");const t=await He.A.get("http://localhost:8000/api/incident-incidents/"),i=t.data;if(this.incident=i.find(t=>t.IncidentId.toString()===e.toString()),!this.incident)throw new Error("Incident not found");console.log("Fetched incident:",this.incident)}catch(e){console.error("Failed to fetch incident details:",e),this.error="Failed to load incident details. Please try again."}finally{this.loading=!1}},openSolveModal(){if(this.logUserAction("ESCALATE_INCIDENT","incident",this.incident?.IncidentId),!this.canEscalateIncident())return console.warn("❌ Permission denied for escalating incident"),Ck.OQ.error("You don't have permission to escalate incidents"),void this.sendPushNotification({title:"Permission Denied - Incident Escalation",message:`Permission denied for escalating incident #${this.incident?.IncidentId||"Unknown"}. User does not have required permissions.`,category:"incident",priority:"high",user_id:"default_user"});console.log("✅ Permission granted for escalating incident"),Ck.OQ.confirm("This incident will be forwarded to the Risk module. Do you want to proceed?","Forward to Risk",()=>this.confirmSolve(),()=>{})},openRejectModal(){if(this.logUserAction("REJECT_INCIDENT","incident",this.incident?.IncidentId),!this.canEditIncident())return console.warn("❌ Permission denied for rejecting incident"),Ck.OQ.error("You don't have permission to reject incidents"),void this.sendPushNotification({title:"Permission Denied - Incident Rejection",message:`Permission denied for rejecting incident #${this.incident?.IncidentId||"Unknown"}. User does not have required permissions.`,category:"incident",priority:"high",user_id:"default_user"});console.log("✅ Permission granted for rejecting incident"),Ck.OQ.confirm("Are you sure you want to reject this incident?","Reject Incident",()=>this.confirmReject(),()=>{})},confirmSolve(){He.A.put(`http://localhost:8000/incidents/${this.incident.IncidentId}/status/`,{status:"Scheduled"}).then(e=>{console.log("Incident escalated to risk:",e.data),this.incident.Status="Scheduled",Ck.OQ.success("Incident forwarded to Risk module successfully!"),this.sendPushNotification({title:"Incident Escalated to Risk",message:`Incident #${this.incident?.IncidentId||"Unknown"} "${this.incident?.IncidentTitle||"Untitled Incident"}" has been successfully escalated to the Risk module.`,category:"incident",priority:"high",user_id:"default_user"}),setTimeout(()=>{},2e3)}).catch(e=>{console.error("Error updating incident status:",e),this.sendPushNotification({title:"Error - Incident Escalation Failed",message:`Failed to escalate incident #${this.incident?.IncidentId||"Unknown"} to Risk module. Error: ${e.message||"Unknown error"}`,category:"incident",priority:"high",user_id:"default_user"})})},confirmReject(){He.A.put(`http://localhost:8000/incidents/${this.incident.IncidentId}/status/`,{status:"Rejected"}).then(e=>{console.log("Incident rejected:",e.data),this.incident.Status="Rejected",Ck.OQ.success("Incident rejected successfully!"),this.sendPushNotification({title:"Incident Rejected",message:`Incident #${this.incident?.IncidentId||"Unknown"} "${this.incident?.IncidentTitle||"Untitled Incident"}" has been rejected successfully.`,category:"incident",priority:"medium",user_id:"default_user"})}).catch(e=>{console.error("Error updating incident status:",e),this.sendPushNotification({title:"Error - Incident Rejection Failed",message:`Failed to reject incident #${this.incident?.IncidentId||"Unknown"}. Error: ${e.message||"Unknown error"}`,category:"incident",priority:"high",user_id:"default_user"})})},getPriorityClass(e){switch(e?.toLowerCase()){case"high":return"incident-priority-high";case"medium":return"incident-priority-medium";case"low":return"incident-priority-low";default:return""}},getRiskCategoryClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("security")?"incident-category-security":t.includes("compliance")?"incident-category-compliance":t.includes("operational")?"incident-category-operational":t.includes("financial")?"incident-category-financial":t.includes("strategic")?"incident-category-strategic":"incident-category-other"},getOriginClass(e){const t=e?.toLowerCase()||"";return t.includes("manual")?"incident-origin-manual":t.includes("audit")?"incident-origin-audit":t.includes("siem")?"incident-origin-siem":"incident-origin-other"},formatDate(e){if(!e)return"";const[t,i,a]=e.split("-");return`${i}/${a}/${t}`}}};const CH=(0,le.A)(bH,[["render",yH]]);var LH=CH;const wH={class:"audit-findings-container"},EH={class:"audit-findings-header"},RH={class:"incident-actions"},IH={class:"incident-export-controls"},DH=["disabled"],PH={key:0},_H={key:1},AH={key:0,class:"loading-container"},SH={key:1,class:"error-container"},TH={key:2,class:"incident-findings-content"},xH={class:"incident-summary-cards"},FH={class:"card-content"},VH={class:"card-value"},UH={class:"card-content"},NH={class:"card-value"},MH={class:"card-content"},XH={class:"card-value"},$H={class:"card-content"},OH={class:"card-value"},jH={class:"card-content"},BH={class:"card-value"},WH={class:"card-content"},qH={class:"card-value"},QH={class:"incident-controls"},KH={class:"incident-search-controls"},JH={class:"incident-filters-wrapper"},zH={class:"incident-filters"},HH={class:"action-buttons"},GH=["onClick"],YH=["onClick"],ZH=["onClick"],eG=["onClick"],tG=["onClick"],iG={key:0,class:"empty-state"},aG={class:"modal-content"},sG={key:0,class:"solve-container"},oG={class:"modal-footer"},lG={key:1,class:"closed-container"},nG={class:"modal-footer"},rG={key:4,class:"assignment-workflow-section"},cG={class:"assignment-header"},dG={class:"assignment-body"},uG={class:"incident-summary"},pG={class:"incident-details"},mG={class:"user-selection"},vG={class:"user-form"},kG={class:"form-group"},hG=["value"],gG={class:"form-group"},yG=["value"],fG={class:"mitigation-workflow"},bG={key:0,class:"workflow-timeline"},CG={class:"step-number"},LG={class:"step-content"},wG=["onUpdate:modelValue"],EG={class:"step-actions"},RG=["onClick"],IG={key:1,class:"no-mitigations"},DG={class:"add-mitigation"},PG=["disabled"],_G={class:"due-date-section"},AG=["min"],SG={class:"assignment-notes-section"},TG={class:"assignment-actions"},xG=["disabled"];function FG(e,t,i,o,l,n){const r=(0,s.g2)("DynamicalSearch"),c=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",wH,[(0,s.Lk)("div",EH,[t[30]||(t[30]=(0,s.Lk)("h1",null,"Audit Finding Incidents",-1)),(0,s.Lk)("div",RH,[(0,s.Lk)("div",IH,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.exportFormat=e),class:"incident-export-format-select"},t[28]||(t[28]=[(0,s.Fv)('<option value="xlsx" data-v-8942ca0a>Excel (.xlsx)</option><option value="csv" data-v-8942ca0a>CSV (.csv)</option><option value="pdf" data-v-8942ca0a>PDF (.pdf)</option><option value="json" data-v-8942ca0a>JSON (.json)</option><option value="xml" data-v-8942ca0a>XML (.xml)</option><option value="txt" data-v-8942ca0a>Text (.txt)</option>',6)]),512),[[a.u1,o.exportFormat]]),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>o.exportAuditFindings&&o.exportAuditFindings(...e)),class:"incident-export-btn",disabled:o.isExporting},[o.isExporting?((0,s.uX)(),(0,s.CE)("span",PH,"Exporting...")):((0,s.uX)(),(0,s.CE)("span",_H,"Export"))],8,DH)]),(0,s.Lk)("button",{class:"incident-refresh-btn",onClick:t[2]||(t[2]=(...e)=>o.fetchData&&o.fetchData(...e))},t[29]||(t[29]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1),(0,s.eW)(" Refresh ")]))])]),o.loading?((0,s.uX)(),(0,s.CE)("div",AH,t[31]||(t[31]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("p",null,"Loading audit findings...",-1)]))):(0,s.Q3)("",!0),o.error?((0,s.uX)(),(0,s.CE)("div",SH,[t[32]||(t[32]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("p",null,(0,d.v_)(o.error),1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>o.fetchData&&o.fetchData(...e))},"Retry")])):(0,s.Q3)("",!0),o.loading||o.error?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",TH,[(0,s.Lk)("div",xH,[(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card open-card",{active:"open"===o.filterStatus}]),onClick:t[4]||(t[4]=e=>o.filterByStatus("open"))},[t[34]||(t[34]=(0,s.Lk)("div",{class:"card-icon open"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"})],-1)),(0,s.Lk)("div",FH,[t[33]||(t[33]=(0,s.Lk)("h3",null,"Open",-1)),(0,s.Lk)("div",VH,(0,d.v_)(o.summary.open||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card assigned-card",{active:"assigned"===o.filterStatus}]),onClick:t[5]||(t[5]=e=>o.filterByStatus("assigned"))},[t[36]||(t[36]=(0,s.Lk)("div",{class:"card-icon assigned"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",UH,[t[35]||(t[35]=(0,s.Lk)("h3",null,"Assigned",-1)),(0,s.Lk)("div",NH,(0,d.v_)(o.summary.assigned||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card closed-card",{active:"closed"===o.filterStatus}]),onClick:t[6]||(t[6]=e=>o.filterByStatus("closed"))},[t[38]||(t[38]=(0,s.Lk)("div",{class:"card-icon closed"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",MH,[t[37]||(t[37]=(0,s.Lk)("h3",null,"Closed",-1)),(0,s.Lk)("div",XH,(0,d.v_)(o.summary.closed||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card rejected-card",{active:"rejected"===o.filterStatus}]),onClick:t[7]||(t[7]=e=>o.filterByStatus("rejected"))},[t[40]||(t[40]=(0,s.Lk)("div",{class:"card-icon rejected"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",$H,[t[39]||(t[39]=(0,s.Lk)("h3",null,"Rejected",-1)),(0,s.Lk)("div",OH,(0,d.v_)(o.summary.rejected||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card mitigated-card",{active:"scheduled"===o.filterStatus}]),onClick:t[8]||(t[8]=e=>o.filterByStatus("scheduled"))},[t[42]||(t[42]=(0,s.Lk)("div",{class:"card-icon mitigated"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"})],-1)),(0,s.Lk)("div",jH,[t[41]||(t[41]=(0,s.Lk)("h3",null,"Mitigated to Risk",-1)),(0,s.Lk)("div",BH,(0,d.v_)(o.summary.mitigated||0),1)])],2),(0,s.Lk)("div",{class:(0,d.C4)(["incident-summary-card total-card",{active:"all"===o.filterStatus}]),onClick:t[9]||(t[9]=e=>o.filterByStatus("all"))},[t[44]||(t[44]=(0,s.Lk)("div",{class:"card-icon total"},[(0,s.Lk)("i",{class:"fas fa-list-alt"})],-1)),(0,s.Lk)("div",WH,[t[43]||(t[43]=(0,s.Lk)("h3",null,"Total Incidents",-1)),(0,s.Lk)("div",qH,(0,d.v_)(o.summary.total||0),1)])],2)]),(0,s.Lk)("div",QH,[(0,s.Lk)("div",KH,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":t[10]||(t[10]=e=>o.searchQuery=e),placeholder:"Search by title, ID, or description...",onInput:o.applyFilters,onSearch:o.applyFilters},null,8,["modelValue","onInput","onSearch"])]),(0,s.Lk)("div",JH,[(0,s.Lk)("div",zH,[(0,s.bF)(c,{modelValue:o.filterStatus,"onUpdate:modelValue":t[11]||(t[11]=e=>o.filterStatus=e),config:o.statusFilterConfig,onChange:o.applyFilters},null,8,["modelValue","config","onChange"]),(0,s.bF)(c,{modelValue:o.sortBy,"onUpdate:modelValue":t[12]||(t[12]=e=>o.sortBy=e),config:o.sortByConfig,onChange:o.applyFilters},null,8,["modelValue","config","onChange"])])])]),(0,s.Lk)("div",{class:(0,d.C4)(["incident-findings-table",{"dropdown-open":null!==o.dropdownOpenFor}])},[(0,s.Lk)("table",null,[t[48]||(t[48]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Incident ID"),(0,s.Lk)("th",null,"Title"),(0,s.Lk)("th",null,"Priority"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Origin"),(0,s.Lk)("th",null,"Date"),(0,s.Lk)("th",null,"Time"),(0,s.Lk)("th",null,"Description"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.findings,(e,i)=>((0,s.uX)(),(0,s.CE)("tr",{key:i,class:(0,d.C4)(o.getRowClass(e.Status))},[(0,s.Lk)("td",null,(0,d.v_)(e.IncidentId),1),(0,s.Lk)("td",null,(0,d.v_)(e.IncidentTitle),1),(0,s.Lk)("td",null,(0,d.v_)(e.RiskPriority||"N/A"),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",o.getStatusClass(e.Status)]),style:{display:"inline-block !important",visibility:"visible !important"}},(0,d.v_)(e.Status||"Open"),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.Origin),1),(0,s.Lk)("td",null,(0,d.v_)(o.formatDate(e.Date)),1),(0,s.Lk)("td",null,(0,d.v_)(e.Time||"N/A"),1),(0,s.Lk)("td",null,(0,d.v_)(o.truncateText(e.Description,50)),1),(0,s.Lk)("td",null,[(0,s.Lk)("div",HH,[e.Status&&"Open"!==e.Status?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"view-details-btn-small",onClick:t=>o.handleDropdownAction("view",e),title:"View Details"}," View Details ",8,tG)):((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.Lk)("button",{class:"incident-action-icon",onClick:t=>o.handleDropdownAction("assign",e),title:"Assign as Incident"},t[45]||(t[45]=[(0,s.Lk)("i",{class:"fas fa-user-plus"},null,-1)]),8,GH),(0,s.Lk)("button",{class:"incident-action-icon",onClick:t=>o.handleDropdownAction("escalate",e),title:"Escalate to Risk"},t[46]||(t[46]=[(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1)]),8,YH),(0,s.Lk)("button",{class:"incident-action-icon",onClick:t=>o.handleDropdownAction("close",e),title:"Close Incident"},t[47]||(t[47]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)]),8,ZH),(0,s.Lk)("button",{class:"view-details-btn-small",onClick:t=>o.handleDropdownAction("view",e),title:"View Details"}," View Details ",8,eG)],64))])])],2))),128))])])],2),0===o.findings.length?((0,s.uX)(),(0,s.CE)("div",iG,t[49]||(t[49]=[(0,s.Lk)("i",{class:"fas fa-search"},null,-1),(0,s.Lk)("p",null,"No audit finding incidents match your criteria.",-1)]))):(0,s.Q3)("",!0)])),o.showModal&&"assign"!==o.modalAction?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"modal-overlay",onClick:t[19]||(t[19]=(...e)=>o.closeModal&&o.closeModal(...e))},[(0,s.Lk)("div",{class:"modal-container",onClick:t[18]||(t[18]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("button",{class:"modal-close-btn",onClick:t[13]||(t[13]=(...e)=>o.closeModal&&o.closeModal(...e))},"✕"),(0,s.Lk)("div",aG,["solve"===o.modalAction?((0,s.uX)(),(0,s.CE)("div",sG,[t[50]||(t[50]=(0,s.Lk)("div",{class:"solve-icon"},"🔄",-1)),t[51]||(t[51]=(0,s.Lk)("h3",{class:"modal-title solve"},"Forwarded to Risk",-1)),t[52]||(t[52]=(0,s.Lk)("p",{class:"modal-subtitle"},"You will be directed to the Risk module",-1)),(0,s.Lk)("div",oG,[(0,s.Lk)("button",{onClick:t[14]||(t[14]=(...e)=>o.confirmSolve&&o.confirmSolve(...e)),class:"modal-btn confirm-btn"},"Confirm Forward"),(0,s.Lk)("button",{onClick:t[15]||(t[15]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"modal-btn cancel-btn"},"Cancel")])])):"close"===o.modalAction?((0,s.uX)(),(0,s.CE)("div",lG,[t[53]||(t[53]=(0,s.Lk)("div",{class:"closed-icon"},"✔",-1)),t[54]||(t[54]=(0,s.Lk)("h3",{class:"modal-title closed"},"CLOSED",-1)),(0,s.Lk)("div",nG,[(0,s.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>o.confirmClose&&o.confirmClose(...e)),class:"modal-btn close-btn"},"Confirm Close"),(0,s.Lk)("button",{onClick:t[17]||(t[17]=(...e)=>o.closeModal&&o.closeModal(...e)),class:"modal-btn cancel-btn"},"Cancel")])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),o.showAssignmentWorkflow?((0,s.uX)(),(0,s.CE)("div",rG,[(0,s.Lk)("div",cG,[(0,s.Lk)("button",{class:"back-btn",onClick:t[20]||(t[20]=(...e)=>o.closeAssignmentWorkflow&&o.closeAssignmentWorkflow(...e))},t[55]||(t[55]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Audit Findings ")]))]),(0,s.Lk)("div",dG,[(0,s.Lk)("div",uG,[(0,s.Lk)("h3",null,(0,d.v_)(o.selectedIncident.IncidentTitle||"Incident #"+o.selectedIncident.IncidentId),1),(0,s.Lk)("div",pG,[(0,s.Lk)("p",null,[t[56]||(t[56]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedIncident.IncidentId),1)]),(0,s.Lk)("p",null,[t[57]||(t[57]=(0,s.Lk)("strong",null,"Priority:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedIncident.RiskPriority),1)]),(0,s.Lk)("p",null,[t[58]||(t[58]=(0,s.Lk)("strong",null,"Origin:",-1)),(0,s.eW)(" "+(0,d.v_)(o.selectedIncident.Origin),1)])])]),(0,s.Lk)("div",mG,[t[63]||(t[63]=(0,s.Lk)("h3",null,"Assignment Details",-1)),(0,s.Lk)("div",vG,[(0,s.Lk)("div",kG,[t[60]||(t[60]=(0,s.Lk)("label",{for:"assigner"},"Assigner:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[21]||(t[21]=e=>o.selectedAssigner=e),id:"assigner",class:"assign-select",required:""},[t[59]||(t[59]=(0,s.Lk)("option",{value:""},"Select Assigner",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.availableUsers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,hG))),128))],512),[[a.u1,o.selectedAssigner]])]),(0,s.Lk)("div",gG,[t[62]||(t[62]=(0,s.Lk)("label",{for:"reviewer"},"Reviewer:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[22]||(t[22]=e=>o.selectedReviewer=e),id:"reviewer",class:"assign-select",required:""},[t[61]||(t[61]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.availableUsers,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,yG))),128))],512),[[a.u1,o.selectedReviewer]])])])]),(0,s.Lk)("div",fG,[t[70]||(t[70]=(0,s.Lk)("h3",null,"Mitigation Steps",-1)),o.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",bG,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.mitigationSteps,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"workflow-step"},[(0,s.Lk)("div",CG,(0,d.v_)(i+1),1),(0,s.Lk)("div",LG,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.description=t,class:"mitigation-textarea",placeholder:"Enter mitigation step description"},null,8,wG),[[a.Jo,e.description]]),(0,s.Lk)("div",EG,[(0,s.Lk)("button",{onClick:e=>o.removeMitigationStep(i),class:"remove-step-btn"},t[64]||(t[64]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1),(0,s.eW)(" Remove ")]),8,RG)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",IG,t[65]||(t[65]=[(0,s.Lk)("p",null,"No mitigation steps found for this incident. Add steps below.",-1)]))),(0,s.Lk)("div",DG,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[23]||(t[23]=e=>o.newMitigationStep=e),class:"mitigation-textarea",placeholder:"Enter mitigation step description(s). You can add multiple steps by separating them with commas or new lines."},null,512),[[a.Jo,o.newMitigationStep]]),(0,s.Lk)("button",{onClick:t[24]||(t[24]=(...e)=>o.addMitigationStep&&o.addMitigationStep(...e)),class:"add-step-btn",disabled:!o.newMitigationStep.trim()},t[66]||(t[66]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Mitigation Step ")]),8,PG)]),(0,s.Lk)("div",_G,[t[67]||(t[67]=(0,s.Lk)("h4",null,"Due Date for Mitigation Completion",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[25]||(t[25]=e=>o.mitigationDueDate=e),class:"due-date-input",min:o.getTodayDate()},null,8,AG),[[a.Jo,o.mitigationDueDate]])]),(0,s.Lk)("div",SG,[t[68]||(t[68]=(0,s.Lk)("h4",null,"Assignment Notes (Optional)",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[26]||(t[26]=e=>o.assignmentNotes=e),class:"assignment-notes-textarea",placeholder:"Add any specific instructions or notes for the assignees...",rows:"3"},null,512),[[a.Jo,o.assignmentNotes]])]),(0,s.Lk)("div",TG,[(0,s.Lk)("button",{onClick:t[27]||(t[27]=(...e)=>o.confirmAssignmentWorkflow&&o.confirmAssignmentWorkflow(...e)),class:"submit-assignment-btn",disabled:!o.selectedAssigner||!o.selectedReviewer||0===o.mitigationSteps.length||!o.mitigationDueDate},t[69]||(t[69]=[(0,s.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,s.eW)(" Assign Incident with Mitigations ")]),8,xG)])])])])):(0,s.Q3)("",!0),(0,s.bF)(u)])}var VG=i(2018),UG={name:"AuditFindings",components:{PopupModal:Ck.wA,DynamicalSearch:VG.A,CustomDropdown:xa.A},setup(){const e=(0,ae.rd)(),t=(0,ie.KR)([]),i=(0,ie.KR)(!0),a=(0,ie.KR)(null),o=(0,ie.KR)({}),l=(0,ie.KR)(!1),n=(0,ie.KR)(""),r=(0,ie.KR)(null),c=(0,ie.KR)(!1),d=(0,ie.KR)(""),u=(0,ie.KR)(""),p=(0,ie.KR)(""),m=(0,ie.KR)([]),v=(0,ie.KR)([]),k=(0,ie.KR)(""),h=(0,ie.KR)(""),g=(0,ie.KR)("all"),y=(0,ie.KR)("Date"),f=(0,ie.KR)("xlsx"),b=(0,ie.KR)(!1),C=(0,ie.KR)(null),L=(0,ie.KR)(""),w={name:"Status",values:[{value:"all",label:"All Status"},{value:"open",label:"Open"},{value:"assigned",label:"Assigned"},{value:"closed",label:"Closed"},{value:"rejected",label:"Rejected"},{value:"scheduled",label:"Escalated to Risk"}],defaultValue:"all"},E={name:"Sort By",values:[{value:"Date",label:"Date (Newest First)"},{value:"IncidentTitle",label:"Title"},{value:"RiskPriority",label:"Priority"},{value:"Status",label:"Status"}],defaultValue:"Date"},R=async()=>{i.value=!0,a.value=null;try{const e={};"all"!==g.value&&(e.status=g.value),e.sort=y.value,e.order="Date"===y.value?"desc":"asc",L.value&&(e.search=L.value);const i=await He.A.get("http://localhost:8000/api/audit-findings/",{params:e});if(!i.data||!i.data.success)throw new Error(i.data?.message||"Failed to load audit finding incidents");t.value=i.data.data||[],o.value=i.data.summary||{}}catch(e){console.error("Error fetching audit finding incidents:",e),a.value=e.message||"Failed to load audit finding incidents. Please try again."}finally{i.value=!1}},I=()=>{R()},D=e=>{g.value=e,I()},P=e=>e&&"Open"!==e?"Assigned"===e?"row-assigned":"Closed"===e?"row-closed":"Rejected"===e?"row-rejected":"Scheduled"===e?"row-escalated":"":"row-open",_=e=>e&&"Open"!==e?"Assigned"===e?"status-assigned":"Closed"===e?"status-closed":"Rejected"===e?"status-rejected":"Scheduled"===e?"status-escalated":"":"status-open",A=t=>{e.push(`/incident/audit-finding-details/${t.IncidentId}`)},S=e=>{r.value=e,n.value="solve",l.value=!0},T=e=>{r.value=e,n.value="reject",l.value=!0},x=e=>{r.value=e,c.value=!0,d.value="",u.value="",p.value="",k.value="",h.value="",B(),console.log("Selected incident:",e),console.log("Incident Mitigation field:",e.Mitigation),X(e)},F=()=>{l.value=!1,r.value=null,d.value="",u.value="",p.value=""},V=()=>{c.value=!1,r.value=null,d.value="",u.value="",p.value="",v.value=[],k.value="",h.value=""},U=()=>{if(!k.value.trim())return;const e=k.value.split(/[,\n]/).filter(e=>e.trim());e.forEach(e=>{v.value.push({description:e.trim(),status:"Not Started"})}),k.value=""},N=e=>{v.value.splice(e,1)},M=()=>{const e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${a}`},X=e=>{if(v.value=[],e.Mitigation)try{let i=e.Mitigation;if("string"===typeof i&&(i.trim().startsWith("{")||i.trim().startsWith("[")))try{i=JSON.parse(i)}catch(t){console.log("Mitigation data is not JSON, treating as plain text")}if("string"===typeof i){const e=i.split(/[,\n]/).filter(e=>e.trim());v.value=e.map(e=>({description:e.trim(),status:"Not Started"}))}else Array.isArray(i)?v.value=i.map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})):"object"===typeof i&&(v.value=Object.values(i).map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})));console.log("Loaded existing mitigation steps:",v.value)}catch(a){console.error("Error parsing mitigation data:",a),v.value=[{description:e.Mitigation,status:"Not Started"}]}0===v.value.length&&console.log("No existing mitigation steps found")},$=()=>{if(!d.value||!u.value)return void Ck.OQ.error("Please select both assigner and reviewer");if(d.value===u.value)return void Ck.OQ.error("Assigner and reviewer cannot be the same person");if(0===v.value.length)return void Ck.OQ.error("Please add at least one mitigation step");if(!h.value)return void Ck.OQ.error("Please select a due date");console.log("Assigning incident:",r.value.IncidentId);const t=m.value.find(e=>e.id===d.value),i=m.value.find(e=>e.id===u.value),a={};v.value.forEach((e,t)=>{a[t+1]=e.description}),He.A.put(`http://localhost:8000/api/incidents/${r.value.IncidentId}/assign/`,{status:"In Progress",assigner_id:d.value,assigner_name:t.name,reviewer_id:u.value,reviewer_name:i.name,assignment_notes:p.value,assigned_date:(new Date).toISOString(),mitigations:a,due_date:h.value}).then(t=>{console.log("Incident assigned successfully - API response:",t.data),Ck.OQ.success(`Incident ${r.value.IncidentId} assigned successfully with mitigation steps!`),R(),V(),setTimeout(()=>{e.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error assigning incident:",e),Ck.OQ.error("Failed to assign incident. Please try again.")})},O=t=>{console.log("Escalating incident to risk:",t.IncidentId),He.A.put(`http://localhost:8000/api/incidents/${t.IncidentId}/status/`,{status:"Scheduled"}).then(i=>{console.log("Incident escalated to risk - API response:",i.data),Ck.OQ.success(`Incident #${t.IncidentId} escalated to Risk successfully!`),R(),F(),setTimeout(()=>{e.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating incident status:",e),Ck.OQ.error("Failed to escalate incident. Please try again.")})},j=()=>{console.log("Rejecting incident:",r.value.IncidentId),He.A.put(`http://localhost:8000/api/incidents/${r.value.IncidentId}/status/`,{status:"Rejected",rejection_source:"INCIDENT"}).then(t=>{console.log("Incident rejected - API response:",t.data),Ck.OQ.success(`Incident ${r.value.IncidentId} rejected successfully!`),R(),F(),setTimeout(()=>{e.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating incident status:",e),Ck.OQ.error("Failed to reject incident. Please try again.")})},B=async()=>{try{const e=await He.A.get("http://localhost:8000/api/users/");m.value=e.data.map(e=>({id:e.UserId,name:e.UserName,role:e.role})),console.log("Fetched users:",m.value)}catch(e){console.error("Failed to fetch users:",e),m.value=[]}},W=e=>{if(!e)return"N/A";const t=new Date(e);return t.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},q=(e,t)=>e?e.length>t?e.substring(0,t)+"...":e:"N/A",Q=async()=>{b.value=!0;const e=t.value;try{const t=await He.A.post("http://localhost:8000/api/audit-findings/export/",{file_format:f.value,data:JSON.stringify(e),user_id:"audit_user",options:JSON.stringify({filters:{filterStatus:g.value,sortBy:y.value}})});if(console.log("Export successful:",t.data),t.data&&t.data.file_url){const e=document.createElement("a");e.href=t.data.file_url,e.setAttribute("download",t.data.file_name||`audit_findings.${f.value}`),document.body.appendChild(e),e.click(),document.body.removeChild(e),Ck.OQ.success("Export completed successfully")}}catch(i){console.error("Export failed:",i),Ck.OQ.error("Export failed. Please try again.")}finally{b.value=!1}},K=e=>{C.value!==e?C.value=e:C.value=null},J=()=>{C.value=null},z=e=>{e.target.closest(".actions-dropdown")||J()},H=(e,t)=>{switch(J(),e){case"view":A(t);break;case"assign":x(t);break;case"escalate":Ck.OQ.confirm(`Are you sure you want to escalate Incident #${t.IncidentId} to Risk? This will forward the incident to the Risk module for further evaluation and mitigation.`,"Escalate to Risk",()=>O(t));break;case"close":Ck.OQ.confirm(`Are you sure you want to close Incident #${t.IncidentId}? This action cannot be undone.`,"Close Incident",()=>Y(t));break}},G=e=>{r.value=e,n.value="close",l.value=!0},Y=e=>{He.A.put(`http://localhost:8000/api/incidents/${e.IncidentId}/status/`,{status:"Closed",close_source:"INCIDENT"}).then(()=>{Ck.OQ.success(`Incident #${e.IncidentId} closed successfully!`,"Incident Closed"),R(),setTimeout(()=>{},1500)}).catch(()=>{Ck.OQ.error("Failed to close incident. Please try again.")})};return(0,s.sV)(()=>{R(),B(),document.addEventListener("click",z)}),(0,s.hi)(()=>{document.removeEventListener("click",z)}),{findings:t,loading:i,error:a,summary:o,statusFilterConfig:w,sortByConfig:E,showModal:l,modalAction:n,selectedIncident:r,showAssignmentWorkflow:c,selectedAssigner:d,selectedReviewer:u,assignmentNotes:p,availableUsers:m,mitigationSteps:v,newMitigationStep:k,mitigationDueDate:h,filterStatus:g,sortBy:y,exportFormat:f,isExporting:b,dropdownOpenFor:C,searchQuery:L,fetchData:R,fetchUsers:B,applyFilters:I,filterByStatus:D,getRowClass:P,getStatusClass:_,viewDetails:A,toggleActionDropdown:K,closeAllDropdowns:J,handleDropdownAction:H,openSolveModal:S,openRejectModal:T,openAssignModal:x,closeModal:F,closeAssignmentWorkflow:V,addMitigationStep:U,removeMitigationStep:N,getTodayDate:M,loadExistingMitigations:X,confirmAssignmentWorkflow:$,confirmSolve:O,confirmReject:j,openCloseModal:G,confirmClose:Y,formatDate:W,truncateText:q,exportAuditFindings:Q}}};const NG=(0,le.A)(UG,[["render",FG],["__scopeId","data-v-8942ca0a"]]);var MG=NG;const XG={class:"risk-view-container"},$G={class:"risk-view-header"},OG={key:0,class:"risk-view-no-data"},jG={key:1,class:"risk-view-no-data"},BG={key:2,class:"risk-view-details-card"},WG={class:"risk-view-details-top"},qG={class:"risk-view-id-section"},QG={class:"risk-view-id-value"},KG={class:"risk-view-meta"},JG={class:"risk-view-category"},zG={class:"risk-view-title-section"},HG={class:"risk-view-compliance-section"},GG={class:"risk-view-compliance-value"},YG={class:"risk-view-content"},ZG={class:"risk-view-content-row"},eY={class:"risk-view-content-column"},tY={class:"risk-view-section-content"},iY={class:"risk-view-content-column"},aY={class:"risk-view-section-content"},sY={class:"risk-view-content-row"},oY={class:"risk-view-content-column"},lY={class:"risk-view-section-content"},nY={class:"risk-view-content-column"},rY={class:"risk-view-section-content"},cY={class:"risk-view-content-row"},dY={class:"risk-view-content-column"},uY={class:"risk-view-section-content"},pY={class:"risk-view-content-column"},mY={class:"risk-view-section-content"},vY={class:"risk-view-content-row"},kY={class:"risk-view-content-column"},hY={class:"risk-view-section-content"},gY={class:"risk-view-content-column"},yY={class:"risk-view-section-content"},fY={class:"risk-view-content-row"},bY={class:"risk-view-content-column"},CY={class:"risk-view-section-content"},LY={class:"risk-view-content-column"},wY={class:"risk-view-section-content"},EY={key:0,class:"risk-view-actions"};function RY(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",XG,[(0,s.bF)(n),(0,s.Lk)("div",$G,[t[4]||(t[4]=(0,s.Lk)("h2",{class:"risk-view-title"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle risk-view-icon"}),(0,s.eW)(" Audit Finding Details")],-1)),(0,s.Lk)("button",{class:"risk-view-back-button",onClick:t[0]||(t[0]=(...e)=>l.goBack&&l.goBack(...e))},t[3]||(t[3]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Audit Findings ")]))]),o.loading?((0,s.uX)(),(0,s.CE)("div",OG," Loading audit finding details... ")):o.error?((0,s.uX)(),(0,s.CE)("div",jG,(0,d.v_)(o.error),1)):o.auditFinding?((0,s.uX)(),(0,s.CE)("div",BG,[(0,s.Lk)("div",WG,[(0,s.Lk)("div",qG,[t[5]||(t[5]=(0,s.Lk)("span",{class:"risk-view-id-label"},"Audit Finding ID:",-1)),(0,s.Lk)("span",QG,(0,d.v_)(o.auditFinding.IncidentId),1)]),(0,s.Lk)("div",KG,[(0,s.Lk)("div",JG,(0,d.v_)(o.auditFinding.RiskCategory||"N/A"),1),(0,s.Lk)("div",{class:(0,d.C4)(["risk-view-criticality",l.getCriticalityClass(o.auditFinding.Criticality)])},(0,d.v_)(o.auditFinding.Criticality||"N/A"),3)])]),(0,s.Lk)("div",zG,[(0,s.Lk)("h3",null,(0,d.v_)(o.auditFinding.IncidentTitle),1),(0,s.Lk)("div",HG,[t[6]||(t[6]=(0,s.Lk)("span",{class:"risk-view-compliance-label"},"Compliance ID:",-1)),(0,s.Lk)("span",GG,(0,d.v_)(o.auditFinding.ComplianceId||"N/A"),1)])]),(0,s.Lk)("div",YG,[(0,s.Lk)("div",ZG,[(0,s.Lk)("div",eY,[t[7]||(t[7]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Description:",-1)),(0,s.Lk)("div",tY,(0,d.v_)(o.auditFinding.Description||"N/A"),1)]),(0,s.Lk)("div",iY,[t[8]||(t[8]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Business Impact:",-1)),(0,s.Lk)("div",aY,(0,d.v_)(o.auditFinding.InitialImpactAssessment||"N/A"),1)])]),(0,s.Lk)("div",sY,[(0,s.Lk)("div",oY,[t[9]||(t[9]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Possible Damage:",-1)),(0,s.Lk)("div",lY,(0,d.v_)(o.auditFinding.PossibleDamage||"N/A"),1)]),(0,s.Lk)("div",nY,[t[10]||(t[10]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Status:",-1)),(0,s.Lk)("div",rY,(0,d.v_)(o.auditFinding.Status||"N/A"),1)])]),(0,s.Lk)("div",cY,[(0,s.Lk)("div",dY,[t[11]||(t[11]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Systems/Assets Involved:",-1)),(0,s.Lk)("div",uY,(0,d.v_)(o.auditFinding.SystemsAssetsInvolved||"N/A"),1)]),(0,s.Lk)("div",pY,[t[12]||(t[12]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Geographic Location:",-1)),(0,s.Lk)("div",mY,(0,d.v_)(o.auditFinding.GeographicLocation||"N/A"),1)])]),(0,s.Lk)("div",vY,[(0,s.Lk)("div",kY,[t[13]||(t[13]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Mitigation Plan:",-1)),(0,s.Lk)("div",hY,(0,d.v_)(o.auditFinding.Mitigation||"N/A"),1)]),(0,s.Lk)("div",gY,[t[14]||(t[14]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Comments:",-1)),(0,s.Lk)("div",yY,(0,d.v_)(o.auditFinding.Comments||"N/A"),1)])]),(0,s.Lk)("div",fY,[(0,s.Lk)("div",bY,[t[15]||(t[15]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Created At:",-1)),(0,s.Lk)("div",CY,(0,d.v_)(l.formatDate(o.auditFinding.Date)),1)]),(0,s.Lk)("div",LY,[t[16]||(t[16]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Time:",-1)),(0,s.Lk)("div",wY,(0,d.v_)(o.auditFinding.Time||"N/A"),1)])])]),"Open"===o.auditFinding.Status?((0,s.uX)(),(0,s.CE)("div",EY,[(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>l.openSolveModal&&l.openSolveModal(...e)),class:"risk-view-action-button risk-view-escalate"},t[17]||(t[17]=[(0,s.Lk)("i",{class:"fas fa-arrow-up"},null,-1),(0,s.eW)(" ESCALATE TO RISK ")])),(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>l.openRejectModal&&l.openRejectModal(...e)),class:"risk-view-action-button risk-view-reject"},t[18]||(t[18]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" REJECT AUDIT FINDING ")]))])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])}var IY={name:"AuditFindingDetails",components:{PopupModal:Ck.wA},data(){return{auditFinding:null,loading:!0,error:null}},async created(){await this.fetchAuditFindingDetails()},methods:{async fetchAuditFindingDetails(){try{this.loading=!0,this.error=null;const e=this.$route.params.id,t=await He.A.get(`http://localhost:8000/api/audit-findings/incident/${e}/`);if(!t.data.success)throw new Error(t.data.message||"Failed to fetch audit finding details");this.auditFinding=t.data.data}catch(e){console.error("Failed to fetch audit finding details:",e),this.error="Failed to load audit finding details. Please try again."}finally{this.loading=!1}},getCriticalityClass(e){return e?(e=e.toLowerCase(),"critical"===e?"risk-view-priority-critical":"high"===e?"risk-view-priority-high":"medium"===e?"risk-view-priority-medium":"low"===e?"risk-view-priority-low":""):""},formatDate(e){if(!e)return"N/A";const[t,i,a]=e.split("-");return`${i}/${a}/${t}`},goBack(){this.$router.push("/incident/audit-findings")},openSolveModal(){Ck.OQ.confirm("This audit finding will be forwarded to the Risk module. Do you want to proceed?","Forward to Risk",()=>this.confirmSolve(),()=>{})},openRejectModal(){Ck.OQ.confirm("Are you sure you want to reject this audit finding?","Reject Audit Finding",()=>this.confirmReject(),()=>{})},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},confirmSolve(){He.A.put(`http://localhost:8000/api/incidents/${this.auditFinding.IncidentId}/status/`,{status:"Scheduled"}).then(()=>{this.auditFinding.Status="Scheduled",Ck.OQ.success(`Incident ${this.auditFinding.IncidentId} escalated to Risk successfully!`),this.sendPushNotification({title:"Audit Finding Escalated to Risk",message:`Audit finding "${this.auditFinding.IncidentTitle||"Untitled Finding"}" (ID: ${this.auditFinding.IncidentId}) has been successfully escalated to the Risk module.`,category:"audit_finding",priority:"high",user_id:"default_user"}),setTimeout(()=>{this.$router.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating audit finding status:",e),Ck.OQ.error("Failed to escalate audit finding. Please try again."),this.sendPushNotification({title:"Audit Finding Escalation Failed",message:`Failed to escalate audit finding "${this.auditFinding.IncidentTitle||"Untitled Finding"}" (ID: ${this.auditFinding.IncidentId}) to Risk module.`,category:"audit_finding",priority:"high",user_id:"default_user"})})},confirmReject(){He.A.put(`http://localhost:8000/api/incidents/${this.auditFinding.IncidentId}/status/`,{status:"Rejected"}).then(()=>{this.auditFinding.Status="Rejected",Ck.OQ.success(`Incident ${this.auditFinding.IncidentId} rejected successfully!`),this.sendPushNotification({title:"Audit Finding Rejected",message:`Audit finding "${this.auditFinding.IncidentTitle||"Untitled Finding"}" (ID: ${this.auditFinding.IncidentId}) has been rejected successfully.`,category:"audit_finding",priority:"medium",user_id:"default_user"}),setTimeout(()=>{this.$router.push("/incident/incident")},2e3)}).catch(e=>{console.error("Error updating audit finding status:",e),Ck.OQ.error("Failed to reject audit finding. Please try again."),this.sendPushNotification({title:"Audit Finding Rejection Failed",message:`Failed to reject audit finding "${this.auditFinding.IncidentTitle||"Untitled Finding"}" (ID: ${this.auditFinding.IncidentId}).`,category:"audit_finding",priority:"high",user_id:"default_user"})})}}};const DY=(0,le.A)(IY,[["render",RY],["__scopeId","data-v-34d281a0"]]);var PY=DY;const _Y={class:"workflow-container incident-workflow-container user-tasks-container"},AY={key:0},SY={class:"user-filter"},TY={class:"tabs",style:{border:"3px solid blue",width:"100%",display:"flex !important"}},xY={key:0,class:"loading"},FY={key:1,class:"error-message"},VY={key:2},UY={key:0,class:"no-data"},NY={key:1,class:"no-data"},MY={key:2},XY={class:"debug-section",style:{"margin-bottom":"15px"}},$Y={key:3,class:"reviewer-tasks-section"},OY={key:0,class:"no-data"},jY={key:1,class:"no-data"},BY={key:2},WY={key:1,class:"workflow-fullscreen",style:{display:"block !important","z-index":"1001 !important"}},qY={class:"back-to-tasks"},QY={key:0,class:"rejection-banner"},KY={key:1,class:"loading"},JY={key:2,class:"no-data"},zY={key:3,class:"simplified-workflow"},HY={class:"timeline"},GY={class:"step-circle"},YY={key:0},ZY={key:1},eZ={class:"step-box"},tZ={key:0,class:"approval-indicator approved"},iZ={key:1,class:"approval-indicator rejected"},aZ={key:0,class:"rejection-remarks"},sZ={key:2,class:"approval-indicator pending"},oZ={key:3,class:"submission-date user-date"},lZ={key:4,class:"submission-date reviewer-date"},nZ={key:5,class:"step-inputs"},rZ={key:0,class:"previous-comments-display"},cZ={class:"previous-comments-content"},dZ={class:"input-group"},uZ={for:"comments"},pZ=["onUpdate:modelValue","placeholder"],mZ={class:"file-upload"},vZ={class:"upload-btn"},kZ=["onChange"],hZ={key:0,class:"file-uploading"},gZ={key:1,class:"file-name"},yZ={class:"status-control"},fZ=["onClick"],bZ={key:6,class:"step-readonly"},CZ={key:0,class:"comments-display"},LZ={key:1,class:"file-display"},wZ=["href","download"],EZ={key:0,class:"assessment-rejection-notice"},RZ={class:"assessment-rejection-feedback"},IZ={key:1,class:"completion-notice"},DZ={key:2,class:"questionnaire-section"},PZ={class:"questionnaire-form"},_Z={class:"question-group"},AZ={class:"input-with-prefix"},SZ={class:"question-group"},TZ={class:"question-group"},xZ={class:"question-group"},FZ={class:"question-group"},VZ={class:"question-group"},UZ={class:"input-with-prefix"},NZ={class:"question-group"},MZ={class:"input-with-suffix"},XZ={class:"question-group"},$Z={class:"input-with-suffix"},OZ={class:"question-group"},jZ={class:"question-group"},BZ={class:"questionnaire-actions"},WZ=["disabled"],qZ={key:2,class:"reviewer-workflow-fullscreen"},QZ={class:"back-to-tasks"},KZ={key:0,class:"loading"},JZ={key:1},zZ={class:"incident-summary"},HZ={key:0,class:"questionnaire-review-section"},GZ={class:"questionnaire-review-grid"},YZ={key:0,class:"questionnaire-item"},ZZ={key:1,class:"questionnaire-item"},e0={key:2,class:"questionnaire-item"},t0={key:3,class:"questionnaire-item"},i0={key:4,class:"questionnaire-item"},a0={key:5,class:"questionnaire-item"},s0={key:6,class:"questionnaire-item"},o0={key:7,class:"questionnaire-item"},l0={key:8,class:"questionnaire-item"},n0={key:9,class:"questionnaire-item"},r0={key:10,class:"questionnaire-item"},c0={key:0,class:"assessment-approval-section"},d0={class:"assessment-controls"},u0={key:0,class:"assessment-feedback-section"},p0={key:1,class:"assessment-status-display"},m0={key:0,class:"assessment-feedback-display"},v0={key:0,class:"status-message"},k0={key:1,class:"status-message"},h0={class:"mitigation-review-list"},g0=["data-id"],y0={class:"mitigation-heading"},f0={class:"mitigation-split-content"},b0={class:"mitigation-previous"},C0={key:0,class:"mitigation-content"},L0={key:0,class:"comments-section"},w0={class:"comments-text"},E0={key:1,class:"evidence-section"},R0=["href","filename"],I0={key:1,class:"mitigation-empty"},D0={class:"mitigation-current"},P0={class:"mitigation-content"},_0={key:0,class:"comments-section"},A0={class:"comments-text"},S0={key:1,class:"evidence-section"},T0=["href","filename"],x0={class:"approval-controls"},F0={key:0,class:"approval-buttons"},V0=["onClick"],U0=["onClick"],N0={key:1,class:"remarks-field"},M0=["onUpdate:modelValue"],X0=["onClick"],$0=["onClick"],O0={key:2,class:"approved-readonly"},j0={key:0,class:"approved-actions"},B0=["onClick"],W0={key:3,class:"reviewer-remarks-display"},q0={class:"review-actions"},Q0=["disabled"],K0=["disabled"],J0={key:0,class:"review-complete-notice"},z0={key:1,class:"review-warning"};function H0(e,t,i,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("CollapsibleTable"),u=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",_Y,[l.showMitigationWorkflow||l.showReviewerWorkflow?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",AY,[t[32]||(t[32]=(0,s.Lk)("div",{class:"incident-form-page-header"},[(0,s.Lk)("h1",{class:"incident-form-page-title"},"User Task Management")],-1)),(0,s.Lk)("div",SY,[(0,s.bF)(r,{modelValue:l.selectedUserId,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedUserId=e),config:l.userFilterConfig,onChange:n.fetchData},null,8,["modelValue","config","onChange"])]),(0,s.Lk)("div",TY,[(0,s.Lk)("div",{class:(0,d.C4)(["tab",{active:"user"===l.activeTab}]),onClick:t[1]||(t[1]=e=>l.activeTab="user"),style:{border:"2px solid green",display:"block !important",flex:"1"}}," My Tasks ("+(0,d.v_)(l.userIncidents.length)+") ",3),(0,s.Lk)("div",{class:(0,d.C4)(["tab",{active:"reviewer"===l.activeTab}]),onClick:t[2]||(t[2]=(...e)=>n.switchToReviewerTab&&n.switchToReviewerTab(...e)),style:{border:"2px solid orange",display:"block !important",flex:"1"}}," Reviewer Tasks ("+(0,d.v_)(l.reviewerTasks.length)+") ",3)]),l.loading?((0,s.uX)(),(0,s.CE)("div",xY," Loading data... ")):l.error?((0,s.uX)(),(0,s.CE)("div",FY,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),"user"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",VY,[l.selectedUserId?0===l.userIncidents.length?((0,s.uX)(),(0,s.CE)("div",NY,t[29]||(t[29]=[(0,s.Lk)("p",null,"No tasks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",MY,[(0,s.Lk)("div",XY,[(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.testEndpoints&&n.testEndpoints(...e)),class:"debug-btn",style:{background:"#333",color:"white",padding:"5px 10px","border-radius":"4px"}}," Test API Endpoints ")]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.userTaskSections,e=>((0,s.uX)(),(0,s.Wv)(c,{key:e.name,"section-config":e,"table-headers":n.userTaskTableHeaders,"is-expanded":l.expandedSections[e.statusKey],onToggle:t=>n.toggleSection(e.statusKey),onTaskClick:n.handleUserTaskClick},null,8,["section-config","table-headers","is-expanded","onToggle","onTaskClick"]))),128))])):((0,s.uX)(),(0,s.CE)("div",UY,t[28]||(t[28]=[(0,s.Lk)("p",null,"Please select a user to view their assigned tasks.",-1)])))])):(0,s.Q3)("",!0),"reviewer"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",$Y,[l.selectedUserId?0===l.reviewerTasks.length?((0,s.uX)(),(0,s.CE)("div",jY,t[31]||(t[31]=[(0,s.Lk)("p",null,"No review tasks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",BY,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.reviewerTaskSections,e=>((0,s.uX)(),(0,s.Wv)(c,{key:e.name,"section-config":e,"table-headers":n.reviewerTaskTableHeaders,"is-expanded":l.expandedSections[e.statusKey],onToggle:t=>n.toggleSection(e.statusKey),onTaskClick:n.handleReviewerTaskClick},null,8,["section-config","table-headers","is-expanded","onToggle","onTaskClick"]))),128))])):((0,s.uX)(),(0,s.CE)("div",OY,t[30]||(t[30]=[(0,s.Lk)("p",null,"Please select a user to view their reviewer tasks.",-1)])))])):(0,s.Q3)("",!0)])),l.showMitigationWorkflow?((0,s.uX)(),(0,s.CE)("div",WY,[(0,s.Lk)("div",qY,[(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>n.closeMitigationModal&&n.closeMitigationModal(...e)),class:"back-btn",title:"Back to tasks"},t[33]||(t[33]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),(0,s.Lk)("h1",null,(0,d.v_)(n.isAuditFinding?"Audit Finding":"Incident")+" Mitigation Workflow",1),n.isIncidentRejected?((0,s.uX)(),(0,s.CE)("div",QY,t[34]||(t[34]=[(0,s.Lk)("div",{class:"rejection-banner-content"},[(0,s.Lk)("div",{class:"rejection-banner-icon"},"⚠️"),(0,s.Lk)("div",{class:"rejection-banner-text"},[(0,s.Lk)("h3",null,"This incident has been rejected and requires resubmission"),(0,s.Lk)("p",null,"The reviewer has rejected your submission. Please review the feedback below, update the required information, and resubmit for review.")])],-1)]))):(0,s.Q3)("",!0),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",KY,t[35]||(t[35]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation steps...",-1)]))):l.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",zY,[(0,s.Lk)("div",HY,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:(0,d.C4)(["timeline-step",{completed:"Completed"===e.status,active:n.isStepActive(i),locked:n.isStepLocked(i),approved:!0===e.approved,rejected:!1===e.approved}]),style:(0,d.Tr)({"--step-index":i})},[(0,s.Lk)("div",GY,["Completed"===e.status?((0,s.uX)(),(0,s.CE)("span",YY,t[36]||(t[36]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]))):((0,s.uX)(),(0,s.CE)("span",ZY,(0,d.v_)(i+1),1))]),(0,s.Lk)("div",eZ,[(0,s.Lk)("h3",null,(0,d.v_)(e.description),1),!0===e.approved?((0,s.uX)(),(0,s.CE)("div",tZ,t[37]||(t[37]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" This step has been approved by the reviewer ")]))):(0,s.Q3)("",!0),!1===e.approved?((0,s.uX)(),(0,s.CE)("div",iZ,[t[39]||(t[39]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),t[40]||(t[40]=(0,s.eW)(" This step was rejected by the reviewer and needs to be updated ")),e.remarks?((0,s.uX)(),(0,s.CE)("div",aZ,[t[38]||(t[38]=(0,s.Lk)("strong",null,"Reviewer Feedback:",-1)),(0,s.eW)(" "+(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),null===e.approved&&"Completed"===e.status?((0,s.uX)(),(0,s.CE)("div",sZ,t[41]||(t[41]=[(0,s.Lk)("i",{class:"fas fa-clock"},null,-1),(0,s.eW)(" This step is completed and awaiting reviewer approval ")]))):(0,s.Q3)("",!0),e.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",oZ,[t[42]||(t[42]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(e.user_submitted_date)),1)])):(0,s.Q3)("",!0),e.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",lZ,[t[43]||(t[43]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(e.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0),!1===e.approved||null===e.approved?((0,s.uX)(),(0,s.CE)("div",nZ,[e.previousComments&&e.previousComments.trim()?((0,s.uX)(),(0,s.CE)("div",rZ,[t[44]||(t[44]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-history"}),(0,s.eW)(" Previous Comments")],-1)),(0,s.Lk)("div",cZ,(0,d.v_)(e.previousComments),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",dZ,[(0,s.Lk)("label",uZ,(0,d.v_)(e.previousComments&&e.previousComments.trim()?"Add New Comments:":"Comments:"),1),(0,s.bo)((0,s.Lk)("textarea",{id:"comments","onUpdate:modelValue":t=>e.comments=t,placeholder:e.previousComments&&e.previousComments.trim()?"Add additional comments about this mitigation step...":"Add your comments about this mitigation step...",rows:"3"},null,8,pZ),[[a.Jo,e.comments]])]),(0,s.Lk)("div",mZ,[(0,s.Lk)("label",vZ,[t[45]||(t[45]=(0,s.Lk)("i",{class:"fas fa-upload"},null,-1)),t[46]||(t[46]=(0,s.eW)(" Upload Evidence ")),(0,s.Lk)("input",{type:"file",onChange:e=>n.handleFileUpload(e,i),accept:".pdf,.doc,.docx,.jpg,.png"},null,40,kZ)]),e.uploading?((0,s.uX)(),(0,s.CE)("div",hZ,t[47]||(t[47]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Uploading... ")]))):e.fileName?((0,s.uX)(),(0,s.CE)("div",gZ,[t[48]||(t[48]=(0,s.Lk)("i",{class:"fas fa-file"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",yZ,[(0,s.Lk)("button",{onClick:e=>n.updateStepStatus(i,"Completed"),class:(0,d.C4)(["complete-btn",{active:"Completed"===e.status}])},t[49]||(t[49]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Mark as Complete ")]),10,fZ)])])):((0,s.uX)(),(0,s.CE)("div",bZ,[e.previousComments||e.comments?((0,s.uX)(),(0,s.CE)("div",CZ,[t[50]||(t[50]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-comment"}),(0,s.eW)(" Comments")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.previousComments||e.comments),1)])):(0,s.Q3)("",!0),e.fileName?((0,s.uX)(),(0,s.CE)("div",LZ,[t[52]||(t[52]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-file"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:e["aws-file_link"],download:e.fileName,target:"_blank"},[t[51]||(t[51]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)],8,wZ)])):(0,s.Q3)("",!0),t[53]||(t[53]=(0,s.Lk)("div",{class:"approved-status-display"},[(0,s.Lk)("i",{class:"fas fa-lock"}),(0,s.eW)(" This mitigation has been approved and is locked for editing ")],-1))]))])],6))),128))]),l.assessmentFeedbackForUser&&!l.assessmentFeedbackForUser.approved?((0,s.uX)(),(0,s.CE)("div",EZ,[t[55]||(t[55]=(0,s.Lk)("h3",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Assessment Requires Revision")],-1)),t[56]||(t[56]=(0,s.Lk)("p",null,"The reviewer has rejected your assessment and provided the following feedback:",-1)),(0,s.Lk)("div",RZ,[t[54]||(t[54]=(0,s.Lk)("strong",null,"Reviewer's Feedback:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.assessmentFeedbackForUser.remarks),1)]),t[57]||(t[57]=(0,s.Lk)("p",null,"Please review the feedback and update your assessment by completing the questionnaire again.",-1))])):(0,s.Q3)("",!0),n.allStepsCompleted&&!l.showQuestionnaire?((0,s.uX)(),(0,s.CE)("div",IZ,[t[59]||(t[59]=(0,s.Lk)("h3",null,"All Mitigation Steps Completed!",-1)),t[60]||(t[60]=(0,s.Lk)("p",null,"Please complete the incident assessment questionnaire to finalize your submission.",-1)),(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>l.showQuestionnaire=!0),class:"show-questionnaire-btn"},t[58]||(t[58]=[(0,s.Lk)("i",{class:"fas fa-clipboard-list"},null,-1),(0,s.eW)(" Complete Assessment ")]))])):(0,s.Q3)("",!0),l.showQuestionnaire?((0,s.uX)(),(0,s.CE)("div",DZ,[t[93]||(t[93]=(0,s.Lk)("h3",null,"Incident Assessment Questionnaire",-1)),(0,s.Lk)("div",PZ,[(0,s.Lk)("div",_Z,[t[62]||(t[62]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"1"),(0,s.eW)(" What is the total cost for implementing this mitigation? (Optional) ")],-1)),(0,s.Lk)("div",AZ,[t[61]||(t[61]=(0,s.Lk)("span",{class:"currency-prefix"},"$",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=e=>l.questionnaireData.cost=e),placeholder:"Enter amount (e.g., 5000.50) - Include all direct and indirect costs for implementation",class:"question-input currency-input",min:"0",step:"0.01",onInput:t[7]||(t[7]=e=>n.validateCurrencyInput("cost",e))},null,544),[[a.Jo,l.questionnaireData.cost]])]),t[63]||(t[63]=(0,s.Lk)("small",{class:"field-hint"},"Include labor, materials, technology, and any third-party costs",-1))]),(0,s.Lk)("div",SZ,[t[65]||(t[65]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"2"),(0,s.eW)(" What is the overall impact level of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.questionnaireData.impact=e),class:"question-select"},t[64]||(t[64]=[(0,s.Fv)('<option value="" data-v-1776eed5>Select impact level...</option><option value="Very Low" data-v-1776eed5>Very Low - Minimal disruption, easily contained</option><option value="Low" data-v-1776eed5>Low - Minor disruption, limited scope</option><option value="Medium" data-v-1776eed5>Medium - Moderate disruption, manageable impact</option><option value="High" data-v-1776eed5>High - Significant disruption, widespread impact</option><option value="Very High" data-v-1776eed5>Very High - Severe disruption, critical impact</option>',6)]),512),[[a.u1,l.questionnaireData.impact]]),t[66]||(t[66]=(0,s.Lk)("small",{class:"field-hint"},"Consider operational, business, and stakeholder impact",-1))]),(0,s.Lk)("div",TZ,[t[68]||(t[68]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"3"),(0,s.eW)(" What is the financial impact scale of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.questionnaireData.financialImpact=e),class:"question-select"},t[67]||(t[67]=[(0,s.Fv)('<option value="" data-v-1776eed5>Select financial impact level...</option><option value="Very Low" data-v-1776eed5>Very Low - Under $1,000 in losses/costs</option><option value="Low" data-v-1776eed5>Low - $1,000 - $10,000 in losses/costs</option><option value="Medium" data-v-1776eed5>Medium - $10,000 - $100,000 in losses/costs</option><option value="High" data-v-1776eed5>High - $100,000 - $1,000,000 in losses/costs</option><option value="Very High" data-v-1776eed5>Very High - Over $1,000,000 in losses/costs</option>',6)]),512),[[a.u1,l.questionnaireData.financialImpact]]),t[69]||(t[69]=(0,s.Lk)("small",{class:"field-hint"},"Include direct losses, opportunity costs, and recovery expenses",-1))]),(0,s.Lk)("div",xZ,[t[71]||(t[71]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"4"),(0,s.eW)(" What is the reputational impact scale of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>l.questionnaireData.reputationalImpact=e),class:"question-select"},t[70]||(t[70]=[(0,s.Fv)('<option value="" data-v-1776eed5>Select reputational impact level...</option><option value="Very Low" data-v-1776eed5>Very Low - Minimal or no reputational damage</option><option value="Low" data-v-1776eed5>Low - Minor reputational concerns, limited visibility</option><option value="Medium" data-v-1776eed5>Medium - Moderate reputational impact, some stakeholder concern</option><option value="High" data-v-1776eed5>High - Significant reputational damage, widespread attention</option><option value="Very High" data-v-1776eed5>Very High - Severe reputational crisis, major media coverage</option>',6)]),512),[[a.u1,l.questionnaireData.reputationalImpact]]),t[72]||(t[72]=(0,s.Lk)("small",{class:"field-hint"},"Consider impact on brand, customer trust, media coverage, and stakeholder confidence",-1))]),(0,s.Lk)("div",FZ,[t[74]||(t[74]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"5"),(0,s.eW)(" What is the operational impact scale of this incident? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.questionnaireData.operationalImpact=e),class:"question-select"},t[73]||(t[73]=[(0,s.Fv)('<option value="" data-v-1776eed5>Select operational impact level...</option><option value="Very Low" data-v-1776eed5>Very Low - Minimal disruption, normal operations maintained</option><option value="Low" data-v-1776eed5>Low - Minor disruption, limited service impact</option><option value="Medium" data-v-1776eed5>Medium - Moderate disruption, some services affected</option><option value="High" data-v-1776eed5>High - Significant disruption, major service interruption</option><option value="Very High" data-v-1776eed5>Very High - Severe disruption, critical systems down</option>',6)]),512),[[a.u1,l.questionnaireData.operationalImpact]]),t[75]||(t[75]=(0,s.Lk)("small",{class:"field-hint"},"Consider disruptions to processes, services, productivity, and normal operations",-1))]),(0,s.Lk)("div",VZ,[t[77]||(t[77]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"6"),(0,s.eW)(" What is the estimated financial loss from this incident? (Optional) ")],-1)),(0,s.Lk)("div",UZ,[t[76]||(t[76]=(0,s.Lk)("span",{class:"currency-prefix"},"$",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>l.questionnaireData.financialLoss=e),placeholder:"Enter total loss amount (e.g., 25000.00) - Include revenue loss, fines, penalties, and recovery costs",class:"question-input currency-input",min:"0",step:"0.01",onInput:t[13]||(t[13]=e=>n.validateCurrencyInput("financialLoss",e))},null,544),[[a.Jo,l.questionnaireData.financialLoss]])]),t[78]||(t[78]=(0,s.Lk)("small",{class:"field-hint"},"Include revenue loss, regulatory fines, penalties, legal costs, and recovery expenses",-1))]),(0,s.Lk)("div",NZ,[t[80]||(t[80]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"7"),(0,s.eW)(" What is the expected system downtime if this incident occurs again? (Optional) ")],-1)),(0,s.Lk)("div",MZ,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=e=>l.questionnaireData.systemDowntime=e),placeholder:"Enter hours (e.g., 8.5) - Total time systems would be unavailable",class:"question-input hours-input",min:"0",step:"0.5",onInput:t[15]||(t[15]=e=>n.validateHoursInput("systemDowntime",e))},null,544),[[a.Jo,l.questionnaireData.systemDowntime]]),t[79]||(t[79]=(0,s.Lk)("span",{class:"hours-suffix"},"hours",-1))]),t[81]||(t[81]=(0,s.Lk)("small",{class:"field-hint"},"Estimate total time systems/services would be unavailable (decimals allowed, e.g., 2.5 hours)",-1))]),(0,s.Lk)("div",XZ,[t[83]||(t[83]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"8"),(0,s.eW)(" How long did it take to recover from this incident? (Optional) ")],-1)),(0,s.Lk)("div",$Z,[(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[16]||(t[16]=e=>l.questionnaireData.recoveryTime=e),placeholder:"Enter hours (e.g., 12.0) - Time from incident detection to full recovery",class:"question-input hours-input",min:"0",step:"0.5",onInput:t[17]||(t[17]=e=>n.validateHoursInput("recoveryTime",e))},null,544),[[a.Jo,l.questionnaireData.recoveryTime]]),t[82]||(t[82]=(0,s.Lk)("span",{class:"hours-suffix"},"hours",-1))]),t[84]||(t[84]=(0,s.Lk)("small",{class:"field-hint"},"Time from incident detection to complete restoration of normal operations (decimals allowed)",-1))]),(0,s.Lk)("div",OZ,[t[86]||(t[86]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"9"),(0,s.eW)(" Is it possible that this incident will recur again? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.questionnaireData.riskRecurrence=e),class:"question-select"},t[85]||(t[85]=[(0,s.Lk)("option",{value:""},"Select likelihood...",-1),(0,s.Lk)("option",{value:"yes"},"Yes - High likelihood of recurrence",-1),(0,s.Lk)("option",{value:"maybe"},"Maybe - Possible but uncertain recurrence",-1),(0,s.Lk)("option",{value:"no"},"No - Very unlikely to recur",-1)]),512),[[a.u1,l.questionnaireData.riskRecurrence]]),t[87]||(t[87]=(0,s.Lk)("small",{class:"field-hint"},"Consider if root causes have been addressed and preventive measures are in place",-1))]),(0,s.Lk)("div",jZ,[t[89]||(t[89]=(0,s.Lk)("label",{class:"question-label"},[(0,s.Lk)("span",{class:"question-number"},"10"),(0,s.eW)(" Is this mitigation an improvement initiative that will prevent future recurrence? (Optional) ")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[19]||(t[19]=e=>l.questionnaireData.improvementInitiative=e),class:"question-select"},t[88]||(t[88]=[(0,s.Lk)("option",{value:""},"Select prevention level...",-1),(0,s.Lk)("option",{value:"yes"},"Yes - Completely prevents recurrence",-1),(0,s.Lk)("option",{value:"partially"},"Partially - Reduces likelihood of recurrence",-1),(0,s.Lk)("option",{value:"no"},"No - Does not prevent recurrence",-1)]),512),[[a.u1,l.questionnaireData.improvementInitiative]]),t[90]||(t[90]=(0,s.Lk)("small",{class:"field-hint"},"Assess whether this mitigation addresses root causes and prevents similar incidents",-1))])]),(0,s.Lk)("div",BZ,[(0,s.Lk)("button",{onClick:t[20]||(t[20]=e=>l.showQuestionnaire=!1),class:"cancel-questionnaire-btn"},t[91]||(t[91]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Cancel ")])),(0,s.Lk)("button",{onClick:t[21]||(t[21]=(...e)=>n.submitIncidentAssessment&&n.submitIncidentAssessment(...e)),class:"submit-assessment-btn",disabled:!n.isQuestionnaireValid},t[92]||(t[92]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Submit Assessment ")]),8,WZ)])])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",JY," No mitigation steps found for this incident. "))])):(0,s.Q3)("",!0),l.showReviewerWorkflow?((0,s.uX)(),(0,s.CE)("div",qZ,[(0,s.Lk)("div",QZ,[(0,s.Lk)("button",{onClick:t[22]||(t[22]=(...e)=>n.closeReviewerModal&&n.closeReviewerModal(...e)),class:"back-btn",title:"Back to tasks"},t[94]||(t[94]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),t[140]||(t[140]=(0,s.Lk)("h1",null,"Review Incident Mitigations",-1)),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",KZ,t[95]||(t[95]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",JZ,[(0,s.Lk)("div",zZ,[(0,s.Lk)("h3",null,(0,d.v_)(l.currentReviewTask?.Title||"Incident #"+l.currentReviewTask?.id),1),(0,s.Lk)("p",null,[t[96]||(t[96]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentReviewTask?.id),1)]),(0,s.Lk)("p",null,[t[97]||(t[97]=(0,s.Lk)("strong",null,"Submitted By:",-1)),(0,s.eW)(" "+(0,d.v_)(n.getUserName(l.currentReviewTask?.AssignerId)),1)])]),l.questionnaireReviewData?((0,s.uX)(),(0,s.CE)("div",HZ,[t[115]||(t[115]=(0,s.Lk)("h3",null,"Assessment Questionnaire",-1)),(0,s.Lk)("div",GZ,[l.questionnaireReviewData.cost?((0,s.uX)(),(0,s.CE)("div",YZ,[t[98]||(t[98]=(0,s.Lk)("label",null,"Cost for Mitigation:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.cost),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.impact?((0,s.uX)(),(0,s.CE)("div",ZZ,[t[99]||(t[99]=(0,s.Lk)("label",null,"Impact:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.impact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.financialImpact?((0,s.uX)(),(0,s.CE)("div",e0,[t[100]||(t[100]=(0,s.Lk)("label",null,"Financial Impact:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.financialImpact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.reputationalImpact?((0,s.uX)(),(0,s.CE)("div",t0,[t[101]||(t[101]=(0,s.Lk)("label",null,"Reputational Impact Scale:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.reputationalImpact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.operationalImpact?((0,s.uX)(),(0,s.CE)("div",i0,[t[102]||(t[102]=(0,s.Lk)("label",null,"Operational Impact Scale:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.operationalImpact),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.financialLoss?((0,s.uX)(),(0,s.CE)("div",a0,[t[103]||(t[103]=(0,s.Lk)("label",null,"Financial Loss:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.financialLoss),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.systemDowntime?((0,s.uX)(),(0,s.CE)("div",s0,[t[104]||(t[104]=(0,s.Lk)("label",null,"Expected System Downtime (hrs):",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.systemDowntime),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.recoveryTime?((0,s.uX)(),(0,s.CE)("div",o0,[t[105]||(t[105]=(0,s.Lk)("label",null,"Recovery Time (hrs):",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.recoveryTime),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.riskRecurrence?((0,s.uX)(),(0,s.CE)("div",l0,[t[106]||(t[106]=(0,s.Lk)("label",null,"Risk Recurrence Possibility:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.riskRecurrence),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.improvementInitiative?((0,s.uX)(),(0,s.CE)("div",n0,[t[107]||(t[107]=(0,s.Lk)("label",null,"Improvement Initiative:",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.questionnaireReviewData.improvementInitiative),1)])):(0,s.Q3)("",!0),l.questionnaireReviewData.submittedAt?((0,s.uX)(),(0,s.CE)("div",r0,[t[108]||(t[108]=(0,s.Lk)("label",null,"Submitted At:",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.formatDateTime(l.questionnaireReviewData.submittedAt)),1)])):(0,s.Q3)("",!0)]),l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",c0,[t[112]||(t[112]=(0,s.Lk)("h4",null,"Assessment Review",-1)),(0,s.Lk)("div",d0,[(0,s.Lk)("button",{onClick:t[23]||(t[23]=e=>n.approveAssessment(!0)),class:(0,d.C4)(["approve-assessment-btn",{active:!0===l.assessmentFeedback.approved}])},t[109]||(t[109]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Approve Assessment ")]),2),(0,s.Lk)("button",{onClick:t[24]||(t[24]=e=>n.approveAssessment(!1)),class:(0,d.C4)(["reject-assessment-btn",{active:!1===l.assessmentFeedback.approved}])},t[110]||(t[110]=[(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1),(0,s.eW)(" Reject Assessment ")]),2)]),!1===l.assessmentFeedback.approved?((0,s.uX)(),(0,s.CE)("div",u0,[t[111]||(t[111]=(0,s.Lk)("label",{for:"assessment-feedback"},"Assessment Feedback (required for rejection):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"assessment-feedback","onUpdate:modelValue":t[25]||(t[25]=e=>l.assessmentFeedback.remarks=e),class:"assessment-feedback-input",placeholder:"Provide detailed feedback about why the assessment was rejected...",rows:"4"},null,512),[[a.Jo,l.assessmentFeedback.remarks]])])):(0,s.Q3)("",!0)])),l.reviewCompleted&&void 0!==l.assessmentFeedback.approved?((0,s.uX)(),(0,s.CE)("div",p0,[t[114]||(t[114]=(0,s.Lk)("h4",null,"Assessment Status",-1)),(0,s.Lk)("div",{class:(0,d.C4)(["assessment-status",{approved:l.assessmentFeedback.approved,rejected:!l.assessmentFeedback.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",l.assessmentFeedback.approved?"fa-check-circle":"fa-times-circle"])},null,2),(0,s.eW)(" "+(0,d.v_)(l.assessmentFeedback.approved?"Assessment Approved":"Assessment Rejected"),1)],2),!l.assessmentFeedback.approved&&l.assessmentFeedback.remarks?((0,s.uX)(),(0,s.CE)("div",m0,[t[113]||(t[113]=(0,s.Lk)("strong",null,"Feedback:",-1)),(0,s.eW)(" "+(0,d.v_)(l.assessmentFeedback.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,d.C4)(["review-status-banner",{approved:l.reviewApproved,rejected:!l.reviewApproved}])},[l.reviewApproved?((0,s.uX)(),(0,s.CE)("div",v0,t[116]||(t[116]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" This incident has been approved ")]))):((0,s.uX)(),(0,s.CE)("div",k0,t[117]||(t[117]=[(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1),(0,s.eW)(" This incident was rejected and is awaiting revision ")])))],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",h0,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationReviewData,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"mitigation-review-item","data-id":i},[(0,s.Lk)("div",y0,[(0,s.Lk)("h4",null,"Mitigation #"+(0,d.v_)(i),1),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["mitigation-status-badge",{approved:!0===e.approved,rejected:!1===e.approved,pending:void 0===e.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===e.approved,"fa-times-circle":!1===e.approved,"fa-clock":void 0===e.approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending Review"),1)],2)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",f0,[(0,s.Lk)("div",b0,[t[123]||(t[123]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),n.getPreviousMitigation(i)?((0,s.uX)(),(0,s.CE)("div",C0,[t[121]||(t[121]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousMitigation(i).description||"No description available"),1),n.getPreviousMitigation(i).comments?((0,s.uX)(),(0,s.CE)("div",L0,[t[118]||(t[118]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",w0,(0,d.v_)(n.getPreviousMitigation(i).comments),1)])):(0,s.Q3)("",!0),n.getPreviousMitigation(i)["aws-file_link"]?((0,s.uX)(),(0,s.CE)("div",E0,[t[120]||(t[120]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:n.getPreviousMitigation(i)["aws-file_link"],download:"",filename:n.getPreviousMitigation(i).fileName,class:"evidence-link"},[t[119]||(t[119]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(n.getPreviousMitigation(i).fileName),1)],8,R0)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",I0,t[122]||(t[122]=[(0,s.Lk)("i",{class:"fas fa-history"},null,-1),(0,s.Lk)("p",null,"No previous version available",-1)])))]),(0,s.Lk)("div",D0,[t[128]||(t[128]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("div",P0,[t[127]||(t[127]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.description),1),e.comments?((0,s.uX)(),(0,s.CE)("div",_0,[t[124]||(t[124]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",A0,(0,d.v_)(e.comments),1)])):(0,s.Q3)("",!0),e["aws-file_link"]?((0,s.uX)(),(0,s.CE)("div",S0,[t[126]||(t[126]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:e["aws-file_link"],download:"",filename:e.fileName,class:"evidence-link"},[t[125]||(t[125]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)],8,T0)])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",x0,[!0===e.approved||!1===e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",F0,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!0),class:"approve-btn"},t[129]||(t[129]=[(0,s.Lk)("i",{class:"fas fa-check-double"},null,-1),(0,s.eW)(" Approve ")]),8,V0),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!1),class:"reject-btn"},t[130]||(t[130]=[(0,s.Lk)("i",{class:"fas fa-ban"},null,-1),(0,s.eW)(" Reject ")]),8,U0)])),!1!==e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",N0,[t[133]||(t[133]=(0,s.Lk)("label",{for:"remarks"},"Feedback (required for rejection):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"remarks","onUpdate:modelValue":t=>e.remarks=t,class:"remarks-input",placeholder:"Provide feedback explaining why this mitigation was rejected..."},null,8,M0),[[a.Jo,e.remarks]]),(0,s.Lk)("button",{onClick:e=>n.updateRemarks(i),class:"save-remarks-btn"},t[131]||(t[131]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Feedback ")]),8,X0),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!0),class:"change-decision-btn"},t[132]||(t[132]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Approve ")]),8,$0)])),!0===e.approved?((0,s.uX)(),(0,s.CE)("div",O0,[t[135]||(t[135]=(0,s.Lk)("div",{class:"readonly-notice"},[(0,s.Lk)("i",{class:"fas fa-lock"}),(0,s.eW)(" This mitigation was previously approved and is read-only ")],-1)),l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",j0,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!1),class:"change-decision-btn"},t[134]||(t[134]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Reject ")]),8,B0)]))])):(0,s.Q3)("",!0),!1===e.approved&&l.reviewCompleted&&e.remarks?((0,s.uX)(),(0,s.CE)("div",W0,[t[136]||(t[136]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-exclamation"}),(0,s.eW)(" Rejection Feedback")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])],8,g0))),128))]),(0,s.Lk)("div",q0,[(0,s.Lk)("button",{class:"submit-review-btn",disabled:!n.canSubmitReview||l.reviewCompleted,onClick:t[26]||(t[26]=e=>n.submitReview(!0))},t[137]||(t[137]=[(0,s.Lk)("i",{class:"fas fa-check-double"},null,-1),(0,s.eW)(" Approve Incident ")]),8,Q0),(0,s.Lk)("button",{class:"reject-review-btn",disabled:!n.canSubmitReview||l.reviewCompleted,onClick:t[27]||(t[27]=e=>n.submitReview(!1))},t[138]||(t[138]=[(0,s.Lk)("i",{class:"fas fa-ban"},null,-1),(0,s.eW)(" Reject Incident ")]),8,K0),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",J0," This review has been completed ")):n.canSubmitReview?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",z0,t[139]||(t[139]=[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1),(0,s.eW)(" You must approve or reject each mitigation and the assessment before submitting ")])))])]))])):(0,s.Q3)("",!0),(0,s.bF)(u)])}var G0={name:"IncidentUserTasks",components:{PopupModal:Ck.wA,CustomDropdown:xa.A,CollapsibleTable:zn},data(){return{userIncidents:[],reviewerTasks:[],users:[],selectedUserId:"",userFilterConfig:{name:"User",label:"User",defaultLabel:"All Users",values:[]},loading:!0,error:null,showMitigationWorkflow:!1,showReviewerWorkflow:!1,loadingMitigations:!1,mitigationSteps:[],selectedIncidentId:null,activeTab:"user",mitigationReviewData:{},currentReviewTask:null,reviewCompleted:!1,reviewApproved:!1,previousVersions:{},showQuestionnaire:!1,questionnaireReviewData:{},assessmentFeedback:{},assessmentFeedbackForUser:null,questionnaireData:{cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",riskRecurrence:"",improvementInitiative:""},expandedSections:{approved:!1,rejected:!1,pendingReview:!1,assigned:!1,reviewerPending:!1,reviewerApproved:!1},approvedIncidents:[],rejectedIncidents:[],pendingReviewIncidents:[],assignedIncidents:[],pendingReviewerTasks:[],approvedReviewerTasks:[]}},computed:{allStepsCompleted(){const e=this.mitigationSteps.filter(e=>!1===e.approved||null===e.approved);return e.length>0&&e.every(e=>"Completed"===e.status)},canSubmitReview(){const e=Object.values(this.mitigationReviewData).every(e=>!0===e.approved||!1===e.approved&&e.remarks&&""!==e.remarks.trim()),t=void 0!==this.assessmentFeedback.approved&&(!0===this.assessmentFeedback.approved||!1===this.assessmentFeedback.approved&&this.assessmentFeedback.remarks&&""!==this.assessmentFeedback.remarks.trim());return e&&t},hasRejectedOrNewSteps(){return this.mitigationSteps.some(e=>!1===e.approved||null===e.approved)},rejectedStepsCompleted(){const e=this.mitigationSteps.filter(e=>!1===e.approved||null===e.approved);return e.length>0&&e.every(e=>"Completed"===e.status)},isQuestionnaireValid(){return!0},isAuditFinding(){const e=this.userIncidents.find(e=>e.id===this.selectedIncidentId);return e&&"audit_finding"===e.itemType},isIncidentRejected(){const e=this.userIncidents.find(e=>e.id===this.selectedIncidentId);return e&&"Rejected"===e.Status},currentIncidentDetails(){return this.userIncidents.find(e=>e.id===this.selectedIncidentId)||{}},userTaskTableHeaders(){return[{key:"id",label:"ID",sortable:!0,width:"8%"},{key:"Title",label:"Title",sortable:!0,width:"30%"},{key:"Origin",label:"Origin",sortable:!0,width:"15%"},{key:"Priority",label:"Priority",sortable:!0,width:"15%"},{key:"MitigationDueDate",label:"Due Date",sortable:!0,width:"15%"},{key:"actions",label:"Actions",sortable:!1,width:"17%"}]},reviewerTaskTableHeaders(){return[{key:"id",label:"ID",sortable:!0,width:"8%"},{key:"Title",label:"Title",sortable:!0,width:"30%"},{key:"Origin",label:"Origin",sortable:!0,width:"15%"},{key:"Priority",label:"Priority",sortable:!0,width:"15%"},{key:"AssignerId",label:"Assigned By",sortable:!0,width:"15%"},{key:"actions",label:"Actions",sortable:!1,width:"17%"}]},userTaskSections(){return[{name:"Approved",statusKey:"approved",statusClass:"approved",tasks:this.approvedIncidents.map(e=>({...e,actions:"view"}))},{name:"Rejected",statusKey:"rejected",statusClass:"rejected",tasks:this.rejectedIncidents.map(e=>({...e,actions:"resubmit"}))},{name:"Pending Review",statusKey:"pendingReview",statusClass:"pending-review",tasks:this.pendingReviewIncidents.map(e=>({...e,actions:"view"}))},{name:"Assigned",statusKey:"assigned",statusClass:"assigned",tasks:this.assignedIncidents.map(e=>({...e,actions:"view"}))}]},reviewerTaskSections(){return[{name:"Pending Review",statusKey:"reviewerPending",statusClass:"pending-review",tasks:this.pendingReviewerTasks.map(e=>({...e,actions:"review"}))},{name:"Approved",statusKey:"reviewerApproved",statusClass:"approved",tasks:this.approvedReviewerTasks.map(e=>({...e,actions:"view"}))}]}},mounted(){this.fetchUsers(),this.initializeFromQuery()},methods:{fetchUsers(){He.A.get("http://localhost:8000/api/custom-users/").then(e=>{console.log("User data received:",e.data),this.users=e.data,this.userFilterConfig.values=[{value:"",label:"All Users"},...this.users.map(e=>({value:e.UserId,label:`${e.UserName} (${e.role})`}))],this.loading=!1}).catch(e=>{console.error("Error fetching users:",e),this.error=`Failed to fetch users: ${e.message}`,this.loading=!1})},switchToReviewerTab(){console.log("Switching to reviewer tab"),this.activeTab="reviewer",this.selectedUserId&&(console.log("Refreshing data for reviewer tab"),this.fetchData(),this.$nextTick(()=>{this.pendingReviewerTasks.length>0?(this.expandedSections.reviewerPending=!0,this.expandedSections.reviewerApproved=!1):this.approvedReviewerTasks.length>0&&(this.expandedSections.reviewerApproved=!0)}))},fetchData(){if(!this.selectedUserId)return this.userIncidents=[],void(this.reviewerTasks=[]);this.loading=!0,Promise.all([He.A.get(`http://localhost:8000/api/user-incidents/${this.selectedUserId}/`),He.A.get(`http://localhost:8000/api/user-audit-findings/${this.selectedUserId}/`),He.A.get(`http://localhost:8000/api/incident-reviewer-tasks/${this.selectedUserId}/`),He.A.get(`http://localhost:8000/api/audit-finding-reviewer-tasks/${this.selectedUserId}/`)]).then(([e,t,i,a])=>{const s=e.data||[],o=t.data||[],l=s.map(e=>({...e,itemType:"incident"})),n=o.map(e=>({...e,itemType:"audit_finding"})),r=[...l,...n],c=r.filter((e,t,i)=>t===i.findIndex(t=>t.id===e.id));this.userIncidents=c,this.approvedIncidents=this.userIncidents.filter(e=>"Approved"===e.Status),this.rejectedIncidents=this.userIncidents.filter(e=>"Rejected"===e.Status),this.pendingReviewIncidents=this.userIncidents.filter(e=>"Pending Review"===e.Status||"Under Review"===e.Status),this.assignedIncidents=this.userIncidents.filter(e=>!["Approved","Rejected","Pending Review","Under Review"].includes(e.Status)),this.expandedSections={approved:this.approvedIncidents.length>0,rejected:this.rejectedIncidents.length>0,pendingReview:this.pendingReviewIncidents.length>0,assigned:0===this.assignedIncidents.length||this.assignedIncidents.length<5};const d=i.data||[],u=a.data||[],p=d.map(e=>({...e,itemType:"incident"})),m=u.map(e=>({...e,itemType:"audit_finding"})),v=[...p,...m],k=v.filter((e,t,i)=>t===i.findIndex(t=>t.id===e.id));this.reviewerTasks=k,this.approvedReviewerTasks=this.reviewerTasks.filter(e=>"Approved"===e.Status),this.pendingReviewerTasks=this.reviewerTasks.filter(e=>"Approved"!==e.Status),this.expandedSections.reviewerPending=this.pendingReviewerTasks.length>0,this.expandedSections.reviewerApproved=this.approvedReviewerTasks.length>0&&0===this.pendingReviewerTasks.length,console.log("Combined user tasks:",this.userIncidents),console.log("Combined reviewer tasks:",this.reviewerTasks),console.log("Debug - Incident reviewer tasks:",d),console.log("Debug - Audit reviewer tasks:",u),console.log("Debug - Final reviewerTasks length:",this.reviewerTasks.length),this.loading=!1,this.error=null}).catch(e=>{console.error("Error fetching data:",e),this.error=`Failed to fetch data: ${e.message}`,this.loading=!1})},getUserName(e){const t=this.users.find(t=>t.UserId==e);return t?t.UserName:"Unknown"},viewMitigations(e){console.log("viewMitigations called with ID:",e);const t="string"===typeof e?parseInt(e,10):e,i=this.userIncidents.find(e=>e.id===t);if(!i)return console.error("Task not found for ID:",t),void Ck.OQ.error(`Error: Task not found for ID ${t}`);console.log("Found task:",i);const a=i&&"audit_finding"===i.itemType;this.selectedIncidentId=t,this.showMitigationWorkflow=!0,this.loadingMitigations=!0,this.assessmentFeedbackForUser=null,this.$nextTick(()=>{console.log("showMitigationWorkflow set to:",this.showMitigationWorkflow);const e=a?`http://localhost:8000/api/audit-finding-mitigations/${t}/`:`http://localhost:8000/api/incident-mitigations/${t}/`,i=a?`http://localhost:8000/api/audit-finding-review-data/${t}/`:`http://localhost:8000/api/incident-review-data/${t}/`;console.log("Fetching from endpoints:",{mitigationsEndpoint:e,reviewEndpoint:i}),Promise.all([He.A.get(e),He.A.get(i)]).then(([e,t])=>{console.log((a?"Audit finding":"Incident")+" mitigations received:",e.data),console.log((a?"Audit finding":"Incident")+" review data received:",t.data),e.data&&e.data.mitigations?(console.log("DEBUG: Raw mitigations from backend:",e.data.mitigations),Object.keys(e.data.mitigations).forEach(t=>{const i=e.data.mitigations[t];console.log(`DEBUG: Mitigation ${t} raw data:`,i)})):console.warn("No mitigations data found in response"),this.mitigationSteps=this.parseMitigations(e.data),console.log("Parsed mitigation steps:",this.mitigationSteps),t.data&&t.data.assessment_feedback&&(this.assessmentFeedbackForUser=t.data.assessment_feedback,console.log("Assessment feedback:",this.assessmentFeedbackForUser)),e.data.previous_assessment_data&&Object.keys(e.data.previous_assessment_data).length>0&&(this.questionnaireData={...this.questionnaireData,...e.data.previous_assessment_data},console.log("Pre-filled questionnaire data:",this.questionnaireData)),this.loadingMitigations=!1}).catch(e=>{console.error(`Error fetching ${a?"audit finding":"incident"} data:`,e),e.response&&(console.error("Response data:",e.response.data),console.error("Response status:",e.response.status)),Ck.OQ.error(`Error loading data: ${e.message}`),this.mitigationSteps=[],this.assessmentFeedbackForUser=null,this.loadingMitigations=!1})})},parseMitigations(e){if(e&&e.mitigations){const t=e.mitigations,i=Object.keys(t),a=[];i.sort((e,t)=>Number(e)-Number(t));for(const e of i){const i=t[e];let s,o,l,n;"string"===typeof i?(s=i,o=null,l=null,n="Not Started"):(s=i.description||i,o=i.approved,l=i.remarks,n=i.status||"Not Started"),console.log(`DEBUG: Parsing mitigation ${e} - approved: ${o}, remarks: ${l}, description: ${s}`),a.push({title:`Step ${e}`,description:s,status:n,approved:o,remarks:l,previousComments:i.comments||"",comments:"","aws-file_link":i["aws-file_link"]||null,fileName:i.fileName||null})}return a}const t=e.mitigations||e;if(t&&"object"===typeof t&&!Array.isArray(t)){const e=Object.keys(t);if(e.length>0&&!isNaN(Number(e[0]))){const i=[];e.sort((e,t)=>Number(e)-Number(t));for(const a of e)i.push({title:`Step ${a}`,description:t[a],status:"Not Started",approved:null,remarks:null,comments:"","aws-file_link":null,fileName:null});return i}}if(Array.isArray(t))return t;if("string"===typeof t)try{const e=JSON.parse(t);return e&&"object"===typeof e&&!Array.isArray(e)?this.parseMitigations({mitigations:e}):Array.isArray(e)?e:[e]}catch(i){return console.error("Error parsing mitigation JSON:",i),[{title:"Mitigation",description:t,approved:null,remarks:null}]}return[{title:"Mitigation",description:"No detailed mitigation steps available",approved:null,remarks:null}]},closeMitigationModal(){this.showMitigationWorkflow=!1,this.mitigationSteps=[],this.selectedIncidentId=null,this.showQuestionnaire=!1,this.questionnaireData={cost:"",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",systemDowntime:"",recoveryTime:"",riskRecurrence:"",improvementInitiative:""}},updateStepStatus(e,t){console.log(`Updating step ${e+1} status to ${t}`),!0!==this.mitigationSteps[e].approved?!1!==this.mitigationSteps[e].approved&&null!==this.mitigationSteps[e].approved||(this.mitigationSteps[e].status=t):Ck.OQ.warning("This mitigation step has been approved by the reviewer and cannot be modified.")},submitIncidentAssessment(){const e=this.userIncidents.find(e=>e.id===this.selectedIncidentId),t=e&&"audit_finding"===e.itemType;this.loading=!0;const i={};this.mitigationSteps.forEach((e,t)=>{const a=(t+1).toString();let s="";const o=e.previousComments&&e.previousComments.trim(),l=e.comments&&e.comments.trim();o&&l?s=`Previous: ${e.previousComments.trim()}\n\nNew: ${e.comments.trim()}`:o?s=e.previousComments.trim():l&&(s=e.comments.trim()),i[a]={description:e.description,status:e.status||"Completed",comments:s,"aws-file_link":e["aws-file_link"],fileName:e.fileName,approved:e.approved,remarks:e.remarks}});const a={cost:this.questionnaireData.cost||"",impact:this.questionnaireData.impact||"",financialImpact:this.questionnaireData.financialImpact||"",reputationalImpact:this.questionnaireData.reputationalImpact||"",operationalImpact:this.questionnaireData.operationalImpact||"",financialLoss:this.questionnaireData.financialLoss||"",systemDowntime:this.questionnaireData.systemDowntime||"",recoveryTime:this.questionnaireData.recoveryTime||"",riskRecurrence:this.questionnaireData.riskRecurrence||"",improvementInitiative:this.questionnaireData.improvementInitiative||"",mitigations:i,submittedAt:(new Date).toISOString()},s=t?"http://localhost:8000/api/submit-audit-finding-assessment/":"http://localhost:8000/api/submit-incident-assessment/";He.A.post(s,{incident_id:this.selectedIncidentId,user_id:this.selectedUserId,extracted_info:a}).then(e=>{console.log((t?"Audit finding":"Incident")+" assessment submitted:",e.data),this.loading=!1,this.closeMitigationModal(),Ck.OQ.success((t?"Audit finding":"Incident")+" assessment submitted for review successfully!"),this.fetchData()}).catch(e=>{console.error(`Error submitting ${t?"audit finding":"incident"} assessment:`,e),this.loading=!1,Ck.OQ.error("Failed to submit assessment. Please try again.")})},closeReviewerModal(){this.showReviewerWorkflow=!1,this.currentReviewTask=null,this.mitigationReviewData={},this.previousVersions={},this.reviewCompleted=!1,this.reviewApproved=!1},approveMitigation(e,t){const i={...this.mitigationReviewData[e],approved:t,reviewer_submitted_date:(new Date).toISOString()};t&&(i.remarks=""),this.mitigationReviewData={...this.mitigationReviewData,[e]:i}},approveAssessment(e){this.assessmentFeedback={approved:e,remarks:e?"":this.assessmentFeedback.remarks||""},console.log("Assessment feedback updated:",this.assessmentFeedback)},submitReview(e){if(!this.canSubmitReview)return void Ck.OQ.warning("Please complete the review of all mitigations");const t=this.currentReviewTask&&"audit_finding"===this.currentReviewTask.itemType;this.loading=!0;const i={};Object.keys(this.mitigationReviewData).forEach(e=>{const t=this.mitigationReviewData[e];i[e]={approved:t.approved,remarks:t.remarks||null}});const a={incident_id:this.currentReviewTask.id,approved:e,reviewer_id:this.selectedUserId,mitigation_feedback:i,assessment_feedback:this.assessmentFeedback};t&&(a.overall_decision=e?"approved":"rejected"),console.log(`Submitting ${t?"audit finding":"incident"} review with mitigation feedback:`,a);const s=t?"http://localhost:8000/api/complete-audit-finding-review/":"http://localhost:8000/api/complete-incident-review/";He.A.post(s,a).then(i=>{console.log((t?"Audit finding":"Incident")+" review completed:",i.data),this.loading=!1;const a=this.reviewerTasks.findIndex(e=>e.id===this.currentReviewTask.id);-1!==a&&this.reviewerTasks.splice(a,1),this.reviewCompleted=!0,this.reviewApproved=e,Ck.OQ.success(`${t?"Audit finding":"Incident"} ${e?"approved":"rejected"} successfully!`),setTimeout(()=>{this.closeReviewerModal()},2500)}).catch(e=>{console.error(`Error completing ${t?"audit finding":"incident"} review:`,e),this.loading=!1,Ck.OQ.error("Failed to submit review. Please try again.")})},updateRemarks(e){this.mitigationReviewData[e].remarks.trim()?(this.mitigationReviewData={...this.mitigationReviewData},console.log(`Mitigation ${e} remarks updated successfully`)):Ck.OQ.warning("Please provide remarks for rejection")},handleFileUpload(e,t){const i=e.target.files[0];if(!i)return;if(i.size>5242880)return Ck.OQ.error("File size exceeds 5MB limit"),void(e.target.value="");this.mitigationSteps[t].uploading=!0;const a=new FormData;a.append("file",i),a.append("incidentId",this.selectedIncidentId),a.append("mitigationNumber",t+1),He.A.post("http://localhost:8000/api/upload-file/",a,{headers:{"Content-Type":"multipart/form-data"},timeout:1e6}).then(e=>{console.log("File processed successfully:",e.data),e.data.success?(this.mitigationSteps[t]["aws-file_link"]=e.data.file_url,this.mitigationSteps[t].fileName=i.name,Ck.OQ.success("File uploaded successfully")):Ck.OQ.error("Error uploading file: "+e.data.error)}).catch(e=>{console.error("Error processing file:",e),e.response&&e.response.data&&e.response.data.error?Ck.OQ.error("Error uploading file: "+e.response.data.error):Ck.OQ.error("Error uploading file. Please try again.")}).finally(()=>{this.mitigationSteps[t].uploading=!1})},reviewMitigations(e){const t=e&&"audit_finding"===e.itemType;console.log(`Starting reviewMitigations with ${t?"audit finding":"incident"} task:`,e),this.currentReviewTask=e,this.selectedIncidentId=e.id,this.loadingMitigations=!0,this.showReviewerWorkflow=!0,this.previousVersions={},this.assessmentFeedback={};const i=t?`http://localhost:8000/api/audit-finding-review-data/${e.id}/`:`http://localhost:8000/api/incident-review-data/${e.id}/`;He.A.get(i).then(e=>{if(console.log((t?"Audit finding":"Incident")+" review data:",e.data),e.data){this.mitigationReviewData=e.data.mitigations||{},this.questionnaireReviewData=e.data.questionnaire_data||{},this.previousVersions=e.data.previous_versions||{},e.data.assessment_feedback&&(this.assessmentFeedback=e.data.assessment_feedback);const t=e.data.approval_entry?.review_completed;this.reviewCompleted=t,this.reviewApproved="Approved"===e.data.approval_entry?.approved_rejected,this.loadingMitigations=!1}else this.mitigationReviewData={},this.questionnaireReviewData={},this.previousVersions={},this.assessmentFeedback={},this.loadingMitigations=!1}).catch(e=>{console.error(`Error fetching ${t?"audit finding":"incident"} review data:`,e),this.mitigationReviewData={},this.questionnaireReviewData={},this.previousVersions={},this.assessmentFeedback={},this.loadingMitigations=!1})},formatDateTime(e){if(!e)return"";const t=new Date(e);return t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},formatDate(e){if(!e)return"Not set";const t=new Date(e);return t.toLocaleDateString()},getDueStatusClass(e){if(!e)return"";const t=new Date(e),i=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const a=Math.floor((t-i)/864e5);return a<0?"overdue":a<=3?"urgent":a<=7?"warning":"on-track"},getDueStatusText(e){if(!e)return"";const t=new Date(e),i=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const a=Math.floor((t-i)/864e5);return a<0?`(Delayed by ${Math.abs(a)} days)`:0===a?"(Due today)":1===a?"(Due tomorrow)":`(${a} days left)`},getPreviousMitigation(e){return this.previousVersions&&"object"===typeof this.previousVersions&&this.previousVersions[e]?this.previousVersions[e]:null},isStepActive(e){const t=this.mitigationSteps[e];return!1===t.approved||null===t.approved},isStepLocked(e){const t=this.mitigationSteps[e];return!0===t.approved},isOverdue(e){if(!e)return!1;const t=new Date(e),i=new Date;return t.setHours(0,0,0,0),i.setHours(0,0,0,0),t<i},initializeFromQuery(){const e=this.$route.query;e.userId&&(this.selectedUserId=e.userId),e.taskId&&this.viewMitigations(e.taskId),"reviewer"===e.mode&&e.taskId&&(this.activeTab="reviewer",this.$nextTick(()=>{const t={id:e.taskId};this.reviewMitigations(t)}))},validateCurrencyInput(e,t){const i=t.target.value;if(!i||""===i)return;const a=i.replace(/[^0-9.]/g,""),s=/^[0-9]+(\.[0-9]{0,2})?$/;if(s.test(a)){const e=parseFloat(a);e<0?t.target.setCustomValidity("Amount cannot be negative"):e>999999999.99?t.target.setCustomValidity("Amount exceeds maximum allowed value"):t.target.setCustomValidity("")}else t.target.setCustomValidity("Please enter a valid amount (e.g., 1000.50)");this.questionnaireData[e]=a},validateHoursInput(e,t){const i=t.target.value;if(!i||""===i)return;const a=/^[0-9]+(\.[0-9]{0,2})?$/;if(a.test(i)){const e=parseFloat(i);e<0?t.target.setCustomValidity("Hours cannot be negative"):e>8760?t.target.setCustomValidity("Hours exceeds reasonable maximum (8760 = 1 year)"):t.target.setCustomValidity("")}else t.target.setCustomValidity("Please enter a valid number of hours (e.g., 8.5)")},toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]},testEndpoints(){if(0===this.userIncidents.length)return void Ck.OQ.error("No incidents available for testing");const e=this.userIncidents[0].id,t="audit_finding"===this.userIncidents[0].itemType;console.log("Testing API endpoints with ID:",e);const i=t?`http://localhost:8000/api/audit-finding-mitigations/${e}/`:`http://localhost:8000/api/incident-mitigations/${e}/`,a=t?`http://localhost:8000/api/audit-finding-review-data/${e}/`:`http://localhost:8000/api/incident-review-data/${e}/`;He.A.get(i).then(e=>{console.log("Mitigations endpoint test successful:",e.data),Ck.OQ.success("Mitigations endpoint test successful")}).catch(e=>{console.error("Mitigations endpoint test failed:",e),Ck.OQ.error(`Mitigations endpoint test failed: ${e.message}`)}),He.A.get(a).then(e=>{console.log("Review endpoint test successful:",e.data),Ck.OQ.success("Review endpoint test successful")}).catch(e=>{console.error("Review endpoint test failed:",e),Ck.OQ.error(`Review endpoint test failed: ${e.message}`)})},handleUserTaskClick(e){("view"===e.actions||"resubmit"===e.actions)&&this.viewMitigations(e.id)},handleReviewerTaskClick(e){("review"===e.actions||"view"===e.actions)&&this.reviewMitigations(e)}}};const Y0=(0,le.A)(G0,[["render",H0],["__scopeId","data-v-1776eed5"]]);var Z0=Y0;const e1={class:"audits-container"},t1={key:0,class:"error-message"},i1={class:"search-container"},a1={class:"audits-search"},s1={class:"view-toggle"},o1={key:0,class:"active-filters"},l1=["onClick"],n1={key:1,class:"loading-indicator"},r1={key:2,class:"audits-table-wrapper"},c1={class:"audits-table"},d1=["onClick"],u1=["title"],p1=["title"],m1=["title"],v1=["title"],k1=["title"],h1=["title"],g1=["title"],y1=["title"],f1={class:"status-dropdown-container"},b1=["onClick"],C1={key:0,class:"status-options"},L1=["onClick"],w1=["onClick"],E1=["onClick"],R1=["title"],I1={key:0},D1={key:3,class:"audits-card-wrapper"},P1={key:0,class:"no-data"},_1={key:1,class:"audits-card-grid"},A1=["onClick"],S1={class:"card-header"},T1={class:"card-framework"},x1=["onClick"],F1={key:0,class:"status-options"},V1=["onClick"],U1=["onClick"],N1=["onClick"],M1={class:"card-body"},X1={class:"card-info-row"},$1={class:"card-info-value"},O1={class:"card-info-row"},j1={class:"card-info-value"},B1={class:"card-info-row"},W1={class:"card-info-value"},q1={class:"card-info-row"},Q1={class:"card-info-value"},K1={class:"card-info-row"},J1={class:"card-info-value"},z1={class:"card-info-row"},H1={class:"card-info-value"},G1={class:"card-footer"},Y1={class:"card-audit-type"},Z1={class:"card-report"},e2={key:4,class:"sort-dropdown-overlay"},t2={class:"dropdown-content"},i2={class:"dropdown-header"},a2=["onClick"],s2={key:5,class:"audits-modal"},o2={class:"audits-modal-content audit-details-modal"},l2={class:"modal-header"},n2={key:0,class:"loading-indicator"},r2={key:1,class:"audit-details-content"},c2={class:"audit-info"},d2={class:"info-item"},u2={class:"info-item"},p2={class:"info-item"},m2={class:"info-item"},v2={class:"info-item"},k2={class:"info-item"},h2={class:"info-item"},g2={class:"info-item"},y2={class:"info-item"},f2={key:0,class:"compliance-items"},b2={class:"compliance-table"},C2={key:1,class:"no-compliance-items"};function L2(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",e1,[t[67]||(t[67]=(0,s.Lk)("div",{class:"audits-header"},[(0,s.Lk)("h1",null,"Audits")],-1)),l.error?((0,s.uX)(),(0,s.CE)("div",t1,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.retryLoading&&n.retryLoading(...e)),class:"retry-btn"},"Retry")])):(0,s.Q3)("",!0),(0,s.Lk)("div",i1,[(0,s.Lk)("div",a1,[(0,s.bo)((0,s.Lk)("input",{type:"text",placeholder:"Search","onUpdate:modelValue":t[1]||(t[1]=e=>l.searchQuery=e),onInput:t[2]||(t[2]=(...e)=>n.handleSearch&&n.handleSearch(...e))},null,544),[[a.Jo,l.searchQuery]])]),(0,s.Lk)("div",s1,[(0,s.Lk)("button",{class:(0,d.C4)(["view-btn",{active:"list"===l.viewMode}]),onClick:t[3]||(t[3]=e=>l.viewMode="list")},t[20]||(t[20]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" List ")]),2),(0,s.Lk)("button",{class:(0,d.C4)(["view-btn",{active:"card"===l.viewMode}]),onClick:t[4]||(t[4]=e=>l.viewMode="card")},t[21]||(t[21]=[(0,s.Lk)("i",{class:"fas fa-th-large"},null,-1),(0,s.eW)(" Card ")]),2)]),Object.keys(l.activeFilters).length>0?((0,s.uX)(),(0,s.CE)("div",o1,[t[22]||(t[22]=(0,s.Lk)("span",null,"Active Filters: ",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeFilters,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:t,class:"filter-badge"},[(0,s.eW)((0,d.v_)(t)+": "+(0,d.v_)(e)+" ",1),(0,s.Lk)("span",{class:"remove-filter",onClick:e=>n.applyFilter(t,"")},"×",8,l1)]))),128))])):(0,s.Q3)("",!0)]),l.loading?((0,s.uX)(),(0,s.CE)("div",n1," Loading data, please wait... ")):"list"===l.viewMode?((0,s.uX)(),(0,s.CE)("div",r1,[(0,s.Lk)("table",c1,[(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,[t[23]||(t[23]=(0,s.eW)(" Frame work ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[5]||(t[5]=e=>n.toggleSortDropdown("framework"))},"▼")]),(0,s.Lk)("th",null,[t[24]||(t[24]=(0,s.eW)(" Policy ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[6]||(t[6]=e=>n.toggleSortDropdown("policy"))},"▼")]),(0,s.Lk)("th",null,[t[25]||(t[25]=(0,s.eW)(" Subpolicy ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[7]||(t[7]=e=>n.toggleSortDropdown("subpolicy"))},"▼")]),(0,s.Lk)("th",null,[t[26]||(t[26]=(0,s.eW)(" Auditor ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[8]||(t[8]=e=>n.toggleSortDropdown("auditor"))},"▼")]),(0,s.Lk)("th",null,[t[27]||(t[27]=(0,s.eW)(" Duedate ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[9]||(t[9]=e=>n.toggleSortDropdown("duedate"))},"▼")]),(0,s.Lk)("th",null,[t[28]||(t[28]=(0,s.eW)(" Frequency ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[10]||(t[10]=e=>n.toggleSortDropdown("frequency"))},"▼")]),(0,s.Lk)("th",null,[t[29]||(t[29]=(0,s.eW)(" Review ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[11]||(t[11]=e=>n.toggleSortDropdown("reviewer"))},"▼")]),(0,s.Lk)("th",null,[t[30]||(t[30]=(0,s.eW)(" Audit Type ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[12]||(t[12]=e=>n.toggleSortDropdown("audit_type"))},"▼")]),(0,s.Lk)("th",null,[t[31]||(t[31]=(0,s.eW)(" Status ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[13]||(t[13]=e=>n.toggleSortDropdown("status"))},"▼")]),(0,s.Lk)("th",null,[t[32]||(t[32]=(0,s.eW)(" Report ")),(0,s.Lk)("span",{class:"sort-icon",onClick:t[14]||(t[14]=e=>n.toggleSortDropdown("report"))},"▼")])])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredAuditData,(e,i)=>((0,s.uX)(),(0,s.CE)("tr",{key:i,onClick:t=>e&&e.audit_id?n.viewAuditDetails(e.audit_id):null,class:"audit-row"},[(0,s.Lk)("td",{title:e&&e.framework||"-"},(0,d.v_)(n.formatCellText(e&&e.framework||"-")),9,u1),(0,s.Lk)("td",{title:e&&e.policy||"-"},(0,d.v_)(n.formatCellText(e&&e.policy||"-")),9,p1),(0,s.Lk)("td",{title:e&&e.subpolicy||"-"},(0,d.v_)(n.formatCellText(e&&e.subpolicy||"-")),9,m1),(0,s.Lk)("td",{title:e&&e.auditor||"-"},(0,d.v_)(n.formatCellText(e&&e.auditor||"-")),9,v1),(0,s.Lk)("td",{title:e&&e.duedate||"-"},(0,d.v_)(n.formatCellText(e&&e.duedate||"-")),9,k1),(0,s.Lk)("td",{title:e&&e.frequency||"-"},(0,d.v_)(n.formatCellText(e&&e.frequency||"-")),9,h1),(0,s.Lk)("td",{title:e&&e.reviewer||"-"},(0,d.v_)(n.formatCellText(e&&e.reviewer||"-")),9,g1),(0,s.Lk)("td",{title:e&&e.audit_type||"-"},(0,d.v_)(n.formatCellText(e&&e.audit_type||"-")),9,y1),(0,s.Lk)("td",{onClick:t[15]||(t[15]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",f1,[(0,s.Lk)("span",{class:(0,d.C4)([n.getStatusClass(e&&e.status),"status-badge status-clickable"]),onClick:(0,a.D$)(e=>n.openStatusDropdown(e,i),["stop"])},[(0,s.eW)((0,d.v_)(e&&e.status||"-")+" ",1),t[33]||(t[33]=(0,s.Lk)("i",{class:"fas fa-chevron-down status-dropdown-icon"},null,-1))],10,b1),l.openStatusIdx===i?((0,s.uX)(),(0,s.CE)("div",C1,[(0,s.Lk)("div",{class:"status-option",onClick:(0,a.D$)(t=>n.changeStatus(t,e,"Completed"),["stop"])},t[34]||(t[34]=[(0,s.Lk)("span",{class:"status-dot completed"},null,-1),(0,s.eW)(" Completed ")]),8,L1),(0,s.Lk)("div",{class:"status-option",onClick:(0,a.D$)(t=>n.changeStatus(t,e,"Work in Progress"),["stop"])},t[35]||(t[35]=[(0,s.Lk)("span",{class:"status-dot progress"},null,-1),(0,s.eW)(" Work in Progress ")]),8,w1),(0,s.Lk)("div",{class:"status-option",onClick:(0,a.D$)(t=>n.changeStatus(t,e,"Yet to Start"),["stop"])},t[36]||(t[36]=[(0,s.Lk)("span",{class:"status-dot start"},null,-1),(0,s.eW)(" Yet to Start ")]),8,E1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("td",{title:e&&e.report||"-"},(0,d.v_)(n.formatCellText(e&&e.report||"-")),9,R1)],8,d1))),128)),l.filteredAuditData&&0!==l.filteredAuditData.length?l.filteredAuditData.length<6?((0,s.uX)(!0),(0,s.CE)(s.FK,{key:1},(0,s.pI)(6-l.filteredAuditData.length,e=>((0,s.uX)(),(0,s.CE)("tr",{key:"empty-"+e},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(10,e=>(0,s.Lk)("td",{key:e})),64))]))),128)):(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("tr",I1,t[37]||(t[37]=[(0,s.Lk)("td",{colspan:"10",class:"no-data"},"No audit data available",-1)])))])])])):((0,s.uX)(),(0,s.CE)("div",D1,[l.filteredAuditData&&0!==l.filteredAuditData.length?((0,s.uX)(),(0,s.CE)("div",_1,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredAuditData,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"audit-card",onClick:t=>e&&e.audit_id?n.viewAuditDetails(e.audit_id):null},[(0,s.Lk)("div",S1,[(0,s.Lk)("div",T1,(0,d.v_)(n.formatCellText(e&&e.framework||"-")),1),(0,s.Lk)("div",{class:"status-dropdown-container",onClick:t[16]||(t[16]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:(0,d.C4)([n.getStatusClass(e&&e.status),"status-badge status-clickable"]),onClick:(0,a.D$)(e=>n.openStatusDropdown(e,"card-"+i),["stop"])},[(0,s.eW)((0,d.v_)(e&&e.status||"-")+" ",1),t[38]||(t[38]=(0,s.Lk)("i",{class:"fas fa-chevron-down status-dropdown-icon"},null,-1))],10,x1),l.openStatusIdx==="card-"+i?((0,s.uX)(),(0,s.CE)("div",F1,[(0,s.Lk)("div",{class:"status-option",onClick:(0,a.D$)(t=>n.changeStatus(t,e,"Completed"),["stop"])},t[39]||(t[39]=[(0,s.Lk)("span",{class:"status-dot completed"},null,-1),(0,s.eW)(" Completed ")]),8,V1),(0,s.Lk)("div",{class:"status-option",onClick:(0,a.D$)(t=>n.changeStatus(t,e,"Work in Progress"),["stop"])},t[40]||(t[40]=[(0,s.Lk)("span",{class:"status-dot progress"},null,-1),(0,s.eW)(" Work in Progress ")]),8,U1),(0,s.Lk)("div",{class:"status-option",onClick:(0,a.D$)(t=>n.changeStatus(t,e,"Yet to Start"),["stop"])},t[41]||(t[41]=[(0,s.Lk)("span",{class:"status-dot start"},null,-1),(0,s.eW)(" Yet to Start ")]),8,N1)])):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",M1,[(0,s.Lk)("div",X1,[t[42]||(t[42]=(0,s.Lk)("div",{class:"card-info-icon"},"📄",-1)),t[43]||(t[43]=(0,s.Lk)("div",{class:"card-info-label"},"Policy:",-1)),(0,s.Lk)("div",$1,(0,d.v_)(n.formatCellText(e&&e.policy||"-")),1)]),(0,s.Lk)("div",O1,[t[44]||(t[44]=(0,s.Lk)("div",{class:"card-info-icon"},"📝",-1)),t[45]||(t[45]=(0,s.Lk)("div",{class:"card-info-label"},"Subpolicy:",-1)),(0,s.Lk)("div",j1,(0,d.v_)(n.formatCellText(e&&e.subpolicy||"-")),1)]),(0,s.Lk)("div",B1,[t[46]||(t[46]=(0,s.Lk)("div",{class:"card-info-icon"},"👤",-1)),t[47]||(t[47]=(0,s.Lk)("div",{class:"card-info-label"},"Auditor:",-1)),(0,s.Lk)("div",W1,(0,d.v_)(n.formatCellText(e&&e.auditor||"-")),1)]),(0,s.Lk)("div",q1,[t[48]||(t[48]=(0,s.Lk)("div",{class:"card-info-icon"},"📅",-1)),t[49]||(t[49]=(0,s.Lk)("div",{class:"card-info-label"},"Due Date:",-1)),(0,s.Lk)("div",Q1,(0,d.v_)(n.formatCellText(e&&e.duedate||"-")),1)]),(0,s.Lk)("div",K1,[t[50]||(t[50]=(0,s.Lk)("div",{class:"card-info-icon"},"🔄",-1)),t[51]||(t[51]=(0,s.Lk)("div",{class:"card-info-label"},"Frequency:",-1)),(0,s.Lk)("div",J1,(0,d.v_)(n.formatCellText(e&&e.frequency||"-")),1)]),(0,s.Lk)("div",z1,[t[52]||(t[52]=(0,s.Lk)("div",{class:"card-info-icon"},"👁️",-1)),t[53]||(t[53]=(0,s.Lk)("div",{class:"card-info-label"},"Reviewer:",-1)),(0,s.Lk)("div",H1,(0,d.v_)(n.formatCellText(e&&e.reviewer||"-")),1)])]),(0,s.Lk)("div",G1,[(0,s.Lk)("div",Y1,[(0,s.Lk)("span",null,"🏷️ "+(0,d.v_)(n.formatCellText(e&&e.audit_type||"-")),1)]),(0,s.Lk)("div",Z1,[(0,s.Lk)("span",null,"📊 "+(0,d.v_)(e&&e.report?"Report Available":"No Report"),1)])])],8,A1))),128))])):((0,s.uX)(),(0,s.CE)("div",P1," No audit data available "))])),l.activeDropdown?((0,s.uX)(),(0,s.CE)("div",e2,[(0,s.Lk)("div",t2,[(0,s.Lk)("div",i2,[(0,s.Lk)("span",null,"Filter by "+(0,d.v_)(l.activeDropdown),1),(0,s.Lk)("span",{class:"close-dropdown",onClick:t[17]||(t[17]=e=>l.activeDropdown=null)},"×")]),(0,s.Lk)("div",{class:"dropdown-item",onClick:t[18]||(t[18]=e=>n.applyFilter(l.activeDropdown,""))},"Show All"),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getUniqueValues(l.activeDropdown),e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"dropdown-item",onClick:t=>n.applyFilter(l.activeDropdown,e)},(0,d.v_)(e),9,a2))),128))])])):(0,s.Q3)("",!0),l.showAuditDetails&&l.currentAudit?((0,s.uX)(),(0,s.CE)("div",s2,[(0,s.Lk)("div",o2,[(0,s.Lk)("div",l2,[t[54]||(t[54]=(0,s.Lk)("h2",null,"Audit Details",-1)),(0,s.Lk)("button",{type:"button",class:"close-btn",onClick:t[19]||(t[19]=(...e)=>n.closeAuditDetails&&n.closeAuditDetails(...e))},"×")]),l.loadingAuditDetails?((0,s.uX)(),(0,s.CE)("div",n2," Loading audit details... ")):l.currentAudit?((0,s.uX)(),(0,s.CE)("div",r2,[(0,s.Lk)("div",c2,[(0,s.Lk)("div",d2,[t[55]||(t[55]=(0,s.Lk)("strong",null,"Framework:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.framework||"N/A"),1)]),(0,s.Lk)("div",u2,[t[56]||(t[56]=(0,s.Lk)("strong",null,"Policy:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.policy||"N/A"),1)]),(0,s.Lk)("div",p2,[t[57]||(t[57]=(0,s.Lk)("strong",null,"Subpolicy:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.subpolicy||"N/A"),1)]),(0,s.Lk)("div",m2,[t[58]||(t[58]=(0,s.Lk)("strong",null,"Auditor:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.auditor||"N/A"),1)]),(0,s.Lk)("div",v2,[t[59]||(t[59]=(0,s.Lk)("strong",null,"Assignee:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.assignee||"N/A"),1)]),(0,s.Lk)("div",k2,[t[60]||(t[60]=(0,s.Lk)("strong",null,"Reviewer:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.reviewer||"N/A"),1)]),(0,s.Lk)("div",h2,[t[61]||(t[61]=(0,s.Lk)("strong",null,"Due Date:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.duedate||"N/A"),1)]),(0,s.Lk)("div",g2,[t[62]||(t[62]=(0,s.Lk)("strong",null,"Status:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.status||"N/A"),1)]),(0,s.Lk)("div",y2,[t[63]||(t[63]=(0,s.Lk)("strong",null,"Completion:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentAudit.completed_compliances||0)+"/"+(0,d.v_)(l.currentAudit.total_compliances||0),1)])]),l.currentAudit.compliance_items&&l.currentAudit.compliance_items.length>0?((0,s.uX)(),(0,s.CE)("div",f2,[t[65]||(t[65]=(0,s.Lk)("h3",null,"Compliance Items",-1)),(0,s.Lk)("table",b2,[t[64]||(t[64]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"ID"),(0,s.Lk)("th",null,"Description"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Status")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.currentAudit.compliance_items,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.ComplianceId},[(0,s.Lk)("td",null,(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.ComplianceItemDescription),1),(0,s.Lk)("td",null,(0,d.v_)(n.formatCriticality(e.Criticality)),1),(0,s.Lk)("td",null,(0,d.v_)(e.status_text),1)]))),128))])])])):((0,s.uX)(),(0,s.CE)("div",C2,t[66]||(t[66]=[(0,s.Lk)("p",null,"No compliance items found for this audit.",-1)])))])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])}var w2={name:"AuditsView",data(){return{searchQuery:"",auditData:[],filteredAuditData:[],error:"",loading:!0,showAuditDetails:!1,currentAudit:null,loadingAuditDetails:!1,activeDropdown:null,activeFilters:{},viewMode:"list",openStatusIdx:null}},mounted(){console.log("Audits component mounted, fetching data..."),this.fetchAuditData(),document.addEventListener("click",this.closeDropdownOnClickOutside)},beforeUnmount(){document.removeEventListener("click",this.closeDropdownOnClickOutside)},methods:{retryLoading(){this.fetchAuditData()},fetchAuditData(){console.log("Fetching audit data..."),this.loading=!0,this.error="",PA.FH.getAllAudits().then(e=>{console.log("Audit data received:",e.data),Array.isArray(e.data)?(this.auditData=e.data,this.filteredAuditData=e.data):(console.warn("Received non-array audit data:",e.data),this.auditData=[],this.filteredAuditData=[]),this.loading=!1}).catch(e=>{console.error("Error fetching audit data:",e),Tr.wr.handleApiError(e,"audit data access")?this.error="Access denied":this.error=`Failed to load data: ${e.message||e}`,this.auditData=[],this.filteredAuditData=[],this.loading=!1})},handleSearch(){this.applyFilters()},toggleSortDropdown(e){this.activeDropdown===e?this.activeDropdown=null:this.activeDropdown=e},closeDropdownOnClickOutside(e){e.target.closest(".sort-dropdown")||e.target.closest(".sort-icon")||(this.activeDropdown=null)},getUniqueValues(e){return Array.isArray(this.auditData)?[...new Set(this.auditData.map(t=>t[e]).filter(Boolean))].sort():[]},applyFilter(e,t){""===t?this.activeFilters[e]&&delete this.activeFilters[e]:this.activeFilters[e]=t,this.activeDropdown=null,this.applyFilters()},applyFilters(){if(!Array.isArray(this.auditData))return void(this.filteredAuditData=[]);const e=this.searchQuery.toLowerCase();let t=this.auditData;e&&(t=t.filter(t=>t.framework&&t.framework.toLowerCase().includes(e)||t.policy&&t.policy.toLowerCase().includes(e)||t.subpolicy&&t.subpolicy.toLowerCase().includes(e)||t.auditor&&t.auditor.toLowerCase().includes(e)||t.status&&t.status.toLowerCase().includes(e)));for(const[i,a]of Object.entries(this.activeFilters))t=t.filter(e=>e[i]===a);this.filteredAuditData=t},viewAuditDetails(e){e?(this.loadingAuditDetails=!0,this.currentAudit=null,this.showAuditDetails=!0,console.log("Fetching audit details for ID:",e),PA.FH.getAuditDetails(e).then(e=>{console.log("Audit details received:",e.data),this.currentAudit=e.data,this.loadingAuditDetails=!1}).catch(e=>{console.error("Error fetching audit details:",e),Tr.wr.handleApiError(e,"audit details access")?this.error="Access denied":this.error=e.response?.data?.error||`Failed to load audit details: ${e.message||e}`,this.loadingAuditDetails=!1,this.showAuditDetails=!1})):this.error="Invalid audit ID"},closeAuditDetails(){this.showAuditDetails=!1,this.currentAudit=null},formatCriticality(e){return 0===e||"0"===e?"Minor":1===e||"1"===e?"Major":2===e||"2"===e?"Not Applicable":"string"===typeof e&&isNaN(parseInt(e))?e:"Not Specified"},getStatusClass(e){return e?e.toLowerCase().includes("complete")?"status-completed":e.toLowerCase().includes("progress")?"status-progress":e.toLowerCase().includes("pending")?"status-pending":e.toLowerCase().includes("start")?"status-start":"":""},formatCellText(e){return"string"!==typeof e?e:e.length>25?e.substring(0,23)+"...":e},openStatusDropdown(e,t){e.stopPropagation(),this.openStatusIdx=this.openStatusIdx===t?null:t},changeStatus(e,t,i){e.stopPropagation(),t&&t.audit_id?(this.loading=!0,this.error="",PA.FH.updateAuditStatus(t.audit_id,i).then(e=>{console.log("Status updated successfully:",e.data),t.status=i,this.loading=!1,this.openStatusIdx=null}).catch(e=>{console.error("Error updating audit status:",e),this.error=`Failed to update status: ${e.message||e}`,this.loading=!1})):this.error="Cannot update status: Invalid audit"}}};const E2=(0,le.A)(w2,[["render",L2],["__scopeId","data-v-9c0bf47a"]]);var R2=E2;const I2={class:"create-compliance-container"},D2={class:"field-group selection-fields"},P2={class:"row-fields"},_2={class:"compliance-field"},A2={class:"compliance-field"},S2={class:"compliance-field"},T2={class:"compliance-list"},x2={class:"compliance-tabs"},F2=["onClick"],V2=["onClick"],U2={class:"item-header"},N2={class:"item-number"},M2={class:"field-group"},X2={class:"row-fields"},$2={class:"compliance-field"},O2=["onUpdate:modelValue"],j2={class:"compliance-field checkbox-container"},B2={style:{"font-weight":"500","font-size":"0.9rem",display:"flex","align-items":"center",gap:"6px"},title:"Check if this compliance item represents a risk"},W2=["onUpdate:modelValue","onChange"],q2={class:"row-fields"},Q2={class:"compliance-field"},K2=["onUpdate:modelValue","onInput","maxlength"],J2={key:0,class:"validation-error"},z2={class:"compliance-field"},H2=["onUpdate:modelValue","onInput","maxlength"],G2={key:0,class:"validation-error"},Y2={class:"compliance-field full-width"},Z2=["onUpdate:modelValue","onInput","placeholder","maxlength"],e3={key:0,class:"validation-error"},t3={class:"compliance-field full-width"},i3=["onUpdate:modelValue","onInput","maxlength"],a3={key:0,class:"validation-error"},s3={class:"compliance-field full-width"},o3=["onUpdate:modelValue","onInput","maxlength"],l3={key:0,class:"validation-error"},n3={class:"row-fields"},r3={class:"compliance-field full-width"},c3={class:"searchable-dropdown"},d3=["onUpdate:modelValue","onFocus","onInput"],u3={class:"dropdown-options"},p3={key:0,class:"dropdown-add-option"},m3=["onClick"],v3=["onClick"],k3={key:0,class:"validation-error"},h3={class:"field-group risk-fields"},g3={class:"compliance-field full-width"},y3=["onUpdate:modelValue","onInput","maxlength"],f3={key:0,class:"validation-error"},b3={class:"compliance-field full-width"},C3={class:"mitigation-steps"},L3={class:"step-header"},w3={class:"step-numberr"},E3=["onClick"],R3=["onUpdate:modelValue","onInput"],I3={class:"add-step-container"},D3=["onClick"],P3={key:0,class:"validation-error"},_3={class:"compliance-field full-width"},A3=["onUpdate:modelValue","onInput","maxlength"],S3={key:0,class:"validation-error"},T3={class:"row-fields"},x3={class:"compliance-field"},F3=["onUpdate:modelValue","maxlength","onChange"],V3={key:0,class:"validation-error"},U3={class:"compliance-field"},N3={class:"searchable-dropdown"},M3=["onUpdate:modelValue","maxlength","onFocus","onInput"],X3={class:"dropdown-options"},$3={key:0,class:"dropdown-add-option"},O3=["onClick"],j3=["onClick"],B3={key:0,class:"validation-error"},W3={class:"compliance-field"},q3={class:"searchable-dropdown"},Q3=["onUpdate:modelValue","maxlength","onFocus","onInput"],K3={class:"dropdown-options"},J3={key:0,class:"dropdown-add-option"},z3=["onClick"],H3=["onClick"],G3={key:0,class:"validation-error"},Y3={class:"field-group classification-fields"},Z3={class:"row-fields"},e4={class:"compliance-field"},t4=["onUpdate:modelValue"],i4={class:"compliance-field"},a4=["onUpdate:modelValue"],s4={class:"row-fields"},o4={class:"compliance-field"},l4=["onUpdate:modelValue"],n4={class:"compliance-field"},r4=["onUpdate:modelValue"],c4={class:"row-fields"},d4={class:"compliance-field"},u4=["onUpdate:modelValue","onInput"],p4={key:0,class:"validation-error"},m4={class:"compliance-field"},v4=["onUpdate:modelValue","onInput"],k4={key:0,class:"validation-error"},h4={class:"field-group approval-fields"},g4={class:"row-fields"},y4={class:"compliance-field"},f4={key:0,class:"validation-error"},b4={class:"compliance-submit-container"},C4=["disabled"],L4={key:0,class:"btn-icon"},w4={key:1},E4={key:2};function R4(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("CustomDropdown");return(0,s.uX)(),(0,s.CE)("div",I2,[t[65]||(t[65]=(0,s.Lk)("div",{class:"compliance-headers"},[(0,s.Lk)("span",null,"Control Management"),(0,s.Lk)("div",{class:"compliance-headers-underline"})],-1)),(0,s.bF)(r),(0,s.Lk)("div",D2,[t[8]||(t[8]=(0,s.Lk)("div",{class:"field-group-title"},"Select Policy Framework",-1)),(0,s.Lk)("div",P2,[(0,s.Lk)("div",_2,[t[5]||(t[5]=(0,s.Lk)("label",{for:"framework"},"Framework",-1)),(0,s.bF)(c,{config:l.frameworkConfig,modelValue:l.selectedFramework,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedFramework=e),onChange:n.onFrameworkChange},null,8,["config","modelValue","onChange"])]),(0,s.Lk)("div",A2,[t[6]||(t[6]=(0,s.Lk)("label",{for:"policy"},"Policy",-1)),(0,s.bF)(c,{config:l.policyConfig,modelValue:l.selectedPolicy,"onUpdate:modelValue":t[1]||(t[1]=e=>l.selectedPolicy=e),onChange:n.onPolicyChange},null,8,["config","modelValue","onChange"])]),(0,s.Lk)("div",S2,[t[7]||(t[7]=(0,s.Lk)("label",{for:"subpolicy"},"Sub Policy",-1)),(0,s.bF)(c,{config:l.subPolicyConfig,modelValue:l.selectedSubPolicy,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedSubPolicy=e),onChange:n.onSubPolicyChange},null,8,["config","modelValue","onChange"])])])]),(0,s.Lk)("div",T2,[(0,s.Lk)("div",x2,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.complianceList,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:(0,d.C4)(["compliance-tab",{"active-tab":l.activeTab===i}]),onClick:e=>l.activeTab=i},[(0,s.Lk)("span",null,"Item #"+(0,d.v_)(i+1),1),l.complianceList.length>1?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"tab-remove-btn",onClick:(0,a.D$)(e=>n.removeCompliance(i),["stop"]),title:"Remove this compliance item"},t[9]||(t[9]=[(0,s.Lk)("span",{class:"btn-icon"},"×",-1)]),8,V2)):(0,s.Q3)("",!0)],10,F2))),128)),(0,s.Lk)("button",{class:"add-tab-btn",onClick:t[3]||(t[3]=(...e)=>n.addCompliance&&n.addCompliance(...e)),title:"Add new compliance item"},t[10]||(t[10]=[(0,s.Lk)("span",{class:"btn-icon"},"+",-1)]))]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.complianceList,(e,i)=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",{key:i,class:"compliance-item-form"},[(0,s.Lk)("div",U2,[(0,s.Lk)("span",N2,"Compliance Item #"+(0,d.v_)(i+1),1)]),(0,s.Lk)("div",M2,[t[27]||(t[27]=(0,s.Lk)("div",{class:"field-group-title"},"Basic Information",-1)),(0,s.Lk)("div",X2,[(0,s.Lk)("div",$2,[t[11]||(t[11]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.Identifier=t,class:"compliance-input",placeholder:"Auto-generated if left empty",title:"Unique identifier for this compliance item (auto-generated if left blank)"},null,8,O2),[[a.Jo,e.Identifier]]),t[12]||(t[12]=(0,s.Lk)("small",null,"Leave empty for auto-generated identifier",-1))]),(0,s.Lk)("div",j2,[(0,s.Lk)("label",B2,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t=>e.IsRisk=t,onChange:e=>n.onFieldChange(i,"IsRisk",e),style:{"margin-right":"6px",width:"auto"}},null,40,W2),[[a.lH,e.IsRisk]]),t[13]||(t[13]=(0,s.eW)(" Is Risk "))])])]),(0,s.Lk)("div",q2,[(0,s.Lk)("div",Q2,[t[14]||(t[14]=(0,s.Lk)("label",null,"Compliance Title",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.ComplianceTitle=t,onInput:e=>n.onFieldChange(i,"ComplianceTitle",e),class:"compliance-input",placeholder:"Enter compliance title",required:"",maxlength:l.validationRules.maxLengths.ComplianceTitle,title:"Enter the title of the compliance item"},null,40,K2),[[a.Jo,e.ComplianceTitle]]),t[15]||(t[15]=(0,s.Lk)("small",null,"Enter a clear, descriptive title for this compliance requirement (3-145 characters)",-1)),e.validationErrors&&e.validationErrors.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",J2,(0,d.v_)(e.validationErrors.ComplianceTitle.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",z2,[t[16]||(t[16]=(0,s.Lk)("label",null,"Compliance Type",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.ComplianceType=t,onInput:e=>n.onFieldChange(i,"ComplianceType",e),class:"compliance-input",placeholder:"Enter compliance type",required:"",maxlength:l.validationRules.maxLengths.ComplianceType,title:"Type of compliance (e.g. Regulatory, Internal, Security)"},null,40,H2),[[a.Jo,e.ComplianceType]]),t[17]||(t[17]=(0,s.Lk)("small",null,"Specify the type of compliance (e.g., Regulatory, Internal, Security, Operational)",-1)),e.validationErrors&&e.validationErrors.ComplianceType?((0,s.uX)(),(0,s.CE)("div",G2,(0,d.v_)(e.validationErrors.ComplianceType.join(", ")),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Y2,[t[18]||(t[18]=(0,s.Lk)("label",null,"Compliance Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.ComplianceItemDescription=t,onInput:e=>n.onFieldChange(i,"ComplianceItemDescription",e),class:"compliance-input",placeholder:`Compliance Description ${i+1}`,required:"",rows:"3",maxlength:l.validationRules.maxLengths.ComplianceItemDescription,title:"Detailed description of the compliance requirement"},null,40,Z2),[[a.Jo,e.ComplianceItemDescription]]),t[19]||(t[19]=(0,s.Lk)("small",null,"Provide a detailed description of the compliance requirement and what it entails",-1)),e.validationErrors&&e.validationErrors.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",e3,(0,d.v_)(e.validationErrors.ComplianceItemDescription.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",t3,[t[20]||(t[20]=(0,s.Lk)("label",null,"Scope",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Scope=t,onInput:e=>n.onFieldChange(i,"Scope",e),class:"compliance-input",placeholder:"Enter scope information",rows:"3",required:"",maxlength:l.validationRules.maxLengths.Scope,title:"Define the boundaries and extent of the compliance requirement"},null,40,i3),[[a.Jo,e.Scope]]),t[21]||(t[21]=(0,s.Lk)("small",null,"Define the boundaries, systems, processes, and areas covered by this compliance requirement",-1)),e.validationErrors&&e.validationErrors.Scope?((0,s.uX)(),(0,s.CE)("div",a3,(0,d.v_)(e.validationErrors.Scope.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",s3,[t[22]||(t[22]=(0,s.Lk)("label",null,"Objective",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.Objective=t,onInput:e=>n.onFieldChange(i,"Objective",e),class:"compliance-input",placeholder:"Enter objective information",rows:"3",required:"",maxlength:l.validationRules.maxLengths.Objective,title:"The goal or purpose of this compliance requirement"},null,40,o3),[[a.Jo,e.Objective]]),t[23]||(t[23]=(0,s.Lk)("small",null,"Describe the goal, purpose, and intended outcome of this compliance requirement",-1)),e.validationErrors&&e.validationErrors.Objective?((0,s.uX)(),(0,s.CE)("div",l3,(0,d.v_)(e.validationErrors.Objective.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",n3,[(0,s.Lk)("div",r3,[t[25]||(t[25]=(0,s.Lk)("label",null,"Business Units Covered",-1)),(0,s.Lk)("div",c3,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e=>l.businessUnitSearch[i]=e,class:"compliance-input",placeholder:"Search or add business units",title:"Departments or business units affected by this compliance",onFocus:e=>n.showDropdown(i,"BusinessUnitsCovered"),onInput:e=>n.filterOptions(i,"BusinessUnitsCovered")},null,40,d3),[[a.Jo,l.businessUnitSearch[i]]]),(0,s.bo)((0,s.Lk)("div",u3,[0===l.filteredOptions.BusinessUnitsCovered.length&&l.businessUnitSearch[i]?((0,s.uX)(),(0,s.CE)("div",p3,[t[24]||(t[24]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:e=>n.addNewOption(i,"BusinessUnitsCovered",l.businessUnitSearch[i]),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.businessUnitSearch[i])+'" ',9,m3)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.BusinessUnitsCovered,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption(i,"BusinessUnitsCovered",e.value)},(0,d.v_)(e.value),9,v3))),128))],512),[[a.aG,l.activeDropdown.index===i&&"BusinessUnitsCovered"===l.activeDropdown.field]])]),t[26]||(t[26]=(0,s.Lk)("small",null,"Select or add the departments, teams, or business units affected by this compliance requirement",-1)),e.validationErrors&&e.validationErrors.BusinessUnitsCovered?((0,s.uX)(),(0,s.CE)("div",k3,(0,d.v_)(e.validationErrors.BusinessUnitsCovered.join(", ")),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",h3,[t[45]||(t[45]=(0,s.Lk)("div",{class:"field-group-title"},"Risk Information",-1)),(0,s.Lk)("div",g3,[t[28]||(t[28]=(0,s.Lk)("label",null,"Possible Impact",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.PossibleDamage=t,onInput:e=>n.onFieldChange(i,"PossibleDamage",e),class:"compliance-input",placeholder:"Possible Damage",rows:"3",required:"",maxlength:l.validationRules.maxLengths.PossibleDamage,title:"Potential damage that could occur if this risk materializes"},null,40,y3),[[a.Jo,e.PossibleDamage]]),t[29]||(t[29]=(0,s.Lk)("small",null,"Describe the potential damage, losses, or negative impacts that could occur if this risk materializes",-1)),e.validationErrors&&e.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",f3,(0,d.v_)(e.validationErrors.PossibleDamage.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",b3,[t[32]||(t[32]=(0,s.Lk)("label",null,"Mitigation Steps",-1)),(0,s.Lk)("div",C3,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.mitigationSteps,(e,o)=>((0,s.uX)(),(0,s.CE)("div",{key:o,class:"mitigation-step"},[(0,s.Lk)("div",L3,[(0,s.Lk)("span",w3,"Step "+(0,d.v_)(o+1),1),(0,s.Lk)("button",{type:"button",class:"remove-step-btn",onClick:e=>n.removeStep(i,o),title:"Remove this step"},t[30]||(t[30]=[(0,s.Lk)("span",{class:"btn-icon"},"×",-1)]),8,E3)]),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.description=t,onInput:e=>n.onMitigationStepChange(i),class:"compliance-input",placeholder:"Describe this mitigation step (minimum 10 characters)",rows:"2",required:""},null,40,R3),[[a.Jo,e.description]])]))),128)),(0,s.Lk)("div",I3,[(0,s.Lk)("button",{type:"button",class:"add-step-btn",onClick:e=>n.addStep(i),title:"Add new mitigation step"},t[31]||(t[31]=[(0,s.Lk)("span",{class:"btn-icon"},"+",-1),(0,s.eW)(" Add Step ")]),8,D3)])]),t[33]||(t[33]=(0,s.Lk)("small",null,"Define specific steps or actions to reduce, control, or eliminate the identified risk (minimum 10 characters per step)",-1)),e.validationErrors&&e.validationErrors.mitigation?((0,s.uX)(),(0,s.CE)("div",P3,(0,d.v_)(e.validationErrors.mitigation.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_3,[t[34]||(t[34]=(0,s.Lk)("label",null,"Potential Risk Scenarios",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.PotentialRiskScenarios=t,onInput:e=>n.onFieldChange(i,"PotentialRiskScenarios",e),class:"compliance-input",placeholder:"Describe potential risk scenarios",rows:"3",required:"",maxlength:l.validationRules.maxLengths.PotentialRiskScenarios,title:"Describe scenarios where this risk could materialize"},null,40,A3),[[a.Jo,e.PotentialRiskScenarios]]),t[35]||(t[35]=(0,s.Lk)("small",null,"Describe specific scenarios or conditions under which this risk could materialize",-1)),e.validationErrors&&e.validationErrors.PotentialRiskScenarios?((0,s.uX)(),(0,s.CE)("div",S3,(0,d.v_)(e.validationErrors.PotentialRiskScenarios.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",T3,[(0,s.Lk)("div",x3,[t[37]||(t[37]=(0,s.Lk)("label",null,"Risk Type",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.RiskType=t,class:"compliance-input",required:"",maxlength:l.validationRules.maxLengths.RiskType,title:"Type of risk",onChange:t=>n.validateComplianceField(e,"RiskType",t.target.value)},t[36]||(t[36]=[(0,s.Fv)('<option value="" data-v-553eb436>Select Risk Type</option><option value="Current" data-v-553eb436>Current</option><option value="Residual" data-v-553eb436>Residual</option><option value="Inherent" data-v-553eb436>Inherent</option><option value="Emerging" data-v-553eb436>Emerging</option><option value="Accepted" data-v-553eb436>Accepted</option>',6)]),40,F3),[[a.u1,e.RiskType]]),t[38]||(t[38]=(0,s.Lk)("small",null,"Select the type of risk: Current (existing), Residual (remaining after controls), Inherent (before controls), Emerging (new), or Accepted (tolerated)",-1)),e.validationErrors&&e.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("div",V3,(0,d.v_)(e.validationErrors.RiskType.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",U3,[t[40]||(t[40]=(0,s.Lk)("label",null,"Risk Category",-1)),(0,s.Lk)("div",N3,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e=>l.riskCategorySearch[i]=e,class:"compliance-input",placeholder:"Search or add risk category",required:"",maxlength:l.validationRules.maxLengths.RiskCategory,title:"Category of risk (e.g. People, Process, Technology, External)",onFocus:e=>n.showDropdown(i,"RiskCategory"),onInput:e=>n.filterOptions(i,"RiskCategory")},null,40,M3),[[a.Jo,l.riskCategorySearch[i]]]),(0,s.bo)((0,s.Lk)("div",X3,[0===l.filteredOptions.RiskCategory.length&&l.riskCategorySearch[i]?((0,s.uX)(),(0,s.CE)("div",$3,[t[39]||(t[39]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:e=>n.addNewOption(i,"RiskCategory",l.riskCategorySearch[i]),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskCategorySearch[i])+'" ',9,O3)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskCategory,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption(i,"RiskCategory",e.value)},(0,d.v_)(e.value),9,j3))),128))],512),[[a.aG,l.activeDropdown.index===i&&"RiskCategory"===l.activeDropdown.field]])]),t[41]||(t[41]=(0,s.Lk)("small",null,"Select or add the category of risk (e.g., People, Process, Technology, External, Financial)",-1)),e.validationErrors&&e.validationErrors.RiskCategory?((0,s.uX)(),(0,s.CE)("div",B3,(0,d.v_)(e.validationErrors.RiskCategory.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",W3,[t[43]||(t[43]=(0,s.Lk)("label",null,"Risk Business Impact",-1)),(0,s.Lk)("div",q3,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":e=>l.riskBusinessImpactSearch[i]=e,class:"compliance-input",placeholder:"Search or add business impact",required:"",maxlength:l.validationRules.maxLengths.RiskBusinessImpact,title:"How this risk impacts business operations",onFocus:e=>n.showDropdown(i,"RiskBusinessImpact"),onInput:e=>n.filterOptions(i,"RiskBusinessImpact")},null,40,Q3),[[a.Jo,l.riskBusinessImpactSearch[i]]]),(0,s.bo)((0,s.Lk)("div",K3,[0===l.filteredOptions.RiskBusinessImpact.length&&l.riskBusinessImpactSearch[i]?((0,s.uX)(),(0,s.CE)("div",J3,[t[42]||(t[42]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:e=>n.addNewOption(i,"RiskBusinessImpact",l.riskBusinessImpactSearch[i]),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskBusinessImpactSearch[i])+'" ',9,z3)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskBusinessImpact,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption(i,"RiskBusinessImpact",e.value)},(0,d.v_)(e.value),9,H3))),128))],512),[[a.aG,l.activeDropdown.index===i&&"RiskBusinessImpact"===l.activeDropdown.field]])]),t[44]||(t[44]=(0,s.Lk)("small",null,"Select or add how this risk impacts business operations (e.g., Operational Disruption, Financial Loss, Reputation Damage)",-1)),e.validationErrors&&e.validationErrors.RiskBusinessImpact?((0,s.uX)(),(0,s.CE)("div",G3,(0,d.v_)(e.validationErrors.RiskBusinessImpact.join(", ")),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",Y3,[t[61]||(t[61]=(0,s.Lk)("div",{class:"field-group-title"},"Classification",-1)),(0,s.Lk)("div",Z3,[(0,s.Lk)("div",e4,[t[47]||(t[47]=(0,s.Lk)("label",null,"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.Criticality=t,class:"compliance-select",required:"",title:"How critical this compliance item is to the organization"},t[46]||(t[46]=[(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),8,t4),[[a.u1,e.Criticality]]),t[48]||(t[48]=(0,s.Lk)("small",null,"Select the criticality level based on the importance and impact of this compliance requirement",-1))]),(0,s.Lk)("div",i4,[t[50]||(t[50]=(0,s.Lk)("label",null,"Mandatory/Optional",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.MandatoryOptional=t,class:"compliance-select",required:"",title:"Whether this compliance item is mandatory or optional"},t[49]||(t[49]=[(0,s.Lk)("option",{value:"Mandatory"},"Mandatory",-1),(0,s.Lk)("option",{value:"Optional"},"Optional",-1)]),8,a4),[[a.u1,e.MandatoryOptional]]),t[51]||(t[51]=(0,s.Lk)("small",null,"Indicate whether this compliance requirement is mandatory (required) or optional (recommended)",-1))])]),(0,s.Lk)("div",s4,[(0,s.Lk)("div",o4,[t[53]||(t[53]=(0,s.Lk)("label",null,"Manual/Automatic",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t=>e.ManualAutomatic=t,class:"compliance-select",required:"",title:"Whether this compliance is checked manually or automatically"},t[52]||(t[52]=[(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Automatic"},"Automatic",-1)]),8,l4),[[a.u1,e.ManualAutomatic]]),t[54]||(t[54]=(0,s.Lk)("small",null,"Specify whether this compliance is monitored manually (human review) or automatically (system/tool)",-1))]),(0,s.Lk)("div",n4,[t[55]||(t[55]=(0,s.Lk)("label",null,"Applicability",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t=>e.Applicability=t,class:"compliance-input",placeholder:"Applicability from policy",title:"Describes where this compliance item applies"},null,8,r4),[[a.Jo,e.Applicability]]),t[56]||(t[56]=(0,s.Lk)("small",null,"Describe where, when, and under what conditions this compliance requirement applies",-1))])]),(0,s.Lk)("div",c4,[(0,s.Lk)("div",d4,[t[57]||(t[57]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.Impact=t,onInput:e=>n.onFieldChange(i,"Impact",e),class:"compliance-input",step:"0.1",min:"1",max:"10",required:"",title:"Rate the Severity Rating from 1 (lowest) to 10 (highest)"},null,40,u4),[[a.Jo,e.Impact,void 0,{number:!0}]]),t[58]||(t[58]=(0,s.Lk)("small",null,"Rate the severity of non-compliance from 1 (minimal impact) to 10 (critical impact)",-1)),e.validationErrors&&e.validationErrors.Impact?((0,s.uX)(),(0,s.CE)("div",p4,(0,d.v_)(e.validationErrors.Impact.join(", ")),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",m4,[t[59]||(t[59]=(0,s.Lk)("label",null,"Probability (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t=>e.Probability=t,onInput:e=>n.onFieldChange(i,"Probability",e),class:"compliance-input",step:"0.1",min:"1",max:"10",required:"",title:"Rate the probability from 1 (lowest) to 10 (highest)"},null,40,v4),[[a.Jo,e.Probability,void 0,{number:!0}]]),t[60]||(t[60]=(0,s.Lk)("small",null,"Rate the likelihood of non-compliance from 1 (very unlikely) to 10 (very likely)",-1)),e.validationErrors&&e.validationErrors.Probability?((0,s.uX)(),(0,s.CE)("div",k4,(0,d.v_)(e.validationErrors.Probability.join(", ")),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",h4,[t[64]||(t[64]=(0,s.Lk)("div",{class:"field-group-title"},"Approval Information",-1)),(0,s.Lk)("div",g4,[(0,s.Lk)("div",y4,[t[62]||(t[62]=(0,s.Lk)("label",null,"Assign Reviewer",-1)),(0,s.bF)(c,{config:l.reviewerConfig,modelValue:e.reviewer_id,"onUpdate:modelValue":t=>e.reviewer_id=t,onChange:n.onReviewerChange},null,8,["config","modelValue","onUpdate:modelValue","onChange"]),t[63]||(t[63]=(0,s.Lk)("small",null,"Select the person responsible for reviewing and approving this compliance item",-1)),l.users.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",f4,"No reviewers available"))])])])])),[[a.aG,l.activeTab===i]])),128))]),(0,s.Lk)("div",b4,[(0,s.Lk)("button",{class:"compliance-submit-btn",onClick:t[4]||(t[4]=(...e)=>n.submitCompliance&&n.submitCompliance(...e)),disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("span",L4,"⏳")):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("span",w4,"Saving...")):((0,s.uX)(),(0,s.CE)("span",E4,"Submit Compliance"))],8,C4)])])}var I4=i(4300);const D4={complianceCreated(){const e="Compliance created successfully and sent for review.";Ck.OQ.success(e,"Compliance Created")},complianceUpdated(){const e="Compliance updated successfully and sent for review.";Ck.OQ.success(e,"Compliance Updated")},complianceCloned(){const e="Compliance  cloned successfully and sent for review.";Ck.OQ.success(e,"Compliance Cloned")}};var P4={name:"CreateCompliance",components:{PopupModal:Ck.wA,CustomDropdown:xa.A},data(){return{selectedFramework:"",selectedPolicy:"",selectedSubPolicy:"",frameworks:[],policies:[],subPolicies:[],users:[],categoryOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},filteredOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},businessUnitSearch:[],riskTypeSearch:[],riskCategorySearch:[],riskBusinessImpactSearch:[],activeDropdown:{index:null,field:null},complianceList:[{ComplianceTitle:"",ComplianceItemDescription:"",ComplianceType:"",Scope:"",Objective:"",BusinessUnitsCovered:"",Identifier:"",IsRisk:!1,PossibleDamage:"",mitigation:"",PotentialRiskScenarios:"",RiskType:"",RiskCategory:"",RiskBusinessImpact:"",Criticality:"Medium",MandatoryOptional:"Mandatory",ManualAutomatic:"Manual",Impact:5,Probability:5,Status:"Under Review",reviewer_id:2,CreatedByName:"2",Applicability:"",MaturityLevel:"Initial",ActiveInactive:"Active",PermanentTemporary:"Permanent",mitigationSteps:[{stepNumber:1,description:""}],validationErrors:{}}],loading:!1,activeTab:0,validationRules:{textPattern:/^[a-zA-Z0-9\s.,!?\-_()[\]{}:;'"&%$#@+=\n\r\t]*$/,alphanumericPattern:/^[a-zA-Z0-9\s.\-_]*$/,identifierPattern:/^[a-zA-Z0-9\-_]*$/,maxLengths:{ComplianceTitle:145,ComplianceItemDescription:5e3,ComplianceType:100,Scope:5e3,Objective:5e3,BusinessUnitsCovered:225,Identifier:45,PossibleDamage:5e3,mitigation:5e3,PotentialRiskScenarios:5e3,RiskType:45,RiskCategory:45,RiskBusinessImpact:45,Applicability:45},minLengths:{ComplianceTitle:3,ComplianceItemDescription:10,ComplianceType:3,Scope:10,Objective:10,BusinessUnitsCovered:3,mitigation:10,PossibleDamage:10,PotentialRiskScenarios:10,RiskType:3,RiskCategory:3,RiskBusinessImpact:3},allowedChoices:{Criticality:["High","Medium","Low"],MandatoryOptional:["Mandatory","Optional"],ManualAutomatic:["Manual","Automatic"]},numericRanges:{Impact:{min:1,max:10},Probability:{min:1,max:10}}},frameworkConfig:{name:"Framework",label:"Framework",values:[],defaultValue:"Select Framework"},policyConfig:{name:"Policy",label:"Policy",values:[],defaultValue:"Select Policy"},subPolicyConfig:{name:"Sub Policy",label:"Sub Policy",values:[],defaultValue:"Select Sub Policy"},reviewerConfig:{name:"Reviewer",label:"Reviewer",values:[],defaultValue:"Select Reviewer"}}},computed:{minDate(){const e=new Date;return e.toISOString().split("T")[0]}},async created(){try{await this.loadFrameworks(),await this.loadUsers(),await this.loadCategoryOptions(),this.businessUnitSearch=[""],this.riskTypeSearch=[""],this.riskCategorySearch=[""],this.riskBusinessImpactSearch=[""],document.addEventListener("click",this.handleClickOutside),this.onMitigationStepChange(0)}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceCreateDenied();console.error("Error initializing CreateCompliance component:",e)}},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{sanitizeString(e){return"string"!==typeof e?String(e||""):e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"")},sanitizeStringForSubmission(e){return"string"!==typeof e?String(e||""):e.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim()},validateRequiredString(e,t,i=null,a=null,s=null){const o=this.sanitizeString(e),l=o.trim(),n=[];return l&&0!==l.length||n.push(`${t} is required and cannot be empty`),a&&l.length>0&&l.length<a&&n.push(`${t} must be at least ${a} characters long`),i&&o.length>i&&n.push(`${t} must not exceed ${i} characters`),s&&o&&!s.test(o)&&n.push(`${t} contains invalid characters`),{value:o,errors:n}},validateOptionalString(e,t,i=null,a=null){const s=this.sanitizeString(e),o=[];return i&&s.length>i&&o.push(`${t} must not exceed ${i} characters`),a&&s&&!a.test(s)&&o.push(`${t} contains invalid characters`),{value:s,errors:o}},validateChoiceField(e,t,i){const a=[];return e&&""!==e?i.includes(e)||a.push(`${t} must be one of: ${i.join(", ")}`):a.push(`${t} is required`),{value:e,errors:a}},validateNumericField(e,t,i=null,a=null){const s=[],o=parseFloat(e);return isNaN(o)?s.push(`${t} must be a valid number`):(null!==i&&o<i&&s.push(`${t} must be at least ${i}`),null!==a&&o>a&&s.push(`${t} must not exceed ${a}`)),{value:o,errors:s}},validateDateField(e,t){const i=[];if(e&&""!==e){const a=/^\d{4}-\d{2}-\d{2}$/;if(a.test(e)){const a=new Date(e);if(isNaN(a.getTime()))i.push(`${t} must be a valid date`);else{const e=new Date;e.setHours(0,0,0,0),a<e&&i.push(`${t} must be a future date`)}}else i.push(`${t} must be in YYYY-MM-DD format`)}else i.push(`${t} is required`);return{value:e,errors:i}},validateComplianceField(e,t,i){const a=this.validationRules;let s={value:i,errors:[]};switch(t){case"ComplianceTitle":s=this.validateRequiredString(i,"Compliance Title",a.maxLengths.ComplianceTitle,a.minLengths.ComplianceTitle,a.textPattern);break;case"ComplianceItemDescription":s=this.validateRequiredString(i,"Compliance Description",a.maxLengths.ComplianceItemDescription,a.minLengths.ComplianceItemDescription,a.textPattern);break;case"ComplianceType":s=this.validateRequiredString(i,"Compliance Type",a.maxLengths.ComplianceType,a.minLengths.ComplianceType,a.textPattern);break;case"Scope":s=this.validateRequiredString(i,"Scope",a.maxLengths.Scope,a.minLengths.Scope,a.textPattern);break;case"Objective":s=this.validateRequiredString(i,"Objective",a.maxLengths.Objective,a.minLengths.Objective,a.textPattern);break;case"BusinessUnitsCovered":s=this.validateRequiredString(i,"Business Units Covered",a.maxLengths.BusinessUnitsCovered,a.minLengths.BusinessUnitsCovered,a.textPattern);break;case"Identifier":i&&i.trim()&&(s=this.validateOptionalString(i,"Identifier",a.maxLengths.Identifier,a.identifierPattern));break;case"PossibleDamage":s=this.validateRequiredString(i,"Possible Damage",a.maxLengths.PossibleDamage,a.minLengths.PossibleDamage,a.textPattern);break;case"PotentialRiskScenarios":s=this.validateRequiredString(i,"Potential Risk Scenarios",a.maxLengths.PotentialRiskScenarios,a.minLengths.PotentialRiskScenarios,a.textPattern);break;case"RiskType":s=this.validateRequiredString(i,"Risk Type",a.maxLengths.RiskType,a.minLengths.RiskType,a.textPattern);break;case"RiskCategory":s=this.validateRequiredString(i,"Risk Category",a.maxLengths.RiskCategory,a.minLengths.RiskCategory,a.textPattern);break;case"RiskBusinessImpact":s=this.validateRequiredString(i,"Risk Business Impact",a.maxLengths.RiskBusinessImpact,a.minLengths.RiskBusinessImpact,a.textPattern);break;case"mitigation":if(e.mitigationSteps&&0!==e.mitigationSteps.length){const t=e.mitigationSteps.filter(e=>{const t=e.description?e.description.trim():"";return!t||t.length<10});t.length>0&&s.errors.push("Each mitigation step must have at least 10 characters")}else s.errors.push("At least one mitigation step is required");break;case"Applicability":s=this.validateOptionalString(i,"Applicability",a.maxLengths.Applicability,a.textPattern);break;case"Criticality":s=this.validateChoiceField(i,"Criticality",a.allowedChoices.Criticality);break;case"MandatoryOptional":s=this.validateChoiceField(i,"Mandatory/Optional",a.allowedChoices.MandatoryOptional);break;case"ManualAutomatic":s=this.validateChoiceField(i,"Manual/Automatic",a.allowedChoices.ManualAutomatic);break;case"Impact":s=this.validateNumericField(i,"Severity Rating",a.numericRanges.Impact.min,a.numericRanges.Impact.max);break;case"Probability":s=this.validateNumericField(i,"Probability",a.numericRanges.Probability.min,a.numericRanges.Probability.max);break}return e.validationErrors||(e.validationErrors={}),s.errors.length>0?e.validationErrors[t]=s.errors:delete e.validationErrors[t],s},onFieldChange(e,t,i){const a=this.complianceList[e];let s;"IsRisk"===t?(s=i.target.checked,a[t]=s):(s=i.target.value,a[t]=s,this.validateComplianceField(a,t,s)),this.$forceUpdate()},validateAllFields(){let e=!0;const t=[];return this.selectedFramework&&this.selectedFramework.id||(t.push("Please select a framework"),e=!1),this.selectedPolicy&&this.selectedPolicy.id||(t.push("Please select a policy"),e=!1),this.selectedSubPolicy&&this.selectedSubPolicy.id||(t.push("Please select a sub-policy"),e=!1),this.complianceList.forEach((i,a)=>{i.validationErrors={};const s=["ComplianceTitle","ComplianceItemDescription","ComplianceType","Scope","Objective","BusinessUnitsCovered","mitigation","PossibleDamage","PotentialRiskScenarios","RiskType","RiskCategory","RiskBusinessImpact","Criticality","MandatoryOptional","ManualAutomatic","Impact","Probability"];i.reviewer_id&&""!==i.reviewer_id||(i.validationErrors.reviewer_id=["Please select a reviewer"],t.push(`Please select a reviewer for item ${a+1}`),e=!1),s.forEach(s=>{const o=this.validateComplianceField(i,s,i[s]);o.errors.length>0&&(t.push(`Item ${a+1}: ${o.errors.join(", ")}`),e=!1)});const o=["Identifier","Applicability"];o.forEach(s=>{if(i[s]&&i[s].trim()){const o=this.validateComplianceField(i,s,i[s]);o.errors.length>0&&(t.push(`Item ${a+1}: ${o.errors.join(", ")}`),e=!1)}})}),{isValid:e,errors:t}},async loadFrameworks(){try{this.loading=!0;const e=await I4.fv.getComplianceFrameworks();e.data.success&&Array.isArray(e.data.frameworks)?(this.frameworks=e.data.frameworks.map(e=>({id:e.id,name:e.name})),this.frameworkConfig.values=this.frameworks.map(e=>({value:e,label:e.name}))):(console.error("Unexpected response format:",e.data),Ck.OQ.error("Failed to load frameworks. Please refresh the page and try again."))}catch(e){if(console.error("Error loading frameworks:",e),e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceFrameworkDenied();Ck.OQ.error("Failed to load frameworks. Please refresh the page and try again.")}finally{this.loading=!1}},async loadPolicies(e){try{this.loading=!0;const t=await I4.fv.getCompliancePolicies(e);t.data.success&&Array.isArray(t.data.policies)?(this.policies=t.data.policies.map(e=>({id:e.id,name:e.name,applicability:e.scope||""})),this.policyConfig.values=this.policies.map(e=>({value:e,label:e.name}))):(console.error("Error in response:",t.data),Ck.OQ.error("Failed to load policies. Please try selecting a different framework."))}catch(t){if(console.error("Error loading policies:",t),t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showCompliancePolicyDenied();Ck.OQ.error("Failed to load policies. Please try selecting a different framework.")}finally{this.loading=!1}},async loadSubPolicies(e){try{this.loading=!0;const t=await I4.fv.getComplianceSubPolicies(e);t.data.success&&Array.isArray(t.data.subpolicies)?(this.subPolicies=t.data.subpolicies.map(e=>({id:e.id,name:e.name})),this.subPolicyConfig.values=this.subPolicies.map(e=>({value:e,label:e.name}))):(console.error("Error in response:",t.data),Ck.OQ.error("Failed to load sub-policies. Please try selecting a different policy."))}catch(t){if(console.error("Error loading sub-policies:",t),t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showComplianceSubpolicyDenied();Ck.OQ.error("Failed to load sub-policies. Please try selecting a different policy.")}finally{this.loading=!1}},async loadUsers(){try{this.loading=!0;const e=await I4.fv.getUsers();if(console.log("Users API response:",e),!e.data.success||!Array.isArray(e.data.users))throw new Error("Invalid users data received");this.users=e.data.users.map(e=>({UserId:e.UserId,UserName:e.UserName||`User ${e.UserId}`,email:e.email||""})),this.reviewerConfig.values=this.users.map(e=>({value:e.UserId,label:`${e.UserName}${e.email?` (${e.email})`:""}`})),this.users.length>0&&this.complianceList.length>0&&(this.complianceList[0].reviewer_id=this.users[0].UserId),console.log("Loaded users:",this.users)}catch(e){console.error("Failed to load users:",e),Ck.OQ.error("Failed to load reviewers. Please refresh the page and try again.")}finally{this.loading=!1}},async loadCategoryOptions(){try{this.loading=!0;const e=await I4.fv.getCategoryBusinessUnits("BusinessUnitsCovered");e.data.success&&(this.categoryOptions.BusinessUnitsCovered=e.data.data);const t=await I4.fv.getCategoryBusinessUnits("RiskType");t.data.success&&(this.categoryOptions.RiskType=t.data.data);const i=await I4.fv.getCategoryBusinessUnits("RiskCategory");i.data.success&&(this.categoryOptions.RiskCategory=i.data.data);const a=await I4.fv.getCategoryBusinessUnits("RiskBusinessImpact");a.data.success&&(this.categoryOptions.RiskBusinessImpact=a.data.data)}catch(e){console.error("Failed to load category options:",e),Ck.OQ.error("Failed to load dropdown options. Some features may be limited.")}finally{this.loading=!1}},showDropdown(e,t){this.activeDropdown={index:e,field:t},this.filterOptions(e,t),event.stopPropagation()},handleClickOutside(e){const t=document.querySelectorAll(".searchable-dropdown");let i=!0;t.forEach(t=>{t.contains(e.target)&&(i=!1)}),i&&(this.activeDropdown={index:null,field:null})},filterOptions(e,t,i=""){let a=[];switch(t){case"Framework":a=this.frameworks;break;case"Policy":a=this.policies;break;case"SubPolicy":a=this.subPolicies;break;case"BusinessUnitsCovered":a=this.categoryOptions.BusinessUnitsCovered;break;case"RiskType":a=this.categoryOptions.RiskType;break;case"RiskCategory":a=this.categoryOptions.RiskCategory;break;case"RiskBusinessImpact":a=this.categoryOptions.RiskBusinessImpact;break}const s=i.toLowerCase();this.filteredOptions[t]=a.filter(e=>e.value.toLowerCase().includes(s))},selectOption(e,t,i){switch(this.complianceList[e][t]=i,t){case"Framework":this.frameworkConfig.selectedValue=i;break;case"Policy":this.policyConfig.selectedValue=i;break;case"SubPolicy":this.subPolicyConfig.selectedValue=i;break;case"BusinessUnitsCovered":this.businessUnitSearch[e]=i;break;case"RiskType":this.riskTypeSearch[e]=i;break;case"RiskCategory":this.riskCategorySearch[e]=i;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch[e]=i;break}this.activeDropdown={index:null,field:null},this.validateComplianceField(this.complianceList[e],t,i)},async addNewOption(e,t,i){if(i&&i.trim())try{this.loading=!0;const a=await I4.fv.addCategoryBusinessUnit({source:t,value:i.trim()});if(!a.data.success)throw new Error(a.data.error||"Failed to add new option");{const i=a.data.data;this.categoryOptions[t].push({id:i.id,value:i.value}),this.selectOption(e,t,i.value),Ck.OQ.success(`Added new ${t} option: ${i.value}`)}}catch(a){console.error(`Failed to add new ${t} option:`,a),Ck.OQ.error(`Failed to add new option: ${a.message||a}`)}finally{this.loading=!1}},addCompliance(){const e=this.selectedPolicy&&this.selectedPolicy.applicability||"";this.complianceList.push({ComplianceTitle:"",ComplianceItemDescription:"",ComplianceType:"",Scope:"",Objective:"",BusinessUnitsCovered:"",Identifier:"",IsRisk:!1,PossibleDamage:"",mitigation:"",PotentialRiskScenarios:"",RiskType:"",RiskCategory:"",RiskBusinessImpact:"",Criticality:"Medium",MandatoryOptional:"Mandatory",ManualAutomatic:"Manual",Impact:5,Probability:5,Status:"Under Review",reviewer_id:this.users.length>0?this.users[0].UserId:2,CreatedByName:this.users.length>0?this.users[0].UserName:"2",Applicability:e,MaturityLevel:"Initial",ActiveInactive:"Active",PermanentTemporary:"Permanent",mitigationSteps:[{stepNumber:1,description:""}],validationErrors:{}}),this.businessUnitSearch.push(""),this.riskTypeSearch.push(""),this.riskCategorySearch.push(""),this.riskBusinessImpactSearch.push(""),this.activeTab=this.complianceList.length-1,this.onMitigationStepChange(this.activeTab)},removeCompliance(e){this.complianceList.length>1&&(e<=this.activeTab&&(e===this.complianceList.length-1&&e===this.activeTab?this.activeTab=Math.max(0,e-1):e<this.activeTab&&this.activeTab--),this.complianceList.splice(e,1),this.businessUnitSearch.splice(e,1),this.riskTypeSearch.splice(e,1),this.riskCategorySearch.splice(e,1),this.riskBusinessImpactSearch.splice(e,1),this.activeDropdown={index:null,field:null})},async submitCompliance(){try{const e=this.validateAllFields();if(!e.isValid)return void Ck.OQ.error(`Validation failed: ${e.errors.join(", ")}`);this.loading=!0,console.log("Submitting compliance list:",this.complianceList);for(let t=0;t<this.complianceList.length;t++){const e=this.complianceList[t];if(this.onMitigationStepChange(t),!this.selectedSubPolicy?.id)throw new Error("SubPolicy is required");const i={SubPolicy:this.selectedSubPolicy.id,ComplianceTitle:e.ComplianceTitle?.trim(),ComplianceItemDescription:e.ComplianceItemDescription?.trim(),ComplianceType:e.ComplianceType?.trim(),Scope:e.Scope?.trim(),Objective:e.Objective?.trim(),BusinessUnitsCovered:e.BusinessUnitsCovered?.trim(),Identifier:e.Identifier?.trim()||"",IsRisk:Boolean(e.IsRisk),PossibleDamage:e.PossibleDamage?.trim(),mitigation:e.mitigation?.trim(),PotentialRiskScenarios:e.PotentialRiskScenarios?.trim(),RiskType:e.RiskType?.trim(),RiskCategory:e.RiskCategory?.trim(),RiskBusinessImpact:e.RiskBusinessImpact?.trim(),Criticality:e.Criticality||"Medium",MandatoryOptional:e.MandatoryOptional||"Mandatory",ManualAutomatic:e.ManualAutomatic||"Manual",Impact:parseFloat(e.Impact)||5,Probability:parseFloat(e.Probability)||5,Status:"Under Review",ComplianceVersion:"1.0",reviewer:parseInt(e.reviewer_id),CreatedByName:e.CreatedByName||e.reviewer_id?.toString(),Applicability:e.Applicability?.trim(),MaturityLevel:e.MaturityLevel||"Initial",ActiveInactive:e.ActiveInactive||"Active",PermanentTemporary:e.PermanentTemporary||"Permanent",ApprovalDueDate:new Date(Date.now()+6048e5).toISOString().split("T")[0]},a=["SubPolicy","ComplianceTitle","ComplianceItemDescription","reviewer"],s=a.filter(e=>!i[e]);if(s.length>0)throw new Error(`Missing required fields: ${s.join(", ")}`);console.log("Submitting compliance data:",i);const o=await I4.fv.createCompliance(i);if(console.log("Compliance creation response:",o),console.log("Response data:",o.data),!o.data.success)throw new Error(o.data.message||"Failed to create compliance");const l={ComplianceId:i.ComplianceId,ComplianceItemDescription:i.ComplianceItemDescription,Identifier:o.data.Identifier};console.log("Popup data:",l),D4.complianceCreated(l),this.resetForm()}}catch(e){if(console.error("Error creating compliance:",e),e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceCreateDenied();this.$toast?.error(e.response?.data?.message||e.message||"Failed to create compliance items")}finally{this.loading=!1}},addStep(e){this.complianceList[e].mitigationSteps.push({stepNumber:this.complianceList[e].mitigationSteps.length+1,description:""}),this.$forceUpdate()},removeStep(e,t){this.complianceList[e].mitigationSteps.splice(t,1),this.complianceList[e].mitigationSteps.forEach((e,t)=>{e.stepNumber=t+1}),this.onMitigationStepChange(e)},onMitigationStepChange(e){const t=this.complianceList[e];let i={};t.mitigationSteps.forEach((e,t)=>{const a=e.description.trim();a&&(i[t+1]=a)}),t.mitigation=JSON.stringify(i).replace(/\\"/g,'"').replace(/\\\\/g,"\\").replace(/\\n/g,"\n").replace(/\\t/g,"\t"),this.validateComplianceField(t,"mitigation",t.mitigation)},resetForm(){this.complianceList=[{ComplianceTitle:"",ComplianceItemDescription:"",ComplianceType:"",Scope:"",Objective:"",BusinessUnitsCovered:"",Identifier:"",IsRisk:!1,PossibleDamage:"",mitigation:"",PotentialRiskScenarios:"",RiskType:"",RiskCategory:"",RiskBusinessImpact:"",Criticality:"Medium",MandatoryOptional:"Mandatory",ManualAutomatic:"Manual",Impact:5,Probability:5,Status:"Under Review",reviewer_id:this.users.length>0?this.users[0].UserId:2,CreatedByName:this.users.length>0?this.users[0].UserName:"2",Applicability:"",MaturityLevel:"Initial",ActiveInactive:"Active",PermanentTemporary:"Permanent",mitigationSteps:[{stepNumber:1,description:""}],validationErrors:{}}],this.selectedFramework="",this.selectedPolicy="",this.selectedSubPolicy="",this.policies=[],this.subPolicies=[],this.businessUnitSearch=[""],this.riskTypeSearch=[""],this.riskCategorySearch=[""],this.riskBusinessImpactSearch=[""],this.activeTab=0,this.error=null,this.loading=!1,this.onMitigationStepChange(0)},onFrameworkChange(e){this.selectedFramework=e.value,e.value&&e.value.id&&(this.loadPolicies(e.value.id),this.selectedPolicy="",this.selectedSubPolicy="",this.policies=[],this.subPolicies=[])},onPolicyChange(e){this.selectedPolicy=e.value,e.value&&e.value.id&&(this.loadSubPolicies(e.value.id),this.selectedSubPolicy="",this.subPolicies=[],e.value.applicability&&this.complianceList.forEach(t=>{t.Applicability=e.value.applicability}))},onSubPolicyChange(e){this.selectedSubPolicy=e.value,e.value&&e.value.applicability&&this.complianceList.forEach(t=>{t.Applicability=e.value.applicability})},onReviewerChange(e){console.log("Reviewer changed to:",e.value)}}};const _4=(0,le.A)(P4,[["render",R4],["__scopeId","data-v-553eb436"]]);var A4=_4;const S4={class:"create-compliance-container"},T4={class:"compliance-header"},x4={class:"header-content"},F4={key:0,class:"message error-message"},V4={key:1,class:"message success-message"},U4={key:2,class:"loading-overlay"},N4={key:3,class:"compliance-item-form"},M4={class:"field-group"},X4={class:"row-fields"},$4={class:"compliance-field"},O4={class:"input-wrapper"},j4={key:0,class:"validation-indicator"},B4={key:0,class:"valid-icon"},W4={key:1,class:"invalid-icon"},q4={key:0,class:"field-error-message"},Q4={class:"compliance-field"},K4={class:"input-wrapper"},J4={key:0,class:"validation-indicator"},z4={key:0,class:"valid-icon"},H4={key:1,class:"invalid-icon"},G4={key:0,class:"field-error-message"},Y4={class:"compliance-field full-width"},Z4={class:"input-wrapper"},e8={key:0,class:"field-error-message"},t8={key:0,class:"validation-feedback"},i8={class:"validation-progress"},a8={class:"compliance-field full-width"},s8={class:"input-wrapper"},o8={key:0,class:"field-error-message"},l8={key:0,class:"validation-feedback"},n8={class:"validation-progress"},r8={class:"compliance-field full-width"},c8={class:"input-wrapper"},d8={key:0,class:"field-error-message"},u8={key:0,class:"validation-feedback"},p8={class:"validation-progress"},m8={class:"row-fields"},v8={class:"compliance-field"},k8={class:"searchable-dropdown"},h8={class:"dropdown-options"},g8={key:0,class:"dropdown-add-option"},y8=["onClick"],f8={key:0,class:"field-error-message"},b8={class:"compliance-field"},C8={key:0,class:"field-error-message"},L8={class:"compliance-field checkbox-container"},w8={style:{"font-weight":"500","font-size":"1rem",display:"flex","align-items":"center",gap:"8px"},title:"Check if this compliance item represents a risk"},E8={class:"field-group risk-fields"},R8={class:"compliance-field full-width"},I8={class:"input-wrapper"},D8=["required"],P8={key:0,class:"field-error-message"},_8={class:"compliance-field full-width"},A8={key:0,class:"required"},S8={class:"mitigation-steps"},T8={class:"step-header"},x8={class:"step-numberr"},F8=["onClick"],V8=["onUpdate:modelValue"],U8={key:0,class:"error-message"},N8={class:"compliance-field full-width"},M8={class:"input-wrapper"},X8={class:"char-count"},$8={key:0,class:"field-error-message"},O8={class:"row-fields"},j8={class:"compliance-field"},B8={class:"input-wrapper"},W8={key:0,class:"validation-indicator"},q8={key:0,class:"valid-icon"},Q8={key:1,class:"invalid-icon"},K8={key:0,class:"field-error-message"},J8={class:"compliance-field"},z8={class:"searchable-dropdown"},H8={class:"dropdown-options"},G8={key:0,class:"dropdown-add-option"},Y8=["onClick"],Z8={key:0,class:"validation-indicator"},e5={key:0,class:"valid-icon"},t5={key:1,class:"invalid-icon"},i5={key:0,class:"field-error-message"},a5={class:"compliance-field"},s5={class:"input-wrapper"},o5={class:"searchable-dropdown"},l5={key:0,class:"validation-indicator"},n5={key:0,class:"valid-icon"},r5={key:1,class:"invalid-icon"},c5={key:0,class:"field-error-message"},d5={class:"field-group classification-fields"},u5={class:"row-fields"},p5={class:"compliance-field"},m5={class:"input-wrapper"},v5={key:0,class:"validation-indicator"},k5={key:0,class:"valid-icon"},h5={key:1,class:"invalid-icon"},g5={key:0,class:"field-error-message"},y5={class:"compliance-field"},f5={key:0,class:"field-error-message"},b5={class:"row-fields"},C5={class:"compliance-field"},L5={key:0,class:"field-error-message"},w5={class:"compliance-field"},E5={key:0,class:"field-error-message"},R5={class:"row-fields"},I5={class:"compliance-field"},D5={key:0,class:"field-error-message"},P5={class:"compliance-field"},_5={key:0,class:"field-error-message"},A5={class:"row-fields"},S5={class:"compliance-field"},T5={key:0,class:"field-error-message"},x5={class:"compliance-field"},F5={key:0,class:"field-error-message"},V5={class:"field-group approval-fields"},U5={class:"row-fields"},N5={class:"compliance-field"},M5=["value"],X5={key:0,class:"field-error-message"},$5={class:"compliance-submit-container"},O5=["disabled"],j5={key:0},B5={key:1},W5=["disabled"];function q5(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",S4,[(0,s.Lk)("div",T4,[(0,s.Lk)("div",x4,[t[61]||(t[61]=(0,s.Lk)("div",{class:"header-text"},[(0,s.Lk)("h2",null,"Edit Compliance Record"),(0,s.Lk)("p",null,"Update compliance item details")],-1)),(0,s.Lk)("button",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>n.goBack&&n.goBack(...e)),title:"Go back to previous page"},t[60]||(t[60]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])]),l.error?((0,s.uX)(),(0,s.CE)("div",F4,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),l.successMessage?((0,s.uX)(),(0,s.CE)("div",V4,(0,d.v_)(l.successMessage),1)):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("div",U4,t[62]||(t[62]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("div",{class:"loading-text"},"Loading data...",-1)]))):(0,s.Q3)("",!0),l.compliance?((0,s.uX)(),(0,s.CE)("div",N4,[(0,s.Lk)("div",M4,[t[72]||(t[72]=(0,s.Lk)("div",{class:"field-group-title"},"Basic Information",-1)),(0,s.Lk)("div",X4,[(0,s.Lk)("div",$4,[t[63]||(t[63]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Title "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(3-145 characters)")],-1)),(0,s.Lk)("div",O4,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>l.compliance.ComplianceTitle=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceTitle,warning:n.showWarning("ComplianceTitle"),valid:n.isFieldValid("ComplianceTitle")}]),placeholder:"Enter compliance title",required:"",onInput:t[2]||(t[2]=e=>n.validateFieldRealTime("ComplianceTitle")),onBlur:t[3]||(t[3]=e=>n.validateField("ComplianceTitle")),title:"Enter the title of the compliance item",ref:"field_ComplianceTitle"},null,34),[[a.Jo,l.compliance.ComplianceTitle]]),l.compliance.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",j4,[n.isFieldValid("ComplianceTitle")?((0,s.uX)(),(0,s.CE)("span",B4,"✓")):((0,s.uX)(),(0,s.CE)("span",W4,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",q4,(0,d.v_)(l.validationErrors.ComplianceTitle),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Q4,[t[64]||(t[64]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Type "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Required)")],-1)),(0,s.Lk)("div",K4,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.compliance.ComplianceType=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceType,valid:n.isFieldValid("ComplianceType")}]),placeholder:"Enter compliance type",onInput:t[5]||(t[5]=e=>n.validateFieldRealTime("ComplianceType")),onBlur:t[6]||(t[6]=e=>n.validateField("ComplianceType")),title:"Type of compliance (e.g. Regulatory, Internal, Security)",ref:"field_ComplianceType"},null,34),[[a.Jo,l.compliance.ComplianceType]]),l.compliance.ComplianceType?((0,s.uX)(),(0,s.CE)("div",J4,[n.isFieldValid("ComplianceType")?((0,s.uX)(),(0,s.CE)("span",z4,"✓")):((0,s.uX)(),(0,s.CE)("span",H4,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.ComplianceType?((0,s.uX)(),(0,s.CE)("div",G4,(0,d.v_)(l.validationErrors.ComplianceType),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Y4,[t[65]||(t[65]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Description "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 10 characters)")],-1)),(0,s.Lk)("div",Z4,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.compliance.ComplianceItemDescription=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceItemDescription,warning:n.showWarning("ComplianceItemDescription"),valid:n.isFieldValid("ComplianceItemDescription")}]),placeholder:"Compliance Description",onInput:t[8]||(t[8]=e=>n.validateFieldRealTime("ComplianceItemDescription")),onBlur:t[9]||(t[9]=e=>n.validateField("ComplianceItemDescription")),required:"",rows:"3",title:"Detailed description of the compliance requirement",ref:"field_ComplianceItemDescription"},null,34),[[a.Jo,l.compliance.ComplianceItemDescription]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.ComplianceItemDescription}])},(0,d.v_)(l.compliance.ComplianceItemDescription?.length||0)+"/10 min characters ",3),l.validationErrors.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",e8,(0,d.v_)(l.validationErrors.ComplianceItemDescription),1)):(0,s.Q3)("",!0)]),l.compliance.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",t8,[(0,s.Lk)("div",i8,[(0,s.Lk)("div",{class:"progress-bar",style:(0,d.Tr)({width:n.getValidationProgress("ComplianceItemDescription")+"%",backgroundColor:n.getValidationColor("ComplianceItemDescription")})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["validation-message",{warning:n.showWarning("ComplianceItemDescription"),error:l.validationErrors.ComplianceItemDescription,success:n.isFieldValid("ComplianceItemDescription")}])},(0,d.v_)(n.getValidationMessage("ComplianceItemDescription")),3)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",a8,[t[66]||(t[66]=(0,s.Lk)("label",null,[(0,s.eW)(" Scope "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.Lk)("div",s8,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>l.compliance.Scope=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Scope,warning:n.showWarning("Scope"),valid:n.isFieldValid("Scope")}]),placeholder:"Define the scope of this compliance requirement",onInput:t[11]||(t[11]=e=>n.validateFieldRealTime("Scope")),onBlur:t[12]||(t[12]=e=>n.validateField("Scope")),rows:"3","data-field":"Scope",required:"",ref:"field_Scope"},null,34),[[a.Jo,l.compliance.Scope]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Scope,warning:n.showWarning("Scope")}])},(0,d.v_)(l.compliance.Scope?.length||0)+"/15 min characters ",3),l.validationErrors.Scope?((0,s.uX)(),(0,s.CE)("div",o8,(0,d.v_)(l.validationErrors.Scope),1)):(0,s.Q3)("",!0)]),l.compliance.Scope?((0,s.uX)(),(0,s.CE)("div",l8,[(0,s.Lk)("div",n8,[(0,s.Lk)("div",{class:"progress-bar",style:(0,d.Tr)({width:n.getValidationProgress("Scope")+"%",backgroundColor:n.getValidationColor("Scope")})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["validation-message",{warning:n.showWarning("Scope"),error:l.validationErrors.Scope,success:n.isFieldValid("Scope")}])},(0,d.v_)(n.getValidationMessage("Scope")),3)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",r8,[t[67]||(t[67]=(0,s.Lk)("label",null,[(0,s.eW)(" Objective "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.Lk)("div",c8,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[13]||(t[13]=e=>l.compliance.Objective=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Objective,warning:n.showWarning("Objective"),valid:n.isFieldValid("Objective")}]),placeholder:"Define the objective of this compliance requirement",onInput:t[14]||(t[14]=e=>n.validateFieldRealTime("Objective")),onBlur:t[15]||(t[15]=e=>n.validateField("Objective")),rows:"3","data-field":"Objective",required:"",ref:"field_Objective"},null,34),[[a.Jo,l.compliance.Objective]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Objective,warning:n.showWarning("Objective")}])},(0,d.v_)(l.compliance.Objective?.length||0)+"/15 min characters ",3),l.validationErrors.Objective?((0,s.uX)(),(0,s.CE)("div",d8,(0,d.v_)(l.validationErrors.Objective),1)):(0,s.Q3)("",!0)]),l.compliance.Objective?((0,s.uX)(),(0,s.CE)("div",u8,[(0,s.Lk)("div",p8,[(0,s.Lk)("div",{class:"progress-bar",style:(0,d.Tr)({width:n.getValidationProgress("Objective")+"%",backgroundColor:n.getValidationColor("Objective")})},null,4)]),(0,s.Lk)("span",{class:(0,d.C4)(["validation-message",{warning:n.showWarning("Objective"),error:l.validationErrors.Objective,success:n.isFieldValid("Objective")}])},(0,d.v_)(n.getValidationMessage("Objective")),3)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",m8,[(0,s.Lk)("div",v8,[t[69]||(t[69]=(0,s.Lk)("label",null,"Business Units Covered",-1)),(0,s.Lk)("div",k8,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>l.businessUnitSearch=e),class:"compliance-input",placeholder:"Search or add business units",title:"Departments or business units affected by this compliance",onFocus:t[17]||(t[17]=e=>n.showDropdown("BusinessUnitsCovered")),onInput:t[18]||(t[18]=e=>n.filterOptions("BusinessUnitsCovered")),ref:"field_BusinessUnitsCovered"},null,544),[[a.Jo,l.businessUnitSearch]]),(0,s.bo)((0,s.Lk)("div",h8,[0===l.filteredOptions.BusinessUnitsCovered.length&&l.businessUnitSearch?((0,s.uX)(),(0,s.CE)("div",g8,[t[68]||(t[68]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:t[19]||(t[19]=e=>n.addNewOption("BusinessUnitsCovered",l.businessUnitSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.businessUnitSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.BusinessUnitsCovered,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption("BusinessUnitsCovered",e.value)},(0,d.v_)(e.value),9,y8))),128))],512),[[a.aG,"BusinessUnitsCovered"===l.activeDropdown]])]),l.validationErrors.BusinessUnitsCovered?((0,s.uX)(),(0,s.CE)("div",f8,(0,d.v_)(l.validationErrors.BusinessUnitsCovered),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",b8,[t[70]||(t[70]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[20]||(t[20]=e=>l.compliance.Identifier=e),class:"compliance-input",placeholder:"Auto-generated if left empty",title:"Unique identifier for this compliance item",disabled:"",ref:"field_Identifier"},null,512),[[a.Jo,l.compliance.Identifier]]),l.validationErrors.Identifier?((0,s.uX)(),(0,s.CE)("div",C8,(0,d.v_)(l.validationErrors.Identifier),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",L8,[(0,s.Lk)("label",w8,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[21]||(t[21]=e=>l.compliance.IsRisk=e),style:{"margin-right":"8px",width:"auto"}},null,512),[[a.lH,l.compliance.IsRisk]]),t[71]||(t[71]=(0,s.eW)(" Is Risk "))])])])]),(0,s.Lk)("div",E8,[t[83]||(t[83]=(0,s.Lk)("div",{class:"field-group-title"},"Risk Information",-1)),(0,s.Lk)("div",R8,[t[73]||(t[73]=(0,s.Lk)("label",null,[(0,s.eW)(" Possible Impact "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 10 characters)")],-1)),(0,s.Lk)("div",I8,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[22]||(t[22]=e=>l.compliance.PossibleDamage=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.PossibleDamage,warning:n.showWarning("PossibleDamage"),valid:n.isFieldValid("PossibleDamage")}]),placeholder:"Describe possible damage",onInput:t[23]||(t[23]=e=>n.validateFieldRealTime("PossibleDamage")),onBlur:t[24]||(t[24]=e=>n.validateField("PossibleDamage")),rows:"3",required:l.compliance.IsRisk,ref:"field_PossibleDamage"},null,42,D8),[[a.Jo,l.compliance.PossibleDamage]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.PossibleDamage}])},(0,d.v_)(l.compliance.PossibleDamage?.length||0)+"/10 min characters ",3),l.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",P8,(0,d.v_)(l.validationErrors.PossibleDamage),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",_8,[(0,s.Lk)("label",null,[t[74]||(t[74]=(0,s.eW)(" Mitigation Steps ")),l.compliance.IsRisk?((0,s.uX)(),(0,s.CE)("span",A8,"*")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",S8,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"mitigation-step"},[(0,s.Lk)("div",T8,[(0,s.Lk)("span",x8,"Step "+(0,d.v_)(i+1),1),(0,s.Lk)("button",{type:"button",class:"remove-step-btn",onClick:e=>n.removeStep(i),title:"Remove this step"},t[75]||(t[75]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,F8)]),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.description=t,onInput:t[25]||(t[25]=(...e)=>n.onMitigationStepChange&&n.onMitigationStepChange(...e)),onBlur:t[26]||(t[26]=(...e)=>n.onMitigationStepChange&&n.onMitigationStepChange(...e)),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.mitigation,valid:n.isFieldValid("mitigation")}]),placeholder:"Describe this mitigation step",rows:"2",required:""},null,42,V8),[[a.Jo,e.description]])]))),128)),(0,s.Lk)("button",{type:"button",class:"add-step-btn",onClick:t[27]||(t[27]=(...e)=>n.addStep&&n.addStep(...e)),title:"Add new mitigation step"},t[76]||(t[76]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Step ")]))]),l.validationErrors.mitigation?((0,s.uX)(),(0,s.CE)("div",U8,(0,d.v_)(l.validationErrors.mitigation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",N8,[t[77]||(t[77]=(0,s.Lk)("label",null,[(0,s.eW)(" Potential Risk Scenarios "),(0,s.Lk)("span",{class:"field-requirements"},"(Recommended: 20+ characters)")],-1)),(0,s.Lk)("div",M8,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[28]||(t[28]=e=>l.compliance.PotentialRiskScenarios=e),class:(0,d.C4)(["compliance-input",{warning:n.showWarning("PotentialRiskScenarios"),valid:n.isFieldValid("PotentialRiskScenarios")}]),placeholder:"Describe potential risk scenarios",onInput:t[29]||(t[29]=e=>n.validateFieldRealTime("PotentialRiskScenarios")),onBlur:t[30]||(t[30]=e=>n.validateField("PotentialRiskScenarios")),rows:"3",ref:"field_PotentialRiskScenarios"},null,34),[[a.Jo,l.compliance.PotentialRiskScenarios]]),(0,s.Lk)("div",X8,(0,d.v_)(l.compliance.PotentialRiskScenarios?.length||0)+" characters ",1),l.validationErrors.PotentialRiskScenarios?((0,s.uX)(),(0,s.CE)("div",$8,(0,d.v_)(l.validationErrors.PotentialRiskScenarios),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",O8,[(0,s.Lk)("div",j8,[t[79]||(t[79]=(0,s.Lk)("label",null,[(0,s.eW)(" Risk Type "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",B8,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[31]||(t[31]=e=>l.compliance.RiskType=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.RiskType,valid:n.isFieldValid("RiskType")}]),onChange:t[32]||(t[32]=e=>n.validateFieldRealTime("RiskType")),onBlur:t[33]||(t[33]=e=>n.validateField("RiskType")),ref:"field_RiskType"},t[78]||(t[78]=[(0,s.Fv)('<option value="" data-v-5fe46ce9>Select Risk Type</option><option value="Current" data-v-5fe46ce9>Current</option><option value="Residual" data-v-5fe46ce9>Residual</option><option value="Inherent" data-v-5fe46ce9>Inherent</option><option value="Emerging" data-v-5fe46ce9>Emerging</option><option value="Accepted" data-v-5fe46ce9>Accepted</option>',6)]),34),[[a.u1,l.compliance.RiskType]]),l.compliance.RiskType?((0,s.uX)(),(0,s.CE)("div",W8,[n.isFieldValid("RiskType")?((0,s.uX)(),(0,s.CE)("span",q8,"✓")):((0,s.uX)(),(0,s.CE)("span",Q8,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("div",K8,(0,d.v_)(l.validationErrors.RiskType),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",J8,[t[81]||(t[81]=(0,s.Lk)("label",null,[(0,s.eW)(" Risk Category "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",z8,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[34]||(t[34]=e=>l.riskCategorySearch=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.RiskCategory,valid:n.isFieldValid("RiskCategory")}]),placeholder:"Search or add risk category",onFocus:t[35]||(t[35]=e=>n.showDropdown("RiskCategory")),onInput:t[36]||(t[36]=e=>n.filterOptions("RiskCategory")),ref:"field_RiskCategory"},null,34),[[a.Jo,l.riskCategorySearch]]),(0,s.bo)((0,s.Lk)("div",H8,[0===l.filteredOptions.RiskCategory.length&&l.riskCategorySearch?((0,s.uX)(),(0,s.CE)("div",G8,[t[80]||(t[80]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:t[37]||(t[37]=e=>n.addNewOption("RiskCategory",l.riskCategorySearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskCategorySearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskCategory,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption("RiskCategory",e.value)},(0,d.v_)(e.value),9,Y8))),128))],512),[[a.aG,"RiskCategory"===l.activeDropdown]]),l.compliance.RiskCategory?((0,s.uX)(),(0,s.CE)("div",Z8,[n.isFieldValid("RiskCategory")?((0,s.uX)(),(0,s.CE)("span",e5,"✓")):((0,s.uX)(),(0,s.CE)("span",t5,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.RiskCategory?((0,s.uX)(),(0,s.CE)("div",i5,(0,d.v_)(l.validationErrors.RiskCategory),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",a5,[t[82]||(t[82]=(0,s.Lk)("label",null,[(0,s.eW)(" Risk Business Impact "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",s5,[(0,s.Lk)("div",o5,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[38]||(t[38]=e=>l.riskBusinessImpactSearch=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.RiskBusinessImpact,valid:n.isFieldValid("RiskBusinessImpact")}]),placeholder:"Search or add business impact",onInput:t[39]||(t[39]=e=>n.validateFieldRealTime("RiskBusinessImpact")),onBlur:t[40]||(t[40]=e=>n.validateField("RiskBusinessImpact")),ref:"field_RiskBusinessImpact"},null,34),[[a.Jo,l.riskBusinessImpactSearch]]),l.compliance.RiskBusinessImpact?((0,s.uX)(),(0,s.CE)("div",l5,[n.isFieldValid("RiskBusinessImpact")?((0,s.uX)(),(0,s.CE)("span",n5,"✓")):((0,s.uX)(),(0,s.CE)("span",r5,"!"))])):(0,s.Q3)("",!0)])]),l.validationErrors.RiskBusinessImpact?((0,s.uX)(),(0,s.CE)("div",c5,(0,d.v_)(l.validationErrors.RiskBusinessImpact),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",d5,[t[97]||(t[97]=(0,s.Lk)("div",{class:"field-group-title"},"Classification",-1)),(0,s.Lk)("div",u5,[(0,s.Lk)("div",p5,[t[85]||(t[85]=(0,s.Lk)("label",null,[(0,s.eW)(" Criticality "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.Lk)("div",m5,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[41]||(t[41]=e=>l.compliance.Criticality=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.Criticality,valid:n.isFieldValid("Criticality")}]),onChange:t[42]||(t[42]=e=>n.validateFieldRealTime("Criticality")),onBlur:t[43]||(t[43]=e=>n.validateField("Criticality")),required:"",ref:"field_Criticality"},t[84]||(t[84]=[(0,s.Lk)("option",{value:""},"Select Criticality",-1),(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),34),[[a.u1,l.compliance.Criticality]]),l.compliance.Criticality?((0,s.uX)(),(0,s.CE)("div",v5,[n.isFieldValid("Criticality")?((0,s.uX)(),(0,s.CE)("span",k5,"✓")):((0,s.uX)(),(0,s.CE)("span",h5,"!"))])):(0,s.Q3)("",!0)]),l.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("div",g5,(0,d.v_)(l.validationErrors.Criticality),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",y5,[t[87]||(t[87]=(0,s.Lk)("label",null," Mandatory/Optional ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[44]||(t[44]=e=>l.compliance.MandatoryOptional=e),class:"compliance-select",required:"",title:"Whether this compliance item is mandatory or optional",ref:"field_MandatoryOptional"},t[86]||(t[86]=[(0,s.Lk)("option",{value:"Mandatory"},"Mandatory",-1),(0,s.Lk)("option",{value:"Optional"},"Optional",-1)]),512),[[a.u1,l.compliance.MandatoryOptional]]),l.validationErrors.MandatoryOptional?((0,s.uX)(),(0,s.CE)("div",f5,(0,d.v_)(l.validationErrors.MandatoryOptional),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",b5,[(0,s.Lk)("div",C5,[t[89]||(t[89]=(0,s.Lk)("label",null," Manual/Automatic ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[45]||(t[45]=e=>l.compliance.ManualAutomatic=e),class:"compliance-select",required:"",title:"Whether this compliance is checked manually or automatically",ref:"field_ManualAutomatic"},t[88]||(t[88]=[(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Automatic"},"Automatic",-1)]),512),[[a.u1,l.compliance.ManualAutomatic]]),l.validationErrors.ManualAutomatic?((0,s.uX)(),(0,s.CE)("div",L5,(0,d.v_)(l.validationErrors.ManualAutomatic),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",w5,[t[90]||(t[90]=(0,s.Lk)("label",null," Applicability ",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[46]||(t[46]=e=>l.compliance.Applicability=e),class:"compliance-input",placeholder:"Applicability from policy",title:"Describes where this compliance item applies",ref:"field_Applicability"},null,512),[[a.Jo,l.compliance.Applicability]]),l.validationErrors.Applicability?((0,s.uX)(),(0,s.CE)("div",E5,(0,d.v_)(l.validationErrors.Applicability),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",R5,[(0,s.Lk)("div",I5,[t[91]||(t[91]=(0,s.Lk)("label",null,[(0,s.eW)(" Impact "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(0-10)")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[47]||(t[47]=e=>l.compliance.Impact=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Impact}]),step:"0.1",min:"0",max:"10",onInput:t[48]||(t[48]=e=>n.validateFieldRealTime("Impact")),onBlur:t[49]||(t[49]=e=>n.validateField("Impact")),required:"",ref:"field_Impact"},null,34),[[a.Jo,l.compliance.Impact]]),l.validationErrors.Impact?((0,s.uX)(),(0,s.CE)("div",D5,(0,d.v_)(l.validationErrors.Impact),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",P5,[t[92]||(t[92]=(0,s.Lk)("label",null,[(0,s.eW)(" Probability "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(0-10)")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[50]||(t[50]=e=>l.compliance.Probability=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Probability}]),step:"0.1",min:"0",max:"10",onInput:t[51]||(t[51]=e=>n.validateFieldRealTime("Probability")),onBlur:t[52]||(t[52]=e=>n.validateField("Probability")),required:"",ref:"field_Probability"},null,34),[[a.Jo,l.compliance.Probability]]),l.validationErrors.Probability?((0,s.uX)(),(0,s.CE)("div",_5,(0,d.v_)(l.validationErrors.Probability),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",A5,[(0,s.Lk)("div",S5,[t[94]||(t[94]=(0,s.Lk)("label",null," Maturity Level ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[53]||(t[53]=e=>l.compliance.MaturityLevel=e),class:"compliance-select",title:"Current maturity level of this compliance item",ref:"field_MaturityLevel"},t[93]||(t[93]=[(0,s.Lk)("option",null,"Initial",-1),(0,s.Lk)("option",null,"Developing",-1),(0,s.Lk)("option",null,"Defined",-1),(0,s.Lk)("option",null,"Managed",-1),(0,s.Lk)("option",null,"Optimizing",-1)]),512),[[a.u1,l.compliance.MaturityLevel]]),l.validationErrors.MaturityLevel?((0,s.uX)(),(0,s.CE)("div",T5,(0,d.v_)(l.validationErrors.MaturityLevel),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",x5,[t[96]||(t[96]=(0,s.Lk)("label",null," Version Type ",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[54]||(t[54]=e=>l.compliance.versionType=e),class:"compliance-select",required:"",title:"Type of version change",ref:"field_versionType",onChange:t[55]||(t[55]=(...e)=>n.handleVersionTypeChange&&n.handleVersionTypeChange(...e))},t[95]||(t[95]=[(0,s.Lk)("option",{value:"Major"},"Major",-1),(0,s.Lk)("option",{value:"Minor"},"Minor",-1)]),544),[[a.u1,l.compliance.versionType]]),l.validationErrors.versionType?((0,s.uX)(),(0,s.CE)("div",F5,(0,d.v_)(l.validationErrors.versionType),1)):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",V5,[t[100]||(t[100]=(0,s.Lk)("div",{class:"field-group-title"},"Approval Information",-1)),(0,s.Lk)("div",U5,[(0,s.Lk)("div",N5,[t[99]||(t[99]=(0,s.Lk)("label",null,[(0,s.eW)("Assign Reviewer "),(0,s.Lk)("span",{class:"required"},"*")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[56]||(t[56]=e=>l.compliance.reviewer_id=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.reviewer_id}]),onChange:t[57]||(t[57]=e=>n.validateField("reviewer_id")),required:"",title:"Person responsible for reviewing this compliance item",ref:"field_reviewer_id"},[t[98]||(t[98]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName)+" "+(0,d.v_)(e.email?`(${e.email})`:""),9,M5))),128))],34),[[a.u1,l.compliance.reviewer_id]]),l.validationErrors.reviewer_id?((0,s.uX)(),(0,s.CE)("div",X5,(0,d.v_)(l.validationErrors.reviewer_id),1)):(0,s.Q3)("",!0)])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",$5,[(0,s.Lk)("button",{class:"compliance-submit-btn",onClick:t[58]||(t[58]=(...e)=>n.validateAndSubmit&&n.validateAndSubmit(...e)),disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("span",j5,"Saving...")):((0,s.uX)(),(0,s.CE)("span",B5,"Save as New Version"))],8,O5),(0,s.Lk)("button",{class:"compliance-cancel-btn",onClick:t[59]||(t[59]=(...e)=>n.cancelEdit&&n.cancelEdit(...e)),disabled:l.loading}," Cancel ",8,W5)])])}var Q5={name:"EditCompliance",data(){return{compliance:null,users:[],loading:!1,error:null,successMessage:null,impactError:!1,probabilityError:!1,originalComplianceId:null,categoryOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},filteredOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},businessUnitSearch:"",riskTypeSearch:"",riskCategorySearch:"",riskBusinessImpactSearch:"",activeDropdown:null,validationErrors:{},validationRules:{ComplianceTitle:[{required:!0,message:"Compliance Title is required"},{minLength:3,message:"Title must be at least 3 characters"},{maxLength:145,message:"Title cannot exceed 145 characters"}],ComplianceType:[{required:!0,message:"Compliance Type is required"}],ComplianceItemDescription:[{required:!0,message:"Description is required"},{minLength:10,message:"Description must be at least 10 characters"}],Scope:[{required:!0,message:"Scope is required"},{minLength:15,message:"Scope must be at least 15 characters"}],Objective:[{required:!0,message:"Objective is required"},{minLength:15,message:"Objective must be at least 15 characters"}],BusinessUnitsCovered:[{required:!0,message:"Business Units Covered is required"}],Criticality:[{required:!0,message:"Criticality is required"}],Impact:[{required:!0,message:"Impact is required"},{min:0,max:10,message:"Impact must be between 0 and 10"}],Probability:[{required:!0,message:"Probability is required"},{min:0,max:10,message:"Probability must be between 0 and 10"}],reviewer_id:[{required:!0,message:"Reviewer is required"}],PossibleDamage:[{required:!0,message:"Possible Damage is required for risks"},{minLength:10,message:"Possible Damage must be at least 10 characters"}],RiskType:[{required:!0,message:"Risk Type is required for risks"}],RiskCategory:[{required:!0,message:"Risk Category is required for risks"}],RiskBusinessImpact:[{required:!0,message:"Risk Business Impact is required for risks"}],mitigation:[{required:!0,message:"At least one mitigation step is required for risks",validate:e=>{if(!this.compliance?.IsRisk)return!0;if(this.mitigationSteps&&this.mitigationSteps.length>0){const e=this.mitigationSteps.some(e=>e.description&&e.description.trim().length>0);if(e)return!0}return!!e&&("object"===typeof e?Object.values(e).some(e=>e&&e.trim().length>0):"string"===typeof e&&e.trim().length>0)}}]},fieldStates:{},mitigationSteps:[{description:""}]}},watch:{"compliance.versionType":{handler(e){console.log("Version type changed to:",e)},immediate:!0}},async created(){const e=this.$route.params.id;e?(this.originalComplianceId=e,await this.loadUsers(),await this.loadComplianceData(e),await this.loadCategoryOptions(),document.addEventListener("click",this.handleClickOutside)):this.error="No compliance ID provided"},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{handleVersionTypeChange(e){const t=e.target.value;console.log("Version type changed to:",t),this.compliance.versionType=t},async loadComplianceData(e){try{this.loading=!0;const t=await I4.fv.getComplianceById(e);if(t.data&&t.data.success){const e=t.data.data.versionType||"Minor";this.compliance={...t.data.data,versionType:e},console.log("Initialized version type as:",e),!this.compliance.reviewer_id&&this.users.length>0&&(this.compliance.reviewer_id=this.users[0].UserId),this.businessUnitSearch=this.compliance.BusinessUnitsCovered||"",this.riskTypeSearch=this.compliance.RiskType||"",this.riskCategorySearch=this.compliance.RiskCategory||"",this.riskBusinessImpactSearch=this.compliance.RiskBusinessImpact||"",this.filteredOptions={BusinessUnitsCovered:this.categoryOptions.BusinessUnitsCovered||[],RiskType:this.categoryOptions.RiskType||[],RiskCategory:this.categoryOptions.RiskCategory||[],RiskBusinessImpact:this.categoryOptions.RiskBusinessImpact||[]},console.log("Received mitigation data:",this.compliance.mitigation),this.mitigationSteps=this.parseMitigationSteps(this.compliance.mitigation),console.log("Parsed mitigation steps:",this.mitigationSteps)}else this.error="Failed to load compliance data"}catch(t){if(t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showEditComplianceDenied();console.error("Error loading compliance:",t),this.error="Failed to load compliance data. Please try again."}finally{this.loading=!1}},async loadUsers(){try{this.loading=!0;const e=await I4.fv.getUsers();e.data.success&&Array.isArray(e.data.users)?this.users=e.data.users:(console.error("Invalid users data received:",e.data),this.error="Failed to load approvers")}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showEditComplianceDenied();console.error("Failed to load users:",e),this.error="Failed to load approvers. Please try again."}finally{this.loading=!1}},validateImpact(e){const t=parseFloat(e.target.value);this.impactError=t<1||t>10},validateProbability(e){const t=parseFloat(e.target.value);this.probabilityError=t<1||t>10},getDefaultDueDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},validateField(e){if(!this.compliance)return!0;const t=this.compliance[e],i=this.validationRules[e];if(!i||!Array.isArray(i))return!0;if(this.validationErrors[e]="",!i.find(e=>e.required)&&!t)return!0;if("PossibleDamage"===e&&!this.compliance.IsRisk)return!0;for(const a of i){if(a.validate&&"function"===typeof a.validate&&!a.validate(t))return this.validationErrors[e]=a.message,!1;if(a.required&&(!t||""===t.toString().trim()))return this.validationErrors[e]=a.message,!1;if(a.minLength&&t&&t.length<a.minLength)return this.validationErrors[e]=a.message,!1;if(a.maxLength&&t&&t.length>a.maxLength)return this.validationErrors[e]=a.message,!1;if((void 0!==a.min||void 0!==a.max)&&t){const i=parseFloat(t);if(isNaN(i)||i<a.min||i>a.max)return this.validationErrors[e]=a.message,!1}}return!0},validateAllFields(){let e=!0,t=null;for(const i in this.validationRules)this.validateField(i)||(e=!1,t||(t=i));if(t){const e=document.querySelector(`[data-field="${t}"]`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}return e},async submitEdit(){if(this.error=null,this.successMessage=null,this.validateAllFields())try{this.loading=!0;const e=this.compliance.versionType;if(console.log("Submitting with version type:",e),!e||!["Major","Minor"].includes(e))return void(this.error="Please select a valid version type (Major or Minor)");const t=this.compliance.ComplianceVersion||"1.0";let i;if("Major"===e){const[e]=t.split(".");i=`${parseInt(e)+1}.0`}else{const[e,a]=t.split(".");i=`${e}.${(parseInt(a)||0)+1}`}console.log("Current version:",t),console.log("New version:",i);let a={};this.compliance.IsRisk&&this.mitigationSteps&&this.mitigationSteps.length>0&&this.mitigationSteps.forEach((e,t)=>{e.description&&e.description.trim()&&(a[`${t+1}`]=e.description.trim())}),console.log("DEBUG: Mitigation steps array:",this.mitigationSteps),console.log("DEBUG: Processed mitigation data for submission:",a);const s={...this.compliance,ComplianceVersion:i,Status:"Under Review",ActiveInactive:"Active",PreviousComplianceVersionId:this.originalComplianceId,mitigation:a,user_id:"1",versionType:this.compliance.versionType};console.log("DEBUG: Complete edit data being sent:",s),console.log("DEBUG: Mitigation in edit data:",s.mitigation);const o=await I4.fv.updateCompliance(this.originalComplianceId,s);o.data&&o.data.success?(D4.complianceUpdated({ComplianceId:o.data.compliance_id||this.originalComplianceId,ComplianceVersion:i,ComplianceItemDescription:this.compliance.ComplianceItemDescription}),setTimeout(()=>{this.$router.push("/compliance/tailoring")},1500)):this.error=o.data.message||"Failed to update compliance"}catch(e){console.error("Error updating compliance:",e),this.error="Failed to update compliance. Please try again."}finally{this.loading=!1}else this.error="Please fill in all required fields with valid information"},goBack(){this.$router.go(-1)},cancelEdit(){confirm("Are you sure you want to cancel editing? Any unsaved changes will be lost.")&&this.$router.push("/compliance/tailoring")},async loadCategoryOptions(){try{this.loading=!0;const e=await I4.fv.getCategoryBusinessUnits("BusinessUnitsCovered");e.data.success&&(this.categoryOptions.BusinessUnitsCovered=e.data.data);const t=await I4.fv.getCategoryBusinessUnits("RiskType");t.data.success&&(this.categoryOptions.RiskType=t.data.data);const i=await I4.fv.getCategoryBusinessUnits("RiskCategory");i.data.success&&(this.categoryOptions.RiskCategory=i.data.data);const a=await I4.fv.getCategoryBusinessUnits("RiskBusinessImpact");a.data.success&&(this.categoryOptions.RiskBusinessImpact=a.data.data)}catch(e){console.error("Failed to load category options:",e),this.error="Failed to load dropdown options. Some features may be limited."}finally{this.loading=!1}},showDropdown(e){this.activeDropdown=e,this.filterOptions(e),event.stopPropagation()},handleClickOutside(e){const t=document.querySelectorAll(".searchable-dropdown");let i=!0;t.forEach(t=>{t.contains(e.target)&&(i=!1)}),i&&(this.activeDropdown=null)},filterOptions(e){let t="";switch(e){case"BusinessUnitsCovered":t=this.businessUnitSearch||"";break;case"RiskType":t=this.riskTypeSearch||"";break;case"RiskCategory":t=this.riskCategorySearch||"";break;case"RiskBusinessImpact":t=this.riskBusinessImpactSearch||"";break}const i=t.toLowerCase();this.filteredOptions[e]=this.categoryOptions[e].filter(e=>e.value.toLowerCase().includes(i))},selectOption(e,t){switch(this.compliance[e]=t,e){case"BusinessUnitsCovered":this.businessUnitSearch=t;break;case"RiskType":this.riskTypeSearch=t;break;case"RiskCategory":this.riskCategorySearch=t;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch=t;break}this.activeDropdown=null},async addNewOption(e,t){if(t&&t.trim())try{const i=await I4.fv.addCategoryBusinessUnit({source:e,value:t.trim()});if(!i.data.success)throw new Error(i.data.error||"Failed to add new option");{const a=i.data.data;this.categoryOptions[e].push({id:a.id,value:a.value}),this.selectOption(e,t),this.successMessage=`Added new ${e} option: ${t}`,await this.loadCategoryOptions()}}catch(i){console.error(`Failed to add new ${e} option:`,i),this.error=`Failed to add new option: ${i.message||i}`}},validateFieldRealTime(e){if(!this.compliance)return!0;const t=this.compliance[e],i=this.validationRules[e];if(!i||!Array.isArray(i))return!0;if(this.fieldStates[e]||(this.fieldStates[e]={dirty:!1,valid:!1,warning:!1}),this.fieldStates[e].dirty=!0,!i.find(e=>e.required)&&!t)return this.validationErrors[e]="",this.fieldStates[e].valid=!0,this.fieldStates[e].warning=!1,!0;let a=!0,s=!1;for(const o of i){if(o.validate&&"function"===typeof o.validate&&!o.validate(t)){a=!1,this.validationErrors[e]=o.message;break}if(o.required&&(!t||""===t.toString().trim())){a=!1,this.validationErrors[e]=o.message;break}if(o.minLength&&t&&t.length<o.minLength&&(a=!1,t.length>0&&(s=!0,this.validationErrors[e]=`Need ${o.minLength-t.length} more characters`)),("Impact"===e||"Probability"===e)&&""!==t){const i=parseFloat(t);isNaN(i)?(a=!1,this.validationErrors[e]="Must be a valid number"):(i<o.min||i>o.max)&&(a=!1,this.validationErrors[e]=`Must be between ${o.min} and ${o.max}`)}}return this.fieldStates[e].valid=a,this.fieldStates[e].warning=s,a&&(this.validationErrors[e]=""),a},isFieldValid(e){return this.fieldStates[e]?.valid||!1},showWarning(e){return this.fieldStates[e]?.warning||!1},getValidationProgress(e){if(!this.compliance)return 0;const t=this.compliance[e],i=this.validationRules[e];if(!t||!i||!Array.isArray(i))return 0;if(["Impact","Probability"].includes(e)){const e=parseFloat(t);return isNaN(e)?0:(e-1)/9*100}if(["Criticality","MaturityLevel","MandatoryOptional","ManualAutomatic"].includes(e))return t?100:0;const a=i.find(e=>e.minLength);if(a){const e=t.length/a.minLength*100;return Math.min(e,100)}return t?100:0},getValidationColor(e){const t=this.getValidationProgress(e);return t<50?"#dc2626":t<100?"#f59e0b":"#10b981"},getValidationMessage(e){if(!this.compliance)return"";const t=this.compliance[e],i=this.validationRules[e];if(!i||!Array.isArray(i))return"";if(!t){const e=i.find(e=>e.required);return e?e.message:""}if(this.validationErrors[e])return this.validationErrors[e];const a=i.find(e=>e.minLength);if(a&&t.length<a.minLength){const e=a.minLength-t.length;return`Need ${e} more character${1===e?"":"s"}`}const s=i.find(e=>e.maxLength);if(s&&t.length>s.maxLength){const e=t.length-s.maxLength;return`Exceeds maximum length by ${e} character${1===e?"":"s"}`}const o=i.find(e=>void 0!==e.min||void 0!==e.max);if(o){const e=parseFloat(t);if(isNaN(e))return"Please enter a valid number";if(e<o.min)return`Minimum value is ${o.min}`;if(e>o.max)return`Maximum value is ${o.max}`}return this.isFieldValid(e)?"Looks good!":""},scrollToError(){const e=Object.keys(this.validationErrors);if(e.length>0){const t=e[0],i=this.$refs[`field_${t}`];i&&(i.scrollIntoView({behavior:"smooth",block:"center"}),i.focus())}},validateAndSubmit(){this.validationErrors={};let e=!0;Object.keys(this.validationRules).forEach(t=>{this.validateField(t)||(e=!1)}),e?this.submitForm():this.$nextTick(()=>{this.scrollToError()})},submitForm(){if(this.compliance.IsRisk&&this.mitigationSteps.length>0){const e={};this.mitigationSteps.forEach((t,i)=>{t.description&&t.description.trim()&&(e[`${i+1}`]=t.description.trim())}),Object.keys(e).length>0?this.compliance.mitigation=e:this.compliance.mitigation={1:"No mitigation steps provided"},console.log("submitForm - Mitigation steps:",this.mitigationSteps),console.log("submitForm - Submitting mitigation data:",JSON.stringify(this.compliance.mitigation,null,2))}else this.compliance.IsRisk||(this.compliance.mitigation={},console.log("submitForm - Not a risk, setting empty mitigation"));this.submitEdit()},addStep(){this.mitigationSteps.push({description:""}),console.log("addStep - Added new step, total steps:",this.mitigationSteps.length),this.onMitigationStepChange()},removeStep(e){this.mitigationSteps.length>1&&(this.mitigationSteps.splice(e,1),console.log("removeStep - Removed step at index",e,", remaining steps:",this.mitigationSteps.length),this.onMitigationStepChange())},onMitigationStepChange(){const e={};this.mitigationSteps.forEach((t,i)=>{t.description&&t.description.trim()&&(e[`${i+1}`]=t.description.trim())}),this.compliance.mitigation=e,console.log("onMitigationStepChange - Current mitigation steps:",this.mitigationSteps),console.log("onMitigationStepChange - Formatted mitigation JSON:",JSON.stringify(e,null,2)),console.log("onMitigationStepChange - Compliance.mitigation:",this.compliance.mitigation),this.validateField("mitigation")},parseMitigationSteps(e){if(console.log("Parsing mitigation steps from:",e,"Type:",typeof e),!e||0===Object.keys(e).length)return[{description:""}];try{if("string"===typeof e)try{e=JSON.parse(e)}catch(t){return console.error("Error parsing mitigation JSON:",t),[{description:""}]}if("object"===typeof e&&!Array.isArray(e)){const t=Object.entries(e).sort(([e],[t])=>parseInt(e)-parseInt(t)).map(([,e])=>({description:e&&"string"===typeof e?e.trim():""})).filter(e=>e.description);return t.length>0?t:[{description:""}]}}catch(i){console.error("Error parsing mitigation steps:",i)}return[{description:""}]}}};const K5=(0,le.A)(Q5,[["render",q5],["__scopeId","data-v-5fe46ce9"]]);var J5=K5;const z5={class:"copy-compliance-page"},H5={class:"page-header"},G5={class:"header-content"},Y5={class:"header-main"},Z5={class:"page-content"},e6={class:"content-container"},t6={key:0,class:"message success-message"},i6={key:1,class:"loading-overlay"},a6={key:2,class:"message error-message"},s6={class:"field-group selection-fields"},o6={class:"row-fields"},l6={class:"compliance-field"},n6=["value"],r6={key:0,class:"field-error-message"},c6={class:"compliance-field"},d6=["disabled"],u6=["value"],p6={key:0,class:"field-error-message"},m6={class:"compliance-field"},v6=["disabled"],k6=["value"],h6={key:0,class:"field-error-message"},g6={key:3,class:"compliance-item-form"},y6={class:"field-group"},f6={class:"row-fields"},b6={class:"compliance-field"},C6={key:0,class:"field-error-message"},L6={class:"compliance-field"},w6={class:"compliance-field full-width"},E6={key:0,class:"field-error-message"},R6={class:"compliance-field full-width"},I6={key:0,class:"field-error-message"},D6={class:"compliance-field full-width"},P6={key:0,class:"field-error-message"},_6={class:"row-fields"},A6={class:"compliance-field"},S6={class:"searchable-dropdown"},T6={class:"dropdown-options"},x6={key:0,class:"dropdown-add-option"},F6=["onClick"],V6={class:"compliance-field"},U6={class:"compliance-field checkbox-container"},N6={style:{"font-weight":"500","font-size":"1rem",display:"flex","align-items":"center",gap:"8px"},title:"Check if this compliance item represents a risk"},M6={key:0,class:"field-group risk-fields"},X6={class:"compliance-field full-width"},$6={key:0,class:"field-error-message"},O6={class:"compliance-field full-width"},j6={key:0,class:"field-error-message"},B6={class:"compliance-field full-width"},W6={key:0,class:"field-error-message"},q6={class:"row-fields"},Q6={class:"compliance-field"},K6={class:"searchable-dropdown"},J6={class:"dropdown-options"},z6={key:0,class:"dropdown-add-option"},H6=["onClick"],G6={class:"compliance-field"},Y6={class:"searchable-dropdown"},Z6={class:"dropdown-options"},e7={key:0,class:"dropdown-add-option"},t7=["onClick"],i7={class:"compliance-field"},a7={class:"searchable-dropdown"},s7={class:"dropdown-options"},o7={key:0,class:"dropdown-add-option"},l7=["onClick"],n7={class:"field-group classification-fields"},r7={class:"row-fields"},c7={class:"compliance-field"},d7={class:"compliance-field"},u7={class:"row-fields"},p7={class:"compliance-field"},m7={class:"compliance-field"},v7={class:"row-fields"},k7={class:"compliance-field"},h7={key:0,class:"validation-error"},g7={class:"compliance-field"},y7={key:0,class:"validation-error"},f7={class:"row-fields"},b7={class:"compliance-field"},C7={class:"field-group approval-fields"},L7={class:"row-fields"},w7={class:"compliance-field"},E7=["value"],R7={key:0,class:"validation-error"},I7={class:"compliance-submit-container"},D7=["disabled"],P7={key:0},_7={key:1},A7=["disabled"];function S7(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",z5,[(0,s.Lk)("div",H5,[(0,s.Lk)("div",G5,[(0,s.Lk)("div",Y5,[t[57]||(t[57]=(0,s.Lk)("div",{class:"header-text"},[(0,s.Lk)("h1",null,"Copy Compliance Record"),(0,s.Lk)("p",null,"Create a new compliance item based on the selected one. Target location is auto-populated from current context.")],-1)),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.goBack&&n.goBack(...e)),class:"back-button"},t[56]||(t[56]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])])]),(0,s.Lk)("div",Z5,[(0,s.Lk)("div",e6,[l.successMessage?((0,s.uX)(),(0,s.CE)("div",t6,(0,d.v_)(l.successMessage),1)):(0,s.Q3)("",!0),l.loading?((0,s.uX)(),(0,s.CE)("div",i6,t[58]||(t[58]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("div",{class:"loading-text"},"Loading compliance data...",-1)]))):(0,s.Q3)("",!0),l.error?((0,s.uX)(),(0,s.CE)("div",a6,[t[59]||(t[59]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.error),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",s6,[t[66]||(t[66]=(0,s.Lk)("div",{class:"field-group-title"},"Target Location",-1)),t[67]||(t[67]=(0,s.Lk)("div",{class:"selection-info"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Framework is auto-selected from your current context. You can choose different Policy and Sub Policy as the target location. ")],-1)),(0,s.Lk)("div",o6,[(0,s.Lk)("div",l6,[t[61]||(t[61]=(0,s.Lk)("label",{for:"framework"},[(0,s.eW)(" Framework "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-status auto-selected"},"Auto-selected")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"framework","onUpdate:modelValue":t[1]||(t[1]=e=>l.targetFrameworkId=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.targetFrameworkId}]),ref:"field_targetFrameworkId",required:"",title:"Target framework (auto-selected)",disabled:""},[t[60]||(t[60]=(0,s.Lk)("option",{value:"",disabled:""},"Select Framework",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.frameworks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,n6))),128))],2),[[a.u1,l.targetFrameworkId]]),l.validationErrors.targetFrameworkId?((0,s.uX)(),(0,s.CE)("div",r6,(0,d.v_)(l.validationErrors.targetFrameworkId),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",c6,[t[63]||(t[63]=(0,s.Lk)("label",{for:"policy"},[(0,s.eW)(" Policy "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-status selectable"},"Selectable")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"policy","onUpdate:modelValue":t[2]||(t[2]=e=>l.targetPolicyId=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.targetPolicyId}]),ref:"field_targetPolicyId",required:"",title:"Select target policy",disabled:!l.targetFrameworkId},[t[62]||(t[62]=(0,s.Lk)("option",{value:"",disabled:""},"Select Policy",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.policies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,u6))),128))],10,d6),[[a.u1,l.targetPolicyId]]),l.validationErrors.targetPolicyId?((0,s.uX)(),(0,s.CE)("div",p6,(0,d.v_)(l.validationErrors.targetPolicyId),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",m6,[t[65]||(t[65]=(0,s.Lk)("label",{for:"subpolicy"},[(0,s.eW)(" Sub Policy "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-status selectable"},"Selectable")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"subpolicy","onUpdate:modelValue":t[3]||(t[3]=e=>l.targetSubPolicyId=e),class:(0,d.C4)(["compliance-select",{error:l.validationErrors.targetSubPolicyId}]),ref:"field_targetSubPolicyId",required:"",title:"Select target sub-policy",disabled:!l.targetPolicyId},[t[64]||(t[64]=(0,s.Lk)("option",{value:"",disabled:""},"Select Sub Policy",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.subPolicies,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,d.v_)(e.name),9,k6))),128))],10,v6),[[a.u1,l.targetSubPolicyId]]),l.validationErrors.targetSubPolicyId?((0,s.uX)(),(0,s.CE)("div",h6,(0,d.v_)(l.validationErrors.targetSubPolicyId),1)):(0,s.Q3)("",!0)])])]),l.compliance?((0,s.uX)(),(0,s.CE)("div",g6,[(0,s.Lk)("div",y6,[t[78]||(t[78]=(0,s.Lk)("div",{class:"field-group-title"},"Basic Information",-1)),(0,s.Lk)("div",f6,[(0,s.Lk)("div",b6,[t[68]||(t[68]=(0,s.Lk)("label",null,[(0,s.eW)(" Compliance Title "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 5 characters)")],-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.compliance.ComplianceTitle=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceTitle}]),ref:"field_ComplianceTitle",placeholder:"Enter compliance title",onInput:t[5]||(t[5]=e=>n.validateFieldRealTime("ComplianceTitle")),onBlur:t[6]||(t[6]=e=>n.validateField("ComplianceTitle")),required:""},null,34),[[a.Jo,l.compliance.ComplianceTitle]]),l.validationErrors.ComplianceTitle?((0,s.uX)(),(0,s.CE)("div",C6,(0,d.v_)(l.validationErrors.ComplianceTitle),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",L6,[t[69]||(t[69]=(0,s.Lk)("label",null,"Compliance Type",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.compliance.ComplianceType=e),class:"compliance-input",placeholder:"Enter compliance type",title:"Type of compliance (e.g. Regulatory, Internal, Security)"},null,512),[[a.Jo,l.compliance.ComplianceType]])])]),(0,s.Lk)("div",w6,[t[70]||(t[70]=(0,s.Lk)("label",null,[(0,s.eW)(" Description "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.compliance.ComplianceItemDescription=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.ComplianceItemDescription}]),ref:"field_ComplianceItemDescription",placeholder:"Detailed description of the compliance requirement",onInput:t[9]||(t[9]=e=>n.validateFieldRealTime("ComplianceItemDescription")),onBlur:t[10]||(t[10]=e=>n.validateField("ComplianceItemDescription")),rows:"3",required:""},null,34),[[a.Jo,l.compliance.ComplianceItemDescription]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.ComplianceItemDescription}])},(0,d.v_)(l.compliance.ComplianceItemDescription?.length||0)+"/20 min characters ",3),l.validationErrors.ComplianceItemDescription?((0,s.uX)(),(0,s.CE)("div",E6,(0,d.v_)(l.validationErrors.ComplianceItemDescription),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",R6,[t[71]||(t[71]=(0,s.Lk)("label",null,[(0,s.eW)(" Scope "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.compliance.Scope=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Scope}]),ref:"field_Scope",placeholder:"Define the boundaries and extent of the compliance requirement",onInput:t[12]||(t[12]=e=>n.validateFieldRealTime("Scope")),onBlur:t[13]||(t[13]=e=>n.validateField("Scope")),rows:"3",required:""},null,34),[[a.Jo,l.compliance.Scope]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Scope}])},(0,d.v_)(l.compliance.Scope?.length||0)+"/15 min characters ",3),l.validationErrors.Scope?((0,s.uX)(),(0,s.CE)("div",I6,(0,d.v_)(l.validationErrors.Scope),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",D6,[t[72]||(t[72]=(0,s.Lk)("label",null,[(0,s.eW)(" Objective "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 15 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[14]||(t[14]=e=>l.compliance.Objective=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.Objective}]),ref:"field_Objective",placeholder:"Define the goal or purpose of this compliance requirement",onInput:t[15]||(t[15]=e=>n.validateFieldRealTime("Objective")),onBlur:t[16]||(t[16]=e=>n.validateField("Objective")),rows:"3",required:""},null,34),[[a.Jo,l.compliance.Objective]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.Objective}])},(0,d.v_)(l.compliance.Objective?.length||0)+"/15 min characters ",3),l.validationErrors.Objective?((0,s.uX)(),(0,s.CE)("div",P6,(0,d.v_)(l.validationErrors.Objective),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_6,[(0,s.Lk)("div",A6,[t[74]||(t[74]=(0,s.Lk)("label",null,"Business Units Covered",-1)),(0,s.Lk)("div",S6,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[17]||(t[17]=e=>l.businessUnitSearch=e),class:"compliance-input",placeholder:"Search or add business units",title:"Departments or business units affected by this compliance",onFocus:t[18]||(t[18]=e=>n.showDropdown("BusinessUnitsCovered")),onInput:t[19]||(t[19]=e=>n.filterOptions("BusinessUnitsCovered"))},null,544),[[a.Jo,l.businessUnitSearch]]),(0,s.bo)((0,s.Lk)("div",T6,[0===l.filteredOptions.BusinessUnitsCovered.length&&l.businessUnitSearch?((0,s.uX)(),(0,s.CE)("div",x6,[t[73]||(t[73]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:t[20]||(t[20]=e=>n.addNewOption("BusinessUnitsCovered",l.businessUnitSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.businessUnitSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.BusinessUnitsCovered,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption("BusinessUnitsCovered",e.value)},(0,d.v_)(e.value),9,F6))),128))],512),[[a.aG,"BusinessUnitsCovered"===l.activeDropdown]])])]),(0,s.Lk)("div",V6,[t[75]||(t[75]=(0,s.Lk)("label",null,"Identifier",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[21]||(t[21]=e=>l.compliance.Identifier=e),class:"compliance-input",placeholder:"Auto-generated if left empty",title:"A new identifier will be generated",disabled:""},null,512),[[a.Jo,l.compliance.Identifier]]),t[76]||(t[76]=(0,s.Lk)("small",null,"A new identifier will be generated",-1))]),(0,s.Lk)("div",U6,[(0,s.Lk)("label",N6,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[22]||(t[22]=e=>l.compliance.IsRisk=e),style:{"margin-right":"8px",width:"auto"}},null,512),[[a.lH,l.compliance.IsRisk]]),t[77]||(t[77]=(0,s.eW)(" Is Risk "))])])])]),l.compliance.IsRisk?((0,s.uX)(),(0,s.CE)("div",M6,[t[88]||(t[88]=(0,s.Lk)("div",{class:"field-group-title"},"Risk Information",-1)),(0,s.Lk)("div",X6,[t[79]||(t[79]=(0,s.Lk)("label",null,[(0,s.eW)(" Possible Impact "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[23]||(t[23]=e=>l.compliance.PossibleDamage=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.PossibleDamage}]),ref:"field_PossibleDamage",placeholder:"Describe potential damage that could occur if this risk materializes",onInput:t[24]||(t[24]=e=>n.validateFieldRealTime("PossibleDamage")),onBlur:t[25]||(t[25]=e=>n.validateField("PossibleDamage")),rows:"3",required:""},null,34),[[a.Jo,l.compliance.PossibleDamage]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.PossibleDamage}])},(0,d.v_)(l.compliance.PossibleDamage?.length||0)+"/20 min characters ",3),l.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",$6,(0,d.v_)(l.validationErrors.PossibleDamage),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",O6,[t[80]||(t[80]=(0,s.Lk)("label",null,[(0,s.eW)(" Mitigation "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[26]||(t[26]=e=>l.compliance.mitigation=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.mitigation}]),ref:"field_mitigation",placeholder:"Describe the mitigation measures for this risk",onInput:t[27]||(t[27]=e=>n.validateFieldRealTime("mitigation")),onBlur:t[28]||(t[28]=e=>n.validateField("mitigation")),rows:"3",required:""},null,34),[[a.Jo,l.compliance.mitigation]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.mitigation}])},(0,d.v_)(l.compliance.mitigation?.length||0)+"/20 min characters ",3),l.validationErrors.mitigation?((0,s.uX)(),(0,s.CE)("div",j6,(0,d.v_)(l.validationErrors.mitigation),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",B6,[t[81]||(t[81]=(0,s.Lk)("label",null,[(0,s.eW)(" Potential Risk Scenarios "),(0,s.Lk)("span",{class:"required"},"*"),(0,s.Lk)("span",{class:"field-requirements"},"(Minimum 20 characters)")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[29]||(t[29]=e=>l.compliance.PotentialRiskScenarios=e),class:(0,d.C4)(["compliance-input",{error:l.validationErrors.PotentialRiskScenarios}]),ref:"field_PotentialRiskScenarios",placeholder:"Describe scenarios where this risk could materialize",onInput:t[30]||(t[30]=e=>n.validateFieldRealTime("PotentialRiskScenarios")),onBlur:t[31]||(t[31]=e=>n.validateField("PotentialRiskScenarios")),rows:"3",required:""},null,34),[[a.Jo,l.compliance.PotentialRiskScenarios]]),(0,s.Lk)("div",{class:(0,d.C4)(["char-count",{error:l.validationErrors.PotentialRiskScenarios}])},(0,d.v_)(l.compliance.PotentialRiskScenarios?.length||0)+"/20 min characters ",3),l.validationErrors.PotentialRiskScenarios?((0,s.uX)(),(0,s.CE)("div",W6,(0,d.v_)(l.validationErrors.PotentialRiskScenarios),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",q6,[(0,s.Lk)("div",Q6,[t[83]||(t[83]=(0,s.Lk)("label",null,"Risk Type",-1)),(0,s.Lk)("div",K6,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[32]||(t[32]=e=>l.riskTypeSearch=e),class:"compliance-input",placeholder:"Search or add risk type",title:"Type of risk (e.g. Operational, Financial, Strategic)",onFocus:t[33]||(t[33]=e=>n.showDropdown("RiskType")),onInput:t[34]||(t[34]=e=>n.filterOptions("RiskType"))},null,544),[[a.Jo,l.riskTypeSearch]]),(0,s.bo)((0,s.Lk)("div",J6,[0===l.filteredOptions.RiskType.length&&l.riskTypeSearch?((0,s.uX)(),(0,s.CE)("div",z6,[t[82]||(t[82]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:t[35]||(t[35]=e=>n.addNewOption("RiskType",l.riskTypeSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskTypeSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskType,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption("RiskType",e.value)},(0,d.v_)(e.value),9,H6))),128))],512),[[a.aG,"RiskType"===l.activeDropdown]])])]),(0,s.Lk)("div",G6,[t[85]||(t[85]=(0,s.Lk)("label",null,"Risk Category",-1)),(0,s.Lk)("div",Y6,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[36]||(t[36]=e=>l.riskCategorySearch=e),class:"compliance-input",placeholder:"Search or add risk category",title:"Category of risk (e.g. People, Process, Technology)",onFocus:t[37]||(t[37]=e=>n.showDropdown("RiskCategory")),onInput:t[38]||(t[38]=e=>n.filterOptions("RiskCategory"))},null,544),[[a.Jo,l.riskCategorySearch]]),(0,s.bo)((0,s.Lk)("div",Z6,[0===l.filteredOptions.RiskCategory.length&&l.riskCategorySearch?((0,s.uX)(),(0,s.CE)("div",e7,[t[84]||(t[84]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:t[39]||(t[39]=e=>n.addNewOption("RiskCategory",l.riskCategorySearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskCategorySearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskCategory,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption("RiskCategory",e.value)},(0,d.v_)(e.value),9,t7))),128))],512),[[a.aG,"RiskCategory"===l.activeDropdown]])])]),(0,s.Lk)("div",i7,[t[87]||(t[87]=(0,s.Lk)("label",null,"Risk Business Impact",-1)),(0,s.Lk)("div",a7,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[40]||(t[40]=e=>l.riskBusinessImpactSearch=e),class:"compliance-input",placeholder:"Search or add business impact",title:"How this risk impacts business operations",onFocus:t[41]||(t[41]=e=>n.showDropdown("RiskBusinessImpact")),onInput:t[42]||(t[42]=e=>n.filterOptions("RiskBusinessImpact"))},null,544),[[a.Jo,l.riskBusinessImpactSearch]]),(0,s.bo)((0,s.Lk)("div",s7,[0===l.filteredOptions.RiskBusinessImpact.length&&l.riskBusinessImpactSearch?((0,s.uX)(),(0,s.CE)("div",o7,[t[86]||(t[86]=(0,s.Lk)("span",null,"No matches found. Add new:",-1)),(0,s.Lk)("button",{onClick:t[43]||(t[43]=e=>n.addNewOption("RiskBusinessImpact",l.riskBusinessImpactSearch)),class:"dropdown-add-btn"},' + Add "'+(0,d.v_)(l.riskBusinessImpactSearch)+'" ',1)])):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredOptions.RiskBusinessImpact,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"dropdown-option",onClick:t=>n.selectOption("RiskBusinessImpact",e.value)},(0,d.v_)(e.value),9,l7))),128))],512),[[a.aG,"RiskBusinessImpact"===l.activeDropdown]])])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",n7,[t[100]||(t[100]=(0,s.Lk)("div",{class:"field-group-title"},"Classification",-1)),(0,s.Lk)("div",r7,[(0,s.Lk)("div",c7,[t[90]||(t[90]=(0,s.Lk)("label",null,"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[44]||(t[44]=e=>l.compliance.Criticality=e),class:"compliance-select",required:"",title:"How critical this compliance item is to the organization"},t[89]||(t[89]=[(0,s.Lk)("option",{value:"High"},"High",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1)]),512),[[a.u1,l.compliance.Criticality]])]),(0,s.Lk)("div",d7,[t[92]||(t[92]=(0,s.Lk)("label",null,"Mandatory/Optional",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[45]||(t[45]=e=>l.compliance.MandatoryOptional=e),class:"compliance-select",required:"",title:"Whether this compliance item is mandatory or optional"},t[91]||(t[91]=[(0,s.Lk)("option",{value:"Mandatory"},"Mandatory",-1),(0,s.Lk)("option",{value:"Optional"},"Optional",-1)]),512),[[a.u1,l.compliance.MandatoryOptional]])])]),(0,s.Lk)("div",u7,[(0,s.Lk)("div",p7,[t[94]||(t[94]=(0,s.Lk)("label",null,"Manual/Automatic",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[46]||(t[46]=e=>l.compliance.ManualAutomatic=e),class:"compliance-select",required:"",title:"Whether this compliance is checked manually or automatically"},t[93]||(t[93]=[(0,s.Lk)("option",{value:"Manual"},"Manual",-1),(0,s.Lk)("option",{value:"Automatic"},"Automatic",-1)]),512),[[a.u1,l.compliance.ManualAutomatic]])]),(0,s.Lk)("div",m7,[t[95]||(t[95]=(0,s.Lk)("label",null,"Applicability",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[47]||(t[47]=e=>l.compliance.Applicability=e),class:"compliance-input",placeholder:"Applicability from policy",title:"Describes where this compliance item applies"},null,512),[[a.Jo,l.compliance.Applicability]])])]),(0,s.Lk)("div",v7,[(0,s.Lk)("div",k7,[t[96]||(t[96]=(0,s.Lk)("label",null,"Severity Rating (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[48]||(t[48]=e=>l.compliance.Impact=e),onInput:t[49]||(t[49]=(...e)=>n.validateImpact&&n.validateImpact(...e)),class:"compliance-input",step:"0.1",min:"1",max:"10",title:"Rate the Severity Rating from 1 (lowest) to 10 (highest)"},null,544),[[a.Jo,l.compliance.Impact,void 0,{number:!0}]]),l.impactError?((0,s.uX)(),(0,s.CE)("span",h7," Severity Rating must be between 1 and 10 ")):(0,s.Q3)("",!0)]),(0,s.Lk)("div",g7,[t[97]||(t[97]=(0,s.Lk)("label",null,"Probability (1-10)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[50]||(t[50]=e=>l.compliance.Probability=e),onInput:t[51]||(t[51]=(...e)=>n.validateProbability&&n.validateProbability(...e)),class:"compliance-input",step:"0.1",min:"1",max:"10",title:"Rate the probability from 1 (lowest) to 10 (highest)"},null,544),[[a.Jo,l.compliance.Probability,void 0,{number:!0}]]),l.probabilityError?((0,s.uX)(),(0,s.CE)("span",y7," Probability must be between 1 and 10 ")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",f7,[(0,s.Lk)("div",b7,[t[99]||(t[99]=(0,s.Lk)("label",null,"Maturity Level",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[52]||(t[52]=e=>l.compliance.MaturityLevel=e),class:"compliance-select",title:"Current maturity level of this compliance item"},t[98]||(t[98]=[(0,s.Lk)("option",null,"Initial",-1),(0,s.Lk)("option",null,"Developing",-1),(0,s.Lk)("option",null,"Defined",-1),(0,s.Lk)("option",null,"Managed",-1),(0,s.Lk)("option",null,"Optimizing",-1)]),512),[[a.u1,l.compliance.MaturityLevel]])])])]),(0,s.Lk)("div",C7,[t[103]||(t[103]=(0,s.Lk)("div",{class:"field-group-title"},"Approval Information",-1)),(0,s.Lk)("div",L7,[(0,s.Lk)("div",w7,[t[102]||(t[102]=(0,s.Lk)("label",null,"Assign Reviewer",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[53]||(t[53]=e=>l.compliance.reviewer_id=e),class:"compliance-select",required:"",title:"Person responsible for reviewing this compliance item"},[t[101]||(t[101]=(0,s.Lk)("option",{value:"",disabled:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.UserId,value:e.UserId},(0,d.v_)(e.UserName)+" "+(0,d.v_)(e.email?`(${e.email})`:""),9,E7))),128))],512),[[a.u1,l.compliance.reviewer_id]]),l.users.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("span",R7,"No reviewers available"))])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",I7,[(0,s.Lk)("button",{class:"compliance-submit-btn",onClick:t[54]||(t[54]=(...e)=>n.validateAndSubmit&&n.validateAndSubmit(...e)),disabled:l.loading||!n.canSaveCopy},[l.loading?((0,s.uX)(),(0,s.CE)("span",P7,"Saving...")):((0,s.uX)(),(0,s.CE)("span",_7,"Save Copy"))],8,D7),(0,s.Lk)("button",{class:"compliance-cancel-btn",onClick:t[55]||(t[55]=(...e)=>n.cancelCopy&&n.cancelCopy(...e)),disabled:l.loading}," Cancel ",8,A7)])])])])}var T7={name:"CopyCompliance",data(){return{compliance:null,users:[],frameworks:[],policies:[],subPolicies:[],targetFrameworkId:"",targetPolicyId:"",targetSubPolicyId:"",loading:!1,error:null,successMessage:null,impactError:!1,probabilityError:!1,originalComplianceId:null,localSourceSubPolicyId:null,categoryOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},filteredOptions:{BusinessUnitsCovered:[],RiskType:[],RiskCategory:[],RiskBusinessImpact:[]},businessUnitSearch:"",riskTypeSearch:"",riskCategorySearch:"",riskBusinessImpactSearch:"",activeDropdown:null,validationErrors:{},validationRules:{ComplianceTitle:[{required:!0,message:"Title is required"},{minLength:5,message:"Title must be at least 5 characters long"}],ComplianceItemDescription:[{required:!0,message:"Description is required"},{minLength:20,message:"Description must be at least 20 characters long"}],Scope:[{required:!0,message:"Scope is required"},{minLength:15,message:"Scope must be at least 15 characters long"}],Objective:[{required:!0,message:"Objective is required"},{minLength:15,message:"Objective must be at least 15 characters long"}],PossibleDamage:[{required:!0,message:"Possible Damage is required for risks"},{minLength:20,message:"Possible Damage must be at least 20 characters long"}],PotentialRiskScenarios:[{required:!0,message:"Risk Scenarios are required for risks"},{minLength:20,message:"Risk Scenarios must be at least 20 characters long"}],ComplianceType:[{required:!0,message:"Compliance Type is required"}],BusinessUnitsCovered:[{required:!0,message:"Business Units are required"}],RiskType:[{required:!0,message:"Risk Type is required for risks"}],RiskCategory:[{required:!0,message:"Risk Category is required for risks"}],RiskBusinessImpact:[{required:!0,message:"Risk Business Impact is required for risks"}],Criticality:[{required:!0,message:"Criticality is required"}],MandatoryOptional:[{required:!0,message:"Mandatory/Optional selection is required"}],ManualAutomatic:[{required:!0,message:"Manual/Automatic selection is required"}],MaturityLevel:[{required:!0,message:"Maturity Level is required"}],mitigation:[{required:!0,message:"Mitigation is required for risks"},{minLength:20,message:"Mitigation must be at least 20 characters long"}],Impact:[{required:!0,message:"Impact is required"},{min:0,max:10,message:"Impact must be between 0 and 10"}],Probability:[{required:!0,message:"Probability is required"},{min:0,max:10,message:"Probability must be between 0 and 10"}],reviewer_id:[{required:!0,message:"Reviewer is required"}]},fieldStates:{}}},computed:{canSaveCopy(){const e=this.compliance&&this.compliance.ComplianceItemDescription&&this.targetFrameworkId&&this.targetPolicyId&&this.targetSubPolicyId&&this.compliance.Criticality&&this.compliance.MandatoryOptional&&this.compliance.ManualAutomatic&&this.compliance.Impact&&this.compliance.Probability&&this.compliance.MaturityLevel&&this.compliance.reviewer_id;return Math.random()<.1&&console.log("🔍 canSaveCopy check:",{isValid:e,targetFrameworkId:this.targetFrameworkId,targetPolicyId:this.targetPolicyId,targetSubPolicyId:this.targetSubPolicyId,hasCompliance:!!this.compliance,hasDescription:!!this.compliance?.ComplianceItemDescription,hasCriticality:!!this.compliance?.Criticality,hasReviewer:!!this.compliance?.reviewer_id}),e}},async created(){const e=this.$route.params.id;e?(this.originalComplianceId=e,await this.loadComplianceData(e),await this.loadUsers(),await this.loadCategoryOptions(),await this.initializeFromContext(),this.compliance&&!this.compliance.reviewer_id&&this.users.length>0&&(this.compliance.reviewer_id=this.users[0].UserId),document.addEventListener("click",this.handleClickOutside)):this.error="No compliance ID provided"},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},watch:{targetFrameworkId(e){e&&(console.log("Framework changed to:",e),this.validationErrors.targetFrameworkId="",this.loadPolicies(e),this.targetPolicyId="",this.targetSubPolicyId="",this.policies=[],this.subPolicies=[])},targetPolicyId(e){if(e){console.log("Policy changed to:",e),this.validationErrors.targetPolicyId="",this.loadSubPolicies(e),this.targetSubPolicyId="",this.subPolicies=[];const t=this.policies.find(t=>t.id===e);t&&t.applicability&&this.compliance&&(this.compliance.Applicability=t.applicability,console.log("Updated applicability:",this.compliance.Applicability))}},targetSubPolicyId(e){e&&(console.log("Sub-policy changed to:",e),this.validationErrors.targetSubPolicyId="")}},methods:{async loadComplianceData(e){try{this.loading=!0;const t=await I4.fv.getComplianceById(e);t.data&&t.data.success?(this.compliance=t.data.data,this.localSourceSubPolicyId=this.compliance.SubPolicy,console.log("Loaded compliance data:",this.compliance),this.compliance.FrameworkId=t.data.data.FrameworkId,this.compliance.PolicyId=t.data.data.PolicyId,console.log("Framework ID:",this.compliance.FrameworkId,"Policy ID:",this.compliance.PolicyId),!this.compliance.reviewer_id&&this.users.length>0&&(this.compliance.reviewer_id=this.users[0].UserId),this.compliance.Identifier="",this.compliance.mitigation=this.formatMitigationData(this.compliance.mitigation)):this.error="Failed to load compliance data"}catch(t){console.error("Error loading compliance data:",t),this.error="Failed to load compliance data. Please try again."}finally{this.loading=!1}},formatMitigationData(e){if(console.log("Formatting mitigation data:",e),!e)return{};if("object"===typeof e&&null!==e){if(Object.keys(e).some(e=>!isNaN(parseInt(e))))return console.log("Mitigation is already in numbered format"),e;const t={};return Object.values(e).forEach((e,i)=>{t[(i+1).toString()]=e}),console.log("Converted object mitigation to numbered format:",t),t}if("string"===typeof e){try{if(e.trim().startsWith("{")){const t=JSON.parse(e);if(console.log("Parsed mitigation JSON:",t),"object"===typeof t&&null!==t)return this.formatMitigationData(t)}}catch(t){console.log("Failed to parse mitigation as JSON:",t)}if(e.trim())return console.log("Using mitigation string as single step"),{1:e.trim()}}return{}},async initializeFromContext(){try{const e=this.$route.query;console.log("=== INITIALIZING FROM CONTEXT ==="),console.log("Route query:",e),console.log("Current route params:",this.$route.params),e.frameworkId&&e.frameworkName?(console.log("✓ Using context from parent page"),console.log("Framework context:",{id:e.frameworkId,name:e.frameworkName}),this.frameworks=[{id:parseInt(e.frameworkId),name:e.frameworkName}],this.targetFrameworkId=parseInt(e.frameworkId),console.log("Set targetFrameworkId:",this.targetFrameworkId,typeof this.targetFrameworkId),await this.loadPolicies(parseInt(e.frameworkId)),e.policyId&&e.policyName&&(this.targetPolicyId=parseInt(e.policyId),console.log("Set targetPolicyId:",this.targetPolicyId,typeof this.targetPolicyId)),e.policyId&&(await this.loadSubPolicies(parseInt(e.policyId)),e.subPolicyId&&e.subPolicyName&&(this.targetSubPolicyId=parseInt(e.subPolicyId),console.log("Set targetSubPolicyId:",this.targetSubPolicyId,typeof this.targetSubPolicyId))),console.log("Context initialized:",{framework:this.targetFrameworkId,policy:this.targetPolicyId,subPolicy:this.targetSubPolicyId}),this.$forceUpdate(),this.validationErrors.targetFrameworkId="",this.validationErrors.targetPolicyId="",this.validationErrors.targetSubPolicyId="",console.log("Cleared validation errors for target fields")):(console.log("✗ No context provided, loading all frameworks"),console.log("Missing context items:",{frameworkId:!!e.frameworkId,frameworkName:!!e.frameworkName,policyId:!!e.policyId,subPolicyId:!!e.subPolicyId}),await this.loadFrameworks(),await this.autoPopulateTargetFields())}catch(e){console.error("Error initializing from context:",e),this.error="Failed to initialize page context. Please try again."}},async autoPopulateTargetFields(){if(this.compliance)try{console.log("Auto-populating target fields..."),this.compliance.FrameworkId&&(this.targetFrameworkId=this.compliance.FrameworkId,console.log("Set target framework ID:",this.targetFrameworkId),await this.loadPolicies(this.compliance.FrameworkId),this.compliance.PolicyId&&(this.targetPolicyId=this.compliance.PolicyId,console.log("Set target policy ID:",this.targetPolicyId),await this.loadSubPolicies(this.compliance.PolicyId),this.compliance.SubPolicy&&(this.targetSubPolicyId=this.compliance.SubPolicy,console.log("Set target sub-policy ID:",this.targetSubPolicyId))))}catch(e){console.error("Error auto-populating target fields:",e),this.error="Failed to auto-populate target fields. Please select manually."}},async loadUsers(){try{this.loading=!0;const e=await I4.fv.getUsers();e.data.success&&Array.isArray(e.data.users)?this.users=e.data.users:(console.error("Invalid users data received:",e.data),this.error="Failed to load approvers")}catch(e){console.error("Failed to load users:",e),this.error="Failed to load approvers. Please try again."}finally{this.loading=!1}},async loadFrameworks(){try{this.loading=!0,this.error=null;const e=await I4.fv.getComplianceFrameworks();let t;if(console.log("Frameworks API URL: /api/compliance/frameworks/"),console.log("Frameworks response:",e.data),e.data.success&&e.data.frameworks)t=e.data.frameworks;else{if(!Array.isArray(e.data))return console.error("Unexpected response format:",e.data),this.error="Failed to load frameworks - invalid response format",void(this.frameworks=[]);t=e.data}this.frameworks=t.map(e=>({id:e.id,name:e.name})),console.log("Processed frameworks:",this.frameworks),0===this.frameworks.length&&(console.warn("No frameworks found"),this.error="No frameworks available")}catch(e){this.error=`Failed to load frameworks: ${e.response?.data?.message||e.message||"Unknown error"}`,console.error("Framework loading error:",e),console.error("Error response:",e.response),this.frameworks=[]}finally{this.loading=!1}},async loadPolicies(e){try{this.loading=!0,this.error=null;const t=await I4.fv.getCompliancePolicies(e);console.log(`Policies API URL: /api/compliance/frameworks/${e}/policies/list/`),console.log("Policies response for framework",e,":",t.data),t.data.success&&t.data.policies?(this.policies=t.data.policies.map(e=>({id:e.id,name:e.name,applicability:e.scope||e.Applicability||""})),console.log("Processed policies:",this.policies),0===this.policies.length&&console.warn("No policies found for framework:",e)):(console.error("Error in response:",t.data),this.error="Failed to load policies for the selected framework",this.policies=[])}catch(t){this.error=`Failed to load policies: ${t.response?.data?.message||t.message||"Unknown error"}`,console.error("Policy loading error:",t),console.error("Error response:",t.response),this.policies=[]}finally{this.loading=!1}},async loadSubPolicies(e){try{this.loading=!0,this.error=null;const t=await I4.fv.getComplianceSubPolicies(e);console.log(`Sub-policies API URL: /api/compliance/policies/${e}/subpolicies/`),console.log("Sub-policies response for policy",e,":",t.data),t.data.success&&t.data.subpolicies?(this.subPolicies=t.data.subpolicies.map(e=>({id:e.id,name:e.name})),console.log("Processed sub-policies:",this.subPolicies),0===this.subPolicies.length&&console.warn("No sub-policies found for policy:",e)):(console.error("Error in response:",t.data),this.error="Failed to load sub-policies for the selected policy",this.subPolicies=[])}catch(t){this.error=`Failed to load sub-policies: ${t.response?.data?.message||t.message||"Unknown error"}`,console.error("Sub-policy loading error:",t),console.error("Error response:",t.response),this.subPolicies=[]}finally{this.loading=!1}},validateImpact(e){const t=parseFloat(e.target.value);this.impactError=t<1||t>10},validateProbability(e){const t=parseFloat(e.target.value);this.probabilityError=t<1||t>10},getDefaultDueDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},async submitCopy(){if(this.canSaveCopy)try{this.loading=!0,this.error=null,this.successMessage=null,console.log("🚀 Preparing clone data..."),console.log("Original compliance:",this.compliance),console.log("Target SubPolicy ID:",this.targetSubPolicyId);const e=this.formatMitigationData(this.compliance.mitigation);console.log("📋 Formatted mitigation:",e);const t={ComplianceTitle:this.compliance.ComplianceTitle||"",ComplianceItemDescription:this.compliance.ComplianceItemDescription||"",ComplianceType:this.compliance.ComplianceType||"",Scope:this.compliance.Scope||"",Objective:this.compliance.Objective||"",BusinessUnitsCovered:this.compliance.BusinessUnitsCovered||"",IsRisk:Boolean(this.compliance.IsRisk),PossibleDamage:this.compliance.PossibleDamage||"",mitigation:e,PotentialRiskScenarios:this.compliance.PotentialRiskScenarios||"",RiskType:this.compliance.RiskType||"",RiskCategory:this.compliance.RiskCategory||"",RiskBusinessImpact:this.compliance.RiskBusinessImpact||"",Criticality:this.compliance.Criticality||"Medium",MandatoryOptional:this.compliance.MandatoryOptional||"Mandatory",ManualAutomatic:this.compliance.ManualAutomatic||"Manual",Impact:String(this.compliance.Impact||5),Probability:String(this.compliance.Probability||5),MaturityLevel:this.compliance.MaturityLevel||"Initial",SubPolicy:this.targetSubPolicyId,target_subpolicy_id:this.targetSubPolicyId,Status:"Under Review",ActiveInactive:"Inactive",ComplianceVersion:"1.0",PermanentTemporary:this.compliance.PermanentTemporary||"Permanent",reviewer_id:this.compliance.reviewer_id,reviewer:this.compliance.reviewer_id,Applicability:this.compliance.Applicability||"",Identifier:"",CreatedByName:(this.compliance.reviewer_id||this.compliance.reviewer).toString(),ApprovalDueDate:this.getDefaultDueDate(),ComplianceId:null,FrameworkId:null,PolicyId:null};console.log("📦 Clone data prepared:",t),console.log("🔑 Key fields check:"),console.log("- SubPolicy:",t.SubPolicy),console.log("- target_subpolicy_id:",t.target_subpolicy_id),console.log("- reviewer_id:",t.reviewer_id),console.log("- ApprovalDueDate:",t.ApprovalDueDate);const i=await I4.fv.cloneCompliance(this.originalComplianceId,t);console.log("📬 Clone response:",i.data),i.data.success?(D4.complianceCloned({ComplianceId:i.data.compliance_id}),this.successMessage="Compliance copied successfully!",setTimeout(()=>{this.$router.push("/compliance/tailoring")},1500)):this.error=i.data.message||"Failed to copy compliance"}catch(e){console.error("Copy error:",e),console.error("Error response:",e.response),this.error="Failed to copy compliance: "+(e.response?.data?.message||e.message)}finally{this.loading=!1}else this.error="Please fill all required fields and select a destination."},cancelCopy(){this.$router.push("/compliance/tailoring")},goBack(){const e=this.$route.query;e.frameworkId&&e.policyId&&e.subPolicyId?this.$router.push("/compliance/tailoring"):window.history.length>1?this.$router.go(-1):this.$router.push("/compliance/tailoring")},async loadCategoryOptions(){try{this.loading=!0;const e=await I4.fv.getCategoryBusinessUnits("BusinessUnitsCovered");e.data.success&&(this.categoryOptions.BusinessUnitsCovered=e.data.data);const t=await I4.fv.getCategoryBusinessUnits("RiskType");t.data.success&&(this.categoryOptions.RiskType=t.data.data);const i=await I4.fv.getCategoryBusinessUnits("RiskCategory");i.data.success&&(this.categoryOptions.RiskCategory=i.data.data);const a=await I4.fv.getCategoryBusinessUnits("RiskBusinessImpact");a.data.success&&(this.categoryOptions.RiskBusinessImpact=a.data.data)}catch(e){console.error("Failed to load category options:",e),D4.error("Failed to load dropdown options. Some features may be limited.")}finally{this.loading=!1}},showDropdown(e){this.activeDropdown=e,this.filterOptions(e),event.stopPropagation()},handleClickOutside(e){const t=document.querySelectorAll(".searchable-dropdown");let i=!0;t.forEach(t=>{t.contains(e.target)&&(i=!1)}),i&&(this.activeDropdown=null)},filterOptions(e){let t="";switch(e){case"BusinessUnitsCovered":t=this.businessUnitSearch||"";break;case"RiskType":t=this.riskTypeSearch||"";break;case"RiskCategory":t=this.riskCategorySearch||"";break;case"RiskBusinessImpact":t=this.riskBusinessImpactSearch||"";break}const i=t.toLowerCase();this.filteredOptions[e]=this.categoryOptions[e].filter(e=>e.value.toLowerCase().includes(i))},selectOption(e,t){switch(this.compliance[e]=t,e){case"BusinessUnitsCovered":this.businessUnitSearch=t;break;case"RiskType":this.riskTypeSearch=t;break;case"RiskCategory":this.riskCategorySearch=t;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch=t;break}this.activeDropdown=null},async addNewOption(e,t){try{const i=await I4.fv.addCategoryBusinessUnit({source:e,value:t});i.data.success&&(this.categoryOptions[e].push(i.data.data),this.selectOption(e,t),D4.success(`Added new ${e} option: ${t}`))}catch(i){console.error(`Failed to add new ${e} option:`,i),D4.error(`Failed to add new option: ${i.message||i}`)}},scrollToError(){const e=Object.keys(this.validationErrors).filter(e=>this.validationErrors[e]);if(console.log("📍 Scrolling to error for fields:",e),e.length>0){const t=e[0];let i;if(console.log("🎯 First error field:",t),t.startsWith("target")){const e={targetFrameworkId:"framework",targetPolicyId:"policy",targetSubPolicyId:"subpolicy"};i=document.getElementById(e[t])}else i=this.$refs[`field_${t}`];if(i)console.log("✅ Found error element, scrolling..."),i.scrollIntoView({behavior:"smooth",block:"center"}),i.focus&&i.focus();else{console.log("❌ Error element not found for:",t);const e=document.querySelector(".selection-fields");e&&e.scrollIntoView({behavior:"smooth",block:"center"})}}},validateFieldRealTime(e){if(!this.compliance.IsRisk&&["PossibleDamage","mitigation","PotentialRiskScenarios","RiskType","RiskCategory","RiskBusinessImpact"].includes(e))return this.validationErrors[e]="",this.fieldStates[e]={valid:!0,warning:!1,dirty:!0},!0;const t=this.compliance[e],i=this.validationRules[e];if(!i)return!0;this.fieldStates[e]||(this.fieldStates[e]={dirty:!1,valid:!1,warning:!1}),this.fieldStates[e].dirty=!0;let a=!0,s=!1;for(const o of i){if(o.required&&(!t||""===t.toString().trim())){a=!1,this.validationErrors[e]=o.message;break}if(o.minLength&&t&&t.length<o.minLength&&(a=!1,t.length>0&&(s=!0,this.validationErrors[e]=`Need ${o.minLength-t.length} more characters`)),("Impact"===e||"Probability"===e)&&""!==t){const i=parseFloat(t);isNaN(i)?(a=!1,this.validationErrors[e]="Must be a valid number"):(i<o.min||i>o.max)&&(a=!1,this.validationErrors[e]=`Must be between ${o.min} and ${o.max}`)}}return this.fieldStates[e].valid=a,this.fieldStates[e].warning=s,a&&(this.validationErrors[e]=""),a},validateField(e){const t=this.validateFieldRealTime(e);return t||this.$nextTick(()=>{this.scrollToError()}),t},validateAndSubmit(){console.log("🚀 Starting validation and submit"),console.log("Current target values:",{framework:this.targetFrameworkId,policy:this.targetPolicyId,subPolicy:this.targetSubPolicyId}),this.validationErrors={};let e=!0;if(this.targetFrameworkId||(this.validationErrors.targetFrameworkId="Framework is required",e=!1),this.targetPolicyId||(this.validationErrors.targetPolicyId="Policy is required",e=!1),this.targetSubPolicyId||(this.validationErrors.targetSubPolicyId="Sub Policy is required",e=!1),Object.keys(this.validationRules).forEach(t=>{t.startsWith("target")||this.validateField(t)||(e=!1)}),console.log("📋 Validation result:",{isValid:e,validationErrors:this.validationErrors}),!e)return console.log("❌ Validation failed, scrolling to error"),void this.$nextTick(()=>{this.scrollToError()});console.log("✅ Validation passed, submitting..."),this.submitCopy()}}};const x7=(0,le.A)(T7,[["render",S7],["__scopeId","data-v-36eb787c"]]);var F7=x7;const V7={class:"dashboard-container"},U7={class:"dashboard-header"},N7={class:"dashboard-actions"},M7=["disabled"],X7={key:0,class:"error-message"},$7={class:"performance-summary"},O7={class:"summary-card growth"},j7={class:"summary-content"},B7={class:"summary-value"},W7={class:"summary-card"},q7={class:"summary-content"},Q7={class:"summary-value"},K7={class:"summary-card"},J7={class:"summary-content"},z7={class:"summary-value"},H7={key:1,class:"loading-state"},G7={key:2,class:"no-data-state"},Y7={class:"compliance-approval-container"},Z7={key:0},e9={key:1},t9={key:3,class:"edit-policy-modal"},i9={class:"edit-policy-content"},a9={class:"rejection-reason"},s9={class:"compliance-details-header"},o9={key:0},l9={key:1},n9={class:"policy-details-content"},r9={class:"policy-approval-section"},c9={key:0},d9={key:1},u9={class:"policy-actions"},p9={key:0,class:"policy-approval-status"},m9={class:"status-container"},v9={key:0,class:"approval-date"},k9={class:"date-value"},h9={key:1,class:"policy-rejection-remarks"},g9={class:"remarks-value"},y9={key:0,class:"compliance-details"},f9={key:0,class:"deactivation-request-details"},b9={class:"compliance-detail-row"},C9={class:"compliance-detail-row"},L9={class:"status-badge current"},w9={class:"compliance-detail-row"},E9={class:"status-badge requested"},R9={class:"compliance-detail-row"},I9={key:0,class:"compliance-detail-row"},D9={class:"policy-count"},P9={class:"warning-message"},_9={key:1},A9={class:"compliance-detail-row"},S9={class:"compliance-detail-row"},T9={class:"compliance-detail-row"},x9={class:"severity-rating"},F9={class:"compliance-detail-row"},V9={class:"probability-value"},U9={class:"compliance-detail-row"},N9={class:"policy-actions"},M9={key:5,class:"reject-modal"},X9={class:"reject-modal-content"},$9={class:"reject-modal-actions"};function O9(e,t,i,o,l,n){const r=(0,s.g2)("CollapsibleTable"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",V7,[(0,s.Lk)("div",U7,[t[23]||(t[23]=(0,s.Lk)("h2",{class:"dashboard-heading"},"Compliance Approver",-1)),(0,s.Lk)("div",N7,[(0,s.Lk)("button",{class:"action-btn",onClick:t[0]||(t[0]=(...e)=>n.refreshData&&n.refreshData(...e)),disabled:l.isLoading},[(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-sync-alt",{"fa-spin":l.isLoading}])},null,2)],8,M7),(0,s.Lk)("button",{class:"action-btn",onClick:t[1]||(t[1]=(...e)=>n.testPagination&&n.testPagination(...e))},t[21]||(t[21]=[(0,s.Lk)("i",{class:"fas fa-cog"},null,-1)])),t[22]||(t[22]=(0,s.Lk)("button",{class:"action-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),l.error?((0,s.uX)(),(0,s.CE)("div",X7,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.refreshData&&n.refreshData(...e)),class:"retry-btn"},"Retry")])):(0,s.Q3)("",!0),(0,s.Lk)("div",$7,[(0,s.Lk)("div",O7,[t[25]||(t[25]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-user-check"})],-1)),(0,s.Lk)("div",j7,[t[24]||(t[24]=(0,s.Lk)("div",{class:"summary-label"},"Pending Approvals",-1)),(0,s.Lk)("div",B7,(0,d.v_)(n.pendingApprovalsCount),1)])]),(0,s.Lk)("div",W7,[t[27]||(t[27]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",q7,[t[26]||(t[26]=(0,s.Lk)("div",{class:"summary-label"},"Approved",-1)),(0,s.Lk)("div",Q7,(0,d.v_)(n.approvedApprovalsCount),1)])]),(0,s.Lk)("div",K7,[t[29]||(t[29]=(0,s.Lk)("div",{class:"summary-icon"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",J7,[t[28]||(t[28]=(0,s.Lk)("div",{class:"summary-label"},"Rejected",-1)),(0,s.Lk)("div",z7,(0,d.v_)(n.rejectedApprovalsCount),1)])])]),l.isLoading&&!l.approvals.length?((0,s.uX)(),(0,s.CE)("div",H7,t[30]||(t[30]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading approvals... ")]))):l.isLoading||0!==n.complianceApprovals.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",G7,t[31]||(t[31]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No pending approvals found.",-1),(0,s.Lk)("small",null,'Any compliance items with "Under Review" status will appear here.',-1)]))),(0,s.Lk)("div",Y7,[t[32]||(t[32]=(0,s.Lk)("h2",{class:"compliance-approval-title"},"My Compliance Approval Tasks",-1)),(0,s.Lk)("div",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.groupedApprovals,(e,t)=>((0,s.uX)(),(0,s.Wv)(r,{key:t,sectionConfig:{name:t,statusClass:t.toLowerCase().replace(" ","-"),tasks:n.getPaginatedTasks(e.map(n.mapApprovalToRow),t)},tableHeaders:n.approvalTableHeaders,isExpanded:l.collapsibleStates[t],onToggle:e=>n.toggleSection(t),onTaskClick:n.handleApprovalAction,pagination:{currentPage:l.pagination[t].currentPage,totalPages:Math.ceil(l.pagination[t].totalCount/l.pagination[t].pageSize),pageSize:l.pagination[t].pageSize,totalCount:l.pagination[t].totalCount,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>n.handlePaginationChange(t,{...l.pagination[t],pageSize:e,currentPage:1})},onNextPage:()=>n.handlePaginationChange(t,{...l.pagination[t],currentPage:l.pagination[t].currentPage+1}),onPrevPage:()=>n.handlePaginationChange(t,{...l.pagination[t],currentPage:l.pagination[t].currentPage-1})},null,8,["sectionConfig","tableHeaders","isExpanded","onToggle","onTaskClick","pagination","onNextPage","onPrevPage"]))),128))]),n.approvedComplianceItems.length>0?((0,s.uX)(),(0,s.CE)("div",Z7,[(0,s.bF)(r,{sectionConfig:{name:"Recently Approved",statusClass:"approved",tasks:n.getPaginatedTasks(n.approvedComplianceItems.map(n.mapApprovalToRow),"Recently Approved")},tableHeaders:n.approvalTableHeaders,isExpanded:l.collapsibleStates["Recently Approved"],onToggle:t[3]||(t[3]=e=>n.toggleSection("Recently Approved")),onTaskClick:n.handleApprovalAction,pagination:{currentPage:l.pagination["Recently Approved"].currentPage,totalPages:Math.ceil(l.pagination["Recently Approved"].totalCount/l.pagination["Recently Approved"].pageSize),pageSize:l.pagination["Recently Approved"].pageSize,totalCount:l.pagination["Recently Approved"].totalCount,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>n.handlePaginationChange("Recently Approved",{...l.pagination["Recently Approved"],pageSize:e,currentPage:1})},onNextPage:()=>n.handlePaginationChange("Recently Approved",{...l.pagination["Recently Approved"],currentPage:l.pagination["Recently Approved"].currentPage+1}),onPrevPage:()=>n.handlePaginationChange("Recently Approved",{...l.pagination["Recently Approved"],currentPage:l.pagination["Recently Approved"].currentPage-1})},null,8,["sectionConfig","tableHeaders","isExpanded","onTaskClick","pagination","onNextPage","onPrevPage"])])):(0,s.Q3)("",!0),l.rejectedCompliances.length?((0,s.uX)(),(0,s.CE)("div",e9,[(0,s.bF)(r,{sectionConfig:{name:"Rejected",statusClass:"rejected",tasks:n.getPaginatedTasks(l.rejectedCompliances.map(n.mapRejectedToRow),"Rejected")},tableHeaders:n.rejectedTableHeaders,isExpanded:l.collapsibleStates["Rejected"],onToggle:t[4]||(t[4]=e=>n.toggleSection("Rejected")),onTaskClick:n.handleRejectedAction,pagination:{currentPage:l.pagination["Rejected"].currentPage,totalPages:Math.ceil(l.pagination["Rejected"].totalCount/l.pagination["Rejected"].pageSize),pageSize:l.pagination["Rejected"].pageSize,totalCount:l.pagination["Rejected"].totalCount,pageSizeOptions:[6,15,30,50],onPageSizeChange:e=>n.handlePaginationChange("Rejected",{...l.pagination["Rejected"],pageSize:e,currentPage:1})},onNextPage:()=>n.handlePaginationChange("Rejected",{...l.pagination["Rejected"],currentPage:l.pagination["Rejected"].currentPage+1}),onPrevPage:()=>n.handlePaginationChange("Rejected",{...l.pagination["Rejected"],currentPage:l.pagination["Rejected"].currentPage-1})},null,8,["sectionConfig","tableHeaders","isExpanded","onTaskClick","pagination","onNextPage","onPrevPage"])])):(0,s.Q3)("",!0)]),l.showEditComplianceModal&&l.editingCompliance?((0,s.uX)(),(0,s.CE)("div",t9,[(0,s.Lk)("div",i9,[(0,s.Lk)("h3",null,"Edit & Resubmit Compliance: "+(0,d.v_)(l.editingCompliance.Identifier),1),(0,s.Lk)("button",{class:"close-btn",onClick:t[5]||(t[5]=(...e)=>n.closeEditComplianceModal&&n.closeEditComplianceModal(...e))},"Close"),(0,s.Lk)("div",null,[t[33]||(t[33]=(0,s.Lk)("label",null,"Description:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>l.editingCompliance.ExtractedData.ComplianceItemDescription=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.ComplianceItemDescription]])]),(0,s.Lk)("div",null,[t[35]||(t[35]=(0,s.Lk)("label",null,"Criticality:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.editingCompliance.ExtractedData.Criticality=e)},t[34]||(t[34]=[(0,s.Lk)("option",null,"High",-1),(0,s.Lk)("option",null,"Medium",-1),(0,s.Lk)("option",null,"Low",-1)]),512),[[a.u1,l.editingCompliance.ExtractedData.Criticality]])]),(0,s.Lk)("div",null,[t[36]||(t[36]=(0,s.Lk)("label",null,"Severity Rating:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.editingCompliance.ExtractedData.Impact=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.Impact]])]),(0,s.Lk)("div",null,[t[37]||(t[37]=(0,s.Lk)("label",null,"Probability:",-1)),(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.editingCompliance.ExtractedData.Probability=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.Probability]])]),(0,s.Lk)("div",null,[t[38]||(t[38]=(0,s.Lk)("label",null,"Mitigation:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[10]||(t[10]=e=>l.editingCompliance.ExtractedData.mitigation=e)},null,512),[[a.Jo,l.editingCompliance.ExtractedData.mitigation]])]),(0,s.Lk)("div",null,[t[39]||(t[39]=(0,s.Lk)("label",null,"Rejection Reason:",-1)),(0,s.Lk)("div",a9,(0,d.v_)(l.editingCompliance.ExtractedData.compliance_approval?.remarks),1)]),(0,s.Lk)("button",{class:"resubmit-btn",onClick:t[11]||(t[11]=e=>n.resubmitCompliance(l.editingCompliance))},"Resubmit for Review")])])):(0,s.Q3)("",!0),l.showDetailsModal&&l.selectedApproval?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"compliance-details-modal",onClick:t[17]||(t[17]=(...e)=>n.closeDetailsModal&&n.closeDetailsModal(...e))},[(0,s.Lk)("div",{class:"compliance-details-modal-content",onClick:t[16]||(t[16]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",s9,[(0,s.Lk)("button",{class:"close-btn",onClick:t[12]||(t[12]=(...e)=>n.closeDetailsModal&&n.closeDetailsModal(...e))},t[40]||(t[40]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)])),(0,s.Lk)("h3",null,[t[41]||(t[41]=(0,s.Lk)("span",{class:"detail-type-indicator"},"Compliance",-1)),"Change Status to Inactive"===l.selectedApproval.ExtractedData?.RequestType||"compliance_deactivation"===l.selectedApproval.ExtractedData?.type?((0,s.uX)(),(0,s.CE)("span",o9," Deactivation Request: "+(0,d.v_)(l.selectedApproval.Identifier),1)):((0,s.uX)(),(0,s.CE)("span",l9," Details: "+(0,d.v_)(l.selectedApproval.Identifier),1))])]),(0,s.Lk)("div",n9,[(0,s.Lk)("div",r9,[(0,s.Lk)("h4",null,["Change Status to Inactive"===l.selectedApproval.ExtractedData?.RequestType||"compliance_deactivation"===l.selectedApproval.ExtractedData?.type?((0,s.uX)(),(0,s.CE)("span",c9," Compliance Deactivation Approval ")):((0,s.uX)(),(0,s.CE)("span",d9," Compliance Approval "))]),(0,s.Lk)("div",u9,[(0,s.Lk)("button",{class:"submit-btn",onClick:t[13]||(t[13]=e=>n.submitReview())},t[42]||(t[42]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.Lk)("span",null,"Submit Review",-1)]))]),n.approvalStatus?((0,s.uX)(),(0,s.CE)("div",p9,[(0,s.Lk)("div",m9,[t[43]||(t[43]=(0,s.Lk)("div",{class:"status-label"},"Current Status:",-1)),(0,s.Lk)("div",{class:(0,d.C4)(["status-value",{approved:!0===n.approvalStatus.approved,rejected:!1===n.approvalStatus.approved,pending:null===n.approvalStatus.approved}])},(0,d.v_)(!0===n.approvalStatus.approved?"Approved":!1===n.approvalStatus.approved?"Rejected":"Pending Review"),3)]),l.selectedApproval.ApprovedDate?((0,s.uX)(),(0,s.CE)("div",v9,[t[44]||(t[44]=(0,s.Lk)("div",{class:"date-label"},[(0,s.Lk)("i",{class:"fas fa-calendar-check"}),(0,s.eW)(" Approved on: ")],-1)),(0,s.Lk)("div",k9,(0,d.v_)(n.formatDate(l.selectedApproval.ApprovedDate)),1)])):(0,s.Q3)("",!0),!1===n.approvalStatus.approved&&n.approvalStatus.remarks?((0,s.uX)(),(0,s.CE)("div",h9,[t[45]||(t[45]=(0,s.Lk)("div",{class:"remarks-label"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Rejection Reason: ")],-1)),(0,s.Lk)("div",g9,(0,d.v_)(n.approvalStatus.remarks),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)]),l.selectedApproval.ExtractedData?((0,s.uX)(),(0,s.CE)("div",y9,["Change Status to Inactive"===l.selectedApproval.ExtractedData?.RequestType||"compliance_deactivation"===l.selectedApproval.ExtractedData?.type?((0,s.uX)(),(0,s.CE)("div",f9,[(0,s.Lk)("div",b9,[t[46]||(t[46]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-question-circle"}),(0,s.eW)(" Reason for Deactivation: ")],-1)),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.reason||"No reason provided"),1)]),(0,s.Lk)("div",C9,[t[47]||(t[47]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Current Status: ")],-1)),(0,s.Lk)("span",L9,(0,d.v_)(l.selectedApproval.ExtractedData.current_status),1)]),(0,s.Lk)("div",w9,[t[48]||(t[48]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-arrow-right"}),(0,s.eW)(" Requested Status: ")],-1)),(0,s.Lk)("span",E9,(0,d.v_)(l.selectedApproval.ExtractedData.requested_status),1)]),(0,s.Lk)("div",R9,[t[49]||(t[49]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-sitemap"}),(0,s.eW)(" Cascade to Policies: ")],-1)),(0,s.Lk)("span",{class:(0,d.C4)(["cascade-indicator",{warning:"Yes"===l.selectedApproval.ExtractedData.cascade_to_policies}])},(0,d.v_)(l.selectedApproval.ExtractedData.cascade_to_policies),3)]),l.selectedApproval.ExtractedData.affected_policies_count>0?((0,s.uX)(),(0,s.CE)("div",I9,[t[50]||(t[50]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Affected Policies: ")],-1)),(0,s.Lk)("span",D9,(0,d.v_)(l.selectedApproval.ExtractedData.affected_policies_count)+" policies",1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",P9,[t[52]||(t[52]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.Lk)("span",null,[t[51]||(t[51]=(0,s.Lk)("strong",null,"Warning:",-1)),(0,s.eW)(" Deactivating this compliance will make it inactive. "+(0,d.v_)("Yes"===l.selectedApproval.ExtractedData.cascade_to_policies?"All related policies will also be deactivated.":"Related policies will not be affected."),1)])])])):((0,s.uX)(),(0,s.CE)("div",_9,[(0,s.Lk)("div",A9,[t[53]||(t[53]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-file-text"}),(0,s.eW)(" Description: ")],-1)),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.ComplianceItemDescription),1)]),(0,s.Lk)("div",S9,[t[54]||(t[54]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-exclamation"}),(0,s.eW)(" Criticality: ")],-1)),(0,s.Lk)("span",{class:(0,d.C4)(["criticality-badge",l.selectedApproval.ExtractedData.Criticality?.toLowerCase()])},(0,d.v_)(l.selectedApproval.ExtractedData.Criticality),3)]),(0,s.Lk)("div",T9,[t[55]||(t[55]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)(" Severity Rating: ")],-1)),(0,s.Lk)("span",x9,(0,d.v_)(l.selectedApproval.ExtractedData.Impact),1)]),(0,s.Lk)("div",F9,[t[56]||(t[56]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-percentage"}),(0,s.eW)(" Probability: ")],-1)),(0,s.Lk)("span",V9,(0,d.v_)(l.selectedApproval.ExtractedData.Probability),1)]),(0,s.Lk)("div",U9,[t[57]||(t[57]=(0,s.Lk)("strong",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Mitigation: ")],-1)),(0,s.Lk)("span",null,(0,d.v_)(l.selectedApproval.ExtractedData.mitigation),1)])])),(0,s.Lk)("div",N9,[(0,s.Lk)("button",{class:"approve-btn",onClick:t[14]||(t[14]=e=>n.approveCompliance())},t[58]||(t[58]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.Lk)("span",null,"Approve",-1)])),(0,s.Lk)("button",{class:"reject-btn",onClick:t[15]||(t[15]=e=>n.rejectCompliance())},t[59]||(t[59]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.Lk)("span",null,"Reject",-1)]))])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),l.showRejectModal?((0,s.uX)(),(0,s.CE)("div",M9,[(0,s.Lk)("div",X9,[t[62]||(t[62]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-times-circle"}),(0,s.eW)(" Rejection Reason Required ")],-1)),t[63]||(t[63]=(0,s.Lk)("p",null,"Please provide a detailed reason for rejecting this compliance item. This information will be used to improve future submissions.",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.rejectionComment=e),class:"rejection-comment",placeholder:"Enter your detailed comments here..."},"        ",512),[[a.Jo,l.rejectionComment]]),(0,s.Lk)("div",$9,[(0,s.Lk)("button",{class:"cancel-btn",onClick:t[19]||(t[19]=(...e)=>n.cancelRejection&&n.cancelRejection(...e))},t[60]||(t[60]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Cancel ")])),(0,s.Lk)("button",{class:"confirm-btn",onClick:t[20]||(t[20]=(...e)=>n.confirmRejection&&n.confirmRejection(...e))},t[61]||(t[61]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Confirm Rejection ")]))])])])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var j9={methods:{showSuccessPopup(e,t="Success"){Ck.OQ.success(e,t)},showErrorPopup(e,t="Error"){Ck.OQ.error(e,t)},showWarningPopup(e,t="Warning"){Ck.OQ.warning(e,t)},showInfoPopup(e,t="Information"){Ck.OQ.show({type:"info",heading:t,message:e,buttons:[{label:"OK",action:"ok"}]})},showConfirmPopup(e,t="Confirm",i,a){Ck.OQ.confirm(e,t,i,a)},showCommentPopup(e,t="Comment",i){Ck.OQ.comment(e,t,i)},showAutoClosePopup(e,t,i="info",a=3e3){Ck.OQ.show({type:i,heading:t,message:e,buttons:[{label:"OK",action:"ok"}],autoClose:a})},confirmDeactivateCompliance(e,t){const i=`Are you sure you want to deactivate "${e.ComplianceItemDescription||"this compliance"}"?`;this.showConfirmPopup(i,"Deactivate Compliance",t)},confirmEditCompliance(e,t){const i=`Are you sure you want to edit "${e.ComplianceItemDescription||"this compliance"}"? This will create a new version.`;this.showConfirmPopup(i,"Edit Compliance",t)},confirmCloneCompliance(e,t){const i=`Are you sure you want to clone "${e.ComplianceItemDescription||"this compliance"}"?`;this.showConfirmPopup(i,"Clone Compliance",t)},confirmDeleteCompliance(e,t){const i=`Are you sure you want to delete "${e.ComplianceItemDescription||"this compliance"}"? This action cannot be undone.`;this.showConfirmPopup(i,"Delete Compliance",t)},confirmActivateVersion(e,t){const i=`Are you sure you want to activate version ${e.ComplianceVersion||"this version"} of this compliance?`;this.showConfirmPopup(i,"Activate Version",t)},getRejectComments(e,t){const i=`Please provide a reason for rejecting "${e.ComplianceItemDescription||"this compliance"}":`;this.showCommentPopup(i,"Reject Compliance",t)},getDeactivationReason(e,t){const i=`Please provide a reason for deactivating "${e.ComplianceItemDescription||"this compliance"}":`;this.showCommentPopup(i,"Deactivation Reason",t)},showComplianceInfo(e){const t=e.ComplianceItemDescription||"No description available",i=e.Status||"Unknown",a=e.ComplianceVersion||"Unknown",s=`Status: ${i}\nVersion: ${a}\nDescription: ${t}`;this.showInfoPopup(s,"Compliance Information")},showAuditInfo(e){if(!e)return void this.showInfoPopup("No audit information available for this compliance.","Audit Information");const t=e.audit_performer_name||"Unknown",i=e.audit_approver_name||"Unknown",a=e.audit_date||"Unknown",s=e.audit_findings_status||"Unknown",o=`Performed by: ${t}\nApproved by: ${i}\nDate: ${a}\nStatus: ${s}`;this.showInfoPopup(o,"Audit Information")}}},B9={name:"ComplianceApprover",components:{PopupModal:Ck.wA,CollapsibleTable:zn},mixins:[j9],data(){return{approvals:[],selectedApproval:null,showRejectModal:!1,rejectionComment:"",rejectedCompliances:[],showEditComplianceModal:!1,editingCompliance:null,userId:2,isLoading:!1,error:null,counts:{pending:0,approved:0,rejected:0},refreshInterval:null,isLoadingRejected:!1,isDeactivationRequest:!1,collapsibleStates:{Pending:!0,Approved:!1,Rejected:!1,"Recently Approved":!1},pagination:{Pending:{currentPage:1,pageSize:10,totalCount:0},Approved:{currentPage:1,pageSize:10,totalCount:0},Rejected:{currentPage:1,pageSize:10,totalCount:0},"Recently Approved":{currentPage:1,pageSize:10,totalCount:0}},showDetailsModal:!1}},async mounted(){console.log("ComplianceApprover mounted"),await this.refreshData(),this.refreshInterval=setInterval(()=>{this.refreshData()},3e4),document.addEventListener("keydown",this.handleKeydown)},beforeUnmount(){this.refreshInterval&&clearInterval(this.refreshInterval),document.removeEventListener("keydown",this.handleKeydown)},watch:{complianceApprovals:{handler(){this.updatePaginationCounts()},deep:!0},approvedComplianceItems:{handler(){this.updatePaginationCounts()},deep:!0},rejectedCompliances:{handler(){this.updatePaginationCounts()},deep:!0}},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async refreshData(){if(!this.isLoading){this.isLoading=!0,this.error=null,console.log("Refreshing data...");try{const e=await I4.fv.getCompliancePolicyApprovals({reviewer_id:this.userId});if(console.log("Approvals response:",e),!e.data.success)throw new Error(e.data.message||"Failed to fetch approvals");{console.log("Raw approvals data:",e.data.data);const t=(e.data.data||[]).filter(e=>"compliance_deactivation"===e.ExtractedData?.type||"Change Status to Inactive"===e.ExtractedData?.RequestType||e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE"));console.log(`Found ${t.length} deactivation requests in the response:`,t),this.approvals=(e.data.data||[]).map(e=>({...e,ExtractedData:{...e.ExtractedData,type:e.ExtractedData?.type||"compliance",compliance_approval:e.ExtractedData?.compliance_approval||{approved:null,remarks:""}}})),this.counts=e.data.counts||{pending:0,approved:0,rejected:0};const i=this.approvals.filter(e=>!0===e.ApprovedNot);console.log(`Found ${i.length} approved compliances:`,i),console.log("Updated approvals:",this.approvals),console.log("Updated counts:",this.counts)}await this.loadRejectedCompliances(),this.updatePaginationCounts()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showApproveComplianceDenied();console.error("Error refreshing data:",e),this.error=e.response?.data?.message||e.message||"Failed to load approvals"}finally{this.isLoading=!1}}},openApprovalDetails(e){console.log("Opening approval details:",e),this.selectedApproval=e,this.showDetailsModal=!0},async submitReview(){this.showConfirmPopup("Do you want to approve this compliance item?","Compliance Review",()=>this.processApproval(!0),()=>this.showRejectPopup())},showRejectPopup(){this.showCommentPopup("Please provide a reason for rejecting this compliance:","Reject Compliance",e=>this.processApproval(!1,e))},async processApproval(e,t=""){try{if(!this.selectedApproval)return;this.isSubmitting=!0;let i=this.selectedApproval.ApprovalId;if("compliance_deactivation"===this.selectedApproval.ExtractedData?.type||"Change Status to Inactive"===this.selectedApproval.ExtractedData?.RequestType)e?await I4.fv.approveComplianceDeactivation(i,{user_id:this.userId}):await I4.fv.rejectComplianceDeactivation(i,{user_id:this.userId,remarks:t});else{let a=this.selectedApproval.ExtractedData;a.compliance_approval||(a.compliance_approval={}),a.compliance_approval.approved=e,a.compliance_approval.remarks=t,await I4.fv.submitComplianceReview(i,{ExtractedData:a,ApprovedNot:e})}D4.reviewSubmitted(e),this.approvalStatus={approved:e,remarks:t},this.refreshData()}catch(i){console.error("Error submitting review:",i),this.showErrorPopup(`Error submitting review: ${i.message||"Unknown error"}`)}finally{this.isSubmitting=!1}},async approveCompliance(){if(this.selectedApproval)try{this.isLoading=!0,console.log("Starting approval process for compliance ID:",this.selectedApproval.ApprovalId);const t="compliance_deactivation"===this.selectedApproval.ExtractedData?.type||"Change Status to Inactive"===this.selectedApproval.ExtractedData?.RequestType||this.selectedApproval.Identifier&&this.selectedApproval.Identifier.includes("COMP-DEACTIVATE");let i;if(console.log(`This is ${t?"a":"not a"} deactivation request`),t)console.log("Processing deactivation approval..."),i=await I4.fv.approveComplianceDeactivation(this.selectedApproval.ApprovalId,{user_id:this.userId}),this.selectedApproval.ExtractedData&&(this.selectedApproval.ExtractedData.current_status="Inactive",this.selectedApproval.ExtractedData.compliance_approval&&(this.selectedApproval.ExtractedData.compliance_approval.approved=!0));else{this.selectedApproval.ExtractedData.compliance_approval||(this.selectedApproval.ExtractedData.compliance_approval={}),this.selectedApproval.ExtractedData.compliance_approval.approved=!0,this.selectedApproval.ExtractedData.compliance_approval.remarks="",this.selectedApproval.ApprovedNot=!0,this.selectedApproval.ExtractedData.Status="Approved",this.selectedApproval.ExtractedData.ActiveInactive="Active",console.log("Approving compliance with data:",JSON.stringify(this.selectedApproval.ExtractedData));const t={ExtractedData:this.selectedApproval.ExtractedData,ApprovedNot:!0};try{i=await I4.fv.submitComplianceReview(this.selectedApproval.ApprovalId,t)}catch(e){if(console.error("API call failed:",e),"Network Error"!==e.message&&"ERR_NETWORK"!==e.code)throw e;{console.log("Retrying with simplified payload due to network error");const e={approved:!0,remarks:""};i=await I4.fv.submitComplianceReview(this.selectedApproval.ApprovalId,e)}}}if(console.log("Approval response:",i?.data),this.selectedApproval.Identifier){console.log(`Checking if identifier ${this.selectedApproval.Identifier} exists in rejected list...`);const e=this.rejectedCompliances.length;this.rejectedCompliances=this.rejectedCompliances.filter(e=>e.Identifier!==this.selectedApproval.Identifier);const t=this.rejectedCompliances.length;e>t&&console.log(`Removed ${e-t} item(s) with identifier ${this.selectedApproval.Identifier} from rejected list`)}this.showSuccessPopup(t?"Compliance has been deactivated successfully!":"Compliance has been approved successfully!",t?"Deactivation Complete":"Approval Complete"),this.closeDetailsModal(),setTimeout(()=>{this.refreshData()},1e3)}catch(t){console.error("Error approving compliance:",t),this.showErrorPopup("Error approving compliance: "+(t.response?.data?.message||t.message||"Network error - please check server connection"),"Approval Error")}finally{this.isLoading=!1}},rejectCompliance(){const e="compliance_deactivation"===this.selectedApproval?.ExtractedData?.type||"Change Status to Inactive"===this.selectedApproval?.ExtractedData?.RequestType||this.selectedApproval?.Identifier&&this.selectedApproval?.Identifier.includes("COMP-DEACTIVATE");this.isDeactivationRequest=e,this.showRejectModal=!0},async confirmRejection(){if(this.rejectionComment.trim())try{let e;this.isLoading=!0,console.log("Starting rejection process for compliance ID:",this.selectedApproval.ApprovalId),this.isDeactivationRequest?(console.log("Processing deactivation rejection..."),e=await I4.fv.rejectComplianceDeactivation(this.selectedApproval.ApprovalId,{user_id:this.userId,remarks:this.rejectionComment}),this.selectedApproval.ExtractedData&&(this.selectedApproval.ExtractedData.current_status="Active",this.selectedApproval.ExtractedData.compliance_approval&&(this.selectedApproval.ExtractedData.compliance_approval.approved=!1,this.selectedApproval.ExtractedData.compliance_approval.remarks=this.rejectionComment))):(this.selectedApproval.ExtractedData.compliance_approval||(this.selectedApproval.ExtractedData.compliance_approval={}),this.selectedApproval.ExtractedData.compliance_approval.approved=!1,this.selectedApproval.ExtractedData.compliance_approval.remarks=this.rejectionComment,this.selectedApproval.ApprovedNot=!1,this.selectedApproval.ExtractedData.Status="Rejected",this.selectedApproval.ExtractedData.ActiveInactive="Inactive",console.log("Rejecting compliance with data:",JSON.stringify(this.selectedApproval.ExtractedData)),e=await I4.fv.submitComplianceReview(this.selectedApproval.ApprovalId,{ExtractedData:this.selectedApproval.ExtractedData,ApprovedNot:!1})),console.log("Rejection response:",e.data),this.showSuccessPopup(this.isDeactivationRequest?"Deactivation request has been rejected successfully!":"Compliance has been rejected successfully!","Rejection Complete"),this.showRejectModal=!1,this.rejectionComment="",this.closeDetailsModal(),setTimeout(()=>{this.refreshData()},1e3)}catch(e){console.error("Error rejecting compliance:",e),this.showErrorPopup("Error rejecting compliance: "+(e.response?.data?.message||e.message),"Rejection Error")}finally{this.isLoading=!1}else alert("Please provide a reason for rejection")},cancelRejection(){this.showRejectModal=!1,this.rejectionComment=""},openRejectedItem(e){console.log("Opening rejected item:",e),this.editingCompliance=JSON.parse(JSON.stringify(e)),this.showEditComplianceModal=!0,console.log("Opened rejected item in edit modal:",{ApprovalId:this.editingCompliance.ApprovalId,Identifier:this.editingCompliance.Identifier,ApprovedNot:this.editingCompliance.ApprovedNot,remarks:this.editingCompliance.ExtractedData?.compliance_approval?.remarks})},closeEditComplianceModal(){this.showEditComplianceModal=!1,this.editingCompliance=null},async resubmitCompliance(e){try{e.ExtractedData.compliance_approval?(e.ExtractedData.compliance_approval.approved=null,e.ExtractedData.compliance_approval.remarks="",e.ExtractedData.compliance_approval.inResubmission=!0):e.ExtractedData.compliance_approval={approved:null,remarks:"",inResubmission:!0},this.isLoading=!0,console.log("Resubmitting compliance with ID:",e.ApprovalId),console.log("Resubmitting with data:",JSON.stringify(e.ExtractedData));const t=await I4.fv.resubmitComplianceApproval(e.ApprovalId,{ExtractedData:e.ExtractedData});if(console.log("Resubmission response:",t),!t.data||!t.data.ApprovalId&&!t.data.success)throw new Error("Failed to get confirmation from server");this.rejectedCompliances=this.rejectedCompliances.filter(t=>t.ApprovalId!==e.ApprovalId),this.showEditComplianceModal=!1,this.editingCompliance=null,this.showSuccessPopup("Compliance resubmitted for review successfully!","Resubmission Complete"),console.log(`Resubmitted compliance with ID ${e.ApprovalId}. New version: ${t.data.Version}`),setTimeout(()=>{this.refreshData()},1e3)}catch(t){console.error("Error resubmitting compliance:",t),this.showErrorPopup("Error resubmitting compliance: "+(t.response?.data?.message||t.message),"Resubmission Error")}finally{this.isLoading=!1}},formatDate(e){if(!e)return"";try{let t;if("string"===typeof e)if(e.includes("T"))t=new Date(e);else if(e.includes("-")){const i=e.split(" ")[0].split("-");t=new Date(i[0],i[1]-1,i[2])}else if(e.includes("/")){const i=e.split(" ")[0].split("/");t=new Date(i[2],i[0]-1,i[1])}else t=new Date(e);else t=new Date(e);return t.toLocaleString()}catch(t){return console.error("Error formatting date:",t),e}},async checkForApprovedIdentifiers(){if(0===this.rejectedCompliances.length)return;const e=this.rejectedCompliances.map(e=>e.Identifier);console.log("Checking rejected identifiers for approved status:",e),this.rejectedCompliances=this.rejectedCompliances.filter(e=>{const t=this.isCompliantIdentifierApproved(e.Identifier);return t&&console.log(`Found approved item with identifier ${e.Identifier}, removing from rejected list`),!t})},isCompliantIdentifierApproved(e){return this.approvals.some(t=>t.Identifier===e&&!0===t.ApprovedNot)},async loadRejectedCompliances(){try{this.isLoadingRejected=!0,console.log(`Loading rejected compliances for reviewer_id: ${this.userId}`);const e=await I4.fv.getComplianceRejectedApprovals(this.userId);if(console.log("Rejected compliances response:",e),e.data){let t=e.data.filter(e=>!1===e.ApprovedNot&&e.Identifier&&!e.ExtractedData?.compliance_approval?.inResubmission).sort((e,t)=>e.ApprovalId&&t.ApprovalId?t.ApprovalId-e.ApprovalId:0);console.log("Filtered rejected compliances:",t);const i=new Set;this.rejectedCompliances=t.filter(e=>{if(!i.has(e.Identifier)){i.add(e.Identifier);const t=this.approvals.some(t=>t.Identifier===e.Identifier&&!0===t.ApprovedNot);return!t}return!1}),console.log("Final rejected compliances list:",this.rejectedCompliances)}}catch(e){console.error("Error fetching rejected compliances:",e)}finally{this.isLoadingRejected=!1,this.updatePaginationCounts()}},mapApprovalToRow(e){return{...e,Identifier:e.Identifier,Description:e.ExtractedData?.ComplianceItemDescription||e.ExtractedData?.reason||"No Description",Criticality:e.ExtractedData?.Criticality||"N/A",CreatedBy:e.ExtractedData?.CreatedByName||"System",Version:e.ExtractedData?.ComplianceVersion||e.ExtractedData?.version||"1.0",actions:e}},mapRejectedToRow(e){return{...e,Identifier:e.Identifier,Description:e.ExtractedData?.ComplianceItemDescription||"No Description",Criticality:e.ExtractedData?.Criticality||"N/A",CreatedBy:e.ExtractedData?.CreatedByName||"System",Version:e.ExtractedData?.ComplianceVersion||e.ExtractedData?.version||"1.0",actions:e}},handleApprovalAction(e){this.selectedApproval=e,this.showDetailsModal=!0},handleRejectedAction(e){this.openRejectedItem(e)},toggleSection(e){this.collapsibleStates={...this.collapsibleStates,[e]:!this.collapsibleStates[e]}},handlePaginationChange(e,t){console.log(`Pagination change for section "${e}":`,{old:this.pagination[e],new:t}),this.pagination[e]=t,console.log(`Updated pagination for section "${e}":`,this.pagination[e])},getPaginatedTasks(e,t){const i=this.pagination[t],a=(i.currentPage-1)*i.pageSize,s=a+i.pageSize;return e.slice(a,s)},updatePaginationCounts(){const e=this.complianceApprovals.length,t=this.approvedComplianceItems.length,i=this.rejectedCompliances.length;this.pagination.Pending.totalCount=Math.max(e,1),this.pagination.Approved.totalCount=Math.max(t,1),this.pagination.Rejected.totalCount=Math.max(i,1),this.pagination["Recently Approved"].totalCount=Math.max(t,1),console.log("Updated pagination counts:",{Pending:this.pagination.Pending.totalCount,Approved:this.pagination.Approved.totalCount,Rejected:this.pagination.Rejected.totalCount,"Recently Approved":this.pagination["Recently Approved"].totalCount}),console.log("Current pagination state:",this.pagination)},resetPagination(){Object.keys(this.pagination).forEach(e=>{this.pagination[e].currentPage=1})},testPagination(){console.log("Testing pagination..."),console.log("Current pagination state:",this.pagination),console.log("Compliance approvals count:",this.complianceApprovals.length),console.log("Approved items count:",this.approvedComplianceItems.length),console.log("Rejected compliances count:",this.rejectedCompliances.length),this.updatePaginationCounts()},closeDetailsModal(){this.showDetailsModal=!1,this.selectedApproval=null},handleKeydown(e){"Escape"===e.key&&this.showDetailsModal&&this.closeDetailsModal()}},computed:{pendingApprovalsCount(){return this.counts.pending||0},approvedApprovalsCount(){return this.counts.approved||0},rejectedApprovalsCount(){return this.counts.rejected||0},complianceApprovals(){console.log("Computing complianceApprovals from",this.approvals.length,"total approvals"),console.log("All approvals:"),this.approvals.forEach((e,t)=>{if(!e)return void console.log(`[${t}] Approval is null or undefined`);if(console.log(`[${t}] ID: ${e.ApprovalId}, Identifier: ${e.Identifier}`),!e.ExtractedData)return void console.log("    WARNING: ExtractedData is null or undefined");console.log(`    Type: ${e.ExtractedData?.type}, RequestType: ${e.ExtractedData?.RequestType}`),console.log(`    ApprovedNot: ${e.ApprovedNot}`);const i="compliance_deactivation"===e.ExtractedData?.type||"Change Status to Inactive"===e.ExtractedData?.RequestType||e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE");console.log(`    Is deactivation request: ${i}`),i&&console.log("    Deactivation request details:",JSON.stringify({reason:e.ExtractedData?.reason,compliance_id:e.ExtractedData?.compliance_id,current_status:e.ExtractedData?.current_status,requested_status:e.ExtractedData?.requested_status}))});const e=this.approvals.filter(e=>{if(!e)return console.log("Skipping null approval"),!1;if(!e.ExtractedData)return console.log(`Approval ${e.ApprovalId||"unknown"}: ExtractedData is missing`),!1;const t="compliance"===e.ExtractedData?.type||"compliance_deactivation"===e.ExtractedData?.type||e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE"),i=null===e.ApprovedNot;return"compliance_deactivation"===e.ExtractedData?.type&&console.log(`Found deactivation by type: ${e.Identifier}`),"Change Status to Inactive"===e.ExtractedData?.RequestType&&console.log(`Found deactivation by RequestType: ${e.Identifier}`),e.Identifier&&e.Identifier.includes("COMP-DEACTIVATE")&&console.log(`Found deactivation by Identifier: ${e.Identifier}`),console.log(`Approval ${e.ApprovalId}: isCompliance=${t}, isPending=${i}`),t&&i});console.log(`Filtered to ${e.length} pending compliance approvals`);const t=this.approvals.filter(e=>"compliance_deactivation"===e?.ExtractedData?.type||"Change Status to Inactive"===e?.ExtractedData?.RequestType||e?.Identifier&&e?.Identifier.includes("COMP-DEACTIVATE"));return t.length>0&&!e.some(e=>"compliance_deactivation"===e?.ExtractedData?.type||"Change Status to Inactive"===e?.ExtractedData?.RequestType||e?.Identifier&&e?.Identifier.includes("COMP-DEACTIVATE"))&&(console.warn("WARNING: Deactivation requests exist but none passed the filter!"),t.forEach(e=>{console.log(`Deactivation request ${e.ApprovalId} with ApprovedNot=${e.ApprovedNot}`),null!==e.ApprovedNot&&console.log(`This request was filtered because ApprovedNot=${e.ApprovedNot}`)})),e},approvalStatus(){return this.selectedApproval&&this.selectedApproval.ExtractedData?this.selectedApproval.ExtractedData.compliance_approval||{approved:null,remarks:""}:null},approvedComplianceItems(){console.log("Computing approvedComplianceItems from approvals:",this.approvals);const e=this.approvals.filter(e=>{const t=!0===e.ApprovedNot,i="compliance"===e.ExtractedData?.type;return t&&console.log(`Approval ${e.ApprovalId} is approved:`,{isCompliance:i,type:e.ExtractedData?.type,ApprovedNot:e.ApprovedNot}),t&&i});return console.log(`Found ${e.length} approved compliance items`),e},groupedApprovals(){const e={Pending:[],Approved:[],Rejected:[]};return this.approvals.forEach(t=>{null===t.ApprovedNot?e.Pending.push(t):!0===t.ApprovedNot?e.Approved.push(t):!1===t.ApprovedNot&&e.Rejected.push(t)}),e},approvalTableHeaders(){return[{key:"Identifier",label:"Identifier"},{key:"Description",label:"Description"},{key:"Criticality",label:"Criticality"},{key:"CreatedBy",label:"Created By"},{key:"Version",label:"Version"},{key:"actions",label:"Actions"}]},rejectedTableHeaders(){return[{key:"Identifier",label:"Identifier"},{key:"Description",label:"Description"},{key:"Criticality",label:"Criticality"},{key:"CreatedBy",label:"Created By"},{key:"Version",label:"Version"},{key:"actions",label:"Actions"}]}}};const W9=(0,le.A)(B9,[["render",O9],["__scopeId","data-v-4c6ff19c"]]);var q9=W9;const Q9={class:"compliance-container"},K9={key:0,class:"compliance-loading-spinner"},J9={key:1,class:"breadcrumbs"},z9=["onClick"],H9={class:"compliance-content-wrapper"},G9={class:"compliance-card-grid"},Y9=["onClick"],Z9={class:"compliance-card-icon"},eee={class:"compliance-card-content"},tee={class:"compliance-card-title"},iee={class:"compliance-card-category"},aee={class:"compliance-card-desc"},see={class:"compliance-version-info"},oee={class:"compliance-card-actions"},lee=["onClick"],nee={class:"compliance-section-header"},ree={class:"compliance-card-grid"},cee=["onClick"],dee={class:"compliance-card-icon"},uee={class:"compliance-card-content"},pee={class:"compliance-card-title"},mee={class:"compliance-card-category"},vee={class:"compliance-card-desc"},kee={class:"compliance-version-info"},hee={class:"compliance-card-actions"},gee=["onClick"],yee={class:"compliance-section-header"},fee={class:"compliance-card-grid"},bee=["onClick"],Cee={class:"compliance-card-icon"},Lee={class:"compliance-card-content"},wee={class:"compliance-card-title"},Eee={class:"compliance-card-category"},Ree={class:"compliance-card-desc"},Iee={class:"compliance-metadata"},Dee={class:"compliance-card-actions"},Pee=["onClick"],_ee={class:"compliance-section-header"},Aee={class:"compliance-section-actions"},See={class:"compliance-inline-export-controls"},Tee={key:0,class:"compliance-loading-spinner"},xee={key:1,class:"compliance-no-data"},Fee={key:2,class:"compliance-grid"},Vee=["onClick"],Uee={class:"compliance-header"},Nee={class:"compliance-body"},Mee={class:"compliance-details"},Xee={class:"compliance-detail-row"},$ee={class:"compliance-value"},Oee={class:"compliance-detail-row"},jee={class:"compliance-value"},Bee={class:"compliance-detail-row"},Wee={class:"compliance-value"},qee={key:0,class:"compliance-detail-row"},Qee={key:0,class:"expanded-details"},Kee={class:"expanded-details-grid"},Jee={class:"expanded-section-box"},zee={class:"expanded-content-box"},Hee={key:1,class:"empty-value"},Gee={class:"expanded-section-box"},Yee={class:"expanded-content-box"},Zee={key:1,class:"empty-value"},ete={class:"expanded-section-box"},tte={class:"expanded-content-box"},ite={key:1,class:"empty-value"},ate={class:"expanded-section-box"},ste={class:"expanded-content-box"},ote={key:1,class:"empty-value"},lte={class:"expanded-section-box"},nte={class:"expanded-content-box"},rte={key:1,class:"empty-value"},cte={class:"expanded-section-box"},dte={class:"expanded-content-box"},ute={class:"expanded-section-box"},pte={class:"expanded-content-box"},mte={class:"expanded-section-box"},vte={class:"expanded-content-box"},kte={key:1,class:"empty-value"},hte={class:"expanded-section-box"},gte={class:"expanded-content-box"},yte={key:1,class:"empty-value"},fte={class:"expanded-section-box"},bte={class:"expanded-content-box"},Cte={key:1,class:"empty-value"},Lte={class:"expanded-section-box"},wte={class:"expanded-content-box"},Ete={key:0,class:"mitigation-text"},Rte={key:1,class:"empty-value"},Ite={class:"expanded-section-box"},Dte={class:"expanded-content-box"},Pte={key:1,class:"empty-value"},_te={class:"expanded-section-box"},Ate={class:"expanded-content-box"},Ste={key:1,class:"empty-value"},Tte={class:"expanded-section-box"},xte={class:"expanded-content-box"},Fte={key:1,class:"empty-value"},Vte={class:"expanded-section-box"},Ute={class:"expanded-content-box"},Nte={key:1,class:"empty-value"},Mte={class:"expanded-section-box"},Xte={class:"expanded-content-box"},$te={key:1,class:"empty-value"},Ote={class:"expanded-section-box"},jte={class:"expanded-content-box"},Bte={class:"expanded-section-box"},Wte={class:"expanded-content-box"},qte={class:"compliance-footer"},Qte={class:"created-info"},Kte={class:"identifier"},Jte={key:3,class:"compliance-list-view"},zte={class:"compliance-dynamic-table-wrapper"},Hte=["onClick"],Gte=["onClick"],Yte={key:2,class:"modal"},Zte={class:"modal-content"},eie={class:"modal-header"},tie={class:"modal-body"},iie={key:0,class:"no-versions"},aie={key:1,class:"version-grid"},sie={class:"version-header"},oie={class:"version-number"},lie={class:"version-badges"},nie={class:"version-details"},rie={class:"version-desc"},cie={class:"version-info-grid"},die={class:"info-group"},uie={class:"info-value"},pie={class:"info-group"},mie={class:"info-value"},vie={class:"info-group"},kie={key:0,class:"info-group"},hie={class:"version-metadata"};var gie={__name:"AllCompliance",setup(e){const t=(0,ie.KR)([]),i=(0,ie.KR)(null),o=(0,ie.KR)(null),l=(0,ie.KR)(null),n=(0,ie.KR)(!1),r=(0,ie.KR)([]),c=(0,ie.KR)([]),u=(0,ie.KR)([]),p=(0,ie.KR)(!1),m=(0,ie.KR)(null),v=(0,ie.KR)(""),k=(0,ie.KR)("xlsx"),h=(0,ie.KR)("list"),g=(0,ie.KR)(null),y=(0,ae.rd)(),f=[{key:"identifier",label:"ID",sortable:!0},{key:"name",label:"Control",sortable:!0},{key:"status",label:"Status",sortable:!0},{key:"category",label:"Criticality",sortable:!0},{key:"maturityLevel",label:"Maturity Level",sortable:!0},{key:"mandatoryOptional",label:"Type",sortable:!0},{key:"version",label:"Version",sortable:!0},{key:"createdBy",label:"Created By",sortable:!0},{key:"createdDate",label:"Created Date",sortable:!0}],b=(0,s.EW)(()=>{const e=[];return i.value&&e.push({id:0,name:i.value.name}),o.value&&e.push({id:1,name:o.value.name}),l.value&&e.push({id:2,name:l.value.name}),e}),C=(0,s.EW)(()=>!i.value),L=(0,s.EW)(()=>i.value&&!o.value),w=(0,s.EW)(()=>o.value&&!l.value),E=(0,s.EW)(()=>l.value&&l.value.compliances&&l.value.compliances.length>0),R=(0,s.EW)(()=>l.value&&l.value.compliances?l.value.compliances:[]);async function I(e){try{p.value=!0,i.value=e,o.value=null,l.value=null;const t=await He.A.get("/api/compliance/all-policies/policies/",{params:{framework_id:e.id}});t.data&&Array.isArray(t.data)?c.value=t.data.map(e=>({...e,versions:e.versions||[]})):c.value=[]}catch(t){if(t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showViewAllComplianceDenied();m.value="Failed to load policies",console.error("Error fetching policies:",t),c.value=[],Ck.OQ.error("Failed to load policies. Please try selecting a different framework.","Loading Error")}finally{p.value=!1}}async function D(e){try{p.value=!0,o.value=e,l.value=null;const t=await He.A.get("/api/compliance/all-policies/subpolicies/",{params:{policy_id:e.id}});t.data&&Array.isArray(t.data)?u.value=t.data:u.value=[]}catch(t){if(t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showViewAllComplianceDenied();m.value="Failed to load subpolicies",console.error("Error fetching subpolicies:",t),u.value=[],Ck.OQ.error("Failed to load subpolicies. Please try selecting a different policy.","Loading Error")}finally{p.value=!1}}async function P(e){try{p.value=!0,l.value=e;const t=await He.A.get(`/api/compliance/all-policies/subpolicies/${e.id}/compliances/`);if(console.log("Subpolicy compliances response:",t.data),t.data&&t.data.success){if(t.data.compliances.length>0){const e=t.data.compliances[0];console.log("DETAILED COMPLIANCE OBJECT:",JSON.stringify(e,null,2)),console.log("COMPLIANCE FIELD VALUES:"),Object.keys(e).forEach(t=>{console.log(`- ${t}: ${JSON.stringify(e[t])}`)})}l.value={...e,compliances:t.data.compliances.map(e=>({id:e.ComplianceId,name:e.ComplianceItemDescription,description:e.ComplianceItemDescription,status:e.Status,category:e.Criticality,maturityLevel:e.MaturityLevel,mandatoryOptional:e.MandatoryOptional,manualAutomatic:e.ManualAutomatic,createdBy:e.CreatedByName,createdDate:e.CreatedByDate,identifier:e.Identifier,version:e.ComplianceVersion,isRisk:e.IsRisk,PossibleDamage:e.PossibleDamage,mitigation:e.mitigation,SeverityRating:e.Impact,Probability:e.Probability,PermanentTemporary:e.PermanentTemporary,ActiveInactive:e.ActiveInactive,originalData:e}))}}else l.value.compliances=[]}catch(t){if(t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showViewAllComplianceDenied();console.error("Error fetching subpolicy compliances:",t),m.value="Failed to load compliances",l.value.compliances=[]}finally{p.value=!1}}function _(){n.value=!1,r.value=[],v.value=""}function A(e){e<=0?(i.value=null,o.value=null,l.value=null):1===e?(o.value=null,l.value=null):2===e&&(l.value=null)}function S(e){return e?new Date(e).toLocaleDateString():"N/A"}function T(e){switch((e||"").toLowerCase()){case"governance":return"fas fa-shield-alt";case"access control":return"fas fa-user-shield";case"asset management":return"fas fa-boxes";case"cryptography":return"fas fa-key";case"data management":return"fas fa-database";case"device management":return"fas fa-mobile-alt";case"risk management":return"fas fa-exclamation-triangle";case"supplier management":return"fas fa-handshake";case"business continuity":return"fas fa-business-time";case"privacy":return"fas fa-user-secret";case"system protection":return"fas fa-shield-virus";case"incident response":return"fas fa-ambulance";default:return"fas fa-file-alt"}}function x(e){if(!e)return"";const t=e.toLowerCase();return t.includes("active")?"active":t.includes("inactive")?"inactive":t.includes("pending")?"pending":""}(0,s.sV)(async()=>{try{p.value=!0,console.log("Fetching frameworks...");const e=await He.A.get("/api/compliance/all-policies/frameworks/");console.log("Frameworks response:",e.data),e.data&&Array.isArray(e.data)?(t.value=e.data.map(e=>({id:e.id,name:e.name,category:e.category||"General",status:e.status||"Active",description:e.description||"",versions:e.versions||[]})),console.log("Processed frameworks:",t.value)):(console.error("Invalid frameworks response format:",e.data),t.value=[],m.value="Invalid response format from server")}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showViewAllComplianceDenied();m.value="Failed to load frameworks",console.error("Error fetching frameworks:",e.response?.data||e.message),t.value=[],Ck.OQ.error("Failed to load frameworks. Please refresh the page and try again.","Loading Error")}finally{p.value=!1}});const F=(e,t,i)=>{y.push({name:"ComplianceView",params:{type:e,id:t,name:encodeURIComponent(i)}})};async function V(e){try{if(!l.value)return void Ck.OQ.warning("No subpolicy selected for export","Export Warning");const t="subpolicy",i=l.value.SubPolicyId;Ck.OQ.confirm(`Do you want to export ${l.value.name} controls to ${e.toUpperCase()} format?`,"Confirm Export",async()=>{console.log(`Attempting export for ${t} ${i} in ${e} format`),Ck.OQ.success("Export is being processed. This may take a few moments...","Processing Export");try{const a=await(0,He.A)({url:`/api/compliance/export/all-compliances/${e}/${t}/${i}/`,method:"GET",responseType:"blob",timeout:3e4,headers:{Accept:"application/json, application/pdf, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, application/xml"}}),s=a.headers["content-type"],o=new Blob([a.data],{type:s});let l=`compliances_${t}_${i}.${e}`;const n=a.headers["content-disposition"];n&&n.includes("filename=")&&(l=n.split("filename=")[1].replace(/"/g,""));const r=document.createElement("a");r.href=URL.createObjectURL(o),r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),Ck.OQ.success(`Export completed successfully! File: ${l}`,"Export Complete")}catch(a){if(a.response&&[401,403].includes(a.response.status))return void Tr.Ay.showViewAllComplianceDenied();console.error("Export error:",a);const e=a.response?.data?.message||a.message||"Failed to export compliances";Ck.OQ.error(`Export failed: ${e}`,"Export Error")}},()=>{Ck.OQ.success("Export cancelled","Cancelled")})}catch(m){console.error("Export error:",m);const t=m.response?.data?.message||m.message||"Failed to export compliances";Ck.OQ.error(`Export failed: ${t}`,"Export Error")}}const U=()=>{h.value="card"===h.value?"list":"card"},N=e=>{g.value===e.id?g.value=null:g.value=e.id},M=e=>{if(!e)return"Not specified";if("string"===typeof e&&(e.startsWith("[")||e.startsWith("{")))try{const t=JSON.parse(e);return Array.isArray(t)?t.map((e,t)=>`${t+1}. ${e}`).join("\n"):"object"===typeof t?t.steps&&Array.isArray(t.steps)?t.steps.map((e,t)=>`${t+1}. ${e}`).join("\n"):t.description?t.description:Object.entries(t).map(([e,t])=>`${e}: ${t}`).join("\n"):String(t)}catch(t){return e}return e};function X(e){Ck.OQ.info(`View compliance: ${e.name}`,"View Compliance")}function $(e){Ck.OQ.info(`Edit compliance: ${e.name}`,"Edit Compliance")}return(e,m)=>((0,s.uX)(),(0,s.CE)("div",Q9,[m[42]||(m[42]=(0,s.Lk)("div",{class:"custom-header"},[(0,s.Lk)("span",null,"Control Management"),(0,s.Lk)("div",{class:"custom-header-underline"})],-1)),p.value?((0,s.uX)(),(0,s.CE)("div",K9,m[2]||(m[2]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading...",-1)]))):(0,s.Q3)("",!0),b.value.length>0?((0,s.uX)(),(0,s.CE)("div",J9,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(b.value,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"breadcrumb-chip"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",{class:"breadcrumb-close",onClick:e=>A(t)},"×",8,z9)]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",H9,[C.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[m[4]||(m[4]=(0,s.Lk)("div",{class:"compliance-section-header"},"Frameworks",-1)),(0,s.Lk)("div",G9,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>I(e)},[(0,s.Lk)("div",Z9,[(0,s.Lk)("i",{class:(0,d.C4)(T(e.category))},null,2)]),(0,s.Lk)("div",eee,[(0,s.Lk)("div",tee,(0,d.v_)(e.name),1),(0,s.Lk)("div",iee,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",aee,(0,d.v_)(e.description),1),(0,s.Lk)("div",see,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",oee,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,a.D$)(t=>F("framework",e.id,e.name),["stop"])},m[3]||(m[3]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Controls ")]),8,lee)])])],8,Y9))),128))])],64)):L.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",nee,"Policies in "+(0,d.v_)(i.value.name),1),(0,s.Lk)("div",ree,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>D(e)},[(0,s.Lk)("div",dee,[(0,s.Lk)("i",{class:(0,d.C4)(T(e.category))},null,2)]),(0,s.Lk)("div",uee,[(0,s.Lk)("div",pee,(0,d.v_)(e.name),1),(0,s.Lk)("div",mee,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",vee,(0,d.v_)(e.description),1),(0,s.Lk)("div",kee,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",hee,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,a.D$)(t=>F("policy",e.id,e.name),["stop"])},m[5]||(m[5]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Controls ")]),8,gee)])])],8,cee))),128))])],64)):w.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",yee,"Subpolicies in "+(0,d.v_)(o.value.name),1),(0,s.Lk)("div",fee,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(u.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>P(e)},[(0,s.Lk)("div",Cee,[(0,s.Lk)("i",{class:(0,d.C4)(T(e.category))},null,2)]),(0,s.Lk)("div",Lee,[(0,s.Lk)("div",wee,(0,d.v_)(e.name),1),(0,s.Lk)("div",Eee,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",Ree,(0,d.v_)(e.description),1),(0,s.Lk)("div",Iee,[(0,s.Lk)("span",null,"Control: "+(0,d.v_)(e.control),1),(0,s.Lk)("span",null,(0,d.v_)(e.permanent_temporary),1)]),(0,s.Lk)("div",Dee,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,a.D$)(t=>F("subpolicy",e.id,e.name),["stop"])},m[6]||(m[6]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Controls ")]),8,Pee)])])],8,bee))),128))])],64)):l.value?((0,s.uX)(),(0,s.CE)(s.FK,{key:3},[(0,s.Lk)("div",_ee,[(0,s.Lk)("span",null,"Compliances in "+(0,d.v_)(l.value.name),1),(0,s.Lk)("div",Aee,[(0,s.Lk)("div",See,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":m[0]||(m[0]=e=>k.value=e),class:"compliance-format-select"},m[7]||(m[7]=[(0,s.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option>',5)]),512),[[a.u1,k.value]]),(0,s.Lk)("button",{class:"compliance-export-btn",onClick:m[1]||(m[1]=e=>V(k.value))},m[8]||(m[8]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")]))]),(0,s.Lk)("button",{class:"compliance-view-toggle-btn small-view-toggle",onClick:U},[(0,s.Lk)("i",{class:(0,d.C4)("card"===h.value?"fas fa-list":"fas fa-th-large")},null,2),(0,s.eW)(" "+(0,d.v_)("card"===h.value?"List View":"Card View"),1)])])]),p.value?((0,s.uX)(),(0,s.CE)("div",Tee,m[9]||(m[9]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading controls...",-1)]))):E.value?"card"===h.value?((0,s.uX)(),(0,s.CE)("div",Fee,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(R.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>N(e)},[(0,s.Lk)("div",Uee,[(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality-badge","compliance-criticality-"+e.category.toLowerCase()])},(0,d.v_)(e.category),3)]),(0,s.Lk)("div",Nee,[(0,s.Lk)("h3",null,(0,d.v_)(e.name),1),(0,s.Lk)("div",Mee,[(0,s.Lk)("div",Xee,[m[11]||(m[11]=(0,s.Lk)("span",{class:"compliance-label"},"Maturity Level:",-1)),(0,s.Lk)("span",$ee,(0,d.v_)(e.maturityLevel),1)]),(0,s.Lk)("div",Oee,[m[12]||(m[12]=(0,s.Lk)("span",{class:"compliance-label"},"Type:",-1)),(0,s.Lk)("span",jee,(0,d.v_)(e.mandatoryOptional)+" | "+(0,d.v_)(e.manualAutomatic),1)]),(0,s.Lk)("div",Bee,[m[13]||(m[13]=(0,s.Lk)("span",{class:"compliance-label"},"Version:",-1)),(0,s.Lk)("span",Wee,(0,d.v_)(e.version),1)]),e.isRisk?((0,s.uX)(),(0,s.CE)("div",qee,m[14]||(m[14]=[(0,s.Lk)("span",{class:"compliance-label"},"Risk Status:",-1),(0,s.Lk)("span",{class:"compliance-value compliance-risk"},"Risk Identified",-1)]))):(0,s.Q3)("",!0)]),g.value===e.id?((0,s.uX)(),(0,s.CE)("div",Qee,[m[33]||(m[33]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Complete Control Details")],-1)),(0,s.Lk)("div",Kee,[(0,s.Lk)("div",Jee,[m[15]||(m[15]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("div",zee,[e.description?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.description),1)],64)):((0,s.uX)(),(0,s.CE)("span",Hee,"No description available"))])]),(0,s.Lk)("div",Gee,[m[16]||(m[16]=(0,s.Lk)("h5",null,"Control Title",-1)),(0,s.Lk)("div",Yee,[e.title?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.title),1)],64)):((0,s.uX)(),(0,s.CE)("span",Zee,"Not specified"))])]),(0,s.Lk)("div",ete,[m[17]||(m[17]=(0,s.Lk)("h5",null,"Scope",-1)),(0,s.Lk)("div",tte,[e.scope?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.scope),1)],64)):((0,s.uX)(),(0,s.CE)("span",ite,"Not specified"))])]),(0,s.Lk)("div",ate,[m[18]||(m[18]=(0,s.Lk)("h5",null,"Objective",-1)),(0,s.Lk)("div",ste,[e.objective?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.objective),1)],64)):((0,s.uX)(),(0,s.CE)("span",ote,"Not specified"))])]),(0,s.Lk)("div",lte,[m[19]||(m[19]=(0,s.Lk)("h5",null,"Control Type",-1)),(0,s.Lk)("div",nte,[e.complianceType?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.complianceType),1)],64)):((0,s.uX)(),(0,s.CE)("span",rte,"Not specified"))])]),(0,s.Lk)("div",cte,[m[20]||(m[20]=(0,s.Lk)("h5",null,"Implementation Type",-1)),(0,s.Lk)("div",dte,(0,d.v_)(e.manualAutomatic||"Not specified"),1)]),(0,s.Lk)("div",ute,[m[21]||(m[21]=(0,s.Lk)("h5",null,"Requirement Level",-1)),(0,s.Lk)("div",pte,(0,d.v_)(e.mandatoryOptional||"Not specified"),1)]),(0,s.Lk)("div",mte,[m[22]||(m[22]=(0,s.Lk)("h5",null,"Duration",-1)),(0,s.Lk)("div",vte,[e.permanentTemporary?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.permanentTemporary),1)],64)):((0,s.uX)(),(0,s.CE)("span",kte,"Not specified"))])]),(0,s.Lk)("div",hte,[m[23]||(m[23]=(0,s.Lk)("h5",null,"Risk Status",-1)),(0,s.Lk)("div",gte,[void 0!==e.isRisk?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)(e.isRisk?"risk-identified":"no-risk")},(0,d.v_)(e.isRisk?"Risk Identified":"No Risk"),3)):((0,s.uX)(),(0,s.CE)("span",yte,"Not specified"))])]),(0,s.Lk)("div",fte,[m[24]||(m[24]=(0,s.Lk)("h5",null,"Possible Damage",-1)),(0,s.Lk)("div",bte,[e.possibleDamage?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.possibleDamage),1)],64)):((0,s.uX)(),(0,s.CE)("span",Cte,"Not specified"))])]),(0,s.Lk)("div",Lte,[m[25]||(m[25]=(0,s.Lk)("h5",null,"Mitigation Strategy",-1)),(0,s.Lk)("div",wte,[e.mitigation?((0,s.uX)(),(0,s.CE)("pre",Ete,(0,d.v_)(M(e.mitigation)),1)):((0,s.uX)(),(0,s.CE)("span",Rte,"Not specified"))])]),(0,s.Lk)("div",Ite,[m[26]||(m[26]=(0,s.Lk)("h5",null,"Severity Rating",-1)),(0,s.Lk)("div",Dte,[e.impact?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)("severity-"+e.impact.toLowerCase())},(0,d.v_)(e.impact),3)):((0,s.uX)(),(0,s.CE)("span",Pte,"Not specified"))])]),(0,s.Lk)("div",_te,[m[27]||(m[27]=(0,s.Lk)("h5",null,"Probability",-1)),(0,s.Lk)("div",Ate,[e.probability?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.probability),1)],64)):((0,s.uX)(),(0,s.CE)("span",Ste,"Not specified"))])]),(0,s.Lk)("div",Tte,[m[28]||(m[28]=(0,s.Lk)("h5",null,"Applicability",-1)),(0,s.Lk)("div",xte,[e.applicability?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.applicability),1)],64)):((0,s.uX)(),(0,s.CE)("span",Fte,"Not specified"))])]),(0,s.Lk)("div",Vte,[m[29]||(m[29]=(0,s.Lk)("h5",null,"Business Units Covered",-1)),(0,s.Lk)("div",Ute,[e.businessUnitsCovered?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.businessUnitsCovered),1)],64)):((0,s.uX)(),(0,s.CE)("span",Nte,"Not specified"))])]),(0,s.Lk)("div",Mte,[m[30]||(m[30]=(0,s.Lk)("h5",null,"Risk Scenarios",-1)),(0,s.Lk)("div",Xte,[e.potentialRiskScenarios?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[(0,s.eW)((0,d.v_)(e.potentialRiskScenarios),1)],64)):((0,s.uX)(),(0,s.CE)("span",$te,"Not specified"))])]),(0,s.Lk)("div",Ote,[m[31]||(m[31]=(0,s.Lk)("h5",null,"Control Status",-1)),(0,s.Lk)("div",jte,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",e.status?.toLowerCase()])},(0,d.v_)(e.status||"Not specified"),3)])]),(0,s.Lk)("div",Bte,[m[32]||(m[32]=(0,s.Lk)("h5",null,"Active Status",-1)),(0,s.Lk)("div",Wte,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",e.activeInactive?.toLowerCase()])},(0,d.v_)(e.activeInactive||"Not specified"),3)])])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",qte,[(0,s.Lk)("div",Qte,[(0,s.Lk)("span",null,"Created by "+(0,d.v_)(e.createdBy),1),(0,s.Lk)("span",null,(0,d.v_)(S(e.createdDate)),1)]),(0,s.Lk)("div",Kte,"ID: "+(0,d.v_)(e.identifier),1)])])],8,Vee))),128))])):((0,s.uX)(),(0,s.CE)("div",Jte,[(0,s.Lk)("div",zte,[(0,s.bF)(Hn.A,{data:R.value,columns:f,uniqueKey:"id",showPagination:!0,showActions:!0},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"compliance-action-btn",onClick:t=>X(e)},m[34]||(m[34]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,Hte),(0,s.Lk)("button",{class:"compliance-action-btn",onClick:t=>$(e)},m[35]||(m[35]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,Gte)]),_:1},8,["data"])])])):((0,s.uX)(),(0,s.CE)("div",xee,m[10]||(m[10]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No controls found for this subpolicy",-1)])))],64)):(0,s.Q3)("",!0)]),n.value?((0,s.uX)(),(0,s.CE)("div",Yte,[(0,s.Lk)("div",Zte,[(0,s.Lk)("div",eie,[(0,s.Lk)("h3",null,(0,d.v_)(v.value),1),(0,s.Lk)("button",{class:"close-btn",onClick:_},"×")]),(0,s.Lk)("div",tie,[0===r.value.length?((0,s.uX)(),(0,s.CE)("div",iie," No versions found. ")):((0,s.uX)(),(0,s.CE)("div",aie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"version-card"},[(0,s.Lk)("div",sie,[(0,s.Lk)("span",oie,"Version "+(0,d.v_)(e.version),1),(0,s.Lk)("div",lie,[(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",x(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",x(e.activeInactive)])},(0,d.v_)(e.activeInactive),3)])]),(0,s.Lk)("div",nie,[(0,s.Lk)("p",rie,(0,d.v_)(e.description),1),(0,s.Lk)("div",cie,[(0,s.Lk)("div",die,[m[36]||(m[36]=(0,s.Lk)("span",{class:"info-label"},"Maturity Level:",-1)),(0,s.Lk)("span",uie,(0,d.v_)(e.maturityLevel),1)]),(0,s.Lk)("div",pie,[m[37]||(m[37]=(0,s.Lk)("span",{class:"info-label"},"Type:",-1)),(0,s.Lk)("span",mie,(0,d.v_)(e.mandatoryOptional)+" | "+(0,d.v_)(e.manualAutomatic),1)]),(0,s.Lk)("div",vie,[m[38]||(m[38]=(0,s.Lk)("span",{class:"info-label"},"Criticality:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["info-value","criticality-"+e.criticality.toLowerCase()])},(0,d.v_)(e.criticality),3)]),e.isRisk?((0,s.uX)(),(0,s.CE)("div",kie,m[39]||(m[39]=[(0,s.Lk)("span",{class:"info-label"},"Risk Status:",-1),(0,s.Lk)("span",{class:"info-value risk"},"Risk Identified",-1)]))):(0,s.Q3)("",!0)]),(0,s.Lk)("div",hie,[(0,s.Lk)("span",null,[m[40]||(m[40]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.createdBy),1)]),(0,s.Lk)("span",null,[m[41]||(m[41]=(0,s.Lk)("i",{class:"fas fa-calendar"},null,-1)),(0,s.eW)(" "+(0,d.v_)(S(e.createdDate)),1)])])])]))),128))]))])])])):(0,s.Q3)("",!0)]))}};const yie=gie;var fie=yie;const bie={class:"compliance-all-compliances-container"},Cie={key:0,class:"compliance-error-message"},Lie={key:1,class:"compliance-loading-spinner"},wie={key:2,class:"compliance-breadcrumbs"},Eie=["onClick"],Rie={class:"compliance-content-wrapper"},Iie={class:"compliance-card-grid"},Die=["onClick"],Pie={class:"compliance-card-icon"},_ie={class:"compliance-card-content"},Aie={class:"compliance-card-title"},Sie={class:"compliance-card-category"},Tie={class:"compliance-card-desc"},xie={class:"compliance-version-info"},Fie={class:"compliance-card-actions"},Vie=["onClick"],Uie={class:"compliance-section-header"},Nie={class:"compliance-card-grid"},Mie=["onClick"],Xie={class:"compliance-card-icon"},$ie={class:"compliance-card-content"},Oie={class:"compliance-card-title"},jie={class:"compliance-card-category"},Bie={class:"compliance-card-desc"},Wie={class:"compliance-version-info"},qie={class:"compliance-card-actions"},Qie=["onClick"],Kie={class:"compliance-section-header"},Jie={class:"compliance-card-grid"},zie=["onClick"],Hie={class:"compliance-card-icon"},Gie={class:"compliance-card-content"},Yie={class:"compliance-card-title"},Zie={class:"compliance-card-category"},eae={class:"compliance-card-desc"},tae={class:"compliance-metadata"},iae={class:"compliance-card-actions"},aae=["onClick"],sae={class:"compliance-section-header"},oae={class:"compliance-section-actions compliance-section-actions-right"},lae={class:"compliance-inline-export-controls"},nae={key:0,class:"compliance-loading-spinner"},rae={key:1,class:"compliance-no-data"},cae={key:2,class:"compliance-no-data"},dae={key:3,class:"compliance-card-grid"},uae={class:"compliance-header"},pae={class:"compliance-body"},mae={class:"compliance-clean-details-grid"},vae={key:0,class:"compliance-fetch-audit-actions"},kae=["onClick"],hae={class:"compliance-detail-row"},gae={class:"compliance-detail-value"},yae={class:"compliance-detail-row"},fae={class:"compliance-detail-value"},bae={class:"compliance-detail-row"},Cae={class:"compliance-detail-value"},Lae={class:"compliance-detail-row"},wae={class:"compliance-footer"},Eae={class:"compliance-identifier"},Rae={key:4},Iae={key:3,class:"compliance-modal"},Dae={class:"compliance-modal-content"},Pae={class:"compliance-modal-header"},_ae={class:"compliance-modal-body"},Aae={key:0,class:"compliance-no-versions"},Sae={key:1,class:"compliance-version-grid"},Tae={class:"compliance-version-header"},xae={class:"compliance-version-number"},Fae={class:"compliance-version-badges"},Vae={class:"compliance-version-details"},Uae={class:"compliance-version-desc"},Nae={class:"compliance-version-info-grid"},Mae={class:"compliance-info-group"},Xae={class:"compliance-info-value"},$ae={class:"compliance-info-group"},Oae={class:"compliance-info-value"},jae={class:"compliance-info-group"},Bae={key:0,class:"compliance-info-group"},Wae={class:"compliance-version-metadata"};function qae(e,t,i,o,l,n){const r=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",bie,[t[26]||(t[26]=(0,s.Lk)("div",{class:"compliance-custom-header"},[(0,s.Lk)("span",null,"Compliance Audit Status"),(0,s.Lk)("div",{class:"compliance-custom-header-underline"})],-1)),o.error?((0,s.uX)(),(0,s.CE)("div",Cie,[t[4]||(t[4]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(o.error),1)])):(0,s.Q3)("",!0),o.loading?((0,s.uX)(),(0,s.CE)("div",Lie,t[5]||(t[5]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading...",-1)]))):(0,s.Q3)("",!0),o.breadcrumbs.length>0?((0,s.uX)(),(0,s.CE)("div",wie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.breadcrumbs,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-breadcrumb-chip"},[(0,s.eW)((0,d.v_)(e.name)+" ",1),(0,s.Lk)("span",{class:"compliance-breadcrumb-close",onClick:e=>o.goToStep(t)},"×",8,Eie)]))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",Rie,[o.showFrameworks?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[t[7]||(t[7]=(0,s.Lk)("div",{class:"compliance-section-header"},"Frameworks",-1)),(0,s.Lk)("div",Iie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.frameworks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>o.selectFramework(e)},[(0,s.Lk)("div",Pie,[(0,s.Lk)("i",{class:(0,d.C4)(o.categoryIcon(e.category))},null,2)]),(0,s.Lk)("div",_ie,[(0,s.Lk)("div",Aie,(0,d.v_)(e.name),1),(0,s.Lk)("div",Sie,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",Tie,(0,d.v_)(e.description),1),(0,s.Lk)("div",xie,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",Fie,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,a.D$)(t=>o.viewAllCompliances("framework",e.id,e.name),["stop"])},t[6]||(t[6]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Compliances ")]),8,Vie)])])],8,Die))),128))])],64)):o.showPolicies?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",Uie,"Policies in "+(0,d.v_)(o.selectedFramework.name),1),(0,s.Lk)("div",Nie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.policies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>o.selectPolicy(e)},[(0,s.Lk)("div",Xie,[(0,s.Lk)("i",{class:(0,d.C4)(o.categoryIcon(e.category))},null,2)]),(0,s.Lk)("div",$ie,[(0,s.Lk)("div",Oie,(0,d.v_)(e.name),1),(0,s.Lk)("div",jie,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",Bie,(0,d.v_)(e.description),1),(0,s.Lk)("div",Wie,[(0,s.Lk)("span",null,"Versions: "+(0,d.v_)(e.versions.length),1)]),(0,s.Lk)("div",qie,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,a.D$)(t=>o.viewAllCompliances("policy",e.id,e.name),["stop"])},t[8]||(t[8]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Compliances ")]),8,Qie)])])],8,Mie))),128))])],64)):o.showSubpolicies?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",Kie,"Subpolicies in "+(0,d.v_)(o.selectedPolicy.name),1),(0,s.Lk)("div",Jie,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.subpolicies,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card",onClick:t=>o.selectSubpolicy(e)},[(0,s.Lk)("div",Hie,[(0,s.Lk)("i",{class:(0,d.C4)(o.categoryIcon(e.category))},null,2)]),(0,s.Lk)("div",Gie,[(0,s.Lk)("div",Yie,(0,d.v_)(e.name),1),(0,s.Lk)("div",Zie,(0,d.v_)(e.category),1),(0,s.Lk)("div",{class:(0,d.C4)(["compliance-card-status",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("div",eae,(0,d.v_)(e.description),1),(0,s.Lk)("div",tae,[(0,s.Lk)("span",null,"Control: "+(0,d.v_)(e.control),1),(0,s.Lk)("span",null,(0,d.v_)(e.permanent_temporary),1)]),(0,s.Lk)("div",iae,[(0,s.Lk)("button",{class:"compliance-action-btn primary",onClick:(0,a.D$)(t=>o.viewAllCompliances("subpolicy",e.id,e.name),["stop"])},t[9]||(t[9]=[(0,s.Lk)("i",{class:"fas fa-list"},null,-1),(0,s.eW)(" View All Compliances ")]),8,aae)])])],8,zie))),128))])],64)):o.selectedSubpolicy?((0,s.uX)(),(0,s.CE)(s.FK,{key:3},[(0,s.Lk)("div",sae,[(0,s.Lk)("span",null,"Compliances in "+(0,d.v_)(o.selectedSubpolicy.name),1),(0,s.Lk)("div",oae,[(0,s.Lk)("div",lae,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedFormat=e),class:"compliance-format-select"},t[10]||(t[10]=[(0,s.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option>',5)]),512),[[a.u1,o.selectedFormat]]),(0,s.Lk)("button",{class:"compliance-export-btn",onClick:t[1]||(t[1]=e=>o.handleExport(o.selectedFormat))},t[11]||(t[11]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")]))]),(0,s.Lk)("button",{class:"compliance-view-toggle-btn",onClick:t[2]||(t[2]=(...e)=>o.toggleViewMode&&o.toggleViewMode(...e))},[(0,s.Lk)("i",{class:(0,d.C4)("card"===o.viewMode?"fas fa-list":"fas fa-th-large")},null,2),(0,s.eW)(" "+(0,d.v_)("card"===o.viewMode?"List View":"Card View"),1)])])]),o.loading?((0,s.uX)(),(0,s.CE)("div",nae,t[12]||(t[12]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading compliances...",-1)]))):o.hasCompliances?0===o.filteredCompliances.length?((0,s.uX)(),(0,s.CE)("div",cae,t[14]||(t[14]=[(0,s.Lk)("i",{class:"fas fa-filter"},null,-1),(0,s.Lk)("p",null,"No approved compliances found for this subpolicy",-1)]))):"card"===o.viewMode?((0,s.uX)(),(0,s.CE)("div",dae,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-card"},[(0,s.Lk)("div",uae,[(0,s.Lk)("span",{class:(0,d.C4)(["compliance-criticality-badge","compliance-criticality-"+e.category.toLowerCase()])},(0,d.v_)(e.category),3)]),(0,s.Lk)("div",pae,[(0,s.Lk)("h3",null,(0,d.v_)(e.name),1),(0,s.Lk)("div",mae,[o.complianceAudits[e.id]?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",vae,[(0,s.Lk)("button",{class:"compliance-fetch-audit-btn",onClick:t=>o.fetchAuditInfo(e.id)},t[15]||(t[15]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1),(0,s.eW)(" Load Compliance Information ")]),8,kae)])),(0,s.Lk)("div",hae,[t[16]||(t[16]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Compliance Performed By:",-1)),(0,s.Lk)("span",gae,(0,d.v_)(o.complianceAudits[e.id]?.audit_performer_name||"N/A"),1)]),(0,s.Lk)("div",yae,[t[17]||(t[17]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Compliance Approved By:",-1)),(0,s.Lk)("span",fae,(0,d.v_)(o.complianceAudits[e.id]?.audit_approver_name||"N/A"),1)]),(0,s.Lk)("div",bae,[t[18]||(t[18]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Completion Date:",-1)),(0,s.Lk)("span",Cae,(0,d.v_)(o.complianceAudits[e.id]?.audit_date||"N/A"),1)]),(0,s.Lk)("div",Lae,[t[19]||(t[19]=(0,s.Lk)("span",{class:"compliance-detail-label"},"Completion Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-detail-value",o.getAuditStatusClass(o.complianceAudits[e.id]?.audit_findings_status)])},[(0,s.Lk)("i",{class:(0,d.C4)(o.getAuditStatusIcon(o.complianceAudits[e.id]?.audit_findings_status))},null,2),(0,s.eW)(" "+(0,d.v_)(o.formatAuditStatus(o.complianceAudits[e.id]?.audit_findings_status)),1)],2)])]),(0,s.Lk)("div",wae,[(0,s.Lk)("div",Eae,"ID: "+(0,d.v_)(e.identifier),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",Rae,[(0,s.bF)(r,{data:o.complianceTableData,columns:o.complianceTableColumns,"show-pagination":!0,"show-actions":!1,"unique-key":"id"},null,8,["data","columns"])])):((0,s.uX)(),(0,s.CE)("div",rae,t[13]||(t[13]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No compliances found for this subpolicy",-1)])))],64)):(0,s.Q3)("",!0)]),o.showVersionsModal?((0,s.uX)(),(0,s.CE)("div",Iae,[(0,s.Lk)("div",Dae,[(0,s.Lk)("div",Pae,[(0,s.Lk)("h3",null,(0,d.v_)(o.versionModalTitle),1),(0,s.Lk)("button",{class:"compliance-close-btn",onClick:t[3]||(t[3]=(...e)=>o.closeVersionsModal&&o.closeVersionsModal(...e))},"×")]),(0,s.Lk)("div",_ae,[0===o.versions.length?((0,s.uX)(),(0,s.CE)("div",Aae," No versions found. ")):((0,s.uX)(),(0,s.CE)("div",Sae,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.versions,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"compliance-version-card"},[(0,s.Lk)("div",Tae,[(0,s.Lk)("span",xae,"Version "+(0,d.v_)(e.version),1),(0,s.Lk)("div",Fae,[(0,s.Lk)("span",{class:(0,d.C4)(["compliance-status-badge",o.statusClass(e.status)])},(0,d.v_)(e.status),3),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-status-badge",o.statusClass(e.activeInactive)])},(0,d.v_)(e.activeInactive),3)])]),(0,s.Lk)("div",Vae,[(0,s.Lk)("p",Uae,(0,d.v_)(e.description),1),(0,s.Lk)("div",Nae,[(0,s.Lk)("div",Mae,[t[20]||(t[20]=(0,s.Lk)("span",{class:"compliance-info-label"},"Maturity Level:",-1)),(0,s.Lk)("span",Xae,(0,d.v_)(e.maturityLevel),1)]),(0,s.Lk)("div",$ae,[t[21]||(t[21]=(0,s.Lk)("span",{class:"compliance-info-label"},"Type:",-1)),(0,s.Lk)("span",Oae,(0,d.v_)(e.mandatoryOptional)+" | "+(0,d.v_)(e.manualAutomatic),1)]),(0,s.Lk)("div",jae,[t[22]||(t[22]=(0,s.Lk)("span",{class:"compliance-info-label"},"Criticality:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["compliance-info-value","compliance-criticality-"+e.criticality.toLowerCase()])},(0,d.v_)(e.criticality),3)]),e.isRisk?((0,s.uX)(),(0,s.CE)("div",Bae,t[23]||(t[23]=[(0,s.Lk)("span",{class:"compliance-info-label"},"Risk Status:",-1),(0,s.Lk)("span",{class:"compliance-info-value risk"},"Risk Identified",-1)]))):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Wae,[(0,s.Lk)("span",null,[t[24]||(t[24]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.createdBy),1)]),(0,s.Lk)("span",null,[t[25]||(t[25]=(0,s.Lk)("i",{class:"fas fa-calendar"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.formatDate(e.createdDate)),1)])])])]))),128))]))])])])):(0,s.Q3)("",!0)])}var Qae=i(1219),Kae={name:"ComplianceManagement",components:{DynamicTable:Hn.A},setup(){const e=(0,ie.KR)([]),t=(0,ie.KR)(null),i=(0,ie.KR)(null),a=(0,ie.KR)(null),o=(0,ie.KR)(!1),l=(0,ie.KR)([]),n=(0,ie.KR)([]),r=(0,ie.KR)([]),c=(0,ie.KR)(!1),d=(0,ie.KR)(null),u=(0,ie.KR)(""),p=(0,ie.KR)("xlsx"),m=(0,ie.KR)(!1),v=(0,ie.KR)(null),k=(0,ie.KR)({}),h=(0,ie.KR)("list"),g=(0,ae.rd)(),y=[{key:"audit_findings_id",label:"Audit Findings ID",sortable:!0},{key:"name",label:"Compliance",sortable:!0},{key:"category",label:"Criticality",sortable:!0},{key:"audit_findings_status",label:"Completion Status",sortable:!0},{key:"audit_performer_name",label:"Compliance Performed By",sortable:!0},{key:"audit_approver_name",label:"Compliance Approved By",sortable:!0},{key:"audit_date",label:"Completion Date",sortable:!0}],f=(0,s.EW)(()=>a.value&&a.value.compliances?N.value.map(e=>{const t=k.value[e.id]||{};return{audit_findings_id:t.audit_findings_id||"N/A",name:e.name,category:e.category,audit_findings_status:t.audit_findings_status||"Not Audited",audit_performer_name:t.audit_performer_name||"N/A",audit_approver_name:t.audit_approver_name||"N/A",audit_date:t.audit_date||"N/A",id:e.id}}):[]),b=(0,s.EW)(()=>{const e=[];return t.value&&e.push({id:0,name:t.value.name}),i.value&&e.push({id:1,name:i.value.name}),a.value&&e.push({id:2,name:a.value.name}),e}),C=(0,s.EW)(()=>!t.value),L=(0,s.EW)(()=>t.value&&!i.value),w=(0,s.EW)(()=>i.value&&!a.value),E=(0,s.EW)(()=>a.value&&a.value.compliances&&a.value.compliances.length>0);async function R(e){try{c.value=!0,t.value=e,i.value=null,a.value=null;const s=await He.A.get("/api/compliance/all-policies/policies/",{params:{framework_id:e.id}});s.data&&Array.isArray(s.data)?n.value=s.data.map(e=>({...e,versions:e.versions||[]})):n.value=[]}catch(s){d.value="Failed to load policies",console.error("Error fetching policies:",s),n.value=[]}finally{c.value=!1}}async function I(e){try{c.value=!0,i.value=e,a.value=null;const t=await He.A.get("/api/compliance/all-policies/subpolicies/",{params:{policy_id:e.id}});t.data&&Array.isArray(t.data)?r.value=t.data:r.value=[]}catch(t){d.value="Failed to load subpolicies",console.error("Error fetching subpolicies:",t),r.value=[]}finally{c.value=!1}}async function D(e){try{c.value=!0,a.value=e,k.value={},console.log(`Selecting subpolicy: ${e.id} - ${e.name}`);const i=await He.A.get(`/api/compliance/all-policies/subpolicies/${e.id}/compliances/`);if(console.log("Subpolicy compliances response:",i.data),i.data&&i.data.success){const s=i.data.compliances.map(e=>({id:e.ComplianceId,name:e.ComplianceItemDescription,status:e.Status,description:e.ComplianceItemDescription,category:e.Criticality,maturityLevel:e.MaturityLevel,mandatoryOptional:e.MandatoryOptional,manualAutomatic:e.ManualAutomatic,createdBy:e.CreatedByName,createdDate:e.CreatedByDate,isRisk:e.IsRisk,activeInactive:e.ActiveInactive,identifier:e.Identifier,version:e.ComplianceVersion}));if(a.value={...e,compliances:s},console.log(`Found ${s.length} compliances for subpolicy ${e.id}`),s.length>0){for(const e of s)try{await M(e.id),await new Promise(e=>setTimeout(e,100))}catch(t){console.error(`Error fetching audit info for compliance ${e.id}:`,t)}console.log("All audit information fetched:",k.value)}}else a.value={...e,compliances:[]},console.log("No compliances found or API returned error")}catch(i){console.error("Error fetching subpolicy compliances:",i),d.value="Failed to load compliances",a.value={...e,compliances:[]}}finally{c.value=!1}}async function P(e,t){try{c.value=!0;let i="";switch(e){case"policy":u.value=`Versions of ${t.name}`,i=`/api/compliance/all-policies/policies/${t.id}/versions/`;break;case"compliance":u.value=`Versions of Compliance ${t.name}`,i=`/api/compliance/all-policies/compliances/${t.id}/versions/`;break}const a=await He.A.get(i);a.data&&Array.isArray(a.data)?l.value=a.data.map(e=>({id:e.ComplianceId,version:e.ComplianceVersion,name:e.ComplianceItemDescription,status:e.Status,description:e.ComplianceItemDescription,criticality:e.Criticality,maturityLevel:e.MaturityLevel,mandatoryOptional:e.MandatoryOptional,manualAutomatic:e.ManualAutomatic,createdBy:e.CreatedByName,createdDate:e.CreatedByDate,isRisk:e.IsRisk,activeInactive:e.ActiveInactive,identifier:e.Identifier})):l.value=[],o.value=!0}catch(i){d.value=`Failed to load ${e} versions`,console.error(`Error fetching ${e} versions:`,i),l.value=[]}finally{c.value=!1}}function _(){o.value=!1,l.value=[],u.value=""}function A(e){e<=0?(t.value=null,i.value=null,a.value=null):1===e?(i.value=null,a.value=null):2===e&&(a.value=null)}function S(e){return e?new Date(e).toLocaleDateString():"N/A"}function T(e){switch((e||"").toLowerCase()){case"governance":return"fas fa-shield-alt";case"access control":return"fas fa-user-shield";case"asset management":return"fas fa-boxes";case"cryptography":return"fas fa-key";case"data management":return"fas fa-database";case"device management":return"fas fa-mobile-alt";case"risk management":return"fas fa-exclamation-triangle";case"supplier management":return"fas fa-handshake";case"business continuity":return"fas fa-business-time";case"privacy":return"fas fa-user-secret";case"system protection":return"fas fa-shield-virus";case"incident response":return"fas fa-ambulance";default:return"fas fa-file-alt"}}function x(e){if(!e)return"";const t=e.toLowerCase();return t.includes("active")?"active":t.includes("inactive")?"inactive":t.includes("pending")?"pending":""}(0,s.sV)(async()=>{try{c.value=!0;const t=await He.A.get("/api/compliance/all-policies/frameworks/");t.data&&Array.isArray(t.data)?e.value=t.data.map(e=>({...e,versions:e.versions||[]})):e.value=[]}catch(t){d.value="Failed to load frameworks",console.error("Error fetching frameworks:",t),e.value=[]}finally{c.value=!1}});const F=async(e,t,i)=>{try{g.push({name:"ComplianceAuditView",params:{type:e,id:t,name:encodeURIComponent(i)}})}catch(d){console.error("Error navigating to audit view:",d),d.value="Failed to navigate to audit view. Please try again."}};async function V(e){try{m.value=!0,v.value=null;let s="",o=null;if(a.value)s="subpolicy",o=a.value.id;else if(i.value)s="policy",o=i.value.id;else{if(!t.value)throw new Error("No item selected for export");s="framework",o=t.value.id}console.log(`Attempting export for ${s} ${o} in ${e} format`);const l=await(0,He.A)({url:`/api/compliance/export/all-compliances/${e}/${s}/${o}/`,method:"GET",responseType:"blob",timeout:3e4,headers:{Accept:"application/json, application/pdf, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, application/xml"}}),n=l.headers["content-type"],r=new Blob([l.data],{type:n});let c=`compliances_${s}_${o}.${e}`;const d=l.headers["content-disposition"];d&&d.includes("filename=")&&(c=d.split("filename=")[1].replace(/"/g,""));const u=document.createElement("a");u.href=URL.createObjectURL(r),u.download=c,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(u.href),(0,Qae.nk)({message:"Export completed successfully",type:"success",duration:3e3})}catch(d){console.error("Export error:",d);const t=d.response?.data?.message||d.message||"Failed to export compliances";v.value=t,(0,Qae.nk)({message:t,type:"error",duration:5e3})}finally{m.value=!1}}const U=()=>{h.value="card"===h.value?"list":"card"},N=(0,s.EW)(()=>a.value&&a.value.compliances?a.value.compliances.filter(e=>"Approved"===e.status):[]);async function M(e){try{if(console.log(`Fetching audit info for compliance ID: ${e}`),k.value[e]&&"Not Audited"!==k.value[e].audit_findings_status)return void console.log(`Using cached audit data for compliance ID: ${e}`);k.value={...k.value,[e]:{audit_findings_status:"Loading...",isLoading:!0}};const t=await He.A.get(`/api/compliance/compliance/${e}/audit-info/`);if(console.log(`Audit info response for compliance ID ${e}:`,t.data),!t.data||!t.data.success)throw new Error(t.data.message||"Failed to fetch audit data");k.value={...k.value,[e]:{...t.data.data,isLoading:!1}},console.log(`Updated audit data for compliance ID ${e}:`,k.value[e])}catch(t){console.error(`Error fetching audit info for compliance ${e}:`,t),k.value={...k.value,[e]:{audit_findings_status:"Not Audited",isLoading:!1,error:t.message}}}}function X(e){if(!e)return"not-audited";const t=e.toLowerCase();return t.includes("non")||t.includes("not compliant")?"non-compliant":t.includes("partially")?"partially-compliant":t.includes("fully")?"fully-compliant":t.includes("not applicable")?"not-applicable":"not-audited"}function $(e){if(!e)return"fas fa-question-circle";const t=e.toLowerCase();return t.includes("non")||t.includes("not compliant")?"fas fa-times-circle":t.includes("partially")?"fas fa-exclamation-circle":t.includes("fully")?"fas fa-check-circle":t.includes("not applicable")?"fas fa-ban":"fas fa-question-circle"}function O(e){if(!e)return"Not Audited";const t=e.toLowerCase();return t.includes("non")||t.includes("not compliant")?"Non Conformity":t.includes("partially")?"Control Gap":e}const j=e=>{e&&console.log(`Clicked on audit findings ID: ${e}`)};return{frameworks:e,selectedFramework:t,selectedPolicy:i,selectedSubpolicy:a,showVersionsModal:o,versions:l,policies:n,subpolicies:r,loading:c,error:d,versionModalTitle:u,selectedFormat:p,isExporting:m,exportError:v,complianceAudits:k,viewMode:h,router:g,breadcrumbs:b,showFrameworks:C,showPolicies:L,showSubpolicies:w,hasCompliances:E,selectFramework:R,selectPolicy:I,selectSubpolicy:D,showVersions:P,closeVersionsModal:_,goToStep:A,formatDate:S,categoryIcon:T,statusClass:x,viewAllCompliances:F,handleExport:V,fetchAuditInfo:M,getAuditStatusClass:X,getAuditStatusIcon:$,formatAuditStatus:O,handleAuditLinkClick:j,toggleViewMode:U,filteredCompliances:N,complianceTableColumns:y,complianceTableData:f,DynamicTable:Hn.A}}};const Jae=(0,le.A)(Kae,[["render",qae]]);var zae=Jae;const Hae={class:"compliance-view-container"},Gae={class:"compliance-header"},Yae={key:0,class:"compliance-loading"},Zae={key:1,class:"compliance-error"},ese={key:2},tse={class:"controls-filter-section"},ise={class:"dropdowns-row"},ase={class:"controls-table-container"},sse=["onClick"],ose={class:"modal-body"},lse={class:"detail-section"},nse={class:"detail-grid"},rse={class:"detail-item"},cse={class:"detail-item"},dse={class:"detail-item"},use={class:"detail-item"},pse={class:"detail-section"},mse={class:"detail-section"},vse={class:"detail-grid"},kse={class:"detail-item"},hse={class:"detail-item"},gse={class:"detail-item"},yse={key:0,class:"detail-section risk-section"},fse={class:"detail-grid"},bse={class:"detail-item"},Cse={class:"detail-item"},Lse={class:"detail-section"},wse={class:"detail-grid"},Ese={class:"detail-item"},Rse={class:"detail-item"},Ise={class:"detail-item"};var Dse={__name:"ComplianceView",setup(e){const t=(0,ae.lq)(),i=(0,ae.rd)(),o=(0,ie.KR)(!1),l=(0,ie.KR)(null),n=(0,ie.KR)([]),r=(0,ie.KR)(null),c=(0,ie.KR)(""),u=(0,ie.KR)(""),p=(0,ie.KR)(""),m=(0,ie.KR)(""),v=(0,ie.KR)("Identifier"),k=(0,ie.KR)("asc"),h=(0,s.EW)(()=>{const e=decodeURIComponent(t.params.name||""),i=t.params.type.charAt(0).toUpperCase()+t.params.type.slice(1);return`Controls for ${i}: ${e}`}),g={name:"Status",label:"Status",values:[{value:"",label:"All Statuses"},{value:"Under Review",label:"Under Review"},{value:"Approved",label:"Approved"},{value:"Rejected",label:"Rejected"}]},y={name:"Criticality",label:"Criticality",values:[{value:"",label:"All Criticality"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}]},f={name:"MaturityLevel",label:"Maturity Level",values:[{value:"",label:"All Maturity Levels"},{value:"Initial",label:"Initial"},{value:"Developing",label:"Developing"},{value:"Defined",label:"Defined"},{value:"Managed",label:"Managed"},{value:"Optimizing",label:"Optimizing"}]},b=[{key:"Identifier",label:"ID",sortable:!0},{key:"ComplianceTitle",label:"Title",sortable:!0},{key:"Status",label:"Status",sortable:!0},{key:"Criticality",label:"Criticality",sortable:!0},{key:"MaturityLevel",label:"Maturity Level",sortable:!0},{key:"MandatoryOptional",label:"Type",sortable:!0},{key:"ManualAutomatic",label:"Implementation",sortable:!0},{key:"CreatedByDate",label:"Created Date",sortable:!0}],C=(0,s.EW)(()=>{let e=[...n.value];if(c.value){const t=c.value.toLowerCase();e=e.filter(e=>e.ComplianceTitle?.toLowerCase().includes(t)||e.ComplianceItemDescription?.toLowerCase().includes(t)||e.Identifier?.toLowerCase().includes(t))}return u.value&&(e=e.filter(e=>e.Status===u.value)),p.value&&(e=e.filter(e=>e.Criticality===p.value)),m.value&&(e=e.filter(e=>e.MaturityLevel===m.value)),e.sort((e,t)=>{let i=e[v.value]||"",a=t[v.value]||"";return"CreatedByDate"===v.value?(i=new Date(i),a=new Date(a)):(i="string"===typeof i?i.toLowerCase():i,a="string"===typeof a?a.toLowerCase():a),i<a?"asc"===k.value?-1:1:i>a?"asc"===k.value?1:-1:0}),e}),L=()=>{},w=e=>{const t=e?.toLowerCase()||"";return t.includes("review")?"status-review":t.includes("approved")?"status-approved":t.includes("rejected")?"status-rejected":"status-default"},E=e=>{const t=e?.toLowerCase()||"";return`criticality-${t}`},R=e=>{r.value=e},I=()=>{r.value=null},D=()=>{A()},P=()=>{i.back()},_=()=>{console.log("Export functionality to be implemented")},A=async()=>{try{o.value=!0,l.value=null;const e=await I4.fv.getCompliancesByType(t.params.type,t.params.id);e.data.success?n.value=e.data.compliances.map(e=>({...e,CreatedByDate:e.CreatedByDate?new Date(e.CreatedByDate).toLocaleDateString():"N/A",category:e.Criticality||"Not Specified",name:e.ComplianceTitle||e.ComplianceItemDescription,description:e.ComplianceItemDescription,title:e.ComplianceTitle,maturityLevel:e.MaturityLevel||"Not Specified",version:e.ComplianceVersion,mandatoryOptional:e.MandatoryOptional||"Not Specified",manualAutomatic:e.ManualAutomatic||"Not Specified"})):l.value=e.data.message||"Failed to load controls"}catch(e){l.value=e.response?.data?.message||"Failed to load controls. Please try again."}finally{o.value=!1}};return(0,s.sV)(()=>{A()}),(e,t)=>((0,s.uX)(),(0,s.CE)("div",Hae,[(0,s.Lk)("div",Gae,[(0,s.Lk)("h2",null,(0,d.v_)(h.value),1),(0,s.Lk)("div",{class:"compliance-actions"},[(0,s.Lk)("button",{class:"compliance-export-btn",onClick:_},t[5]||(t[5]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")])),(0,s.Lk)("button",{onClick:P,class:"compliance-back-btn"},t[6]||(t[6]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])]),o.value?((0,s.uX)(),(0,s.CE)("div",Yae,t[7]||(t[7]=[(0,s.Lk)("div",{class:"compliance-spinner"},null,-1),(0,s.Lk)("p",null,"Loading controls...",-1)]))):l.value?((0,s.uX)(),(0,s.CE)("div",Zae,[(0,s.Lk)("p",null,(0,d.v_)(l.value),1),(0,s.Lk)("button",{onClick:D,class:"compliance-retry-btn"},"Retry")])):((0,s.uX)(),(0,s.CE)("div",ese,[(0,s.Lk)("div",tse,[(0,s.bF)(VG.A,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=e=>c.value=e),placeholder:"Search controls...",onSearch:L},null,8,["modelValue"]),(0,s.Lk)("div",ise,[(0,s.bF)(xa.A,{config:g,modelValue:u.value,"onUpdate:modelValue":t[1]||(t[1]=e=>u.value=e),onChange:L,class:"filter-dropdown"},null,8,["modelValue"]),(0,s.bF)(xa.A,{config:y,modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),onChange:L,class:"filter-dropdown"},null,8,["modelValue"]),(0,s.bF)(xa.A,{config:f,modelValue:m.value,"onUpdate:modelValue":t[3]||(t[3]=e=>m.value=e),onChange:L,class:"filter-dropdown"},null,8,["modelValue"])])]),(0,s.Lk)("div",ase,[(0,s.bF)(Hn.A,{data:C.value,columns:b,uniqueKey:"ComplianceId",showPagination:!0,showActions:!0},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{class:"action-btn view",onClick:t=>R(e)},t[8]||(t[8]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,sse)]),_:1},8,["data"])]),r.value?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:I},[(0,s.Lk)("div",{class:"modal-content",onClick:t[4]||(t[4]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",{class:"modal-header"},[t[9]||(t[9]=(0,s.Lk)("h3",null,"Control Details",-1)),(0,s.Lk)("button",{class:"modal-close",onClick:I},"×")]),(0,s.Lk)("div",ose,[(0,s.Lk)("div",lse,[t[14]||(t[14]=(0,s.Lk)("h4",null,"Basic Information",-1)),(0,s.Lk)("div",nse,[(0,s.Lk)("div",rse,[t[10]||(t[10]=(0,s.Lk)("label",null,"Title:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.ComplianceTitle),1)]),(0,s.Lk)("div",cse,[t[11]||(t[11]=(0,s.Lk)("label",null,"ID:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.Identifier),1)]),(0,s.Lk)("div",dse,[t[12]||(t[12]=(0,s.Lk)("label",null,"Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["status-badge",w(r.value.Status)])},(0,d.v_)(r.value.Status),3)]),(0,s.Lk)("div",use,[t[13]||(t[13]=(0,s.Lk)("label",null,"Criticality:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["criticality-badge",E(r.value.Criticality)])},(0,d.v_)(r.value.Criticality),3)])])]),(0,s.Lk)("div",pse,[t[15]||(t[15]=(0,s.Lk)("h4",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(r.value.ComplianceItemDescription),1)]),(0,s.Lk)("div",mse,[t[19]||(t[19]=(0,s.Lk)("h4",null,"Implementation Details",-1)),(0,s.Lk)("div",vse,[(0,s.Lk)("div",kse,[t[16]||(t[16]=(0,s.Lk)("label",null,"Type:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.MandatoryOptional),1)]),(0,s.Lk)("div",hse,[t[17]||(t[17]=(0,s.Lk)("label",null,"Implementation:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.ManualAutomatic),1)]),(0,s.Lk)("div",gse,[t[18]||(t[18]=(0,s.Lk)("label",null,"Maturity Level:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.MaturityLevel),1)])])]),r.value.IsRisk?((0,s.uX)(),(0,s.CE)("div",yse,[t[22]||(t[22]=(0,s.Lk)("h4",null,"Risk Information",-1)),(0,s.Lk)("div",fse,[(0,s.Lk)("div",bse,[t[20]||(t[20]=(0,s.Lk)("label",null,"Possible Damage:",-1)),(0,s.Lk)("p",null,(0,d.v_)(r.value.PossibleDamage),1)]),(0,s.Lk)("div",Cse,[t[21]||(t[21]=(0,s.Lk)("label",null,"Mitigation:",-1)),(0,s.Lk)("p",null,(0,d.v_)(r.value.mitigation),1)])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Lse,[t[26]||(t[26]=(0,s.Lk)("h4",null,"Hierarchy",-1)),(0,s.Lk)("div",wse,[(0,s.Lk)("div",Ese,[t[23]||(t[23]=(0,s.Lk)("label",null,"Framework:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.FrameworkName),1)]),(0,s.Lk)("div",Rse,[t[24]||(t[24]=(0,s.Lk)("label",null,"Policy:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.PolicyName),1)]),(0,s.Lk)("div",Ise,[t[25]||(t[25]=(0,s.Lk)("label",null,"SubPolicy:",-1)),(0,s.Lk)("span",null,(0,d.v_)(r.value.SubPolicyName),1)])])])])])])):(0,s.Q3)("",!0)]))]))}};const Pse=(0,le.A)(Dse,[["__scopeId","data-v-5429f7a0"]]);var _se=Pse;const Ase={class:"compliance-view-container"},Sse={class:"action-bar"},Tse={class:"action-buttons"},xse={class:"export-section"},Fse={key:0,class:"error-message"},Vse={key:1,class:"loading-spinner"},Use={class:"content-wrapper"},Nse={key:0,class:"loading-spinner"},Mse={key:1,class:"no-data"},Xse={key:2,class:"compliances-grid"},$se={class:"compliance-header"},Ose={class:"compliance-body"},jse={class:"clean-details-grid"},Bse={class:"detail-row"},Wse={class:"detail-value"},qse={class:"detail-row"},Qse={class:"detail-value"},Kse={class:"detail-row"},Jse={class:"detail-value"},zse={class:"detail-row"},Hse={class:"compliance-footer"},Gse={class:"identifier"},Yse={key:3,class:"compliances-list-view"},Zse=["onClick"],eoe={key:1};var toe={__name:"ComplianceAuditView",setup(e){const t=(0,ae.lq)(),i=(0,ae.rd)(),o=(0,ie.KR)(t.params.type),l=(0,ie.KR)(t.params.id),n=(0,ie.KR)(decodeURIComponent(t.params.name)),r=(0,ie.KR)([]),c=(0,ie.KR)(!1),u=(0,ie.KR)(null),p=(0,ie.KR)("xlsx"),m=(0,ie.KR)("list"),v=(0,s.EW)(()=>`Compliance Audit Status - ${n.value}`),k=[{key:"audit_findings_id",label:"Audit Findings ID",sortable:!0},{key:"ComplianceItemDescription",label:"Compliance",sortable:!0},{key:"Criticality",label:"Criticality",sortable:!0},{key:"audit_findings_status",label:"Completion Status",sortable:!0},{key:"audit_performer_name",label:"Compliance Performed By",sortable:!0},{key:"audit_approver_name",label:"Compliance Approved By",sortable:!0},{key:"audit_date",label:"Completion Date",sortable:!0}],h=(0,s.EW)(()=>r.value.map(e=>({audit_findings_id:e.audit_findings_id||"N/A",ComplianceItemDescription:e.ComplianceItemDescription,Criticality:e.Criticality,audit_findings_status:e.audit_findings_status||"Not Audited",audit_performer_name:e.audit_performer_name||"N/A",audit_approver_name:e.audit_approver_name||"N/A",audit_date:y(e.audit_date),ComplianceId:e.ComplianceId})));async function g(){try{c.value=!0,u.value=null;let e="";switch(o.value){case"framework":e=`/api/compliance/view/framework/${l.value}/`;break;case"policy":e=`/api/compliance/view/policy/${l.value}/`;break;case"subpolicy":e=`/api/compliance/view/subpolicy/${l.value}/`;break;default:throw new Error("Invalid type specified")}const t=await He.A.get(e);if(console.log("API Response:",t.data),!t.data||!t.data.success)throw new Error(t.data.message||"Failed to fetch compliances");{const e=t.data.compliances,i=await Promise.all(e.map(async e=>{try{const t=await I4.Hi.getComplianceAuditInfo(e.ComplianceId);return t.data&&t.data.success?{...e,...t.data.data}:e}catch(t){return console.error(`Error fetching audit info for compliance ${e.ComplianceId}:`,t),e}}));r.value=i}}catch(e){console.error("Error fetching compliances:",e),u.value="Failed to fetch compliances. Please try again.",r.value=[]}finally{c.value=!1}}function y(e){return e?new Date(e).toLocaleDateString():"N/A"}function f(e){if(!e)return"not-audited";const t=e.toLowerCase();return t.includes("non")||t.includes("not compliant")?"non-compliant":t.includes("partially")?"partially-compliant":t.includes("fully")?"fully-compliant":t.includes("not applicable")?"not-applicable":"not-audited"}function b(e){if(!e)return"fas fa-question-circle";const t=e.toLowerCase();return t.includes("non")||t.includes("not compliant")?"fas fa-times-circle":t.includes("partially")?"fas fa-exclamation-circle":t.includes("fully")?"fas fa-check-circle":t.includes("not applicable")?"fas fa-ban":"fas fa-question-circle"}function C(e){if(!e)return"Not Audited";const t=e.toLowerCase();return t.includes("non")||t.includes("not compliant")?"Non Conformity":t.includes("partially")?"Control Gap":e}function L(){i.back()}function w(e){e&&i.push(`/audit-findings/${e}`)}async function E(e){try{console.log(`Attempting export for ${o.value} ${l.value} in ${e} format`);const t=await(0,He.A)({url:`/api/export/audit-compliances/${e}/${o.value}/${l.value}/`,method:"GET",responseType:"blob",timeout:3e4,headers:{Accept:"application/json, application/pdf, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, text/csv, application/xml"}}),i=t.headers["content-type"],a=new Blob([t.data],{type:i});let s=`audit_compliances_${o.value}_${l.value}.${e}`;const n=t.headers["content-disposition"];n&&n.includes("filename=")&&(s=n.split("filename=")[1].replace(/"/g,""));const r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=s,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href),(0,Qae.nk)({message:"Export completed successfully",type:"success",duration:3e3})}catch(u){console.error("Export error:",u);const t=u.response?.data?.message||u.message||"Failed to export compliances";(0,Qae.nk)({message:t,type:"error",duration:5e3})}}return(0,s.sV)(async()=>{await g()}),(e,t)=>((0,s.uX)(),(0,s.CE)("div",Ase,[(0,s.Lk)("div",Sse,[(0,s.Lk)("div",Tse,[(0,s.Lk)("div",xse,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),class:"format-select"},t[2]||(t[2]=[(0,s.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option>',5)]),512),[[a.u1,p.value]]),(0,s.Lk)("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=e=>E(p.value))},t[3]||(t[3]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" Export ")]))]),(0,s.Lk)("button",{class:"btn btn-outline",onClick:L},t[4]||(t[4]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back ")]))])]),(0,s.Lk)("h1",null,(0,d.v_)(v.value),1),u.value?((0,s.uX)(),(0,s.CE)("div",Fse,[t[5]||(t[5]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(u.value),1)])):(0,s.Q3)("",!0),c.value?((0,s.uX)(),(0,s.CE)("div",Vse,t[6]||(t[6]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading...",-1)]))):(0,s.Q3)("",!0),(0,s.Lk)("div",Use,[c.value?((0,s.uX)(),(0,s.CE)("div",Nse,t[7]||(t[7]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading compliances...",-1)]))):r.value.length?"card"===m.value?((0,s.uX)(),(0,s.CE)("div",Xse,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.value,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,class:"compliance-card"},[(0,s.Lk)("div",$se,[(0,s.Lk)("span",{class:(0,d.C4)(["criticality-badge","criticality-"+e.Criticality.toLowerCase()])},(0,d.v_)(e.Criticality),3)]),(0,s.Lk)("div",Ose,[(0,s.Lk)("h3",null,(0,d.v_)(e.ComplianceItemDescription),1),(0,s.Lk)("div",jse,[(0,s.Lk)("div",Bse,[t[9]||(t[9]=(0,s.Lk)("span",{class:"detail-label"},"Compliance Performed By:",-1)),(0,s.Lk)("span",Wse,(0,d.v_)(e.audit_performer_name||"N/A"),1)]),(0,s.Lk)("div",qse,[t[10]||(t[10]=(0,s.Lk)("span",{class:"detail-label"},"Compliance Approved By:",-1)),(0,s.Lk)("span",Qse,(0,d.v_)(e.audit_approver_name||"N/A"),1)]),(0,s.Lk)("div",Kse,[t[11]||(t[11]=(0,s.Lk)("span",{class:"detail-label"},"Completion Date:",-1)),(0,s.Lk)("span",Jse,(0,d.v_)(y(e.audit_date)),1)]),(0,s.Lk)("div",zse,[t[12]||(t[12]=(0,s.Lk)("span",{class:"detail-label"},"Completion Status:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["detail-value",f(e.audit_findings_status)])},[(0,s.Lk)("i",{class:(0,d.C4)(b(e.audit_findings_status))},null,2),(0,s.eW)(" "+(0,d.v_)(C(e.audit_findings_status)),1)],2)])]),(0,s.Lk)("div",Hse,[(0,s.Lk)("div",Gse,"ID: "+(0,d.v_)(e.Identifier),1)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",Yse,[(0,s.bF)(Hn.A,{data:h.value,columns:k,"show-pagination":!0,"show-actions":!1,"unique-key":"ComplianceId"},{"cell-audit_findings_id":(0,s.k6)(({value:e})=>[e&&"N/A"!==e?((0,s.uX)(),(0,s.CE)("a",{key:0,href:"#",class:"audit-id-link",onClick:(0,a.D$)(t=>w(e),["prevent"])},(0,d.v_)(e),9,Zse)):((0,s.uX)(),(0,s.CE)("span",eoe,"N/A"))]),_:1},8,["data"])])):((0,s.uX)(),(0,s.CE)("div",Mse,t[8]||(t[8]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("p",null,"No compliances found",-1)])))])]))}};const ioe=toe;var aoe=ioe;const soe={class:"dashboard-container"},ooe={class:"dashboard-header"},loe={class:"header-actions"},noe={class:"metrics-grid"},roe={class:"metric-card"},coe={class:"metric-content"},doe={class:"metric-value"},uoe={class:"percentage"},poe={class:"metric-change"},moe={class:"metric-card"},voe={class:"metric-content"},koe={class:"metric-value"},hoe={class:"number"},goe={class:"metric-card"},yoe={class:"metric-content"},foe={class:"metric-value"},boe={class:"number"},Coe={class:"metric-card"},Loe={class:"metric-content"},woe={class:"metric-value"},Eoe={class:"number"},Roe={class:"dashboard-content"},Ioe={class:"performance-chart"},Doe={class:"chart-header"},Poe={class:"chart-controls"},_oe={class:"chart-type-icons"},Aoe={class:"axis-controls"},Soe={class:"axis-select"},Toe={class:"axis-select"},xoe={class:"recent-activity"},Foe={class:"activity-header"},Voe={class:"activity-list"},Uoe={key:0,class:"activity-loading"},Noe={key:1,class:"activity-empty"},Moe={class:"activity-details"},Xoe={class:"activity-time"};function $oe(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",soe,[(0,s.Lk)("div",ooe,[t[12]||(t[12]=(0,s.Lk)("h1",null,"Compliance Dashboard",-1)),(0,s.Lk)("div",loe,[(0,s.Lk)("button",{class:"refresh-btn",onClick:t[0]||(t[0]=(...e)=>n.refreshData&&n.refreshData(...e))},t[10]||(t[10]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1)])),t[11]||(t[11]=(0,s.Lk)("button",{class:"download-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",noe,[(0,s.Lk)("div",roe,[t[14]||(t[14]=(0,s.Lk)("div",{class:"metric-icon compliance-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",coe,[t[13]||(t[13]=(0,s.Lk)("h3",null,"Approval Rate",-1)),(0,s.Lk)("div",doe,[(0,s.Lk)("span",uoe,(0,d.v_)(l.dashboardData.approval_rate)+"%",1)]),(0,s.Lk)("div",poe," Based on "+(0,d.v_)(l.dashboardData.total_count)+" compliances ",1)])]),(0,s.Lk)("div",moe,[t[17]||(t[17]=(0,s.Lk)("div",{class:"metric-icon policies-icon"},[(0,s.Lk)("i",{class:"fas fa-file-alt"})],-1)),(0,s.Lk)("div",voe,[t[15]||(t[15]=(0,s.Lk)("h3",null,"Active Compliances",-1)),(0,s.Lk)("div",koe,[(0,s.Lk)("span",hoe,(0,d.v_)(l.dashboardData.status_counts.active_compliance||0),1)]),t[16]||(t[16]=(0,s.Lk)("div",{class:"metric-change"}," Active and Approved ",-1))])]),(0,s.Lk)("div",goe,[t[20]||(t[20]=(0,s.Lk)("div",{class:"metric-icon risk-icon"},[(0,s.Lk)("i",{class:"fas fa-list"})],-1)),(0,s.Lk)("div",yoe,[t[18]||(t[18]=(0,s.Lk)("h3",null,"Total Findings",-1)),(0,s.Lk)("div",foe,[(0,s.Lk)("span",boe,(0,d.v_)(l.dashboardData.total_findings),1)]),t[19]||(t[19]=(0,s.Lk)("div",{class:"metric-change"}," Across all compliances ",-1))])]),(0,s.Lk)("div",Coe,[t[23]||(t[23]=(0,s.Lk)("div",{class:"metric-icon review-icon"},[(0,s.Lk)("i",{class:"fas fa-clock"})],-1)),(0,s.Lk)("div",Loe,[t[21]||(t[21]=(0,s.Lk)("h3",null,"Under Review",-1)),(0,s.Lk)("div",woe,[(0,s.Lk)("span",Eoe,(0,d.v_)(l.dashboardData.status_counts.under_review),1)]),t[22]||(t[22]=(0,s.Lk)("div",{class:"metric-change"}," Pending review ",-1))])])]),(0,s.Lk)("div",Roe,[(0,s.Lk)("div",Ioe,[(0,s.Lk)("div",Doe,[t[32]||(t[32]=(0,s.Lk)("h2",null,"Compliance Analytics",-1)),(0,s.Lk)("div",Poe,[(0,s.Lk)("div",_oe,[(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"bar"===l.selectedChartType}]),onClick:t[1]||(t[1]=e=>n.changeChartType("bar")),title:"Bar Chart"},t[24]||(t[24]=[(0,s.Lk)("i",{class:"fas fa-chart-bar"},null,-1)]),2),(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"line"===l.selectedChartType}]),onClick:t[2]||(t[2]=e=>n.changeChartType("line")),title:"Line Chart"},t[25]||(t[25]=[(0,s.Lk)("i",{class:"fas fa-chart-line"},null,-1)]),2),(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"pie"===l.selectedChartType}]),onClick:t[3]||(t[3]=e=>n.changeChartType("pie")),title:"Pie Chart"},t[26]||(t[26]=[(0,s.Lk)("i",{class:"fas fa-chart-pie"},null,-1)]),2),(0,s.Lk)("button",{class:(0,d.C4)(["chart-type-btn",{active:"doughnut"===l.selectedChartType}]),onClick:t[4]||(t[4]=e=>n.changeChartType("doughnut")),title:"Doughnut Chart"},t[27]||(t[27]=[(0,s.Lk)("i",{class:"fas fa-circle-notch"},null,-1)]),2)]),(0,s.Lk)("div",Aoe,[(0,s.Lk)("div",Soe,[t[29]||(t[29]=(0,s.Lk)("label",null,"X Axis:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>l.selectedXAxis=e),onChange:t[6]||(t[6]=(...e)=>n.fetchDashboardData&&n.fetchDashboardData(...e))},t[28]||(t[28]=[(0,s.Lk)("option",{value:"Compliance"},"Compliance",-1)]),544),[[a.u1,l.selectedXAxis]])]),(0,s.Lk)("div",Toe,[t[31]||(t[31]=(0,s.Lk)("label",null,"Y Axis:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.selectedYAxis=e),onChange:t[8]||(t[8]=(...e)=>n.fetchDashboardData&&n.fetchDashboardData(...e))},t[30]||(t[30]=[(0,s.Fv)('<option value="Criticality">By Criticality</option><option value="Status">By Status</option><option value="ActiveInactive">By Active/Inactive</option><option value="ManualAutomatic">By Manual/Automatic</option><option value="MandatoryOptional">By Mandatory/Optional</option><option value="MaturityLevel">By Maturity Level</option>',6)]),544),[[a.u1,l.selectedYAxis]])])])])]),t[33]||(t[33]=(0,s.Lk)("div",{class:"chart-container"},[(0,s.Lk)("canvas",{id:"myChart"})],-1))]),(0,s.Lk)("div",xoe,[(0,s.Lk)("div",Foe,[t[34]||(t[34]=(0,s.Lk)("h2",null,"Recent Activity",-1)),(0,s.Lk)("button",{class:"more-options",onClick:t[9]||(t[9]=(...e)=>n.refreshRecentActivities&&n.refreshRecentActivities(...e))},[(0,s.Lk)("i",{class:(0,d.C4)(["fas fa-sync",{"fa-spin":l.loadingActivities}])},null,2)])]),(0,s.Lk)("div",Voe,[l.loadingActivities?((0,s.uX)(),(0,s.CE)("div",Uoe,t[35]||(t[35]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.Lk)("span",null,"Loading recent activities...",-1)]))):0===l.recentActivities.length?((0,s.uX)(),(0,s.CE)("div",Noe,t[36]||(t[36]=[(0,s.Lk)("i",{class:"fas fa-inbox"},null,-1),(0,s.Lk)("span",null,"No recent activities found",-1)]))):((0,s.uX)(!0),(0,s.CE)(s.FK,{key:2},(0,s.pI)(l.recentActivities,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"activity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["activity-icon",e.type])},[(0,s.Lk)("i",{class:(0,d.C4)(e.icon)},null,2)],2),(0,s.Lk)("div",Moe,[(0,s.Lk)("h4",null,(0,d.v_)(e.title),1),(0,s.Lk)("p",null,(0,d.v_)(e.description),1),(0,s.Lk)("span",Xoe,(0,d.v_)(e.time),1)])]))),128))])])])])}Ze.t1.register(Ze.PP,Ze.kc,Ze.E8,Ze.FN,Ze.No,Ze.Bs,Ze.pr,Ze.hE,Ze.m_,Ze.s$);var Ooe={name:"ComplianceDashboard",data(){return{selectedChartType:"bar",selectedXAxis:"Compliance",selectedYAxis:"Criticality",chart:null,chartId:"myChart",api:{complianceService:I4.fv},dashboardData:{status_counts:{approved:0,active:0,under_review:0},total_count:0,total_findings:0,approval_rate:0},chartData:null,recentActivities:[],loadingActivities:!1,activityRefreshInterval:null}},mounted(){if(!Tr.G4.isLoggedIn())return console.warn("[COMPLIANCE_DASHBOARD] User not logged in, redirecting to login"),void this.$router.push("/login");console.log("[COMPLIANCE_DASHBOARD] User session:",Tr.G4.getUserSession()),this.fetchDashboardData().then(()=>{this.$nextTick(()=>{setTimeout(()=>{this.chart||this.updateChart()},200)})}),this.fetchRecentActivities(),this.activityRefreshInterval=setInterval(()=>{this.fetchRecentActivities()},3e5)},beforeUnmount(){this.destroyChart(),this.activityRefreshInterval&&clearInterval(this.activityRefreshInterval)},beforeRouteLeave(e,t,i){this.destroyChart(),this.activityRefreshInterval&&clearInterval(this.activityRefreshInterval),i()},methods:{destroyChart(){try{this.chart&&(console.log("Destroying existing chart"),this.chart.destroy(),this.chart=null);const e=document.getElementById(this.chartId);if(e){const t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height)}}catch(e){console.error("Error destroying chart:",e),this.chart=null}},async fetchRecentActivities(){try{this.loadingActivities=!0,console.log("Fetching recent activities...");const[t,i]=await Promise.all([this.api.complianceService.getCompliancePolicyApprovals({reviewer_id:2}),this.api.complianceService.getComplianceFrameworks()]);let a=[];if(t.data.success&&t.data.data){const e=t.data.data,i=e.sort((e,t)=>{const i=new Date(e.ApprovedDate||e.ExtractedData?.CreatedByDate||"1970-01-01"),a=new Date(t.ApprovedDate||t.ExtractedData?.CreatedByDate||"1970-01-01");return a-i});i.slice(0,10).forEach(e=>{const t=e.ExtractedData||{},i=t.ComplianceTitle||t.ComplianceItemDescription||"Unknown Compliance",s=t.CreatedByName||"Unknown User",o=t.ComplianceVersion||"1.0";!0===e.ApprovedNot?a.push({type:"approved",icon:"fas fa-check-circle",title:"Compliance Approved",description:`"${this.truncateText(i,50)}" approved by reviewer`,time:this.formatRelativeTime(e.ApprovedDate),metadata:{complianceId:t.compliance_id,version:o,approver:"Reviewer"}}):!1===e.ApprovedNot?a.push({type:"rejected",icon:"fas fa-times-circle",title:"Compliance Rejected",description:`"${this.truncateText(i,50)}" needs revision`,time:this.formatRelativeTime(e.ApprovedDate),metadata:{complianceId:t.compliance_id,version:o,reviewer:"Reviewer"}}):null===e.ApprovedNot&&("compliance_deactivation"===t.type||"Change Status to Inactive"===t.RequestType?a.push({type:"deactivation",icon:"fas fa-power-off",title:"Deactivation Request",description:`Deactivation requested for compliance ID ${t.compliance_id}`,time:this.formatRelativeTime(t.CreatedByDate),metadata:{complianceId:t.compliance_id,reason:t.reason||"No reason provided"}}):parseFloat(o)>1?a.push({type:"version",icon:"fas fa-code-branch",title:"New Version Created",description:`Version ${o} of "${this.truncateText(i,40)}" by ${s}`,time:this.formatRelativeTime(t.CreatedByDate),metadata:{complianceId:t.compliance_id,version:o,creator:s}}):a.push({type:"created",icon:"fas fa-plus-circle",title:"New Compliance Created",description:`"${this.truncateText(i,50)}" created by ${s}`,time:this.formatRelativeTime(t.CreatedByDate),metadata:{complianceId:t.compliance_id,version:o,creator:s}}))})}if(i.data&&Array.isArray(i.data))try{const e=i.data[0];if(e){const t=await this.api.complianceService.getCompliancePolicies(e.id);if(t.data&&Array.isArray(t.data)){const e=t.data[0];if(e){const t=await this.api.complianceService.getComplianceSubPolicies(e.id);if(t.data&&Array.isArray(t.data)){const e=t.data[0];if(e){const t=await this.api.complianceService.getCompliancesBySubPolicy(e.id);if(t.data.success&&t.data.data){const e=t.data.data;e.slice(0,3).forEach(e=>{if(e&&e.length>0){const t=e[0],i=a.find(e=>e.metadata?.complianceId===t.ComplianceId);if(!i&&t.CreatedByDate){const e=new Date(t.CreatedByDate),i=new Date,s=(i-e)/864e5;s<=30&&a.push({type:"updated",icon:"fas fa-edit",title:"Compliance Updated",description:`"${this.truncateText(t.ComplianceItemDescription||"Compliance item",50)}" modified`,time:this.formatRelativeTime(t.CreatedByDate),metadata:{complianceId:t.ComplianceId,version:t.ComplianceVersion,creator:t.CreatedByName}})}}})}}}}}}}catch(e){console.log("Could not fetch additional compliance data:",e.message)}a.sort((e,t)=>{const i=this.parseRelativeTime(e.time),a=this.parseRelativeTime(t.time);return i-a});const s=a.filter((e,t,i)=>t===i.findIndex(t=>t.description===e.description)).slice(0,8);this.recentActivities=s,console.log(`Loaded ${this.recentActivities.length} recent activities`)}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showViewAllComplianceDenied();console.error("Error fetching recent activities:",e),this.recentActivities=[{type:"error",icon:"fas fa-exclamation-triangle",title:"Unable to Load Activities",description:"Please check your connection and try again",time:"now"}]}finally{this.loadingActivities=!1}},truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:"Unknown"},formatRelativeTime(e){if(!e)return"Unknown time";try{const t=new Date(e),i=new Date,a=Math.floor((i-t)/1e3);if(a<60)return"Just now";if(a<3600){const e=Math.floor(a/60);return`${e} minute${1===e?"":"s"} ago`}if(a<86400){const e=Math.floor(a/3600);return`${e} hour${1===e?"":"s"} ago`}if(a<604800){const e=Math.floor(a/86400);return`${e} day${1===e?"":"s"} ago`}{const e=Math.floor(a/604800);return`${e} week${1===e?"":"s"} ago`}}catch(t){return console.error("Error formatting date:",t),"Unknown time"}},parseRelativeTime(e){if("Just now"===e)return 0;const t=e.match(/(\d+)\s+(minute|hour|day|week)s?\s+ago/);if(t){const e=parseInt(t[1]),i=t[2];switch(i){case"minute":return 60*e;case"hour":return 3600*e;case"day":return 86400*e;case"week":return 604800*e;default:return 999999}}return 999999},refreshRecentActivities(){this.fetchRecentActivities()},async fetchDashboardData(){try{console.log("Starting fetchDashboardData..."),console.log("Request payload:",{xAxis:this.selectedXAxis,yAxis:this.selectedYAxis});const[e,t]=await Promise.all([this.api.complianceService.getComplianceDashboard(),this.api.complianceService.getComplianceAnalytics({xAxis:this.selectedXAxis,yAxis:this.selectedYAxis})]);if(console.log("Dashboard API Response:",e.data),console.log("Analytics API Response:",t.data),!e.data.success||!t.data.success)throw new Error(e.data.message||t.data.message||"API request failed");this.dashboardData={status_counts:e.data.data.summary.status_counts||{},total_count:e.data.data.summary.total_count||0,total_findings:e.data.data.summary.total_findings||0,approval_rate:t.data.dashboardData.approval_rate||0},this.chartData=t.data.chartData,console.log("Chart data updated:",this.chartData),await this.$nextTick(),this.updateChart()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showViewAllComplianceDenied();console.error("Error in fetchDashboardData:",e),this.dashboardData={status_counts:{approved:0,active:0,under_review:0},total_count:0,total_findings:0,approval_rate:0},this.chartData={labels:["High","Medium","Low"],datasets:[{label:"Sample Data",data:[10,12,5],backgroundColor:["rgba(244, 67, 54, 0.6)","rgba(255, 152, 0, 0.6)","rgba(76, 175, 80, 0.6)"],borderColor:["#F44336","#FF9800","#4CAF50"],borderWidth:1}]},await this.$nextTick(),this.updateChart()}},updateChart(){try{console.log("Updating chart with type:",this.selectedChartType),console.log("Chart data:",this.chartData),this.destroyChart(),setTimeout(()=>{try{const e=document.getElementById(this.chartId);if(!e)return void console.error("Chart canvas not found");const t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height);const i=this.createChartConfig();console.log("Chart config:",i),this.chart=new Ze.t1(e,i),console.log("Chart created successfully")}catch(e){console.error("Error in inner chart creation:",e)}},100)}catch(e){console.error("Error in updateChart:",e),this.chart=null}},createChartConfig(){if(!this.chartData||!this.chartData.labels||0===this.chartData.labels.length)return console.log("No chart data available, using fallback"),{type:this.selectedChartType,data:{labels:["High","Medium","Low"],datasets:[{label:"Sample Data",data:[10,12,5],backgroundColor:"bar"===this.selectedChartType?["rgba(244, 67, 54, 0.6)","rgba(255, 152, 0, 0.6)","rgba(76, 175, 80, 0.6)"]:["rgba(244, 67, 54, 0.8)","rgba(255, 152, 0, 0.8)","rgba(76, 175, 80, 0.8)"],borderColor:["#F44336","#FF9800","#4CAF50"],borderWidth:1}]},options:this.getChartOptions()};const e={label:this.chartData.datasets[0]?.label||`Compliance by ${this.selectedYAxis.replace("By ","")}`,data:this.chartData.datasets[0]?.data||[],backgroundColor:this.getBackgroundColors(),borderColor:this.getBorderColors(),borderWidth:1};return"line"===this.selectedChartType&&(e.tension=.1,e.fill=!1,e.pointBackgroundColor=this.getBorderColors(),e.pointBorderColor=this.getBorderColors(),e.pointRadius=4,e.pointHoverRadius=6),["pie","doughnut"].includes(this.selectedChartType)&&(e.backgroundColor=this.getBackgroundColors().map(e=>e.replace("0.6","0.8"))),{type:this.selectedChartType,data:{labels:this.chartData.labels,datasets:[e]},options:this.getChartOptions()}},getChartOptions(){const e={responsive:!0,maintainAspectRatio:!1,animation:{duration:800,easing:"easeInOutQuad"},plugins:{legend:{display:!0,position:["pie","doughnut"].includes(this.selectedChartType)?"right":"top",labels:{padding:20,usePointStyle:!0,font:{size:12}}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:6,displayColors:!0,callbacks:{label:e=>{if(["pie","doughnut"].includes(this.selectedChartType)){const t=e.label||"",i=e.raw||0,a=e.chart.data.datasets[0].data.reduce((e,t)=>e+t,0),s=(i/a*100).toFixed(1);return`${t}: ${i} (${s}%)`}return`${e.dataset.label}: ${e.raw}`}}}},layout:{padding:{top:10,bottom:10,left:10,right:10}}};return["bar","line"].includes(this.selectedChartType)&&(e.scales={x:{grid:{display:!1},ticks:{font:{size:11}}},y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{stepSize:1,precision:0,font:{size:11}}}}),"doughnut"===this.selectedChartType&&(e.cutout="60%"),e},changeChartType(e){console.log("Changing chart type from",this.selectedChartType,"to",e),this.selectedChartType!==e&&(this.selectedChartType=e,this.$nextTick(()=>{setTimeout(()=>{this.updateChart()},50)}))},getBackgroundColors(){const e={Criticality:{High:"rgba(244, 67, 54, 0.6)",Medium:"rgba(255, 152, 0, 0.6)",Low:"rgba(76, 175, 80, 0.6)"},Status:{Approved:"rgba(76, 175, 80, 0.6)","Under Review":"rgba(255, 152, 0, 0.6)",Rejected:"rgba(244, 67, 54, 0.6)",Active:"rgba(33, 150, 243, 0.6)"},ActiveInactive:{Active:"rgba(76, 175, 80, 0.6)",Inactive:"rgba(158, 158, 158, 0.6)"},ManualAutomatic:{Manual:"rgba(33, 150, 243, 0.6)",Automatic:"rgba(156, 39, 176, 0.6)"},MandatoryOptional:{Mandatory:"rgba(244, 67, 54, 0.6)",Optional:"rgba(255, 152, 0, 0.6)"},MaturityLevel:{Initial:"rgba(244, 67, 54, 0.6)",Developing:"rgba(255, 152, 0, 0.6)",Defined:"rgba(255, 235, 59, 0.6)",Managed:"rgba(76, 175, 80, 0.6)",Optimizing:"rgba(33, 150, 243, 0.6)"}};return this.chartData?.labels?.map(t=>e[this.selectedYAxis.replace("By ","")][t]||"rgba(158, 158, 158, 0.6)")||[]},getBorderColors(){const e={Criticality:{High:"#F44336",Medium:"#FF9800",Low:"#4CAF50"},Status:{Approved:"#4CAF50","Under Review":"#FF9800",Rejected:"#F44336",Active:"#2196F3"},ActiveInactive:{Active:"#4CAF50",Inactive:"#9E9E9E"},ManualAutomatic:{Manual:"#2196F3",Automatic:"#9C27B0"},MandatoryOptional:{Mandatory:"#F44336",Optional:"#FF9800"},MaturityLevel:{Initial:"#F44336",Developing:"#FF9800",Defined:"#FFEB3B",Managed:"#4CAF50",Optimizing:"#2196F3"}};return this.chartData?.labels?.map(t=>e[this.selectedYAxis.replace("By ","")][t]||"#9E9E9E")||[]},refreshData(){this.fetchDashboardData(),this.fetchRecentActivities()}}};const joe=(0,le.A)(Ooe,[["render",$oe]]);var Boe=joe;const Woe={class:"compliance-versioning-container"},qoe={class:"compliance-selection-row"},Qoe={class:"compliance-selection-group"},Koe={class:"compliance-selection-group"},Joe={class:"compliance-selection-group"},zoe={key:0,class:"compliance-loading-overlay"},Hoe={key:1,class:"compliance-error-message"},Goe={key:2,class:"compliance-table-container"},Yoe={key:0,class:"loading"},Zoe={key:1,class:"no-compliances"},ele={class:"compliance-action-btn-group"},tle=["onClick"],ile=["onClick"];function ale(e,t,i,a,o,l){const n=(0,s.g2)("CustomDropdown"),r=(0,s.g2)("DynamicTable"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Woe,[t[9]||(t[9]=(0,s.Lk)("div",{class:"compliance-heading"},[(0,s.Lk)("h1",null,"Compliance Tailoring & Templating"),(0,s.Lk)("div",{class:"compliance-heading-underline"})],-1)),(0,s.Lk)("div",qoe,[(0,s.Lk)("div",Qoe,[(0,s.bF)(n,{config:o.frameworkDropdownConfig,modelValue:o.selectedFrameworkId,"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedFrameworkId=e),disabled:o.loading,onChange:l.onFrameworkChange},null,8,["config","modelValue","disabled","onChange"])]),(0,s.Lk)("div",Koe,[(0,s.bF)(n,{config:o.policyDropdownConfig,modelValue:o.selectedPolicyId,"onUpdate:modelValue":t[1]||(t[1]=e=>o.selectedPolicyId=e),disabled:!o.selectedFrameworkId||o.loading,onChange:l.onPolicyChange},null,8,["config","modelValue","disabled","onChange"])]),(0,s.Lk)("div",Joe,[(0,s.bF)(n,{config:o.subPolicyDropdownConfig,modelValue:o.selectedSubPolicyId,"onUpdate:modelValue":t[2]||(t[2]=e=>o.selectedSubPolicyId=e),disabled:!o.selectedPolicyId||o.loading,onChange:l.onSubPolicyChange},null,8,["config","modelValue","disabled","onChange"])])]),o.loading?((0,s.uX)(),(0,s.CE)("div",zoe,t[4]||(t[4]=[(0,s.Lk)("div",{class:"compliance-spinner"},null,-1),(0,s.Lk)("div",{class:"compliance-loading-text"},"Loading data...",-1)]))):(0,s.Q3)("",!0),o.error?((0,s.uX)(),(0,s.CE)("div",Hoe,[t[5]||(t[5]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.error)+" ",1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...t)=>e.refreshCurrentData&&e.refreshCurrentData(...t)),class:"compliance-retry-btn"},"Retry")])):(0,s.Q3)("",!0),o.selectedSubPolicy?((0,s.uX)(),(0,s.CE)("div",Goe,[t[8]||(t[8]=(0,s.Lk)("h3",null,"Compliances for Selected Subpolicy",-1)),o.loading?((0,s.uX)(),(0,s.CE)("div",Yoe,"Loading compliances...")):0===o.complianceList.length?((0,s.uX)(),(0,s.CE)("div",Zoe,"No compliances found for this subpolicy.")):((0,s.uX)(),(0,s.Wv)(r,{key:2,data:o.complianceList,columns:o.tableColumns,showActions:!0},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("div",ele,[(0,s.Lk)("button",{onClick:t=>l.navigateToEdit(e),title:"Edit",class:"compliance-action-btn compliance-edit-btnn"},t[6]||(t[6]=[(0,s.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,tle),(0,s.Lk)("button",{onClick:t=>l.startCopy(e),title:"Copy",class:"compliance-action-btn compliance-copy-btnn"},t[7]||(t[7]=[(0,s.Lk)("i",{class:"fas fa-copy"},null,-1)]),8,ile)])]),_:1},8,["data","columns"]))])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var sle={name:"ComplianceTailoring",components:{PopupModal:Ck.wA,CustomDropdown:xa.A,DynamicTable:Hn.A},mixins:[j9],data(){return{frameworks:[],selectedFramework:"",selectedFrameworkId:"",policies:[],selectedPolicy:"",selectedPolicyId:"",complianceSubPolicies:[],selectedSubPolicy:"",selectedSubPolicyId:"",complianceList:[],loading:!1,error:null,frameworkDropdownConfig:{label:"Framework",values:[]},policyDropdownConfig:{label:"Policy",values:[]},subPolicyDropdownConfig:{label:"Sub Policy",values:[]},categoryOptions:{RiskCategory:[],RiskType:[],BusinessUnitsCovered:[],RiskBusinessImpact:[]},tableColumns:[{key:"ComplianceTitle",label:"Title"},{key:"ComplianceItemDescription",label:"Description"},{key:"Status",label:"Status"},{key:"ComplianceVersion",label:"Version"}]}},async created(){await this.loadFrameworks(),await this.loadUsers(),await this.loadCategoryOptions(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},watch:{selectedFrameworkId(e){const t=this.frameworks.find(t=>t.id===e);this.selectedFramework=t||"",t&&(this.loadPolicies(t.id),this.selectedPolicy="",this.selectedPolicyId="",this.selectedSubPolicy="",this.selectedSubPolicyId="",this.policies=[],this.complianceSubPolicies=[],this.complianceList=[])},selectedPolicyId(e){const t=this.policies.find(t=>t.id===e);this.selectedPolicy=t||"",t&&(this.loadSubPolicies(t.id),this.selectedSubPolicy="",this.selectedSubPolicyId="",this.complianceSubPolicies=[],this.complianceList=[])},selectedSubPolicyId(e){const t=this.complianceSubPolicies.find(t=>t.id===e);this.selectedSubPolicy=t||"",t?this.loadCompliances():this.complianceList=[]}},computed:{},methods:{async loadFrameworks(){try{this.loading=!0;const e=await I4.fv.getComplianceFrameworks();let t;if(console.log("Frameworks response:",e.data),e.data.success&&e.data.frameworks)t=e.data.frameworks;else{if(!Array.isArray(e.data))return console.error("Unexpected response format:",e.data),void(this.error="Failed to load frameworks");t=e.data}this.frameworks=t.map(e=>({id:e.id,name:e.name})),console.log("Loaded frameworks:",this.frameworks),this.frameworkDropdownConfig.values=this.frameworks.map(e=>({value:e.id,label:e.name}))}catch(e){this.error="Failed to load frameworks",console.error("Error loading frameworks:",e)}finally{this.loading=!1}},async loadPolicies(e){try{this.loading=!0;const t=await I4.fv.getCompliancePolicies(e);t.data.success&&t.data.policies?(this.policies=t.data.policies.map(e=>({id:e.id,name:e.name,applicability:e.scope||""})),this.policyDropdownConfig.values=this.policies.map(e=>({value:e.id,label:e.name}))):(console.error("Error in response:",t.data),this.error="Failed to load policies")}catch(t){this.error="Failed to load policies",console.error(t)}finally{this.loading=!1}},async loadSubPolicies(e){try{this.loading=!0;const t=await I4.fv.getComplianceSubPolicies(e);console.log("SubPolicies response:",t),t.data.success&&t.data.subpolicies?(console.log("SubPolicies data:",t.data.subpolicies),this.complianceSubPolicies=t.data.subpolicies.map(e=>({id:e.id,name:e.name})),console.log("Mapped complianceSubPolicies:",this.complianceSubPolicies),this.subPolicyDropdownConfig.values=this.complianceSubPolicies.map(e=>({value:e.id,label:e.name}))):(console.error("Error in response:",t.data),this.error="Failed to load sub-policies")}catch(t){this.error="Failed to load sub-policies",console.error("SubPolicies error:",t)}finally{this.loading=!1}},async loadUsers(){try{this.loading=!0;const e=await I4.fv.getUsers();console.log("Users API response:",e),e.data.success&&Array.isArray(e.data.users)?(this.users=e.data.users,console.log("Loaded users:",this.users)):(console.error("Invalid users data received:",e.data),this.error="Failed to load approvers")}catch(e){console.error("Failed to load users:",e),this.error="Failed to load approvers. Please try again."}finally{this.loading=!1}},async loadCategoryOptions(){try{this.loading=!0;const e=await I4.fv.getCategoryBusinessUnits("RiskCategory");e.data.success&&(this.categoryOptions.RiskCategory=e.data.data);const t=await I4.fv.getCategoryBusinessUnits("RiskType");t.data.success&&(this.categoryOptions.RiskType=t.data.data);const i=await I4.fv.getCategoryBusinessUnits("BusinessUnitsCovered");i.data.success&&(this.categoryOptions.BusinessUnitsCovered=i.data.data);const a=await I4.fv.getCategoryBusinessUnits("RiskBusinessImpact");a.data.success&&(this.categoryOptions.RiskBusinessImpact=a.data.data)}catch(e){console.error("Failed to load category options:",e),Ck.OQ.error("Failed to load dropdown options. Some features may be limited.")}finally{this.loading=!1}},showDropdown(e){this.activeDropdown=e,this.filterOptions(e),event.stopPropagation()},handleClickOutside(e){const t=document.querySelectorAll(".searchable-dropdown");let i=!0;t.forEach(t=>{t.contains(e.target)&&(i=!1)}),i&&(this.activeDropdown=null)},filterOptions(e){let t="";switch(e){case"BusinessUnitsCovered":t=this.businessUnitSearch||"";break;case"RiskType":t=this.riskTypeSearch||"";break;case"RiskCategory":t=this.riskCategorySearch||"";break;case"RiskBusinessImpact":t=this.riskBusinessImpactSearch||"";break}const i=t.toLowerCase();this.filteredOptions[e]=this.categoryOptions[e].filter(e=>e.value.toLowerCase().includes(i))},selectOption(e,t){switch(this.editRow[e]=t,e){case"BusinessUnitsCovered":this.businessUnitSearch=t;break;case"RiskType":this.riskTypeSearch=t;break;case"RiskCategory":this.riskCategorySearch=t;break;case"RiskBusinessImpact":this.riskBusinessImpactSearch=t;break}this.activeDropdown=null},async addNewOption(e,t){if(t&&t.trim())try{this.loading=!0;const i=await I4.fv.addCategoryBusinessUnit({source:e,value:t.trim()});if(!i.data.success)throw new Error(i.data.error||"Failed to add new option");{const t={id:i.data.data.id,value:i.data.data.value};this.categoryOptions[e]=[...this.categoryOptions[e],t],this.filteredOptions[e]=[...this.filteredOptions[e],t],this.selectOption(e,t.value),this.editRow[e]=t.value,D4.complianceCreated({message:`Added new ${e} option: ${t.value}`}),await this.loadCategoryOptions()}}catch(i){console.error(`Failed to add new ${e} option:`,i),this.error=`Failed to add new option: ${i.message||i}`}finally{this.loading=!1}},async loadCompliances(){if(this.selectedSubPolicy)try{this.loading=!0;const e=await I4.fv.getCompliancesByType("subpolicy",this.selectedSubPolicy.id);console.log("Compliances response:",e),e.data.success&&e.data.compliances?(this.complianceList=e.data.compliances.map(e=>{const t=this.parseMitigationSteps(e.mitigation);return{...e,mitigationSteps:t}}),console.log("Loaded compliances with mitigation steps:",this.complianceList)):(console.error("Error in response:",e.data),this.error="Failed to load compliances")}catch(e){this.error="Failed to load compliances",console.error("Compliances error:",e)}finally{this.loading=!1}},formatDate(e){if(!e)return"";try{let t;if("string"===typeof e)if(e.includes("T"))t=new Date(e);else if(e.includes("-")){const i=e.split(" ")[0].split("-");t=new Date(i[0],i[1]-1,i[2])}else if(e.includes("/")){const i=e.split(" ")[0].split("/");t=new Date(i[2],i[0]-1,i[1])}else t=new Date(e);else t=new Date(e);return t.toLocaleString()}catch(t){return console.error("Error formatting date:",t),e}},viewComplianceDetails(e){D4.showComplianceInfo(e)},getDefaultDueDate(){const e=new Date;return e.setDate(e.getDate()+7),e.toISOString().split("T")[0]},navigateToEdit(e){e.mitigation?(console.log("Original mitigation data:",e.mitigation),e.mitigationSteps=Object.entries(e.mitigation).map(e=>({description:e[1]}))):e.mitigationSteps=[{description:""}],console.log("Initialized mitigation steps:",e.mitigationSteps),this.$router.push(`/compliance/edit/${e.ComplianceId}`)},parseMitigationSteps(e){if(console.log("Parsing mitigation:",e),!e)return[{description:""}];try{if("string"===typeof e)return[{description:e}];if(Array.isArray(e))return e.map(e=>({description:"string"===typeof e?e:e.description||""}));if("object"===typeof e)return Object.values(e).map(e=>({description:"string"===typeof e?e:e.description||""}))}catch(t){console.error("Error parsing mitigation steps:",t)}return[{description:""}]},addStep(e){console.log("Adding step to row:",e),e.mitigationSteps||(e.mitigationSteps=[]),e.mitigationSteps.push({description:""}),this.onMitigationStepChange(e)},removeStep(e,t){console.log("Removing step at index:",t,"from row:",e),e.mitigationSteps.splice(t,1),0===e.mitigationSteps.length&&e.mitigationSteps.push({description:""}),this.onMitigationStepChange(e)},onMitigationStepChange(e){console.log("Mitigation step change triggered for row:",e),console.log("Current mitigation steps:",e.mitigationSteps);const t=e.mitigationSteps.every(e=>e.description.length>=10);if(!t)return void D4.error({message:"Each mitigation step must be at least 10 characters long"});const i={};e.mitigationSteps.forEach((e,t)=>{const a=e.description.trim();a&&(i[`${t+1}`]=a)}),Object.keys(i).length>0?(e.mitigation=i,console.log("Updated mitigation data:",e.mitigation)):(e.mitigation=null,console.log("No valid mitigation steps found, setting to null"))},startCopy(e){this.$router.push({name:"CopyCompliance",params:{id:e.ComplianceId},query:{frameworkId:this.selectedFramework?.id||"",frameworkName:this.selectedFramework?.name||"",policyId:this.selectedPolicy?.id||"",policyName:this.selectedPolicy?.name||"",subPolicyId:this.selectedSubPolicy?.id||"",subPolicyName:this.selectedSubPolicy?.name||""}})},async handleCopySuccess(){await this.loadCompliances(),D4.complianceCreated({message:"Compliance copied successfully"})},onFrameworkChange(e){this.selectedFrameworkId=e.value},onPolicyChange(e){this.selectedPolicyId=e.value},onSubPolicyChange(e){this.selectedSubPolicyId=e.value},async handleSubmit(e){try{if(e.mitigationSteps&&e.mitigationSteps.length>0){const t={};e.mitigationSteps.forEach((e,i)=>{e.description.trim()&&(t[`${i+1}`]=e.description.trim())}),Object.keys(t).length>0&&(e.mitigation=t)}console.log("Submitting form data with mitigation:",e.mitigation),await I4.fv.updateCompliance(e),D4.complianceUpdated(e)}catch(t){console.error("Error submitting form:",t),D4.error({message:`Failed to update compliance: ${t.message||t}`})}}}};const ole=(0,le.A)(sle,[["render",ale],["__scopeId","data-v-8aa8a78c"]]);var lle=ole;const nle={class:"version-list-container"},rle={class:"filter-section"},cle={class:"filter-group"},dle={class:"filter-group"},ule={class:"filter-group"},ple={key:0,class:"table-container"},mle={class:"group-header"},vle={class:"group-description"},kle={class:"table-wrapper"},hle={class:"toggle-switch"},gle=["id","checked","onChange","disabled"],yle=["for"],fle={key:1,class:"no-data"},ble={key:2,class:"error-message"},Cle={class:"error-text"},Lle={key:3,class:"deactivation-dialog-overlay"},wle={class:"deactivation-dialog"},Ele={class:"deactivation-options"},Rle={key:0,class:"affected-count"},Ile={class:"deactivation-actions"},Dle={key:4,class:"deactivation-dialog-overlay"},Ple={class:"deactivation-dialog"},_le={class:"deactivation-actions"};function Ale(e,t,i,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",nle,[t[17]||(t[17]=(0,s.Lk)("div",{class:"version-list-header"},[(0,s.Lk)("h2",{class:"version-list-heading"},"Compliance Version List")],-1)),(0,s.Lk)("div",rle,[(0,s.Lk)("div",cle,[(0,s.bF)(r,{config:l.frameworkDropdownConfig,modelValue:l.selectedFramework,"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedFramework=e),onChange:n.onFrameworkChange},null,8,["config","modelValue","onChange"])]),(0,s.Lk)("div",dle,[(0,s.bF)(r,{config:l.policyDropdownConfig,modelValue:l.selectedPolicy,"onUpdate:modelValue":t[1]||(t[1]=e=>l.selectedPolicy=e),onChange:n.onPolicyChange,disabled:!l.selectedFramework},null,8,["config","modelValue","onChange","disabled"])]),(0,s.Lk)("div",ule,[(0,s.bF)(r,{config:l.subPolicyDropdownConfig,modelValue:l.selectedSubPolicy,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedSubPolicy=e),onChange:n.onSubPolicyChange,disabled:!l.selectedPolicy},null,8,["config","modelValue","onChange","disabled"])])]),n.groupedCompliances.length>0?((0,s.uX)(),(0,s.CE)("div",ple,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.groupedCompliances,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"compliance-group"},[(0,s.Lk)("div",mle,[(0,s.Lk)("h3",null,"Compliance ID: "+(0,d.v_)(e[0].Identifier),1),(0,s.Lk)("div",vle,(0,d.v_)(e[0].ComplianceItemDescription),1)]),(0,s.Lk)("div",kle,[(0,s.bF)(c,{data:e,columns:l.tableColumns,showPagination:!1},{"cell-ActiveInactive":(0,s.k6)(({row:e})=>[(0,s.Lk)("div",hle,[(0,s.Lk)("input",{type:"checkbox",id:"toggle-"+e.ComplianceId,checked:"Active"===e.ActiveInactive,onChange:t=>n.toggleActiveStatus(e),disabled:"Approved"!==e.Status},null,40,gle),(0,s.Lk)("label",{for:"toggle-"+e.ComplianceId},null,8,yle)])]),"cell-CreatedByDate":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(n.formatDate(e.CreatedByDate)),1)]),"cell-PreviousComplianceVersionId":(0,s.k6)(({row:e})=>[(0,s.eW)((0,d.v_)(n.getPreviousVersionDisplay(e)),1)]),_:2},1032,["data","columns"])])]))),128))])):l.selectedSubPolicy?((0,s.uX)(),(0,s.CE)("div",fle," No compliances found for the selected criteria ")):(0,s.Q3)("",!0),l.error?((0,s.uX)(),(0,s.CE)("div",ble,[t[9]||(t[9]=(0,s.Lk)("div",{class:"error-icon"},"⚠️",-1)),(0,s.Lk)("div",Cle,(0,d.v_)(l.error),1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.refreshCurrentData&&n.refreshCurrentData(...e)),class:"retry-button"},"Retry")])):(0,s.Q3)("",!0),l.showDeactivationDialog?((0,s.uX)(),(0,s.CE)("div",Lle,[(0,s.Lk)("div",wle,[t[11]||(t[11]=(0,s.Lk)("h3",null,"Deactivate Compliance",-1)),t[12]||(t[12]=(0,s.Lk)("p",null,"Please provide a reason for deactivating this compliance:",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.deactivationReason=e),class:"deactivation-reason-input",placeholder:"Enter reason for deactivation"},"        ",512),[[a.Jo,l.deactivationReason]]),(0,s.Lk)("div",Ele,[(0,s.Lk)("label",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=e=>l.cascadeToPolicies=e)},null,512),[[a.lH,l.cascadeToPolicies]]),t[10]||(t[10]=(0,s.eW)(" Apply to related policies "))]),l.cascadeToPolicies?((0,s.uX)(),(0,s.CE)("div",Rle,(0,d.v_)(l.affectedPoliciesCount||0)+" policies will be affected ",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Ile,[(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>n.cancelDeactivation&&n.cancelDeactivation(...e)),class:"cancel-btn"},"Cancel"),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>n.submitDeactivation&&n.submitDeactivation(...e)),class:"submit-btn"},"OK")])])])):(0,s.Q3)("",!0),l.showDeactivationConfirmation?((0,s.uX)(),(0,s.CE)("div",Dle,[(0,s.Lk)("div",Ple,[t[13]||(t[13]=(0,s.Lk)("h3",null,"Deactivation Request Submitted",-1)),t[14]||(t[14]=(0,s.Lk)("p",null,"Your request to deactivate this compliance item has been submitted successfully and is awaiting approval.",-1)),t[15]||(t[15]=(0,s.Lk)("p",null,"The compliance will remain active until an approver reviews and accepts this request.",-1)),t[16]||(t[16]=(0,s.Lk)("div",{class:"approval-info"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.Lk)("span",null,"You can check the status of this request in the Compliance Approver interface.")],-1)),(0,s.Lk)("div",_le,[(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>n.closeDeactivationConfirmation&&n.closeDeactivationConfirmation(...e)),class:"submit-btn"},"OK")])])])):(0,s.Q3)("",!0)])}var Sle={name:"ComplianceVersionList",components:{CustomDropdown:xa.A,DynamicTable:Hn.A},data(){return{frameworks:[],policies:[],subPolicies:[],compliances:[],selectedFramework:"",selectedPolicy:"",selectedSubPolicy:"",loading:!1,searchQuery:"",showDeactivationDialog:!1,deactivationReason:"",cascadeToPolicies:!0,affectedPoliciesCount:0,complianceToDeactivate:null,showDeactivationConfirmation:!1,error:null,frameworkDropdownConfig:{values:[],defaultLabel:"Select Framework",name:"Framework"},policyDropdownConfig:{values:[],defaultLabel:"Select Policy",name:"Policy"},subPolicyDropdownConfig:{values:[],defaultLabel:"Select Sub Policy",name:"Sub Policy"},tableColumns:[{key:"ComplianceVersion",label:"Version"},{key:"Status",label:"Status"},{key:"ActiveInactive",label:"Active/Inactive",slot:!0},{key:"CreatedByName",label:"Created By"},{key:"CreatedByDate",label:"Created Date",slot:!0},{key:"PreviousComplianceVersionId",label:"Previous Version",slot:!0}]}},computed:{groupedCompliances(){let e=this.compliances;if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>e.Identifier&&e.Identifier.toLowerCase().includes(t)||e.ComplianceItemDescription&&e.ComplianceItemDescription.toLowerCase().includes(t))}const t={};return e.forEach(e=>{t[e.Identifier]||(t[e.Identifier]=[]),t[e.Identifier].push(e)}),Object.values(t).map(e=>e.sort((e,t)=>{const i=parseFloat(e.ComplianceVersion),a=parseFloat(t.ComplianceVersion);return a-i}))}},mounted(){try{this.loadFrameworks()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceVersioningDenied();throw e}},methods:{async loadFrameworks(){try{this.loading=!0;const e=await I4.fv.getComplianceFrameworks();console.log("Frameworks API response:",e.data);let t=[];e.data.success&&e.data.frameworks?t=e.data.frameworks:e.data.success&&Array.isArray(e.data.data)?t=e.data.data:Array.isArray(e.data)?t=e.data:console.error("Unexpected response format:",e.data),this.frameworks=t.map(e=>({FrameworkId:e.id,FrameworkName:e.name,Category:e.category||"",Status:e.status||"",Description:e.description||""})),console.log("Mapped frameworks:",this.frameworks),this.frameworkDropdownConfig.values=this.frameworks.map(e=>({value:e.FrameworkId,label:e.FrameworkName}))}catch(e){if(console.error("Error loading frameworks:",e),e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceFrameworkDenied();this.error="Failed to load frameworks"}finally{this.loading=!1}},async loadPolicies(){if(!this.selectedFramework)return this.policies=[],void(this.selectedPolicy="");console.log("Calling getCompliancePolicies with ID:",this.selectedFramework);try{this.loading=!0;const e=await I4.fv.getCompliancePolicies(this.selectedFramework);console.log("Policies API response:",e.data);let t=[];e.data.success&&e.data.policies?t=e.data.policies:e.data.success&&Array.isArray(e.data.data)?t=e.data.data:Array.isArray(e.data)?t=e.data:console.error("Unexpected response format:",e.data),this.policies=t.map(e=>({PolicyId:e.id,PolicyName:e.name,Applicability:e.applicability||e.scope||"",Status:e.status||""})),console.log("Mapped policies:",this.policies),this.policyDropdownConfig.values=this.policies.map(e=>({value:e.PolicyId,label:e.PolicyName})),this.selectedPolicy="",this.selectedSubPolicy=""}catch(e){if(console.error("Error loading policies:",e),e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePolicyDenied();this.error="Failed to load policies"}finally{this.loading=!1}},async loadSubPolicies(){if(!this.selectedPolicy)return this.subPolicies=[],void(this.selectedSubPolicy="");try{this.loading=!0;const e=await I4.fv.getComplianceSubPolicies(this.selectedPolicy);console.log("SubPolicies API response:",e.data);let t=[];e.data.success&&e.data.subpolicies?t=e.data.subpolicies:e.data.success&&Array.isArray(e.data.data)?t=e.data.data:Array.isArray(e.data)?t=e.data:console.error("Unexpected response format:",e.data),this.subPolicies=t.map(e=>({SubPolicyId:e.id,SubPolicyName:e.name,Status:e.status||"",Description:e.description||"",Control:e.control||"",Identifier:e.identifier||""})),console.log("Mapped subpolicies:",this.subPolicies),this.subPolicyDropdownConfig.values=this.subPolicies.map(e=>({value:e.SubPolicyId,label:e.SubPolicyName})),this.selectedSubPolicy=""}catch(e){if(console.error("Error loading subpolicies:",e),e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceSubpolicyDenied();this.error="Failed to load subpolicies"}finally{this.loading=!1}},async loadCompliances(){if(this.selectedSubPolicy)try{this.loading=!0,console.log(`Loading compliances for subpolicy ID: ${this.selectedSubPolicy}`);const e=await I4.fv.getCompliancesBySubPolicy(this.selectedSubPolicy);console.log("Compliance API response:",e.data),e.data.success?(Array.isArray(e.data.data)?this.compliances=e.data.data.flat():e.data.compliances&&Array.isArray(e.data.compliances)?this.compliances=e.data.compliances:(console.error("Unexpected data structure:",e.data),this.compliances=[]),this.compliances.length>0?(console.log("First compliance record:",this.compliances[0]),console.log("PreviousComplianceVersionId exists:",this.compliances.some(e=>void 0!==e.PreviousComplianceVersionId)),console.log("Compliance record keys:",Object.keys(this.compliances[0])),this.compliances=this.compliances.map(e=>void 0!==e.PreviousVersionId&&void 0===e.PreviousComplianceVersionId?{...e,PreviousComplianceVersionId:e.PreviousVersionId}:e)):console.log("No compliances returned from API")):(console.error("Error in response:",e.data),this.error=e.data.message||"Failed to load compliances")}catch(e){if(console.error("Error loading compliances:",e),e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showComplianceViewDenied();if(e.response&&500===e.response.status){console.error("Server error (500):",e.response.data),this.error="Server error: The compliance data could not be loaded. Please try again later or contact support.";try{console.log("Attempting to use alternative endpoint...");const e=await I4.fv.getCompliancesByType("subpolicy",this.selectedSubPolicy);e.data.success&&e.data.compliances&&(this.compliances=e.data.compliances,this.error=null,console.log("Successfully loaded compliances from alternative endpoint"))}catch(t){if(console.error("Alternative endpoint also failed:",t),t.response&&[401,403].includes(t.response.status))return void Tr.Ay.showComplianceViewDenied()}}else this.error=e.message||"Failed to load compliances"}finally{this.loading=!1}else this.compliances=[]},async toggleActiveStatus(e){if("Approved"===e.Status){if("Active"===e.ActiveInactive)return this.complianceToDeactivate=e,this.deactivationReason="",this.cascadeToPolicies=!0,this.showDeactivationDialog=!0,void(document.getElementById(`toggle-${e.ComplianceId}`).checked=!0);try{let a;this.loading=!0,this.error=null,console.log(`Toggling compliance ${e.ComplianceId} to Active`);try{a=await I4.fv.toggleComplianceVersion(e.ComplianceId),console.log("Toggle response from primary endpoint:",a.data)}catch(t){if(console.error("Primary endpoint failed:",t),!t.response||404!==t.response.status)throw t;{console.log("Trying alternative toggle endpoint...");const t={compliance_id:e.ComplianceId,new_status:"Active"===e.ActiveInactive?"Inactive":"Active"};try{a=await He.A.post(`/api/compliance/${e.ComplianceId}/toggle/`,t),console.log("Toggle response from alternative endpoint:",a.data)}catch(i){throw console.error("Alternative endpoint also failed:",i),i}}}if(a&&a.data&&a.data.success)console.log(`Successfully toggled compliance to ${a.data.new_status}`),await this.loadCompliances();else{const t=a&&a.data&&a.data.message||"Error toggling compliance status";console.error("Error in toggle response:",t),this.error=`Failed to toggle compliance status: ${t}`;const i=document.getElementById(`toggle-${e.ComplianceId}`);i&&(i.checked="Active"===e.ActiveInactive)}}catch(a){if(console.error("Error toggling compliance status:",a),a.response&&[401,403].includes(a.response.status)){Tr.Ay.showComplianceToggleDenied();const t=document.getElementById(`toggle-${e.ComplianceId}`);return void(t&&(t.checked="Active"===e.ActiveInactive))}let t="Error toggling compliance status";a.response?(console.error("Error response:",a.response.data),t+=`: ${a.response.data.message||a.response.statusText}`):a.request?(console.error("Error request:",a.request),t+=" - No response received from server"):t+=`: ${a.message}`,this.error=t;const i=document.getElementById(`toggle-${e.ComplianceId}`);i&&(i.checked="Active"===e.ActiveInactive)}finally{this.loading=!1}}else alert("Only approved compliances can be toggled")},async submitDeactivation(){if(this.complianceToDeactivate)if(this.deactivationReason.trim())try{this.loading=!0,console.log("Submitting deactivation request for compliance:",this.complianceToDeactivate.ComplianceId);const e=await I4.fv.deactivateCompliance(this.complianceToDeactivate.ComplianceId,{reason:this.deactivationReason,cascade_to_policies:this.cascadeToPolicies,user_id:1,reviewer_id:2});e.data.success?(this.showDeactivationDialog=!1,this.showDeactivationConfirmation=!0,await this.loadCompliances(),console.log("Deactivation request submitted successfully with approval ID:",e.data.approval_id)):alert(e.data.message||"Error submitting deactivation request")}catch(e){if(console.error("Error submitting deactivation request:",e),e.response&&[401,403].includes(e.response.status))return Tr.Ay.showComplianceDeactivateDenied(),this.showDeactivationDialog=!1,void(this.complianceToDeactivate=null);const t=e.response?.data?.message||e.message||"Error submitting deactivation request";alert(`Error: ${t}`)}finally{this.loading=!1}else alert("Please provide a reason for deactivation")},cancelDeactivation(){this.showDeactivationDialog=!1,this.complianceToDeactivate=null},closeDeactivationConfirmation(){this.showDeactivationConfirmation=!1},formatDate(e){return e?new Date(e).toLocaleDateString():"N/A"},getPreviousVersionDisplay(e){if(!e.PreviousComplianceVersionId)return"None";const t=this.compliances.find(t=>t.ComplianceId===e.PreviousComplianceVersionId);return t?`v${t.ComplianceVersion}`:`ID: ${e.PreviousComplianceVersionId}`},handleSearch(){},refreshCurrentData(){this.error=null,this.selectedSubPolicy?this.loadCompliances():this.selectedPolicy?this.loadSubPolicies():this.selectedFramework?this.loadPolicies():this.loadFrameworks()},onFrameworkChange(e){this.selectedFramework=e.value,this.loadPolicies()},onPolicyChange(e){this.selectedPolicy=e.value,this.loadSubPolicies()},onSubPolicyChange(e){this.selectedSubPolicy=e.value,this.loadCompliances()}}};const Tle=(0,le.A)(Sle,[["render",Ale],["__scopeId","data-v-728381e2"]]);var xle=Tle;const Fle={class:"kpi-dashboard"},Vle={class:"kpi-card"},Ule={key:0,class:"error-message"},Nle={key:1,class:"loading-overlay"},Mle={key:2},Xle={class:"kpi-chart"},$le={class:"maturity-grid"},Ole={class:"maturity-label"},jle={class:"maturity-count"},Ble={class:"total-count"},Wle={class:"kpi-card status-overview-card"},qle={key:0,class:"error-message"},Qle={key:1,class:"loading-overlay"},Kle={key:2,class:"status-overview-content"},Jle={class:"status-chart-container"},zle={class:"status-stats"},Hle={class:"status-stat-value"},Gle={class:"status-stat-label"},Yle={class:"status-stat-percentage"},Zle={class:"kpi-card non-compliance-card"},ene={key:0,class:"error-message"},tne={key:1,class:"loading-overlay"},ine={key:2},ane={class:"non-compliance-badge"},sne={class:"kpi-card mitigated-risks-card"},one={key:0,class:"error-message"},lne={key:1,class:"loading-overlay"},nne={key:2},rne={class:"mitigated-badge"},cne={class:"kpi-card automated-controls-card"},dne={key:0,class:"error-message"},une={key:1,class:"loading-overlay"},pne={key:2},mne={class:"automated-chart-container"},vne={class:"automated-stats"},kne={class:"stat-item"},hne={class:"stat-value automated-stat"},gne={class:"stat-item"},yne={class:"stat-value manual-stat"},fne={class:"kpi-card repetitions-card"},bne={key:0,class:"error-message"},Cne={key:1,class:"loading-overlay"},Lne={key:2},wne={class:"repetitions-chart-container"},Ene={class:"repetitions-stats"},Rne={class:"repetition-stat-item"},Ine={class:"repetition-stat-value"},Dne={class:"repetition-stat-item"},Pne={class:"repetition-stat-value"},_ne={class:"repetition-stat-item"},Ane={class:"repetition-stat-value"},Sne={class:"kpi-card ontime-mitigation-card"},Tne={key:0,class:"error-message"},xne={key:1,class:"loading-overlay"},Fne={key:2,class:"ontime-mitigation-content"},Vne={class:"percentage-value"},Une={class:"ontime-stats"},Nne={class:"ontime-stat-item"},Mne={class:"stat-value"},Xne={class:"ontime-stat-item"},$ne={class:"stat-value"},One={class:"ontime-stat-item"},jne={class:"stat-value"},Bne={class:"kpi-card reputational-impact-card"},Wne={key:0,class:"error-message"},qne={key:1,class:"loading-overlay"},Qne={key:2,class:"reputational-impact-content"},Kne={class:"reputational-chart-container"},Jne={class:"impact-stats"},zne={class:"impact-stat-value"},Hne={class:"impact-stat-label"},Gne={class:"impact-stat-percentage"},Yne={class:"kpi-card remediation-cost-card"},Zne={key:0,class:"error-message"},ere={key:1,class:"loading-overlay"},tre={key:2,class:"remediation-cost-content"},ire={class:"cost-summary"},are={class:"total-cost"},sre={class:"cost-value"},ore={class:"avg-cost"},lre={class:"cost-value"},nre={class:"remediation-chart-container"},rre={key:0,class:"cost-categories"},cre={class:"category-name"},dre={class:"category-cost"},ure={class:"kpi-card non-compliant-incidents-card"},pre={class:"kpi-header"},mre={class:"period-selector"},vre={key:0,class:"error-message"},kre={key:1,class:"loading-overlay"},hre={key:2,class:"non-compliant-incidents-content"},gre={class:"incidents-summary"},yre={class:"incidents-count"},fre={class:"count-value"},bre={class:"count-period"},Cre={class:"unique-incidents"},Lre={class:"unique-value"},wre={class:"incidents-chart-container"},Ere={key:0,class:"top-incidents"},Rre={class:"incident-rank"},Ire={class:"incident-details"},Dre={class:"incident-description"},Pre={class:"incident-meta"},_re={class:"incident-criticality"},Are={class:"incident-count"};function Sre(e,t,i,o,l,n){const r=(0,s.g2)("Bar"),c=(0,s.g2)("Doughnut"),u=(0,s.g2)("Pie"),p=(0,s.g2)("LineChart");return(0,s.uX)(),(0,s.CE)("div",Fle,[(0,s.Lk)("div",Vle,[t[13]||(t[13]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Maturity Level Distribution")],-1)),l.error?((0,s.uX)(),(0,s.CE)("div",Ule,[(0,s.eW)((0,d.v_)(l.error)+" ",1),(0,s.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.fetchMaturityData&&n.fetchMaturityData(...e))},"Retry")])):l.loading?((0,s.uX)(),(0,s.CE)("div",Nle,t[12]||(t[12]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Mle,[(0,s.Lk)("div",Xle,[l.chartData?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:l.chartData,options:l.chartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",$le,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.maturityLevels,e=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"maturity-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["maturity-color",e.toLowerCase()])},null,2),(0,s.Lk)("span",Ole,(0,d.v_)(e),1),(0,s.Lk)("span",jle,(0,d.v_)(n.getMaturityCount(e)),1)]))),128))]),(0,s.Lk)("div",Ble," Total Active & Approved: "+(0,d.v_)(n.getTotalCompliances()),1)]))]),(0,s.Lk)("div",Wle,[t[15]||(t[15]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Compliance Status Overview")],-1)),l.statusOverviewError?((0,s.uX)(),(0,s.CE)("div",qle,[(0,s.eW)((0,d.v_)(l.statusOverviewError)+" ",1),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.fetchStatusOverview&&n.fetchStatusOverview(...e))},"Retry")])):l.statusOverviewLoading?((0,s.uX)(),(0,s.CE)("div",Qle,t[14]||(t[14]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Kle,[(0,s.Lk)("div",Jle,[l.statusOverviewChartData?((0,s.uX)(),(0,s.Wv)(c,{key:0,data:l.statusOverviewChartData,options:l.statusOverviewChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",zle,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.statusOverviewData.counts,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["status-stat-item",t.toLowerCase().replace(" ","-")])},[(0,s.Lk)("div",Hle,(0,d.v_)(e),1),(0,s.Lk)("div",Gle,(0,d.v_)(t),1),(0,s.Lk)("div",Yle,(0,d.v_)(l.statusOverviewData.percentages[t])+"%",1)],2))),128))])]))]),(0,s.Lk)("div",Zle,[t[18]||(t[18]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Non-Compliance Count")],-1)),l.nonComplianceError?((0,s.uX)(),(0,s.CE)("div",ene,[(0,s.eW)((0,d.v_)(l.nonComplianceError)+" ",1),(0,s.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>n.fetchNonComplianceCount&&n.fetchNonComplianceCount(...e))},"Retry")])):l.nonComplianceLoading?((0,s.uX)(),(0,s.CE)("div",tne,t[16]||(t[16]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",ine,[(0,s.Lk)("div",ane,(0,d.v_)(l.nonComplianceCount),1),t[17]||(t[17]=(0,s.Lk)("div",{class:"non-compliance-label"}," Total Non-Compliant Items ",-1))]))]),(0,s.Lk)("div",sne,[t[21]||(t[21]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Mitigated Risks")],-1)),l.mitigatedError?((0,s.uX)(),(0,s.CE)("div",one,[(0,s.eW)((0,d.v_)(l.mitigatedError)+" ",1),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>n.fetchMitigatedCount&&n.fetchMitigatedCount(...e))},"Retry")])):l.mitigatedLoading?((0,s.uX)(),(0,s.CE)("div",lne,t[19]||(t[19]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",nne,[(0,s.Lk)("div",rne,(0,d.v_)(l.mitigatedCount),1),t[20]||(t[20]=(0,s.Lk)("div",{class:"mitigated-label"}," Total Mitigated Risks ",-1))]))]),(0,s.Lk)("div",cne,[t[25]||(t[25]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Controls Distribution")],-1)),l.automatedError?((0,s.uX)(),(0,s.CE)("div",dne,[(0,s.eW)((0,d.v_)(l.automatedError)+" ",1),(0,s.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>n.fetchAutomatedCount&&n.fetchAutomatedCount(...e))},"Retry")])):l.automatedLoading?((0,s.uX)(),(0,s.CE)("div",une,t[22]||(t[22]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",pne,[(0,s.Lk)("div",mne,[l.automatedChartData?((0,s.uX)(),(0,s.Wv)(u,{key:0,data:l.automatedChartData,options:l.automatedChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",vne,[(0,s.Lk)("div",kne,[(0,s.Lk)("div",hne,(0,d.v_)(l.automatedData.automated_percentage)+"% ",1),t[23]||(t[23]=(0,s.Lk)("div",{class:"stat-label"}," Automated ",-1))]),(0,s.Lk)("div",gne,[(0,s.Lk)("div",yne,(0,d.v_)(l.automatedData.manual_percentage)+"% ",1),t[24]||(t[24]=(0,s.Lk)("div",{class:"stat-label"}," Manual ",-1))])])]))]),(0,s.Lk)("div",fne,[t[30]||(t[30]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Non-Compliance Repetitions")],-1)),l.repetitionsError?((0,s.uX)(),(0,s.CE)("div",bne,[(0,s.eW)((0,d.v_)(l.repetitionsError)+" ",1),(0,s.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>n.fetchRepetitionsData&&n.fetchRepetitionsData(...e))},"Retry")])):l.repetitionsLoading?((0,s.uX)(),(0,s.CE)("div",Cne,t[26]||(t[26]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Lne,[(0,s.Lk)("div",wne,[l.repetitionsChartData?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:l.repetitionsChartData,options:l.repetitionsChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Ene,[(0,s.Lk)("div",Rne,[(0,s.Lk)("div",Ine,(0,d.v_)(l.repetitionsData.total_items),1),t[27]||(t[27]=(0,s.Lk)("div",{class:"repetition-stat-label"}," Total Items ",-1))]),(0,s.Lk)("div",Dne,[(0,s.Lk)("div",Pne,(0,d.v_)(l.repetitionsData.max_repetitions),1),t[28]||(t[28]=(0,s.Lk)("div",{class:"repetition-stat-label"}," Max Repetitions ",-1))]),(0,s.Lk)("div",_ne,[(0,s.Lk)("div",Ane,(0,d.v_)(l.repetitionsData.avg_repetitions),1),t[29]||(t[29]=(0,s.Lk)("div",{class:"repetition-stat-label"}," Avg Repetitions ",-1))])])]))]),(0,s.Lk)("div",Sne,[t[36]||(t[36]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"On-Time Mitigation Rate")],-1)),l.ontimeMitigationError?((0,s.uX)(),(0,s.CE)("div",Tne,[(0,s.eW)((0,d.v_)(l.ontimeMitigationError)+" ",1),(0,s.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>n.fetchOntimeMitigationData&&n.fetchOntimeMitigationData(...e))},"Retry")])):l.ontimeMitigationLoading?((0,s.uX)(),(0,s.CE)("div",xne,t[31]||(t[31]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Fne,[(0,s.Lk)("div",{class:(0,d.C4)(["ontime-percentage-circle",{"high-rate":l.ontimeMitigationData.on_time_percentage>=70}])},[(0,s.Lk)("div",Vne,(0,d.v_)(Math.round(l.ontimeMitigationData.on_time_percentage))+"%",1),t[32]||(t[32]=(0,s.Lk)("div",{class:"percentage-label"},"On Time",-1))],2),(0,s.Lk)("div",Une,[(0,s.Lk)("div",Nne,[(0,s.Lk)("div",Mne,(0,d.v_)(l.ontimeMitigationData.completed_on_time),1),t[33]||(t[33]=(0,s.Lk)("div",{class:"stat-label"},"On Time",-1))]),(0,s.Lk)("div",Xne,[(0,s.Lk)("div",$ne,(0,d.v_)(l.ontimeMitigationData.completed_late),1),t[34]||(t[34]=(0,s.Lk)("div",{class:"stat-label"},"Late",-1))]),(0,s.Lk)("div",One,[(0,s.Lk)("div",jne,(0,d.v_)(l.ontimeMitigationData.total_completed),1),t[35]||(t[35]=(0,s.Lk)("div",{class:"stat-label"},"Total",-1))])])]))]),(0,s.Lk)("div",Bne,[t[38]||(t[38]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Reputational Impact Assessment")],-1)),l.reputationalError?((0,s.uX)(),(0,s.CE)("div",Wne,[(0,s.eW)((0,d.v_)(l.reputationalError)+" ",1),(0,s.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>n.fetchReputationalData&&n.fetchReputationalData(...e))},"Retry")])):l.reputationalLoading?((0,s.uX)(),(0,s.CE)("div",qne,t[37]||(t[37]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",Qne,[(0,s.Lk)("div",Kne,[l.reputationalChartData?((0,s.uX)(),(0,s.Wv)(p,{key:0,data:l.reputationalChartData,options:l.reputationalChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Jne,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.reputationalData.impact_counts,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,d.C4)(["impact-stat-item",t])},[(0,s.Lk)("div",zne,(0,d.v_)(e),1),(0,s.Lk)("div",Hne,(0,d.v_)(t.charAt(0).toUpperCase()+t.slice(1)),1),(0,s.Lk)("div",Gne,(0,d.v_)(Math.round(l.reputationalData.impact_percentages[t]))+"%",1)],2))),128))])]))]),(0,s.Lk)("div",Yne,[t[43]||(t[43]=(0,s.Lk)("div",{class:"kpi-header"},[(0,s.Lk)("h3",{class:"kpi-title"},"Remediation Cost Analysis")],-1)),l.remediationCostError?((0,s.uX)(),(0,s.CE)("div",Zne,[(0,s.eW)((0,d.v_)(l.remediationCostError)+" ",1),(0,s.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>n.fetchRemediationCost&&n.fetchRemediationCost(...e))},"Retry")])):l.remediationCostLoading?((0,s.uX)(),(0,s.CE)("div",ere,t[39]||(t[39]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",tre,[(0,s.Lk)("div",ire,[(0,s.Lk)("div",are,[(0,s.Lk)("div",sre,"$"+(0,d.v_)(n.formatNumber(l.remediationCostData.cost_summary.total_cost)),1),t[40]||(t[40]=(0,s.Lk)("div",{class:"cost-label"},"Total Cost",-1))]),(0,s.Lk)("div",ore,[(0,s.Lk)("div",lre,"$"+(0,d.v_)(n.formatNumber(l.remediationCostData.cost_summary.average_cost)),1),t[41]||(t[41]=(0,s.Lk)("div",{class:"cost-label"},"Average Cost",-1))])]),(0,s.Lk)("div",nre,[l.remediationCostChartData?((0,s.uX)(),(0,s.Wv)(p,{key:0,data:l.remediationCostChartData,options:l.remediationCostChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),l.remediationCostData.category_chart.labels.length>0?((0,s.uX)(),(0,s.CE)("div",rre,[t[42]||(t[42]=(0,s.Lk)("div",{class:"category-label"},"Top Categories:",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.remediationCostData.category_chart.labels.slice(0,3),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"category-item"},[(0,s.Lk)("span",cre,(0,d.v_)(e),1),(0,s.Lk)("span",dre,"$"+(0,d.v_)(n.formatNumber(l.remediationCostData.category_chart.values[t])),1)]))),128))])):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",ure,[(0,s.Lk)("div",pre,[t[45]||(t[45]=(0,s.Lk)("h3",{class:"kpi-title"},"Non-Compliant Incidents",-1)),(0,s.Lk)("div",mre,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.selectedPeriod=e),onChange:t[10]||(t[10]=(...e)=>n.fetchNonCompliantIncidents&&n.fetchNonCompliantIncidents(...e)),class:"period-dropdown"},t[44]||(t[44]=[(0,s.Lk)("option",{value:"week"},"Last 7 Days",-1),(0,s.Lk)("option",{value:"month"},"Last 30 Days",-1),(0,s.Lk)("option",{value:"quarter"},"Last 3 Months",-1),(0,s.Lk)("option",{value:"year"},"Last 12 Months",-1)]),544),[[a.u1,l.selectedPeriod]])])]),l.nonCompliantIncidentsError?((0,s.uX)(),(0,s.CE)("div",vre,[(0,s.eW)((0,d.v_)(l.nonCompliantIncidentsError)+" ",1),(0,s.Lk)("button",{onClick:t[11]||(t[11]=(...e)=>n.fetchNonCompliantIncidents&&n.fetchNonCompliantIncidents(...e))},"Retry")])):l.nonCompliantIncidentsLoading?((0,s.uX)(),(0,s.CE)("div",kre,t[46]||(t[46]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):((0,s.uX)(),(0,s.CE)("div",hre,[(0,s.Lk)("div",gre,[(0,s.Lk)("div",yre,[(0,s.Lk)("div",fre,(0,d.v_)(l.nonCompliantIncidentsData.non_compliant_count),1),t[48]||(t[48]=(0,s.Lk)("div",{class:"count-label"},"Non-Compliant Incidents",-1)),(0,s.Lk)("div",bre,(0,d.v_)(l.nonCompliantIncidentsData.period),1),(0,s.Lk)("div",{class:(0,d.C4)(["count-change",{positive:l.nonCompliantIncidentsData.percentage_change.startsWith("+"),negative:!l.nonCompliantIncidentsData.percentage_change.startsWith("+")}])},[(0,s.eW)((0,d.v_)(l.nonCompliantIncidentsData.percentage_change)+" ",1),t[47]||(t[47]=(0,s.Lk)("span",{class:"change-label"},"vs previous period",-1))],2)]),(0,s.Lk)("div",Cre,[(0,s.Lk)("div",Lre,(0,d.v_)(l.nonCompliantIncidentsData.unique_compliance_items),1),t[49]||(t[49]=(0,s.Lk)("div",{class:"unique-label"},"Unique Items",-1))])]),(0,s.Lk)("div",wre,[l.nonCompliantIncidentsChartData?((0,s.uX)(),(0,s.Wv)(r,{key:0,data:l.nonCompliantIncidentsChartData,options:l.nonCompliantIncidentsChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0)]),l.nonCompliantIncidentsData.top_non_compliant_items.length>0?((0,s.uX)(),(0,s.CE)("div",Ere,[t[50]||(t[50]=(0,s.Lk)("div",{class:"top-incidents-header"},"Top Non-Compliant Items",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.nonCompliantIncidentsData.top_non_compliant_items.slice(0,3),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{class:(0,d.C4)(["top-incident-item",n.getCriticalityClass(e.criticality)]),key:e.compliance_id},[(0,s.Lk)("div",Rre,(0,d.v_)(t+1),1),(0,s.Lk)("div",Ire,[(0,s.Lk)("div",Dre,(0,d.v_)(n.truncateText(e.description,50)),1),(0,s.Lk)("div",Pre,[(0,s.Lk)("span",_re,(0,d.v_)(e.criticality),1),(0,s.Lk)("span",Are,(0,d.v_)(e.count)+" occurrences",1)])])],2))),128))])):(0,s.Q3)("",!0)]))])])}Ze.t1.register(Ze.hE,Ze.m_,Ze.s$,Ze.E8,Ze.PP,Ze.kc,Ze.Bs,Ze.FN,Ze.No);var Tre={name:"ComplianceKPI",components:{Bar:et.yP,Pie:et.Fq,Doughnut:et.nu,LineChart:et.N1},data(){return{loading:!0,error:null,maturityLevels:["Initial","Developing","Defined","Managed","Optimizing"],maturityData:null,chartData:null,chartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:8,titleFont:{size:13},bodyFont:{size:12},callbacks:{label:function(e){return`Count: ${e.raw}`}}}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"#f1f5f9",drawBorder:!1},ticks:{precision:0,color:"#64748b",font:{size:11}}},x:{grid:{display:!1},ticks:{color:"#64748b",font:{size:10}}}}},nonComplianceLoading:!0,nonComplianceError:null,nonComplianceCount:0,mitigatedLoading:!0,mitigatedError:null,mitigatedCount:0,automatedLoading:!0,automatedError:null,automatedData:null,automatedChartData:null,automatedChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:8,callbacks:{label:function(e){return`${e.label}: ${e.raw}%`}}}}},repetitionsLoading:!0,repetitionsError:null,repetitionsData:null,repetitionsChartData:null,repetitionsChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:8,callbacks:{label:function(e){return`Occurrences: ${e.raw}`}}}},scales:{y:{beginAtZero:!0,title:{display:!0,text:"Number of Items",color:"#64748b"},ticks:{precision:0,color:"#64748b"}},x:{title:{display:!0,text:"Number of Repetitions",color:"#64748b"},ticks:{color:"#64748b"}}}},ontimeMitigationLoading:!0,ontimeMitigationError:null,ontimeMitigationData:{on_time_percentage:0,total_completed:0,completed_on_time:0,completed_late:0},statusOverviewLoading:!0,statusOverviewError:null,statusOverviewData:{counts:{},percentages:{},total:0},statusOverviewChartData:null,statusOverviewChartOptions:{responsive:!0,maintainAspectRatio:!1,cutout:"75%",radius:"90%",plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,boxPadding:6,usePointStyle:!0,callbacks:{label:function(e){const t=e.raw,i=e.dataset,a=e.label;return[`${a}: ${t.toFixed(1)}%`,`Count: ${i.data[e.dataIndex]}`]}}}},animation:{animateRotate:!0,animateScale:!0,duration:1e3,easing:"easeOutQuart"}},reputationalLoading:!0,reputationalError:null,reputationalData:{impact_counts:{},impact_percentages:{},timeline_data:{dates:[],low:[],medium:[],high:[]},total_risks:0},reputationalChartData:null,reputationalChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,usePointStyle:!0,callbacks:{label:function(e){return`${e.dataset.label}: ${e.raw}`}}}},scales:{x:{grid:{display:!1},ticks:{font:{size:12},color:"#64748b"}},y:{beginAtZero:!0,grid:{color:"#f1f5f9"},ticks:{precision:0,stepSize:1,font:{size:12},color:"#64748b"},title:{display:!0,text:"Number of Risks",color:"#64748b",font:{size:12,weight:"normal"}}}}},remediationCostLoading:!0,remediationCostError:null,remediationCostData:{cost_summary:{total_cost:0,average_cost:0},category_chart:{labels:[],values:[]}},remediationCostChartData:null,remediationCostChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12}}},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,usePointStyle:!0,callbacks:{label:function(e){return`$${e.raw.toLocaleString("en-US")}`}}}},scales:{x:{grid:{display:!1},ticks:{font:{size:12},color:"#64748b"}},y:{beginAtZero:!0,grid:{color:"#f1f5f9"},ticks:{callback:function(e){return"$"+e.toLocaleString("en-US")},font:{size:12},color:"#64748b"},title:{display:!0,text:"Remediation Cost ($)",color:"#64748b",font:{size:12,weight:"normal"}}}}},selectedPeriod:"month",nonCompliantIncidentsLoading:!0,nonCompliantIncidentsError:null,nonCompliantIncidentsData:{non_compliant_count:0,period:"Last 30 Days",percentage_change:"0%",unique_compliance_items:0,top_non_compliant_items:[],trend_data:{labels:[],values:[]}},nonCompliantIncidentsChartData:null,nonCompliantIncidentsChartOptions:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.95)",titleColor:"#1e293b",bodyColor:"#475569",borderColor:"#e2e8f0",borderWidth:1,padding:12,usePointStyle:!0,callbacks:{label:function(e){return`Incidents: ${e.raw}`}}}},scales:{x:{grid:{display:!1},ticks:{maxRotation:45,minRotation:45,callback:function(e){const t=new Date(this.getLabelForValue(e));return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},font:{size:10},color:"#64748b"}},y:{beginAtZero:!0,grid:{color:"#f1f5f9"},ticks:{precision:0,font:{size:11},color:"#64748b"},title:{display:!0,text:"Number of Incidents",color:"#64748b",font:{size:12,weight:"normal"}}}}}}},methods:{async fetchMaturityData(){this.loading=!0,this.error=null;try{const e=await I4.fv.getMaturityLevelKPI();if(console.log("Maturity Level Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch data");this.maturityData=e.data.data,this.updateChartData()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching maturity data:",e),this.error=e.response?.data?.message||e.message||"Failed to load data"}finally{this.loading=!1}},updateChartData(){if(!this.maturityData)return;const e=this.maturityData.summary.total_by_maturity;this.chartData={labels:this.maturityLevels,datasets:[{data:this.maturityLevels.map(t=>e[t]||0),backgroundColor:["#f43f5e","#3b82f6","#f59e0b","#10b981","#8b5cf6"],borderRadius:4,maxBarThickness:32,borderSkipped:!1}]}},getMaturityCount(e){return this.maturityData&&this.maturityData.summary.total_by_maturity[e]||0},getTotalCompliances(){return this.maturityData&&this.maturityData.summary.total_compliances||0},async fetchNonComplianceCount(){this.nonComplianceLoading=!0,this.nonComplianceError=null;try{const e=await I4.fv.getNonComplianceCount();if(console.log("Non-Compliance Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch non-compliance count");this.nonComplianceCount=e.data.data.non_compliance_count}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching non-compliance count:",e),this.nonComplianceError=e.response?.data?.message||e.message||"Failed to load non-compliance data"}finally{this.nonComplianceLoading=!1}},async fetchMitigatedCount(){this.mitigatedLoading=!0,this.mitigatedError=null;try{const e=await I4.fv.getMitigatedRisksCount();if(console.log("Mitigated Risks Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch mitigated risks count");this.mitigatedCount=e.data.data.mitigated_count}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching mitigated risks count:",e),this.mitigatedError=e.response?.data?.message||e.message||"Failed to load mitigated risks data"}finally{this.mitigatedLoading=!1}},async fetchAutomatedCount(){this.automatedLoading=!0,this.automatedError=null;try{const e=await I4.fv.getAutomatedControlsCount();if(console.log("Automated Controls Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch automated controls data");this.automatedData=e.data.data,this.updateAutomatedChartData()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching automated controls data:",e),this.automatedError=e.response?.data?.message||e.message||"Failed to load automated controls data"}finally{this.automatedLoading=!1}},updateAutomatedChartData(){if(!this.automatedData)return;const e=this.automatedData.automated_percentage||0,t=this.automatedData.manual_percentage||0;this.automatedChartData={labels:["Automated","Manual"],datasets:[{data:[e,t],backgroundColor:["#3b82f6","#94a3b8"],borderWidth:0}]}},async fetchRepetitionsData(){this.repetitionsLoading=!0,this.repetitionsError=null;try{const e=await I4.fv.getNonComplianceRepetitions();if(console.log("Repetitions Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch repetitions data");this.repetitionsData=e.data.data,this.updateRepetitionsChartData()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching repetitions data:",e),this.repetitionsError=e.response?.data?.message||e.message||"Failed to load repetitions data"}finally{this.repetitionsLoading=!1}},updateRepetitionsChartData(){if(!this.repetitionsData||!this.repetitionsData.distribution)return;const e=this.repetitionsData.distribution;Array.isArray(e)&&0!==e.length&&(this.repetitionsChartData={labels:e.map(e=>e?.repetitions||0),datasets:[{data:e.map(e=>e?.occurrences||0),backgroundColor:"#dc2626",borderRadius:4,maxBarThickness:32}]})},async fetchOntimeMitigationData(){this.ontimeMitigationLoading=!0,this.ontimeMitigationError=null;try{const e=await I4.fv.getOntimeMitigationPercentage();if(console.log("On-time Mitigation Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch on-time mitigation data");this.ontimeMitigationData={on_time_percentage:e.data.data.on_time_percentage||0,total_completed:e.data.data.total_completed||0,completed_on_time:e.data.data.completed_on_time||0,completed_late:e.data.data.completed_late||0}}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching on-time mitigation data:",e),this.ontimeMitigationError=e.response?.data?.message||e.message||"Failed to load on-time mitigation data"}finally{this.ontimeMitigationLoading=!1}},async fetchStatusOverview(){this.statusOverviewLoading=!0,this.statusOverviewError=null;try{const e=await I4.fv.getComplianceStatusOverview();if(!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch status overview data");this.statusOverviewData=e.data.data,this.updateStatusOverviewChart()}catch(e){if(e.response&&[401,403].includes(e.response.status))return void Tr.Ay.showCompliancePerformanceAnalyticsDenied();console.error("Error fetching status overview:",e),this.statusOverviewError=e.response?.data?.message||e.message||"Failed to load status overview"}finally{this.statusOverviewLoading=!1}},updateStatusOverviewChart(){if(!this.statusOverviewData)return;const e={Approved:"#10B981","Under Review":"#3B82F6",Active:"#F59E0B",Rejected:"#EF4444"},t={Approved:"#059669","Under Review":"#2563EB",Active:"#D97706",Rejected:"#DC2626"},i=Object.keys(this.statusOverviewData.percentages);this.statusOverviewChartData={labels:i,datasets:[{data:Object.values(this.statusOverviewData.percentages),backgroundColor:i.map(t=>e[t]),hoverBackgroundColor:i.map(e=>t[e]),borderWidth:0,borderRadius:4}]}},async fetchReputationalData(){this.reputationalLoading=!0,this.reputationalError=null;try{const e=await I4.fv.getReputationalImpact();if(console.log("Reputational Impact Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch reputational impact data");this.reputationalData=e.data.data,this.updateReputationalChart()}catch(e){console.error("Error fetching reputational impact:",e),this.reputationalError=e.response?.data?.message||e.message||"Failed to load reputational impact data",this.reputationalData={impact_counts:{low:0,medium:0,high:0},impact_percentages:{low:0,medium:0,high:0},timeline_data:{dates:[],low:[],medium:[],high:[]},total_risks:0}}finally{this.reputationalLoading=!1}},updateReputationalChart(){if(!this.reputationalData?.impact_counts)return void(this.reputationalChartData={labels:["Low","Medium","High"],datasets:[{label:"Impact Count",data:[0,0,0],borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0,pointBackgroundColor:"#3b82f6",pointBorderColor:"#fff",pointRadius:5,pointHoverRadius:7}]});const{low:e,medium:t,high:i}=this.reputationalData.impact_counts;this.reputationalChartData={labels:["Low","Medium","High"],datasets:[{label:"Impact Count",data:[e,t,i],borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:!0,pointBackgroundColor:["#10b981","#f59e0b","#ef4444"],pointBorderColor:"#fff",pointRadius:6,pointHoverRadius:8}]}},async fetchRemediationCost(){this.remediationCostLoading=!0,this.remediationCostError=null;try{const e=await I4.fv.getRemediationCost();if(console.log("Remediation Cost Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch remediation cost data");this.remediationCostData=e.data.data,this.updateRemediationCostChart()}catch(e){console.error("Error fetching remediation cost:",e),this.remediationCostError=e.response?.data?.message||e.message||"Failed to load remediation cost data"}finally{this.remediationCostLoading=!1}},updateRemediationCostChart(){if(!this.remediationCostData||!this.remediationCostData.time_series_chart)return;const e=this.remediationCostData.time_series_chart;this.remediationCostChartData={labels:e.labels,datasets:[{label:"Remediation Cost",data:e.values,borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",borderWidth:2,fill:!0,tension:.4,pointBackgroundColor:"#ef4444",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}},async fetchNonCompliantIncidents(){this.nonCompliantIncidentsLoading=!0,this.nonCompliantIncidentsError=null;try{const e=await I4.fv.getNonCompliantIncidents(this.selectedPeriod);if(console.log("Non-Compliant Incidents Response:",e),!e.data||!e.data.success)throw new Error(e.data?.message||"Failed to fetch non-compliant incidents data");this.nonCompliantIncidentsData=e.data.data,this.updateNonCompliantIncidentsChart()}catch(e){console.error("Error fetching non-compliant incidents:",e),this.nonCompliantIncidentsError=e.response?.data?.message||e.message||"Failed to load non-compliant incidents data"}finally{this.nonCompliantIncidentsLoading=!1}},updateNonCompliantIncidentsChart(){if(!this.nonCompliantIncidentsData||!this.nonCompliantIncidentsData.trend_data)return;const e=this.nonCompliantIncidentsData.trend_data;this.nonCompliantIncidentsChartData={labels:e.labels,datasets:[{label:"Non-Compliant Incidents",data:e.values,backgroundColor:"#dc2626",borderRadius:4,maxBarThickness:32,borderSkipped:!1}]}},getCriticalityClass(e){if(!e)return"";const t=e.toLowerCase();return"high"===t?"high-criticality":"medium"===t?"medium-criticality":"low"===t?"low-criticality":""},truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:""},formatNumber(e){return e.toLocaleString("en-US")}},mounted(){this.fetchMaturityData(),this.fetchNonComplianceCount(),this.fetchMitigatedCount(),this.fetchAutomatedCount(),this.fetchRepetitionsData(),this.fetchOntimeMitigationData(),this.fetchStatusOverview(),this.fetchReputationalData(),this.fetchRemediationCost(),this.fetchNonCompliantIncidents()}};const xre=(0,le.A)(Tre,[["render",Sre]]);var Fre=xre;const Vre={class:"popup-demo-container"},Ure={class:"popup-categories"},Nre={class:"popup-category"},Mre={class:"demo-buttons"},Xre={class:"popup-category"},$re={class:"demo-buttons"},Ore={class:"popup-category"},jre={class:"demo-buttons"},Bre={class:"popup-category"},Wre={class:"demo-buttons"},qre={class:"popup-category"},Qre={class:"demo-buttons"};function Kre(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Vre,[t[28]||(t[28]=(0,s.Lk)("h1",null,"Popup System Demo",-1)),t[29]||(t[29]=(0,s.Lk)("p",{class:"demo-description"}," This page demonstrates all the popup types available in the Compliance module. Click on the buttons below to see each popup type in action. ",-1)),(0,s.Lk)("div",Ure,[(0,s.Lk)("div",Nre,[t[23]||(t[23]=(0,s.Lk)("h2",null,"Basic Popup Types",-1)),(0,s.Lk)("div",Mre,[(0,s.Lk)("button",{onClick:t[0]||(t[0]=t=>e.showSuccessPopup("Operation completed successfully!")),class:"success-btn"}," Success Popup "),(0,s.Lk)("button",{onClick:t[1]||(t[1]=t=>e.showErrorPopup("An error occurred while processing your request.")),class:"error-btn"}," Error Popup "),(0,s.Lk)("button",{onClick:t[2]||(t[2]=t=>e.showWarningPopup("This action may have consequences.")),class:"warning-btn"}," Warning Popup "),(0,s.Lk)("button",{onClick:t[3]||(t[3]=t=>e.showInfoPopup("This is some helpful information.")),class:"info-btn"}," Info Popup "),(0,s.Lk)("button",{onClick:t[4]||(t[4]=t=>e.showAutoClosePopup("This popup will close automatically in 3 seconds.","Auto-Close Demo","info",3e3)),class:"auto-close-btn"}," Auto-Close Popup ")])]),(0,s.Lk)("div",Xre,[t[24]||(t[24]=(0,s.Lk)("h2",null,"Interactive Popups",-1)),(0,s.Lk)("div",$re,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=e=>l.showConfirmationDemo()),class:"confirm-btn"}," Confirmation Popup "),(0,s.Lk)("button",{onClick:t[6]||(t[6]=e=>l.showCommentDemo()),class:"comment-btn"}," Comment Popup ")])]),(0,s.Lk)("div",Ore,[t[25]||(t[25]=(0,s.Lk)("h2",null,"Compliance-Specific Popups",-1)),(0,s.Lk)("div",jre,[(0,s.Lk)("button",{onClick:t[7]||(t[7]=e=>l.showComplianceCreated()),class:"compliance-btn"}," Compliance Created "),(0,s.Lk)("button",{onClick:t[8]||(t[8]=e=>l.showComplianceUpdated()),class:"compliance-btn"}," Compliance Updated "),(0,s.Lk)("button",{onClick:t[9]||(t[9]=e=>l.showComplianceCloned()),class:"compliance-btn"}," Compliance Cloned "),(0,s.Lk)("button",{onClick:t[10]||(t[10]=e=>l.showComplianceStatusChanged()),class:"compliance-btn"}," Status Changed "),(0,s.Lk)("button",{onClick:t[11]||(t[11]=e=>l.showReviewSubmitted()),class:"compliance-btn"}," Review Submitted "),(0,s.Lk)("button",{onClick:t[12]||(t[12]=e=>l.showOperationFailed()),class:"compliance-btn"}," Operation Failed "),(0,s.Lk)("button",{onClick:t[13]||(t[13]=e=>l.showValidationFailed()),class:"compliance-btn"}," Validation Failed ")])]),(0,s.Lk)("div",Bre,[t[26]||(t[26]=(0,s.Lk)("h2",null,"Compliance Confirmation Popups",-1)),(0,s.Lk)("div",Wre,[(0,s.Lk)("button",{onClick:t[14]||(t[14]=e=>l.showDeactivationConfirm()),class:"compliance-btn"}," Confirm Deactivation "),(0,s.Lk)("button",{onClick:t[15]||(t[15]=e=>l.showEditConfirm()),class:"compliance-btn"}," Confirm Edit "),(0,s.Lk)("button",{onClick:t[16]||(t[16]=e=>l.showCloneConfirm()),class:"compliance-btn"}," Confirm Clone "),(0,s.Lk)("button",{onClick:t[17]||(t[17]=e=>l.showDeleteConfirm()),class:"compliance-btn"}," Confirm Delete "),(0,s.Lk)("button",{onClick:t[18]||(t[18]=e=>l.showActivateVersionConfirm()),class:"compliance-btn"}," Confirm Activate Version ")])]),(0,s.Lk)("div",qre,[t[27]||(t[27]=(0,s.Lk)("h2",null,"Compliance Info Popups",-1)),(0,s.Lk)("div",Qre,[(0,s.Lk)("button",{onClick:t[19]||(t[19]=e=>l.showComplianceInfo()),class:"compliance-btn"}," Compliance Info "),(0,s.Lk)("button",{onClick:t[20]||(t[20]=e=>l.showAuditInfo()),class:"compliance-btn"}," Audit Info "),(0,s.Lk)("button",{onClick:t[21]||(t[21]=e=>l.showExportCompleted()),class:"compliance-btn"}," Export Completed "),(0,s.Lk)("button",{onClick:t[22]||(t[22]=e=>l.showSessionTimeout()),class:"compliance-btn"}," Session Timeout ")])])]),(0,s.bF)(n)])}var Jre={name:"PopupDemo",components:{PopupModal:Ck.wA},mixins:[j9],data(){return{demoCompliance:{ComplianceId:12345,ComplianceItemDescription:"Sample Compliance Item",ComplianceVersion:"2.0",Status:"Approved",Criticality:"High",CreatedByName:"John Doe",CreatedByDate:"2023-06-15"},demoAuditInfo:{audit_performer_name:"Jane Smith",audit_approver_name:"Robert Johnson",audit_date:"2023-06-20",audit_time:"14:30:00",audit_findings_status:"Fully Compliant",comments:"All criteria successfully met."}}},methods:{showConfirmationDemo(){this.showConfirmPopup("Are you sure you want to proceed with this action?","Confirmation Required",()=>{this.showSuccessPopup("Action confirmed!","Success")},()=>{this.showInfoPopup("Action cancelled.","Cancelled")})},showCommentDemo(){this.showCommentPopup("Please provide your feedback:","Feedback Requested",e=>{this.showSuccessPopup(`Thank you for your feedback: "${e}"`,"Feedback Received")})},showComplianceCreated(){D4.complianceCreated(this.demoCompliance)},showComplianceUpdated(){D4.complianceUpdated(this.demoCompliance)},showComplianceCloned(){D4.complianceCloned(this.demoCompliance)},showComplianceStatusChanged(){D4.complianceStatusChanged("Active",this.demoCompliance.ComplianceVersion)},showReviewSubmitted(){const e=Math.random()>.5;D4.reviewSubmitted(e)},showOperationFailed(){D4.operationFailed("save compliance","Server returned a 500 error")},showValidationFailed(){D4.validationFailed({ComplianceItemDescription:"Description is required",Criticality:"Criticality must be High, Medium, or Low"})},showDeactivationConfirm(){this.confirmDeactivateCompliance(this.demoCompliance,()=>{this.showSuccessPopup("Compliance deactivated successfully!","Deactivation Complete")})},showEditConfirm(){this.confirmEditCompliance(this.demoCompliance,()=>{this.showSuccessPopup("New compliance version created successfully!","Edit Complete")})},showCloneConfirm(){this.confirmCloneCompliance(this.demoCompliance,()=>{this.showSuccessPopup("Compliance cloned successfully!","Clone Complete")})},showDeleteConfirm(){this.confirmDeleteCompliance(this.demoCompliance,()=>{this.showSuccessPopup("Compliance deleted successfully!","Deletion Complete")})},showActivateVersionConfirm(){this.confirmActivateVersion(this.demoCompliance,()=>{this.showSuccessPopup(`Version ${this.demoCompliance.ComplianceVersion} activated successfully!`,"Activation Complete")})},showComplianceInfo(){D4.showComplianceInfo(this.demoCompliance)},showAuditInfo(){D4.showAuditInfo(this.demoAuditInfo)},showExportCompleted(){const e=["xlsx","csv","pdf","json","xml"],t=e[Math.floor(Math.random()*e.length)];D4.exportCompleted(t)},showSessionTimeout(){D4.sessionTimeout(()=>{this.showSuccessPopup("Session extended successfully!","Session Extended")},()=>{this.showInfoPopup("You have been logged out.","Session Ended")})}}};const zre=(0,le.A)(Jre,[["render",Kre],["__scopeId","data-v-0d4bf12e"]]);var Hre=zre;const Gre={class:"notifications-page large"},Yre={class:"header-row"},Zre=["disabled"],ece={class:"search-filter-row"},tce={class:"filters"},ice=["value"],ace=["value"],sce={width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{"margin-right":"6px"}},oce={key:0,class:"loading-state"},lce={key:1,class:"error-state"},nce={key:2,class:"notifications-table"},rce={class:"notification-main"},cce={class:"notification-text"},dce={class:"notification-title"},uce={class:"notification-description"},pce=["onClick"],mce={key:3,class:"empty-state"},vce={class:"modal-content"},kce={class:"modal-header"},hce={class:"modal-body"},gce={key:0,class:"notification-popup"},yce={class:"popup-type"},fce={class:"popup-title"},bce={class:"popup-message"};var Cce=Object.assign({name:"NotificationsPage"},{__name:"Notifications",setup(e){Ze.t1.register(Ze.E8,Ze.PP,Ze.kc,Ze.m_,Ze.s$);const t=(0,ie.KR)(!1),i=(0,ie.KR)(!1),o=(0,ie.KR)(null),l=(0,ie.KR)([]),n=(0,ie.KR)({}),r=["policy","compliance","audit","risk","incident","common","account"],c=["urgent","high","medium","low"],u=(0,ie.KR)(""),p=(0,ie.KR)(""),m=(0,ie.KR)(""),v=(0,s.EW)(()=>l.value.filter(e=>{const t=e.title.toLowerCase().includes(u.value.toLowerCase())||e.message.toLowerCase().includes(u.value.toLowerCase()),i=!p.value||e.category===p.value,a=!m.value||e.priority===m.value;return t&&i&&a})),k=async()=>{i.value=!0,o.value=null;try{const e=await fetch("http://localhost:8000/api/get-notifications/?user_id=default_user");if(!e.ok)throw new Error("Backend not available");{const t=await e.json();if("success"!==t.status)throw new Error("Failed to load notifications from backend");l.value=t.notifications}}catch(e){console.error("Error loading notifications:",e),l.value=[],o.value="Failed to load notifications"}finally{i.value=!1}},h=async()=>{try{n.value={total:l.value.length,unread:l.value.filter(e=>!e.status.isRead).length}}catch(e){console.error("Error loading stats:",e)}},g=(0,ie.KR)(!1),y=(0,ie.KR)({}),f=async e=>{const t=l.value.find(t=>t.id===e);t&&!t.status.isRead&&(t.status.isRead=!0,t.status.readAt=new Date);try{await fetch("http://localhost:8000/api/mark-as-read/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({notification_id:e})}),await k()}catch(o){console.error("Error marking notification as read:",o)}},b=async()=>{l.value.forEach(e=>{e.status.isRead||(e.status.isRead=!0,e.status.readAt=new Date)});try{await fetch("http://localhost:8000/mark-all-as-read/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:"default_user"})})}catch(o){console.error("Error marking all notifications as read:",o)}},C=e=>{const t=new Date(e),i=new Date,a=Math.floor((i-t)/6e4);if(a<1)return"Just now";if(a<60)return`${a} minutes ago`;const s=Math.floor(a/60);if(s<24)return`${s} hours ago`;const o=Math.floor(s/24);return o<7?`${o} days ago`:t.toLocaleDateString()};function L(e){return e.charAt(0).toUpperCase()}const w=(0,s.EW)(()=>{const e={};return r.forEach(t=>{e[t]={urgent:0,high:0,medium:0,low:0}}),l.value.forEach(t=>{e[t.category]&&e[t.category][t.priority]++}),{labels:r.map(e=>e.charAt(0).toUpperCase()+e.slice(1)),datasets:[{label:"Urgent",backgroundColor:"#b71c1c",borderColor:"#b71c1c",data:r.map(t=>e[t].urgent)},{label:"High",backgroundColor:"#ff6f00",borderColor:"#ff6f00",data:r.map(t=>e[t].high)},{label:"Medium",backgroundColor:"#1565c0",borderColor:"#1565c0",data:r.map(t=>e[t].medium)},{label:"Low",backgroundColor:"#37474f",borderColor:"#37474f",data:r.map(t=>e[t].low)}]}}),E={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Notifications by Module and Priority"}},scales:{x:{stacked:!0},y:{stacked:!0,beginAtZero:!0,precision:0}}};return(0,s.sV)(async()=>{await k(),await h()}),(e,l)=>((0,s.uX)(),(0,s.CE)("div",Gre,[(0,s.Lk)("div",Yre,[l[6]||(l[6]=(0,s.Lk)("h1",null,"Notifications",-1)),(0,s.Lk)("button",{class:"mark-all",onClick:b,disabled:i.value},"Mark All as Read",8,Zre)]),(0,s.Lk)("div",ece,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>u.value=e),placeholder:"Search notifications...",class:"search-input"},null,512),[[a.Jo,u.value]]),(0,s.Lk)("div",tce,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":l[1]||(l[1]=e=>p.value=e)},[l[7]||(l[7]=(0,s.Lk)("option",{value:""},"All Types",-1)),((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(r,e=>(0,s.Lk)("option",{key:e,value:e},(0,d.v_)(e),9,ice)),64))],512),[[a.u1,p.value]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":l[2]||(l[2]=e=>m.value=e)},[l[8]||(l[8]=(0,s.Lk)("option",{value:""},"All Priorities",-1)),((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(c,e=>(0,s.Lk)("option",{key:e,value:e},(0,d.v_)(e),9,ace)),64))],512),[[a.u1,m.value]]),(0,s.Lk)("button",{class:"analytics-btn",onClick:l[3]||(l[3]=e=>t.value=!0)},[((0,s.uX)(),(0,s.CE)("svg",sce,l[9]||(l[9]=[(0,s.Lk)("rect",{x:"2",y:"10",width:"2.5",height:"6",rx:"1",fill:"#1976d2"},null,-1),(0,s.Lk)("rect",{x:"6.5",y:"6",width:"2.5",height:"10",rx:"1",fill:"#1976d2"},null,-1),(0,s.Lk)("rect",{x:"11",y:"2",width:"2.5",height:"14",rx:"1",fill:"#1976d2"},null,-1),(0,s.Lk)("rect",{x:"15.5",y:"13",width:"2.5",height:"3",rx:"1",fill:"#1976d2"},null,-1)]))),l[10]||(l[10]=(0,s.Lk)("span",null,"Analytics",-1))])])]),i.value?((0,s.uX)(),(0,s.CE)("div",oce,l[11]||(l[11]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("p",null,"Loading notifications...",-1)]))):o.value?((0,s.uX)(),(0,s.CE)("div",lce,[(0,s.Lk)("p",null,(0,d.v_)(o.value),1),(0,s.Lk)("button",{onClick:k,class:"retry-btn"},"Retry")])):((0,s.uX)(),(0,s.CE)("table",nce,[l[12]||(l[12]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Notification"),(0,s.Lk)("th",null,"Priority"),(0,s.Lk)("th",null,"Time"),(0,s.Lk)("th",null,"Status")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id,class:(0,d.C4)({unread:!e.status.isRead})},[(0,s.Lk)("td",null,[(0,s.Lk)("div",rce,[(0,s.Lk)("span",{class:(0,d.C4)(["module-icon",e.category.toLowerCase()])},(0,d.v_)(L(e.category)),3),(0,s.Lk)("div",cce,[(0,s.Lk)("div",dce,(0,d.v_)(e.title),1),(0,s.Lk)("div",uce,(0,d.v_)(e.message),1)])])]),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["priority",e.priority.toLowerCase()])},(0,d.v_)(e.priority),3)]),(0,s.Lk)("td",null,(0,d.v_)(C(e.createdAt)),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["status",e.status.isRead?"read":"unread"])},(0,d.v_)(e.status.isRead?"read":"unread"),3),e.status.isRead?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:t=>f(e.id),class:"action-btn read-btn",title:"Mark as read",style:{"margin-left":"10px",background:"#e8f5e8",border:"1px solid #1976d2",color:"#1976d2","border-radius":"4px",padding:"2px 10px","font-size":"0.95rem",cursor:"pointer",transition:"background 0.2s"}}," ✓ ",8,pce))])],2))),128))])])),i.value||o.value||0!==v.value.length?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",mce,l[13]||(l[13]=[(0,s.Lk)("p",null,"No notifications found",-1)]))),t.value?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"modal-overlay",onClick:l[5]||(l[5]=(0,a.D$)(e=>t.value=!1,["self"]))},[(0,s.Lk)("div",vce,[(0,s.Lk)("div",kce,[l[14]||(l[14]=(0,s.Lk)("h2",null,"Notifications Analytics",-1)),(0,s.Lk)("button",{class:"close-btn",onClick:l[4]||(l[4]=e=>t.value=!1)},"×")]),(0,s.Lk)("div",hce,[(0,s.bF)((0,ie.R1)(et.yP),{data:w.value,options:E},null,8,["data"])])])])):(0,s.Q3)("",!0),(0,s.bF)(a.eB,{name:"fade"},{default:(0,s.k6)(()=>[g.value?((0,s.uX)(),(0,s.CE)("div",gce,[(0,s.Lk)("div",yce,(0,d.v_)(y.value.category?y.value.category.toUpperCase():"NOTIFICATION"),1),(0,s.Lk)("div",fce,(0,d.v_)(y.value.title),1),(0,s.Lk)("div",bce,(0,d.v_)(y.value.message),1)])):(0,s.Q3)("",!0)]),_:1})]))}});const Lce=(0,le.A)(Cce,[["__scopeId","data-v-06a61940"]]);var wce=Lce;const Ece={class:"risk-register-container create-risk"},Rce={class:"risk-register-header-row"},Ice={key:0,class:"risk-source-badge"},Dce={key:0},Pce={key:1},_ce={class:"risk-creation-mode-toggle"},Ace={class:"risk-toggle-container"},Sce={key:0,class:"risk-ai-input-form"},Tce={class:"risk-ai-input-container"},xce={key:0,class:"risk-ai-loading-state"},Fce={key:1},Vce={key:0,class:"risk-incident-info"},Uce={class:"risk-incident-badge"},Nce={class:"risk-ai-form-group"},Mce={key:0,class:"risk-incident-data-box"},Xce={class:"risk-ai-form-group"},$ce={key:0,class:"risk-incident-data-box description"},Oce={class:"risk-ai-form-actions"},jce=["disabled"],Bce={key:1,class:"risk-register-add-form"},Wce={class:"risk-register-form-group risk-compliance-id-container"},qce={class:"risk-compliance-dropdown-container"},Qce={key:0,class:"risk-compliance-dropdown"},Kce={class:"risk-compliance-dropdown-search"},Jce={key:0,class:"risk-compliance-dropdown-list"},zce={key:1,class:"risk-compliance-dropdown-list"},Hce={key:2,class:"risk-compliance-dropdown-list"},Gce=["onClick"],Yce={class:"risk-compliance-item-checkbox"},Zce=["id","checked","onClick"],ede={class:"risk-compliance-item-content"},tde={class:"risk-compliance-item-header"},ide={class:"risk-compliance-id"},ade={class:"risk-compliance-item-description"},sde={key:0,class:"risk-compliance-item-damage"},ode={class:"form-row"},lde={class:"risk-register-form-group"},nde={class:"risk-category-container"},rde={class:"risk-category-dropdown"},cde={key:0},dde={key:1},ude={key:0,class:"risk-category-options"},pde={class:"risk-category-search"},mde={class:"risk-category-list"},vde=["onClick"],kde=["checked","onClick"],hde={class:"form-row"},gde={class:"form-row"},yde={class:"risk-register-form-group"},fde={class:"risk-business-impact-container"},bde={class:"risk-business-impact-dropdown"},Cde={key:0},Lde={key:1},wde={key:0,class:"risk-business-impact-options"},Ede={class:"risk-business-impact-search"},Rde={class:"risk-business-impact-list"},Ide=["onClick"],Dde=["checked","onClick"],Pde={class:"risk-selected-impacts-display"},_de=["onClick"],Ade={class:"form-row"},Sde={class:"risk-register-form-actions"},Tde={key:2,class:"risk-success-message"},xde={class:"risk-modal-form-group"},Fde={class:"risk-modal-actions"},Vde=["disabled"],Ude={class:"risk-modal-form-group"},Nde={class:"risk-modal-actions"},Mde=["disabled"];function Xde(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("SelectInput"),u=(0,s.g2)("NumberInput"),p=(0,s.g2)("TextInput"),m=(0,s.g2)("TextareaInput");return(0,s.uX)(),(0,s.CE)("div",Ece,[(0,s.bF)(r),(0,s.Lk)("div",Rce,[t[48]||(t[48]=(0,s.Lk)("h2",{class:"risk-register-title"}," Create New Risk",-1)),l.sourceRiskId?((0,s.uX)(),(0,s.CE)("div",Ice,[l.isLoadingSourceRisk?((0,s.uX)(),(0,s.CE)("span",Dce,t[46]||(t[46]=[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,s.eW)(" Loading source risk data... ")]))):((0,s.uX)(),(0,s.CE)("span",Pce,[t[47]||(t[47]=(0,s.Lk)("i",{class:"fas fa-link"},null,-1)),(0,s.eW)(" Creating from Risk #"+(0,d.v_)(l.sourceRiskId),1)]))])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_ce,[(0,s.Lk)("div",Ace,[(0,s.Lk)("div",{class:(0,d.C4)(["risk-toggle-option",{active:!l.isAiMode}]),onClick:t[0]||(t[0]=e=>n.setCreationMode(!1))},t[49]||(t[49]=[(0,s.Lk)("i",{class:"fas fa-user"},null,-1),(0,s.eW)(" Manual Creation ")]),2),(0,s.Lk)("div",{class:(0,d.C4)(["risk-toggle-option",{active:l.isAiMode}]),onClick:t[1]||(t[1]=e=>n.setCreationMode(!0))},t[50]||(t[50]=[(0,s.Lk)("i",{class:"fas fa-robot"},null,-1),(0,s.eW)(" AI Suggested ")]),2),(0,s.Lk)("div",{class:(0,d.C4)(["risk-toggle-slider",{"slide-right":l.isAiMode}])},null,2)])]),l.isAiMode&&!l.aiSuggestionGenerated?((0,s.uX)(),(0,s.CE)("div",Sce,[(0,s.Lk)("div",Tce,[t[56]||(t[56]=(0,s.Lk)("h3",null,[(0,s.Lk)("i",{class:"fas fa-robot"}),(0,s.eW)(" AI Risk Analysis")],-1)),l.isGeneratingAi?((0,s.uX)(),(0,s.CE)("div",xce,t[51]||(t[51]=[(0,s.Lk)("div",{class:"risk-ai-spinner"},[(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"})],-1),(0,s.Lk)("p",null,"Analyzing incident data with AI...",-1)]))):((0,s.uX)(),(0,s.CE)("div",Fce,[l.incidentId?((0,s.uX)(),(0,s.CE)("div",Vce,[(0,s.Lk)("div",Uce,[t[52]||(t[52]=(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"},null,-1)),(0,s.eW)(" Incident #"+(0,d.v_)(l.incidentId),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Nce,[t[53]||(t[53]=(0,s.Lk)("label",null,"Title",-1)),l.incidentId?((0,s.uX)(),(0,s.CE)("div",Mce,(0,d.v_)(l.aiInput.title||"No title available"),1)):(0,s.bo)(((0,s.uX)(),(0,s.CE)("input",{key:1,type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>l.aiInput.title=e),placeholder:"Enter incident title for AI analysis",class:"risk-ai-input-field"},null,512)),[[a.Jo,l.aiInput.title]])]),(0,s.Lk)("div",Xce,[t[54]||(t[54]=(0,s.Lk)("label",null,"Description",-1)),l.incidentId?((0,s.uX)(),(0,s.CE)("div",$ce,(0,d.v_)(l.aiInput.description||"No description available"),1)):(0,s.bo)(((0,s.uX)(),(0,s.CE)("textarea",{key:1,"onUpdate:modelValue":t[3]||(t[3]=e=>l.aiInput.description=e),placeholder:"Enter incident description for AI analysis",class:"risk-ai-input-field description",rows:"4"},null,512)),[[a.Jo,l.aiInput.description]])]),(0,s.Lk)("div",Oce,[(0,s.Lk)("button",{class:"risk-generate-btn",onClick:t[4]||(t[4]=(...e)=>n.generateAiSuggestion&&n.generateAiSuggestion(...e)),disabled:l.isGeneratingAi||!l.aiInput.title&&!l.aiInput.description},t[55]||(t[55]=[(0,s.Lk)("i",{class:"fas fa-magic"},null,-1),(0,s.eW)(" Generate Risk Analysis ")]),8,jce)])]))])])):(0,s.Q3)("",!0),!l.isAiMode||l.aiSuggestionGenerated?((0,s.uX)(),(0,s.CE)("div",Bce,[(0,s.Lk)("form",{onSubmit:t[33]||(t[33]=(0,a.D$)((...e)=>n.submitRisk&&n.submitRisk(...e),["prevent"])),class:"risk-register-form-grid"},[(0,s.Lk)("div",Wce,[t[61]||(t[61]=(0,s.Lk)("label",null,[(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-hashtag"}),(0,s.eW)(" Compliance ID")])],-1)),(0,s.Lk)("div",qce,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>l.selectedComplianceIdText=e),placeholder:"Enter or select compliance ID",onFocus:t[6]||(t[6]=e=>l.showComplianceDropdown=!0),readonly:""},null,544),[[a.Jo,l.selectedComplianceIdText]]),(0,s.Lk)("button",{type:"button",class:"risk-dropdown-toggle",onClick:t[7]||(t[7]=(...e)=>n.toggleComplianceDropdown&&n.toggleComplianceDropdown(...e))},t[57]||(t[57]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showComplianceDropdown?((0,s.uX)(),(0,s.CE)("div",Qce,[(0,s.Lk)("div",Kce,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>l.complianceSearchQuery=e),placeholder:"Search compliances...",onInput:t[9]||(t[9]=(...e)=>n.filterCompliances&&n.filterCompliances(...e)),onClick:t[10]||(t[10]=(0,a.D$)(()=>{},["stop"]))},null,544),[[a.Jo,l.complianceSearchQuery]])]),l.loadingCompliances?((0,s.uX)(),(0,s.CE)("div",Jce,t[58]||(t[58]=[(0,s.Lk)("div",{class:"risk-loading-spinner"},"Loading compliances...",-1)]))):0===l.filteredCompliances.length?((0,s.uX)(),(0,s.CE)("div",zce,t[59]||(t[59]=[(0,s.Lk)("div",{class:"risk-no-results"},"No compliances found",-1)]))):((0,s.uX)(),(0,s.CE)("div",Hce,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,class:"risk-compliance-item",onClick:t=>n.selectCompliance(e)},[(0,s.Lk)("div",Yce,[(0,s.Lk)("input",{type:"checkbox",id:"compliance-"+e.ComplianceId,checked:l.newRisk.ComplianceId===e.ComplianceId,onClick:(0,a.D$)(t=>n.selectCompliance(e),["stop"])},null,8,Zce)]),(0,s.Lk)("div",ede,[(0,s.Lk)("div",tde,[(0,s.Lk)("span",ide,"ID: "+(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("span",{class:(0,d.C4)("risk-compliance-criticality "+(e.Criticality?e.Criticality.toLowerCase():""))},(0,d.v_)(e.Criticality||"No Criticality"),3)]),(0,s.Lk)("div",ade,(0,d.v_)(n.sanitizeHTML(n.truncateText(e.ComplianceItemDescription,100))||"No description available"),1),e.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",sde,[t[60]||(t[60]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(n.sanitizeHTML(n.truncateText(e.PossibleDamage,80))),1)])):(0,s.Q3)("",!0)])],8,Gce))),128))]))])):(0,s.Q3)("",!0)]),t[62]||(t[62]=(0,s.Lk)("div",{class:"risk-helper-text"},"Select the compliance requirement this risk is associated with",-1))]),(0,s.Lk)("div",ode,[(0,s.bF)(c,{id:"criticality",modelValue:l.newRisk.Criticality,"onUpdate:modelValue":t[11]||(t[11]=e=>l.newRisk.Criticality=e),label:"Criticality",placeholder:"Select Criticality",options:l.criticalityOptions,name:"Criticality","helper-text":"Choose the severity level of this risk"},null,8,["modelValue","options"]),(0,s.Lk)("div",lde,[t[65]||(t[65]=(0,s.Lk)("label",null,[(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-tags"}),(0,s.eW)(" Category")])],-1)),(0,s.Lk)("div",nde,[(0,s.Lk)("div",rde,[(0,s.Lk)("div",{class:"risk-selected-category",onClick:t[12]||(t[12]=(...e)=>n.toggleCategoryDropdown&&n.toggleCategoryDropdown(...e))},[l.selectedCategory?((0,s.uX)(),(0,s.CE)("span",dde,(0,d.v_)(l.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",cde,"Select Category")),t[63]||(t[63]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",ude,[(0,s.Lk)("div",pde,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>l.categorySearch=e),placeholder:"Search categories...",onClick:t[14]||(t[14]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,l.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"risk-add-category-btn",onClick:t[15]||(t[15]=(0,a.D$)(e=>l.showAddCategoryModal=!0,["stop","prevent"]))},t[64]||(t[64]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",mde,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-category-item",onClick:(0,a.D$)(t=>n.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:l.selectedCategory===e.value,onClick:(0,a.D$)(t=>n.selectCategory(e),["stop"])},null,8,kde),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,vde))),128))])])):(0,s.Q3)("",!0)])]),t[66]||(t[66]=(0,s.Lk)("div",{class:"risk-helper-text"},"Categorize the risk for better organization and reporting",-1))]),(0,s.bF)(c,{id:"riskPriority",modelValue:l.newRisk.RiskPriority,"onUpdate:modelValue":t[16]||(t[16]=e=>l.newRisk.RiskPriority=e),label:"Risk Priority",placeholder:"Select Priority",options:l.priorityOptions,required:"",name:"RiskPriority","helper-text":"Set the priority level for risk treatment"},null,8,["modelValue","options"])]),(0,s.Lk)("div",hde,[(0,s.bF)(u,{id:"riskLikelihood",modelValue:l.newRisk.RiskLikelihood,"onUpdate:modelValue":[t[17]||(t[17]=e=>l.newRisk.RiskLikelihood=e),n.calculateRiskExposureRating],label:"Risk Likelihood (1-10)",placeholder:"Enter likelihood",min:1,max:10,required:"",name:"RiskLikelihood","helper-text":"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)"},null,8,["modelValue","onUpdate:modelValue"]),(0,s.bF)(u,{id:"riskImpact",modelValue:l.newRisk.RiskImpact,"onUpdate:modelValue":[t[18]||(t[18]=e=>l.newRisk.RiskImpact=e),n.calculateRiskExposureRating],label:"Risk Impact (1-10)",placeholder:"Enter impact",min:1,max:10,required:"",name:"RiskImpact","helper-text":"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)"},null,8,["modelValue","onUpdate:modelValue"]),(0,s.bF)(u,{id:"riskExposureRating",modelValue:l.newRisk.RiskExposureRating,"onUpdate:modelValue":t[19]||(t[19]=e=>l.newRisk.RiskExposureRating=e),label:"Risk Exposure Rating",placeholder:"Calculated rating",readonly:"",name:"RiskExposureRating","helper-text":"Automatically calculated as Likelihood × Impact"},null,8,["modelValue"])]),(0,s.Lk)("div",gde,[(0,s.bF)(c,{id:"riskType",modelValue:l.newRisk.RiskType,"onUpdate:modelValue":t[20]||(t[20]=e=>l.newRisk.RiskType=e),label:"Risk Type",placeholder:"Select Risk Type",options:l.riskTypeOptions,required:"",name:"RiskType","helper-text":"Classify the nature and timing of this risk"},null,8,["modelValue","options"]),(0,s.Lk)("div",yde,[t[69]||(t[69]=(0,s.Lk)("label",null,[(0,s.Lk)("span",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Impact")])],-1)),(0,s.Lk)("div",fde,[(0,s.Lk)("div",bde,[(0,s.Lk)("div",{class:"risk-selected-impacts",onClick:t[21]||(t[21]=(...e)=>n.toggleBusinessImpactDropdown&&n.toggleBusinessImpactDropdown(...e))},[0===l.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",Cde,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",Lde,(0,d.v_)(l.selectedBusinessImpacts.length)+" impact(s) selected",1)),t[67]||(t[67]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",wde,[(0,s.Lk)("div",Ede,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[22]||(t[22]=e=>l.businessImpactSearch=e),placeholder:"Search impacts...",onClick:t[23]||(t[23]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,l.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"risk-add-impact-btn",onClick:t[24]||(t[24]=(0,a.D$)(e=>l.showAddImpactModal=!0,["stop","prevent"]))},t[68]||(t[68]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",Rde,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-business-impact-item",onClick:(0,a.D$)(t=>n.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",checked:n.isBusinessImpactSelected(e),onClick:(0,a.D$)(t=>n.toggleBusinessImpact(e),["stop"])},null,8,Dde),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Ide))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",Pde,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-selected-impact-tag"},[(0,s.eW)((0,d.v_)(e.value)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:t=>n.toggleBusinessImpact(e)},null,8,_de)]))),128))])]),t[70]||(t[70]=(0,s.Lk)("div",{class:"risk-helper-text"},"Select the business areas that would be affected by this risk",-1))]),(0,s.bF)(p,{id:"riskTitle",modelValue:l.newRisk.RiskTitle,"onUpdate:modelValue":t[25]||(t[25]=e=>l.newRisk.RiskTitle=e),label:"Risk Title",placeholder:"Enter a clear, concise risk title",required:"",pattern:null,name:"RiskTitle","helper-text":"Provide a brief, descriptive title for this risk"},null,8,["modelValue"])]),(0,s.Lk)("div",Ade,[(0,s.bF)(m,{id:"riskDescription",modelValue:l.newRisk.RiskDescription,"onUpdate:modelValue":[t[26]||(t[26]=e=>l.newRisk.RiskDescription=e),t[27]||(t[27]=e=>l.newRisk.RiskDescription=n.sanitizeInput(e))],label:"Risk Description",placeholder:"Provide a detailed description of the risk",required:"",rows:4,name:"RiskDescription","helper-text":"Describe the risk scenario, causes, and potential triggers"},null,8,["modelValue"]),(0,s.bF)(m,{id:"possibleDamage",modelValue:l.newRisk.PossibleDamage,"onUpdate:modelValue":[t[28]||(t[28]=e=>l.newRisk.PossibleDamage=e),t[29]||(t[29]=e=>l.newRisk.PossibleDamage=n.sanitizeInput(e))],label:"Possible Damage",placeholder:"Describe the potential damage or consequences",rows:4,name:"PossibleDamage","helper-text":"Detail the potential consequences and damage if this risk materializes"},null,8,["modelValue"]),(0,s.bF)(m,{id:"riskMitigation",modelValue:l.newRisk.RiskMitigation,"onUpdate:modelValue":[t[30]||(t[30]=e=>l.newRisk.RiskMitigation=e),t[31]||(t[31]=e=>l.newRisk.RiskMitigation=n.sanitizeInput(e))],label:"Risk Mitigation",placeholder:"Describe mitigation strategies",rows:4,name:"RiskMitigation","helper-text":"Outline strategies and controls to reduce or eliminate this risk"},null,8,["modelValue"])]),(0,s.Lk)("div",Sde,[t[72]||(t[72]=(0,s.Lk)("button",{type:"submit",class:"risk-register-submit-btn"},[(0,s.Lk)("i",{class:"fas fa-save"}),(0,s.eW)(" Create Risk ")],-1)),(0,s.Lk)("button",{type:"button",class:"risk-register-reset-btn",onClick:t[32]||(t[32]=(...e)=>n.resetForm&&n.resetForm(...e))},t[71]||(t[71]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset Form ")]))])],32)])):(0,s.Q3)("",!0),l.showSuccessMessage?((0,s.uX)(),(0,s.CE)("div",Tde,t[73]||(t[73]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Risk has been successfully created! ")]))):(0,s.Q3)("",!0),l.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"risk-modal-overlay",onClick:t[39]||(t[39]=(0,a.D$)(e=>l.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-modal-content",onClick:t[38]||(t[38]=(0,a.D$)(()=>{},["stop"]))},[t[75]||(t[75]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:t[37]||(t[37]=(0,a.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"])),class:"risk-modal-form"},[(0,s.Lk)("div",xde,[t[74]||(t[74]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[34]||(t[34]=e=>l.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:t[35]||(t[35]=(0,a.jR)((0,a.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,l.newBusinessImpact]])]),(0,s.Lk)("div",Fde,[(0,s.Lk)("button",{type:"button",class:"risk-cancel-btn",onClick:t[36]||(t[36]=(0,a.D$)(e=>l.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-add-btn",disabled:!l.newBusinessImpact.trim()}," Add Impact ",8,Vde)])],32)])])):(0,s.Q3)("",!0),l.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:4,class:"risk-modal-overlay",onClick:t[45]||(t[45]=(0,a.D$)(e=>l.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-modal-content",onClick:t[44]||(t[44]=(0,a.D$)(()=>{},["stop"]))},[t[77]||(t[77]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:t[43]||(t[43]=(0,a.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"])),class:"risk-modal-form"},[(0,s.Lk)("div",Ude,[t[76]||(t[76]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[40]||(t[40]=e=>l.newCategory=e),placeholder:"Enter new category",onKeyup:t[41]||(t[41]=(0,a.jR)((0,a.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,l.newCategory]])]),(0,s.Lk)("div",Nde,[(0,s.Lk)("button",{type:"button",class:"risk-cancel-btn",onClick:t[42]||(t[42]=(0,a.D$)(e=>l.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-add-btn",disabled:!l.newCategory.trim()}," Add Category ",8,Mde)])],32)])])):(0,s.Q3)("",!0)])}const $de=["id","type","value","placeholder","required","disabled","readonly","maxlength","minlength","pattern","autocomplete","autofocus","name"];var Ode={__name:"TextInput",props:{id:{type:String,required:!0},modelValue:{type:String,default:""},type:{type:String,default:"text",validator:e=>["text","email","password","search","tel","url"].includes(e)},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},maxlength:{type:Number,default:null},minlength:{type:Number,default:null},pattern:{type:String,default:""},autocomplete:{type:String,default:""},autofocus:{type:Boolean,default:!1},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:t}){const i=e,a=t,o=(0,s.EW)(()=>!!i.errorMessage),l=e=>{a("update:modelValue",e.target.value)},n=e=>{a("blur",e)},r=e=>{a("focus",e)};return(t,i)=>((0,s.uX)(),(0,s.Wv)(J_,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("input",{id:e.id,type:e.type,value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,maxlength:e.maxlength,minlength:e.minlength,pattern:e.pattern,autocomplete:e.autocomplete,autofocus:e.autofocus,name:e.name,class:(0,d.C4)(["text-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,$de)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const jde=(0,le.A)(Ode,[["__scopeId","data-v-9c925992"]]);var Bde=jde;const Wde=["id","value","placeholder","required","disabled","readonly","min","max","step","name"];var qde={__name:"NumberInput",props:{id:{type:String,required:!0},modelValue:{type:[Number,String],default:""},label:{type:String,default:""},placeholder:{type:String,default:""},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},helperText:{type:String,default:""},errorMessage:{type:String,default:""},min:{type:Number,default:null},max:{type:Number,default:null},step:{type:[Number,String],default:1},name:{type:String,default:""}},emits:["update:modelValue","blur","focus"],setup(e,{emit:t}){const i=e,a=t,o=(0,s.EW)(()=>!!i.errorMessage),l=e=>{const t=e.target.value;a("update:modelValue",""===t?"":Number(t))},n=e=>{a("blur",e)},r=e=>{a("focus",e)};return(t,i)=>((0,s.uX)(),(0,s.Wv)(J_,{id:e.id,label:e.label,required:e.required,"helper-text":e.helperText,"error-message":e.errorMessage},{default:(0,s.k6)(()=>[(0,s.Lk)("input",{id:e.id,type:"number",value:e.modelValue,placeholder:e.placeholder,required:e.required,disabled:e.disabled,readonly:e.readonly,min:e.min,max:e.max,step:e.step,name:e.name,class:(0,d.C4)(["number-input",{"input-error":o.value,"input-disabled":e.disabled}]),onInput:l,onBlur:n,onFocus:r},null,42,Wde)]),_:1},8,["id","label","required","helper-text","error-message"]))}};const Qde=(0,le.A)(qde,[["__scopeId","data-v-575b1c18"]]);var Kde=Qde;const Jde={key:0,class:"checkbox-group-label"},zde={key:0,class:"required"},Hde={class:"checkbox-options"},Gde=["id","value","checked","disabled","name"],Yde=["for"],Zde={key:1,class:"helper-text"},eue={key:2,class:"error-text"};Boolean,Boolean,Boolean,Boolean;const tue={key:0,class:"radio-group-label"},iue={key:0,class:"required"},aue={class:"radio-options"},sue=["id","value","checked","disabled","name"],oue=["for"],lue={key:1,class:"helper-text"},nue={key:2,class:"error-text"};Boolean,Boolean;const rue={class:"file-input-wrapper"},cue=["id","accept","multiple","required","disabled","name"],due={key:0,class:"file-list"},uue={class:"file-name"},pue={class:"file-size"},mue=["onClick"];File,FileList,Boolean,Boolean,Boolean;var vue={name:"CreateRisk",components:{SelectInput:eA,NumberInput:Kde,TextInput:Bde,TextareaInput:sA,PopupModal:Ck.wA},data(){return{newRisk:{ComplianceId:null,Criticality:"",PossibleDamage:"",Category:"",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskMitigation:"",RiskTitle:"",RiskType:"Current",BusinessImpact:""},businessImpacts:[],selectedBusinessImpacts:[],showBusinessImpactDropdown:!1,businessImpactSearch:"",showAddImpactModal:!1,newBusinessImpact:"",categories:[],selectedCategory:"",showCategoryDropdown:!1,categorySearch:"",showAddCategoryModal:!1,newCategory:"",compliances:[],filteredCompliances:[],complianceSearchQuery:"",showComplianceDropdown:!1,loadingCompliances:!1,selectedComplianceIdText:"",showSuccessMessage:!1,sourceRiskId:null,isLoadingSourceRisk:!1,isAiMode:!1,aiInput:{title:"",description:""},isGeneratingAi:!1,aiSuggestionGenerated:!1,incidentId:null,riskJustifications:{likelihood:"",impact:""},criticalityOptions:[{value:"Critical",label:"Critical"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}],priorityOptions:[{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}],riskTypeOptions:[{value:"Current",label:"Current"},{value:"Emerging",label:"Emerging"},{value:"Residual",label:"Residual"},{value:"Inherent",label:"Inherent"},{value:"Accepted",label:"Accepted"}]}},setup(){const e=(0,ae.rd)(),t=(0,ae.lq)();return{router:e,route:t}},computed:{filteredBusinessImpacts(){if(!this.businessImpactSearch)return this.businessImpacts;const e=this.businessImpactSearch.toLowerCase();return this.businessImpacts.filter(t=>t.value.toLowerCase().includes(e))},filteredCategories(){if(!this.categorySearch)return this.categories;const e=this.categorySearch.toLowerCase();return this.categories.filter(t=>t.value.toLowerCase().includes(e))}},mounted(){this.calculateRiskExposureRating(),this.route.query.source_risk_id&&(this.sourceRiskId=this.route.query.source_risk_id,this.loadSourceRiskData()),this.fetchBusinessImpacts(),this.fetchCategories(),"ai"===this.route.query.mode&&(this.isAiMode=!0,this.sourceRiskId&&this.fetchIncidentDataForAI()),this.fetchCompliances(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},sanitizeHTML(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):""},sanitizeInput(e){return e?e.replace(/[<>]/g,""):""},encodeQueryParam(e){return e?encodeURIComponent(e):""},async fetchCompliances(){this.loadingCompliances=!0;try{const e=`http://localhost:8000/api/compliances-for-dropdown/${this.encodeQueryParam(this.complianceSearchQuery)}`,t=await He.A.get(e,{headers:{"Content-Type":"application/json"}});this.compliances=t.data.map(e=>({...e,ComplianceItemDescription:this.sanitizeHTML(e.ComplianceItemDescription),PossibleDamage:this.sanitizeHTML(e.PossibleDamage)})),this.filteredCompliances=[...this.compliances],this.loadingCompliances=!1,this.newRisk.ComplianceId&&this.updateSelectedComplianceIdText()}catch(e){console.error("Error fetching compliances:",e),this.loadingCompliances=!1,this.compliances=[],this.filteredCompliances=[],this.$popup.error("Failed to fetch compliances. Please try again."),this.sendPushNotification({title:"Compliance Data Fetch Failed",message:"Failed to fetch compliance data for risk creation. Please try again.",category:"risk",priority:"medium",user_id:"default_user"})}},filterCompliances(){if(!this.complianceSearchQuery)return void(this.filteredCompliances=[...this.compliances]);const e=this.complianceSearchQuery.toLowerCase();this.filteredCompliances=this.compliances.filter(t=>t.ComplianceId&&t.ComplianceId.toString().includes(e)||t.ComplianceItemDescription&&t.ComplianceItemDescription.toLowerCase().includes(e)||t.Criticality&&t.Criticality.toLowerCase().includes(e)||t.PossibleDamage&&t.PossibleDamage.toLowerCase().includes(e))},selectCompliance(e){this.newRisk.ComplianceId=e.ComplianceId,this.selectedComplianceIdText=`Compliance ID: ${e.ComplianceId}`,this.showComplianceDropdown=!1,e.Criticality&&(this.newRisk.Criticality=e.Criticality),e.PossibleDamage&&(this.newRisk.PossibleDamage=e.PossibleDamage)},toggleComplianceDropdown(){this.showComplianceDropdown=!this.showComplianceDropdown,this.showComplianceDropdown&&(this.complianceSearchQuery="",this.filterCompliances())},updateSelectedComplianceIdText(){if(this.newRisk.ComplianceId){const e=this.compliances.find(e=>e.ComplianceId===parseInt(this.newRisk.ComplianceId));this.selectedComplianceIdText=e?`Compliance ID: ${e.ComplianceId}`:`Compliance ID: ${this.newRisk.ComplianceId}`}else this.selectedComplianceIdText=""},truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:""},calculateRiskExposureRating(){const e=parseInt(this.newRisk.RiskLikelihood)||1,t=parseInt(this.newRisk.RiskImpact)||1;this.newRisk.RiskExposureRating=e*t},loadSourceRiskData(){this.sourceRiskId&&(this.isLoadingSourceRisk=!0,He.A.get(`http://localhost:8000/api/risk-instances/${this.sourceRiskId}/`).then(e=>{console.log("Source risk data loaded:",e.data);const t=e.data;this.incidentId=t.IncidentId,t.ComplianceId&&(this.newRisk.ComplianceId=t.ComplianceId),t.Category&&(this.newRisk.Category=t.Category),t.RiskTitle&&(this.newRisk.RiskTitle=t.RiskTitle),t.RiskDescription&&(this.newRisk.RiskDescription=t.RiskDescription),this.isLoadingSourceRisk=!1,this.isAiMode&&this.incidentId&&this.fetchIncidentDataForAI()}).catch(e=>{console.error("Error loading source risk data:",e),this.isLoadingSourceRisk=!1}))},fetchIncidentDataForAI(){this.incidentId?(this.isGeneratingAi=!0,console.log(`Fetching incident data for ID: ${this.incidentId}`),He.A.get(`http://localhost:8000/api/incidents/${this.incidentId}/`,{timeout:8e4}).then(e=>{const t=e.data;console.log("Incident data loaded:",t),this.aiInput.title=t.Title||"",this.aiInput.description=t.Description||"",this.aiInput.title||this.aiInput.description?this.generateAiSuggestion():(this.isGeneratingAi=!1,console.warn("Incident data missing title or description"))}).catch(e=>{console.error("Error fetching incident data:",e),this.isGeneratingAi=!1})):console.error("No incident ID available for AI analysis")},setCreationMode(e){this.isAiMode=e,e?this.incidentId&&this.fetchIncidentDataForAI():this.aiSuggestionGenerated=!1},generateAiSuggestion(){if(!this.aiInput.title&&!this.aiInput.description)return this.$popup.warning("Please provide either a title or description for AI analysis."),void this.sendPushNotification({title:"AI Analysis Warning",message:"Please provide either a title or description for AI analysis.",category:"risk",priority:"medium",user_id:"default_user"});this.isGeneratingAi=!0;const e={title:this.aiInput.title||"Untitled Incident",description:this.aiInput.description||this.aiInput.title||"No description available"};console.log("Sending to AI analysis:",e),He.A.post("http://localhost:8000/api/analyze-incident/",e,{timeout:8e4}).then(e=>{if(console.log("AI Analysis Response:",e.data),e.data.error)throw new Error(e.data.error);e.data.riskLikelihoodJustification||e.data.riskImpactJustification?console.log("✅ Using AI-generated justifications"):console.log("⚠️ No AI justifications found, might be using fallback"),this.mapAnalysisToForm(e.data),this.aiSuggestionGenerated=!0,this.isGeneratingAi=!1}).catch(e=>{console.error("Error analyzing incident:",e.response||e),this.isGeneratingAi=!1;let t="Failed to generate AI suggestion.";e.message?t=e.message:e.response&&e.response.data&&(e.response.data.error?t=e.response.data.error:"object"===typeof e.response.data?t+=" Error: "+JSON.stringify(e.response.data):t+=" Error: "+e.response.data),this.sendPushNotification({title:"AI Analysis Failed",message:`Failed to generate AI suggestion: ${t}`,category:"risk",priority:"high",user_id:"default_user"}),this.$popup.confirm(t+"\n\nWould you like to try again with different input?","AI Analysis Failed",()=>{},()=>{this.isAiMode=!1,this.aiSuggestionGenerated=!1})})},mapAnalysisToForm(e){if(console.log("Mapping analysis to form:",e),e.criticality){const t={Severe:"Critical",Significant:"High",Moderate:"Medium",Minor:"Low"};this.newRisk.Criticality=t[e.criticality]||e.criticality}if(this.newRisk.PossibleDamage=e.possibleDamage||"",this.newRisk.Category=e.category||"",this.newRisk.RiskDescription=e.riskDescription||"",this.newRisk.RiskTitle=this.aiInput.title||"",e.riskLikelihood&&(this.newRisk.RiskLikelihood=e.riskLikelihood.toString(),this.riskJustifications.likelihood=e.riskLikelihoodJustification||""),e.riskImpact&&(this.newRisk.RiskImpact=e.riskImpact.toString(),this.riskJustifications.impact=e.riskImpactJustification||""),e.riskExposureRating){const t={"Critical Exposure":"9.0","High Exposure":"7.5","Elevated Exposure":"5.5","Low Exposure":"3.0"};this.newRisk.RiskExposureRating=t[e.riskExposureRating]||"6.0"}else{const e=parseFloat(this.newRisk.RiskLikelihood)||5,t=parseFloat(this.newRisk.RiskImpact)||5;this.newRisk.RiskExposureRating=(e*t/10).toFixed(1)}if(e.riskPriority){const t={P0:"Critical",P1:"High",P2:"Medium",P3:"Low"};this.newRisk.RiskPriority=t[e.riskPriority]||"Medium"}e.riskMitigation&&Array.isArray(e.riskMitigation)&&(this.newRisk.RiskMitigation=e.riskMitigation.join("\n")),this.newRisk.BusinessImpact=this.aiInput.description||"",this.newRisk.RiskType=e.category||"",!this.newRisk.ComplianceId&&this.incidentId&&(this.newRisk.ComplianceId=this.incidentId)},resetForm(){this.newRisk={ComplianceId:null,Criticality:"",PossibleDamage:"",Category:"",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskMitigation:"",RiskTitle:"",RiskType:"Current",BusinessImpact:""},this.selectedComplianceIdText="",this.calculateRiskExposureRating(),this.aiSuggestionGenerated=!1,this.aiInput={title:"",description:""},this.riskJustifications={likelihood:"",impact:""},this.selectedCategory=""},async fetchBusinessImpacts(){try{const e=await He.A.get("http://localhost:8000/api/business-impacts/");"success"===e.data.status&&(this.businessImpacts=e.data.data)}catch(e){console.error("Error fetching business impacts:",e)}},toggleBusinessImpactDropdown(){this.showBusinessImpactDropdown=!this.showBusinessImpactDropdown,this.showBusinessImpactDropdown&&(this.businessImpactSearch="")},closeBusinessImpactDropdown(e){const t=document.querySelector(".risk-business-impact-dropdown");t&&!t.contains(e.target)&&(this.showBusinessImpactDropdown=!1)},toggleBusinessImpact(e){const t=this.selectedBusinessImpacts.findIndex(t=>t.id===e.id);-1===t?this.selectedBusinessImpacts.push(e):this.selectedBusinessImpacts.splice(t,1),this.newRisk.BusinessImpact=this.selectedBusinessImpacts.map(e=>e.value).join(", ")},isBusinessImpactSelected(e){return this.selectedBusinessImpacts.some(t=>t.id===e.id)},async addNewBusinessImpact(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newBusinessImpact.trim())try{console.log("Adding new business impact:",this.newBusinessImpact);const e=await He.A.post("http://localhost:8000/api/business-impacts/add/",{value:this.newBusinessImpact.trim()});if("success"!==e.data.status)throw new Error("Failed to add business impact: "+(e.data.message||"Unknown error"));console.log("Successfully added business impact:",e.data.data),this.businessImpacts.push(e.data.data),this.toggleBusinessImpact(e.data.data),this.showAddImpactModal=!1,this.newBusinessImpact=""}catch(t){console.error("Error adding new business impact:",t),this.$popup.error("Failed to add new business impact: "+(t.response?.data?.message||t.message)),this.sendPushNotification({title:"Business Impact Addition Failed",message:`Failed to add new business impact: ${t.response?.data?.message||t.message}`,category:"risk",priority:"medium",user_id:"default_user"})}},async fetchCategories(){try{const e=await He.A.get("http://localhost:8000/api/risk-categories/");"success"===e.data.status&&(this.categories=e.data.data)}catch(e){console.error("Error fetching categories:",e)}},toggleCategoryDropdown(){this.showCategoryDropdown=!this.showCategoryDropdown,this.showCategoryDropdown&&(this.categorySearch="")},selectCategory(e){this.selectedCategory=e.value,this.newRisk.Category=e.value,this.showCategoryDropdown=!1},async addNewCategory(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newCategory.trim())try{console.log("Adding new category:",this.newCategory);const e=await He.A.post("http://localhost:8000/api/risk-categories/add/",{value:this.newCategory.trim()});if("success"!==e.data.status)throw new Error("Failed to add category: "+(e.data.message||"Unknown error"));console.log("Successfully added category:",e.data.data),this.categories.push(e.data.data),this.selectCategory(e.data.data),this.showAddCategoryModal=!1,this.newCategory=""}catch(t){console.error("Error adding new category:",t),this.$popup.error("Failed to add new category: "+(t.response?.data?.message||t.message)),this.sendPushNotification({title:"Category Addition Failed",message:`Failed to add new category: ${t.response?.data?.message||t.message}`,category:"risk",priority:"medium",user_id:"default_user"})}},async submitRisk(){const e=this.validateRiskData();if(Object.keys(e).length>0)return void Object.entries(e).forEach(([e,t])=>{this.$popup.error(`${e}: ${t}`),this.sendPushNotification({title:"Risk Validation Error",message:`Validation error in ${e}: ${t}`,category:"risk",priority:"high",user_id:"default_user"})});const t={...this.newRisk,RiskTitle:this.sanitizeInput(this.newRisk.RiskTitle),RiskDescription:this.sanitizeInput(this.newRisk.RiskDescription),PossibleDamage:this.sanitizeInput(this.newRisk.PossibleDamage),RiskMitigation:this.sanitizeInput(this.newRisk.RiskMitigation),BusinessImpact:this.selectedBusinessImpacts.map(e=>this.sanitizeInput(e.value)).join(", "),RiskLikelihood:parseInt(this.newRisk.RiskLikelihood)||1,RiskImpact:parseInt(this.newRisk.RiskImpact)||1,RiskExposureRating:parseFloat(this.newRisk.RiskExposureRating)||1};try{const e=await He.A.post("http://localhost:8000/api/risks/",t,{headers:{"Content-Type":"application/json"}});console.log("Risk created successfully:",e.data),this.resetForm(),this.$popup.success("Risk created successfully!"),this.sendPushNotification({title:"New Risk Created Successfully",message:`A new risk "${t.RiskTitle||"Untitled Risk"}" has been created successfully.`,category:"risk",priority:"high",user_id:"default_user"})}catch(i){console.error("Error creating risk:",i),i.response&&![401,403].includes(i.response.status)&&(i.response.data.errors?Object.entries(i.response.data.errors).forEach(([e,t])=>{this.$popup.error(`${e}: ${t}`),this.sendPushNotification({title:"Risk Creation Error",message:`Error in ${e}: ${t}`,category:"risk",priority:"high",user_id:"default_user"})}):(this.$popup.error("Failed to create risk. Please try again."),this.sendPushNotification({title:"Risk Creation Failed",message:"Failed to create risk. Please try again.",category:"risk",priority:"high",user_id:"default_user"})))}},validateRiskData(){const e={};if(this.newRisk.Criticality){const t=["Critical","High","Medium","Low"];t.includes(this.newRisk.Criticality)||(e.Criticality=`Must be one of: ${t.join(", ")}`)}if(this.newRisk.RiskPriority){const t=["High","Medium","Low"];t.includes(this.newRisk.RiskPriority)||(e.RiskPriority=`Must be one of: ${t.join(", ")}`)}if(this.newRisk.RiskType){const t=["Current","Residual","Inherent","Emerging","Accept"];t.includes(this.newRisk.RiskType)||(e.RiskType=`Must be one of: ${t.join(", ")}`)}const t=parseInt(this.newRisk.RiskLikelihood);(isNaN(t)||t<1||t>10)&&(e.RiskLikelihood="Must be a number between 1 and 10");const i=parseInt(this.newRisk.RiskImpact);return(isNaN(i)||i<1||i>10)&&(e.RiskImpact="Must be a number between 1 and 10"),this.newRisk.RiskTitle?.trim()||(e.RiskTitle="Risk Title is required"),this.newRisk.RiskDescription?.trim()||(e.RiskDescription="Risk Description is required"),e}}};const kue=(0,le.A)(vue,[["render",Xde]]);var hue=kue;const gue={class:"risk-register-container"},yue={class:"risk-register-export-controls",style:{display:"flex","justify-content":"flex-end","align-items":"center",gap:"8px","margin-bottom":"16px"}},fue=["disabled"],bue={class:"risk-register-filters-section"},Cue={class:"risk-register-search-row"},Lue={class:"risk-register-dropdowns-row"},wue=["onClick"];function Eue(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("Dynamicalsearch"),d=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",gue,[(0,s.Lk)("div",yue,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedExportFormat=e),class:"risk-register-export-dropdown",style:{"min-width":"120px",height:"32px","border-radius":"8px",border:"1.5px solid #e2e8f0","font-size":"0.85rem",padding:"0 10px",background:"#fff",color:"#222"}},t[5]||(t[5]=[(0,s.Fv)('<option value="" disabled>Select format</option><option value="xlsx">Excel (.xlsx)</option><option value="pdf">PDF (.pdf)</option><option value="csv">CSV (.csv)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option><option value="txt">Text (.txt)</option>',7)]),512),[[a.u1,l.selectedExportFormat]]),(0,s.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>n.exportRiskRegister&&n.exportRiskRegister(...e)),disabled:!l.selectedExportFormat,style:{padding:"6px 16px","border-radius":"8px",border:"none","font-size":"0.85rem","font-weight":"600",cursor:"pointer",background:"#4f6cff",color:"#fff",transition:"background 0.2s"}}," Export ",8,fue)]),(0,s.bF)(r),t[6]||(t[6]=(0,s.Lk)("div",{class:"risk-register-header-row"},[(0,s.Lk)("h2",{class:"risk-register-title"}," Risk Register List")],-1)),(0,s.Lk)("div",bue,[(0,s.Lk)("div",Cue,[(0,s.bF)(c,{modelValue:l.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=e=>l.searchQuery=e),placeholder:"Search risks..."},null,8,["modelValue"])]),(0,s.Lk)("div",Lue,[(0,s.bF)(d,{config:l.criticalityFilter,modelValue:l.selectedCriticality,"onUpdate:modelValue":t[3]||(t[3]=e=>l.selectedCriticality=e),onChange:n.handleFilterChange},null,8,["config","modelValue","onChange"]),(0,s.bF)(d,{config:l.categoryFilter,modelValue:l.selectedCategory,"onUpdate:modelValue":t[4]||(t[4]=e=>l.selectedCategory=e),onChange:n.handleFilterChange},null,8,["config","modelValue","onChange"])])]),(0,s.bF)(u,{title:"",data:n.tableData,columns:l.tableColumns,filters:[],"show-checkbox":!1,"show-actions":!0,"show-pagination":!0,"default-page-size":10,"unique-key":"RiskId",onFilterChange:n.handleFilterChange,onSortChange:n.handleSortChange,onPageChange:n.handlePageChange},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{onClick:t=>n.viewRiskDetails(e.RiskId),class:"risk-register-view-btn"}," View Risk ",8,wue)]),_:1},8,["data","columns","onFilterChange","onSortChange","onPageChange"])])}var Rue={name:"RiskRegisterList",components:{DynamicTable:Hn.A,Dynamicalsearch:VG.A,CustomDropdown:xa.A,PopupModal:Ck.wA},data(){return{risks:[],selectedCriticality:"",selectedCategory:"",searchQuery:"",loading:!1,selectedExportFormat:"",criticalityFilter:{name:"criticality",label:"Criticality",values:[],defaultValue:""},categoryFilter:{name:"category",label:"Category",values:[],defaultValue:""},tableColumns:[{key:"RiskId",label:"RISK ID",sortable:!0,cellClass:"risk-register-id"},{key:"RiskTitle",label:"RISK TITLE",sortable:!0},{key:"RiskType",label:"RISK TYPE",sortable:!0},{key:"ComplianceId",label:"COMPLIANCE ID",sortable:!0},{key:"Category",label:"CATEGORY",sortable:!0},{key:"Criticality",label:"CRITICALITY",sortable:!0}]}},computed:{uniqueCriticality(){return[...new Set(this.risks.map(e=>e.Criticality).filter(Boolean))]},uniqueCategory(){return[...new Set(this.risks.map(e=>e.Category).filter(Boolean))]},filteredRisks(){let e=this.risks;if(this.searchQuery&&"string"===typeof this.searchQuery&&""!==this.searchQuery.trim()){const t=this.searchQuery.toLowerCase();e=e.filter(e=>e.RiskTitle&&e.RiskTitle.toLowerCase().includes(t)||e.RiskDescription&&e.RiskDescription.toLowerCase().includes(t)||e.Category&&e.Category.toLowerCase().includes(t)||e.Criticality&&e.Criticality.toLowerCase().includes(t))}return this.selectedCriticality&&(e=e.filter(e=>e.Criticality===this.selectedCriticality)),this.selectedCategory&&(e=e.filter(e=>e.Category===this.selectedCategory)),e},tableData(){return this.filteredRisks.map(e=>({...e,RiskType:e.RiskType||"N/A"}))}},watch:{searchQuery(){},selectedCriticality(){},selectedCategory(){}},mounted(){this.fetchRisks()},methods:{fetchRisks(){this.loading=!0,He.A.get("http://localhost:8000/api/risks/").then(e=>{this.risks=e.data,this.updateFilterOptions(),this.loading=!1,this.sendPushNotification({title:"Risk Register Updated",message:`Successfully loaded ${this.risks.length} risks from the Risk Register.`,category:"risk",priority:"medium",user_id:"default_user"})}).catch(e=>{console.error("Error fetching risks:",e),this.loading=!1,this.sendPushNotification({title:"Risk Register Load Failed",message:`Failed to load risks from the Risk Register: ${e.response?.data?.error||e.message}`,category:"risk",priority:"high",user_id:"default_user"})})},async exportRiskRegister(){if(this.selectedExportFormat)try{const e=this.tableData,t={export_format:this.selectedExportFormat,risk_data:e,user_id:"default_user",file_name:"risk_register_export"},i=await fetch("http://localhost:8000/api/export-risk-register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await i.json();a.success?alert("Export successful!"):alert("Export failed: "+(a.error||"Unknown error"))}catch(e){alert("Export error: "+e.message)}},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},updateFilterOptions(){const e=this.uniqueCriticality.map(e=>({value:e,label:e}));this.criticalityFilter.values=[{value:"",label:"All Criticality"},...e];const t=this.uniqueCategory.map(e=>({value:e,label:e}));this.categoryFilter.values=[{value:"",label:"All Category"},...t]},handleSearch(e){this.searchQuery=e},handleFilterChange(e){"criticality"===e.name?this.selectedCriticality=e.value:"category"===e.name&&(this.selectedCategory=e.value)},handleSortChange(e){console.log("Sort changed:",e)},handlePageChange(e){console.log("Page changed:",e)},viewRiskDetails(e){const t=this.risks.find(t=>t.RiskId===e);this.sendPushNotification({title:"Risk Details Viewed",message:`Risk "${t?.RiskTitle||"Untitled Risk"}" (ID: ${e}) details have been viewed.`,category:"risk",priority:"low",user_id:"default_user"}),this.$router.push(`/view-risk/${e}`)},getCriticalityClass(e){return e&&"string"===typeof e?(e=e.toLowerCase(),"critical"===e?"risk-register-priority-critical":"high"===e?"risk-register-priority-high":"medium"===e?"risk-register-priority-medium":"low"===e?"risk-register-priority-low":""):""},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleDateString()}}};const Iue=(0,le.A)(Rue,[["render",Eue]]);var Due=Iue;const Pue={class:"risk-dashboard-container"},_ue={class:"risk-filters-section"},Aue={class:"risk-dashboard-filters"},Sue={class:"risk-filter-group"},Tue=["value"],xue={class:"risk-filter-group"},Fue=["value"],Vue={class:"risk-filter-group"},Uue={class:"risk-metrics-section"},Nue={class:"risk-performance-summary"},Mue={key:0,class:"risk-no-data-message"},Xue={class:"risk-summary-card"},$ue={class:"risk-summary-content"},Oue={key:0,class:"risk-summary-value"},jue={key:1,class:"risk-summary-value empty"},Bue={key:2,class:"risk-summary-trend positive"},Wue={class:"risk-summary-card"},que={class:"risk-summary-content"},Que={key:0,class:"risk-summary-value"},Kue={key:1,class:"risk-summary-value empty"},Jue={key:2,class:"risk-summary-trend positive"},zue={class:"risk-summary-card"},Hue={class:"risk-summary-content"},Gue={key:0,class:"risk-summary-value"},Yue={key:1,class:"risk-summary-value empty"},Zue={key:2,class:"risk-summary-trend negative"},epe={class:"risk-summary-card"},tpe={class:"risk-summary-content"},ipe={key:0,class:"risk-summary-value"},ape={key:1,class:"risk-summary-value empty"},spe={key:2,class:"risk-summary-trend positive"},ope={class:"risk-summary-card"},lpe={class:"risk-summary-content"},npe={key:0,class:"risk-summary-value"},rpe={key:1,class:"risk-summary-value empty"},cpe={key:2,class:"risk-summary-trend positive"},dpe={class:"risk-charts-row risk-charts-row-three"},upe={class:"risk-chart-card"},ppe={class:"risk-chart-container"},mpe={key:0,style:{"text-align":"center",color:"#aaa",padding:"40px"}},vpe={class:"risk-chart-legend"},kpe={class:"risk-legend-label"},hpe={class:"risk-legend-value"},gpe={class:"risk-chart-insights"},ype={class:"risk-insight-item"},fpe={class:"risk-insight-value"},bpe={class:"risk-chart-card risk-heatmap-card"},Cpe={class:"risk-heatmap-container"},Lpe={ref:"heatmapCanvas"},wpe={class:"risk-charts-row-uneven"},Epe={class:"risk-chart-card risk-trend"},Rpe={class:"risk-chart-container"},Ipe={key:0,class:"no-chart-data"},Dpe={class:"risk-chart-insights"},Ppe={class:"risk-insight-item"},_pe={class:"risk-chart-card risk-dynamic-chart"},Ape={class:"risk-card-header"},Spe={class:"risk-axis-controls"},Tpe={class:"risk-axis-control"},xpe={class:"risk-axis-control"},Fpe=["value"],Vpe={class:"risk-chart-container"},Upe={class:"risk-chart-tabs"},Npe=["onClick"],Mpe={class:"risk-chart-content"},Xpe={key:0,class:"risk-chart-loading"},$pe={key:1,class:"no-chart-data"};function Ope(e,t,i,o,l,n){const r=(0,s.g2)("Doughnut"),c=(0,s.g2)("LineChart"),u=(0,s.g2)("Bar");return(0,s.uX)(),(0,s.CE)("div",Pue,[t[34]||(t[34]=(0,s.Fv)('<div class="risk-dashboard-header" data-v-fce55e70><h2 class="risk-dashboard-heading" data-v-fce55e70>Risk Dashboard</h2><div class="risk-dashboard-actions" data-v-fce55e70><button class="risk-action-btn refresh" data-v-fce55e70><i class="fas fa-sync-alt" data-v-fce55e70></i> Refresh</button><button class="risk-action-btn export" data-v-fce55e70><i class="fas fa-download" data-v-fce55e70></i> Export</button></div></div>',1)),(0,s.Lk)("div",_ue,[(0,s.Lk)("div",Aue,[(0,s.Lk)("div",Sue,[t[10]||(t[10]=(0,s.Lk)("label",null,"Time Range",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.filters.timeRange=e),class:"risk-filter-select",onChange:t[1]||(t[1]=(...e)=>o.fetchRiskMetrics&&o.fetchRiskMetrics(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.timeRangeOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,Tue))),128))],544),[[a.u1,o.filters.timeRange]])]),(0,s.Lk)("div",xue,[t[11]||(t[11]=(0,s.Lk)("label",null,"Category",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.filters.category=e),class:"risk-filter-select",onChange:t[3]||(t[3]=(...e)=>o.fetchRiskMetrics&&o.fetchRiskMetrics(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.categoryOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,Fue))),128))],544),[[a.u1,o.filters.category]])]),(0,s.Lk)("div",Vue,[t[13]||(t[13]=(0,s.Lk)("label",null,"Priority",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.filters.priority=e),class:"risk-filter-select",onChange:t[5]||(t[5]=(...e)=>o.fetchRiskMetrics&&o.fetchRiskMetrics(...e))},t[12]||(t[12]=[(0,s.Fv)('<option value="all" data-v-fce55e70>All Priorities</option><option value="critical" data-v-fce55e70>Critical</option><option value="high" data-v-fce55e70>High</option><option value="medium" data-v-fce55e70>Medium</option><option value="low" data-v-fce55e70>Low</option>',5)]),544),[[a.u1,o.filters.priority]])])])]),(0,s.Lk)("div",Uue,[(0,s.Lk)("div",Nue,[o.hasData?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.Lk)("div",Xue,[t[15]||(t[15]=(0,s.Lk)("div",{class:"risk-summary-icon total"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"})],-1)),(0,s.Lk)("div",$ue,[t[14]||(t[14]=(0,s.Lk)("div",{class:"risk-summary-label"},"Total Risks",-1)),o.metrics.total>0?((0,s.uX)(),(0,s.CE)("div",Oue,(0,d.v_)(o.metrics.total),1)):((0,s.uX)(),(0,s.CE)("div",jue,"No data found")),o.metrics.total>0?((0,s.uX)(),(0,s.CE)("div",Bue,"+12 this month")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",Wue,[t[17]||(t[17]=(0,s.Lk)("div",{class:"risk-summary-icon accepted"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",que,[t[16]||(t[16]=(0,s.Lk)("div",{class:"risk-summary-label"},"Accepted Risks",-1)),o.metrics.accepted>0?((0,s.uX)(),(0,s.CE)("div",Que,(0,d.v_)(o.metrics.accepted),1)):((0,s.uX)(),(0,s.CE)("div",Kue,"No data found")),o.metrics.accepted>0?((0,s.uX)(),(0,s.CE)("div",Jue,"+5 this month")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",zue,[t[19]||(t[19]=(0,s.Lk)("div",{class:"risk-summary-icon rejected"},[(0,s.Lk)("i",{class:"fas fa-times-circle"})],-1)),(0,s.Lk)("div",Hue,[t[18]||(t[18]=(0,s.Lk)("div",{class:"risk-summary-label"},"Rejected Risks",-1)),o.metrics.rejected>0?((0,s.uX)(),(0,s.CE)("div",Gue,(0,d.v_)(o.metrics.rejected),1)):((0,s.uX)(),(0,s.CE)("div",Yue,"No data found")),o.metrics.rejected>0?((0,s.uX)(),(0,s.CE)("div",Zue,"+3 this week")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",epe,[t[21]||(t[21]=(0,s.Lk)("div",{class:"risk-summary-icon mitigated"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"})],-1)),(0,s.Lk)("div",tpe,[t[20]||(t[20]=(0,s.Lk)("div",{class:"risk-summary-label"},"Mitigated Risks",-1)),o.metrics.mitigated>0?((0,s.uX)(),(0,s.CE)("div",ipe,(0,d.v_)(o.metrics.mitigated),1)):((0,s.uX)(),(0,s.CE)("div",ape,"No data found")),o.metrics.mitigated>0?((0,s.uX)(),(0,s.CE)("div",spe,"+8 this month")):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",ope,[t[23]||(t[23]=(0,s.Lk)("div",{class:"risk-summary-icon inprogress"},[(0,s.Lk)("i",{class:"fas fa-spinner"})],-1)),(0,s.Lk)("div",lpe,[t[22]||(t[22]=(0,s.Lk)("div",{class:"risk-summary-label"},"In Progress Risks",-1)),o.metrics.inProgress>0?((0,s.uX)(),(0,s.CE)("div",npe,(0,d.v_)(o.metrics.inProgress),1)):((0,s.uX)(),(0,s.CE)("div",rpe,"No data found")),o.metrics.inProgress>0?((0,s.uX)(),(0,s.CE)("div",cpe,"+6 this week")):(0,s.Q3)("",!0)])])],64)):((0,s.uX)(),(0,s.CE)("div",Mue," No data found for the selected filters "))])]),(0,s.Lk)("div",dpe,[(0,s.Lk)("div",upe,[t[25]||(t[25]=(0,s.Lk)("div",{class:"risk-card-header"},[(0,s.Lk)("h3",null,"Risk Distribution by Category")],-1)),(0,s.Lk)("div",ppe,[o.categoryDistributionData.labels.length&&o.categoryDistributionData.datasets[0].data.length?((0,s.uX)(),(0,s.Wv)(r,{key:1,data:o.categoryDistributionData,options:o.donutChartOptions},null,8,["data","options"])):((0,s.uX)(),(0,s.CE)("div",mpe," No category data to display. "))]),(0,s.Lk)("div",vpe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.label,class:"risk-legend-item"},[(0,s.Lk)("span",{class:"risk-legend-color",style:(0,d.Tr)({backgroundColor:e.color})},null,4),(0,s.Lk)("span",kpe,(0,d.v_)(e.label),1),(0,s.Lk)("span",hpe,(0,d.v_)(e.value),1)]))),128))]),(0,s.Lk)("div",gpe,[(0,s.Lk)("div",ype,[t[24]||(t[24]=(0,s.Lk)("span",{class:"risk-insight-label"},"Highest Category:",-1)),(0,s.Lk)("span",fpe,(0,d.v_)(o.highestCategory.name)+" ("+(0,d.v_)(o.highestCategory.percent)+"%)",1)])])]),(0,s.Lk)("div",bpe,[t[26]||(t[26]=(0,s.Lk)("div",{class:"risk-card-header"},[(0,s.Lk)("h3",null,"Risk Matrix Heatmap")],-1)),(0,s.Lk)("div",Cpe,[(0,s.Lk)("canvas",Lpe,null,512)])])]),(0,s.Lk)("div",wpe,[(0,s.Lk)("div",Epe,[t[28]||(t[28]=(0,s.Lk)("div",{class:"risk-card-header"},[(0,s.Lk)("h3",null,"Risk Trend Over Time")],-1)),(0,s.Lk)("div",Rpe,[o.riskTrendData.labels.length?((0,s.uX)(),(0,s.Wv)(c,{key:1,data:o.riskTrendData,options:o.riskTrendOptions},null,8,["data","options"])):((0,s.uX)(),(0,s.CE)("div",Ipe," No trend data available "))]),(0,s.Lk)("div",Dpe,[(0,s.Lk)("div",Ppe,[t[27]||(t[27]=(0,s.Lk)("span",{class:"risk-insight-label"},"Trend:",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["risk-insight-value",o.getTrendClass()])},(0,d.v_)(o.getTrendText()),3)])])]),(0,s.Lk)("div",_pe,[(0,s.Lk)("div",Ape,[t[32]||(t[32]=(0,s.Lk)("h3",null,"Custom Risk Analysis",-1)),(0,s.Lk)("div",Spe,[(0,s.Lk)("div",Tpe,[t[30]||(t[30]=(0,s.Lk)("label",null,"X-Axis",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[6]||(t[6]=e=>o.selectedXAxis=e),class:"risk-axis-select",onChange:t[7]||(t[7]=(...e)=>o.fetchCustomAnalysisData&&o.fetchCustomAnalysisData(...e))},t[29]||(t[29]=[(0,s.Fv)('<option value="time" data-v-fce55e70>Time</option><option value="category" data-v-fce55e70>Category</option><option value="priority" data-v-fce55e70>Risk Priority</option><option value="criticality" data-v-fce55e70>Criticality</option><option value="status" data-v-fce55e70>Status</option><option value="appetite" data-v-fce55e70>Risk Appetite</option><option value="mitigation" data-v-fce55e70>Mitigation Status</option>',7)]),544),[[a.u1,o.selectedXAxis]])]),(0,s.Lk)("div",xpe,[t[31]||(t[31]=(0,s.Lk)("label",null,"Y-Axis",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>o.selectedYAxis=e),class:"risk-axis-select",onChange:t[9]||(t[9]=(...e)=>o.fetchCustomAnalysisData&&o.fetchCustomAnalysisData(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.yAxisOptions,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.value,value:e.value},(0,d.v_)(e.label),9,Fpe))),128))],544),[[a.u1,o.selectedYAxis]])])])]),(0,s.Lk)("div",Vpe,[(0,s.Lk)("div",Upe,[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(["line","bar","doughnut"],e=>(0,s.Lk)("button",{key:e,class:(0,d.C4)(["risk-chart-tab-btn",{active:o.activeChart===e}]),onClick:t=>o.activeChart=e},[(0,s.Lk)("i",{class:(0,d.C4)(o.getChartIcon(e))},null,2)],10,Npe)),64))]),(0,s.Lk)("div",Mpe,[o.isLoadingCustomChart?((0,s.uX)(),(0,s.CE)("div",Xpe,t[33]||(t[33]=[(0,s.Lk)("div",{class:"loading-spinner"},null,-1),(0,s.Lk)("span",null,"Loading chart data...",-1)]))):o.hasCustomChartData?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},["line"===o.activeChart?((0,s.uX)(),(0,s.Wv)(c,{key:0,data:o.lineChartData,options:o.customChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"bar"===o.activeChart?((0,s.uX)(),(0,s.Wv)(u,{key:1,data:o.barChartData,options:o.customChartOptions},null,8,["data","options"])):(0,s.Q3)("",!0),"doughnut"===o.activeChart?((0,s.uX)(),(0,s.Wv)(r,{key:2,data:o.donutChartData,options:o.customDonutOptions},null,8,["data","options"])):(0,s.Q3)("",!0)],64)):((0,s.uX)(),(0,s.CE)("div",$pe," No data available for selected parameters "))])])])])])}Ze.t1.register(Ze.Bs,Ze.E8,Ze.PP,Ze.kc,Ze.FN,Ze.No,Ze.m_,Ze.s$);var jpe={name:"RiskDashboard",components:{Doughnut:et.nu,Bar:et.yP,LineChart:et.N1},setup(){console.log("=== RiskDashboard Component Debug ===");const e=(0,ie.KR)(!0),t=(0,ie.KR)("time"),i=(0,ie.KR)("performance");(0,s.wB)([t,i],([e,t])=>{o(e,t)});const a={Operational:{active:12,inactive:3,onhold:2},Compliance:{active:10,inactive:4,onhold:1},"IT Security":{active:8,inactive:6,onhold:2},Financial:{active:14,inactive:2,onhold:1},Strategic:{active:9,inactive:5,onhold:3}},o=(e,t)=>{const i=r(e);let s=c(t);if("categories"===e){const e=Object.values(a).reduce((e,t)=>e+t.active,0),t=Object.values(a).reduce((e,t)=>e+t.inactive,0),s=Object.values(a).reduce((e,t)=>e+t.onhold,0);return v.labels=["Active","Inactive","On Hold"],v.datasets[0].data=[e,t,s],v.datasets[0].backgroundColor=["#4ade80","#f87171","#fbbf24"],g.labels=i,g.datasets=[{label:"Active",data:i.map(e=>a[e]?.active||0),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Inactive",data:i.map(e=>a[e]?.inactive||0),backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4},{label:"On Hold",data:i.map(e=>a[e]?.onhold||0),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4}],p.labels=i,p.datasets[0].data=i.map(e=>a[e]?.active||0),void(p.datasets[0].label="Active")}if("status"===e){const e=["Active","Inactive","On Hold"],i=Object.values(a).reduce((e,t)=>e+t.active,0),s=Object.values(a).reduce((e,t)=>e+t.inactive,0),o=Object.values(a).reduce((e,t)=>e+t.onhold,0),n=[i,s,o];return v.labels=e,v.datasets[0].data=n,v.datasets[0].backgroundColor=["#4ade80","#f87171","#fbbf24"],g.labels=e,g.datasets=[{label:l(t),data:n,backgroundColor:["#4ade80","#f87171","#fbbf24"],borderRadius:4}],p.labels=e,p.datasets[0].data=n,void(p.datasets[0].label=l(t))}p.labels=i,p.datasets[0].data=s,p.datasets[0].label=l(t),g.labels=i,g.datasets=n(t),v.labels=i,v.datasets[0].data=s},l=e=>{const t={count:"Count",exposure:"Risk Exposure Rating",impact:"Risk Impact",likelihood:"Risk Likelihood",avgExposure:"Average Exposure",maxExposure:"Maximum Exposure",mitigated:"Mitigated Risks",avgImpact:"Average Impact",avgLikelihood:"Average Likelihood",responseTime:"Response Time (days)",mitigationTime:"Mitigation Time (days)",openRisks:"Open Risks",reviewCount:"Review Count",daysInStatus:"Days in Status",exposureByStatus:"Exposure by Status",acceptedRisks:"Accepted Risks",rejectedRisks:"Rejected Risks",mitigationCost:"Mitigation Cost",completedMitigations:"Completed Mitigations",pendingMitigations:"Pending Mitigations"};return t[e]||"Value"},n=e=>{const t=c(e);return[{label:"High",data:t.map(e=>Math.round(.4*e)),backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Medium",data:t.map(e=>Math.round(.35*e)),backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4},{label:"Low",data:t.map(e=>Math.round(.25*e)),backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4}]},r=e=>{switch(e){case"time":return["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];case"risks":return["Data Breach","Operational","Compliance","Financial","Strategic"];case"categories":return["Operational","Compliance","IT Security","Financial","Strategic"];case"status":return["Active","Inactive","On Hold"];default:return[]}},c=e=>{switch(e){case"performance":return[85,88,92,87,90,95,89];case"compliance":return[92,95,88,90,93,96,91];case"risk":return[65,70,68,72,75,80,78];default:return[]}},d=[{type:"line",icon:"fas fa-chart-line",label:"Line"},{type:"bar",icon:"fas fa-chart-bar",label:"Bar"},{type:"doughnut",icon:"fas fa-dot-circle",label:"Donut"}],u=(0,ie.KR)("line"),p=(0,ie.Kh)({labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],datasets:[{label:"Risk Performance",data:[42,38,35,40,56,75,82],fill:!1,borderColor:"#4f6cff",tension:.4,pointBackgroundColor:"#4f6cff",pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6}]}),m={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:10},padding:5}},x:{grid:{display:!1},ticks:{font:{size:10},padding:5}}},animation:{duration:1e3,easing:"easeOutQuart"},layout:{padding:0}},v=(0,ie.Kh)({labels:["Active","Inactive","On Hold"],datasets:[{data:[60,25,15],backgroundColor:["#4ade80","#f87171","#fbbf24"],borderWidth:0,hoverOffset:5}]}),k=(0,s.EW)(()=>{const e=z.datasets[0].data.reduce((e,t)=>e+t,0);return z.datasets[0].data.map(t=>e>0?Math.round(t/e*100):0)}),h={cutout:"65%",plugins:{legend:{display:!1},tooltip:{callbacks:{label:e=>{const t=z.labels[e.dataIndex],i=z.datasets[0].data[e.dataIndex],a=k.value[e.dataIndex];return`${t}: ${i} (${a}%)`}}},percentageLabels:{id:"percentageLabels",afterDraw:e=>{const t=e.ctx,i=e.data.datasets[0].data.reduce((e,t)=>e+t,0);e.data.datasets[0].data.forEach((a,s)=>{if(a>0){const o=Math.round(a/i*100),l=e.getDatasetMeta(0).data[s].x,n=e.getDatasetMeta(0).data[s].y,r=e.getDatasetMeta(0).data[s].outerRadius,c=e.getDatasetMeta(0).data[s].startAngle,d=e.getDatasetMeta(0).data[s].endAngle,u=c+(d-c)/2,p=.7*r,m=l+Math.cos(u)*p,v=n+Math.sin(u)*p;t.save(),t.translate(m,v),t.rotate(u+Math.PI/2),t.textAlign="center",t.textBaseline="middle",t.fillStyle="#ffffff",t.font="12px Arial",t.fillText(`${o}%`,0,0),t.restore()}})}}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutCubic"},layout:{padding:0}},g=(0,ie.Kh)({labels:["Operational","Compliance"],datasets:[{label:"Active",data:[8,5],backgroundColor:"#4ade80",stack:"Stack 0",borderRadius:4},{label:"Inactive",data:[6,7],backgroundColor:"#f87171",stack:"Stack 0",borderRadius:4},{label:"On Hold",data:[3,0],backgroundColor:"#fbbf24",stack:"Stack 0",borderRadius:4}]}),y={plugins:{legend:{display:!1}},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{color:"#222",font:{size:9},padding:5}},y:{stacked:!0,grid:{color:"rgba(0,0,0,0.05)"},ticks:{color:"#222",font:{size:9},padding:5}}},animation:{duration:800,easing:"easeInOutQuart"},layout:{padding:0}},f=()=>{e.value=!e.value},b=(0,ie.Kh)({total:0,accepted:0,rejected:0,mitigated:0,inProgress:0}),C=(0,ie.KR)(!0),L=async()=>{try{console.log("Fetching risk metrics with filters:",w);const e=new URLSearchParams({timeRange:w.timeRange,category:w.category,priority:w.priority}),a=await He.A.get(`http://localhost:8000/api/risk/metrics?${e}`);console.log("Received metrics data:",a.data),C.value=a.data.total>0,Object.assign(b,a.data),o(t.value,i.value)}catch(e){if(console.error("Error fetching risk metrics:",e),Tr.Ay.handleApiError(e))return;C.value=!1,Object.assign(b,{total:0,accepted:0,rejected:0,mitigated:0,inProgress:0})}},w=(0,ie.Kh)({timeRange:"6months",category:"all",priority:"all"}),E=(0,ie.KR)([{value:"30days",label:"Last 30 Days"},{value:"90days",label:"Last 90 Days"},{value:"6months",label:"Last 6 Months"},{value:"1year",label:"Last 1 Year"}]),R=(0,ie.KR)([{value:"all",label:"All Categories"}]),I=(0,ie.KR)([{value:"count",label:"Risk Count"},{value:"exposure",label:"Risk Exposure Rating"},{value:"impact",label:"Risk Impact"},{value:"likelihood",label:"Risk Likelihood"}]),D=async()=>{try{console.log("Fetching category options for dropdown...");const e=await He.A.get("http://localhost:8000/api/risk/categories-for-dropdown/");e.data&&"success"===e.data.status&&e.data.data&&(R.value=[{value:"all",label:"All Categories"},...e.data.data.map(e=>({value:e.id,label:e.value}))],console.log("Fetched category options:",R.value))}catch(e){console.error("Error fetching category options:",e),Tr.Ay.handleApiError(e,"view risk categories")}},P=async()=>{try{console.log("Fetching category distribution data...");const e=await He.A.get("http://localhost:8000/api/risk/metrics-by-category/");e.data&&e.data.categories&&(z.labels=e.data.categories.map(e=>e.category),z.datasets[0].data=e.data.categories.map(e=>e.count),z.datasets[0].backgroundColor=J(e.data.categories.length))}catch(e){if(console.error("Error fetching category distribution:",e),Tr.Ay.handleApiError(e))return}};(0,s.sV)(()=>{console.log("Component mounted, fetching initial data..."),S(),P(),L(),Y(),D()}),(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],P);const _=(0,ie.Kh)({labels:[],datasets:[{label:"Risk Count",data:[],borderColor:"#f87171",backgroundColor:"rgba(248, 113, 113, 0.1)",tension:.4,fill:!0,pointRadius:4,pointHoverRadius:6}]}),A={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)"},ticks:{stepSize:1}},x:{grid:{display:!1}}},plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#000",bodyColor:"#666",borderColor:"#ddd",borderWidth:1}},interaction:{mode:"nearest",axis:"x",intersect:!1}},S=async()=>{try{console.log("Fetching risk trend data...");const e=new URLSearchParams({timeRange:w.timeRange,category:w.category}),t=await He.A.get(`http://localhost:8000/api/risk/trend-over-time/?${e}`);console.log("Risk trend API response:",t.data),t.data&&(t.data.months&&Array.isArray(t.data.months)?(_.labels=t.data.months,t.data.trendData&&Array.isArray(t.data.trendData)?(_.datasets[0].data=t.data.trendData,console.log("Using trendData array:",t.data.trendData)):t.data.newRisks&&t.data.newRisks.data?(_.datasets[0].data=t.data.newRisks.data,console.log("Using newRisks.data array:",t.data.newRisks.data)):(console.warn("No valid trend data found in response"),_.datasets[0].data=[])):(console.warn("No valid months array found in response"),_.labels=[],_.datasets[0].data=[]))}catch(e){if(console.error("Error fetching risk trend data:",e),Tr.Ay.handleApiError(e))return;_.labels=[],_.datasets[0].data=[]}};(0,s.wB)([()=>w.timeRange,()=>w.category],()=>{console.log("\n=== Filter Change Detected ==="),console.log("New filter values:",{timeRange:w.timeRange,category:w.category}),S()});const T=(0,s.EW)(()=>{const e=z.datasets[0].data,t=z.labels;if(!e.length)return{name:"",percent:0};const i=Math.max(...e),a=e.indexOf(i),s=e.reduce((e,t)=>e+t,0),o=s>0?Math.round(i/s*100):0;return{name:t[a]||"",percent:o}}),x=()=>{const e=_.datasets[0]?.data||[];if(!e.length)return"No data";const t=e.length-1,i=t>0?t-1:0;return e[t]>e[i]?"Increasing ↑":e[t]<e[i]?"Decreasing ↓":"Stable →"},F=()=>{if(!_.datasets[0]?.data?.length)return"";const e=x();return e.includes("Increasing")?"positive":e.includes("Decreasing")?"negative":""},V=async()=>{try{const e=new URLSearchParams({timeRange:w.timeRange,category:w.category,priority:w.priority}),t=await He.A.get(`http://localhost:8000/api/risk/metrics-by-category?${e}`);if(t.data&&t.data.statusBreakdown){const e=Object.keys(t.data.statusBreakdown),i=e.map(e=>t.data.statusBreakdown[e]);z.labels=e,z.datasets[0].data=i}const i=await He.A.get(`http://localhost:8000/api/risk/identification-rate?${e}`);if(i.data&&i.data.months&&i.data.trendData){_.labels=i.data.months,_.datasets[0].data=i.data.trendData;const t=await He.A.get(`http://localhost:8000/api/risk/mitigation-completion-rate?${e}`);t.data&&t.data.trendData&&(_.datasets[0].data=t.data.trendData)}}catch(e){if(console.error("Error fetching specialized chart data:",e),Tr.Ay.handleApiError(e))return}};V(),(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],()=>{V()});const U=e=>{switch(e){case"line":return"fas fa-chart-line";case"bar":return"fas fa-chart-bar";case"doughnut":return"fas fa-chart-pie";default:return"fas fa-chart-line"}},N=(0,ie.KR)(null),M=async()=>{try{const e=w.timeRange||"30days";console.log(`Fetching mitigation cost data with period: ${e}`);const t="localhost"===window.location.hostname?"http://localhost:8000":"",i=new URLSearchParams({timeRange:e,category:w.category||"all",priority:w.priority||"all"}),a=await He.A.get(`${t}/api/risk/mitigation-cost/?${i}`);200===a.status?(console.log("Raw mitigation cost API response:",a.data),N.value=a.data,X()):console.error("Failed to fetch mitigation cost data:",a.status)}catch(e){if(console.error("Error fetching mitigation cost data:",e),Tr.Ay.handleApiError(e))return}},X=()=>{"bar"===u.value&&"mitigationCost"===i.value&&(g.labels=N.value.monthlyData.map(e=>e.month),g.datasets[0].data=N.value.monthlyData.map(e=>e.cost))};(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],()=>{console.log("Filters changed, updating data"),M(),V()});const $={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{font:{size:10},padding:5}},x:{grid:{display:!1},ticks:{font:{size:10},padding:5}}},animation:{duration:800,easing:"easeOutQuart"},layout:{padding:{top:30,right:8,bottom:8,left:8}}},O={cutout:"65%",plugins:{legend:{display:!1}},maintainAspectRatio:!1,animation:{animateRotate:!0,animateScale:!0,duration:800,easing:"easeOutCubic"},layout:{padding:{top:30,right:0,bottom:0,left:0}}},j=(0,ie.KR)(null),B=(0,ie.KR)(null),W=(0,ie.KR)([]),q=async()=>{try{console.log("Fetching heatmap data...");const e=await He.A.get("/api/risk/heatmap/");console.log("Received heatmap data:",e.data),W.value=e.data.heatmap_data,console.log("Total risks:",e.data.total_risks)}catch(e){console.error("Error fetching heatmap data:",e)}},Q=e=>0===e?"rgba(0, 104, 55, 0.7)":1===e?"rgba(26, 152, 80, 0.7)":2===e?"rgba(145, 207, 96, 0.7)":3===e?"rgba(217, 239, 139, 0.7)":4===e?"rgba(254, 224, 139, 0.7)":"rgba(215, 48, 39, 0.7)",K=()=>{if(!j.value)return void console.error("Canvas element not found");const e=j.value.getContext("2d");e?(B.value&&(B.value.destroy(),B.value=null),(0,s.dY)(()=>{const t=[],i=new Set;if(W.value&&Array.isArray(W.value)){W.value.forEach(e=>{e.forEach(e=>{e>0&&i.add(e)})}),console.log("Unique values found:",Array.from(i)),Array.from(i).sort((e,t)=>e-t).forEach(e=>{t.push({label:`Count: ${e}`,data:[],backgroundColor:Q(e),pointStyle:"square",pointRadius:15,pointHoverRadius:18})}),W.value.forEach((e,a)=>{e.forEach((e,s)=>{if(e>0){const o=Array.from(i).sort((e,t)=>e-t).indexOf(e);t[o].data.push({x:s+1,y:10-a})}})}),console.log("Prepared datasets:",t);try{B.value=new Ze.t1(e,{type:"scatter",data:{datasets:t},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"right",labels:{usePointStyle:!0,pointStyle:"square"}},tooltip:{callbacks:{label:e=>`Impact: ${11-e.raw.y}, Likelihood: ${e.raw.x}, ${e.dataset.label}`}}},scales:{x:{type:"linear",position:"bottom",min:.5,max:10.5,title:{display:!0,text:"Likelihood",font:{weight:"bold"}},ticks:{stepSize:1},grid:{display:!0,color:"#ddd"}},y:{type:"linear",min:.5,max:10.5,title:{display:!0,text:"Impact",font:{weight:"bold"}},ticks:{stepSize:1,callback:e=>11-Math.round(e)},grid:{display:!0,color:"#ddd"}}}}})}catch(a){console.error("Error creating chart:",a)}}else console.error("Invalid heatmap data:",W.value)})):console.error("Could not get canvas context")};(0,s.sV)(async()=>{console.log("Component mounted"),await q(),K()}),(0,s.wB)(W,()=>{console.log("Heatmap data changed, reinitializing chart"),K()});const J=e=>{const t=["#4ade80","#f87171","#fbbf24","#60a5fa","#818cf8","#f472b6","#a78bfa","#34d399","#fbbf24","#fb7185","#8b5cf6","#06b6d4","#10b981","#f59e0b","#ef4444"],i=[];for(let a=0;a<e;a++)i.push(t[a%t.length]);return i},z=(0,ie.Kh)({labels:[],datasets:[{data:[],backgroundColor:[],borderWidth:0,hoverOffset:5}]}),H=(0,ie.KR)(!1),G=(0,ie.KR)(!1),Y=async()=>{try{H.value=!0,G.value=!1,console.log("Fetching custom analysis data..."),console.log(`Parameters: x_axis=${t.value}, y_axis=${i.value}`);const e=new URLSearchParams({x_axis:t.value,y_axis:i.value,timeRange:w.timeRange,category:w.category,priority:w.priority}),a=await He.A.get(`http://localhost:8000/api/risk/custom-analysis/?${e}`);if(console.log("Received custom analysis data:",a.data),a.data&&a.data.labels&&a.data.datasets){const e=a.data.labels,t=a.data.datasets;if(p.labels=e,p.datasets=t.map(e=>({...e,fill:!1,tension:.4,pointBackgroundColor:e.backgroundColor,pointBorderColor:"#fff",pointBorderWidth:2,pointRadius:4,pointHoverRadius:6})),g.labels=e,g.datasets=t.map(e=>({...e,barPercentage:.7,categoryPercentage:.8})),v.labels=e,1===t.length)v.datasets[0].data=t[0].data,v.datasets[0].backgroundColor=t[0].data.map((e,i)=>J(t[0].data.length)[i]);else{const i=[];for(let a=0;a<e.length;a++){let e=0;for(const i of t)e+=i.data[a]||0;i.push(e)}v.datasets[0].data=i,v.datasets[0].backgroundColor=J(e.length)}G.value=!0}else console.warn("No valid custom analysis data found in response"),G.value=!1}catch(e){if(console.error("Error fetching custom analysis data:",e),Tr.Ay.handleApiError(e))return;G.value=!1}finally{H.value=!1}};(0,s.wB)([()=>w.timeRange,()=>w.category,()=>w.priority],()=>{Y()}),(0,s.wB)(u,()=>{(0,s.dY)(()=>{console.log("Chart type changed to:",u.value)})});const Z=(0,s.EW)(()=>z.labels.map((e,t)=>({label:e,value:z.datasets[0].data[t],color:z.datasets[0].backgroundColor[t]})).filter(e=>e.value>0));return{lineChartData:p,lineChartOptions:m,donutChartData:v,donutChartOptions:h,barChartData:g,barChartOptions:y,showRiskDetails:e,toggleRiskDetails:f,chartTypes:d,activeChart:u,selectedXAxis:t,selectedYAxis:i,metrics:b,filters:w,hasData:C,fetchRiskMetrics:L,categoryOptions:R,fetchCategoryOptions:D,fetchCategoryDistribution:P,categoryDistributionData:z,riskTrendData:_,highestCategory:T,getTrendText:x,getTrendClass:F,getChartIcon:U,fetchMitigationCostData:M,updateMitigationCostCharts:X,customChartOptions:$,customDonutOptions:O,heatmapCanvas:j,heatmapData:W,fetchHeatmapData:q,initializeHeatmap:K,generateChartColors:J,yAxisOptions:I,riskTrendOptions:A,fetchRiskTrendData:S,timeRangeOptions:E,isLoadingCustomChart:H,hasCustomChartData:G,fetchCustomAnalysisData:Y,filteredCategories:Z,categoryPercentages:k}}};const Bpe=(0,le.A)(jpe,[["render",Ope],["__scopeId","data-v-fce55e70"]]);var Wpe=Bpe;const qpe={class:"risk-instance-container"},Qpe={class:"risk-instance-filters-section"},Kpe={class:"risk-instance-search-row"},Jpe={class:"risk-instance-dropdowns-row"},zpe=["onClick"];function Hpe(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal"),r=(0,s.g2)("Dynamicalsearch"),c=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",qpe,[(0,s.bF)(n),t[6]||(t[6]=(0,s.Lk)("div",{class:"risk-instance-header-row"},[(0,s.Lk)("h2",{class:"risk-instance-title"},"Risk Instances")],-1)),(0,s.Lk)("div",Qpe,[(0,s.Lk)("div",Kpe,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>o.searchQuery=e),placeholder:"Search risk instances...",onInput:l.applyFilters},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",Jpe,[(0,s.bF)(c,{config:l.criticalityFilter,modelValue:o.selectedCriticality,"onUpdate:modelValue":t[1]||(t[1]=e=>o.selectedCriticality=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:l.statusFilter,modelValue:o.selectedStatus,"onUpdate:modelValue":t[2]||(t[2]=e=>o.selectedStatus=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:l.categoryFilter,modelValue:o.selectedCategory,"onUpdate:modelValue":t[3]||(t[3]=e=>o.selectedCategory=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:l.priorityFilter,modelValue:o.selectedPriority,"onUpdate:modelValue":t[4]||(t[4]=e=>o.selectedPriority=e),onChange:l.applyFilters},null,8,["config","modelValue","onChange"])])]),(0,s.bF)(u,{title:"",data:l.filteredInstances,columns:l.tableColumns,filters:[],"show-checkbox":!1,"show-actions":!0,"show-pagination":!0,"default-page-size":10,"unique-key":"RiskInstanceId",onRowSelect:l.handleRowSelect},{"cell-Origin":(0,s.k6)(()=>t[5]||(t[5]=[(0,s.Lk)("span",{class:"risk-instance-origin-badge"},"MANUAL",-1)])),"cell-RiskStatus":(0,s.k6)(({row:e})=>[(0,s.Lk)("span",null,(0,d.v_)(e.RiskStatus||"Open"),1)]),actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("button",{onClick:t=>l.viewInstanceDetails(e.RiskInstanceId),class:"risk-instance-view-btn"}," View Instance ",8,zpe)]),_:1},8,["data","columns","onRowSelect"])])}var Gpe={name:"RiskInstances",components:{DynamicTable:Hn.A,Dynamicalsearch:VG.A,CustomDropdown:xa.A,PopupModal:Ck.wA},data(){return{instances:[],selectedCriticality:"",selectedStatus:"",selectedCategory:"",selectedPriority:"",searchQuery:"",showAddForm:!1,newInstance:{RiskId:null,Criticality:"",PossibleDamage:"",Category:"",Appetite:"",RiskDescription:"",RiskLikelihood:"",RiskImpact:"",RiskExposureRating:"",RiskPriority:"",RiskResponseType:"",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Open",UserId:1}}},computed:{uniqueCriticality(){return[...new Set(this.instances.map(e=>e.Criticality).filter(Boolean))]},uniqueStatus(){return[...new Set(this.instances.map(e=>e.RiskStatus).filter(Boolean))]},uniqueCategory(){return[...new Set(this.instances.map(e=>e.Category).filter(Boolean))]},uniquePriority(){return[...new Set(this.instances.map(e=>e.RiskPriority).filter(Boolean))]},filteredInstances(){let e=this.instances.filter(e=>(!this.selectedCriticality||e.Criticality===this.selectedCriticality)&&(!this.selectedStatus||e.RiskStatus===this.selectedStatus)&&(!this.selectedCategory||e.Category===this.selectedCategory)&&(!this.selectedPriority||e.RiskPriority===this.selectedPriority));if(this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter(e=>e.RiskDescription&&e.RiskDescription.toLowerCase().includes(t)||e.RiskId&&e.RiskId.toString().includes(t)||e.Category&&e.Category.toLowerCase().includes(t)||e.RiskStatus&&e.RiskStatus.toLowerCase().includes(t)||e.Criticality&&e.Criticality.toLowerCase().includes(t))}return e.map(e=>({...e,Origin:"MANUAL",RiskId:e.RiskId||"N/A",Category:e.Category||"N/A",Criticality:e.Criticality||"Low",RiskStatus:e.RiskStatus||"Open",RiskDescription:e.RiskDescription||"No description available"}))},criticalityFilter(){return{name:"criticality",label:"Criticality",values:[{value:"",label:"All Criticality"},...this.uniqueCriticality.map(e=>({value:e,label:e}))],defaultValue:""}},statusFilter(){return{name:"status",label:"Status",values:[{value:"",label:"All Status"},...this.uniqueStatus.map(e=>({value:e,label:e}))],defaultValue:""}},categoryFilter(){return{name:"category",label:"Category",values:[{value:"",label:"All Category"},...this.uniqueCategory.map(e=>({value:e,label:e}))],defaultValue:""}},priorityFilter(){return{name:"priority",label:"Priority",values:[{value:"",label:"All Priority"},...this.uniquePriority.map(e=>({value:e,label:e}))],defaultValue:""}},tableColumns(){return[{key:"RiskId",label:"RISK ID",sortable:!0,headerClass:"risk-instance-id",cellClass:"risk-instance-id"},{key:"RiskDescription",label:"RISK DESCRIPTION",sortable:!0,cellClass:"risk-instance-description-cell"},{key:"Origin",label:"ORIGIN",sortable:!0,cellClass:"risk-instance-origin-cell"},{key:"Category",label:"CATEGORY",sortable:!0,cellClass:"risk-instance-category-cell"},{key:"Criticality",label:"CRITICALITY",sortable:!0,cellClass:"risk-instance-criticality-cell"},{key:"RiskStatus",label:"RISK STATUS",sortable:!0,cellClass:"risk-instance-status-cell",slot:!0}]}},mounted(){this.fetchInstances()},methods:{applyFilters(){},sanitizeQueryParams(e){const t={};for(const[i,a]of Object.entries(e))null!==a&&void 0!==a&&""!==a&&(t[i]=a);return t},fetchInstances(){He.A.get("http://localhost:8000/api/risk-instances").then(e=>{this.instances=e.data,console.log("Fetched risk instances:",this.instances.length)}).catch(e=>{console.error("Error fetching risk instances:",e),Tr.Ay.handleApiError(e,"view risk instances")||this.tryAlternativeEndpoint()})},tryAlternativeEndpoint(){console.log("Trying alternative endpoint..."),He.A.get("http://localhost:8000/api/risk-instances").then(e=>{this.instances=e.data,console.log("Fetched risk instances from alternative endpoint:",this.instances.length)}).catch(e=>{console.error("Error with alternative endpoint:",e)})},validateResponseData(e){return Array.isArray(e)?e:(console.error("Expected array response, got:",typeof e),[])},viewInstanceDetails(e){this.$router.push(`/view-instance/${e}`)},handleRowSelect(e){console.log("Row selected:",e)},async sendPushNotification(e){try{const t={title:"Risk Instance Update",message:e.message||`Risk instance "${e.RiskDescription||"Untitled Risk"}" has been updated in the Risk module.`,category:"risk",priority:"high",user_id:"default_user"},i=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});i.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},submitInstance(){const e={RiskId:parseInt(this.newInstance.RiskId)||null,Criticality:this.newInstance.Criticality,PossibleDamage:this.newInstance.PossibleDamage,Category:this.newInstance.Category,Appetite:this.newInstance.Appetite,RiskDescription:this.newInstance.RiskDescription,RiskLikelihood:parseFloat(this.newInstance.RiskLikelihood)||0,RiskImpact:parseFloat(this.newInstance.RiskImpact)||0,RiskExposureRating:this.newInstance.RiskExposureRating?parseFloat(this.newInstance.RiskExposureRating):null,RiskPriority:this.newInstance.RiskPriority,RiskResponseType:this.newInstance.RiskResponseType,RiskResponseDescription:this.newInstance.RiskResponseDescription,RiskMitigation:this.newInstance.RiskMitigation,RiskOwner:this.newInstance.RiskOwner,RiskStatus:this.newInstance.RiskStatus,UserId:parseInt(this.newInstance.UserId)||null};He.A.post("http://localhost:8000/api/risk-instances/",e).then(t=>{this.instances.push(t.data),this.newInstance={RiskId:null,Criticality:"",PossibleDamage:"",Category:"",Appetite:"",RiskDescription:"",RiskLikelihood:"",RiskImpact:"",RiskExposureRating:"",RiskPriority:"",RiskResponseType:"",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Open",UserId:1},this.showAddForm=!1,this.$popup.success("Risk instance added successfully!"),this.sendPushNotification({RiskDescription:e.RiskDescription,message:`A new risk instance "${e.RiskDescription||"Untitled Risk"}" has been created in the Risk module.`})}).catch(t=>{console.error("Error adding risk instance:",t.response?.data||t.message),Tr.Ay.handleApiError(t,"create risk instances")||(this.$popup.error("Error adding risk instance. Please check your data and try again."),this.sendPushNotification({RiskDescription:e.RiskDescription,message:`Failed to create risk instance "${e.RiskDescription||"Untitled Risk"}". Please check your data and try again.`}))})}}};const Ype=(0,le.A)(Gpe,[["render",Hpe]]);var Zpe=Ype;const eme={class:"risk-instance-container"},tme={class:"risk-instance-card"},ime={key:0,class:"validation-error-summary"},ame={class:"risk-instance-dropdown-container"},sme={key:0,class:"risk-instance-dropdown"},ome={class:"risk-instance-dropdown-search"},lme={key:0,class:"risk-instance-dropdown-list"},nme={key:1,class:"risk-instance-dropdown-list"},rme={key:2,class:"risk-instance-dropdown-list"},cme=["onClick"],dme={class:"risk-instance-item-checkbox"},ume=["id","checked","onClick"],pme={class:"risk-instance-item-content"},mme={class:"risk-instance-item-header"},vme={class:"risk-instance-id"},kme={class:"risk-instance-category"},hme={class:"risk-instance-item-title"},gme={class:"risk-instance-item-description"},yme={key:0,class:"risk-instance-item-damage"},fme={key:0,class:"validation-error-message"},bme={class:"form-section"},Cme=["value"],Lme={key:0,class:"validation-error-message"},wme={class:"form-group"},Eme={class:"risk-instance-category-container"},Rme={class:"risk-instance-category-dropdown"},Ime={key:0},Dme={key:1},Pme={key:0,class:"risk-instance-category-options"},_me={class:"risk-instance-category-search"},Ame={class:"risk-instance-category-list"},Sme=["onClick"],Tme=["checked","onClick"],xme=["value"],Fme={key:0,class:"validation-error-message"},Vme=["min","max","placeholder"],Ume={key:0,class:"validation-error-message"},Nme=["min","max","placeholder"],Mme={key:0,class:"validation-error-message"},Xme={class:"form-group"},$me=["value"],Ome={key:0,class:"validation-error-message"},jme=["value"],Bme={key:0,class:"validation-error-message"},Wme={class:"form-group"},qme={class:"risk-instance-user-dropdown-container"},Qme={key:0,class:"risk-instance-user-dropdown"},Kme={class:"risk-instance-user-dropdown-search"},Jme={key:0,class:"risk-instance-user-dropdown-list"},zme={key:1,class:"risk-instance-user-dropdown-list"},Hme={key:2,class:"risk-instance-user-dropdown-list"},Gme=["onClick"],Yme={class:"risk-instance-user-item-checkbox"},Zme=["id","checked","onClick"],eve={class:"risk-instance-user-item-content"},tve={class:"risk-instance-user-item-name"},ive={class:"form-group"},ave={key:0,class:"validation-error-message"},sve={class:"form-group"},ove={class:"risk-instance-business-impact-container"},lve={class:"risk-instance-business-impact-dropdown"},nve={key:0},rve={key:1},cve={key:0,class:"risk-instance-business-impact-options"},dve={class:"risk-instance-business-impact-header"},uve={class:"risk-instance-business-impact-search"},pve={class:"risk-instance-business-impact-list"},mve=["onClick"],vve=["checked","onClick"],kve={class:"risk-instance-selected-impacts-display"},hve=["onClick"],gve={class:"risk-instance-modal-form-group"},yve={class:"risk-instance-modal-actions"},fve=["disabled"],bve={class:"risk-instance-modal-form-group"},Cve={class:"risk-instance-modal-actions"},Lve=["disabled"],wve=["value"],Eve={key:0,class:"validation-error-message"},Rve={class:"form-group"},Ive={class:"risk-instance-compliance-dropdown-container"},Dve={key:0,class:"risk-instance-compliance-dropdown"},Pve={class:"risk-instance-compliance-dropdown-search"},_ve={key:0,class:"risk-instance-compliance-dropdown-list"},Ave={key:1,class:"risk-instance-compliance-dropdown-list"},Sve={key:2,class:"risk-instance-compliance-dropdown-list"},Tve=["onClick"],xve={class:"risk-instance-compliance-item-checkbox"},Fve=["id","checked","onClick"],Vve={class:"risk-instance-compliance-item-content"},Uve={class:"risk-instance-compliance-item-header"},Nve={class:"risk-instance-compliance-id"},Mve={class:"risk-instance-compliance-item-description"},Xve={key:0,class:"risk-instance-compliance-item-damage"},$ve=["value"],Ove={key:0,class:"validation-error-message"},jve={class:"form-section text-areas-section"},Bve={key:0,class:"validation-error-message"},Wve={key:0,class:"validation-error-message"},qve={key:0,class:"validation-error-message"},Qve={key:0,class:"validation-error-message"},Kve={class:"form-actions"};function Jve(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",eme,[(0,s.bF)(r),(0,s.Lk)("div",tme,[t[154]||(t[154]=(0,s.Lk)("div",{class:"risk-instance-title"}," Create Risk Instance ",-1)),n.activeValidationErrors.length>0?((0,s.uX)(),(0,s.CE)("div",ime,[t[88]||(t[88]=(0,s.Lk)("h4",null,"Please fix the following errors:",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.activeValidationErrors,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.field},(0,d.v_)(n.encodeForHTML(e.error)),1))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("form",{onSubmit:t[87]||(t[87]=(0,a.D$)((...e)=>n.submitInstance&&n.submitInstance(...e),["prevent"])),class:"risk-instance-form"},[(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskId}])},[t[93]||(t[93]=(0,s.Lk)("label",{for:"riskId"},[(0,s.Lk)("i",{class:"fas fa-id-badge"}),(0,s.eW)(" Risk ID")],-1)),(0,s.Lk)("div",ame,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"riskId","onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedRiskIdText=e),placeholder:"Enter or select risk ID",onFocus:t[1]||(t[1]=e=>l.showRiskDropdown=!0),readonly:"",class:(0,d.C4)({invalid:l.validationErrors.RiskId})},null,34),[[a.Jo,l.selectedRiskIdText]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-dropdown-toggle",onClick:t[2]||(t[2]=(...e)=>n.toggleRiskDropdown&&n.toggleRiskDropdown(...e))},t[89]||(t[89]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showRiskDropdown?((0,s.uX)(),(0,s.CE)("div",sme,[(0,s.Lk)("div",ome,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>l.riskSearchQuery=e),placeholder:"Search risks...",onInput:t[4]||(t[4]=(...e)=>n.filterRisks&&n.filterRisks(...e)),onClick:t[5]||(t[5]=(0,a.D$)(()=>{},["stop"]))},null,544),[[a.Jo,l.riskSearchQuery]])]),l.loadingRisks?((0,s.uX)(),(0,s.CE)("div",lme,t[90]||(t[90]=[(0,s.Lk)("div",{class:"loading-spinner"},"Loading risks...",-1)]))):0===l.filteredRisks.length?((0,s.uX)(),(0,s.CE)("div",nme,t[91]||(t[91]=[(0,s.Lk)("div",{class:"no-results"},"No risks found",-1)]))):((0,s.uX)(),(0,s.CE)("div",rme,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.validFilteredRisks,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.RiskId,class:"risk-instance-item",onClick:t=>n.selectRisk(e)},[(0,s.Lk)("div",dme,[(0,s.Lk)("input",{type:"checkbox",id:"risk-"+e.RiskId,checked:l.newInstance.RiskId===e.RiskId,onClick:(0,a.D$)(t=>n.selectRisk(e),["stop"])},null,8,ume)]),(0,s.Lk)("div",pme,[(0,s.Lk)("div",mme,[(0,s.Lk)("span",vme,"ID: "+(0,d.v_)(e.RiskId),1),(0,s.Lk)("span",{class:(0,d.C4)("risk-instance-criticality "+(e.Criticality||"unknown").toLowerCase())},(0,d.v_)(n.encodeForHTML(e.Criticality||"Unknown")),3),(0,s.Lk)("span",kme,(0,d.v_)(n.encodeForHTML(e.Category||"No Category")),1)]),(0,s.Lk)("div",hme,(0,d.v_)(n.encodeForHTML(e.RiskTitle||"No Title")),1),(0,s.Lk)("div",gme,(0,d.v_)(n.truncateText(e.RiskDescription,100)),1),e.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",yme,[t[92]||(t[92]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(n.truncateText(e.PossibleDamage,80)),1)])):(0,s.Q3)("",!0)])],8,cme))),128))]))])):(0,s.Q3)("",!0)]),l.validationErrors.RiskId?((0,s.uX)(),(0,s.CE)("span",fme,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskId)),1)):(0,s.Q3)("",!0),t[94]||(t[94]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Select the base risk template for this instance",-1))],2),(0,s.Lk)("div",bme,[(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.Criticality}])},[t[96]||(t[96]=(0,s.Lk)("label",{for:"criticality"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Criticality")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"criticality",class:(0,d.C4)(["priority-select",{invalid:l.validationErrors.Criticality}]),"onUpdate:modelValue":t[6]||(t[6]=e=>l.newInstance.Criticality=e),onFocus:t[7]||(t[7]=e=>n.handleFocus("criticality")),onBlur:t[8]||(t[8]=e=>n.handleBlur("criticality"))},[t[95]||(t[95]=(0,s.Lk)("option",{value:""},"Select Criticality",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_CRITICALITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,Cme))),128))],34),[[a.u1,l.newInstance.Criticality]]),l.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("span",Lme,(0,d.v_)(n.encodeForHTML(l.validationErrors.Criticality)),1)):(0,s.Q3)("",!0),t[97]||(t[97]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Choose the severity level for this risk instance",-1))],2),(0,s.Lk)("div",wme,[t[100]||(t[100]=(0,s.Lk)("label",{for:"category"},[(0,s.Lk)("i",{class:"fas fa-tag"}),(0,s.eW)(" Category")],-1)),(0,s.Lk)("div",Eme,[(0,s.Lk)("div",Rme,[(0,s.Lk)("div",{class:"risk-instance-selected-category",onClick:t[9]||(t[9]=(...e)=>n.toggleCategoryDropdown&&n.toggleCategoryDropdown(...e))},[l.selectedCategory?((0,s.uX)(),(0,s.CE)("span",Dme,(0,d.v_)(l.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",Ime,"Select Category")),t[98]||(t[98]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",Pme,[(0,s.Lk)("div",_me,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>l.categorySearch=e),placeholder:"Search categories...",onClick:t[11]||(t[11]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,l.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-add-category-btn",onClick:t[12]||(t[12]=(0,a.D$)(e=>l.showAddCategoryModal=!0,["stop","prevent"]))},t[99]||(t[99]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",Ame,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-instance-category-item",onClick:(0,a.D$)(t=>n.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:l.selectedCategory===e.value,onClick:(0,a.D$)(t=>n.selectCategory(e),["stop"])},null,8,Tme),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Sme))),128))])])):(0,s.Q3)("",!0)])]),t[101]||(t[101]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Categorize this risk instance for better organization",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.Appetite}])},[t[102]||(t[102]=(0,s.Lk)("label",{for:"appetite"},[(0,s.Lk)("i",{class:"fas fa-balance-scale"}),(0,s.eW)(" Appetite")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"appetite","onUpdate:modelValue":t[13]||(t[13]=e=>l.newInstance.Appetite=e),onFocus:t[14]||(t[14]=e=>n.handleFocus("appetite")),onBlur:t[15]||(t[15]=e=>n.handleBlur("appetite")),onChange:t[16]||(t[16]=e=>n.onAppetiteChange()),class:(0,d.C4)({invalid:l.validationErrors.Appetite})},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_APPETITE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,xme))),128))],34),[[a.u1,l.newInstance.Appetite]]),l.validationErrors.Appetite?((0,s.uX)(),(0,s.CE)("span",Fme,(0,d.v_)(n.encodeForHTML(l.validationErrors.Appetite)),1)):(0,s.Q3)("",!0),t[103]||(t[103]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Indicate if the organization accepts this risk level",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskLikelihood}])},[t[104]||(t[104]=(0,s.Lk)("label",{for:"riskLikelihood"},[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)(" Risk Likelihood")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",step:"1",min:l.validationRules.RISK_LIKELIHOOD_RANGE.min,max:l.validationRules.RISK_LIKELIHOOD_RANGE.max,id:"riskLikelihood","onUpdate:modelValue":t[17]||(t[17]=e=>l.newInstance.RiskLikelihood=e),placeholder:`Enter value (${l.validationRules.RISK_LIKELIHOOD_RANGE.min}-${l.validationRules.RISK_LIKELIHOOD_RANGE.max})`,onFocus:t[18]||(t[18]=e=>n.handleFocus("riskLikelihood")),onBlur:t[19]||(t[19]=e=>n.handleBlur("riskLikelihood")),onInput:t[20]||(t[20]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e)),class:(0,d.C4)({invalid:l.validationErrors.RiskLikelihood})},null,42,Vme),[[a.Jo,l.newInstance.RiskLikelihood,void 0,{number:!0}]]),l.validationErrors.RiskLikelihood?((0,s.uX)(),(0,s.CE)("span",Ume,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskLikelihood)),1)):(0,s.Q3)("",!0),t[105]||(t[105]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskImpact}])},[t[106]||(t[106]=(0,s.Lk)("label",{for:"riskImpact"},[(0,s.Lk)("i",{class:"fas fa-bolt"}),(0,s.eW)(" Risk Impact")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",step:"1",min:l.validationRules.RISK_IMPACT_RANGE.min,max:l.validationRules.RISK_IMPACT_RANGE.max,id:"riskImpact","onUpdate:modelValue":t[21]||(t[21]=e=>l.newInstance.RiskImpact=e),placeholder:`Enter value (${l.validationRules.RISK_IMPACT_RANGE.min}-${l.validationRules.RISK_IMPACT_RANGE.max})`,onFocus:t[22]||(t[22]=e=>n.handleFocus("riskImpact")),onBlur:t[23]||(t[23]=e=>n.handleBlur("riskImpact")),onInput:t[24]||(t[24]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e)),class:(0,d.C4)({invalid:l.validationErrors.RiskImpact})},null,42,Nme),[[a.Jo,l.newInstance.RiskImpact,void 0,{number:!0}]]),l.validationErrors.RiskImpact?((0,s.uX)(),(0,s.CE)("span",Mme,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskImpact)),1)):(0,s.Q3)("",!0),t[107]||(t[107]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)",-1))],2),(0,s.Lk)("div",Xme,[t[108]||(t[108]=(0,s.Lk)("label",{for:"riskExposureRating"},[(0,s.Lk)("i",{class:"fas fa-thermometer-half"}),(0,s.eW)(" Risk Exposure Rating (Likelihood × Impact)")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",readonly:"",id:"riskExposureRating","onUpdate:modelValue":t[25]||(t[25]=e=>l.newInstance.RiskExposureRating=e),class:"readonly-input",onFocus:t[26]||(t[26]=e=>n.handleFocus("riskExposureRating")),onBlur:t[27]||(t[27]=e=>n.handleBlur("riskExposureRating"))},null,544),[[a.Jo,l.newInstance.RiskExposureRating,void 0,{number:!0}]]),t[109]||(t[109]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Automatically calculated as Likelihood × Impact",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskPriority}])},[t[111]||(t[111]=(0,s.Lk)("label",{for:"riskPriority"},[(0,s.Lk)("i",{class:"fas fa-flag"}),(0,s.eW)(" Risk Priority")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskPriority",class:(0,d.C4)(["priority-select",{invalid:l.validationErrors.RiskPriority}]),"onUpdate:modelValue":t[28]||(t[28]=e=>l.newInstance.RiskPriority=e),onFocus:t[29]||(t[29]=e=>n.handleFocus("riskPriority")),onBlur:t[30]||(t[30]=e=>n.handleBlur("riskPriority"))},[t[110]||(t[110]=(0,s.Lk)("option",{value:""},"Select Priority",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_PRIORITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,$me))),128))],34),[[a.u1,l.newInstance.RiskPriority]]),l.validationErrors.RiskPriority?((0,s.uX)(),(0,s.CE)("span",Ome,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskPriority)),1)):(0,s.Q3)("",!0),t[112]||(t[112]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Set the priority level for risk treatment",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskResponseType}])},[t[114]||(t[114]=(0,s.Lk)("label",{for:"riskResponseType"},[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Response Type")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskResponseType","onUpdate:modelValue":t[31]||(t[31]=e=>l.newInstance.RiskResponseType=e),onFocus:t[32]||(t[32]=e=>n.handleFocus("riskResponseType")),onBlur:t[33]||(t[33]=e=>n.handleBlur("riskResponseType")),class:(0,d.C4)({invalid:l.validationErrors.RiskResponseType})},[t[113]||(t[113]=(0,s.Lk)("option",{value:""},"Select Response Type",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_RESPONSE_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,jme))),128))],34),[[a.u1,l.newInstance.RiskResponseType]]),l.validationErrors.RiskResponseType?((0,s.uX)(),(0,s.CE)("span",Bme,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskResponseType)),1)):(0,s.Q3)("",!0),t[115]||(t[115]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Choose how to respond to this risk",-1))],2),(0,s.Lk)("div",Wme,[t[119]||(t[119]=(0,s.Lk)("label",{for:"riskOwner"},[(0,s.Lk)("i",{class:"fas fa-user"}),(0,s.eW)(" Risk Owner")],-1)),(0,s.Lk)("div",qme,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"riskOwner","onUpdate:modelValue":t[34]||(t[34]=e=>l.selectedOwnerText=e),placeholder:"Select risk owner",onFocus:t[35]||(t[35]=e=>l.showUserDropdown=!0),readonly:""},null,544),[[a.Jo,l.selectedOwnerText]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-dropdown-toggle",onClick:t[36]||(t[36]=(...e)=>n.toggleUserDropdown&&n.toggleUserDropdown(...e))},t[116]||(t[116]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showUserDropdown?((0,s.uX)(),(0,s.CE)("div",Qme,[(0,s.Lk)("div",Kme,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[37]||(t[37]=e=>l.userSearchQuery=e),placeholder:"Search users...",onInput:t[38]||(t[38]=(...e)=>n.filterUsers&&n.filterUsers(...e)),onClick:t[39]||(t[39]=(0,a.D$)(()=>{},["stop"]))},null,544),[[a.Jo,l.userSearchQuery]])]),l.loadingUsers?((0,s.uX)(),(0,s.CE)("div",Jme,t[117]||(t[117]=[(0,s.Lk)("div",{class:"loading-spinner"},"Loading users...",-1)]))):0===l.filteredUsers.length?((0,s.uX)(),(0,s.CE)("div",zme,t[118]||(t[118]=[(0,s.Lk)("div",{class:"no-results"},"No users found",-1)]))):((0,s.uX)(),(0,s.CE)("div",Hme,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredUsers,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.UserId,class:"risk-instance-user-item",onClick:t=>n.selectUser(e)},[(0,s.Lk)("div",Yme,[(0,s.Lk)("input",{type:"checkbox",id:"user-"+e.UserId,checked:l.newInstance.RiskOwner===e.UserName,onClick:(0,a.D$)(t=>n.selectUser(e),["stop"])},null,8,Zme)]),(0,s.Lk)("div",eve,[(0,s.Lk)("div",tve,(0,d.v_)(e.UserName),1)])],8,Gme))),128))]))])):(0,s.Q3)("",!0)]),t[120]||(t[120]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Assign responsibility for managing this risk",-1))]),(0,s.Lk)("div",ive,[t[122]||(t[122]=(0,s.Lk)("label",{for:"riskStatus"},[(0,s.Lk)("i",{class:"fas fa-info-circle"}),(0,s.eW)(" Risk Status")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskStatus","onUpdate:modelValue":t[40]||(t[40]=e=>l.newInstance.RiskStatus=e),onFocus:t[41]||(t[41]=e=>n.handleFocus("riskStatus")),onBlur:t[42]||(t[42]=e=>n.handleBlur("riskStatus"))},t[121]||(t[121]=[(0,s.Lk)("option",{value:"Not Assigned"},"Not Assigned",-1),(0,s.Lk)("option",{value:"Assigned"},"Assigned",-1),(0,s.Lk)("option",{value:"Approved"},"Approved",-1),(0,s.Lk)("option",{value:"Rejected"},"Rejected",-1)]),544),[[a.u1,l.newInstance.RiskStatus]]),t[123]||(t[123]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Current status of this risk instance",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskTitle}])},[t[124]||(t[124]=(0,s.Lk)("label",{for:"riskTitle"},[(0,s.Lk)("i",{class:"fas fa-heading"}),(0,s.eW)(" Risk Title")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"riskTitle","onUpdate:modelValue":t[43]||(t[43]=e=>l.newInstance.RiskTitle=e),placeholder:"Enter risk title",class:(0,d.C4)({invalid:l.validationErrors.RiskTitle}),onFocus:t[44]||(t[44]=e=>n.handleFocus("riskTitle")),onBlur:t[45]||(t[45]=e=>n.handleBlur("riskTitle"))},null,34),[[a.Jo,l.newInstance.RiskTitle]]),l.validationErrors.RiskTitle?((0,s.uX)(),(0,s.CE)("span",ave,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskTitle)),1)):(0,s.Q3)("",!0),t[125]||(t[125]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Provide a clear, descriptive title for this risk instance",-1))],2),(0,s.Lk)("div",sve,[t[128]||(t[128]=(0,s.Lk)("label",{for:"businessImpact"},[(0,s.Lk)("i",{class:"fas fa-briefcase"}),(0,s.eW)(" Business Impact")],-1)),(0,s.Lk)("div",ove,[(0,s.Lk)("div",lve,[(0,s.Lk)("div",{class:"risk-instance-selected-impacts",onClick:t[46]||(t[46]=(...e)=>n.toggleBusinessImpactDropdown&&n.toggleBusinessImpactDropdown(...e))},[0===l.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",nve,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",rve,(0,d.v_)(l.selectedBusinessImpacts.length)+" impact(s) selected",1)),t[126]||(t[126]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",cve,[(0,s.Lk)("div",dve,[(0,s.Lk)("div",uve,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[47]||(t[47]=e=>l.businessImpactSearch=e),placeholder:"Search impacts...",onClick:t[48]||(t[48]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,l.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-add-impact-btn",onClick:t[49]||(t[49]=(0,a.D$)(e=>l.showAddImpactModal=!0,["stop","prevent"]))},t[127]||(t[127]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))])]),(0,s.Lk)("div",pve,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-instance-business-impact-item",onClick:(0,a.D$)(t=>n.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",checked:n.isBusinessImpactSelected(e),onClick:(0,a.D$)(t=>n.toggleBusinessImpact(e),["stop"])},null,8,vve),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,mve))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",kve,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-instance-selected-impact-tag"},[(0,s.eW)((0,d.v_)(n.encodeForHTML(e.value))+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:t=>n.toggleBusinessImpact(e)},null,8,hve)]))),128))])]),t[129]||(t[129]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Select the business areas that would be affected by this risk",-1))]),l.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"risk-instance-modal-overlay",onClick:t[55]||(t[55]=(0,a.D$)(e=>l.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-instance-modal-content",onClick:t[54]||(t[54]=(0,a.D$)(()=>{},["stop"]))},[t[131]||(t[131]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:t[53]||(t[53]=(0,a.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"])),class:"risk-instance-modal-form"},[(0,s.Lk)("div",gve,[t[130]||(t[130]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[50]||(t[50]=e=>l.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:t[51]||(t[51]=(0,a.jR)((0,a.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,l.newBusinessImpact]])]),(0,s.Lk)("div",yve,[(0,s.Lk)("button",{type:"button",class:"risk-instance-cancel-btn",onClick:t[52]||(t[52]=(0,a.D$)(e=>l.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-instance-add-btn",disabled:!l.newBusinessImpact.trim()}," Add ",8,fve)])],32)])])):(0,s.Q3)("",!0),l.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"risk-instance-modal-overlay",onClick:t[61]||(t[61]=(0,a.D$)(e=>l.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-instance-modal-content",onClick:t[60]||(t[60]=(0,a.D$)(()=>{},["stop"]))},[t[133]||(t[133]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:t[59]||(t[59]=(0,a.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"])),class:"risk-instance-modal-form"},[(0,s.Lk)("div",bve,[t[132]||(t[132]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[56]||(t[56]=e=>l.newCategory=e),placeholder:"Enter new category",onKeyup:t[57]||(t[57]=(0,a.jR)((0,a.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,l.newCategory]])]),(0,s.Lk)("div",Cve,[(0,s.Lk)("button",{type:"button",class:"risk-instance-cancel-btn",onClick:t[58]||(t[58]=(0,a.D$)(e=>l.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-instance-add-btn",disabled:!l.newCategory.trim()}," Add Category ",8,Lve)])],32)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.Origin}])},[t[135]||(t[135]=(0,s.Lk)("label",{for:"origin"},[(0,s.Lk)("i",{class:"fas fa-globe"}),(0,s.eW)(" Origin")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"origin","onUpdate:modelValue":t[62]||(t[62]=e=>l.newInstance.Origin=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Origin}]),onFocus:t[63]||(t[63]=e=>n.handleFocus("origin")),onBlur:t[64]||(t[64]=e=>n.handleBlur("origin"))},[t[134]||(t[134]=(0,s.Lk)("option",{value:""},"Select Origin",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_ORIGIN,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,wve))),128))],34),[[a.u1,l.newInstance.Origin]]),l.validationErrors.Origin?((0,s.uX)(),(0,s.CE)("span",Eve,(0,d.v_)(n.encodeForHTML(l.validationErrors.Origin)),1)):(0,s.Q3)("",!0),t[136]||(t[136]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Source of this risk instance (Manual, SIEM, Audit Findings)",-1))],2),(0,s.Lk)("div",Rve,[t[141]||(t[141]=(0,s.Lk)("label",{for:"complianceId"},[(0,s.Lk)("i",{class:"fas fa-hashtag"}),(0,s.eW)(" Compliance ID")],-1)),(0,s.Lk)("div",Ive,[(0,s.bo)((0,s.Lk)("input",{type:"text",id:"complianceId","onUpdate:modelValue":t[65]||(t[65]=e=>l.selectedComplianceIdText=e),placeholder:"Enter or select compliance ID",onFocus:t[66]||(t[66]=e=>l.showComplianceDropdown=!0),readonly:""},null,544),[[a.Jo,l.selectedComplianceIdText]]),(0,s.Lk)("button",{type:"button",class:"risk-instance-dropdown-toggle",onClick:t[67]||(t[67]=(...e)=>n.toggleComplianceDropdown&&n.toggleComplianceDropdown(...e))},t[137]||(t[137]=[(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1)])),l.showComplianceDropdown?((0,s.uX)(),(0,s.CE)("div",Dve,[(0,s.Lk)("div",Pve,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[68]||(t[68]=e=>l.complianceSearchQuery=e),placeholder:"Search compliances...",onInput:t[69]||(t[69]=(...e)=>n.filterCompliances&&n.filterCompliances(...e)),onClick:t[70]||(t[70]=(0,a.D$)(()=>{},["stop"]))},null,544),[[a.Jo,l.complianceSearchQuery]])]),l.loadingCompliances?((0,s.uX)(),(0,s.CE)("div",_ve,t[138]||(t[138]=[(0,s.Lk)("div",{class:"loading-spinner"},"Loading compliances...",-1)]))):0===l.filteredCompliances.length?((0,s.uX)(),(0,s.CE)("div",Ave,t[139]||(t[139]=[(0,s.Lk)("div",{class:"no-results"},"No compliances found",-1)]))):((0,s.uX)(),(0,s.CE)("div",Sve,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.filteredCompliances,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.ComplianceId,class:"risk-instance-compliance-item",onClick:t=>n.selectCompliance(e)},[(0,s.Lk)("div",xve,[(0,s.Lk)("input",{type:"checkbox",id:"compliance-"+e.ComplianceId,checked:l.newInstance.ComplianceId===e.ComplianceId,onClick:(0,a.D$)(t=>n.selectCompliance(e),["stop"])},null,8,Fve)]),(0,s.Lk)("div",Vve,[(0,s.Lk)("div",Uve,[(0,s.Lk)("span",Nve,"ID: "+(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("span",{class:(0,d.C4)("risk-instance-compliance-criticality "+(e.Criticality?e.Criticality.toLowerCase():""))},(0,d.v_)(n.encodeForHTML(e.Criticality||"No Criticality")),3)]),(0,s.Lk)("div",Mve,(0,d.v_)(n.truncateText(e.ComplianceItemDescription,100)||"No description available"),1),e.PossibleDamage?((0,s.uX)(),(0,s.CE)("div",Xve,[t[140]||(t[140]=(0,s.Lk)("strong",null,"Possible Damage:",-1)),(0,s.eW)(" "+(0,d.v_)(n.truncateText(e.PossibleDamage,80)),1)])):(0,s.Q3)("",!0)])],8,Tve))),128))]))])):(0,s.Q3)("",!0)]),t[142]||(t[142]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Link this risk instance to a specific compliance requirement",-1))]),(0,s.Lk)("div",{class:(0,d.C4)(["form-group",{"has-error":l.validationErrors.RiskType}])},[t[143]||(t[143]=(0,s.Lk)("label",{for:"riskType"},[(0,s.Lk)("i",{class:"fas fa-cubes"}),(0,s.eW)(" Risk Type")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"riskType","onUpdate:modelValue":t[71]||(t[71]=e=>l.newInstance.RiskType=e),onFocus:t[72]||(t[72]=e=>n.handleFocus("riskType")),onBlur:t[73]||(t[73]=e=>n.handleBlur("riskType")),class:(0,d.C4)({invalid:l.validationErrors.RiskType})},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,$ve))),128))],34),[[a.u1,l.newInstance.RiskType]]),l.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("span",Ove,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskType)),1)):(0,s.Q3)("",!0),t[144]||(t[144]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Classify the nature and timing of this risk",-1))],2)]),(0,s.Lk)("div",jve,[(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskDescription}])},[t[145]||(t[145]=(0,s.Lk)("label",{for:"riskDescription"},[(0,s.Lk)("i",{class:"fas fa-align-left"}),(0,s.eW)(" Risk Description")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"riskDescription","onUpdate:modelValue":t[74]||(t[74]=e=>l.newInstance.RiskDescription=e),placeholder:"Describe the risk...",rows:"3",class:(0,d.C4)({invalid:l.validationErrors.RiskDescription}),onFocus:t[75]||(t[75]=e=>n.handleFocus("riskDescription")),onBlur:t[76]||(t[76]=e=>n.handleBlur("riskDescription"))},null,34),[[a.Jo,l.newInstance.RiskDescription]]),l.validationErrors.RiskDescription?((0,s.uX)(),(0,s.CE)("span",Bve,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskDescription)),1)):(0,s.Q3)("",!0),t[146]||(t[146]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Provide a detailed description of this specific risk instance",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.PossibleDamage}])},[t[147]||(t[147]=(0,s.Lk)("label",{for:"possibleDamage"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Possible Damage")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"possibleDamage","onUpdate:modelValue":t[77]||(t[77]=e=>l.newInstance.PossibleDamage=e),placeholder:"Describe possible damage...",rows:"2",class:(0,d.C4)({invalid:l.validationErrors.PossibleDamage}),onFocus:t[78]||(t[78]=e=>n.handleFocus("possibleDamage")),onBlur:t[79]||(t[79]=e=>n.handleBlur("possibleDamage"))},null,34),[[a.Jo,l.newInstance.PossibleDamage]]),l.validationErrors.PossibleDamage?((0,s.uX)(),(0,s.CE)("span",Wve,(0,d.v_)(n.encodeForHTML(l.validationErrors.PossibleDamage)),1)):(0,s.Q3)("",!0),t[148]||(t[148]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Detail the potential consequences and damage if this risk materializes",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskResponseDescription}])},[t[149]||(t[149]=(0,s.Lk)("label",{for:"riskResponseDescription"},[(0,s.Lk)("i",{class:"fas fa-reply"}),(0,s.eW)(" Response Description")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"riskResponseDescription","onUpdate:modelValue":t[80]||(t[80]=e=>l.newInstance.RiskResponseDescription=e),placeholder:"Describe the response strategy...",rows:"2",class:(0,d.C4)({invalid:l.validationErrors.RiskResponseDescription}),onFocus:t[81]||(t[81]=e=>n.handleFocus("riskResponseDescription")),onBlur:t[82]||(t[82]=e=>n.handleBlur("riskResponseDescription"))},null,34),[[a.Jo,l.newInstance.RiskResponseDescription]]),l.validationErrors.RiskResponseDescription?((0,s.uX)(),(0,s.CE)("span",qve,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskResponseDescription)),1)):(0,s.Q3)("",!0),t[150]||(t[150]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Describe the specific response strategy for this risk instance",-1))],2),(0,s.Lk)("div",{class:(0,d.C4)(["form-group field-full",{"has-error":l.validationErrors.RiskMitigation}])},[t[151]||(t[151]=(0,s.Lk)("label",{for:"riskMitigation"},[(0,s.Lk)("i",{class:"fas fa-shield-virus"}),(0,s.eW)(" Risk Mitigation")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"riskMitigation","onUpdate:modelValue":t[83]||(t[83]=e=>l.newInstance.RiskMitigation=e),placeholder:"Describe mitigation actions...",rows:"2",class:(0,d.C4)({invalid:l.validationErrors.RiskMitigation}),onFocus:t[84]||(t[84]=e=>n.handleFocus("riskMitigation")),onBlur:t[85]||(t[85]=e=>n.handleBlur("riskMitigation"))},null,34),[[a.Jo,l.newInstance.RiskMitigation]]),l.validationErrors.RiskMitigation?((0,s.uX)(),(0,s.CE)("span",Qve,(0,d.v_)(n.encodeForHTML(l.validationErrors.RiskMitigation)),1)):(0,s.Q3)("",!0),t[152]||(t[152]=(0,s.Lk)("div",{class:"risk-instance-helper-text"},"Outline specific mitigation strategies and controls for this risk",-1))],2)]),(0,s.Lk)("div",Kve,[(0,s.Lk)("button",{type:"button",class:"risk-instance-btn-cancel",onClick:t[86]||(t[86]=(...e)=>n.resetForm&&n.resetForm(...e))},"Clear"),t[153]||(t[153]=(0,s.Lk)("button",{type:"submit",class:"risk-instance-btn-submit"},"Create",-1))])],32)])])}var zve={name:"CreateRiskInstance",components:{PopupModal:Ck.wA},props:{riskId:{type:[String,Number],default:null},incidentId:{type:[String,Number],default:null}},data(){return{validationRules:{ALLOWED_CRITICALITY:["Critical","High","Medium","Low"],ALLOWED_RISK_PRIORITY:["High","Medium","Low"],ALLOWED_ORIGIN:["Manual","SIEM","AuditFindings"],ALLOWED_RISK_TYPE:["Current","Residual","Inherent","Emerging","Accept"],ALLOWED_APPETITE:["Yes","No"],ALLOWED_RISK_RESPONSE_TYPE:["Mitigate","Avoid","Accept","Transfer"],RISK_LIKELIHOOD_RANGE:{min:1,max:10},RISK_IMPACT_RANGE:{min:1,max:10},TEXT_PATTERN:/^[A-Za-z0-9\s.,;:!?'"()\-_[\]]{0,}$/},validationErrors:{Criticality:"",RiskPriority:"",Origin:"",RiskType:"",Appetite:"",RiskResponseType:"",RiskLikelihood:"",RiskImpact:"",RiskTitle:"",RiskDescription:"",PossibleDamage:"",RiskResponseDescription:"",RiskMitigation:""},newInstance:{Criticality:"",PossibleDamage:"",Category:"",Appetite:"Yes",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskResponseType:"Mitigation",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Not Assigned",UserId:1,RiskId:null,IncidentId:null,RiskTitle:"",BusinessImpact:"",Origin:"",MitigationDueDate:null,MitigationStatus:null,MitigationCompletedDate:null,ReviewerCount:null,RecurrenceCount:1,RiskFormDetails:null,ModifiedMitigations:null,ComplianceId:"",RiskType:"Current"},businessImpacts:[],selectedBusinessImpacts:[],showBusinessImpactDropdown:!1,businessImpactSearch:"",showAddImpactModal:!1,newBusinessImpact:"",categories:[],selectedCategory:"",showCategoryDropdown:!1,categorySearch:"",showAddCategoryModal:!1,newCategory:"",risks:[],filteredRisks:[],riskSearchQuery:"",showRiskDropdown:!1,loadingRisks:!1,selectedRiskIdText:"",isDebugging:!1,testResults:[],selectedOwnerText:"",showUserDropdown:!1,loadingUsers:!1,userSearchQuery:"",filteredUsers:[],users:[],selectedComplianceIdText:"",showComplianceDropdown:!1,loadingCompliances:!1,complianceSearchQuery:"",filteredCompliances:[],compliances:[]}},computed:{validFilteredRisks(){return this.filteredRisks.filter(e=>e&&e.RiskId)},filteredBusinessImpacts(){if(!this.businessImpactSearch)return this.businessImpacts;const e=this.businessImpactSearch.toLowerCase();return this.businessImpacts.filter(t=>t.value.toLowerCase().includes(e))},filteredCategories(){if(!this.categorySearch)return this.categories;const e=this.categorySearch.toLowerCase();return this.categories.filter(t=>t.value.toLowerCase().includes(e))},activeValidationErrors(){return Object.entries(this.validationErrors).filter(e=>e[1]).map(([e,t])=>({field:e,error:t}))}},mounted(){this.calculateRiskExposureRating(),null!==this.riskId&&void 0!==this.riskId?(this.newInstance.RiskId=this.riskId,this.updateSelectedRiskIdText()):this.$route.query.riskId&&(this.newInstance.RiskId=this.$route.query.riskId,this.updateSelectedRiskIdText()),null!==this.incidentId&&void 0!==this.incidentId?this.newInstance.IncidentId=this.incidentId:this.$route.query.incidentId&&(this.newInstance.IncidentId=this.$route.query.incidentId),this.fetchRisks(),this.fetchUsers(),this.fetchCompliances(),this.fetchBusinessImpacts(),this.fetchCategories(),document.addEventListener("click",this.closeRiskDropdown),document.addEventListener("click",this.closeUserDropdown),document.addEventListener("click",this.closeComplianceDropdown),document.addEventListener("click",this.closeBusinessImpactDropdown),console.log("CreateRiskInstance mounted with:",{riskId:this.newInstance.RiskId,incidentId:this.newInstance.IncidentId})},beforeUnmount(){document.removeEventListener("click",this.closeRiskDropdown),document.removeEventListener("click",this.closeUserDropdown),document.removeEventListener("click",this.closeComplianceDropdown),document.removeEventListener("click",this.closeBusinessImpactDropdown)},methods:{fetchRisks(){this.loadingRisks=!0;const e="http://127.0.0.1:8000/api/risks-for-dropdown/",t={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}};fetch(e,t).then(e=>{if(!e.ok)throw new Error(`API Error: ${e.status}`);return e.json()}).then(e=>{this.risks=(e||[]).filter(e=>e&&e.RiskId),this.filteredRisks=[...this.risks],this.loadingRisks=!1,this.newInstance.RiskId&&this.updateSelectedRiskIdText()}).catch(e=>{console.error("Error fetching risks:",e),this.loadingRisks=!1,this.risks=[],this.filteredRisks=[]})},filterRisks(){if(!this.riskSearchQuery)return void(this.filteredRisks=[...this.risks].filter(e=>e&&e.RiskId));const e=this.sanitizeHTML(this.riskSearchQuery.toLowerCase());this.filteredRisks=this.risks.filter(t=>t&&t.RiskId&&(t.RiskId&&t.RiskId.toString().includes(e)||t.RiskTitle&&this.sanitizeHTML(t.RiskTitle.toLowerCase()).includes(e)||t.Category&&this.sanitizeHTML(t.Category.toLowerCase()).includes(e)||t.RiskDescription&&this.sanitizeHTML(t.RiskDescription.toLowerCase()).includes(e)))},selectRisk(e){this.newInstance.RiskId=e.RiskId,this.selectedRiskIdText=`Risk ID: ${e.RiskId}`,this.showRiskDropdown=!1,e.RiskTitle&&(this.newInstance.RiskTitle=e.RiskTitle),e.Criticality&&(this.newInstance.Criticality=e.Criticality),e.Category&&(this.newInstance.Category=e.Category),e.PossibleDamage&&(this.newInstance.PossibleDamage=e.PossibleDamage),e.RiskDescription&&(this.newInstance.RiskDescription=e.RiskDescription)},toggleRiskDropdown(){this.showRiskDropdown=!this.showRiskDropdown,this.showRiskDropdown&&(this.riskSearchQuery="",this.filterRisks())},closeRiskDropdown(e){const t=document.querySelector(".risk-instance-dropdown-container");t&&!t.contains(e.target)&&(this.showRiskDropdown=!1)},updateSelectedRiskIdText(){if(this.newInstance.RiskId){const e=this.risks.find(e=>e.RiskId===parseInt(this.newInstance.RiskId));this.selectedRiskIdText=e?`Risk ID: ${e.RiskId}`:`Risk ID: ${this.newInstance.RiskId}`}else this.selectedRiskIdText=""},truncateText(e,t){if(!e)return"";const i=this.sanitizeHTML(e);return i.length>t?i.substring(0,t)+"...":i},calculateRiskExposureRating(){const e=parseInt(this.newInstance.RiskLikelihood)||0,t=parseInt(this.newInstance.RiskImpact)||0;this.newInstance.RiskExposureRating=e>0&&t>0?e*t:null},onAppetiteChange(){"No"===this.newInstance.Appetite&&(this.newInstance.RiskStatus="Rejected",console.log("Appetite set to No: Updated RiskStatus to Rejected"))},testBackendConnection(){this.isDebugging=!0,this.testResults=[];const e=["http://127.0.0.1:8000/api/risk-instances/","http://localhost:8000/api/risk-instances/","http://localhost:8080/api/risk-instances/","http://localhost:8080/risk-instances/","http://127.0.0.1:8000/risk-instances/","http://localhost:8000/risk-instances/"];this.testResults.push("Testing API endpoints in order of priority..."),this.testResults.push(`Primary endpoint: ${e[0]} (confirmed working in browser)`);const t=i=>{if(i>=e.length)return void this.testResults.push("All tests completed.");const a=e[i];this.testResults.push(`Testing: ${a}`),fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.ok?e.json().then(e=>{this.testResults.push(`✅ ${a} - Connected successfully`),this.testResults.push(`Found ${e.length||0} risk instances in the database`),t(i+1)}):e.text().then(()=>{this.testResults.push(`❌ ${a} - Status: ${e.status}`),t(i+1)})).catch(e=>{this.testResults.push(`❌ ${a} - Error: ${e.message}`),t(i+1)})};t(0)},validateChoiceField(e,t,i){return e?i.includes(e)?(this.validationErrors[t]="",!0):(this.validationErrors[t]=`Invalid ${t}. Must be one of: ${i.join(", ")}`,!1):(this.validationErrors[t]=`${t} is required`,!1)},validateNumericField(e,t,i,a){const s=parseInt(e);return isNaN(s)?(this.validationErrors[t]=`${t} must be a number`,!1):s<i||s>a?(this.validationErrors[t]=`${t} must be between ${i} and ${a}`,!1):(this.validationErrors[t]="",!0)},validateTextField(e,t,i=!1){const a=this.sanitizeHTML(e);return!a&&i?(this.validationErrors[t]=`${t} is required`,!1):a&&!this.validationRules.TEXT_PATTERN.test(a)?(this.validationErrors[t]=`${t} contains invalid characters`,!1):(this.validationErrors[t]="",!0)},validateForm(){let e=!0;return e=this.validateChoiceField(this.newInstance.Criticality,"Criticality",this.validationRules.ALLOWED_CRITICALITY)&&e,e=this.validateChoiceField(this.newInstance.RiskPriority,"RiskPriority",this.validationRules.ALLOWED_RISK_PRIORITY)&&e,e=this.validateChoiceField(this.newInstance.Origin,"Origin",this.validationRules.ALLOWED_ORIGIN)&&e,e=this.validateChoiceField(this.newInstance.RiskType,"RiskType",this.validationRules.ALLOWED_RISK_TYPE)&&e,e=this.validateChoiceField(this.newInstance.Appetite,"Appetite",this.validationRules.ALLOWED_APPETITE)&&e,e=this.validateChoiceField(this.newInstance.RiskResponseType,"RiskResponseType",this.validationRules.ALLOWED_RISK_RESPONSE_TYPE)&&e,e=this.validateNumericField(this.newInstance.RiskLikelihood,"RiskLikelihood",this.validationRules.RISK_LIKELIHOOD_RANGE.min,this.validationRules.RISK_LIKELIHOOD_RANGE.max)&&e,e=this.validateNumericField(this.newInstance.RiskImpact,"RiskImpact",this.validationRules.RISK_IMPACT_RANGE.min,this.validationRules.RISK_IMPACT_RANGE.max)&&e,e=this.validateTextField(this.newInstance.RiskTitle,"RiskTitle",!0)&&e,e=this.validateTextField(this.newInstance.RiskDescription,"RiskDescription",!0)&&e,e=this.validateTextField(this.newInstance.PossibleDamage,"PossibleDamage",!1)&&e,e=this.validateTextField(this.newInstance.RiskResponseDescription,"RiskResponseDescription",!1)&&e,e=this.validateTextField(this.newInstance.RiskMitigation,"RiskMitigation",!1)&&e,e},submitInstance(){if(Object.keys(this.validationErrors).forEach(e=>{this.validationErrors[e]=""}),!this.validateForm())return console.error("Form validation failed",this.validationErrors),void this.$nextTick(()=>{const e=Object.keys(this.validationErrors).find(e=>this.validationErrors[e]);if(e){const t=document.getElementById(e.toLowerCase());t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.focus())}});try{this.submitRiskInstance()}catch(e){console.error("Error submitting form:",e)}},submitRiskInstance(){const e={};Object.keys(this.newInstance).forEach(t=>{""!==this.newInstance[t]&&null!==this.newInstance[t]&&("string"===typeof this.newInstance[t]?e[t]=this.sanitizeHTML(this.newInstance[t]):e[t]=this.newInstance[t])}),this.selectedBusinessImpacts.length>0&&(e.BusinessImpact=this.selectedBusinessImpacts.map(e=>this.sanitizeHTML(e.value)).join(", ")),this.selectedOwnerText&&(e.RiskOwner=this.sanitizeHTML(this.selectedOwnerText)),e.MitigationStatus&&"Not Started"!==e.MitigationStatus||(e.MitigationStatus=null);const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content"),i={"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"};t&&(i["X-CSRF-TOKEN"]=t),e.UserId||(e.UserId=1),He.A.post("http://localhost:8000/api/risk-instances/",e,{headers:i,withCredentials:!0}).then(t=>{console.log("Risk instance created successfully:",t.data),this.$popup.success("Risk instance created successfully!"),this.resetForm(),this.sendPushNotification(e)}).catch(e=>{console.error("Error creating risk instance:",e);let t="Unknown error occurred";e.response&&e.response.data?t=e.response.data.error?e.response.data.error:e.response.data.message?e.response.data.message:"string"===typeof e.response.data?e.response.data:JSON.stringify(e.response.data):e.message&&(t=e.message),this.$popup.error("Error: "+t)})},resetForm(){this.newInstance={Criticality:"",PossibleDamage:"",Category:"",Appetite:"Yes",RiskDescription:"",RiskLikelihood:1,RiskImpact:1,RiskExposureRating:1,RiskPriority:"",RiskResponseType:"Mitigation",RiskResponseDescription:"",RiskMitigation:"",RiskOwner:"",RiskStatus:"Not Assigned",UserId:1,RiskId:null,IncidentId:null,RiskTitle:"",BusinessImpact:"",Origin:"",MitigationDueDate:null,MitigationStatus:null,MitigationCompletedDate:null,ReviewerCount:null,RecurrenceCount:1,RiskFormDetails:null,ModifiedMitigations:null,ComplianceId:"",RiskType:"Current"},this.selectedRiskIdText="",this.selectedOwnerText="",this.selectedComplianceIdText="",this.selectedBusinessImpacts=[],this.showBusinessImpactDropdown=!1,this.businessImpactSearch="",this.showAddImpactModal=!1,this.newBusinessImpact="",this.selectedCategory="",this.calculateRiskExposureRating()},handleFocus(){},handleBlur(){},fetchUsers(){this.loadingUsers=!0;const e="http://127.0.0.1:8000/api/users-for-dropdown/",t={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}};fetch(e,t).then(e=>{if(!e.ok)throw new Error(`API Error: ${e.status}`);return e.json()}).then(e=>{this.users=e,this.filteredUsers=[...e],this.loadingUsers=!1}).catch(e=>{console.error("Error fetching users:",e),this.loadingUsers=!1,this.filteredUsers=[]})},filterUsers(){if(!this.userSearchQuery)return void(this.filteredUsers=[...this.users]);const e=this.sanitizeHTML(this.userSearchQuery.toLowerCase());this.filteredUsers=this.users.filter(t=>t.UserName&&t.UserName.toLowerCase().includes(e))},selectUser(e){this.selectedOwnerText=e.UserName,this.newInstance.RiskOwner=e.UserName,this.showUserDropdown=!1,e.UserId&&(this.newInstance.UserId=e.UserId)},toggleUserDropdown(){this.showUserDropdown=!this.showUserDropdown,this.showUserDropdown&&(this.userSearchQuery="",this.fetchUsers())},closeUserDropdown(e){const t=document.querySelector(".risk-instance-user-dropdown-container");t&&!t.contains(e.target)&&(this.showUserDropdown=!1)},fetchCompliances(){this.loadingCompliances=!0;const e="http://127.0.0.1:8000/api/compliances-for-dropdown/",t={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}};fetch(e,t).then(e=>{if(!e.ok)throw new Error(`API Error: ${e.status}`);return e.json()}).then(e=>{this.compliances=e,this.filteredCompliances=[...e],this.loadingCompliances=!1}).catch(e=>{console.error("Error fetching compliances:",e),this.loadingCompliances=!1,this.compliances=[],this.filteredCompliances=[]})},filterCompliances(){if(!this.complianceSearchQuery)return void(this.filteredCompliances=[...this.compliances]);const e=this.sanitizeHTML(this.complianceSearchQuery.toLowerCase());this.filteredCompliances=this.compliances.filter(t=>t.ComplianceId&&t.ComplianceId.toString().includes(e)||t.ComplianceItemDescription&&t.ComplianceItemDescription.toLowerCase().includes(e))},selectCompliance(e){this.selectedComplianceIdText=`Compliance ID: ${e.ComplianceId}`,this.showComplianceDropdown=!1,e.ComplianceItemDescription&&(this.newInstance.RiskDescription=e.ComplianceItemDescription),e.PossibleDamage&&(this.newInstance.PossibleDamage=e.PossibleDamage),e.ComplianceId&&(this.newInstance.ComplianceId=e.ComplianceId)},toggleComplianceDropdown(){this.showComplianceDropdown=!this.showComplianceDropdown,this.showComplianceDropdown&&(this.complianceSearchQuery="",this.fetchCompliances())},closeComplianceDropdown(e){const t=document.querySelector(".risk-instance-compliance-dropdown-container");t&&!t.contains(e.target)&&(this.showComplianceDropdown=!1)},async fetchBusinessImpacts(){try{const e={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}},t=await fetch("http://127.0.0.1:8000/api/business-impacts/",e);if(!t.ok)throw new Error(`API Error: ${t.status}`);const i=await t.json();"success"===i.status&&(this.businessImpacts=i.data)}catch(e){console.error("Error fetching business impacts:",e)}},toggleBusinessImpactDropdown(){this.showBusinessImpactDropdown=!this.showBusinessImpactDropdown,this.showBusinessImpactDropdown?(this.businessImpactSearch="",document.addEventListener("click",this.closeBusinessImpactDropdown)):document.removeEventListener("click",this.closeBusinessImpactDropdown)},closeBusinessImpactDropdown(e){const t=document.querySelector(".risk-instance-business-impact-dropdown");t&&!t.contains(e.target)&&(this.showBusinessImpactDropdown=!1,document.removeEventListener("click",this.closeBusinessImpactDropdown))},toggleBusinessImpact(e){const t=this.selectedBusinessImpacts.findIndex(t=>t.id===e.id);-1===t?this.selectedBusinessImpacts.push(e):this.selectedBusinessImpacts.splice(t,1),this.newInstance.BusinessImpact=this.selectedBusinessImpacts.map(e=>e.value).join(", ")},isBusinessImpactSelected(e){return this.selectedBusinessImpacts.some(t=>t.id===e.id)},async addNewBusinessImpact(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newBusinessImpact.trim())try{console.log("Adding new business impact:",this.newBusinessImpact);const e=await fetch("http://127.0.0.1:8000/api/business-impacts/add/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:this.newBusinessImpact.trim()})});if(!e.ok)throw new Error(`API Error: ${e.status}`);const t=await e.json();if("success"!==t.status)throw new Error("Failed to add business impact: "+(t.message||"Unknown error"));console.log("Successfully added business impact:",t.data),this.businessImpacts.push(t.data),this.toggleBusinessImpact(t.data),this.showAddImpactModal=!1,this.newBusinessImpact=""}catch(t){console.error("Error adding new business impact:",t),this.$popup.error("Failed to add new business impact: "+t.message)}},async fetchCategories(){try{const e={method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}},t=await fetch("http://127.0.0.1:8000/api/risk-categories/",e);if(!t.ok)throw new Error(`API Error: ${t.status}`);const i=await t.json();"success"===i.status&&(this.categories=i.data)}catch(e){console.error("Error fetching categories:",e)}},toggleCategoryDropdown(){this.showCategoryDropdown=!this.showCategoryDropdown,this.showCategoryDropdown&&(this.categorySearch="")},selectCategory(e){this.selectedCategory=e.value,this.newInstance.Category=e.value,this.showCategoryDropdown=!1},async addNewCategory(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newCategory.trim())try{console.log("Adding new category:",this.newCategory);const e=await fetch("http://127.0.0.1:8000/api/risk-categories/add/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:this.newCategory.trim()})});if(!e.ok)throw new Error(`API Error: ${e.status}`);const t=await e.json();if("success"!==t.status)throw new Error("Failed to add category: "+(t.message||"Unknown error"));console.log("Successfully added category:",t.data),this.categories.push(t.data),this.selectCategory(t.data),this.showAddCategoryModal=!1,this.newCategory=""}catch(t){console.error("Error adding new category:",t),this.$popup.error("Failed to add new category: "+t.message)}},sanitizeHTML(e){return e?String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/\\/g,"&#x5C;").replace(/`/g,"&#x60;"):""},encodeForHTML(e){return this.sanitizeHTML(e)},encodeForJavaScript(e){return e?String(e).replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/`/g,"\\`").replace(/\//g,"\\/").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t").replace(/\f/g,"\\f").replace(/<\/script>/gi,"<\\/script>"):""},async sendPushNotification(e){try{const t={title:"New Risk Instance Created",message:`A new risk instance "${e.RiskTitle||"Untitled Risk"}" has been created in the Risk module.`,category:"risk",priority:"high",user_id:"default_user"},i=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});i.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}}}};const Hve=(0,le.A)(zve,[["render",Jve],["__scopeId","data-v-3bc178f6"]]);var Gve=Hve;const Yve={class:"risk-workflow-container"},Zve={key:0},eke={class:"risk-workflow-toggle-buttons"},tke={class:"risk-workflow-user-filter"},ike={key:0,class:"risk-workflow-loading-indicator"},ake={key:1},ske={key:0,class:"risk-workflow-loading-indicator"},oke={key:2,class:"risk-workflow-logged-user-info"},lke={class:"user-info-display"},nke={key:0,class:"user-department"},rke={class:"risk-workflow-tabs"},cke={key:0,class:"risk-workflow-loading"},dke={key:1,class:"risk-workflow-error-message"},uke={key:2},pke={key:0,class:"risk-workflow-no-data"},mke={key:1,class:"risk-workflow-no-data"},vke={key:2},kke={class:"risk-workflow-user-tasks-table-responsive"},hke={class:"risk-workflow-user-tasks-table"},gke=["onClick"],yke={key:3},fke={key:0,class:"risk-workflow-no-data"},bke={key:1,class:"risk-workflow-no-data"},Cke={key:2},Lke={class:"risk-workflow-user-tasks-table-responsive"},wke={class:"risk-workflow-user-tasks-table"},Eke={key:1,style:{"font-size":"12px",color:"#888"}},Rke=["onClick"],Ike={key:1,class:"risk-workflow-fullscreen"},Dke={class:"risk-workflow-back-to-tasks"},Pke={key:0,class:"risk-workflow-loading"},_ke={key:1,class:"risk-workflow-no-data"},Ake={key:2,class:"risk-workflow-simplified-workflow"},Ske={class:"risk-workflow-timeline"},Tke={class:"risk-workflow-step-circle"},xke={key:0},Fke={key:1},Vke={class:"step-box"},Uke={key:0,class:"submission-date user-date"},Nke={key:1,class:"submission-date reviewer-date"},Mke={key:2,class:"status-tag approved"},Xke={key:3,class:"status-tag rejected"},$ke={key:0,class:"remarks"},Oke={key:4,class:"status-tag completed"},jke={key:5,class:"status-tag active"},Bke={key:6,class:"status-tag locked"},Wke={key:7,class:"step-comments-display"},qke={key:8,class:"file-display"},Qke=["href","filename"],Kke={key:0,class:"file-info-details"},Jke={class:"file-upload-date"},zke={key:9,class:"risk-workflow-status-control"},Hke={class:"step-comments"},Gke=["id","onUpdate:modelValue"],Yke={class:"file-upload-container"},Zke=["for"],ehe={class:"file-upload-wrapper"},the=["id","onChange"],ihe={key:0,class:"file-preview"},ahe={class:"file-info"},she=["onClick"],ohe=["onClick"],lhe=["onClick"],nhe={class:"mitigation-questionnaire"},rhe={key:0,class:"submission-date user-date"},che={key:1,class:"submission-date reviewer-date"},dhe={class:"question-group"},uhe={class:"cost-input-group"},phe=["disabled"],mhe=["disabled"],vhe={class:"question-group"},khe=["disabled"],hhe={class:"question-group"},ghe=["disabled"],yhe={class:"question-group"},fhe=["disabled"],bhe={class:"question-group"},Che=["disabled"],Lhe={class:"question-group"},whe={class:"cost-input-group"},Ehe=["disabled"],Rhe=["disabled"],Ihe={class:"question-group"},Dhe=["disabled"],Phe={class:"question-group"},_he=["disabled"],Ahe={class:"question-group"},She=["disabled"],The={class:"question-group"},xhe=["disabled"],Fhe={key:1,class:"questionnaire-feedback"},Vhe={key:0,class:"reviewer-info"},Uhe={key:2,class:"reviewer-workflow-fullscreen"},Nhe={class:"back-to-tasks"},Mhe={key:0,class:"loading"},Xhe={key:1},$he={class:"risk-summary"},Ohe={key:0,class:"status-message"},jhe={key:1,class:"status-message"},Bhe={class:"mitigation-review-list"},Whe=["disabled"],qhe=["value"],Qhe={key:0,class:"no-versions-message"},Khe=["data-id"],Jhe={class:"mitigation-heading"},zhe={class:"mitigation-split-content"},Hhe={class:"mitigation-previous"},Ghe={class:"version-label"},Yhe={style:{"font-size":"10px",color:"#999","margin-top":"2px"}},Zhe={key:0,class:"mitigation-content"},ege={class:"metadata-section"},tge={class:"metadata-item"},ige={class:"metadata-value"},age={class:"metadata-item"},sge={class:"metadata-value"},oge={key:0,class:"metadata-item"},lge={class:"metadata-value"},nge={key:1,class:"metadata-item"},rge={class:"metadata-value"},cge={key:0,class:"comments-section"},dge={class:"comments-text"},uge={key:1,class:"evidence-section"},pge=["href","filename"],mge={key:3,class:"remarks-section"},vge={class:"remarks-text"},kge={key:4,class:"reviewer-feedback-section"},hge={class:"reviewer-feedback-text"},gge={key:1,class:"mitigation-empty"},yge={class:"mitigation-current"},fge={class:"version-label"},bge={style:{"font-size":"10px",color:"#666","margin-top":"2px"}},Cge={class:"mitigation-content"},Lge={class:"metadata-section"},wge={class:"metadata-item"},Ege={class:"metadata-value"},Rge={class:"metadata-item"},Ige={class:"metadata-value"},Dge={key:0,class:"metadata-item"},Pge={class:"metadata-value"},_ge={key:1,class:"metadata-item"},Age={class:"metadata-value"},Sge={key:2,class:"metadata-item"},Tge={class:"metadata-value"},xge={key:0,class:"comments-section"},Fge={class:"comments-text"},Vge={key:1,class:"evidence-section"},Uge=["href","filename"],Nge={key:3,class:"remarks-section"},Mge={class:"remarks-text"},Xge={class:"approval-controls"},$ge={key:0,class:"approval-buttons"},Oge=["onClick"],jge=["onClick"],Bge={key:1,class:"remarks-field"},Wge=["onUpdate:modelValue"],qge=["onClick"],Qge=["onClick"],Kge={key:2,class:"approved-actions"},Jge=["onClick"],zge={key:3,class:"reviewer-remarks-display"},Hge={class:"form-details-review"},Gge={class:"submission-dates"},Yge={key:0,class:"submission-date user-date"},Zge={key:1,class:"submission-date reviewer-date"},eye={class:"form-split-content"},tye={class:"form-field-split"},iye={key:0,class:"form-field-previous"},aye={class:"form-split-content"},sye={class:"form-field-split"},oye={key:0,class:"form-field-previous"},lye={class:"form-split-content"},nye={class:"form-field-split"},rye={key:0,class:"form-field-previous"},cye={class:"form-split-content"},dye={class:"form-field-split"},uye={key:0,class:"form-field-previous"},pye={class:"form-split-content"},mye={class:"form-field-split"},vye={key:0,class:"form-field-previous"},kye={class:"form-split-content"},hye={class:"form-field-split"},gye={key:0,class:"form-field-previous"},yye={class:"form-split-content"},fye={class:"form-field-split"},bye={key:0,class:"form-field-previous"},Cye={class:"form-split-content"},Lye={class:"form-field-split"},wye={key:0,class:"form-field-previous"},Eye={class:"form-split-content"},Rye={class:"form-field-split"},Iye={key:0,class:"form-field-previous"},Dye={class:"form-split-content"},Pye={class:"form-field-split"},_ye={key:0,class:"form-field-previous"},Aye={key:1,class:"questionnaire-approval"},Sye={key:0,class:"approval-buttons"},Tye={key:1,class:"approval-status approved"},xye={key:2,class:"approval-status rejected"},Fye={class:"remarks-field"},Vye={class:"approval-actions"},Uye={class:"review-actions"},Nye=["disabled"],Mye=["disabled"],Xye={key:0,class:"review-complete-notice"};function $ye(e,t,i,o,l,n){const r=(0,s.g2)("CustomDropdown"),c=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Yve,[l.showMitigationWorkflow||l.showReviewerWorkflow?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Zve,[(0,s.Lk)("div",eke,[(0,s.Lk)("button",{class:"risk-workflow-toggle-button",onClick:t[0]||(t[0]=e=>n.navigateTo("resolution"))}," Risk Resolution "),(0,s.Lk)("button",{class:"risk-workflow-toggle-button active",onClick:t[1]||(t[1]=e=>n.navigateTo("workflow"))}," Risk Workflow ")]),(0,s.Lk)("div",tke,[l.isLoadingUser?((0,s.uX)(),(0,s.CE)("div",ike," Loading user information... ")):n.isGRCAdministrator?((0,s.uX)(),(0,s.CE)("div",ake,[l.loading&&0===l.users.length?((0,s.uX)(),(0,s.CE)("div",ske," Loading users... ")):((0,s.uX)(),(0,s.Wv)(r,{key:1,modelValue:l.selectedUserId,"onUpdate:modelValue":t[2]||(t[2]=e=>l.selectedUserId=e),config:l.userDropdownConfig,onChange:n.fetchData},null,8,["modelValue","config","onChange"]))])):((0,s.uX)(),(0,s.CE)("div",oke,[(0,s.Lk)("div",lke,[t[30]||(t[30]=(0,s.Lk)("i",{class:"fas fa-user"},null,-1)),(0,s.Lk)("span",null,(0,d.v_)(l.loggedInUser?l.loggedInUser.UserName:"Unknown User"),1),l.loggedInUser&&l.loggedInUser.department?((0,s.uX)(),(0,s.CE)("span",nke," ("+(0,d.v_)(l.loggedInUser.department)+") ",1)):(0,s.Q3)("",!0)])]))]),(0,s.Lk)("div",rke,[(0,s.Lk)("div",{class:(0,d.C4)(["risk-workflow-tab",{active:"user"===l.activeTab}]),onClick:t[3]||(t[3]=e=>l.activeTab="user")}," My Tasks ",2),(0,s.Lk)("div",{class:(0,d.C4)(["risk-workflow-tab",{active:"reviewer"===l.activeTab}]),onClick:t[4]||(t[4]=e=>l.activeTab="reviewer")}," Reviewer Tasks ",2)]),l.loading?((0,s.uX)(),(0,s.CE)("div",cke," Loading data... ")):l.error?((0,s.uX)(),(0,s.CE)("div",dke,(0,d.v_)(l.error),1)):(0,s.Q3)("",!0),"user"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",uke,[l.selectedUserId?0===l.userRisks.length?((0,s.uX)(),(0,s.CE)("div",mke,t[32]||(t[32]=[(0,s.Lk)("p",null,"No risks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",vke,[(0,s.Lk)("div",kke,[(0,s.Lk)("table",hke,[t[34]||(t[34]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"RiskID"),(0,s.Lk)("th",null,"Origin"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Risk Description"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.userRisks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.RiskInstanceId},[(0,s.Lk)("td",null,(0,d.v_)(e.RiskInstanceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",null,(0,d.v_)(e.Category),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["risk-workflow-criticality-badge",e.Criticality?.toLowerCase()])},(0,d.v_)(e.Criticality),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.RiskDescription),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)("risk-workflow-status-"+(e.RiskStatus?.toLowerCase().replace(/\s+/g,"-")||"not-assigned"))},(0,d.v_)("Revision Required by Reviewer"===e.RiskStatus?"Waiting for Reviewer":"Revision Required by User"===e.RiskStatus?"Action Required":e.RiskStatus||"Not Assigned"),3),e.MitigationStatus?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)(["risk-workflow-mitigation-status",n.getMitigationStatusClass(e.MitigationStatus)])},(0,d.v_)(e.MitigationStatus),3)):(0,s.Q3)("",!0),e.MitigationDueDate?((0,s.uX)(),(0,s.CE)("span",{key:1,class:(0,d.C4)(["risk-workflow-due-status",n.getDueStatusClass(e.MitigationDueDate)])},(0,d.v_)(n.getDueStatusText(e.MitigationDueDate)),3)):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{onClick:t=>n.viewMitigations(e.RiskInstanceId),class:"risk-workflow-view-btn"},t[33]||(t[33]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1),(0,s.eW)(" View ")]),8,gke)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",pke,t[31]||(t[31]=[(0,s.Lk)("p",null,"Please select a user to view their assigned risks.",-1)])))])):(0,s.Q3)("",!0),"reviewer"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",yke,[l.selectedUserId?0===l.reviewerTasks.length?((0,s.uX)(),(0,s.CE)("div",bke,t[36]||(t[36]=[(0,s.Lk)("p",null,"No review tasks assigned to this user.",-1)]))):((0,s.uX)(),(0,s.CE)("div",Cke,[(0,s.Lk)("div",Lke,[(0,s.Lk)("table",wke,[t[38]||(t[38]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"RiskID"),(0,s.Lk)("th",null,"Origin"),(0,s.Lk)("th",null,"Category"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Risk Description"),(0,s.Lk)("th",null,"Status"),(0,s.Lk)("th",null,"Actions")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.reviewerTasks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.RiskInstanceId},[(0,s.Lk)("td",null,(0,d.v_)(e.RiskInstanceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.Origin||"MANUAL"),1),(0,s.Lk)("td",null,(0,d.v_)(e.Category||"Unknown"),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,d.C4)(["risk-workflow-criticality-badge",e.Criticality?.toLowerCase()||"unknown"])},(0,d.v_)(e.Criticality||"Unknown"),3)]),(0,s.Lk)("td",null,(0,d.v_)(e.RiskDescription||"Unknown"),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",null,(0,d.v_)("Revision Required by Reviewer"===e.RiskStatus?"Review Required":"Revision Required by User"===e.RiskStatus?"Feedback Sent":e.RiskStatus||"Unknown"),1),e.MitigationStatus?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,d.C4)(["risk-workflow-mitigation-status",n.getMitigationStatusClass(e.MitigationStatus)])},(0,d.v_)(e.MitigationStatus),3)):(0,s.Q3)("",!0),n.getUserName(e.UserId)?((0,s.uX)(),(0,s.CE)("div",Eke,"By: "+(0,d.v_)(n.getUserName(e.UserId)),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("td",null,[(0,s.Lk)("button",{onClick:t=>n.reviewMitigations(e),class:"risk-workflow-review-btn"},t[37]||(t[37]=[(0,s.Lk)("i",{class:"fas fa-tasks"},null,-1),(0,s.eW)(" Review ")]),8,Rke)])]))),128))])])])])):((0,s.uX)(),(0,s.CE)("div",fke,t[35]||(t[35]=[(0,s.Lk)("p",null,"Please select a user to view their reviewer tasks.",-1)])))])):(0,s.Q3)("",!0)])),l.showMitigationWorkflow?((0,s.uX)(),(0,s.CE)("div",Ike,[(0,s.Lk)("div",Dke,[(0,s.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>n.closeMitigationModal&&n.closeMitigationModal(...e)),class:"risk-workflow-back-btn",title:"Back to tasks"},t[39]||(t[39]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",Pke,t[40]||(t[40]=[(0,s.Lk)("div",{class:"risk-workflow-spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation steps...",-1)]))):l.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",Ake,[(0,s.Lk)("div",Ske,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:(0,d.C4)(["risk-workflow-timeline-step",{completed:"Completed"===e.status,active:n.isStepActive(i),locked:n.isStepLocked(i),approved:!0===e.approved,rejected:!1===e.approved}]),style:(0,d.Tr)({"--step-index":i})},[(0,s.Lk)("div",Tke,["Completed"===e.status?((0,s.uX)(),(0,s.CE)("span",xke,t[41]||(t[41]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]))):((0,s.uX)(),(0,s.CE)("span",Fke,(0,d.v_)(e.title.replace("Step ","")),1))]),(0,s.Lk)("div",Vke,[(0,s.Lk)("h3",null,(0,d.v_)(e.description),1),e.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",Uke,[t[42]||(t[42]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(e.user_submitted_date)),1)])):(0,s.Q3)("",!0),e.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",Nke,[t[43]||(t[43]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(e.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0),!0===e.approved?((0,s.uX)(),(0,s.CE)("div",Mke,t[44]||(t[44]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" Approved ")]))):!1===e.approved?((0,s.uX)(),(0,s.CE)("div",Xke,[t[46]||(t[46]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),t[47]||(t[47]=(0,s.eW)(" Rejected ")),e.remarks?((0,s.uX)(),(0,s.CE)("div",$ke,[t[45]||(t[45]=(0,s.Lk)("strong",null,"Feedback:",-1)),(0,s.eW)(" "+(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])):"Completed"===e.status?((0,s.uX)(),(0,s.CE)("div",Oke,t[48]||(t[48]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Completed ")]))):n.isStepActive(i)?((0,s.uX)(),(0,s.CE)("div",jke,t[49]||(t[49]=[(0,s.Lk)("i",{class:"fas fa-circle-notch fa-spin"},null,-1),(0,s.eW)(" In Progress ")]))):((0,s.uX)(),(0,s.CE)("div",Bke,t[50]||(t[50]=[(0,s.Lk)("i",{class:"fas fa-lock"},null,-1),(0,s.eW)(" Locked ")]))),e.comments?((0,s.uX)(),(0,s.CE)("div",Wke,[t[51]||(t[51]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" Your Comments")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.comments),1)])):(0,s.Q3)("",!0),e.fileData?((0,s.uX)(),(0,s.CE)("div",qke,[t[53]||(t[53]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Uploaded Evidence")],-1)),(0,s.Lk)("a",{href:e.s3Url||e.fileData,download:"",filename:e.fileName||"evidence"},[t[52]||(t[52]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName||"Download file"),1)],8,Qke),e.s3FileInfo?((0,s.uX)(),(0,s.CE)("div",Kke,[(0,s.Lk)("span",Jke,"Uploaded: "+(0,d.v_)(n.formatDateTime(e.s3FileInfo.uploadedAt)),1)])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),e.approved||n.isStepLocked(i)?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",zke,[(0,s.Lk)("div",Hke,[t[54]||(t[54]=(0,s.Lk)("label",{for:"step-comments-input"},[(0,s.Lk)("i",{class:"fas fa-comment"}),(0,s.eW)(" Comments:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"step-comments-input-"+i,"onUpdate:modelValue":t=>e.comments=t,placeholder:"Enter your comments for this mitigation step...",class:"step-comments-input"},null,8,Gke),[[a.Jo,e.comments]])]),(0,s.Lk)("div",Yke,[(0,s.Lk)("label",{for:"file-upload-"+i,class:"file-upload-label"},[t[55]||(t[55]=(0,s.Lk)("i",{class:"fas fa-file-upload"},null,-1)),t[56]||(t[56]=(0,s.eW)(" Upload Evidence: ")),(0,s.Lk)("span",null,(0,d.v_)(e.fileName||"Choose a file..."),1)],8,Zke),(0,s.Lk)("div",ehe,[(0,s.Lk)("input",{type:"file",id:"file-upload-"+i,onChange:e=>n.handleFileUpload(e,i),class:"file-upload-input",style:{display:"none"}},null,40,the)]),e.fileData?((0,s.uX)(),(0,s.CE)("div",ihe,[(0,s.Lk)("div",ahe,[t[58]||(t[58]=(0,s.Lk)("i",{class:"fas fa-file-alt"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName)+" ",1),(0,s.Lk)("button",{onClick:e=>n.removeFile(i),class:"remove-file-btn"},t[57]||(t[57]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,she)])])):(0,s.Q3)("",!0)]),"Completed"!==e.status?((0,s.uX)(),(0,s.CE)("button",{key:0,onClick:e=>n.completeStep(i),class:(0,d.C4)(["risk-workflow-complete-btn",{active:"Completed"===e.status}])},t[59]||(t[59]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Mark as Complete ")]),10,ohe)):((0,s.uX)(),(0,s.CE)("button",{key:1,onClick:e=>n.resetStep(i),class:"risk-workflow-reset-btn"},t[60]||(t[60]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset ")]),8,lhe))]))])],6))),128))]),(0,s.Lk)("div",nhe,[t[78]||(t[78]=(0,s.Lk)("h3",null,"Risk Mitigation Questionnaire",-1)),n.questionnaireReviewed?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["questionnaire-status",{approved:n.questionnaireApproved,rejected:!n.questionnaireApproved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",n.questionnaireApproved?"fa-check-circle":"fa-times-circle"])},null,2),(0,s.eW)(" "+(0,d.v_)(n.questionnaireApproved?"Approved":"Revision Required")+" ",1),l.formDetails.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",rhe,[t[61]||(t[61]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(l.formDetails.user_submitted_date)),1)])):(0,s.Q3)("",!0),l.formDetails.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",che,[t[62]||(t[62]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(l.formDetails.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0)],2)):(0,s.Q3)("",!0),t[79]||(t[79]=(0,s.Lk)("p",{class:"questionnaire-note"},"Please complete all fields to proceed with submission",-1)),(0,s.Lk)("div",dhe,[t[64]||(t[64]=(0,s.Lk)("label",{for:"cost-input"},[(0,s.Lk)("span",{class:"question-number"},"1"),(0,s.eW)(" What is the cost for this mitigation?")],-1)),(0,s.Lk)("div",uhe,[(0,s.bo)((0,s.Lk)("input",{id:"cost-input",type:"number","onUpdate:modelValue":t[6]||(t[6]=e=>l.formDetails.cost=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter the cost..."},null,8,phe),[[a.Jo,l.formDetails.cost]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.formDetails.costCurrency=e),disabled:n.questionnaireApproved,class:"currency-select"},t[63]||(t[63]=[(0,s.Lk)("option",{value:"USD"},"USD",-1),(0,s.Lk)("option",{value:"INR"},"INR",-1),(0,s.Lk)("option",{value:"AED"},"AED",-1),(0,s.Lk)("option",{value:"MUR"},"MUR",-1)]),8,mhe),[[a.u1,l.formDetails.costCurrency]])])]),(0,s.Lk)("div",vhe,[t[65]||(t[65]=(0,s.Lk)("label",{for:"impact-input"},[(0,s.Lk)("span",{class:"question-number"},"2"),(0,s.eW)(" What is the impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"impact-input",type:"number","onUpdate:modelValue":t[8]||(t[8]=e=>l.formDetails.impact=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter the impact..."},null,8,khe),[[a.Jo,l.formDetails.impact]])]),(0,s.Lk)("div",hhe,[t[66]||(t[66]=(0,s.Lk)("label",{for:"financial-impact-input"},[(0,s.Lk)("span",{class:"question-number"},"3"),(0,s.eW)(" What is the financial impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"financial-impact-input",type:"number","onUpdate:modelValue":t[9]||(t[9]=e=>l.formDetails.financialImpact=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter the financial impact..."},null,8,ghe),[[a.Jo,l.formDetails.financialImpact]])]),(0,s.Lk)("div",yhe,[t[67]||(t[67]=(0,s.Lk)("label",{for:"reputational-impact-input"},[(0,s.Lk)("span",{class:"question-number"},"4"),(0,s.eW)(" What is the reputational impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"reputational-impact-input","onUpdate:modelValue":t[10]||(t[10]=e=>l.formDetails.reputationalImpact=e),disabled:n.questionnaireApproved,placeholder:"Describe the reputational impact..."},null,8,fhe),[[a.Jo,l.formDetails.reputationalImpact]])]),(0,s.Lk)("div",bhe,[t[68]||(t[68]=(0,s.Lk)("label",{for:"operational-impact-input"},[(0,s.Lk)("span",{class:"question-number"},"5"),(0,s.eW)(" What is the Operational Impact for this mitigation?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"operational-impact-input",type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>l.formDetails.operationalImpact=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter the operational impact..."},null,8,Che),[[a.Jo,l.formDetails.operationalImpact]])]),(0,s.Lk)("div",Lhe,[t[70]||(t[70]=(0,s.Lk)("label",{for:"financial-loss-input"},[(0,s.Lk)("span",{class:"question-number"},"6"),(0,s.eW)(" What is the Financial Loss for this mitigation?")],-1)),(0,s.Lk)("div",whe,[(0,s.bo)((0,s.Lk)("input",{id:"financial-loss-input",type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>l.formDetails.financialLoss=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter the financial loss..."},null,8,Ehe),[[a.Jo,l.formDetails.financialLoss]]),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>l.formDetails.financialLossCurrency=e),disabled:n.questionnaireApproved,class:"currency-select"},t[69]||(t[69]=[(0,s.Lk)("option",{value:"USD"},"USD",-1),(0,s.Lk)("option",{value:"INR"},"INR",-1),(0,s.Lk)("option",{value:"AED"},"AED",-1),(0,s.Lk)("option",{value:"MUR"},"MUR",-1)]),8,Rhe),[[a.u1,l.formDetails.financialLossCurrency]])])]),(0,s.Lk)("div",Ihe,[t[71]||(t[71]=(0,s.Lk)("label",{for:"system-downtime-input"},[(0,s.Lk)("span",{class:"question-number"},"7"),(0,s.eW)(" What is the expected system downtime (hrs) if this risk occurs?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"system-downtime-input",type:"number","onUpdate:modelValue":t[14]||(t[14]=e=>l.formDetails.systemDowntime=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter expected downtime in hours..."},null,8,Dhe),[[a.Jo,l.formDetails.systemDowntime]])]),(0,s.Lk)("div",Phe,[t[72]||(t[72]=(0,s.Lk)("label",{for:"recovery-time-input"},[(0,s.Lk)("span",{class:"question-number"},"8"),(0,s.eW)(" How long did it take to recover last time (hrs)?")],-1)),(0,s.bo)((0,s.Lk)("input",{id:"recovery-time-input",type:"number","onUpdate:modelValue":t[15]||(t[15]=e=>l.formDetails.recoveryTime=e),disabled:n.questionnaireApproved,min:"0",placeholder:"Enter recovery time in hours..."},null,8,_he),[[a.Jo,l.formDetails.recoveryTime]])]),(0,s.Lk)("div",Ahe,[t[74]||(t[74]=(0,s.Lk)("label",{for:"recurrence-possible-input"},[(0,s.Lk)("span",{class:"question-number"},"9"),(0,s.eW)(" Is it possible that this risk will recur again?")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"recurrence-possible-input","onUpdate:modelValue":t[16]||(t[16]=e=>l.formDetails.recurrencePossible=e),disabled:n.questionnaireApproved},t[73]||(t[73]=[(0,s.Lk)("option",{value:""},"Select",-1),(0,s.Lk)("option",{value:"Yes"},"Yes",-1),(0,s.Lk)("option",{value:"No"},"No",-1),(0,s.Lk)("option",{value:"Unknown"},"Unknown",-1)]),8,She),[[a.u1,l.formDetails.recurrencePossible]])]),(0,s.Lk)("div",The,[t[76]||(t[76]=(0,s.Lk)("label",{for:"improvement-initiative-input"},[(0,s.Lk)("span",{class:"question-number"},"10"),(0,s.eW)(" Is this an Improvement Initiative which will prevent the future recurrence of said risk?")],-1)),(0,s.bo)((0,s.Lk)("select",{id:"improvement-initiative-input","onUpdate:modelValue":t[17]||(t[17]=e=>l.formDetails.improvementInitiative=e),disabled:n.questionnaireApproved},t[75]||(t[75]=[(0,s.Lk)("option",{value:""},"Select",-1),(0,s.Lk)("option",{value:"Yes"},"Yes",-1),(0,s.Lk)("option",{value:"No"},"No",-1),(0,s.Lk)("option",{value:"Unknown"},"Unknown",-1)]),8,xhe),[[a.u1,l.formDetails.improvementInitiative]])]),n.questionnaireRejected?((0,s.uX)(),(0,s.CE)("div",Fhe,[t[77]||(t[77]=(0,s.Lk)("h4",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",null,(0,d.v_)(n.questionnaireRemarks),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:(0,d.C4)(["submission-area",{ready:n.canSubmit}])},[t[84]||(t[84]=(0,s.Lk)("h3",null,"Submit Mitigation",-1)),l.selectedReviewer?((0,s.uX)(),(0,s.CE)("div",Vhe,[(0,s.Lk)("p",null,[t[80]||(t[80]=(0,s.Lk)("strong",null,"Assigned Reviewer:",-1)),(0,s.eW)(" "+(0,d.v_)(n.getUserName(l.selectedReviewer)),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("button",{onClick:t[18]||(t[18]=(...e)=>n.submitForReview&&n.submitForReview(...e)),class:"submit-btn"},t[81]||(t[81]=[(0,s.Lk)("i",{class:"fas fa-paper-plane"},null,-1),(0,s.eW)(" Submit for Review ")])),(0,s.Q3)("",!0),(0,s.Q3)("",!0)],2)])):((0,s.uX)(),(0,s.CE)("div",_ke," No mitigation steps found for this risk. "))])):(0,s.Q3)("",!0),l.showReviewerWorkflow?((0,s.uX)(),(0,s.CE)("div",Uhe,[(0,s.Lk)("div",Nhe,[(0,s.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>n.closeReviewerModal&&n.closeReviewerModal(...e)),class:"back-btn",title:"Back to tasks"},t[85]||(t[85]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1)]))]),t[172]||(t[172]=(0,s.Lk)("h1",null,"Review Risk Mitigations",-1)),l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",Mhe,t[86]||(t[86]=[(0,s.Lk)("div",{class:"spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation data...",-1)]))):((0,s.uX)(),(0,s.CE)("div",Xhe,[(0,s.Lk)("div",$he,[(0,s.Lk)("h3",null,(0,d.v_)(l.currentReviewTask?.RiskDescription||"Risk #"+l.currentReviewTask?.RiskInstanceId),1),(0,s.Lk)("p",null,[t[87]||(t[87]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(l.currentReviewTask?.RiskInstanceId),1)]),(0,s.Lk)("p",null,[t[88]||(t[88]=(0,s.Lk)("strong",null,"Submitted By:",-1)),(0,s.eW)(" "+(0,d.v_)(n.getUserName(l.currentReviewTask?.UserId)),1)])]),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["review-status-banner",{approved:l.reviewApproved,rejected:!l.reviewApproved}])},[l.reviewApproved?((0,s.uX)(),(0,s.CE)("div",Ohe,t[89]||(t[89]=[(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1),(0,s.eW)(" This risk has been approved ")]))):((0,s.uX)(),(0,s.CE)("div",jhe,t[90]||(t[90]=[(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1),(0,s.eW)(" Feedback sent to user for revision ")])))],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",Bhe,[(0,s.Lk)("div",{class:(0,d.C4)(["global-version-dropdown",{loading:l.loadingVersions}])},[t[93]||(t[93]=(0,s.Lk)("label",{for:"global-version-select"},"Select Version to Compare:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"global-version-select","onUpdate:modelValue":t[20]||(t[20]=e=>l.globalSelectedVersion=e),onChange:t[21]||(t[21]=(...e)=>n.onGlobalVersionChange&&n.onGlobalVersionChange(...e)),class:"global-version-select",disabled:l.loadingVersions||0===l.allVersionNames.length},[t[91]||(t[91]=(0,s.Lk)("option",{value:""},"Select a version",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.allVersionNames,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,qhe))),128))],40,Whe),[[a.u1,l.globalSelectedVersion]]),0!==l.allVersionNames.length||l.loadingVersions?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Qhe,t[92]||(t[92]=[(0,s.Lk)("i",{class:"fas fa-info-circle"},null,-1),(0,s.eW)(" No previous versions available ")])))],2),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationReviewData,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"mitigation-review-item","data-id":i},[(0,s.Lk)("div",Jhe,[(0,s.Lk)("h4",null,"Mitigation #"+(0,d.v_)(i),1),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["mitigation-status-badge",{approved:!0===e.approved,rejected:!1===e.approved,pending:void 0===e.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===e.approved,"fa-times-circle":!1===e.approved,"fa-clock":void 0===e.approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending Review"),1)],2)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",zhe,[(0,s.Lk)("div",Hhe,[(0,s.Lk)("div",Ghe,[t[94]||(t[94]=(0,s.eW)(" Previous Versions ")),(0,s.Lk)("div",Yhe," Total Versions: "+(0,d.v_)(l.allVersions.length)+", Selected: "+(0,d.v_)(l.selectedVersions[i]||"None"),1)]),l.selectedVersions[i]&&n.getSelectedVersionData(i,l.selectedVersions[i])?((0,s.uX)(),(0,s.CE)("div",Zhe,[t[105]||(t[105]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).description||"No description available"),1),(0,s.Lk)("div",ege,[t[99]||(t[99]=(0,s.Lk)("h5",null,"Metadata",-1)),(0,s.Lk)("div",tge,[t[95]||(t[95]=(0,s.Lk)("div",{class:"metadata-label"},"Version:",-1)),(0,s.Lk)("div",ige,(0,d.v_)(l.selectedVersions[i]),1)]),(0,s.Lk)("div",age,[t[96]||(t[96]=(0,s.Lk)("div",{class:"metadata-label"},"Status:",-1)),(0,s.Lk)("div",sge,(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).status||"Not specified"),1)]),n.getSelectedVersionData(i,l.selectedVersions[i]).user_submitted_date?((0,s.uX)(),(0,s.CE)("div",oge,[t[97]||(t[97]=(0,s.Lk)("div",{class:"metadata-label"},"Submitted:",-1)),(0,s.Lk)("div",lge,(0,d.v_)(n.formatDateTime(n.getSelectedVersionData(i,l.selectedVersions[i]).user_submitted_date)),1)])):(0,s.Q3)("",!0),void 0!==n.getSelectedVersionData(i,l.selectedVersions[i]).approved?((0,s.uX)(),(0,s.CE)("div",nge,[t[98]||(t[98]=(0,s.Lk)("div",{class:"metadata-label"},"Review Status:",-1)),(0,s.Lk)("div",rge,[(0,s.Lk)("span",{class:(0,d.C4)({"text-success":n.getSelectedVersionData(i,l.selectedVersions[i]).approved,"text-danger":!1===n.getSelectedVersionData(i,l.selectedVersions[i]).approved})},(0,d.v_)(!0===n.getSelectedVersionData(i,l.selectedVersions[i]).approved?"Approved":!1===n.getSelectedVersionData(i,l.selectedVersions[i]).approved?"Rejected":"Pending"),3)])])):(0,s.Q3)("",!0)]),n.getSelectedVersionData(i,l.selectedVersions[i]).comments?((0,s.uX)(),(0,s.CE)("div",cge,[t[100]||(t[100]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",dge,(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).comments),1)])):(0,s.Q3)("",!0),n.getSelectedVersionData(i,l.selectedVersions[i]).fileData?((0,s.uX)(),(0,s.CE)("div",uge,[t[102]||(t[102]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:n.getSelectedVersionData(i,l.selectedVersions[i]).fileData,download:"",filename:n.getSelectedVersionData(i,l.selectedVersions[i]).fileName,class:"evidence-link"},[t[101]||(t[101]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).fileName),1)],8,pge)])):(0,s.Q3)("",!0),void 0!==n.getSelectedVersionData(i,l.selectedVersions[i]).approved?((0,s.uX)(),(0,s.CE)("div",{key:2,class:(0,d.C4)(["decision-tag",{approved:!0===n.getSelectedVersionData(i,l.selectedVersions[i]).approved,rejected:!1===n.getSelectedVersionData(i,l.selectedVersions[i]).approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===n.getSelectedVersionData(i,l.selectedVersions[i]).approved,"fa-times-circle":!1===n.getSelectedVersionData(i,l.selectedVersions[i]).approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).approved?"Approved":"Rejected"),1)],2)):(0,s.Q3)("",!0),!1===n.getSelectedVersionData(i,l.selectedVersions[i]).approved&&n.getSelectedVersionData(i,l.selectedVersions[i]).remarks?((0,s.uX)(),(0,s.CE)("div",mge,[t[103]||(t[103]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",vge,(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).remarks),1)])):(0,s.Q3)("",!0),n.getSelectedVersionData(i,l.selectedVersions[i]).reviewer_feedback?((0,s.uX)(),(0,s.CE)("div",kge,[t[104]||(t[104]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-dots"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",hge,(0,d.v_)(n.getSelectedVersionData(i,l.selectedVersions[i]).reviewer_feedback),1)])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",gge,t[106]||(t[106]=[(0,s.Lk)("i",{class:"fas fa-history"},null,-1),(0,s.Lk)("p",null,"Select a version from the dropdown above to compare",-1)])))]),(0,s.Lk)("div",yge,[(0,s.Lk)("div",fge,[t[107]||(t[107]=(0,s.eW)(" Latest Version ")),(0,s.Lk)("div",bge,(0,d.v_)(n.getCurrentVersionLabel()),1)]),(0,s.Lk)("div",Cge,[t[118]||(t[118]=(0,s.Lk)("h5",null,"Description",-1)),(0,s.Lk)("p",null,(0,d.v_)(e.description||"No description available"),1),(0,s.Lk)("div",Lge,[t[113]||(t[113]=(0,s.Lk)("h5",null,"Metadata",-1)),(0,s.Lk)("div",wge,[t[108]||(t[108]=(0,s.Lk)("div",{class:"metadata-label"},"Version:",-1)),(0,s.Lk)("div",Ege,(0,d.v_)(l.currentReviewTask?.version||"Current"),1)]),(0,s.Lk)("div",Rge,[t[109]||(t[109]=(0,s.Lk)("div",{class:"metadata-label"},"Status:",-1)),(0,s.Lk)("div",Ige,(0,d.v_)(e.status||"Not specified"),1)]),e.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",Dge,[t[110]||(t[110]=(0,s.Lk)("div",{class:"metadata-label"},"Submitted:",-1)),(0,s.Lk)("div",Pge,(0,d.v_)(n.formatDateTime(e.user_submitted_date)),1)])):(0,s.Q3)("",!0),e.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",_ge,[t[111]||(t[111]=(0,s.Lk)("div",{class:"metadata-label"},"Reviewed:",-1)),(0,s.Lk)("div",Age,(0,d.v_)(n.formatDateTime(e.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",Sge,[t[112]||(t[112]=(0,s.Lk)("div",{class:"metadata-label"},"Review Status:",-1)),(0,s.Lk)("div",Tge,[(0,s.Lk)("span",{class:(0,d.C4)({"text-success":e.approved,"text-danger":!1===e.approved})},(0,d.v_)(!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending"),3)])])):(0,s.Q3)("",!0)]),e.comments?((0,s.uX)(),(0,s.CE)("div",xge,[t[114]||(t[114]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-alt"}),(0,s.eW)(" User Comments")],-1)),(0,s.Lk)("p",Fge,(0,d.v_)(e.comments),1)])):(0,s.Q3)("",!0),e.fileData?((0,s.uX)(),(0,s.CE)("div",Vge,[t[116]||(t[116]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-file-alt"}),(0,s.eW)(" Evidence")],-1)),(0,s.Lk)("a",{href:e.fileData,download:"",filename:e.fileName,class:"evidence-link"},[t[115]||(t[115]=(0,s.Lk)("i",{class:"fas fa-download"},null,-1)),(0,s.eW)(" "+(0,d.v_)(e.fileName),1)],8,Uge)])):(0,s.Q3)("",!0),void 0!==e.approved?((0,s.uX)(),(0,s.CE)("div",{key:2,class:(0,d.C4)(["decision-tag",{approved:!0===e.approved,rejected:!1===e.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",{"fa-check-circle":!0===e.approved,"fa-times-circle":!1===e.approved}])},null,2),(0,s.eW)(" "+(0,d.v_)(e.approved?"Approved":"Rejected"),1)],2)):(0,s.Q3)("",!0),!1===e.approved&&e.remarks?((0,s.uX)(),(0,s.CE)("div",Nge,[t[117]||(t[117]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Reviewer Feedback")],-1)),(0,s.Lk)("p",Mge,(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",Xge,[!0===e.approved||!1===e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",$ge,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!0),class:"approve-btn"},t[119]||(t[119]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve ")]),8,Oge),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!1),class:"reject-btn"},t[120]||(t[120]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Reject ")]),8,jge)])),!1!==e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Bge,[t[123]||(t[123]=(0,s.Lk)("label",{for:"remarks"},"Feedback (required for rejection):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"remarks","onUpdate:modelValue":t=>e.remarks=t,class:"remarks-input",placeholder:"Provide feedback explaining why this mitigation was rejected..."},null,8,Wge),[[a.Jo,e.remarks]]),(0,s.Lk)("button",{onClick:e=>n.updateRemarks(i),class:"save-remarks-btn"},t[121]||(t[121]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Feedback ")]),8,qge),(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!0),class:"change-decision-btn"},t[122]||(t[122]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Approve ")]),8,Qge)])),!0!==e.approved||l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Kge,[(0,s.Lk)("button",{onClick:e=>n.approveMitigation(i,!1),class:"change-decision-btn"},t[124]||(t[124]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Reject ")]),8,Jge)])),!1===e.approved&&l.reviewCompleted&&e.remarks?((0,s.uX)(),(0,s.CE)("div",zge,[t[125]||(t[125]=(0,s.Lk)("h5",null,[(0,s.Lk)("i",{class:"fas fa-comment-exclamation"}),(0,s.eW)(" Rejection Feedback")],-1)),(0,s.Lk)("p",null,(0,d.v_)(e.remarks),1)])):(0,s.Q3)("",!0)])],8,Khe))),128))]),(0,s.Lk)("div",Hge,[t[168]||(t[168]=(0,s.Lk)("h4",null,"Risk Mitigation Questionnaire",-1)),void 0!==l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",{key:0,class:(0,d.C4)(["approval-status",{approved:l.formDetails.approved,rejected:!1===l.formDetails.approved}])},[(0,s.Lk)("i",{class:(0,d.C4)(["fas",l.formDetails.approved?"fa-check-circle":"fa-times-circle"])},null,2),(0,s.eW)(" "+(0,d.v_)(l.formDetails.approved?"Questionnaire Approved":"Revisions Requested"),1)],2)):(0,s.Q3)("",!0),(0,s.Lk)("div",Gge,[l.formDetails.user_submitted_date?((0,s.uX)(),(0,s.CE)("div",Yge,[t[126]||(t[126]=(0,s.Lk)("i",{class:"fas fa-clock"},null,-1)),(0,s.eW)(" Submitted: "+(0,d.v_)(n.formatDateTime(l.formDetails.user_submitted_date)),1)])):(0,s.Q3)("",!0),l.formDetails.reviewer_submitted_date?((0,s.uX)(),(0,s.CE)("div",Zge,[t[127]||(t[127]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.eW)(" Reviewed: "+(0,d.v_)(n.formatDateTime(l.formDetails.reviewer_submitted_date)),1)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",eye,[t[130]||(t[130]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"1. What is the cost for this mitigation?")],-1)),(0,s.Lk)("div",tye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",iye,[t[128]||(t[128]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("cost"))+" "+(0,d.v_)(n.getPreviousFormDetail("costCurrency")||"USD"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("cost")}])},[t[129]||(t[129]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.cost||"Not specified")+" "+(0,d.v_)(l.formDetails.costCurrency||"USD"),1)],2)])]),(0,s.Lk)("div",aye,[t[133]||(t[133]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"2. What is the impact for this mitigation?")],-1)),(0,s.Lk)("div",sye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",oye,[t[131]||(t[131]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("impact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("impact")}])},[t[132]||(t[132]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.impact||"Not specified"),1)],2)])]),(0,s.Lk)("div",lye,[t[136]||(t[136]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"3. What is the financial impact for this mitigation?")],-1)),(0,s.Lk)("div",nye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",rye,[t[134]||(t[134]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("financialImpact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("financialImpact")}])},[t[135]||(t[135]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.financialImpact||"Not specified"),1)],2)])]),(0,s.Lk)("div",cye,[t[139]||(t[139]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"4. What is the reputational impact for this mitigation?")],-1)),(0,s.Lk)("div",dye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",uye,[t[137]||(t[137]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("reputationalImpact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("reputationalImpact")}])},[t[138]||(t[138]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.reputationalImpact||"Not specified"),1)],2)])]),(0,s.Lk)("div",pye,[t[142]||(t[142]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"5. What is the Operational Impact for this mitigation?")],-1)),(0,s.Lk)("div",mye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",vye,[t[140]||(t[140]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("operationalImpact")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("operationalImpact")}])},[t[141]||(t[141]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.operationalImpact||"Not specified"),1)],2)])]),(0,s.Lk)("div",kye,[t[145]||(t[145]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"6. What is the Financial Loss for this mitigation?")],-1)),(0,s.Lk)("div",hye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",gye,[t[143]||(t[143]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("financialLoss"))+" "+(0,d.v_)(n.getPreviousFormDetail("financialLossCurrency")||"USD"),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("financialLoss")}])},[t[144]||(t[144]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.financialLoss||"Not specified")+" "+(0,d.v_)(l.formDetails.financialLossCurrency||"USD"),1)],2)])]),(0,s.Lk)("div",yye,[t[148]||(t[148]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"7. What is the expected system downtime (hrs) if this risk occurs?")],-1)),(0,s.Lk)("div",fye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",bye,[t[146]||(t[146]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("systemDowntime")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("systemDowntime")}])},[t[147]||(t[147]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.systemDowntime||"Not specified"),1)],2)])]),(0,s.Lk)("div",Cye,[t[151]||(t[151]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"8. How long did it take to recover last time (hrs)?")],-1)),(0,s.Lk)("div",Lye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",wye,[t[149]||(t[149]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("recoveryTime")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("recoveryTime")}])},[t[150]||(t[150]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.recoveryTime||"Not specified"),1)],2)])]),(0,s.Lk)("div",Eye,[t[154]||(t[154]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"9. Is it possible that this risk will recur again?")],-1)),(0,s.Lk)("div",Rye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",Iye,[t[152]||(t[152]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("recurrencePossible")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("recurrencePossible")}])},[t[153]||(t[153]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.recurrencePossible||"Not specified"),1)],2)])]),(0,s.Lk)("div",Dye,[t[157]||(t[157]=(0,s.Lk)("div",{class:"form-field-label"},[(0,s.Lk)("h5",null,"10. Is this an Improvement Initiative which will prevent the future recurrence of said risk?")],-1)),(0,s.Lk)("div",Pye,[l.previousFormDetails?((0,s.uX)(),(0,s.CE)("div",_ye,[t[155]||(t[155]=(0,s.Lk)("div",{class:"version-label"},"Previous Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(n.getPreviousFormDetail("improvementInitiative")),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,d.C4)(["form-field-current",{"highlight-changed":n.hasFormFieldChanged("improvementInitiative")}])},[t[156]||(t[156]=(0,s.Lk)("div",{class:"version-label"},"Current Version",-1)),(0,s.Lk)("p",null,(0,d.v_)(l.formDetails.improvementInitiative||"Not specified"),1)],2)])]),l.reviewCompleted?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Aye,[void 0===l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",Sye,[(0,s.Lk)("button",{onClick:t[22]||(t[22]=e=>n.approveQuestionnaire(!0)),class:"approve-btn"},t[158]||(t[158]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1),(0,s.eW)(" Approve Questionnaire ")])),(0,s.Lk)("button",{onClick:t[23]||(t[23]=e=>n.approveQuestionnaire(!1)),class:"reject-btn"},t[159]||(t[159]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Request Revisions ")]))])):(0,s.Q3)("",!0),!0===l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",Tye,[t[161]||(t[161]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),t[162]||(t[162]=(0,s.eW)(" Questionnaire Approved ")),(0,s.Lk)("button",{onClick:t[24]||(t[24]=e=>n.approveQuestionnaire(!1)),class:"change-decision-btn"},t[160]||(t[160]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Reject ")]))])):(0,s.Q3)("",!0),!1===l.formDetails.approved?((0,s.uX)(),(0,s.CE)("div",xye,[t[166]||(t[166]=(0,s.Lk)("i",{class:"fas fa-times-circle"},null,-1)),t[167]||(t[167]=(0,s.eW)(" Revisions Requested ")),(0,s.Lk)("div",Fye,[t[165]||(t[165]=(0,s.Lk)("label",{for:"questionnaire-remarks"},"Feedback (required):",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"questionnaire-remarks","onUpdate:modelValue":t[25]||(t[25]=e=>l.formDetails.remarks=e),class:"remarks-input",placeholder:"Provide feedback on the questionnaire..."},null,512),[[a.Jo,l.formDetails.remarks]]),(0,s.Lk)("div",Vye,[(0,s.Lk)("button",{onClick:t[26]||(t[26]=(...e)=>n.saveQuestionnaireRemarks&&n.saveQuestionnaireRemarks(...e)),class:"save-remarks-btn"},t[163]||(t[163]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Feedback ")])),(0,s.Lk)("button",{onClick:t[27]||(t[27]=e=>n.approveQuestionnaire(!0)),class:"change-decision-btn"},t[164]||(t[164]=[(0,s.Lk)("i",{class:"fas fa-exchange-alt"},null,-1),(0,s.eW)(" Change to Approve ")]))])])])):(0,s.Q3)("",!0)]))]),(0,s.Lk)("div",Uye,[(0,s.Lk)("button",{class:"submit-review-btn",disabled:l.reviewCompleted,onClick:t[28]||(t[28]=e=>n.submitReview(!0))},t[169]||(t[169]=[(0,s.Lk)("i",{class:"fas fa-check-double"},null,-1),(0,s.eW)(" Approve Risk ")]),8,Nye),(0,s.Lk)("button",{class:"reject-review-btn",disabled:l.reviewCompleted,onClick:t[29]||(t[29]=e=>n.submitReview(!1))},t[170]||(t[170]=[(0,s.Lk)("i",{class:"fas fa-comment-dots"},null,-1),(0,s.eW)(" Send Feedback to User ")]),8,Mye),l.reviewCompleted?((0,s.uX)(),(0,s.CE)("div",Xye," This review has been completed ")):(0,s.Q3)("",!0)])]))])):(0,s.Q3)("",!0),(0,s.bF)(c)])}var Oye={name:"UserTasks",components:{CustomDropdown:xa.A,PopupModal:Ta},data(){return{userRisks:[],reviewerTasks:[],users:[],selectedUserId:"",loading:!0,error:null,showMitigationWorkflow:!1,showReviewerWorkflow:!1,loadingMitigations:!1,mitigationSteps:[],selectedRiskId:null,selectedReviewer:"",activeTab:"user",showReviewerModal:!1,mitigationReviewData:{},currentReviewTask:null,userNotifications:[],reviewCompleted:!1,reviewApproved:!1,loggedInUser:null,isLoadingUser:!0,formDetails:{cost:"",costCurrency:"USD",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",financialLossCurrency:"USD",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:"",approved:void 0,remarks:"",user_submitted_date:null,reviewer_submitted_date:null},previousVersions:{},previousFormDetails:null,showQuestionnaire:!1,questionnaireDetails:null,allVersions:[],selectedVersions:{},loadingVersions:!1,versionData:{},showVersionDropdowns:!0,globalSelectedVersion:"",allVersionNames:[],userDropdownConfig:{name:"Select User",values:[]}}},computed:{isGRCAdministrator(){return this.loggedInUser&&"GRC Administrator"===this.loggedInUser.role},userCount(){return console.log("Current users in data:",this.users.length,this.users),this.users.length},allStepsCompleted(){const e=this.mitigationSteps.filter(e=>!0!==Boolean(e.approved));return e.length>0&&e.every(e=>"Completed"===e.status)},canSubmit(){return!0},canSubmitReview(){return!0},questionnaireReviewed(){return this.latestReview&&this.latestReview.risk_form_details&&(!0===this.latestReview.risk_form_details.approved||!1===this.latestReview.risk_form_details.approved)},questionnaireApproved(){return this.latestReview&&this.latestReview.risk_form_details&&!0===this.latestReview.risk_form_details.approved},questionnaireRejected(){return this.latestReview&&this.latestReview.risk_form_details&&!1===this.latestReview.risk_form_details.approved},questionnaireRemarks(){return this.latestReview&&this.latestReview.risk_form_details&&this.latestReview.risk_form_details.remarks?this.latestReview.risk_form_details.remarks:""},filteredVersions(){return this.allVersions.filter(e=>e.version!==this.currentReviewTask?.version)}},watch:{users:{immediate:!0,handler(e){this.userDropdownConfig.values=[{value:"",label:"All Users"},...e.map(e=>({value:e.UserId,label:`${e.UserName}${e.department?` (${e.department})`:""}`}))]}}},mounted(){this.fetchUsers(),this.fetchLoggedInUser(),setTimeout(()=>{0===this.users.length&&this.fetchUsers()},500)},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},async fetchLoggedInUser(){this.isLoadingUser=!0;try{const e=await He.A.get("http://localhost:8000/api/current-user/");this.loggedInUser=e.data,console.log("Logged in user:",this.loggedInUser),this.isGRCAdministrator||(this.selectedUserId=this.loggedInUser.UserId,console.log("Auto-selected user ID:",this.selectedUserId)),this.isGRCAdministrator?await this.fetchUsers():(this.users=[this.loggedInUser],this.loading=!1),this.fetchData()}catch(e){console.error("Error fetching logged-in user:",e),console.error("Error sending push notification:",e),this.error=`Failed to fetch user details: ${e.message}`}finally{this.isLoadingUser=!1}},fetchUsers(){if(console.log("Fetching users..."),this.loading=!0,!this.isGRCAdministrator)return console.log("Not GRC Administrator, skipping user list fetch"),void(this.loading=!1);He.A.get("http://localhost:8000/api/custom-users/").then(e=>{if(console.log("User data received:",e.data),!(Array.isArray(e.data)&&e.data.length>0))return He.A.get("http://localhost:8000/api/users-for-dropdown/");this.users=e.data,this.loading=!1}).then(e=>{e&&e.data&&(console.log("User data from dropdown endpoint:",e.data),this.users=e.data),this.loading=!1}).catch(e=>{console.error("Error fetching users:",e),this.error=`Failed to fetch users: ${e.message}`,this.loading=!1})},fetchData(){if(!this.selectedUserId)return this.userRisks=[],void(this.reviewerTasks=[]);this.loading=!0,Promise.all([He.A.get(`http://localhost:8000/api/user-risks/${this.selectedUserId}/`),He.A.get(`http://localhost:8000/api/reviewer-tasks/${this.selectedUserId}/`)]).then(([e,t])=>{this.userRisks=e.data,this.reviewerTasks=t.data,this.userRisks.forEach((e,t)=>{He.A.get(`http://localhost:8000/api/latest-review/${e.RiskInstanceId}/`).then(i=>{if(i.data&&i.data.user_submitted_date){const a=[...this.userRisks];a[t]={...e,last_submitted:i.data.user_submitted_date},this.userRisks=a}else if(i.data&&i.data.submission_date){const a=[...this.userRisks];a[t]={...e,last_submitted:i.data.submission_date},this.userRisks=a}}).catch(t=>{console.error(`Error fetching latest review for risk ${e.RiskInstanceId}:`,t)})}),console.log("User risks:",this.userRisks),this.userRisks.forEach(e=>{"Revision Required"===e.RiskStatus?(e.hasNotification=!0,e.approved=!1):"Approved"===e.RiskStatus&&(e.hasNotification=!0,e.approved=!0)}),this.loading=!1,this.error=null}).catch(e=>{console.error("Error fetching data:",e),this.error=`Failed to fetch data: ${e.message}`,this.loading=!1})},getUserName(e){const t=this.users.find(t=>t.UserId==e);return t?t.UserName:"Unknown"},startWork(e){this.loading=!0,console.log(`Starting work on risk ID: ${e}`);const t={risk_id:e,status:"Work In Progress"};console.log("Sending request data:",t),He.A.post("http://localhost:8000/api/update-mitigation-status/",t).then(t=>{console.log("Status updated:",t.data);const i=this.userRisks.findIndex(t=>t.RiskInstanceId===e);-1!==i&&(this.userRisks[i].MitigationStatus="Work In Progress"),this.loading=!1}).catch(e=>{console.error("Error updating status:",e),console.error("Error response:",e.response?e.response.data:"No response data"),this.error=`Failed to update status: ${e.message}`,this.loading=!1})},completeMitigation(e){this.loading=!0,He.A.post("http://localhost:8000/api/update-mitigation-status/",{risk_id:e,status:"Completed"}).then(t=>{console.log("Status updated:",t.data);const i=this.userRisks.findIndex(t=>t.RiskInstanceId===e);-1!==i&&(this.userRisks[i].MitigationStatus="Completed",this.userRisks[i].RiskStatus="Approved"),this.loading=!1,this.sendPushNotification({title:"Mitigation Completed",message:`Mitigation for risk ${e} has been marked as completed successfully.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.success("Mitigation marked as completed!","Success")}).catch(t=>{console.error("Error updating status:",t),this.sendPushNotification({title:"Mitigation Completion Failed",message:`Failed to mark mitigation for risk ${e} as completed: ${t.message}`,category:"risk",priority:"high",user_id:this.selectedUserId||"default_user"}),this.error=`Failed to update status: ${t.message}`,this.loading=!1})},viewMitigations(e){this.selectedRiskId=e,this.loadingMitigations=!0,this.showMitigationWorkflow=!0,He.A.get(`http://localhost:8000/api/risk-mitigations/${e}/`).then(t=>{console.log("Mitigations received:",t.data),this.mitigationSteps=this.parseMitigations(t.data),He.A.get(`http://localhost:8000/api/risk-form-details/${e}/`).then(t=>{console.log("Form details received:",t.data),this.formDetails={cost:String(t.data.cost||""),costCurrency:t.data.costCurrency||"USD",impact:String(t.data.impact||""),financialImpact:String(t.data.financialImpact||""),reputationalImpact:String(t.data.reputationalImpact||""),operationalImpact:String(t.data.operationalImpact||""),financialLoss:String(t.data.financialLoss||""),financialLossCurrency:t.data.financialLossCurrency||"USD",systemDowntime:String(t.data.systemDowntime||""),recoveryTime:String(t.data.recoveryTime||""),recurrencePossible:t.data.recurrencePossible||"",improvementInitiative:t.data.improvementInitiative||"",approved:t.data.approved,remarks:t.data.remarks||"",user_submitted_date:t.data.user_submitted_date||t.data.submission_date,reviewer_submitted_date:t.data.reviewer_submitted_date},He.A.get(`http://localhost:8000/api/latest-review/${e}/`).then(t=>{const i=t.data;if(console.log("Latest review data:",i),this.latestReview=i,i&&i.risk_form_details&&(this.formDetails={...this.formDetails,approved:i.risk_form_details.approved,remarks:i.risk_form_details.remarks||"",user_submitted_date:i.user_submitted_date||i.submission_date,reviewer_submitted_date:i.reviewer_submitted_date||i.review_date}),i&&i.mitigations){const e=[];Object.keys(i.mitigations).forEach(t=>{const a=i.mitigations[t];let s;"approved"in a&&(s=!0===a.approved||"true"===a.approved),e.push({title:`Step ${t}`,description:a.description,status:a.status||"Completed",approved:s,remarks:a.remarks||"",comments:a.comments||"",fileData:a.fileData,fileName:a.fileName,user_submitted_date:a.user_submitted_date,reviewer_submitted_date:a.reviewer_submitted_date})}),this.mitigationSteps=e}He.A.get(`http://localhost:8000/api/get-assigned-reviewer/${e}/`).then(e=>{console.log("Reviewer response:",e.data),e.data&&e.data.reviewer_name?e.data.reviewer_id?(this.selectedReviewer=e.data.reviewer_id,console.log(`Using reviewer ID: ${this.selectedReviewer}`)):(this.selectedReviewer=e.data.reviewer_name,console.log(`No reviewer ID available, using name: ${this.selectedReviewer}`)):(this.sendPushNotification({title:"No Reviewer Assigned",message:`No reviewer has been assigned to risk ${this.selectedRiskId}. Please contact your administrator.`,category:"risk",priority:"high",user_id:this.selectedUserId||"default_user"}),ya.warning("No reviewer has been assigned to this risk yet. Please contact your administrator.","No Reviewer Assigned"),this.selectedReviewer=""),this.loadingMitigations=!1,this.showQuestionnaire=!0}).catch(e=>{console.error("Error fetching assigned reviewer:",e),this.sendPushNotification({title:"Reviewer Information Error",message:`Could not fetch reviewer information for risk ${this.selectedRiskId}. Please try again later.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.error("Could not fetch reviewer information. Please try again later.","Error"),this.selectedReviewer="",this.loadingMitigations=!1,this.showQuestionnaire=!0})}).catch(e=>{console.error("Error fetching latest review:",e),this.loadingMitigations=!1,this.showQuestionnaire=!0})}).catch(e=>{console.error("Error fetching form details:",e),this.formDetails={cost:"",costCurrency:"USD",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",financialLossCurrency:"USD",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:"",approved:void 0,remarks:""},this.loadingMitigations=!1,this.showQuestionnaire=!0})}).catch(e=>{console.error("Error fetching mitigations:",e),this.mitigationSteps=[],this.loadingMitigations=!1,this.showQuestionnaire=!0})},fetchLatestReviewerData(e){He.A.get(`http://localhost:8000/api/latest-review/${e}/`).then(e=>{if(console.log("Latest review data:",e.data),e.data&&e.data.mitigations){const t=e.data;this.mitigationSteps.forEach((e,i)=>{const a=e.title.replace("Step ","")||(i+1).toString();if(t.mitigations[a]){const i=t.mitigations[a];e.approved=i.approved,e.remarks=i.remarks||"",i.comments&&(e.comments=i.comments),i.fileData&&(e.fileData=i.fileData,e.fileName=i.fileName)}})}this.loadingMitigations=!1}).catch(e=>{console.error("Error fetching review data:",e),this.loadingMitigations=!1})},parseMitigations(e){if(e&&"object"===typeof e&&!Array.isArray(e)){const t=Object.keys(e);if(t.length>0&&!isNaN(Number(t[0]))){const i=[];t.sort((e,t)=>Number(e)-Number(t));for(const a of t)i.push({title:`Step ${a}`,description:e[a],status:"Not Started"});for(const e of i)e.comments=e.comments||"",e.fileData=e.fileData||null,e.fileName=e.fileName||null;return i}}if(Array.isArray(e))return e;if("string"===typeof e)try{const t=JSON.parse(e);return t&&"object"===typeof t&&!Array.isArray(t)?this.parseMitigations(t):Array.isArray(t)?t:[t]}catch(t){return console.error("Error parsing mitigation JSON:",t),[{title:"Mitigation",description:e}]}return[{title:"Mitigation",description:"No detailed mitigation steps available"}]},closeMitigationModal(){this.showMitigationWorkflow=!1,this.mitigationSteps=[],this.selectedRiskId=null},updateStepStatus(e,t){console.log(`Updating step ${e+1} status to ${t}`),this.mitigationSteps[e].status=t},submitForReview(){if(!this.isQuestionnaireComplete())return this.sendPushNotification({title:"Incomplete Questionnaire",message:`Please complete all questionnaire fields for risk ${this.selectedRiskId} before submitting.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),void ya.warning("Please complete all questionnaire fields before submitting","Incomplete Form");this.loading=!0;const e={};this.mitigationSteps.forEach((t,i)=>{const a=t.title.replace("Step ","")||(i+1).toString();if(!0===t.approved)e[a]={description:t.description,status:t.status||"Completed",approved:!0,remarks:"",comments:t.comments||"",fileData:t.fileData,fileName:t.fileName};else{const i={description:t.description,status:t.status||"Completed",comments:t.comments||"",fileData:t.fileData,fileName:t.fileName};!1===t.approved&&(i.approved=!1,i.remarks=t.remarks||""),e[a]=i}});const t={...this.formDetails,user_submitted_date:(new Date).toISOString()};console.log(`Submitting for review with reviewer ID: ${this.selectedReviewer}, type: ${typeof this.selectedReviewer}`),He.A.post("http://localhost:8000/api/assign-reviewer/",{risk_id:this.selectedRiskId,reviewer_id:this.selectedReviewer,user_id:this.selectedUserId,mitigations:e,risk_form_details:t,create_approval_record:!0}).then(e=>{console.log("Submission response:",e.data);const t=this.userRisks.findIndex(e=>e.RiskInstanceId===this.selectedRiskId);-1!==t&&(this.userRisks[t].MitigationStatus="Under Review",this.userRisks[t].RiskStatus="Revision Required by Reviewer"),this.loading=!1,this.closeMitigationModal(),this.sendPushNotification({title:"Risk Submitted for Review",message:`Risk ${this.selectedRiskId} has been submitted for review successfully.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.success("Risk submitted for review successfully!","Success")}).catch(e=>{console.error("Error submitting for review:",e),this.loading=!1,this.sendPushNotification({title:"Risk Submission Failed",message:`Failed to submit risk ${this.selectedRiskId} for review: ${e.message}`,category:"risk",priority:"high",user_id:this.selectedUserId||"default_user"}),ya.error("Failed to submit for review. Please try again.","Submission Failed")})},closeReviewerModal(){this.showReviewerWorkflow=!1,this.currentReviewTask=null,this.mitigationReviewData={},this.previousVersions={},this.previousFormDetails=null,this.reviewCompleted=!1,this.reviewApproved=!1,this.allVersions=[],this.selectedVersions={},this.versionData={},this.loadingVersions=!1},approveMitigation(e,t){const i={...this.mitigationReviewData[e],approved:t,reviewer_submitted_date:(new Date).toISOString()};t&&(i.remarks=""),this.mitigationReviewData={...this.mitigationReviewData,[e]:i};const a=document.querySelector(`.mitigation-review-item[data-id="${e}"]`);if(a){const e=a.querySelector(".mitigation-status-badge");e&&(e.className="mitigation-status-badge "+(t?"approved":"rejected"),e.innerHTML=t?'<i class="fas fa-check-circle"></i> Approved':'<i class="fas fa-times-circle"></i> Rejected')}},submitReview(e){this.loading=!0;const t={approval_id:this.currentReviewTask.RiskInstanceId,risk_id:this.currentReviewTask.RiskInstanceId,approved:e,mitigations:this.mitigationReviewData,risk_form_details:{...this.formDetails,approved:this.formDetails.approved,remarks:this.formDetails.remarks||""}};console.log("SUBMITTING REVIEW DATA:",JSON.stringify(t,null,2)),He.A.post("http://localhost:8000/api/complete-review/",t).then(t=>{console.log("Review completed:",t.data),this.loading=!1;const i=this.reviewerTasks.findIndex(e=>e.RiskInstanceId===this.currentReviewTask.RiskInstanceId);if(-1!==i&&this.reviewerTasks.splice(i,1),this.reviewCompleted=!0,this.reviewApproved=e,-1!==i){const t=e?"Approved":"Revision Required by User";this.currentReviewTask.RiskStatus=t,this.currentReviewTask.MitigationStatus=e?"Completed":"Revision Required"}this.sendPushNotification({title:"Risk "+(e?"Approved":"Rejected"),message:`Risk ${this.currentReviewTask.RiskInstanceId} has been ${e?"approved":"rejected"} by reviewer.`,category:"risk",priority:"high",user_id:this.currentReviewTask.UserId||"default_user"}),ya.success(`Risk ${e?"approved":"rejected"} successfully!`,"Review Complete"),setTimeout(()=>{this.closeReviewerModal()},2500)}).catch(e=>{console.error("Error completing review:",e),this.loading=!1,this.sendPushNotification({title:"Review Submission Failed",message:`Failed to submit review for risk ${this.currentReviewTask.RiskInstanceId}: ${e.message}`,category:"risk",priority:"high",user_id:this.currentReviewTask.UserId||"default_user"}),ya.error("Failed to submit review. Please try again.","Review Failed")})},updateRemarks(e){if(!this.mitigationReviewData[e].remarks.trim())return this.sendPushNotification({title:"Missing Remarks",message:`Please provide remarks for rejection of mitigation ${e} in risk ${this.currentReviewTask?.RiskInstanceId||this.selectedRiskId}.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),void ya.warning("Please provide remarks for rejection","Missing Remarks");this.mitigationReviewData={...this.mitigationReviewData},console.log(`Mitigation ${e} remarks updated successfully`)},handleFileUpload(e,t){const i=e.target.files[0];if(!i)return;if(i.size>5242880)return this.sendPushNotification({title:"File Size Limit Exceeded",message:`File "${i.name}" exceeds the 5MB size limit for risk ${this.selectedRiskId}.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.warning("File size exceeds 5MB limit","File Size Limit"),void(e.target.value="");const a=new FileReader;a.onload=e=>{this.mitigationSteps[t].fileData=e.target.result,this.mitigationSteps[t].fileName=i.name;const a=new FormData;a.append("file",i),a.append("userId",this.selectedUserId||"default-user"),a.append("fileName",i.name),a.append("riskId",this.selectedRiskId),a.append("category",this.userRisks.find(e=>e.RiskInstanceId===this.selectedRiskId)?.Category||"general"),a.append("mitigationNumber",t+1),He.A.post("http://localhost:5000/api/upload",a,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>{console.log("File uploaded successfully to S3:",e.data),e.data.success?(this.mitigationSteps[t].savedFileName=e.data.file.fileName,this.mitigationSteps[t].s3FileInfo=e.data.file,this.mitigationSteps[t].s3Url=e.data.file.url,this.sendPushNotification({title:"File Upload Successful",message:`File "${i.name}" has been uploaded successfully for risk ${this.selectedRiskId}.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.success("File uploaded successfully","Success")):(console.error("S3 upload returned error:",e.data),this.sendPushNotification({title:"File Upload Failed",message:`Failed to upload file "${i.name}" for risk ${this.selectedRiskId}.`,category:"risk",priority:"high",user_id:this.selectedUserId||"default_user"}),ya.error("Error uploading file. Please try again.","Upload Failed"))}).catch(e=>{console.error("Error uploading file to S3:",e),this.sendPushNotification({title:"File Upload Failed",message:`Failed to upload file "${i.name}" for risk ${this.selectedRiskId}: ${e.message}`,category:"risk",priority:"high",user_id:this.selectedUserId||"default_user"}),ya.error("Error uploading file. Please try again.","Upload Failed")})},a.readAsDataURL(i)},removeFile(e){if(this.mitigationSteps[e].s3FileInfo&&this.mitigationSteps[e].s3FileInfo.id){const t=this.mitigationSteps[e].s3FileInfo.id;He.A.delete(`http://localhost:5000/api/file/${t}`).then(t=>{console.log("File deleted from S3:",t.data),this.sendPushNotification({title:"File Removed Successfully",message:`File has been removed successfully from risk ${this.selectedRiskId}.`,category:"risk",priority:"low",user_id:this.selectedUserId||"default_user"}),this.mitigationSteps[e].fileData=null,this.mitigationSteps[e].fileName=null,this.mitigationSteps[e].s3FileInfo=null,this.mitigationSteps[e].s3Url=null,document.getElementById(`file-upload-${e}`).value=""}).catch(t=>{console.error("Error deleting file from S3:",t),this.sendPushNotification({title:"File Removal Warning",message:`File preview cleared but file may still exist on server for risk ${this.selectedRiskId}.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.warning("Error removing file. The file preview will be cleared, but the file may still exist on the server.","File Removal Warning"),this.mitigationSteps[e].fileData=null,this.mitigationSteps[e].fileName=null,this.mitigationSteps[e].s3FileInfo=null,this.mitigationSteps[e].s3Url=null,document.getElementById(`file-upload-${e}`).value=""})}else this.mitigationSteps[e].fileData=null,this.mitigationSteps[e].fileName=null,this.mitigationSteps[e].s3FileInfo=null,this.mitigationSteps[e].s3Url=null,document.getElementById(`file-upload-${e}`).value=""},fetchReviewerComments(e){He.A.get(`http://localhost:8000/api/reviewer-comments/${e}/`).then(t=>{const i=this.userRisks.findIndex(t=>t.RiskInstanceId===e);if(-1!==i){const e=[...this.userRisks];e[i]={...this.userRisks[i],reviewerComments:t.data},this.userRisks=e}}).catch(e=>{console.error("Error fetching reviewer comments:",e)})},getStatusClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("approved")?"status-approved":t.includes("revision required by user")?"status-revision-user":t.includes("revision required by reviewer")?"status-revision-reviewer":t.includes("revision")?"status-revision":t.includes("under review")?"status-review":t.includes("progress")?"status-progress":""},completeStep(e){this.mitigationSteps[e].status="Completed",this.$nextTick(()=>{setTimeout(()=>{const e=document.querySelector(".timeline");e&&(e.classList.add("step-completed"),setTimeout(()=>{e.classList.remove("step-completed")},1e3))},50)})},resetStep(e){this.mitigationSteps[e].status="In Progress"},isStepActive(e){return!1===this.mitigationSteps[e].approved||"Completed"!==this.mitigationSteps[e].status},isStepLocked(){return!1},formatDate(e){if(!e)return"Not set";const t=new Date(e);return t.toLocaleDateString()},getDueStatusClass(e){if(!e)return"";const t=new Date(e),i=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const a=Math.floor((t-i)/864e5);return a<0?"risk-workflow-overdue":a<=3?"risk-workflow-urgent":a<=7?"risk-workflow-warning":"risk-workflow-on-track"},getDueStatusText(e){if(!e)return"";const t=new Date(e),i=new Date;t.setHours(0,0,0,0),i.setHours(0,0,0,0);const a=Math.floor((t-i)/864e5);return a<0?`(Delayed by ${Math.abs(a)} days)`:0===a?"(Due today)":1===a?"(Due tomorrow)":`(${a} days left)`},getMitigationStatusClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("completed")?"risk-workflow-status-completed":t.includes("progress")?"risk-workflow-status-progress":t.includes("revision")?"risk-workflow-status-revision":t.includes("yet to start")?"risk-workflow-status-not-started":""},hasApprovalVersion(e){try{if(e.ExtractedInfo){const t=JSON.parse(e.ExtractedInfo);return t&&t.version}}catch(t){console.error("Error checking approval version:",t)}return!1},isQuestionnaireComplete(){return!0},validateQuestionnaire(){},async reviewMitigations(e){this.currentReviewTask=e,this.selectedRiskId=e.RiskInstanceId,this.loadingMitigations=!0,this.showReviewerWorkflow=!0,this.previousVersions={};try{const t=JSON.parse(e.ExtractedInfo);if(console.log("Extracted info:",t),t&&t.mitigations){if(this.mitigationReviewData=t.mitigations,t.risk_form_details){const e=t.risk_form_details;this.formDetails={cost:String(e.cost??""),costCurrency:e.costCurrency??"USD",impact:String(e.impact??""),financialImpact:String(e.financialImpact??e.financialimpact??""),reputationalImpact:String(e.reputationalImpact??e.reputationalimpact??""),operationalImpact:String(e.operationalImpact??e.operationalimpact??""),financialLoss:String(e.financialLoss??e.financialloss??""),financialLossCurrency:e.financialLossCurrency??"USD",systemDowntime:String(e.systemDowntime??e.expecteddowntime??""),recoveryTime:String(e.recoveryTime??e.recoverytime??""),recurrencePossible:e.recurrencePossible??e.riskrecurrence??"",improvementInitiative:e.improvementInitiative??e.improvementinitiative??"",approved:e.approved,remarks:e.remarks||"",user_submitted_date:e.user_submitted_date||t.user_submitted_date,reviewer_submitted_date:e.reviewer_submitted_date}}else this.formDetails={cost:"",costCurrency:"USD",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",financialLossCurrency:"USD",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:"",approved:void 0,remarks:""};e.PreviousVersion&&e.PreviousVersion.mitigations&&(this.previousVersions=e.PreviousVersion.mitigations,e.PreviousVersion.risk_form_details&&(this.previousFormDetails=e.PreviousVersion.risk_form_details));const i="Approved"===e.RiskStatus||"Revision Required"===e.RiskStatus;this.reviewCompleted=i,this.reviewApproved="Approved"===e.RiskStatus,await this.fetchAllVersions(),this.loadingMitigations=!1}else this.mitigationReviewData={},console.error("No mitigations found in ExtractedInfo"),this.loadingMitigations=!1}catch(t){console.error("Error parsing ExtractedInfo:",t),this.mitigationReviewData={},this.loadingMitigations=!1}},approveQuestionnaire(e){this.formDetails.approved=e,this.formDetails.reviewer_submitted_date=(new Date).toISOString(),e||this.formDetails.remarks||(this.formDetails.remarks=""),e&&(this.formDetails.remarks="")},saveQuestionnaireRemarks(){if(!1===this.formDetails.approved&&!this.formDetails.remarks.trim())return this.sendPushNotification({title:"Missing Questionnaire Feedback",message:`Please provide feedback for the questionnaire in risk ${this.currentReviewTask?.RiskInstanceId||this.selectedRiskId}.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),void ya.warning("Please provide feedback for the questionnaire","Missing Feedback");this.sendPushNotification({title:"Questionnaire Feedback Saved",message:`Questionnaire feedback has been saved for risk ${this.currentReviewTask?.RiskInstanceId||this.selectedRiskId}.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.success("Questionnaire feedback saved","Success")},formatDateTime(e){if(!e)return"N/A";try{const t=new Date(e);return t.toLocaleString()}catch(t){return"Invalid Date"}},getSubmissionDate(e){try{if(e.ExtractedInfo){const t=JSON.parse(e.ExtractedInfo);return t.user_submitted_date||t.submission_date}}catch(t){console.error("Error parsing submission date:",t)}return null},getPreviousMitigation(e){return this.previousVersions&&this.previousVersions[e]?this.previousVersions[e]:null},getPreviousFormDetail(e){return this.previousFormDetails?this.previousFormDetails[e]||"Not specified":null},hasFormFieldChanged(e){if(!this.previousFormDetails)return!1;const t=this.previousFormDetails[e]||"",i=this.formDetails[e]||"";if("cost"===e){const e=this.previousFormDetails.costCurrency||"USD",a=this.formDetails.costCurrency||"USD";return t!==i||e!==a}if("financialLoss"===e){const e=this.previousFormDetails.financialLossCurrency||"USD",a=this.formDetails.financialLossCurrency||"USD";return t!==i||e!==a}return t!==i},getFieldLabel(e){const t={cost:"Cost for Mitigation",impact:"Impact for Mitigation",financialImpact:"Financial Impact",reputationalImpact:"Reputational Impact"};return t[e]||e},fetchQuestionnaire(e){He.A.get(`http://localhost:8000/api/risk-instances/${e}/`).then(e=>{let t=e.data.RiskFormDetails;if("string"===typeof t)try{t=JSON.parse(t)}catch{t={}}this.questionnaireDetails=this.mapRiskFormDetails(t),this.showQuestionnaire=!0})},mapRiskFormDetails(e){if(!e)return{cost:"",costCurrency:"USD",impact:"",financialImpact:"",reputationalImpact:"",operationalImpact:"",financialLoss:"",financialLossCurrency:"USD",systemDowntime:"",recoveryTime:"",recurrencePossible:"",improvementInitiative:""};function t(e){if(!e)return"";if("string"===typeof e){if("yes"===e.toLowerCase())return"Yes";if("no"===e.toLowerCase())return"No";if("unknown"===e.toLowerCase())return"Unknown"}return e}return{cost:e.cost??"",costCurrency:e.costCurrency??"USD",impact:e.impact??"",financialImpact:e.financialImpact??e.financialimpact??"",reputationalImpact:e.reputationalImpact??e.reputationalimpact??"",operationalImpact:e.operationalImpact??e.operationalimpact??"",financialLoss:e.financialLoss??e.financialloss??"",financialLossCurrency:e.financialLossCurrency??"USD",systemDowntime:e.systemDowntime??e.expecteddowntime??"",recoveryTime:e.recoveryTime??e.recoverytime??"",recurrencePossible:t(e.recurrencePossible??e.riskrecurrence),improvementInitiative:t(e.improvementInitiative??e.improvementinitiative)}},navigateTo(e){const t=document.querySelectorAll(".toggle-button");t.forEach(e=>e.classList.remove("active"));const i=Array.from(t).find(t=>t.textContent.trim().toLowerCase().includes(e));switch(i&&i.classList.add("active"),e){case"resolution":this.$router.push("/risk/resolution");break;case"workflow":break}},async onGlobalVersionChange(){if(console.log("Global version changed to:",this.globalSelectedVersion),!this.globalSelectedVersion)return console.log("No version selected, clearing selections"),void(this.selectedVersions={});this.loadingVersions=!0;try{const t=this.currentReviewTask?.RiskInstanceId||this.selectedRiskId;console.log("Fetching version details for:",this.globalSelectedVersion);const i=await fetch(`http://localhost:8000/api/risk/${t}/version/${this.globalSelectedVersion}/`);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const a=await i.json();if(console.log("Received version details:",a),a.success&&a.version_data&&a.version_data.ExtractedInfo){let t;try{t="string"===typeof a.version_data.ExtractedInfo?JSON.parse(a.version_data.ExtractedInfo):a.version_data.ExtractedInfo}catch(e){console.error("Error parsing ExtractedInfo:",e),t={mitigations:{},risk_form_details:{}}}Object.keys(this.mitigationReviewData).forEach(e=>{this.selectedVersions={...this.selectedVersions,[e]:this.globalSelectedVersion};const i=t.mitigations?.[e]||{};let s="";i.remarks?s=i.remarks:i.reviewer_feedback?s=i.reviewer_feedback:a.version_data.ReviewerFeedback?s=a.version_data.ReviewerFeedback:t.reviewer_feedback&&(s=t.reviewer_feedback);const o=`${e}_${this.globalSelectedVersion}`;this.versionData={...this.versionData,[o]:{...i,version:this.globalSelectedVersion,RiskInstanceId:a.version_data.RiskInstanceId,UserId:a.version_data.UserId,ApproverId:a.version_data.ApproverId,Date:a.version_data.Date,formatted_date:a.version_data.formatted_date,approved:"Approved"===a.version_data.ApprovedRejected||"Rejected"!==a.version_data.ApprovedRejected&&void 0,reviewer_feedback:s}}}),console.log("Updated version data for all mitigations")}}catch(e){console.error("Error in global version change:",e),this.sendPushNotification({title:"Version Data Loading Failed",message:`Failed to load version data for risk ${this.currentReviewTask?.RiskInstanceId||this.selectedRiskId}. Please try again.`,category:"risk",priority:"medium",user_id:this.selectedUserId||"default_user"}),ya.error("Failed to load version data. Please try again.","Version Loading Failed")}finally{this.loadingVersions=!1}},async fetchAllVersions(){if(!this.showReviewerWorkflow)return void console.log("Not in reviewer workflow, skipping version fetch");const e=this.currentReviewTask?.RiskInstanceId||this.selectedRiskId;if(e){console.log("\n=== FETCHING ALL VERSIONS ==="),console.log(`Risk ID: ${e}`),console.log(`API URL: http://localhost:8000/api/risk/${e}/versions/`),console.log("Current mitigation review data keys:",Object.keys(this.mitigationReviewData)),this.loadingVersions=!0;try{console.log("Making API call...");const t=await fetch(`http://localhost:8000/api/risk/${e}/versions/`);if(console.log("Response status:",t.status),console.log("Response ok:",t.ok),!t.ok){const e=await t.text();throw console.error("API Error Response:",e),new Error(`HTTP error! status: ${t.status}, response: ${e}`)}const i=await t.json();console.log("Full API Response:",i),console.log("Response type:",typeof i),console.log("Response keys:",Object.keys(i||{}));const a=i.versions||i||[];console.log("Extracted versions:",a),console.log("Total versions received:",a.length),console.log("Versions array type:",Array.isArray(a)),i.version_names&&Array.isArray(i.version_names)?(this.allVersionNames=i.version_names.filter(e=>e&&e.toString().startsWith("R")),console.log("Using filtered R version_names from API response:",this.allVersionNames)):(this.allVersionNames=a.map(e=>e.version).filter(e=>e&&e.toString().startsWith("R")),console.log("Extracted filtered R version names from versions array:",this.allVersionNames)),a&&a.length>0?(this.allVersions=a,console.log("Set allVersions to:",this.allVersions),a.forEach((e,t)=>{console.log(`Version ${t+1}:`,{version:e.version,RiskInstanceId:e.RiskInstanceId,UserId:e.UserId,ApproverId:e.ApproverId,Date:e.Date,ApprovedRejected:e.ApprovedRejected,mitigationCount:e.mitigations?Object.keys(e.mitigations).length:0,formDetailsCount:e.risk_form_details?Object.keys(e.risk_form_details).length:0})}),Object.keys(this.mitigationReviewData).forEach(e=>{this.selectedVersions[e]||(this.selectedVersions={...this.selectedVersions,[e]:""})}),console.log("Final selectedVersions state:",this.selectedVersions),console.log("Final allVersions length:",this.allVersions.length),console.log("Final allVersionNames:",this.allVersionNames)):(console.log("No versions found or empty array"),console.log("Setting allVersions to empty array"),this.allVersions=[],this.allVersionNames=[])}catch(t){console.error("ERROR fetching versions:",t),console.error("Error type:",t.constructor.name),console.error("Error message:",t.message),console.error("Error stack:",t.stack),t.response&&(console.error("Response data:",t.response.data),console.error("Response status:",t.response.status)),this.allVersions=[],this.allVersionNames=[]}finally{this.loadingVersions=!1,console.log("fetchAllVersions completed. Final allVersions length:",this.allVersions.length),console.log("Final allVersionNames:",this.allVersionNames)}}else console.log("No risk ID available for fetching versions")},async fetchVersionDetails(e,t){console.log("\n=== FETCH VERSION DETAILS ==="),console.log(`Risk ID: ${e}`),console.log(`Version: ${t}`);try{const i=await He.A.get(`http://localhost:8000/api/risk/${e}/version/${t}/`);return console.log("API Response:",i.data),i.data.success?(console.log("Version data successfully retrieved"),console.log("Version data keys:",Object.keys(i.data.version_data)),i.data.version_data.ExtractedInfo&&(console.log("ExtractedInfo keys:",Object.keys(i.data.version_data.ExtractedInfo)),i.data.version_data.ExtractedInfo.mitigations&&console.log("Available mitigations:",Object.keys(i.data.version_data.ExtractedInfo.mitigations))),i.data.version_data.ExtractedInfo||i.data.version_data):(console.log("API returned success: false"),null)}catch(i){return console.error(`Error fetching version ${t}:`,i),console.error("Error response:",i.response?.data),null}},async onVersionChange(e,t){if(console.log("Version changed for mitigation:",e,"to version:",t),!t)return void console.log("No version selected, clearing data");const i=`${e}_${t}`;if(this.versionData[i])console.log("Version data already loaded for:",i);else try{const s=this.currentReviewTask?.RiskInstanceId||this.selectedRiskId;console.log("Fetching version details for:",t,"with risk ID:",s);const o=await fetch(`http://localhost:8000/api/risk/${s}/version/${t}/`);if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=await o.json();if(console.log("Received version details:",l),l.success&&l.version_data&&l.version_data.ExtractedInfo){let s;try{s="string"===typeof l.version_data.ExtractedInfo?JSON.parse(l.version_data.ExtractedInfo):l.version_data.ExtractedInfo}catch(a){console.error("Error parsing ExtractedInfo:",a),s={mitigations:{},risk_form_details:{}}}const o=s.mitigations[e]||{};console.log("Mitigation data for",e,":",o);let n="";o.remarks?n=o.remarks:o.reviewer_feedback?n=o.reviewer_feedback:l.version_data.ReviewerFeedback?n=l.version_data.ReviewerFeedback:s.reviewer_feedback&&(n=s.reviewer_feedback),console.log("Extracted reviewer feedback:",n),this.versionData={...this.versionData,[i]:{...o,version:t,RiskInstanceId:l.version_data.RiskInstanceId,UserId:l.version_data.UserId,ApproverId:l.version_data.ApproverId,Date:l.version_data.Date,formatted_date:l.version_data.formatted_date,approved:"Approved"===l.version_data.ApprovedRejected||"Rejected"!==l.version_data.ApprovedRejected&&void 0,reviewer_feedback:n}},console.log("Stored version data:",this.versionData[i])}}catch(a){console.error("Error fetching version details:",a),this.$toast?this.$toast.error("Failed to load version details. Please try again."):console.error("Failed to load version details. Please try again.")}},getVersionDisplayData(e,t){return"current"===t?this.mitigationReviewData[e]:this.versionData[`${e}_${t}`]||{}},getVersionOptions(){const e=[{value:"current",label:"Current Version"}];return this.allVersions.forEach(t=>{t.version!==this.currentReviewTask?.version&&e.push({value:t.version,label:`Version ${t.version} (${this.formatDateTime(t.formatted_date)})`})}),e},getAllVersionsExceptCurrent(){if(!this.allVersions||0===this.allVersions.length)return[];let e=null;if(this.currentReviewTask&&this.currentReviewTask.ExtractedInfo)try{const t="string"===typeof this.currentReviewTask.ExtractedInfo?JSON.parse(this.currentReviewTask.ExtractedInfo):this.currentReviewTask.ExtractedInfo;t.version&&(e=t.version)}catch(i){console.error("Error parsing current task ExtractedInfo:",i)}if(!e&&this.allVersions.length>0){const t=[...this.allVersions].sort((e,t)=>{const i=e=>{const t=e.match(/\d+/);return t?parseInt(t[0]):0};return i(t.version)-i(e.version)});e=t[0].version}console.log("Current version identified as:",e),console.log("All versions:",this.allVersions.map(e=>e.version));const t=this.allVersions.filter(t=>t.version!==e);return console.log("Filtered versions (excluding current):",t.map(e=>e.version)),t},getSelectedVersionData(e,t){return this.versionData[`${e}_${t}`]||{}},getCurrentVersionLabel(){if(!this.allVersions||0===this.allVersions.length)return"Current";let e=null;if(this.currentReviewTask&&this.currentReviewTask.ExtractedInfo)try{const t="string"===typeof this.currentReviewTask.ExtractedInfo?JSON.parse(this.currentReviewTask.ExtractedInfo):this.currentReviewTask.ExtractedInfo;t.version&&(e=t.version)}catch(i){console.error("Error parsing current task ExtractedInfo:",i)}if(!e&&this.allVersions.length>0){const t=[...this.allVersions].sort((e,t)=>{const i=e=>{const t=e.match(/\d+/);return t?parseInt(t[0]):0};return i(t.version)-i(e.version)});e=t[0].version}const t=this.allVersions.find(t=>t.version===e);return t&&t.formatted_date?`Version ${e} (${this.formatDateTime(t.formatted_date)})`:t&&t.Date?`Version ${e} (${this.formatDateTime(t.Date)})`:`Version ${e||"Current"}`},getVersionStatus(e){return"Approved"===e.ApprovedRejected?"Approved":"Rejected"===e.ApprovedRejected?"Rejected":!0===e.approved?"Approved":!1===e.approved?"Rejected":"Pending"}}};const jye=(0,le.A)(Oye,[["render",$ye],["__scopeId","data-v-3a674fea"]]);var Bye=jye;const Wye={class:"tailoring-risk-container"},qye={key:0,class:"tailoring-risk-loading-overlay"},Qye={class:"tailoring-risk-loading-spinner"},Kye={class:"tailoring-risk-form-group tailoring-risk-id-container"},Jye={class:"tailoring-risk-dropdown-container"},zye=["value"],Hye={class:"tailoring-risk-form-row"},Gye={class:"tailoring-risk-form-group"},Yye={class:"tailoring-risk-form-group"},Zye={class:"tailoring-risk-form-row"},efe={class:"tailoring-risk-form-group"},tfe={class:"tailoring-risk-form-group"},ife={class:"tailoring-risk-category-container"},afe={class:"tailoring-risk-category-dropdown"},sfe={key:0},ofe={key:1},lfe={key:0,class:"tailoring-risk-category-options"},nfe={class:"tailoring-risk-category-search"},rfe={class:"tailoring-risk-category-list"},cfe=["onClick"],dfe=["checked","onClick"],ufe={class:"tailoring-risk-form-row"},pfe={class:"tailoring-risk-form-group"},mfe={class:"tailoring-risk-form-group"},vfe={class:"tailoring-risk-form-row"},kfe={class:"tailoring-risk-form-group"},hfe={class:"tailoring-risk-form-group"},gfe={class:"tailoring-risk-form-row"},yfe={class:"tailoring-risk-form-group"},ffe={class:"tailoring-risk-form-group"},bfe={class:"tailoring-risk-business-impact-container"},Cfe={class:"tailoring-risk-business-impact-dropdown"},Lfe={key:0},wfe={key:1},Efe={key:0,class:"tailoring-risk-business-impact-options"},Rfe={class:"tailoring-risk-business-impact-search"},Ife={class:"tailoring-risk-business-impact-list"},Dfe=["onClick"],Pfe=["checked","onClick"],_fe={class:"tailoring-risk-selected-impacts-display"},Afe=["onClick"],Sfe={class:"tailoring-risk-modal-form-group"},Tfe={class:"tailoring-risk-modal-actions"},xfe=["disabled"],Ffe={class:"tailoring-risk-modal-form-group"},Vfe={class:"tailoring-risk-modal-actions"},Ufe=["disabled"],Nfe={class:"tailoring-risk-form-row"},Mfe={class:"tailoring-risk-form-group"},Xfe={class:"tailoring-risk-form-group"},$fe={class:"tailoring-risk-form-group"},Ofe={class:"tailoring-risk-form-actions"},jfe=["disabled"];function Bfe(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",Wye,[(0,s.bF)(r),t[78]||(t[78]=(0,s.Lk)("h2",{class:"tailoring-risk-title"},"Tailoring Risk",-1)),o.isLoading?((0,s.uX)(),(0,s.CE)("div",qye,[(0,s.Lk)("div",Qye,[t[35]||(t[35]=(0,s.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1)),(0,s.eW)(" "+(0,d.v_)(o.loadingMessage),1)])])):(0,s.Q3)("",!0),(0,s.Lk)("form",{onSubmit:t[34]||(t[34]=(0,a.D$)((...e)=>o.saveRisk&&o.saveRisk(...e),["prevent"])),class:"tailoring-risk-form"},[(0,s.Lk)("div",Kye,[t[37]||(t[37]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-hashtag"}),(0,s.eW)(" Select Existing Risk (Optional):")],-1)),(0,s.Lk)("div",Jye,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedRiskId=e),onChange:t[1]||(t[1]=(...e)=>o.onRiskSelected&&o.onRiskSelected(...e)),class:"tailoring-risk-form-control"},[t[36]||(t[36]=(0,s.Lk)("option",{value:""},"Select a risk to edit...",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.allRisks,e=>((0,s.uX)(),(0,s.CE)("option",{key:e.RiskId,value:e.RiskId}," ID: "+(0,d.v_)(e.RiskId)+" - "+(0,d.v_)(e.RiskTitle)+" ("+(0,d.v_)(e.Criticality)+") ",9,zye))),128))],544),[[a.u1,o.selectedRiskId]])]),t[38]||(t[38]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Choose an existing risk to use as a template for creating a new one",-1))]),(0,s.Lk)("div",Hye,[(0,s.Lk)("div",Gye,[t[39]||(t[39]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-heading"}),(0,s.eW)(" Risk Title:")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>o.risk.RiskTitle=e),class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.RiskTitle]]),t[40]||(t[40]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Provide a brief, descriptive title for this risk",-1))]),(0,s.Lk)("div",Yye,[t[41]||(t[41]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-clipboard-check"}),(0,s.eW)(" Compliance ID:")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[3]||(t[3]=e=>o.risk.ComplianceId=e),class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.ComplianceId]]),t[42]||(t[42]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Enter the compliance framework identifier for this risk",-1))])]),(0,s.Lk)("div",Zye,[(0,s.Lk)("div",efe,[t[44]||(t[44]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle"}),(0,s.eW)(" Criticality:")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.risk.Criticality=e),class:"tailoring-risk-form-control"},t[43]||(t[43]=[(0,s.Fv)('<option value="">Select Criticality</option><option value="Low">Low</option><option value="Medium">Medium</option><option value="High">High</option><option value="Critical">Critical</option>',5)]),512),[[a.u1,o.risk.Criticality]]),t[45]||(t[45]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Choose the severity level of this risk",-1))]),(0,s.Lk)("div",tfe,[t[48]||(t[48]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-tag"}),(0,s.eW)(" Category:")],-1)),(0,s.Lk)("div",ife,[(0,s.Lk)("div",afe,[(0,s.Lk)("div",{class:"tailoring-risk-selected-category",onClick:t[5]||(t[5]=(...e)=>o.toggleCategoryDropdown&&o.toggleCategoryDropdown(...e))},[o.selectedCategory?((0,s.uX)(),(0,s.CE)("span",ofe,(0,d.v_)(o.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",sfe,"Select Category")),t[46]||(t[46]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),o.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",lfe,[(0,s.Lk)("div",nfe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=e=>o.categorySearch=e),placeholder:"Search categories...",onClick:t[7]||(t[7]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,o.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"tailoring-risk-add-category-btn",onClick:t[8]||(t[8]=(0,a.D$)(e=>o.showAddCategoryModal=!0,["stop","prevent"]))},t[47]||(t[47]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",rfe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"tailoring-risk-category-item",onClick:(0,a.D$)(t=>o.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:o.selectedCategory===e.value,onClick:(0,a.D$)(t=>o.selectCategory(e),["stop"])},null,8,dfe),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,cfe))),128))])])):(0,s.Q3)("",!0)])]),t[49]||(t[49]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Categorize this risk for better organization and management",-1))])]),(0,s.Lk)("div",ufe,[(0,s.Lk)("div",pfe,[t[51]||(t[51]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-list"}),(0,s.eW)(" Risk Type:")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>o.risk.RiskType=e),class:"tailoring-risk-form-control"},t[50]||(t[50]=[(0,s.Fv)('<option value="">Select Risk Type</option><option value="Current">Current</option><option value="Residual">Residual</option><option value="Inherent">Inherent</option><option value="Emerging">Emerging</option><option value="Accept">Accept</option>',6)]),512),[[a.u1,o.risk.RiskType]]),t[52]||(t[52]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Classify the nature and timing of this risk",-1))]),(0,s.Lk)("div",mfe,[t[54]||(t[54]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-flag"}),(0,s.eW)(" Risk Priority:")],-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[10]||(t[10]=e=>o.risk.RiskPriority=e),class:"tailoring-risk-form-control"},t[53]||(t[53]=[(0,s.Lk)("option",{value:""},"Select Priority",-1),(0,s.Lk)("option",{value:"Low"},"Low",-1),(0,s.Lk)("option",{value:"Medium"},"Medium",-1),(0,s.Lk)("option",{value:"High"},"High",-1)]),512),[[a.u1,o.risk.RiskPriority]]),t[55]||(t[55]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Set the priority level for risk treatment and response",-1))])]),(0,s.Lk)("div",vfe,[(0,s.Lk)("div",kfe,[t[56]||(t[56]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-bomb"}),(0,s.eW)(" Risk Impact (1-10):")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=e=>o.risk.RiskImpact=e),min:"1",max:"10",class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.RiskImpact,void 0,{number:!0}]]),t[57]||(t[57]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)",-1))]),(0,s.Lk)("div",hfe,[t[58]||(t[58]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-chart-line"}),(0,s.eW)(" Risk Likelihood (1-10):")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=e=>o.risk.RiskLikelihood=e),min:"1",max:"10",class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.RiskLikelihood,void 0,{number:!0}]]),t[59]||(t[59]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)",-1))])]),(0,s.Lk)("div",gfe,[(0,s.Lk)("div",yfe,[t[60]||(t[60]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-tachometer-alt"}),(0,s.eW)(" Risk Exposure Rating:")],-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=e=>o.risk.RiskExposureRating=e),class:"tailoring-risk-form-control",readonly:""},null,512),[[a.Jo,o.risk.RiskExposureRating,void 0,{number:!0}]]),t[61]||(t[61]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Automatically calculated as Likelihood × Impact",-1))]),(0,s.Lk)("div",ffe,[t[64]||(t[64]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Impact:")],-1)),(0,s.Lk)("div",bfe,[(0,s.Lk)("div",Cfe,[(0,s.Lk)("div",{class:"tailoring-risk-selected-impacts",onClick:t[14]||(t[14]=(...e)=>o.toggleBusinessImpactDropdown&&o.toggleBusinessImpactDropdown(...e))},[0===o.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",Lfe,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",wfe,(0,d.v_)(o.selectedBusinessImpacts.length)+" impact(s) selected",1)),t[62]||(t[62]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),o.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",Efe,[(0,s.Lk)("div",Rfe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[15]||(t[15]=e=>o.businessImpactSearch=e),placeholder:"Search impacts...",onClick:t[16]||(t[16]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,o.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"tailoring-risk-add-impact-btn",onClick:t[17]||(t[17]=(0,a.D$)(e=>o.showAddImpactModal=!0,["stop","prevent"]))},t[63]||(t[63]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",Ife,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"tailoring-risk-business-impact-item",onClick:(0,a.D$)(t=>o.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",checked:o.isBusinessImpactSelected(e),onClick:(0,a.D$)(t=>o.toggleBusinessImpact(e),["stop"])},null,8,Pfe),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,Dfe))),128))])])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",_fe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"tailoring-risk-selected-impact-tag"},[(0,s.eW)((0,d.v_)(e.value)+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:t=>o.toggleBusinessImpact(e)},null,8,Afe)]))),128))])]),t[65]||(t[65]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Select the business areas that would be affected by this risk",-1))])]),o.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"tailoring-risk-modal-overlay",onClick:t[23]||(t[23]=(0,a.D$)(e=>o.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"tailoring-risk-modal-content",onClick:t[22]||(t[22]=(0,a.D$)(()=>{},["stop"]))},[t[67]||(t[67]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:t[21]||(t[21]=(0,a.D$)((...e)=>o.addNewBusinessImpact&&o.addNewBusinessImpact(...e),["prevent"])),class:"tailoring-risk-modal-form"},[(0,s.Lk)("div",Sfe,[t[66]||(t[66]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[18]||(t[18]=e=>o.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:t[19]||(t[19]=(0,a.jR)((0,a.D$)((...e)=>o.addNewBusinessImpact&&o.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,o.newBusinessImpact]])]),(0,s.Lk)("div",Tfe,[(0,s.Lk)("button",{type:"button",class:"tailoring-risk-cancel-btn",onClick:t[20]||(t[20]=(0,a.D$)(e=>o.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"tailoring-risk-add-btn",disabled:!o.newBusinessImpact.trim()}," Add Impact ",8,xfe)])],32)])])):(0,s.Q3)("",!0),o.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"tailoring-risk-modal-overlay",onClick:t[29]||(t[29]=(0,a.D$)(e=>o.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"tailoring-risk-modal-content",onClick:t[28]||(t[28]=(0,a.D$)(()=>{},["stop"]))},[t[69]||(t[69]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:t[27]||(t[27]=(0,a.D$)((...e)=>o.addNewCategory&&o.addNewCategory(...e),["prevent"])),class:"tailoring-risk-modal-form"},[(0,s.Lk)("div",Ffe,[t[68]||(t[68]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[24]||(t[24]=e=>o.newCategory=e),placeholder:"Enter new category",onKeyup:t[25]||(t[25]=(0,a.jR)((0,a.D$)((...e)=>o.addNewCategory&&o.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,o.newCategory]])]),(0,s.Lk)("div",Vfe,[(0,s.Lk)("button",{type:"button",class:"tailoring-risk-cancel-btn",onClick:t[26]||(t[26]=(0,a.D$)(e=>o.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"tailoring-risk-add-btn",disabled:!o.newCategory.trim()}," Add Category ",8,Ufe)])],32)])])):(0,s.Q3)("",!0),(0,s.Lk)("div",Nfe,[(0,s.Lk)("div",Mfe,[t[70]||(t[70]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"}),(0,s.eW)(" Possible Damage:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[30]||(t[30]=e=>o.risk.PossibleDamage=e),rows:"4",class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.PossibleDamage]]),t[71]||(t[71]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Describe the potential damage or consequences if this risk materializes",-1))]),(0,s.Lk)("div",Xfe,[t[72]||(t[72]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-align-left"}),(0,s.eW)(" Risk Description:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[31]||(t[31]=e=>o.risk.RiskDescription=e),rows:"4",class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.RiskDescription]]),t[73]||(t[73]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Provide a detailed description of the risk, its context, and contributing factors",-1))]),(0,s.Lk)("div",$fe,[t[74]||(t[74]=(0,s.Lk)("label",null,[(0,s.Lk)("i",{class:"fas fa-shield-alt"}),(0,s.eW)(" Risk Mitigation:")],-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[32]||(t[32]=e=>o.risk.RiskMitigation=e),rows:"4",class:"tailoring-risk-form-control"},null,512),[[a.Jo,o.risk.RiskMitigation]]),t[75]||(t[75]=(0,s.Lk)("div",{class:"tailoring-risk-helper-text"},"Describe the strategies and measures to reduce or eliminate this risk",-1))])]),(0,s.Lk)("div",Ofe,[(0,s.Lk)("button",{type:"button",onClick:t[33]||(t[33]=(...e)=>o.resetForm&&o.resetForm(...e)),class:"tailoring-risk-btn-secondary"},t[76]||(t[76]=[(0,s.Lk)("i",{class:"fas fa-undo"},null,-1),(0,s.eW)(" Reset ")])),(0,s.Lk)("button",{type:"submit",class:"tailoring-risk-btn-primary",disabled:o.isLoading},t[77]||(t[77]=[(0,s.Lk)("i",{class:"fas fa-save"},null,-1),(0,s.eW)(" Save Risk ")]),8,jfe)])],32)])}var Wfe={name:"TailoringRisk",components:{PopupModal:Ck.wA},setup(){const e=(0,ae.lq)(),t=(0,ie.KR)({RiskTitle:"",ComplianceId:"",Criticality:"",Category:"",RiskType:"",RiskPriority:"",RiskImpact:1,RiskLikelihood:1,RiskExposureRating:1,BusinessImpact:"",PossibleDamage:"",RiskDescription:"",RiskMitigation:""}),i=(0,ie.KR)(!1),a=(0,ie.KR)("Loading..."),o=(0,ie.KR)([]),l=(0,ie.KR)(""),n=(0,ie.KR)([]),r=(0,ie.KR)([]),c=(0,ie.KR)(!1),d=(0,ie.KR)(""),u=(0,ie.KR)(!1),p=(0,ie.KR)(""),m=(0,ie.KR)([]),v=(0,ie.KR)(""),k=(0,ie.KR)(!1),h=(0,ie.KR)(""),g=(0,ie.KR)(!1),y=(0,ie.KR)(""),f=(0,s.EW)(()=>l.value?"Create Risk Based on Existing Risk":"Create New Risk"),b=(0,s.EW)(()=>{if(!d.value)return n.value;const e=d.value.toLowerCase();return n.value.filter(t=>t.value.toLowerCase().includes(e))}),C=(0,s.EW)(()=>{if(!h.value)return m.value;const e=h.value.toLowerCase();return m.value.filter(t=>t.value.toLowerCase().includes(e))});(0,s.wB)([()=>t.value.RiskImpact,()=>t.value.RiskLikelihood],()=>{t.value.RiskExposureRating=(t.value.RiskImpact||1)*(t.value.RiskLikelihood||1)});const L=async e=>{try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},w=()=>{if(l.value){const e=o.value.find(e=>e.RiskId==l.value);e&&(Object.assign(t.value,{RiskTitle:e.RiskTitle||"",ComplianceId:e.ComplianceId||"",Criticality:e.Criticality||"",Category:e.Category||"",RiskType:e.RiskType||"",RiskPriority:e.RiskPriority||"",RiskImpact:e.RiskImpact||1,RiskLikelihood:e.RiskLikelihood||1,RiskExposureRating:e.RiskExposureRating||1,BusinessImpact:e.BusinessImpact||"",PossibleDamage:e.PossibleDamage||"",RiskDescription:e.RiskDescription||"",RiskMitigation:e.RiskMitigation||""}),e.BusinessImpact&&E(e.BusinessImpact),e.Category&&(v.value=e.Category))}},E=e=>{if(!e)return;r.value=[];const t=e.split(",").map(e=>e.trim());t.forEach(e=>{if(!e)return;const t=n.value.find(t=>t.value.toLowerCase()===e.toLowerCase());if(t)r.value.push(t);else{const t={id:`temp-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,value:e};n.value.push(t),r.value.push(t)}})},R=async()=>{i.value=!0,a.value="Loading risks...";try{const t=await He.A.get("http://localhost:8000/api/risks/");o.value=t.data,e.params.id&&"new"!==e.params.id&&(l.value=e.params.id,w())}catch(t){console.error("Error loading risks:",t),Ck.Wo.error("Failed to load risks. Please try again."),L({title:"Risk Loading Failed",message:"Failed to load risks from the database. Please check your connection and try again.",category:"risk",priority:"high",user_id:"default_user"})}finally{i.value=!1}},I=async()=>{try{const e=await He.A.get("http://localhost:8000/api/business-impacts/");"success"===e.data.status&&(n.value=e.data.data)}catch(e){console.error("Error fetching business impacts:",e)}},D=()=>{c.value=!c.value,c.value&&(d.value="")},P=e=>{const i=r.value.findIndex(t=>t.id===e.id);-1===i?r.value.push(e):r.value.splice(i,1),t.value.BusinessImpact=r.value.map(e=>e.value).join(", ")},_=e=>r.value.some(t=>t.id===e.id),A=async()=>{if(p.value.trim())try{const e=await He.A.post("http://localhost:8000/api/business-impacts/add/",{value:p.value.trim()});if("success"!==e.data.status)throw new Error("Failed to add business impact: "+(e.data.message||"Unknown error"));n.value.push(e.data.data),P(e.data.data),u.value=!1,p.value=""}catch(e){console.error("Error adding new business impact:",e),Ck.Wo.error("Failed to add new business impact: "+(e.response?.data?.message||e.message)),L({title:"Business Impact Addition Failed",message:`Failed to add new business impact: ${e.response?.data?.message||e.message}`,category:"risk",priority:"medium",user_id:"default_user"})}},S=async()=>{try{const e=await He.A.get("http://localhost:8000/api/risk-categories/");"success"===e.data.status&&(m.value=e.data.data)}catch(e){console.error("Error fetching categories:",e)}},T=()=>{k.value=!k.value,k.value&&(h.value="")},x=e=>{v.value=e.value,t.value.Category=e.value,k.value=!1},F=async e=>{if(e&&(e.preventDefault(),e.stopPropagation()),y.value.trim())try{console.log("Adding new category:",y.value);const e=await He.A.post("http://localhost:8000/api/risk-categories/add/",{value:y.value.trim()});if("success"!==e.data.status)throw new Error("Failed to add category: "+(e.data.message||"Unknown error"));console.log("Successfully added category:",e.data.data),m.value.push(e.data.data),x(e.data.data),g.value=!1,y.value=""}catch(t){console.error("Error adding new category:",t),Ck.Wo.error("Failed to add new category: "+(t.response?.data?.message||t.message)),L({title:"Category Addition Failed",message:`Failed to add new category: ${t.response?.data?.message||t.message}`,category:"risk",priority:"medium",user_id:"default_user"})}},V=()=>{l.value="",r.value=[],v.value="",Object.assign(t.value,{RiskTitle:"",ComplianceId:"",Criticality:"",Category:"",RiskType:"",RiskPriority:"",RiskImpact:1,RiskLikelihood:1,RiskExposureRating:1,BusinessImpact:"",PossibleDamage:"",RiskDescription:"",RiskMitigation:""})},U=()=>{const e={},i=["Critical","High","Medium","Low"];t.value.Criticality&&i.includes(t.value.Criticality)||(e.Criticality=`Invalid Criticality. Must be one of: ${i.join(", ")}`);const a=["High","Medium","Low"];t.value.RiskPriority&&a.includes(t.value.RiskPriority)||(e.RiskPriority=`Invalid Risk Priority. Must be one of: ${a.join(", ")}`);const s=["Current","Residual","Inherent","Emerging","Accept"];t.value.RiskType&&s.includes(t.value.RiskType)||(e.RiskType=`Invalid Risk Type. Must be one of: ${s.join(", ")}`);const o=parseInt(t.value.RiskImpact);(isNaN(o)||o<1||o>10)&&(e.RiskImpact="Risk Impact must be between 1 and 10");const l=parseInt(t.value.RiskLikelihood);(isNaN(l)||l<1||l>10)&&(e.RiskLikelihood="Risk Likelihood must be between 1 and 10");const n=/^[A-Za-z0-9\s.,;:!?'"()\-_[\]]{0,}$/,r=["RiskTitle","RiskDescription","PossibleDamage","RiskMitigation"];return r.forEach(i=>{t.value[i]&&!n.test(t.value[i])&&(e[i]=`${i} contains invalid characters`)}),e},N=async()=>{i.value=!0,a.value="Validating and saving risk...";try{const e=U();if(Object.keys(e).length>0){const t=Object.entries(e).map(([e,t])=>`${e}: ${t}`).join("\n");return Ck.Wo.error("Please fix the following validation errors:\n\n"+t),void L({title:"Risk Validation Errors",message:`Please fix the following validation errors: ${Object.keys(e).join(", ")}`,category:"risk",priority:"medium",user_id:"default_user"})}const i={...t.value,RiskLikelihood:parseInt(t.value.RiskLikelihood)||1,RiskImpact:parseInt(t.value.RiskImpact)||1,RiskExposureRating:parseFloat(t.value.RiskExposureRating)||1,BusinessImpact:r.value.map(e=>e.value).join(", ")};await He.A.post("http://localhost:8000/api/risks/",i),Ck.Wo.success("Risk created successfully!"),L({title:"New Risk Instance Created",message:`A new risk instance "${i.RiskTitle||"Untitled Risk"}" has been created in the Risk module.`,category:"risk",priority:"high",user_id:"default_user"}),V()}catch(e){console.error("Error saving risk:",e),e.response?.data?.detail?(Ck.Wo.error("Server validation error: "+e.response.data.detail),L({title:"Risk Creation Failed - Server Error",message:`Server validation error: ${e.response.data.detail}`,category:"risk",priority:"high",user_id:"default_user"})):(Ck.Wo.error("Failed to save risk: "+e.message),L({title:"Risk Creation Failed",message:`Failed to save risk: ${e.message}`,category:"risk",priority:"high",user_id:"default_user"}))}finally{i.value=!1}},M=()=>{document.addEventListener("click",e=>{const t=document.querySelector(".tailoring-risk-business-impact-dropdown");t&&!t.contains(e.target)&&(c.value=!1);const i=document.querySelector(".tailoring-risk-category-dropdown");i&&!i.contains(e.target)&&(k.value=!1)})};return(0,s.sV)(()=>{R(),I(),S(),M()}),{risk:t,isLoading:i,loadingMessage:a,allRisks:o,selectedRiskId:l,pageTitle:f,businessImpacts:n,selectedBusinessImpacts:r,showBusinessImpactDropdown:c,businessImpactSearch:d,showAddImpactModal:u,newBusinessImpact:p,filteredBusinessImpacts:b,categories:m,selectedCategory:v,showCategoryDropdown:k,categorySearch:h,showAddCategoryModal:g,newCategory:y,filteredCategories:C,onRiskSelected:w,toggleBusinessImpactDropdown:D,toggleBusinessImpact:P,isBusinessImpactSelected:_,addNewBusinessImpact:A,toggleCategoryDropdown:T,selectCategory:x,addNewCategory:F,resetForm:V,saveRisk:N,sendPushNotification:L}}};const qfe=(0,le.A)(Wfe,[["render",Bfe]]);var Qfe=qfe;const Kfe={class:"risk-kpi-dashboard"},Jfe={class:"category-filter-container"},zfe={class:"first-row"},Hfe={class:"kpi-box"},Gfe={class:"kpi-number"},Yfe={class:"sparkline-chart"},Zfe={key:0,class:"line-chart"},ebe={width:"100%",height:"100%",preserveAspectRatio:"none",viewBox:"0 0 100 30"},tbe=["d"],ibe=["d"],abe={key:1,class:"month-labels"},sbe={class:"kpi-box high-criticality"},obe={class:"kpi-number"},lbe={class:"criticality-breakdown"},nbe={class:"breakdown-item"},rbe={class:"item-value"},cbe={class:"breakdown-item"},dbe={class:"item-value"},ube={class:"criticality-trend"},pbe={width:"100%",height:"15",viewBox:"0 0 100 15",preserveAspectRatio:"none"},mbe=["d"],vbe={class:"kpi-box"},kbe={class:"kpi-number"},hbe={class:"register-update-chart"},gbe={width:"100%",height:"50",viewBox:"0 0 100 50",preserveAspectRatio:"none"},ybe=["d"],fbe=["cx","cy"],bbe={key:0,class:"month-labels"},Cbe={class:"kpi-grid"},Lbe={class:"kpi-box"},wbe={class:"kpi-number"},Ebe={class:"remediation-chart"},Rbe={width:"100%",height:"50",viewBox:"0 0 100 50",preserveAspectRatio:"none"},Ibe={x:"2",y:"18","font-size":"3",fill:"#f59e0b"},Dbe=["d"],Pbe=["cx","cy"],_be={key:0,class:"month-labels"},Abe={key:0,class:"overdue-info"},Sbe={class:"overdue-container"},Tbe={class:"risk-count"},xbe={class:"risk-percentage"},Fbe={class:"kpi-box"},Vbe={class:"kpi-number"},Ube={class:"recurrence-bars-container"},Nbe={class:"recurrence-values"},Mbe={class:"one-time-value"},Xbe={class:"recurring-value"},$be={class:"recurrence-bars"},Obe={class:"recurrence-trend"},jbe={width:"100%",height:"50",viewBox:"0 0 100 50",preserveAspectRatio:"none"},Bbe=["d"],Wbe=["cx","cy"],qbe={class:"month-labels"},Qbe={class:"kpi-box"},Kbe={class:"kpi-number"},Jbe={class:"unit"},zbe={class:"response-gauge"},Hbe={width:"100%",height:"80",viewBox:"0 0 200 80"},Gbe=["x2","y2"],Ybe={x:"30",y:"80","font-size":"8",fill:"#10b981","text-anchor":"start"},Zbe={x:"170",y:"80","font-size":"8",fill:"#ef4444","text-anchor":"end"},eCe={key:0,class:"response-warning"},tCe={class:"response-trend"},iCe={width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none"},aCe=["d"],sCe=["cx","cy"],oCe={class:"month-labels"},lCe={class:"kpi-box"},nCe={class:"kpi-header"},rCe={class:"kpi-period-selector"},cCe={class:"kpi-number"},dCe={class:"cost-chart"},uCe={key:0,class:"cost-bars"},pCe={class:"cost-value"},mCe={class:"cost-labels"},vCe={class:"cost-breakdown"},kCe={class:"cost-metric"},hCe={class:"metric-value"},gCe={class:"cost-metric"},yCe={class:"metric-value high-cost"},fCe={class:"kpi-box"},bCe={class:"kpi-number"},CCe={class:"kpi-note"},LCe={class:"kpi-chart"},wCe={key:0,width:"100%",height:"60",viewBox:"0 0 120 60"},ECe=["points"],RCe=["points"],ICe=["cx","cy"],DCe={key:1,class:"month-labels"},PCe={class:"kpi-box"},_Ce={class:"kpi-header"},ACe={class:"kpi-period-selector"},SCe={class:"kpi-number"},TCe={class:"mitigation-chart"},xCe={class:"pie-chart"},FCe={width:"70",height:"70"},VCe=["d"],UCe=["d"],NCe=["d"],MCe={class:"pie-legend"},XCe={class:"legend-item"},$Ce={class:"legend-value"},OCe={class:"legend-item"},jCe={class:"legend-value"},BCe={class:"legend-item"},WCe={class:"legend-value"},qCe={class:"mitigation-detail"},QCe={class:"detail-count"},KCe={class:"kpi-box"},JCe={class:"initiative-progress"},zCe={width:"70",height:"70"},HCe=["stroke-dasharray"],GCe={x:"35",y:"35","text-anchor":"middle","dominant-baseline":"middle",class:"circle-text"},YCe={class:"initiative-counts"},ZCe={class:"count-item"},eLe={class:"count-value"},tLe={class:"count-item"},iLe={class:"count-value"},aLe={class:"kpi-box"},sLe={class:"kpi-number"},oLe={class:"impact-meter"},lLe={class:"impact-chart"},nLe={class:"impact-bubbles"},rLe=["title"],cLe={class:"kpi-box"},dLe={class:"kpi-number"},uLe={class:"kpi-note"},pLe={class:"severity-categories"},mLe={class:"severity-category"},vLe={class:"category-value"},kLe={class:"severity-category"},hLe={class:"category-value"},gLe={class:"severity-category"},yLe={class:"category-value"},fLe={class:"severity-category"},bLe={class:"category-value"},CLe={class:"severity-chart-container"},LLe={class:"severity-semi-circle"},wLe={class:"kpi-box"},ELe={class:"kpi-number"},RLe={class:"exposure-chart"},ILe={class:"scatter-container"},DLe=["title"],PLe={class:"exposure-legend"},_Le={class:"exposure-risk-list"},ALe={class:"risk-name"},SLe={class:"risk-score"},TLe={class:"kpi-box"},xLe={class:"kpi-number"},FLe={class:"resilience-chart"},VLe={class:"resilience-bars"},ULe={class:"category-name"},NLe={class:"time-bars"},MLe={class:"time-value"},XLe={class:"time-value"},$Le={class:"kpi-box"},OLe={class:"kpi-number"},jLe={key:0,class:"criticality-badge"},BLe={class:"assessment-chart"},WLe={class:"assessment-bars"},qLe={class:"bar-value"},QLe={key:0,class:"month-labels"},KLe={class:"assessment-breakdown"},JLe={key:0,class:"category-bars"},zLe={class:"category-label"},HLe={class:"category-bar-bg"},GLe={class:"category-value"},YLe={class:"kpi-box"},ZLe={class:"kpi-number"},ewe={class:"consensus-chart"},twe={class:"consensus-pie"},iwe={width:"70",height:"70",viewBox:"0 0 70 70"},awe=["d"],swe=["d"],owe={class:"consensus-legend"},lwe={class:"legend-item"},nwe={class:"legend-value"},rwe={class:"legend-item"},cwe={class:"legend-value"},dwe={class:"investigation-section"},uwe={key:0,class:"investigation-risks"},pwe={class:"risk-item"},mwe={class:"risk-title"},vwe={class:"risk-agreement"},kwe={class:"kpi-box"},hwe={class:"kpi-box"},gwe={class:"kpi-number"},ywe={class:"key-metrics"},fwe={class:"metric-box"},bwe={class:"metric-number"},Cwe={class:"metric-box"},Lwe={class:"metric-number"},wwe={class:"kpi-box"},Ewe={class:"kpi-number"},Rwe={class:"waterfall-chart"},Iwe={class:"bar-value"},Dwe={class:"bar-value"},Pwe={class:"bar-value"},_we={class:"bar-value"},Awe={class:"kpi-box"},Swe={class:"kpi-number"},Twe={class:"progress-bar"},xwe={class:"avg-time-metrics"},Fwe={class:"avg-time-label"},Vwe={class:"avg-time-value"},Uwe={class:"kpi-box"},Nwe={class:"kpi-number"},Mwe={class:"probability-histogram"},Xwe={class:"histogram-chart"},$we={class:"count-label"},Owe={class:"range-labels"},jwe={key:0,class:"high-probability-risks"},Bwe={class:"high-prob-item"},Wwe={class:"high-prob-name"},qwe={class:"high-prob-value"},Qwe={class:"kpi-box"},Kwe={class:"kpi-number tolerance-status-container"},Jwe={class:"tolerance-thresholds"},zwe={class:"category-header"},Hwe={class:"category-name"},Gwe={class:"tolerance-bar-bg"},Ywe={class:"kpi-box"},Zwe={class:"kpi-number centered-number"},eEe={class:"big-number"},tEe={class:"appetite-description"},iEe={class:"appetite-chart"},aEe={class:"appetite-slider-container"};function sEe(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",Kfe,[(0,s.Lk)("div",Jfe,[t[7]||(t[7]=(0,s.Lk)("label",{for:"category-filter"},"Filter by Category:",-1)),(0,s.bo)((0,s.Lk)("select",{id:"category-filter","onUpdate:modelValue":t[0]||(t[0]=e=>l.selectedCategory=e),onChange:t[1]||(t[1]=(...e)=>n.filterKpiCards&&n.filterKpiCards(...e))},t[6]||(t[6]=[(0,s.Lk)("option",{value:"all"},"All Categories",-1),(0,s.Lk)("option",{value:"risk-profile"},"Risk Profile",-1),(0,s.Lk)("option",{value:"risk-exposure"},"Risk Exposure",-1),(0,s.Lk)("option",{value:"risk-mitigation"},"Risk Mitigation",-1)]),544),[[a.u1,l.selectedCategory]])]),(0,s.Lk)("div",zfe,[(0,s.bo)((0,s.Lk)("div",Hfe,[t[8]||(t[8]=(0,s.Lk)("div",{class:"kpi-title"},"NUMBER OF ACTIVE RISKS",-1)),(0,s.Lk)("div",Gfe,[(0,s.eW)((0,d.v_)(l.activeRisksData.current||"48")+" ",1),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.activeRisksData.percentageChange>0,down:l.activeRisksData.percentageChange<0}])},(0,d.v_)(l.activeRisksData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.activeRisksData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",Yfe,[l.activeRisksData.trendData&&l.activeRisksData.trendData.length>0?((0,s.uX)(),(0,s.CE)("div",Zfe,[((0,s.uX)(),(0,s.CE)("svg",ebe,[(0,s.Lk)("path",{d:n.generateSmoothCurvePath(l.activeRisksData.trendData,l.activeRisksData.minValue,l.activeRisksData.maxValue),class:"line-path"},null,8,tbe),(0,s.Lk)("path",{d:n.generateSmoothAreaPath(l.activeRisksData.trendData,l.activeRisksData.minValue,l.activeRisksData.maxValue),class:"chart-area"},null,8,ibe)])),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeRisksData.trendData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"ar-point-"+t,class:"data-point",style:(0,d.Tr)({left:t/(l.activeRisksData.trendData.length-1)*100+"%",top:`${n.calculatePointPosition(e,l.activeRisksData.minValue,l.activeRisksData.maxValue)}%`})},null,4))),128)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeRisksData.trendData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"ar-tooltip-"+t,class:"data-tooltip",style:(0,d.Tr)({left:t/(l.activeRisksData.trendData.length-1)*100+"%",top:`${n.calculatePointPosition(e,l.activeRisksData.minValue,l.activeRisksData.maxValue)}%`})},(0,d.v_)(l.activeRisksData.months[t])+": "+(0,d.v_)(e)+" risks ",5))),128))])):(0,s.Q3)("",!0),l.activeRisksData.months?((0,s.uX)(),(0,s.CE)("div",abe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.activeRisksData.months,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"ar-month-"+t},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)])],512),[[a.aG,n.isVisible("active-risks")]]),(0,s.bo)((0,s.Lk)("div",sbe,[t[14]||(t[14]=(0,s.Lk)("div",{class:"kpi-title"},"HIGH CRITICALITY RISKS",-1)),(0,s.Lk)("div",obe,[(0,s.eW)((0,d.v_)(l.criticalityData.count||"6.5")+" ",1),t[9]||(t[9]=(0,s.Lk)("span",{class:"criticality-badge"},"HIGH",-1))]),(0,s.Lk)("div",lbe,[(0,s.Lk)("div",nbe,[t[10]||(t[10]=(0,s.Lk)("div",{class:"item-dot critical"},null,-1)),t[11]||(t[11]=(0,s.Lk)("div",{class:"item-label"},"Critical",-1)),(0,s.Lk)("div",rbe,(0,d.v_)(l.criticalityData.criticalCount||"2"),1)]),(0,s.Lk)("div",cbe,[t[12]||(t[12]=(0,s.Lk)("div",{class:"item-dot high"},null,-1)),t[13]||(t[13]=(0,s.Lk)("div",{class:"item-label"},"High",-1)),(0,s.Lk)("div",dbe,(0,d.v_)(l.criticalityData.highCount||"4"),1)])]),(0,s.Lk)("div",ube,[((0,s.uX)(),(0,s.CE)("svg",pbe,[l.criticalityData.trendData&&l.criticalityData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateCriticalityPath(l.criticalityData.trendData),class:"criticality-path"},null,8,mbe)):(0,s.Q3)("",!0)]))])],512),[[a.aG,n.isVisible("high-criticality")]]),(0,s.bo)((0,s.Lk)("div",vbe,[t[16]||(t[16]=(0,s.Lk)("div",{class:"kpi-title"},"FREQUENCY OF RISK REGISTER UPDATE",-1)),(0,s.Lk)("div",kbe,[(0,s.eW)((0,d.v_)(l.registerUpdateData.avgUpdateFrequency||"10"),1),t[15]||(t[15]=(0,s.Lk)("span",{class:"unit"},"days",-1))]),(0,s.Lk)("div",hbe,[((0,s.uX)(),(0,s.CE)("svg",gbe,[l.registerUpdateData.monthlyUpdates&&l.registerUpdateData.monthlyUpdates.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateRegisterUpdatePath(l.registerUpdateData.monthlyUpdates),fill:"none",stroke:"#4f46e5","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,ybe)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.registerUpdateData.monthlyUpdates,(e,t)=>((0,s.uX)(),(0,s.CE)("circle",{key:"update-point-"+t,cx:t/(l.registerUpdateData.monthlyUpdates.length-1)*100,cy:n.calculateUpdateY(e),r:"2",fill:"#4f46e5",stroke:"#fff","stroke-width":"1"},null,8,fbe))),128))])),l.registerUpdateData.months?((0,s.uX)(),(0,s.CE)("div",bbe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.registerUpdateData.months,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"update-month-"+t},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)])],512),[[a.aG,n.isVisible("register-update")]])]),(0,s.Lk)("div",Cbe,[(0,s.bo)((0,s.Lk)("div",Lbe,[t[21]||(t[21]=(0,s.Lk)("div",{class:"kpi-title"},"AVERAGE TIME TO REMEDIATE CRITICAL RISKS",-1)),(0,s.Lk)("div",wbe,[(0,s.eW)((0,d.v_)(l.remediationData.current||l.kpiData.avgRemediationTime||"35"),1),t[17]||(t[17]=(0,s.Lk)("span",{class:"unit"},"days",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.remediationData.percentageChange>0,down:l.remediationData.percentageChange<0}])},(0,d.v_)(l.remediationData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.remediationData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",Ebe,[((0,s.uX)(),(0,s.CE)("svg",Rbe,[t[18]||(t[18]=(0,s.Lk)("rect",{x:"0",y:"0",width:"100",height:"40",fill:"#f8fafc",rx:"2",ry:"2"},null,-1)),t[19]||(t[19]=(0,s.Lk)("line",{x1:"0",y1:"20",x2:"100",y2:"20",stroke:"#f59e0b","stroke-width":"1.5","stroke-dasharray":"3,2"},null,-1)),(0,s.Lk)("text",Ibe,"SLA: "+(0,d.v_)(l.remediationData.slaThreshold||"30")+" days",1),l.remediationData.trendData&&l.remediationData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateRemediationPath(l.remediationData.trendData),fill:"none",stroke:"#3b82f6","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Dbe)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.remediationData.trendData,(e,t)=>((0,s.uX)(),(0,s.CE)("circle",{key:"rem-point-"+t,cx:t/(l.remediationData.trendData.length-1)*100,cy:n.calculateRemediationY(e),r:"2.5",fill:"#3b82f6",stroke:"#fff","stroke-width":"1"},null,8,Pbe))),128))])),l.remediationData.months?((0,s.uX)(),(0,s.CE)("div",_be,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.remediationData.months,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"rem-month-"+t},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)]),l.remediationData.overdueCount?((0,s.uX)(),(0,s.CE)("div",Abe,[(0,s.Lk)("div",Sbe,[(0,s.Lk)("div",Tbe,[t[20]||(t[20]=(0,s.eW)(" Overdue Critical Risks: ")),(0,s.Lk)("span",null,(0,d.v_)(l.remediationData.overdueCount),1)]),(0,s.Lk)("div",xbe,(0,d.v_)(l.remediationData.overduePercentage)+"% of active critical risks ",1)])])):(0,s.Q3)("",!0)],512),[[a.aG,n.isVisible("avg-remediation")]]),(0,s.bo)((0,s.Lk)("div",Fbe,[t[25]||(t[25]=(0,s.Lk)("div",{class:"kpi-title"},"RATE OF RECURRENCE",-1)),(0,s.Lk)("div",Vbe,[(0,s.eW)((0,d.v_)(l.recurrenceData.recurrenceRate||l.kpiData.recurrenceRate||"6.5"),1),t[22]||(t[22]=(0,s.Lk)("span",{class:"percent"},"%",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.recurrenceData.percentageChange>0,down:l.recurrenceData.percentageChange<0}])},(0,d.v_)(l.recurrenceData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.recurrenceData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",Ube,[t[23]||(t[23]=(0,s.Lk)("div",{class:"recurrence-labels"},[(0,s.Lk)("span",{class:"one-time-label"},"One-time"),(0,s.Lk)("span",{class:"recurring-label"},"Recurring")],-1)),(0,s.Lk)("div",Nbe,[(0,s.Lk)("span",Mbe,(0,d.v_)(l.recurrenceData.oneTimeRate||93.5)+"%",1),(0,s.Lk)("span",Xbe,(0,d.v_)(l.recurrenceData.recurrenceRate||6.5)+"%",1)]),(0,s.Lk)("div",$be,[(0,s.Lk)("div",{class:"recurrence-bar one-time",style:(0,d.Tr)({width:`${l.recurrenceData.oneTimeRate||93.5}%`})},null,4),(0,s.Lk)("div",{class:"recurrence-bar recurring",style:(0,d.Tr)({width:`${l.recurrenceData.recurrenceRate||6.5}%`})},null,4)])]),(0,s.Lk)("div",Obe,[((0,s.uX)(),(0,s.CE)("svg",jbe,[t[24]||(t[24]=(0,s.Lk)("rect",{x:"0",y:"0",width:"100",height:"50",fill:"#f8fafc",rx:"2",ry:"2"},null,-1)),l.recurrenceData.trendData&&l.recurrenceData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateRecurrencePath(l.recurrenceData.trendData),fill:"none",stroke:"#ef4444","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,Bbe)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceData.trendData,(e,t)=>((0,s.uX)(),(0,s.CE)("circle",{key:"rec-point-"+t,cx:t/(l.recurrenceData.trendData.length-1)*100,cy:n.calculateRecurrenceY(e),r:"2.5",fill:"#ef4444",stroke:"#fff","stroke-width":"1"},null,8,Wbe))),128))])),(0,s.Lk)("div",qbe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceData.months,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"rec-month-"+t},(0,d.v_)(e),1))),128))])])],512),[[a.aG,n.isVisible("rate-recurrence")]]),(0,s.bo)((0,s.Lk)("div",Qbe,[t[32]||(t[32]=(0,s.Lk)("div",{class:"kpi-title"},"AVERAGE TIME TO INCIDENT RESPONSE",-1)),(0,s.Lk)("div",Kbe,[(0,s.eW)((0,d.v_)(n.formatResponseTime(l.responseData.current)),1),(0,s.Lk)("span",Jbe,(0,d.v_)(l.responseData.current>72?"":"hours"),1),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.responseData.percentageChange>0,down:l.responseData.percentageChange<0}])},(0,d.v_)(l.responseData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.responseData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",zbe,[((0,s.uX)(),(0,s.CE)("svg",Hbe,[t[26]||(t[26]=(0,s.Lk)("path",{d:"M 30 70 A 70 70 0 0 1 170 70",stroke:"#e5e7eb","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),t[27]||(t[27]=(0,s.Lk)("path",{d:"M 30 70 A 70 70 0 0 1 80 25",stroke:"#10b981","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),t[28]||(t[28]=(0,s.Lk)("path",{d:"M 80 25 A 70 70 0 0 1 120 25",stroke:"#f59e0b","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),t[29]||(t[29]=(0,s.Lk)("path",{d:"M 120 25 A 70 70 0 0 1 170 70",stroke:"#ef4444","stroke-width":"8",fill:"none","stroke-linecap":"round"},null,-1)),(0,s.Lk)("line",{x1:"100",y1:"70",x2:n.calculateGaugeNeedleX(l.responseData.current||6),y2:n.calculateGaugeNeedleY(l.responseData.current||6),stroke:"#0f172a","stroke-width":"3","stroke-linecap":"round"},null,8,Gbe),t[30]||(t[30]=(0,s.Lk)("circle",{cx:"100",cy:"70",r:"4",fill:"#0f172a"},null,-1)),(0,s.Lk)("text",Ybe,"Target: "+(0,d.v_)(l.responseData.target||"4")+"h",1),(0,s.Lk)("text",Zbe,"SLA: "+(0,d.v_)(l.responseData.sla||"8")+"h",1)]))]),l.responseData.current>72?((0,s.uX)(),(0,s.CE)("div",eCe," Response time significantly exceeds SLA threshold ")):(0,s.Q3)("",!0),(0,s.Lk)("div",tCe,[((0,s.uX)(),(0,s.CE)("svg",iCe,[t[31]||(t[31]=(0,s.Lk)("rect",{x:"0",y:"0",width:"100",height:"40",fill:"#f8fafc",rx:"2",ry:"2"},null,-1)),l.responseData.trendData&&l.responseData.trendData.length>0?((0,s.uX)(),(0,s.CE)("path",{key:0,d:n.generateResponsePath(l.responseData.trendData),fill:"none",stroke:"#ef4444","stroke-width":"2","stroke-linejoin":"round","stroke-linecap":"round"},null,8,aCe)):(0,s.Q3)("",!0),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.responseData.trendData,(e,t)=>((0,s.uX)(),(0,s.CE)("circle",{key:"resp-point-"+t,cx:t/(l.responseData.trendData.length-1)*100,cy:n.calculateResponseY(e),r:"2",fill:"#ef4444",stroke:"#fff","stroke-width":"0.5"},null,8,sCe))),128))])),(0,s.Lk)("div",oCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.responseData.months,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"resp-month-"+t},(0,d.v_)(e),1))),128))])])],512),[[a.aG,n.isVisible("avg-response")]]),(0,s.bo)((0,s.Lk)("div",lCe,[(0,s.Lk)("div",nCe,[t[34]||(t[34]=(0,s.Lk)("div",{class:"kpi-title"},"COST OF MITIGATION",-1)),(0,s.Lk)("div",rCe,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>l.mitigationCostPeriod=e),onChange:t[3]||(t[3]=(...e)=>n.fetchMitigationCostData&&n.fetchMitigationCostData(...e))},t[33]||(t[33]=[(0,s.Lk)("option",{value:"30days"},"Last 30 days",-1),(0,s.Lk)("option",{value:"90days"},"Last 90 days",-1),(0,s.Lk)("option",{value:"6months"},"Last 6 months",-1),(0,s.Lk)("option",{value:"1year"},"Last 1 year",-1)]),544),[[a.u1,l.mitigationCostPeriod]])])]),(0,s.Lk)("div",cCe,[(0,s.eW)(" ₹"+(0,d.v_)(l.mitigationCostData.totalCost||l.kpiData.mitigationCost||"184")+"K ",1),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.mitigationCostData.percentageChange>0,down:l.mitigationCostData.percentageChange<0}])},(0,d.v_)(l.mitigationCostData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.mitigationCostData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",dCe,[l.mitigationCostData.monthlyData&&l.mitigationCostData.monthlyData.length>0?((0,s.uX)(),(0,s.CE)("div",uCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationCostData.monthlyData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"cost-bar-"+t,class:"cost-bar",style:(0,d.Tr)({height:n.calculateCostBarHeight(e.cost)+"%"})},[(0,s.Lk)("div",pCe,"₹"+(0,d.v_)(e.cost)+"K",1)],4))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",mCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationCostData.monthlyData,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"cost-month-"+t},(0,d.v_)(e.month),1))),128))]),(0,s.Lk)("div",vCe,[(0,s.Lk)("div",kCe,[t[35]||(t[35]=(0,s.Lk)("div",{class:"metric-label"},"Avg Cost",-1)),(0,s.Lk)("div",hCe,"₹"+(0,d.v_)(l.mitigationCostData.avgCost||"31")+"K",1)]),(0,s.Lk)("div",gCe,[t[36]||(t[36]=(0,s.Lk)("div",{class:"metric-label"},"Highest",-1)),(0,s.Lk)("div",yCe,"₹"+(0,d.v_)(l.mitigationCostData.highestCost||"42")+"K",1)])])])],512),[[a.aG,n.isVisible("cost-mitigation")]]),(0,s.bo)((0,s.Lk)("div",fCe,[t[39]||(t[39]=(0,s.Lk)("div",{class:"kpi-title"},"Risk Identification Rate",-1)),(0,s.Lk)("div",bCe,[(0,s.eW)((0,d.v_)(null!==l.identificationRate?l.identificationRate:"--")+"% ",1),(0,s.Lk)("span",{class:(0,d.C4)(["percent",{up:l.identificationChange>0,down:l.identificationChange<0}])},(0,d.v_)(l.identificationChange>0?"+":"")+(0,d.v_)(null!==l.identificationChange?l.identificationChange:"--")+"% ",3)]),(0,s.Lk)("div",CCe,[t[37]||(t[37]=(0,s.eW)(" Avg. Daily ")),(0,s.Lk)("b",null,(0,d.v_)(null!==l.avgDailyRisks?l.avgDailyRisks:"--"),1),t[38]||(t[38]=(0,s.eW)(" risks/day "))]),(0,s.Lk)("div",LCe,[l.identificationTrend&&l.identificationTrend.length>1?((0,s.uX)(),(0,s.CE)("svg",wCe,[(0,s.Lk)("polygon",{points:n.generateAreaPoints(l.identificationTrend,120,60),class:"identification-area"},null,8,ECe),(0,s.Lk)("polyline",{points:n.generateLinePoints(l.identificationTrend,120,60),class:"identification-path",fill:"none",stroke:"#3b82f6","stroke-width":"2"},null,8,RCe),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.identificationTrend,(e,t)=>((0,s.uX)(),(0,s.CE)("circle",{key:"identification-point-"+t,cx:n.getX(t,l.identificationTrend.length,120),cy:n.getY(e,l.identificationTrend,60),r:"2",class:"identification-point"},null,8,ICe))),128))])):(0,s.Q3)("",!0),l.identificationMonths&&l.identificationMonths.length?((0,s.uX)(),(0,s.CE)("div",DCe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.identificationMonths,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"identification-month-"+t},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0)])],512),[[a.aG,n.isVisible("identification-rate")]]),(0,s.bo)((0,s.Lk)("div",PCe,[(0,s.Lk)("div",_Ce,[t[41]||(t[41]=(0,s.Lk)("div",{class:"kpi-title"},"PERCENTAGE OF DUE MITIGATION ACTIONS",-1)),(0,s.Lk)("div",ACe,[(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[4]||(t[4]=e=>l.dueMitigationPeriod=e),onChange:t[5]||(t[5]=(...e)=>n.fetchDueMitigationData&&n.fetchDueMitigationData(...e))},t[40]||(t[40]=[(0,s.Lk)("option",{value:"30days"},"Last 30 days",-1),(0,s.Lk)("option",{value:"90days"},"Last 90 days",-1),(0,s.Lk)("option",{value:"6months"},"Last 6 months",-1),(0,s.Lk)("option",{value:"1year"},"Last 1 year",-1)]),544),[[a.u1,l.dueMitigationPeriod]])])]),(0,s.Lk)("div",SCe,[(0,s.eW)((0,d.v_)(l.dueMitigationData.overduePercentage||l.kpiData.dueMitigation||"22"),1),t[42]||(t[42]=(0,s.Lk)("span",{class:"percent"},"%",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.dueMitigationData.percentageChange<0,down:l.dueMitigationData.percentageChange>0}])},(0,d.v_)(l.dueMitigationData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.dueMitigationData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",TCe,[(0,s.Lk)("div",xCe,[((0,s.uX)(),(0,s.CE)("svg",FCe,[t[43]||(t[43]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"#f5f7fa",stroke:"none"},null,-1)),(0,s.Lk)("path",{d:n.generatePieSegment(35,35,30,20,0,l.dueMitigationData.completedPercentage||50),fill:"#10b981"},null,8,VCe),(0,s.Lk)("path",{d:n.generatePieSegment(35,35,30,20,l.dueMitigationData.completedPercentage||50,(l.dueMitigationData.completedPercentage||50)+(l.dueMitigationData.pendingPercentage||28)),fill:"#3b82f6"},null,8,UCe),(0,s.Lk)("path",{d:n.generatePieSegment(35,35,30,20,(l.dueMitigationData.completedPercentage||50)+(l.dueMitigationData.pendingPercentage||28),100),fill:"#ef4444"},null,8,NCe),t[44]||(t[44]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"15",fill:"white",stroke:"none"},null,-1))]))]),(0,s.Lk)("div",MCe,[(0,s.Lk)("div",XCe,[t[45]||(t[45]=(0,s.Lk)("div",{class:"legend-color completed"},null,-1)),t[46]||(t[46]=(0,s.Lk)("div",{class:"legend-label"},"Completed",-1)),(0,s.Lk)("div",$Ce,(0,d.v_)(l.dueMitigationData.completedPercentage||"50")+"%",1)]),(0,s.Lk)("div",OCe,[t[47]||(t[47]=(0,s.Lk)("div",{class:"legend-color pending"},null,-1)),t[48]||(t[48]=(0,s.Lk)("div",{class:"legend-label"},"Pending",-1)),(0,s.Lk)("div",jCe,(0,d.v_)(l.dueMitigationData.pendingPercentage||"28")+"%",1)]),(0,s.Lk)("div",BCe,[t[49]||(t[49]=(0,s.Lk)("div",{class:"legend-color overdue"},null,-1)),t[50]||(t[50]=(0,s.Lk)("div",{class:"legend-label"},"Overdue",-1)),(0,s.Lk)("div",WCe,(0,d.v_)(l.dueMitigationData.overduePercentage||"22")+"%",1)])])]),(0,s.Lk)("div",qCe,[(0,s.Lk)("div",QCe,(0,d.v_)(l.dueMitigationData.overdueCount||"8")+" mitigation tasks overdue",1)])],512),[[a.aG,n.isVisible("due-mitigation")]]),(0,s.bo)((0,s.Lk)("div",KCe,[t[54]||(t[54]=(0,s.Lk)("div",{class:"kpi-title"},"COMPLETION OF IMPROVEMENT INITIATIVES",-1)),(0,s.Lk)("div",JCe,[((0,s.uX)(),(0,s.CE)("svg",zCe,[t[51]||(t[51]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"transparent",stroke:"#e5e7eb","stroke-width":"8"},null,-1)),(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"transparent",stroke:"#4f46e5","stroke-width":"8","stroke-linecap":"round","stroke-dasharray":1.88*l.initiativeData.completionPercentage+" 188.5","stroke-dashoffset":"0",transform:"rotate(-90 35 35)"},null,8,HCe),(0,s.Lk)("text",GCe,(0,d.v_)(l.initiativeData.completionPercentage||"76")+"%",1)])),(0,s.Lk)("div",YCe,[(0,s.Lk)("div",ZCe,[t[52]||(t[52]=(0,s.Lk)("div",{class:"count-label"},"Completed",-1)),(0,s.Lk)("div",eLe,(0,d.v_)(l.initiativeData.completedCount||"19"),1)]),(0,s.Lk)("div",tLe,[t[53]||(t[53]=(0,s.Lk)("div",{class:"count-label"},"Total",-1)),(0,s.Lk)("div",iLe,(0,d.v_)(l.initiativeData.totalCount||"25"),1)])])])],512),[[a.aG,n.isVisible("improvement-initiatives")]]),(0,s.bo)((0,s.Lk)("div",aLe,[t[60]||(t[60]=(0,s.Lk)("div",{class:"kpi-title"},"RISK IMPACT ON OPERATIONS AND FINANCES",-1)),(0,s.Lk)("div",sLe,[(0,s.eW)((0,d.v_)(Number(l.impactData.overallScore||5.7).toFixed(1)),1),t[55]||(t[55]=(0,s.Lk)("span",{class:"unit"},"/10",-1))]),(0,s.Lk)("div",oLe,[t[56]||(t[56]=(0,s.Lk)("div",{class:"impact-gradient"},null,-1)),(0,s.Lk)("div",{class:"impact-pointer",style:(0,d.Tr)({left:`${(10*Number(l.impactData.overallScore||5.7)).toFixed(1)}%`})},null,4),t[57]||(t[57]=(0,s.Lk)("div",{class:"impact-scale"},[(0,s.Lk)("span",null,"0"),(0,s.Lk)("span",null,"5"),(0,s.Lk)("span",null,"10")],-1))]),(0,s.Lk)("div",lLe,[t[58]||(t[58]=(0,s.Lk)("div",{class:"chart-header"},[(0,s.Lk)("span",{class:"axis-label op"},"Operational Impact"),(0,s.Lk)("span",{class:"axis-label fin"},"Financial Impact")],-1)),(0,s.Lk)("div",nLe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.impactData.topRisks||l.defaultTopRisks,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"impact-"+t,class:(0,d.C4)(["impact-bubble",e.category.toLowerCase()]),style:(0,d.Tr)({left:10*e.operational_impact+"%",bottom:9*e.financial_impact+"%",width:`${Math.min(10,2.5*Math.max(e.operational_impact,e.financial_impact))}px`,height:`${Math.min(10,2.5*Math.max(e.operational_impact,e.financial_impact))}px`}),title:`${e.title}: Op Impact ${e.operational_impact}, Fin Impact ${e.financial_impact}`},null,14,rLe))),128))]),t[59]||(t[59]=(0,s.Lk)("div",{class:"impact-grid-lines"},[(0,s.Lk)("div",{class:"grid-line vertical"}),(0,s.Lk)("div",{class:"grid-line horizontal"})],-1))])],512),[[a.aG,n.isVisible("risk-impact")]]),(0,s.bo)((0,s.Lk)("div",cLe,[t[66]||(t[66]=(0,s.Lk)("div",{class:"kpi-title"},"Risk Severity Based on Potential",-1)),(0,s.Lk)("div",dLe,[(0,s.eW)((0,d.v_)(l.averageSeverity),1),t[61]||(t[61]=(0,s.Lk)("span",{class:"unit"},"/10",-1))]),(0,s.Lk)("div",uLe,"Most Severe: "+(0,d.v_)(l.mostSevereRisk),1),(0,s.Lk)("div",pLe,[(0,s.Lk)("div",mLe,[t[62]||(t[62]=(0,s.Lk)("span",{class:"category-label"},"Low",-1)),(0,s.Lk)("span",vLe,(0,d.v_)(l.severityPercentages.Low)+"%",1)]),(0,s.Lk)("div",kLe,[t[63]||(t[63]=(0,s.Lk)("span",{class:"category-label"},"Medium",-1)),(0,s.Lk)("span",hLe,(0,d.v_)(l.severityPercentages.Medium)+"%",1)]),(0,s.Lk)("div",gLe,[t[64]||(t[64]=(0,s.Lk)("span",{class:"category-label"},"High",-1)),(0,s.Lk)("span",yLe,(0,d.v_)(l.severityPercentages.High)+"%",1)]),(0,s.Lk)("div",fLe,[t[65]||(t[65]=(0,s.Lk)("span",{class:"category-label"},"Critical",-1)),(0,s.Lk)("span",bLe,(0,d.v_)(l.severityPercentages.Critical)+"%",1)])]),(0,s.Lk)("div",CLe,[(0,s.Lk)("div",LLe,[(0,s.Lk)("div",{class:"severity-segment low",style:(0,d.Tr)(n.severitySegmentStyles.low)},null,4),(0,s.Lk)("div",{class:"severity-segment medium",style:(0,d.Tr)(n.severitySegmentStyles.medium)},null,4),(0,s.Lk)("div",{class:"severity-segment high",style:(0,d.Tr)(n.severitySegmentStyles.high)},null,4),(0,s.Lk)("div",{class:"severity-segment critical",style:(0,d.Tr)(n.severitySegmentStyles.critical)},null,4)])])],512),[[a.aG,n.isVisible("risk-severity")]]),(0,s.bo)((0,s.Lk)("div",wLe,[t[70]||(t[70]=(0,s.Lk)("div",{class:"kpi-title"},"RISK EXPOSURE SCORE",-1)),(0,s.Lk)("div",ELe,[(0,s.eW)((0,d.v_)(l.exposureScoreData.overallScore||l.kpiData.exposureScore||"75"),1),t[67]||(t[67]=(0,s.Lk)("span",{class:"percent"},"%",-1))]),(0,s.Lk)("div",RLe,[(0,s.Lk)("div",ILe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.exposureScoreData.riskPoints||[],(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"exp-"+t,class:(0,d.C4)(["exposure-point",n.getCategoryClass(e.category)]),style:(0,d.Tr)({left:e.likelihood/10*100+"%",bottom:e.impact/10*100+"%",width:`${Math.min(12,1.2*e.exposure)}px`,height:`${Math.min(12,1.2*e.exposure)}px`}),title:`${e.title}: Impact ${e.impact.toFixed(1)}, Likelihood ${e.likelihood.toFixed(1)}, Exposure ${e.exposure}`},null,14,DLe))),128)),t[68]||(t[68]=(0,s.Fv)('<div class="grid-line vertical" style="left:33%;" data-v-175f7afa></div><div class="grid-line vertical" style="left:67%;" data-v-175f7afa></div><div class="grid-line horizontal" style="bottom:33%;" data-v-175f7afa></div><div class="grid-line horizontal" style="bottom:67%;" data-v-175f7afa></div><div class="axis-label x-label" data-v-175f7afa>Likelihood</div><div class="axis-label y-label" data-v-175f7afa>Impact</div>',6))]),(0,s.Lk)("div",PLe,[t[69]||(t[69]=(0,s.Lk)("div",{class:"exposure-header"},"Top Risks by Exposure",-1)),(0,s.Lk)("div",_Le,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.getTopRisks(l.exposureScoreData.riskPoints||[]),(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"top-"+t,class:"exposure-risk-item"},[(0,s.Lk)("div",{class:(0,d.C4)(["risk-dot",n.getCategoryClass(e.category)])},null,2),(0,s.Lk)("div",ALe,(0,d.v_)(e.title),1),(0,s.Lk)("div",SLe,(0,d.v_)(e.exposure),1)]))),128))])])])],512),[[a.aG,n.isVisible("exposure-score")]]),(0,s.bo)((0,s.Lk)("div",TLe,[t[73]||(t[73]=(0,s.Lk)("div",{class:"kpi-title"},"RISK RESILIENCE TO ABSORB SHOCKS",-1)),(0,s.Lk)("div",xLe,[(0,s.eW)((0,d.v_)(l.resilienceData.avgDowntime||l.kpiData.resilienceHours||"4.6"),1),t[71]||(t[71]=(0,s.Lk)("span",{class:"unit"},"hrs",-1))]),(0,s.Lk)("div",FLe,[(0,s.Lk)("div",VLe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.resilienceData.categoryData||l.defaultResilienceData,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"res-"+t,class:"resilience-category"},[(0,s.Lk)("div",ULe,(0,d.v_)(e.category),1),(0,s.Lk)("div",NLe,[(0,s.Lk)("div",{class:"time-bar downtime",style:(0,d.Tr)({width:10*e.downtime+"%"})},[(0,s.Lk)("span",MLe,(0,d.v_)(e.downtime)+"h",1)],4),(0,s.Lk)("div",{class:"time-bar recovery",style:(0,d.Tr)({width:10*e.recovery+"%"})},[(0,s.Lk)("span",XLe,(0,d.v_)(e.recovery)+"h",1)],4)])]))),128))]),t[72]||(t[72]=(0,s.Fv)('<div class="resilience-legend" data-v-175f7afa><div class="legend-item" data-v-175f7afa><div class="legend-color downtime" data-v-175f7afa></div><div class="legend-label" data-v-175f7afa>Expected Downtime</div></div><div class="legend-item" data-v-175f7afa><div class="legend-color recovery" data-v-175f7afa></div><div class="legend-label" data-v-175f7afa>Recovery Time</div></div></div>',1))])],512),[[a.aG,n.isVisible("risk-resilience")]]),(0,s.bo)((0,s.Lk)("div",$Le,[t[76]||(t[76]=(0,s.Lk)("div",{class:"kpi-title"},"FREQUENCY OF RISK ASSESSMENT REVIEW",-1)),(0,s.Lk)("div",OLe,[(0,s.eW)((0,d.v_)(l.assessmentData.avgReviewFrequency||"60"),1),t[74]||(t[74]=(0,s.Lk)("span",{class:"unit"},"days",-1)),l.assessmentData.overdueCount?((0,s.uX)(),(0,s.CE)("span",jLe,(0,d.v_)(l.assessmentData.overdueCount||"3")+" overdue",1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",BLe,[(0,s.Lk)("div",WLe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assessmentData.monthlyReviews||[15,18,22,17,20,23],(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"assess-"+t,class:"assessment-bar",style:(0,d.Tr)({height:`${n.calculateAssessmentBarHeight(e)}%`})},[(0,s.Lk)("div",qLe,(0,d.v_)(e),1)],4))),128))]),l.assessmentData.months?((0,s.uX)(),(0,s.CE)("div",QLe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assessmentData.months,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"assess-month-"+t},(0,d.v_)(e),1))),128))])):(0,s.Q3)("",!0),(0,s.Lk)("div",KLe,[t[75]||(t[75]=(0,s.Lk)("div",{class:"breakdown-title"},"By Category (Average Days)",-1)),l.assessmentData.categoryFrequencies?((0,s.uX)(),(0,s.CE)("div",JLe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.assessmentData.categoryFrequencies,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"cat-"+t,class:"category-bar-container"},[(0,s.Lk)("div",zLe,(0,d.v_)(t),1),(0,s.Lk)("div",HLe,[(0,s.Lk)("div",{class:"category-bar",style:(0,d.Tr)({width:n.calculateCategoryBarWidth(e)+"%"})},null,4)]),(0,s.Lk)("div",GLe,(0,d.v_)(e),1)]))),128))])):(0,s.Q3)("",!0)])])],512),[[a.aG,n.isVisible("assessment-review")]]),(0,s.bo)((0,s.Lk)("div",YLe,[t[86]||(t[86]=(0,s.Lk)("div",{class:"kpi-title"},"RISK ASSESSMENT CONSENSUS",-1)),(0,s.Lk)("div",ZLe,[(0,s.eW)((0,d.v_)(l.consensusData.consensusPercentage||"75"),1),t[77]||(t[77]=(0,s.Lk)("span",{class:"percent"},"%",-1)),t[78]||(t[78]=(0,s.Lk)("span",{class:"consensus-label"},"agreement",-1))]),(0,s.Lk)("div",ewe,[(0,s.Lk)("div",twe,[((0,s.uX)(),(0,s.CE)("svg",iwe,[t[79]||(t[79]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"30",fill:"#f8fafc",stroke:"#e5e7eb","stroke-width":"1"},null,-1)),(0,s.Lk)("path",{d:n.generateArcPath(35,35,30,0,l.consensusData.consensusPercentage||75),fill:"#3b82f6"},null,8,awe),(0,s.Lk)("path",{d:n.generateArcPath(35,35,30,l.consensusData.consensusPercentage||75,100),fill:"#ef4444"},null,8,swe),t[80]||(t[80]=(0,s.Lk)("circle",{cx:"35",cy:"35",r:"15",fill:"white"},null,-1))]))]),(0,s.Lk)("div",owe,[(0,s.Lk)("div",lwe,[t[81]||(t[81]=(0,s.Lk)("div",{class:"legend-color consensus"},null,-1)),t[82]||(t[82]=(0,s.Lk)("div",{class:"legend-label"},"Consensus",-1)),(0,s.Lk)("div",nwe,(0,d.v_)(l.consensusData.consensusCount||"90"),1)]),(0,s.Lk)("div",rwe,[t[83]||(t[83]=(0,s.Lk)("div",{class:"legend-color no-consensus"},null,-1)),t[84]||(t[84]=(0,s.Lk)("div",{class:"legend-label"},"No Consensus",-1)),(0,s.Lk)("div",cwe,(0,d.v_)(l.consensusData.noConsensusCount||"30"),1)])])]),(0,s.Lk)("div",dwe,[t[85]||(t[85]=(0,s.Lk)("div",{class:"investigation-title"},"Needs Investigation",-1)),l.consensusData.lowConsensusRisks&&l.consensusData.lowConsensusRisks.length>0?((0,s.uX)(),(0,s.CE)("div",uwe,[(0,s.Lk)("div",pwe,[(0,s.Lk)("div",mwe,(0,d.v_)(l.consensusData.lowConsensusRisks[0].title),1),(0,s.Lk)("div",vwe,(0,d.v_)(l.consensusData.lowConsensusRisks[0].agreement)+" agreed",1)])])):(0,s.Q3)("",!0)])],512),[[a.aG,n.isVisible("assessment-consensus")]]),(0,s.bo)((0,s.Lk)("div",kwe,t[87]||(t[87]=[(0,s.Lk)("div",{class:"kpi-title"},"RISK ASSESSMENT CONSENSUS",-1)]),512),[[a.aG,!1]]),(0,s.bo)((0,s.Lk)("div",hwe,[t[94]||(t[94]=(0,s.Lk)("div",{class:"kpi-title"},"RISK APPROVAL RATE AND CYCLE",-1)),(0,s.Lk)("div",gwe,[(0,s.eW)((0,d.v_)(l.approvalRateData.approvalRate||"81"),1),t[88]||(t[88]=(0,s.Lk)("span",{class:"percent"},"%",-1)),t[89]||(t[89]=(0,s.Lk)("span",{class:"approval-label"},"approval rate",-1))]),(0,s.Lk)("div",ywe,[(0,s.Lk)("div",fwe,[t[90]||(t[90]=(0,s.Lk)("div",{class:"metric-icon"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"#3b82f6"},[(0,s.Lk)("path",{d:"M12 12.75c1.148 0 2.278.08 3.383.237 1.037.146 1.866.966 1.866 2.013 0 3.728-2.35 6.75-5.25 6.75S6.75 18.728 6.75 15c0-1.046.83-1.867 1.866-2.013A24.204 24.204 0 0 1 12 12.75Z"}),(0,s.Lk)("path",{d:"M12 8.25a2.25 2.25 0 0 0 0-4.5 2.25 2.25 0 0 0 0 4.5Z"})])],-1)),(0,s.Lk)("div",bwe,(0,d.v_)(l.approvalRateData.avgReviewCycles||"3.2"),1),t[91]||(t[91]=(0,s.Lk)("div",{class:"metric-label"},"Avg. Review Cycles",-1))]),(0,s.Lk)("div",Cwe,[t[92]||(t[92]=(0,s.Lk)("div",{class:"metric-icon"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"#3b82f6"},[(0,s.Lk)("path",{d:"M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75ZM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 0 1-1.875-1.875V8.625ZM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 0 1 3 19.875v-6.75Z"})])],-1)),(0,s.Lk)("div",Lwe,(0,d.v_)(l.approvalRateData.maxReviewCycles||"4"),1),t[93]||(t[93]=(0,s.Lk)("div",{class:"metric-label"},"Max Review Cycles",-1))])])],512),[[a.aG,n.isVisible("approval-rate-cycle")]]),(0,s.bo)((0,s.Lk)("div",wwe,[t[101]||(t[101]=(0,s.Lk)("div",{class:"kpi-title"},"RISK REDUCTION TREND",-1)),(0,s.Lk)("div",Ewe,[(0,s.eW)((0,d.v_)(l.reductionData.reductionPercentage||"25"),1),t[95]||(t[95]=(0,s.Lk)("span",{class:"percent"},"%",-1)),t[96]||(t[96]=(0,s.Lk)("span",{class:"reduction-label"},"reduction",-1))]),(0,s.Lk)("div",Rwe,[(0,s.Lk)("div",{class:"waterfall-bar start",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.startCount)})},[(0,s.Lk)("div",Iwe,(0,d.v_)(l.reductionData.startCount),1)],4),t[97]||(t[97]=(0,s.Lk)("div",{class:"connector-line"},null,-1)),(0,s.Lk)("div",{class:"waterfall-bar new",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.newCount)})},[(0,s.Lk)("div",Dwe,"+"+(0,d.v_)(l.reductionData.newCount),1)],4),t[98]||(t[98]=(0,s.Lk)("div",{class:"connector-line"},null,-1)),(0,s.Lk)("div",{class:"waterfall-bar mitigated",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.mitigatedCount)})},[(0,s.Lk)("div",Pwe,"-"+(0,d.v_)(l.reductionData.mitigatedCount),1)],4),t[99]||(t[99]=(0,s.Lk)("div",{class:"connector-line"},null,-1)),(0,s.Lk)("div",{class:"waterfall-bar end",style:(0,d.Tr)({height:n.calculateWaterfallBarHeight(l.reductionData.endCount)})},[(0,s.Lk)("div",_we,(0,d.v_)(l.reductionData.endCount),1)],4),t[100]||(t[100]=(0,s.Lk)("div",{class:"waterfall-labels"},[(0,s.Lk)("span",null,"Start"),(0,s.Lk)("span",null,"New"),(0,s.Lk)("span",null,"Mitigated"),(0,s.Lk)("span",null,"End")],-1))])],512),[[a.aG,n.isVisible("risk-reduction-trend")]]),(0,s.bo)((0,s.Lk)("div",Awe,[t[104]||(t[104]=(0,s.Lk)("div",{class:"kpi-title"},"RISK MITIGATION COMPLETION RATE",-1)),(0,s.Lk)("div",Swe,[(0,s.eW)((0,d.v_)(l.kpiData.mitigationCompletionRate||"76"),1),t[102]||(t[102]=(0,s.Lk)("span",{class:"percent"},"%",-1))]),(0,s.Lk)("div",Twe,[(0,s.Lk)("div",{class:"progress-fill",style:(0,d.Tr)({width:(l.kpiData.mitigationCompletionRate||76)+"%"})},null,4)]),(0,s.Lk)("div",xwe,[(0,s.Lk)("div",Fwe,[t[103]||(t[103]=(0,s.eW)("Avg. Time to Mitigation: ")),(0,s.Lk)("span",Vwe,(0,d.v_)(l.mitigationData.avgDays||"14")+" days",1)]),(0,s.Lk)("div",{class:(0,d.C4)(["sla-indicator",{"sla-warning":l.mitigationData.avgDays>l.mitigationData.slaDays}])}," SLA: "+(0,d.v_)(l.mitigationData.slaDays||"21")+" days ",3)])],512),[[a.aG,n.isVisible("mitigation-completion")]]),(0,s.bo)((0,s.Lk)("div",Uwe,[t[107]||(t[107]=(0,s.Lk)("div",{class:"kpi-title"},"PROBABILITY OF RISK RECURRENCE",-1)),(0,s.Lk)("div",Nwe,[(0,s.eW)((0,d.v_)(l.recurrenceProbabilityData.averageProbability||"38"),1),t[105]||(t[105]=(0,s.Lk)("span",{class:"percent"},"%",-1)),(0,s.Lk)("span",{class:(0,d.C4)(["trend-indicator",{up:l.recurrenceProbabilityData.percentageChange>0,down:l.recurrenceProbabilityData.percentageChange<0}])},(0,d.v_)(l.recurrenceProbabilityData.percentageChange>0?"↑":"↓")+" "+(0,d.v_)(Math.abs(l.recurrenceProbabilityData.percentageChange||0))+"% ",3)]),(0,s.Lk)("div",Mwe,[(0,s.Lk)("div",Xwe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceProbabilityData.probabilityRanges||l.defaultProbabilityRanges,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"prob-"+t,class:(0,d.C4)(["histogram-bar",n.getBarClass(e.range)]),style:(0,d.Tr)({height:n.calculateHistogramBarHeight(e.count)+"%"})},[(0,s.Lk)("div",$we,(0,d.v_)(e.count),1)],6))),128))]),(0,s.Lk)("div",Owe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.recurrenceProbabilityData.probabilityRanges||l.defaultProbabilityRanges,(e,t)=>((0,s.uX)(),(0,s.CE)("span",{key:"label-"+t,class:"range-label"},(0,d.v_)(e.range),1))),128))])]),l.recurrenceProbabilityData.highRecurrenceRisks&&l.recurrenceProbabilityData.highRecurrenceRisks.length>0?((0,s.uX)(),(0,s.CE)("div",jwe,[t[106]||(t[106]=(0,s.Lk)("div",{class:"high-prob-title"},"Highest Probability Risk",-1)),(0,s.Lk)("div",Bwe,[(0,s.Lk)("div",Wwe,(0,d.v_)(l.recurrenceProbabilityData.highRecurrenceRisks[0].title),1),(0,s.Lk)("div",qwe,(0,d.v_)(l.recurrenceProbabilityData.highRecurrenceRisks[0].probability)+"%",1)])])):(0,s.Q3)("",!0)],512),[[a.aG,n.isVisible("recurrence-probability")]]),(0,s.bo)((0,s.Lk)("div",Qwe,[t[108]||(t[108]=(0,s.Lk)("div",{class:"kpi-title"},"RISK TOLERANCE THRESHOLDS",-1)),(0,s.Lk)("div",Kwe,[(0,s.Lk)("span",{class:(0,d.C4)(["tolerance-status",n.getToleranceStatusClass(l.toleranceData.overallStatus)])},(0,d.v_)(l.toleranceData.overallStatus||"Near Limits"),3)]),(0,s.Lk)("div",Jwe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.toleranceData.toleranceThresholds||l.defaultToleranceThresholds,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:"tolerance-"+t,class:"tolerance-category"},[(0,s.Lk)("div",zwe,[(0,s.Lk)("div",Hwe,(0,d.v_)(t),1),(0,s.Lk)("div",{class:(0,d.C4)(["category-status",n.getCategoryStatusClass(e.status)])},(0,d.v_)(e.status),3)]),(0,s.Lk)("div",Gwe,[(0,s.Lk)("div",{class:(0,d.C4)(["tolerance-bar","status-"+e.status.toLowerCase()]),style:(0,d.Tr)({width:Math.min(100,e.percentage)+"%"})},null,6)])]))),128))])],512),[[a.aG,n.isVisible("tolerance-thresholds")]]),(0,s.bo)((0,s.Lk)("div",Ywe,[t[112]||(t[112]=(0,s.Lk)("div",{class:"kpi-title"},"RISK APPETITE BASED ON TOLERANCE LEVEL",-1)),(0,s.Lk)("div",Zwe,[(0,s.Lk)("div",eEe,(0,d.v_)(l.appetiteData.currentLevel||6),1),t[109]||(t[109]=(0,s.Lk)("div",{class:"unit-label"},"/10",-1)),(0,s.Lk)("div",tEe,(0,d.v_)(l.appetiteData.description||"Balanced risk approach"),1)]),(0,s.Lk)("div",iEe,[(0,s.Lk)("div",aEe,[t[110]||(t[110]=(0,s.Lk)("div",{class:"appetite-gradient-bar"},null,-1)),(0,s.Lk)("div",{class:"appetite-marker",style:(0,d.Tr)({left:10*(l.appetiteData.currentLevel||6)+"%"})},null,4)]),t[111]||(t[111]=(0,s.Lk)("div",{class:"appetite-labels"},[(0,s.Lk)("span",{class:"label-left"},"Risk Averse"),(0,s.Lk)("span",{class:"label-center"},"Balanced"),(0,s.Lk)("span",{class:"label-right"},"Risk Seeking")],-1))])],512),[[a.aG,n.isVisible("risk-appetite")]])])])}var oEe={name:"RiskKPI",data(){return{selectedCategory:"risk-profile",kpiCategories:{"risk-profile":["active-risks","high-criticality","identification-rate","rate-recurrence","improvement-initiatives","assessment-review","register-update","approval-rate-cycle"],"risk-exposure":["risk-exposure","risk-severity","risk-impact","exposure-score","tolerance-thresholds","risk-appetite","risk-resilience","risk-reduction-trend"],"risk-mitigation":["avg-remediation","mitigation-completion","avg-remediation","avg-response","cost-mitigation","recurrence-probability","due-mitigation"]},kpiData:{},activeRisksData:{current:0,months:[],trendData:[],percentageChange:0},exposureData:{current:0,months:[],trendData:[],percentageChange:0},reductionData:{startCount:0,newCount:0,mitigatedCount:0,endCount:0,reductionPercentage:0},criticalityData:{count:0,highCount:0,criticalCount:0,percentage:0,months:[],trendData:[]},mitigationData:{avgDays:0,slaDays:0,trendData:[],months:[]},remediationData:{current:0,slaThreshold:30,trendData:[],months:[],percentageChange:0},recurrenceData:{recurrenceRate:0,oneTimeRate:0,percentageChange:0,trendData:[],months:[],breakdown:null},responseData:{current:0,target:4,sla:8,percentageChange:0,trendData:[],months:[],delayedResponses:0},mitigationCostData:{totalCost:0,avgCost:0,highestCost:0,highestCategory:"",percentageChange:0,monthlyData:[]},identificationData:{current:0,dailyAverage:0,percentageChange:0,trendData:[],months:[],minValue:0,maxValue:0},dueMitigationData:{overduePercentage:0,completedPercentage:0,pendingPercentage:0,overdueCount:0,totalCount:0,percentageChange:0},classificationData:{accuracy:0,percentageChange:0,categoryAccuracy:null,timeSeriesData:[]},initiativeData:{completionPercentage:0,totalCount:0,completedCount:0,pendingCount:0,categoryBreakdown:null},impactData:{overallScore:0,impactDistribution:null,topRisks:null},severityData:{severityDistribution:null,severityPercentages:null,averageSeverity:0,trendData:[],topSevereRisks:[]},defaultTopRisks:[{id:1,title:"Service Outage",operational_impact:8.5,financial_impact:9.2,category:"Operational"},{id:2,title:"Data Breach",operational_impact:7.2,financial_impact:9.5,category:"Security"},{id:3,title:"Compliance Violation",operational_impact:6.8,financial_impact:8.1,category:"Compliance"},{id:4,title:"Supply Chain Disruption",operational_impact:9.1,financial_impact:7.4,category:"Operational"},{id:5,title:"Market Volatility",operational_impact:5.6,financial_impact:8.7,category:"Financial"}],exposureScoreData:{overallScore:0,riskPoints:[],categoryDistribution:{}},resilienceData:{avgDowntime:0,avgRecovery:0,categoryData:[],trendData:[],months:[]},defaultResilienceData:[{category:"Infrastructure",downtime:6,recovery:8},{category:"Application",downtime:3,recovery:5},{category:"Network",downtime:5,recovery:7},{category:"Security",downtime:7,recovery:9}],assessmentData:{avgReviewFrequency:0,categoryFrequencies:{},mostReviewed:[],overdueReviews:[],months:[],monthlyReviews:[],overdueCount:0,totalRisks:0},consensusData:{consensusPercentage:0,totalAssessments:0,consensusCount:0,noConsensusCount:0,categoryConsensus:{},lowConsensusRisks:[],months:[],monthlyConsensus:[]},registerUpdateData:{avgUpdateFrequency:0,months:[],monthlyUpdates:[],stagnantRisks:[],categoryFrequencies:{},dailyUpdates:[],stagnantCount:0},recurrenceProbabilityData:{averageProbability:0,probabilityRanges:[],highRecurrenceRisks:[],trendData:[],months:[],percentageChange:0,totalRisks:0},defaultProbabilityRanges:[{range:"0-20%",count:20,label:"Very Low",percentage:20},{range:"21-40%",count:30,label:"Low",percentage:30},{range:"41-60%",count:25,label:"Medium",percentage:25},{range:"61-80%",count:15,label:"High",percentage:15},{range:"81-100%",count:10,label:"Very High",percentage:10}],toleranceData:{overallStatus:"",toleranceThresholds:{},alerts:[],historicalData:{},months:[]},defaultToleranceThresholds:{Security:{max_exposure:80,current_exposure:75,unit:"score",percentage:93.8,status:"Warning"},Compliance:{max_exposure:75,current_exposure:62,unit:"score",percentage:82.7,status:"Normal"},Operational:{max_exposure:70,current_exposure:75,unit:"score",percentage:107.1,status:"Exceeded"}},appetiteData:{currentLevel:6,description:"",historicalLevels:[],dates:[],lastUpdated:"",approvedBy:"",levelDescriptions:{}},identificationPeriod:"30days",dueMitigationPeriod:"30days",mitigationCostPeriod:"30days",severityDistribution:{Low:0,Medium:0,High:0,Critical:0},severityPercentages:{Low:0,Medium:0,High:0,Critical:0},averageSeverity:0,trendData:[],topSevereRisks:[],mostSevereRisk:"Loading...",approvalRateData:{approvalRate:0,avgReviewerCount:0,avgCycleDays:0,totalRisks:0,approvedRisks:0,pendingRisks:0,months:[],monthlyApprovalRates:[],monthlyCycleDays:[],pendingApprovalRisks:[]},identificationRate:null,identificationChange:null,avgDailyRisks:null,identificationTrend:null,identificationMonths:null}},mounted(){this.fetchKpiData(),this.fetchActiveRisksTrend(),this.fetchExposureTrend(),this.fetchReductionTrend(),this.fetchCriticalityData(),this.fetchMitigationData(),this.fetchRemediationData(),this.fetchRecurrenceData(),this.fetchResponseData(),this.fetchIdentificationData(),this.fetchDueMitigationData(),this.fetchClassificationData(),this.fetchInitiativeData(),this.fetchImpactData(),this.fetchSeverityData(),this.fetchExposureScoreData(),this.fetchResilienceData(),this.fetchAssessmentFrequencyData(),this.fetchAssessmentConsensusData(),this.fetchRegisterUpdateFrequency(),this.fetchRecurrenceProbability(),this.fetchToleranceThresholds(),this.fetchRiskAppetite(),this.fetchRiskSeverity(),this.fetchIdentificationRate()},methods:{async fetchKpiData(){try{const e=await fetch("/api/risk/kpi-data/");e.ok?this.kpiData=await e.json():(console.error("Failed to fetch KPI data"),this.setFallbackData())}catch(e){if(console.error("Error fetching KPI data:",e),Tr.wr.handleApiError(e))return;this.setFallbackData()}},async fetchActiveRisksTrend(){try{console.log("Fetching active risks data from backend...");const e=await fetch("http://localhost:8000/api/risk/active-risks-kpi/");if(console.log("Response status:",e.status),e.ok){const t=await e.json();console.log("Active risks data received:",t),this.activeRisksData=t,this.kpiData={...this.kpiData,activeRisks:t.current},console.log("Updated KPI data with active risks:",this.kpiData.activeRisks)}else console.error("Failed to fetch active risks trend:",e.status,e.statusText),this.setFallbackActiveRisksTrend()}catch(e){if(console.error("Error fetching active risks trend:",e),Tr.wr.handleApiError(e))return;this.setFallbackActiveRisksTrend()}},async fetchExposureTrend(){try{console.log("Fetching risk exposure data from backend...");const e=await fetch("http://localhost:8000/api/risk/exposure-trend/");if(console.log("Exposure trend response status:",e.status),e.ok){const t=await e.json();console.log("Risk exposure data received:",t),this.exposureData=t,this.kpiData={...this.kpiData,riskExposure:t.current},console.log("Updated KPI data with risk exposure:",this.kpiData.riskExposure)}else console.error("Failed to fetch exposure trend:",e.status,e.statusText),this.setFallbackExposureTrend()}catch(e){if(console.error("Error fetching exposure trend:",e),Tr.wr.handleApiError(e))return;this.setFallbackExposureTrend()}},async fetchReductionTrend(){try{console.log("Fetching risk reduction trend data from backend...");const e=await fetch("http://localhost:8000/api/risk/reduction-trend/");if(console.log("Risk reduction trend response status:",e.status),e.ok){const t=await e.json();console.log("Risk reduction trend data received:",t),this.reductionData=t,console.log("Updated reduction trend data with startCount:",t.startCount,"newCount:",t.newCount,"mitigatedCount:",t.mitigatedCount,"endCount:",t.endCount,"reductionPercentage:",t.reductionPercentage)}else console.error("Failed to fetch reduction trend:",e.status,e.statusText),this.setFallbackReductionTrend()}catch(e){if(console.error("Error fetching reduction trend:",e),Tr.wr.handleApiError(e))return;this.setFallbackReductionTrend()}},async fetchCriticalityData(){try{console.log("Fetching high criticality risks data from backend...");const e=await fetch("http://localhost:8000/api/risk/high-criticality/");if(console.log("High criticality risks response status:",e.status),e.ok){const t=await e.json();console.log("High criticality risks data received:",t),this.criticalityData=t,this.kpiData={...this.kpiData,highCriticalityRisks:t.count,highCount:t.highCount,criticalCount:t.criticalCount},console.log("Updated KPI data with high criticality risks:",this.kpiData.highCriticalityRisks)}else console.error("Failed to fetch criticality data:",e.status,e.statusText),this.setFallbackCriticalityData()}catch(e){if(console.error("Error fetching criticality data:",e),Tr.wr.handleApiError(e))return;this.setFallbackCriticalityData()}},async fetchMitigationData(){try{console.log("Fetching mitigation completion rate data from backend...");const e=await fetch("http://localhost:8000/api/risk/mitigation-completion-rate/");if(console.log("Mitigation completion rate response status:",e.status),e.ok){const t=await e.json();console.log("Mitigation completion rate data received:",t),this.mitigationData={avgDays:t.avgDays,slaDays:t.slaDays,trendData:t.trendData,months:t.months},this.kpiData={...this.kpiData,mitigationCompletionRate:t.completionRate},console.log("Updated KPI data with mitigation completion rate:",this.kpiData.mitigationCompletionRate)}else console.error("Failed to fetch mitigation completion rate data:",e.status,e.statusText),this.setFallbackMitigationData()}catch(e){if(console.error("Error fetching mitigation completion rate data:",e),Tr.wr.handleApiError(e))return;this.setFallbackMitigationData()}},async fetchRemediationData(){try{console.log("Fetching average remediation time data from backend...");const e=await fetch("http://localhost:8000/api/risk/avg-remediation-time/");if(console.log("Remediation time response status:",e.status),e.ok){const t=await e.json();console.log("Average remediation time data received:",t),this.remediationData={current:t.current,slaThreshold:t.slaDays,trendData:t.trendData,months:t.months,percentageChange:t.percentageChange,overdueCount:t.overdueCount,overduePercentage:t.overduePercentage,totalActive:t.totalActive,minValue:t.minValue,maxValue:t.maxValue},this.kpiData={...this.kpiData,avgRemediationTime:t.current},console.log("Updated KPI data with avg remediation time:",this.kpiData.avgRemediationTime)}else console.error("Failed to fetch remediation time data:",e.status,e.statusText),this.setFallbackRemediationData()}catch(e){if(console.error("Error fetching remediation time data:",e),Tr.wr.handleApiError(e))return;this.setFallbackRemediationData()}},async fetchRecurrenceData(){try{console.log("Fetching recurrence rate data from backend...");const e=await fetch("http://localhost:8000/api/risk/recurrence-rate/");if(console.log("Recurrence rate response status:",e.status),e.ok){const t=await e.json();console.log("Recurrence rate data received:",t),this.recurrenceData={recurrenceRate:t.recurrenceRate,oneTimeRate:t.oneTimeRate,percentageChange:t.percentageChange,trendData:t.trendData,months:t.months,breakdown:t.breakdown,totalRisks:t.totalRisks,recurringRisks:t.recurringRisks,oneTimeRisks:t.oneTimeRisks,topRecurringRisks:t.topRecurringRisks},this.kpiData={...this.kpiData,recurrenceRate:t.recurrenceRate},console.log("Updated KPI data with recurrence rate:",this.kpiData.recurrenceRate)}else console.error("Failed to fetch recurrence data:",e.status,e.statusText),this.setFallbackRecurrenceData()}catch(e){if(console.error("Error fetching recurrence data:",e),Tr.wr.handleApiError(e))return;this.setFallbackRecurrenceData()}},async fetchResponseData(){try{console.log("Fetching incident response time data from backend...");const e=await fetch("http://localhost:8000/api/risk/avg-incident-response-time/");if(console.log("Incident response time response status:",e.status),e.ok){const t=await e.json();console.log("Incident response time data received:",t),this.responseData={current:t.current,target:t.target,sla:t.sla,percentageChange:t.percentageChange,trendData:t.trendData,months:t.months,delayedCount:t.delayedCount,delayedPercentage:t.delayedPercentage,totalIncidents:t.totalIncidents},this.kpiData={...this.kpiData,avgResponseTime:t.current},console.log("Updated KPI data with avg response time:",this.kpiData.avgResponseTime)}else console.error("Failed to fetch incident response time data:",e.status,e.statusText),this.setFallbackResponseData()}catch(e){if(console.error("Error fetching incident response time data:",e),Tr.wr.handleApiError(e))return;this.setFallbackResponseData()}},async fetchMitigationCostData(){try{console.log("Fetching mitigation cost data...");const e=await fetch(`/api/risk/mitigation-cost/?timeRange=${this.mitigationCostPeriod}`);e.ok?(this.mitigationCostData=await e.json(),console.log("Mitigation cost data received:",this.mitigationCostData)):(console.error("Failed to fetch mitigation cost data:",e.status,e.statusText),this.setFallbackMitigationCostData())}catch(e){if(console.error("Error fetching mitigation cost data:",e),Tr.wr.handleApiError(e))return;this.setFallbackMitigationCostData()}},async fetchIdentificationData(){try{console.log("Fetching risk identification rate data...");const e=await fetch(`/api/risk/identification-rate/?timeRange=${this.identificationPeriod}`);e.ok?(this.identificationData=await e.json(),console.log("Risk identification rate data received:",this.identificationData)):(console.error("Failed to fetch identification rate data:",e.status,e.statusText),this.setFallbackIdentificationData())}catch(e){if(console.error("Error fetching identification rate data:",e),Tr.wr.handleApiError(e))return;this.setFallbackIdentificationData()}},async fetchDueMitigationData(){try{console.log("Fetching due mitigation data...");const e=await fetch(`/api/risk/due-mitigation/?timeRange=${this.dueMitigationPeriod}`);e.ok?(this.dueMitigationData=await e.json(),console.log("Due mitigation data received:",this.dueMitigationData)):(console.error("Failed to fetch due mitigation data:",e.status,e.statusText),this.setFallbackDueMitigationData())}catch(e){if(console.error("Error fetching due mitigation data:",e),Tr.wr.handleApiError(e))return;this.setFallbackDueMitigationData()}},async fetchClassificationData(){try{const e=await fetch("/api/risk/classification-accuracy/");e.ok?this.classificationData=await e.json():(console.error("Failed to fetch classification accuracy data"),this.setFallbackClassificationData())}catch(e){if(console.error("Error fetching classification accuracy data:",e),Tr.wr.handleApiError(e))return;this.setFallbackClassificationData()}},async fetchInitiativeData(){try{console.log("============================================"),console.log("Fetching improvement initiatives data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"";console.log("Base URL for API calls:",e);const t=`${e}/api/risk/improvement-initiatives/`;console.log("Full URL for improvement initiatives API:",t);const i=await fetch(t);if(console.log("Improvement initiatives response status:",i.status),console.log("Improvement initiatives response headers:",i.headers),i.ok){const e=await i.json();console.log("Improvement initiatives data received:",e),console.log("Received completionPercentage:",e.completionPercentage),console.log("Received completedCount:",e.completedCount),console.log("Received totalCount:",e.totalCount),this.initiativeData=e,console.log("Component state after assignment:",this.initiativeData),console.log("============================================")}else console.error("Failed to fetch initiative data:",i.status,i.statusText),this.setFallbackInitiativeData()}catch(e){if(console.error("Error fetching initiative data:",e),Tr.wr.handleApiError(e))return;this.setFallbackInitiativeData()}},async fetchImpactData(){try{console.log("============================================"),console.log("Fetching risk impact data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"";console.log("Base URL for API calls:",e);const t=`${e}/api/risk/impact/`;console.log("Full URL for risk impact API:",t);const i=await fetch(t);if(console.log("Risk impact response status:",i.status),console.log("Risk impact response headers:",i.headers),i.ok){const e=await i.json();console.log("Risk impact data received:",e),console.log("Received overallScore:",e.overallScore),console.log("Received top risks:",e.topRisks?.length||0),console.log("Received total risks:",e.total_risks),this.impactData=e,console.log("Component state after assignment:",this.impactData),console.log("============================================")}else console.error("Failed to fetch impact data:",i.status,i.statusText),this.setFallbackImpactData()}catch(e){if(console.error("Error fetching impact data:",e),Tr.wr.handleApiError(e))return;this.setFallbackImpactData()}},async fetchSeverityData(){try{const e=await fetch("/api/risk/severity/");e.ok?this.severityData=await e.json():(console.error("Failed to fetch severity data"),this.setFallbackSeverityData())}catch(e){if(console.error("Error fetching severity data:",e),Tr.wr.handleApiError(e))return;this.setFallbackSeverityData()}},async fetchExposureScoreData(){try{const e=await fetch("http://localhost:8000/api/risk/exposure-score/");e.ok?this.exposureScoreData=await e.json():(console.error("Failed to fetch exposure score data"),this.setFallbackExposureScoreData())}catch(e){if(console.error("Error fetching exposure score data:",e),Tr.wr.handleApiError(e))return;this.setFallbackExposureScoreData()}},async fetchResilienceData(){try{console.log("Fetching risk resilience data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await fetch(`${e}/api/risk/resilience/`);if(console.log("Risk resilience response status:",t.status),t.ok){const e=await t.json();console.log("Risk resilience data received:",e),this.resilienceData=e,console.log("Resilience data in component:",this.resilienceData)}else console.error("Failed to fetch resilience data:",t.status,t.statusText),this.setFallbackResilienceData()}catch(e){if(console.error("Error fetching resilience data:",e),Tr.wr.handleApiError(e))return;this.setFallbackResilienceData()}},async fetchAssessmentFrequencyData(){try{const e=await fetch("/api/risk/assessment-frequency/");e.ok?this.assessmentData=await e.json():(console.error("Failed to fetch assessment frequency data"),this.setFallbackAssessmentData())}catch(e){if(console.error("Error fetching assessment frequency data:",e),Tr.wr.handleApiError(e))return;this.setFallbackAssessmentData()}},async fetchAssessmentConsensusData(){try{const e=await fetch("/api/risk/assessment-consensus/");e.ok?this.consensusData=await e.json():(console.error("Failed to fetch assessment consensus data"),this.setFallbackConsensusData())}catch(e){if(console.error("Error fetching assessment consensus data:",e),Tr.wr.handleApiError(e))return;this.setFallbackConsensusData()}await this.fetchApprovalRateData()},async fetchApprovalRateData(){try{console.log("Fetching risk approval rate and cycle data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await fetch(`${e}/api/risk/approval-rate-cycle/`);if(console.log("Approval rate cycle response status:",t.status),t.ok){const e=await t.json();console.log("Risk approval rate and cycle data received:",e),this.approvalRateData=e}else console.error("Failed to fetch approval rate data"),this.setFallbackApprovalRateData()}catch(e){if(console.error("Error fetching approval rate data:",e),Tr.wr.handleApiError(e))return;this.setFallbackApprovalRateData()}},setFallbackApprovalRateData(){this.approvalRateData={approvalRate:81,avgReviewCycles:3.2,maxReviewCycles:4}},async fetchRegisterUpdateFrequency(){try{console.log("Fetching risk register update frequency data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await fetch(`${e}/api/risk/register-update-frequency/`);if(console.log("Register update frequency response status:",t.status),t.ok){const e=await t.json();console.log("Risk register update frequency data received:",e),this.registerUpdateData=e}else console.error("Failed to fetch register update frequency data"),this.setFallbackRegisterUpdateData()}catch(e){if(console.error("Error fetching register update frequency data:",e),Tr.wr.handleApiError(e))return;this.setFallbackRegisterUpdateData()}},async fetchRecurrenceProbability(){try{console.log("Fetching risk recurrence probability data from backend...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await fetch(`${e}/api/risk/recurrence-probability/`);if(console.log("Risk recurrence probability response status:",t.status),t.ok){const e=await t.json();console.log("Risk recurrence probability data received:",e),console.log("Received averageProbability:",e.averageProbability),console.log("Received percentageChange:",e.percentageChange),console.log("Received probabilityRanges:",e.probabilityRanges),console.log("Received highRecurrenceRisks:",e.highRecurrenceRisks),this.recurrenceProbabilityData=e,console.log("Component state after assignment:",this.recurrenceProbabilityData)}else console.error("Failed to fetch recurrence probability data"),this.setFallbackRecurrenceProbabilityData()}catch(e){console.error("Error fetching recurrence probability data:",e),this.setFallbackRecurrenceProbabilityData()}},async fetchToleranceThresholds(){try{console.log("Fetching risk tolerance thresholds data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await fetch(`${e}/api/risk/tolerance-thresholds/`);if(console.log("Risk tolerance thresholds API response status:",t.status),t.ok){const e=await t.json();console.log("Risk tolerance thresholds data received:",e),this.toleranceData=e}else console.error("Failed to fetch tolerance thresholds data:",t.status,t.statusText),this.setFallbackToleranceData()}catch(e){console.error("Error fetching tolerance thresholds data:",e),this.setFallbackToleranceData()}},async fetchRiskAppetite(){try{console.log("Fetching risk appetite data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await fetch(`${e}/api/risk/appetite/`);if(console.log("Risk appetite API response status:",t.status),t.ok){const e=await t.json();console.log("Risk appetite data received:",e),this.appetiteData=e}else console.error("Failed to fetch risk appetite data:",t.status,t.statusText),this.setFallbackAppetiteData()}catch(e){console.error("Error fetching risk appetite data:",e),this.setFallbackAppetiteData()}},async fetchRiskSeverity(){try{console.log("Fetching risk severity data...");const e="localhost"===window.location.hostname?"http://localhost:8000":"",t=await He.A.get(`${e}/api/risk/severity/`);if(console.log("Risk severity API response:",t),200===t.status&&t.data)if(console.log("Risk severity data received:",t.data),this.severityDistribution=t.data.severityDistribution||{Low:20,Medium:40,High:25,Critical:15},this.severityPercentages=t.data.severityPercentages||{Low:20,Medium:40,High:25,Critical:15},this.averageSeverity=t.data.averageSeverity||6.8,this.trendData=t.data.trendData||[],this.topSevereRisks=t.data.topSevereRisks||[],this.topSevereRisks&&this.topSevereRisks.length>0){const e=this.topSevereRisks[0];this.mostSevereRisk=`${e.title} (${e.severity})`}else this.mostSevereRisk="No data";else console.error("Invalid response from risk severity API"),this.setFallbackSeverityData()}catch(e){console.error("Error fetching risk severity data:",e),this.setFallbackSeverityData()}},setFallbackData(){this.kpiData={activeRisks:48,riskExposure:872,riskRecurrence:6.5,mitigationCompletionRate:76,avgRemediationTime:35,recurrenceRate:6.5,avgResponseTime:6,mitigationCost:184,identificationRate:88,dueMitigation:22,classificationAccuracy:88,exposureScore:75,resilienceHours:5,months:["J","F","M","A","M","J"],riskReductionTrend:{start:45,new:15,end:35}}},setFallbackActiveRisksTrend(){const e=[41,45,43,48,45,48];this.activeRisksData={current:48,months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:e,percentageChange:4.3,minValue:Math.min(...e),maxValue:Math.max(...e),range:Math.max(...e)-Math.min(...e)}},setFallbackExposureTrend(){const e=[820,845,860,880,865,872];this.exposureData={current:872,months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:e,percentageChange:.8,minValue:Math.min(...e),maxValue:Math.max(...e),range:Math.max(...e)-Math.min(...e)}},setFallbackReductionTrend(){this.reductionData={startCount:45,newCount:15,mitigatedCount:25,endCount:35,reductionPercentage:25}},setFallbackCriticalityData(){this.criticalityData={count:6,highCount:4,criticalCount:2,percentage:8.5,months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:[5,4,6,7,5,6]},this.kpiData={...this.kpiData,highCriticalityRisks:this.criticalityData.count}},setFallbackMitigationData(){this.mitigationData={avgDays:14,slaDays:21,trendData:[18,16,14,15,13,14],months:["Jan","Feb","Mar","Apr","May","Jun"]},this.kpiData={...this.kpiData,mitigationCompletionRate:76}},setFallbackRemediationData(){const e=[38,36,35,37,34,35];this.remediationData={current:35,slaThreshold:30,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],percentageChange:2.5,overdueCount:12,overduePercentage:15,totalActive:80,minValue:Math.min(...e),maxValue:Math.max(...e)}},setFallbackRecurrenceData(){const e=[5.8,6.2,6.7,6.3,6.8,6.5];this.recurrenceData={recurrenceRate:6.5,oneTimeRate:93.5,totalRisks:200,recurringRisks:13,oneTimeRisks:187,percentageChange:-.3,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],breakdown:{Security:8.4,Compliance:5.2,Operational:7.3,Financial:4.8},topRecurringRisks:[{id:1,title:"System Outage",category:"Operational",count:4,owner:"IT Department"},{id:2,title:"Data Quality Issues",category:"Technology",count:3,owner:"Data Team"},{id:3,title:"Vendor Delivery Delays",category:"Supply Chain",count:3,owner:"Procurement"},{id:4,title:"Staff Turnover",category:"HR",count:2,owner:"HR Department"},{id:5,title:"Security Breach",category:"Security",count:2,owner:"Security Team"}]}},setFallbackResponseData(){const e=[7.2,6.8,6.5,6.3,6.1,6];this.responseData={current:6,target:4,sla:8,percentageChange:-1.6,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],delayedCount:8,delayedPercentage:12.5,totalIncidents:64,minValue:Math.min(...e),maxValue:Math.max(...e)},this.kpiData={...this.kpiData,avgResponseTime:6}},setFallbackMitigationCostData(){this.mitigationCostData={totalCost:184,avgCost:31,highestCost:42,highestCategory:"Security",percentageChange:5.7,monthlyData:[{month:"Jan",cost:35},{month:"Feb",cost:28},{month:"Mar",cost:42},{month:"Apr",cost:31},{month:"May",cost:25},{month:"Jun",cost:23}]}},setFallbackIdentificationData(){const e=[75,82,88,92,85,88];this.identificationData={current:88,dailyAverage:4.2,percentageChange:3.5,trendData:e,months:["Jan","Feb","Mar","Apr","May","Jun"],minValue:Math.min(...e),maxValue:Math.max(...e)}},setFallbackDueMitigationData(){this.dueMitigationData={overduePercentage:22,completedPercentage:50,pendingPercentage:28,overdueCount:8,totalCount:36,percentageChange:2.8}},setFallbackClassificationData(){this.classificationData={accuracy:88,percentageChange:2.3,categoryAccuracy:{Compliance:92,Operational:87,Security:85,Financial:90},timeSeriesData:[{month:"Jan",value:84},{month:"Feb",value:85},{month:"Mar",value:86},{month:"Apr",value:87},{month:"May",value:86},{month:"Jun",value:88}]}},setFallbackInitiativeData(){this.initiativeData={completionPercentage:76,totalCount:25,completedCount:19,pendingCount:6,categoryBreakdown:{Security:{total:10,completed:8},Compliance:{total:8,completed:6},Process:{total:7,completed:5}}}},setFallbackImpactData(){this.impactData={overallScore:5.7,impactDistribution:{operational:{low:15,medium:30,high:20,critical:10},financial:{low:20,medium:25,high:20,critical:10}},topRisks:[{id:1,title:"Service Outage",operational_impact:8.5,financial_impact:9.2,category:"Operational"},{id:2,title:"Data Breach",operational_impact:7.2,financial_impact:9.5,category:"Security"},{id:3,title:"Compliance Violation",operational_impact:6.8,financial_impact:8.1,category:"Compliance"},{id:4,title:"Supply Chain Disruption",operational_impact:9.1,financial_impact:7.4,category:"Operational"},{id:5,title:"Market Volatility",operational_impact:5.6,financial_impact:8.7,category:"Financial"}],total_risks:25}},setFallbackSeverityData(){this.severityDistribution={Low:20,Medium:40,High:25,Critical:15},this.severityPercentages={Low:20,Medium:40,High:25,Critical:15},this.averageSeverity=6.8,this.topSevereRisks=[{id:1,title:"Data Center Failure",severity:9.5,category:"Infrastructure"},{id:2,title:"Critical Data Breach",severity:9.2,category:"Security"},{id:3,title:"Regulatory Non-Compliance",severity:8.7,category:"Compliance"},{id:4,title:"Key Supplier Failure",severity:8.4,category:"Supply Chain"},{id:5,title:"Critical System Outage",severity:8.1,category:"Technology"}],this.mostSevereRisk="Data Center Failure (9.5)"},setFallbackExposureScoreData(){this.exposureScoreData={overallScore:75,riskPoints:[{id:1,title:"Data Center Outage",impact:8.7,likelihood:7.2,category:"Infrastructure",exposure:6.3},{id:2,title:"Sensitive Data Breach",impact:9.1,likelihood:6.5,category:"Security",exposure:5.9},{id:3,title:"Regulatory Non-Compliance",impact:8.4,likelihood:5.8,category:"Compliance",exposure:4.9},{id:4,title:"Critical System Failure",impact:8.2,likelihood:5.5,category:"Technology",exposure:4.5},{id:5,title:"Supply Chain Disruption",impact:7.9,likelihood:6.8,category:"Operational",exposure:5.4},{id:6,title:"Financial Fraud",impact:7.6,likelihood:4.2,category:"Financial",exposure:3.2}],categoryDistribution:{Infrastructure:1,Security:1,Compliance:1,Technology:1,Operational:1,Financial:1}}},setFallbackResilienceData(){this.resilienceData={avgDowntime:4.6,avgRecovery:3.9,categoryData:[{category:"Security",downtime:4.8,recovery:5},{category:"Operational",downtime:4,recovery:3.5},{category:"Financial",downtime:5,recovery:4.1},{category:"Compliance",downtime:5.3,recovery:2.8}],months:["Jan","Feb","Mar","Apr","May","Jun"],trendData:[]}},setFallbackAssessmentData(){this.assessmentData={avgReviewFrequency:60,categoryFrequencies:{Security:45,Operational:55,Compliance:35,Financial:65,Strategic:75},mostReviewed:[{id:1,title:"Data Breach",reviews:7,last_review:"2023-06-10",category:"Security"},{id:2,title:"Regulatory Non-Compliance",reviews:6,last_review:"2023-06-05",category:"Compliance"},{id:3,title:"System Outage",reviews:5,last_review:"2023-05-28",category:"Operational"}],overdueReviews:[{id:6,title:"Market Volatility",last_review:"2023-03-10",days_overdue:45,category:"Financial"},{id:7,title:"Talent Shortage",last_review:"2023-02-15",days_overdue:60,category:"Strategic"},{id:8,title:"Legacy System Failure",last_review:"2023-04-05",days_overdue:30,category:"Technology"}],months:["Jan","Feb","Mar","Apr","May","Jun"],monthlyReviews:[15,18,22,17,20,23],overdueCount:3,totalRisks:65}},setFallbackConsensusData(){this.consensusData={consensusPercentage:75,totalAssessments:120,consensusCount:90,noConsensusCount:30,categoryConsensus:{Security:80,Operational:70,Compliance:85,Financial:75,Strategic:65},lowConsensusRisks:[{id:1,title:"Cloud Migration Security",category:"Security",reviewers:4,agreement:"2/4"},{id:2,title:"Third-party Vendor Assessment",category:"Operational",reviewers:3,agreement:"1/3"},{id:3,title:"New Regulatory Requirements",category:"Compliance",reviewers:5,agreement:"3/5"}],months:["Jan","Feb","Mar","Apr","May","Jun"],monthlyConsensus:[70,72,68,75,78,75]}},setFallbackRegisterUpdateData(){this.registerUpdateData={avgUpdateFrequency:10,months:["Jan","Feb","Mar","Apr","May","Jun"],monthlyUpdates:[28,32,38,35,42,40],categoryFrequencies:{Security:7,Compliance:12,Operational:10,Financial:18,Technology:9},dailyUpdates:[2,1,3,0,2,4,1,3,2,1,0,2,3,5,2,1,3,4,2,1,0,2,3,1,2,3,1,4,2,3]}},setFallbackRecurrenceProbabilityData(){this.recurrenceProbabilityData={averageProbability:38,probabilityRanges:this.defaultProbabilityRanges,highRecurrenceRisks:[{id:1,title:"Service Outage",probability:85,category:"Operational"},{id:2,title:"Data Quality Issues",probability:78,category:"Technology"},{id:3,title:"Staff Turnover",probability:72,category:"HR"},{id:4,title:"Minor Security Breaches",probability:68,category:"Security"},{id:5,title:"Vendor Delivery Delays",probability:65,category:"Supply Chain"}],trendData:[{month:"Jan",probability:52},{month:"Feb",probability:49.5},{month:"Mar",probability:46.2},{month:"Apr",probability:43.8},{month:"May",probability:40.5},{month:"Jun",probability:38}],months:["Jan","Feb","Mar","Apr","May","Jun"],percentageChange:-6.2,totalRisks:100}},setFallbackToleranceData(){this.toleranceData={overallStatus:"Near Limits",toleranceThresholds:this.defaultToleranceThresholds,alerts:[{category:"Operational",message:"Operational risks exceeding defined tolerance threshold by 7.1%",date:"2023-06-12"}],historicalData:{Security:[{month:"Jan",percentage:85},{month:"Feb",percentage:88},{month:"Mar",percentage:90},{month:"Apr",percentage:92},{month:"May",percentage:95},{month:"Jun",percentage:94}],Compliance:[{month:"Jan",percentage:70},{month:"Feb",percentage:75},{month:"Mar",percentage:78},{month:"Apr",percentage:85},{month:"May",percentage:80},{month:"Jun",percentage:83}],Operational:[{month:"Jan",percentage:90},{month:"Feb",percentage:95},{month:"Mar",percentage:100},{month:"Apr",percentage:105},{month:"May",percentage:110},{month:"Jun",percentage:107}]},months:["Jan","Feb","Mar","Apr","May","Jun"]}},setFallbackAppetiteData(){this.appetiteData={currentLevel:6,description:"Balanced risk approach",historicalLevels:[4,5,5,6,6,6],dates:["Jan","Feb","Mar","Apr","May","Jun"],levelDescriptions:{low:"Risk Averse (1-3)",medium:"Balanced (4-7)",high:"Risk Seeking (8-10)"}}},getToleranceStatusClass(e){return e?"Within Limits"===e?"status-normal":"Near Limits"===e?"status-warning":"Exceeding Limits"===e?"status-exceeded":"status-warning":"status-warning"},getCategoryStatusClass(e){return e?"Normal"===e?"status-normal":"Warning"===e?"status-warning":"Exceeded"===e?"status-exceeded":"status-normal":"status-normal"},calculateBarHeight(e,t){if(!t||0===t.length)return 0;const i=Math.min(...t),a=Math.max(...t);return i===a?50:20+(e-i)/(a-i)*80},calculatePointPosition(e,t,i){if(void 0===t||void 0===i){const e=this.activeRisksData.trendData||[];t=Math.min(...e),i=Math.max(...e)}const a=i-t||1;return 100*(1-((e-t)/a*.7+.15))},generateSmoothCurvePath(e,t,i){if(!e||e.length<2)return"";void 0!==t&&void 0!==i||(t=Math.min(...e),i=Math.max(...e));const a=100,s=30,o=i-t||1,l=e.map((i,l)=>{const n=l/(e.length-1)*a,r=s-((i-t)/o*21+4.5);return{x:n,y:r}});let n=`M ${l[0].x},${l[0].y}`;for(let r=0;r<l.length-1;r++){const e=l[r].x+(l[r+1].x-l[r].x)/3,t=l[r].y,i=l[r].x+2*(l[r+1].x-l[r].x)/3,a=l[r+1].y;n+=` C ${e},${t} ${i},${a} ${l[r+1].x},${l[r+1].y}`}return n},generateSmoothAreaPath(e,t,i){if(!e||e.length<2)return"";void 0!==t&&void 0!==i||(t=Math.min(...e),i=Math.max(...e));const a=100,s=30,o=i-t||1,l=e.map((i,l)=>{const n=l/(e.length-1)*a,r=s-((i-t)/o*21+4.5);return{x:n,y:r}});let n=`M ${l[0].x},${l[0].y}`;for(let r=0;r<l.length-1;r++){const e=l[r].x+(l[r+1].x-l[r].x)/3,t=l[r].y,i=l[r].x+2*(l[r+1].x-l[r].x)/3,a=l[r+1].y;n+=` C ${e},${t} ${i},${a} ${l[r+1].x},${l[r+1].y}`}return n+=` L ${a},${s} L 0,${s} Z`,n},calculateWaterfallBarHeight(e){const t=Math.max(this.reductionData.startCount,this.reductionData.newCount,this.reductionData.mitigatedCount,this.reductionData.endCount,60),i=25+e/t*75;return`${i}%`},generateCriticalityPath(e){if(!e||e.length<2)return"";const t=100,i=15,a=Math.min(...e),s=Math.max(...e),o=s-a||1,l=e.map((s,l)=>{const n=l/(e.length-1)*t,r=i-((s-a)/o*10+2.5);return{x:n,y:r}});let n=`M ${l[0].x},${l[0].y}`;for(let r=1;r<l.length;r++)n+=` L ${l[r].x},${l[r].y}`;return n},calculateRemediationY(e){const t=this.remediationData.trendData||[30,35,32,38,33,35],i=this.remediationData.slaThreshold||30,a=Math.max(...t,i+10),s=Math.min(...t,i-5),o=a-s||1;return 35-(e-s)/o*25+5},generateRemediationPath(e){if(!e||e.length<2)return"";const t=100,i=e.map((i,a)=>{const s=a/(e.length-1)*t,o=this.calculateRemediationY(i);return{x:s,y:o}});let a=`M ${i[0].x},${i[0].y}`;for(let s=1;s<i.length;s++){const e=i[s-1].x+(i[s].x-i[s-1].x)/3,t=i[s-1].y,o=i[s].x-(i[s].x-i[s-1].x)/3,l=i[s].y;a+=` C ${e},${t} ${o},${l} ${i[s].x},${i[s].y}`}return a},calculateRecurrenceY(e){if(!this.recurrenceData.trendData||0===this.recurrenceData.trendData.length)return 25;const t=1.1*Math.max(...this.recurrenceData.trendData),i=.9*Math.min(...this.recurrenceData.trendData);return 40-(e-i)/(t-i||1)*30+10},generateRecurrencePath(e){if(!e||e.length<2)return"";const t=100,i=e.map((i,a)=>{const s=a/(e.length-1)*t,o=this.calculateRecurrenceY(i);return{x:s,y:o}});let a=`M ${i[0].x},${i[0].y}`;for(let s=1;s<i.length;s++){const e=i[s-1].x+(i[s].x-i[s-1].x)/3,t=i[s-1].y,o=i[s].x-(i[s].x-i[s-1].x)/3,l=i[s].y;a+=` C ${e},${t} ${o},${l} ${i[s].x},${i[s].y}`}return a},calculateNeedleEnd(e){const t=this.responseData.target/2||2,i=1.5*this.responseData.sla||12,a=Math.max(t,Math.min(e,i)),s=(a-t)/(i-t)*180,o=(s-90)*(Math.PI/180),l=30+25*Math.cos(o),n=35+25*Math.sin(o);return{x:l,y:n}},calculateResponseY(e){if(!this.responseData.trendData||0===this.responseData.trendData.length)return 20;const t=Math.min(e,50),i=this.responseData.trendData.map(e=>Math.min(e,50)),a=1.1*Math.max(...i),s=.9*Math.min(...i);return 35-(t-s)/(a-s||1)*30+5},generateResponsePath(e){if(!e||e.length<2)return"";const t=e.map(e=>Math.min(e,50)),i=100,a=t.map((e,a)=>{const s=a/(t.length-1)*i,o=this.calculateResponseY(e);return{x:s,y:o}});let s=`M ${a[0].x},${a[0].y}`;for(let o=1;o<a.length;o++){const e=a[o-1].x+(a[o].x-a[o-1].x)/3,t=a[o-1].y,i=a[o].x-(a[o].x-a[o-1].x)/3,l=a[o].y;s+=` C ${e},${t} ${i},${l} ${a[o].x},${a[o].y}`}return s},getResponseStrokeColor(e){const t=this.responseData.target||4,i=this.responseData.sla||8;return e<=t?"#10b981":e<=i?"#f59e0b":"#ef4444"},getResponsePointColor(e){const t=this.responseData.target||4,i=this.responseData.sla||8;return e<=t?"#10b981":e<=i?"#f59e0b":"#ef4444"},calculateCostBarHeight(e){if(!this.mitigationCostData.monthlyData||0===this.mitigationCostData.monthlyData.length)return 50;const t=this.mitigationCostData.monthlyData.map(e=>e.cost),i=Math.max(...t);return e/i*85},generatePieSegment(e,t,i,a,s,o){const l=s/100*360-90,n=o/100*360-90,r=i,c=i-a,d=e+r*Math.cos(l*Math.PI/180),u=t+r*Math.sin(l*Math.PI/180),p=e+r*Math.cos(n*Math.PI/180),m=t+r*Math.sin(n*Math.PI/180),v=e+c*Math.cos(n*Math.PI/180),k=t+c*Math.sin(n*Math.PI/180),h=e+c*Math.cos(l*Math.PI/180),g=t+c*Math.sin(l*Math.PI/180),y=o-s>50?1:0;return`M ${d} ${u} \n              A ${r} ${r} 0 ${y} 1 ${p} ${m}\n              L ${v} ${k} \n              A ${c} ${c} 0 ${y} 0 ${h} ${g}\n              Z`},generateArcPath(e,t,i,a,s){const o=a/100*Math.PI*2-Math.PI/2,l=s/100*Math.PI*2-Math.PI/2,n=e+i*Math.cos(o),r=t+i*Math.sin(o),c=e+i*Math.cos(l),d=t+i*Math.sin(l),u=s-a>50?1:0;return`M ${e} ${t} L ${n} ${r} A ${i} ${i} 0 ${u} 1 ${c} ${d} Z`},getCategoryClass(e){return e?e.toLowerCase():""},getTopRisks(e){return e&&0!==e.length?e.slice(0,4):[]},calculateAssessmentBarHeight(e){const t=Math.max(...this.assessmentData.monthlyReviews||[25]);return e/t*85},calculateCategoryBarWidth(e){const t=Object.values(this.assessmentData.categoryFrequencies||{}),i=Math.max(...t,90);return e/i*100},calculateUpdateY(e){if(!this.registerUpdateData.monthlyUpdates||0===this.registerUpdateData.monthlyUpdates.length)return 25;const t=1.1*Math.max(...this.registerUpdateData.monthlyUpdates),i=.9*Math.min(...this.registerUpdateData.monthlyUpdates);return 45-(e-i)/(t-i)*40},generateRegisterUpdatePath(e){if(!e||e.length<2)return"";const t=100,i=e.map((i,a)=>{const s=a/(e.length-1)*t,o=this.calculateUpdateY(i);return{x:s,y:o}});let a=`M ${i[0].x},${i[0].y}`;for(let s=1;s<i.length;s++){const e=i[s-1].x+(i[s].x-i[s-1].x)/3,t=i[s-1].y,o=i[s].x-(i[s].x-i[s-1].x)/3,l=i[s].y;a+=` C ${e},${t} ${o},${l} ${i[s].x},${i[s].y}`}return a},calculateHistogramBarHeight(e){const t=this.recurrenceProbabilityData.probabilityRanges?.map(e=>e.count)||this.defaultProbabilityRanges.map(e=>e.count),i=Math.max(...t);return 10+e/i*80},getBarClass(e){return"0-20%"===e?"very-low-prob":"21-40%"===e?"low-prob":"41-60%"===e?"med-prob":"61-80%"===e?"high-prob":"81-100%"===e?"very-high-prob":""},calculateAppetitePosition(e){return e?(e-1)/9*100:60},calculateAppetiteY(e){return this.appetiteData.historicalLevels&&0!==this.appetiteData.historicalLevels.length?30-3*e:15},getAppetiteDescription(e){return e?e<=3?"Risk Averse":e<=7?"Balanced":"Risk Seeking":"Balanced"},generateAppetitePath(e){if(!e||e.length<2)return"";const t=100,i=e.map((i,a)=>{const s=a/(e.length-1)*t,o=this.calculateAppetiteY(i);return{x:s,y:o}});let a=`M ${i[0].x},${i[0].y}`;for(let s=1;s<i.length;s++){const e=i[s-1].x+(i[s].x-i[s-1].x)/3,t=i[s-1].y,o=i[s].x-(i[s].x-i[s-1].x)/3,l=i[s].y;a+=` C ${e},${t} ${o},${l} ${i[s].x},${i[s].y}`}return a},calculateGaugeNeedleX(e){const t=12,i=Math.min(e,t),a=Math.PI*(i/t-.5),s=70,o=.8*s;return 100+Math.cos(a)*o},calculateGaugeNeedleY(e){const t=12,i=Math.min(e,t),a=Math.PI*(i/t-.5),s=70,o=.8*s;return 70-Math.sin(a)*o},formatResponseTime(e){if(!e)return"0";if(e>=72){const t=Math.floor(e/24),i=Math.floor(e%24);return`${t}d ${i}h`}return e},filterKpiCards(){console.log("Filtering KPIs by category:",this.selectedCategory)},isVisible(e){return"all"===this.selectedCategory||this.kpiCategories[this.selectedCategory].includes(e)},calculateCycleTimeY(e){const t=this.approvalRateData.monthlyCycleDays||[10,12,14,16,18,20],i=Math.max(...t,30),a=Math.min(...t,0),s=i-a||1;return 100-(e-a)/s*80},generateCycleTimePath(e){if(!e||e.length<2)return"";const t=100,i=e.map((i,a)=>{const s=a/(e.length-1)*t,o=this.calculateCycleTimeY(i);return{x:s,y:o}});let a=`M ${i[0].x},${i[0].y}`;for(let s=1;s<i.length;s++){const e=i[s-1].x+(i[s].x-i[s-1].x)/3,t=i[s-1].y,o=i[s].x-(i[s].x-i[s-1].x)/3,l=i[s].y;a+=` C ${e},${t} ${o},${l} ${i[s].x},${i[s].y}`}return a},calculateCycleBarHeight(e){const t=Math.max(...this.approvalRateData.monthlyCycleDays||[20]);return e/t*80},calculateDistributionHeight(e){const t=Object.values(this.approvalRateData.reviewCyclesDistribution||{1:20,2:15,"3+":10}),i=Math.max(...t);return 10+e/i*50},getMaxReviewCycles(){if(!this.approvalRateData.monthlyCycleDays||0===this.approvalRateData.monthlyCycleDays.length)return 4;const e=Math.max(...this.approvalRateData.monthlyCycleDays);return Math.ceil(e/6)},async fetchIdentificationRate(){try{const e=await He.A.get("http://localhost:8000/api/risk/identification-rate/",{params:{timeRange:"30days"}});this.identificationRate=e.data.current,this.identificationChange=e.data.percentageChange,this.avgDailyRisks=e.data.dailyAverage,this.identificationTrend=e.data.trendData,this.identificationMonths=e.data.months}catch(e){console.error("Failed to fetch identification rate",e)}},getX(e,t,i){return t<=1?i/2:e/(t-1)*(i-10)+5},getY(e,t,i){const a=Math.min(...t),s=Math.max(...t);return s===a?i/2:(s-e)/(s-a)*(i-20)+10},generateAreaPoints(e,t,i){if(!e.length)return"";let a=e.map((a,s)=>`${this.getX(s,e.length,t)},${this.getY(a,e,i)}`).join(" ");return a+=` ${this.getX(e.length-1,e.length,t)},${i-5}`,a+=` ${this.getX(0,e.length,t)},${i-5}`,a},generateLinePoints(e,t,i){return e.map((a,s)=>`${this.getX(s,e.length,t)},${this.getY(a,e,i)}`).join(" ")}},computed:{severitySegmentStyles(){const e=this.severityPercentages.Low||0,t=this.severityPercentages.Medium||0,i=this.severityPercentages.High||0,a=this.severityPercentages.Critical||0;return{low:{width:`${e}%`,left:"0%"},medium:{width:`${t}%`,left:`${e}%`},high:{width:`${i}%`,left:`${e+t}%`},critical:{width:`${a}%`,left:`${e+t+i}%`}}}}};const lEe=(0,le.A)(oEe,[["render",sEe],["__scopeId","data-v-175f7afa"]]);var nEe=lEe;const rEe={class:"risk-scoring-container"},cEe={class:"risk-scoring-filters-wrapper"},dEe={class:"risk-scoring-dropdowns-wrapper"},uEe={key:0,class:"risk-scoring-loading"},pEe={key:1,class:"risk-scoring-error-message"},mEe={key:2,class:"risk-scoring-no-data"},vEe={key:3},kEe={class:"risk-scoring-table-container"},hEe={class:"risk-scoring-action-text"},gEe=["onClick"],yEe=["onClick"],fEe={key:2,class:"risk-scoring-simple-actions"},bEe=["onClick"],CEe=["onClick"];function LEe(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal"),r=(0,s.g2)("Dynamicalsearch"),c=(0,s.g2)("CustomDropdown"),u=(0,s.g2)("DynamicTable");return(0,s.uX)(),(0,s.CE)("div",rEe,[(0,s.bF)(n),t[7]||(t[7]=(0,s.Lk)("div",{class:"risk-scoring-title"}," Risk Scoring ",-1)),(0,s.Lk)("div",cEe,[(0,s.bF)(r,{modelValue:o.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>o.searchQuery=e),placeholder:"Search...",onInput:l.applyFilters},null,8,["modelValue","onInput"])]),(0,s.Lk)("div",dEe,[(0,s.bF)(c,{config:o.statusFilterConfig,modelValue:o.statusFilter,"onUpdate:modelValue":t[1]||(t[1]=e=>o.statusFilter=e),onChange:l.handleStatusFilterChange},null,8,["config","modelValue","onChange"]),(0,s.bF)(c,{config:o.categoryFilterConfig,modelValue:o.categoryFilter,"onUpdate:modelValue":t[2]||(t[2]=e=>o.categoryFilter=e),onChange:l.handleCategoryFilterChange},null,8,["config","modelValue","onChange"])]),o.loading?((0,s.uX)(),(0,s.CE)("div",uEe,t[3]||(t[3]=[(0,s.Lk)("div",{class:"risk-scoring-spinner"},null,-1),(0,s.Lk)("span",null,"Loading risk data...",-1)]))):o.error?((0,s.uX)(),(0,s.CE)("div",pEe,(0,d.v_)(o.error),1)):0===o.filteredRiskInstances.length?((0,s.uX)(),(0,s.CE)("div",mEe,t[4]||(t[4]=[(0,s.Lk)("p",null,"No risk instances found.",-1)]))):((0,s.uX)(),(0,s.CE)("div",vEe,[(0,s.Lk)("div",kEe,[(0,s.bF)(u,{title:"",data:o.filteredRiskInstances,columns:o.tableColumns,filters:[],"show-checkbox":!1,"show-actions":!0,"show-pagination":!0,"page-size-options":[7,10,20,50],"default-page-size":7,"unique-key":"RiskInstanceId",onFilterChange:l.handleFilterChange},{actions:(0,s.k6)(({row:e})=>[(0,s.Lk)("div",hEe,[l.isScoringCompleted(e)?((0,s.uX)(),(0,s.CE)("span",{key:0,onClick:t=>l.viewScoringDetails(e.RiskInstanceId)},t[5]||(t[5]=[(0,s.eW)(" Scoring Completed "),(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,gEe)):l.isRiskRejected(e)?((0,s.uX)(),(0,s.CE)("span",{key:1,onClick:t=>l.viewScoringDetails(e.RiskInstanceId)},t[6]||(t[6]=[(0,s.eW)(" Instance Rejected "),(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,yEe)):((0,s.uX)(),(0,s.CE)("div",fEe,[(0,s.Lk)("span",{class:"accept-action",onClick:t=>l.mapScoringRisk(e.RiskInstanceId)},"Accept",8,bEe),(0,s.Lk)("span",{class:"reject-action",onClick:t=>l.rejectRisk(e.RiskInstanceId)},"Reject",8,CEe)]))])]),"cell-RiskDescription":(0,s.k6)(({value:e})=>[(0,s.eW)((0,d.v_)(l.truncateText(e,50)||"N/A"),1)]),_:1},8,["data","columns","onFilterChange"])])]))])}var wEe={name:"RiskScoring",components:{DynamicTable:Hn.A,CustomDropdown:xa.A,Dynamicalsearch:VG.A,PopupModal:Ck.wA},data(){return{riskInstances:[],filteredRiskInstances:[],loading:!0,error:null,showActionButtons:(0,ie.Kh)({}),searchQuery:"",statusFilter:"",categoryFilter:"",tableColumns:[{key:"RiskInstanceId",label:"Risk Instance ID",sortable:!0,headerClass:"risk-scoring-col-risk-id",cellClass:"risk-scoring-col-risk-id"},{key:"IncidentId",label:"Incident ID",sortable:!0,headerClass:"risk-scoring-col-incident-id",cellClass:"risk-scoring-col-incident-id"},{key:"ComplianceId",label:"Compliance ID",sortable:!0,headerClass:"risk-scoring-col-compliance-id",cellClass:"risk-scoring-col-compliance-id"},{key:"RiskTitle",label:"Risk Title",sortable:!0,headerClass:"risk-scoring-col-risk-title",cellClass:"risk-scoring-col-risk-title"},{key:"Category",label:"Category",sortable:!0,headerClass:"risk-scoring-col-category",cellClass:"risk-scoring-col-category"},{key:"RiskDescription",label:"Risk Description",sortable:!0,headerClass:"risk-scoring-col-description",cellClass:"risk-scoring-col-description",slot:!0}],statusFilterConfig:{name:"statusFilter",label:"Status",values:[],defaultValue:""},categoryFilterConfig:{name:"categoryFilter",label:"Category",values:[],defaultValue:""},mapScoringButtonConfig:{name:"MAP SCORING RISK",className:"risk-scoring-map-btn risk-scoring-map-btn-full",disabled:!1}}},computed:{uniqueStatuses(){return[...new Set(this.riskInstances.map(e=>e.RiskStatus).filter(e=>e&&""!==e.trim()))]},uniqueCategories(){return[...new Set(this.riskInstances.map(e=>e.Category).filter(e=>e&&""!==e.trim()))]}},watch:{uniqueStatuses:{handler(e){this.statusFilterConfig.values=[{value:"",label:"All Status"},...e.map(e=>({value:e,label:e}))]},immediate:!0},uniqueCategories:{handler(e){this.categoryFilterConfig.values=[{value:"",label:"All Categories"},...e.map(e=>({value:e,label:e}))]},immediate:!0}},mounted(){if(this.fetchRiskInstances(),window.addEventListener("resize",this.handleResize),this.handleResize(),!document.querySelector('link[href*="font-awesome"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css",document.head.appendChild(e)}},activated(){console.log("RiskScoring component activated - refreshing data"),this.fetchRiskInstances()},beforeUnmount(){window.removeEventListener("resize",this.handleResize)},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},applyFilters(){this.filterRiskInstances()},handleStatusFilterChange(e){this.statusFilter=e.value,this.applyFilters()},handleCategoryFilterChange(e){this.categoryFilter=e.value,this.applyFilters()},handleFilterChange(e){console.log("Filter change:",e)},filterRiskInstances(){this.filteredRiskInstances=this.riskInstances.filter(e=>{const t=!this.searchQuery||e.RiskTitle?.toLowerCase().includes(this.searchQuery.toLowerCase())||e.RiskDescription?.toLowerCase().includes(this.searchQuery.toLowerCase()),i=!this.statusFilter||e.RiskStatus===this.statusFilter,a=!this.categoryFilter||e.Category===this.categoryFilter;return t&&i&&a})},validateResponseData(e){return Array.isArray(e)?e:(console.error("Expected array response, got:",typeof e),[])},isScoringCompleted(e){const t=void 0!==e.RiskLikelihood&&null!==e.RiskLikelihood&&void 0!==e.RiskImpact&&null!==e.RiskImpact&&void 0!==e.RiskExposureRating&&null!==e.RiskExposureRating,i=(e.Appetite||"").toLowerCase(),a=(e.RiskStatus||"").toLowerCase();return t&&"yes"===i&&"rejected"!==a},isRiskRejected(e){const t=void 0!==e.RiskLikelihood&&null!==e.RiskLikelihood&&void 0!==e.RiskImpact&&null!==e.RiskImpact&&void 0!==e.RiskExposureRating&&null!==e.RiskExposureRating,i=(e.Appetite||"").toLowerCase(),a=(e.RiskStatus||"").toLowerCase();return t&&("no"===i||"rejected"===a)},viewScoringDetails(e){const t=this.riskInstances.find(t=>t.RiskInstanceId===e);console.log(`Viewing scoring details for Risk ${e}`),console.log(`Risk details: Status=${t.RiskStatus}, Appetite=${t.Appetite}`),console.log(`Display logic: isScoringCompleted=${this.isScoringCompleted(t)}, isRiskRejected=${this.isRiskRejected(t)}`),this.sendPushNotification({title:"Risk Scoring Details Viewed",message:`Risk scoring details for "${t.RiskTitle||"Untitled Risk"}" (ID: ${e}) have been viewed.`,category:"risk",priority:"medium",user_id:"default_user"}),this.$router.push({path:`/risk/scoring-details/${e}`,query:{action:"view"}})},fetchRiskInstances(){He.A.get("http://localhost:8000/api/risk-instances/").then(e=>{console.log("Risk instances data received:",e.data),this.riskInstances=e.data.map(e=>({...e,RiskLikelihood:e.RiskLikelihood||1,RiskImpact:e.RiskImpact||1,RiskExposureRating:e.RiskExposureRating||(e.RiskLikelihood||1)*(e.RiskImpact||1)})),this.filteredRiskInstances=[...this.riskInstances],this.riskInstances.forEach(e=>{console.log(`Risk #${e.RiskInstanceId}: Status=${e.RiskStatus}, Appetite=${e.Appetite}, Likelihood=${e.RiskLikelihood}, Impact=${e.RiskImpact}, Exposure=${e.RiskExposureRating}`),this.showActionButtons[e.RiskInstanceId]=!1}),this.riskInstances.length>0&&this.sendPushNotification({title:"Risk Instances Loaded Successfully",message:`${this.riskInstances.length} risk instances have been loaded for scoring.`,category:"risk",priority:"medium",user_id:"default_user"}),this.loading=!1}).catch(e=>{console.error("Error fetching risk instances:",e),this.error=`Failed to fetch risk instances: ${e.message}`,this.sendPushNotification({title:"Risk Instances Load Failed",message:`Failed to load risk instances: ${e.message}`,category:"risk",priority:"high",user_id:"default_user"}),this.loading=!1})},handleResize(){const e=document.querySelector(".risk-scoring-container");e&&(window.innerWidth<768?(e.style.marginLeft="0",e.style.maxWidth="100vw"):window.innerWidth<992?(e.style.marginLeft="60px",e.style.maxWidth="calc(100vw - 60px)"):window.innerWidth<1200?(e.style.marginLeft="200px",e.style.maxWidth="calc(100vw - 200px)"):(e.style.marginLeft="280px",e.style.maxWidth="calc(100vw - 280px)"))},truncateText(e,t){return e?e.length>t?e.substring(0,t)+"...":e:""},toggleActionButtons(e){this.showActionButtons[e]=!this.showActionButtons[e]},rejectRisk(e){const t=this.riskInstances.find(t=>t.RiskInstanceId===e);this.sendPushNotification({title:"Risk Instance Rejection Initiated",message:`Risk "${t.RiskTitle||"Untitled Risk"}" (ID: ${e}) is being rejected for scoring.`,category:"risk",priority:"high",user_id:"default_user"}),console.log(`Navigating to Scoring Details for Risk ${e} (rejected)`),this.$router.push({path:`/risk/scoring-details/${e}`,query:{action:"reject"}})},mapScoringRisk(e){const t=this.riskInstances.find(t=>t.RiskInstanceId===e);this.sendPushNotification({title:"Risk Instance Acceptance Initiated",message:`Risk "${t.RiskTitle||"Untitled Risk"}" (ID: ${e}) is being accepted for scoring.`,category:"risk",priority:"high",user_id:"default_user"}),console.log(`Navigating to Scoring Details for Risk ${e} (accepted)`),this.$router.push({path:`/risk/scoring-details/${e}`,query:{action:"accept"}})}}};const EEe=(0,le.A)(wEe,[["render",LEe],["__scopeId","data-v-5d12ead6"]]);var REe=EEe;const IEe={class:"risk-scoring-container"},DEe={key:0,class:"risk-scoring-loading"},PEe=["innerHTML"],_Ee={key:2,class:"risk-scoring-no-data"},AEe={key:3,class:"risk-scoring-details"},SEe={class:"risk-scoring-detail-header"},TEe={key:0,class:"risk-scoring-action-header-buttons"},xEe={key:0,class:"risk-scoring-validation-summary"},FEe={class:"risk-scoring-section-container"},VEe={class:"risk-scoring-detail-row"},UEe={class:"risk-scoring-detail-item"},NEe={class:"risk-scoring-detail-value"},MEe={class:"risk-scoring-detail-item"},XEe=["readonly"],$Ee={class:"risk-scoring-detail-item"},OEe=["readonly"],jEe={class:"risk-scoring-detail-row"},BEe={class:"risk-scoring-detail-item"},WEe=["readonly"],qEe={key:0,class:"validation-error"},QEe={class:"risk-scoring-detail-item"},KEe=["disabled"],JEe=["value"],zEe={key:0,class:"validation-error"},HEe={class:"risk-scoring-detail-item"},GEe=["disabled"],YEe={class:"risk-scoring-detail-row"},ZEe={class:"risk-scoring-detail-item"},eRe={key:0,class:"risk-scoring-category-container"},tRe={class:"risk-scoring-category-dropdown"},iRe={key:0},aRe={key:1},sRe={key:0,class:"risk-scoring-category-options"},oRe={class:"risk-scoring-category-search"},lRe={class:"risk-scoring-category-list"},nRe=["onClick"],rRe=["checked","onClick"],cRe={class:"risk-scoring-detail-item"},dRe=["readonly"],uRe={class:"risk-scoring-detail-item"},pRe=["disabled"],mRe=["value"],vRe={key:0,class:"validation-error"},kRe={class:"risk-scoring-detail-row"},hRe={class:"risk-scoring-detail-item"},gRe=["readonly"],yRe={class:"risk-scoring-detail-item"},fRe=["disabled"],bRe=["value"],CRe={key:0,class:"validation-error"},LRe={class:"risk-scoring-detail-item"},wRe=["readonly"],ERe={class:"risk-scoring-section-container"},RRe={class:"risk-scoring-mapping-risks-section"},IRe={class:"risk-scoring-mapping-description"},DRe={key:0,class:"risk-scoring-loading"},PRe={key:1,class:"risk-scoring-mapping-risks-table"},_Re=["id","value"],ARe={class:"risk-scoring-selected-risks-actions"},SRe={class:"risk-scoring-selected-risks-info"},TRe={key:0,class:"risk-scoring-selected-risks-count"},xRe={key:2,class:"risk-scoring-no-matching-risks"},FRe={class:"risk-scoring-section-container"},VRe={class:"risk-scoring-detail-row"},URe={class:"risk-scoring-detail-item"},NRe=["readonly"],MRe={class:"risk-scoring-detail-item"},XRe=["min","max","readonly"],$Re={key:0,class:"validation-error"},ORe={class:"risk-scoring-detail-item"},jRe=["min","max","readonly"],BRe={key:0,class:"validation-error"},WRe={class:"risk-scoring-detail-row"},qRe={class:"risk-scoring-detail-item"},QRe={class:"risk-scoring-detail-item"},KRe=["disabled"],JRe=["value"],zRe={key:0,class:"validation-error"},HRe={class:"risk-scoring-detail-item"},GRe=["disabled"],YRe=["value"],ZRe={key:0,class:"validation-error"},eIe={class:"risk-scoring-detail-row"},tIe={class:"risk-scoring-detail-item"},iIe={key:0},aIe={key:1},sIe={class:"risk-scoring-dropdown-search-container"},oIe={class:"risk-scoring-dropdown-items"},lIe=["onClick"],nIe=["id","checked"],rIe=["for"],cIe={class:"risk-scoring-selected-items"},dIe=["onClick"],uIe={class:"risk-scoring-detail-item"},pIe=["disabled"],mIe=["value"],vIe={key:0,class:"validation-error"},kIe={class:"risk-scoring-detail-row"},hIe={class:"risk-scoring-detail-item"},gIe=["readonly"],yIe={class:"risk-scoring-detail-item"},fIe={class:"risk-scoring-mitigation-form"},bIe={class:"risk-scoring-mitigation-input-group"},CIe=["onUpdate:modelValue","readonly","onInput"],LIe=["onClick"],wIe={class:"risk-scoring-form-footer"},EIe=["disabled"],RIe={key:0},IIe={key:1},DIe={class:"risk-scoring-modal-form-group"},PIe={class:"risk-scoring-modal-actions"},_Ie=["disabled"],AIe={class:"risk-scoring-modal-form-group"},SIe={class:"risk-scoring-modal-actions"},TIe=["disabled"];function xIe(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",IEe,[(0,s.bF)(r),t[123]||(t[123]=(0,s.Lk)("h1",null,"Scoring Details",-1)),l.loading?((0,s.uX)(),(0,s.CE)("div",DEe,t[56]||(t[56]=[(0,s.Lk)("div",{class:"risk-scoring-spinner"},null,-1),(0,s.Lk)("span",null,"Loading risk instance data...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"risk-scoring-error-message",innerHTML:l.sanitize.sanitizeHtml(l.error)},null,8,PEe)):l.riskInstance?((0,s.uX)(),(0,s.CE)("div",AEe,[(0,s.Lk)("div",SEe,[(0,s.Lk)("h2",null,"Risk Instance #"+(0,d.v_)(l.sanitize.escapeHtml(l.editedRiskInstance.RiskInstanceId)),1),n.isCreateAction?((0,s.uX)(),(0,s.CE)("div",TEe,[(0,s.Lk)("button",{class:"risk-scoring-map-btn",onClick:t[0]||(t[0]=(...e)=>n.mapScoringRisk&&n.mapScoringRisk(...e))},"MAP SCORING RISK")])):(0,s.Q3)("",!0)]),(0,s.Lk)("form",{onSubmit:t[55]||(t[55]=(0,a.D$)((...e)=>n.submitForm&&n.submitForm(...e),["prevent"])),class:"risk-scoring-detail-grid-container"},[n.activeValidationErrors.length>0?((0,s.uX)(),(0,s.CE)("div",xEe,[t[58]||(t[58]=(0,s.Lk)("h4",null,"Please fix the following errors:",-1)),(0,s.Lk)("ul",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.activeValidationErrors,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.field},(0,d.v_)(l.sanitize.escapeHtml(e.error)),1))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",FEe,[t[89]||(t[89]=(0,s.Lk)("h3",{class:"risk-scoring-section-title"},"Basic Risk Information",-1)),(0,s.Lk)("div",VEe,[(0,s.Lk)("div",UEe,[t[59]||(t[59]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Instance Id",-1)),(0,s.Lk)("div",NEe,(0,d.v_)(l.sanitize.escapeHtml(l.editedRiskInstance.RiskInstanceId)),1),t[60]||(t[60]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Unique identifier for this risk instance",-1))]),(0,s.Lk)("div",MEe,[t[61]||(t[61]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Incident Id",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>l.editedRiskInstance.IncidentId=e),class:"risk-scoring-form-input",readonly:l.isReadOnly,onInput:t[2]||(t[2]=e=>l.editedRiskInstance.IncidentId=l.sanitize.escapeHtml(e.target.value))},null,40,XEe),[[a.Jo,l.editedRiskInstance.IncidentId]]),t[62]||(t[62]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Reference to the related incident or event",-1))]),(0,s.Lk)("div",$Ee,[t[63]||(t[63]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Compliance Id",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>l.editedRiskInstance.ComplianceId=e),class:"risk-scoring-form-input",readonly:l.isReadOnly,onInput:t[4]||(t[4]=e=>l.editedRiskInstance.ComplianceId=l.sanitize.escapeHtml(e.target.value))},null,40,OEe),[[a.Jo,l.editedRiskInstance.ComplianceId]]),t[64]||(t[64]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Compliance framework identifier for this risk",-1))])]),(0,s.Lk)("div",jEe,[(0,s.Lk)("div",BEe,[t[65]||(t[65]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Title",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>l.editedRiskInstance.RiskTitle=e),class:(0,d.C4)(["risk-scoring-form-input",{invalid:l.validationErrors.RiskTitle}]),readonly:l.isReadOnly,onInput:t[6]||(t[6]=e=>l.editedRiskInstance.RiskTitle=l.sanitize.escapeHtml(e.target.value))},null,42,WEe),[[a.Jo,l.editedRiskInstance.RiskTitle]]),l.validationErrors.RiskTitle?((0,s.uX)(),(0,s.CE)("span",qEe,(0,d.v_)(l.sanitize.escapeHtml(l.validationErrors.RiskTitle)),1)):(0,s.Q3)("",!0),t[66]||(t[66]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Provide a brief, descriptive title for this risk",-1))]),(0,s.Lk)("div",QEe,[t[68]||(t[68]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Criticality",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[7]||(t[7]=e=>l.editedRiskInstance.Criticality=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Criticality}]),disabled:l.isReadOnly},[t[67]||(t[67]=(0,s.Lk)("option",{value:""},"Select Criticality",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_CRITICALITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,JEe))),128))],10,KEe),[[a.u1,l.editedRiskInstance.Criticality]]),l.validationErrors.Criticality?((0,s.uX)(),(0,s.CE)("span",zEe,(0,d.v_)(l.validationErrors.Criticality),1)):(0,s.Q3)("",!0),t[69]||(t[69]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Choose the severity level of this risk",-1))]),(0,s.Lk)("div",HEe,[t[71]||(t[71]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Status",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.editedRiskInstance.RiskStatus=e),class:"risk-scoring-form-select",disabled:l.isReadOnly},t[70]||(t[70]=[(0,s.Lk)("option",{value:"Not Assigned",selected:""},"Not Assigned",-1),(0,s.Lk)("option",{value:"Assigned"},"Assigned",-1),(0,s.Lk)("option",{value:"Approved"},"Approved",-1),(0,s.Lk)("option",{value:"Rejected"},"Rejected",-1)]),8,GEe),[[a.u1,l.editedRiskInstance.RiskStatus]]),t[72]||(t[72]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Current status of this risk in the assessment process",-1))])]),(0,s.Lk)("div",YEe,[(0,s.Lk)("div",ZEe,[t[75]||(t[75]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Category",-1)),l.isReadOnly?(0,s.bo)(((0,s.uX)(),(0,s.CE)("input",{key:1,type:"text","onUpdate:modelValue":t[13]||(t[13]=e=>l.editedRiskInstance.Category=e),class:"risk-scoring-form-input",readonly:""},null,512)),[[a.Jo,l.editedRiskInstance.Category]]):((0,s.uX)(),(0,s.CE)("div",eRe,[(0,s.Lk)("div",tRe,[(0,s.Lk)("div",{class:"risk-scoring-selected-category",onClick:t[9]||(t[9]=(...e)=>n.toggleCategoryDropdown&&n.toggleCategoryDropdown(...e))},[l.selectedCategory?((0,s.uX)(),(0,s.CE)("span",aRe,(0,d.v_)(l.selectedCategory),1)):((0,s.uX)(),(0,s.CE)("span",iRe,"Select Category")),t[73]||(t[73]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showCategoryDropdown?((0,s.uX)(),(0,s.CE)("div",sRe,[(0,s.Lk)("div",oRe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=e=>l.categorySearch=e),placeholder:"Search categories...",onClick:t[11]||(t[11]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,l.categorySearch]]),(0,s.Lk)("button",{type:"button",class:"risk-scoring-add-category-btn",onClick:t[12]||(t[12]=(0,a.D$)(e=>l.showAddCategoryModal=!0,["stop","prevent"]))},t[74]||(t[74]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",lRe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredCategories,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-scoring-category-item",onClick:(0,a.D$)(t=>n.selectCategory(e),["stop"])},[(0,s.Lk)("input",{type:"radio",checked:l.selectedCategory===e.value,onClick:(0,a.D$)(t=>n.selectCategory(e),["stop"])},null,8,rRe),(0,s.Lk)("span",null,(0,d.v_)(e.value),1)],8,nRe))),128))])])):(0,s.Q3)("",!0)])])),t[76]||(t[76]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Categorize this risk for better organization and management",-1))]),(0,s.Lk)("div",cRe,[t[77]||(t[77]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Possible Damage",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>l.editedRiskInstance.PossibleDamage=e),class:"risk-scoring-form-input",readonly:l.isReadOnly},null,8,dRe),[[a.Jo,l.editedRiskInstance.PossibleDamage]]),t[78]||(t[78]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Describe the potential damage or consequences if this risk occurs",-1))]),(0,s.Lk)("div",uRe,[t[80]||(t[80]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Priority",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[15]||(t[15]=e=>l.editedRiskInstance.RiskPriority=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.RiskPriority}]),disabled:l.isReadOnly},[t[79]||(t[79]=(0,s.Lk)("option",{value:""},"Select Priority",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_PRIORITY,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,mRe))),128))],10,pRe),[[a.u1,l.editedRiskInstance.RiskPriority]]),l.validationErrors.RiskPriority?((0,s.uX)(),(0,s.CE)("span",vRe,(0,d.v_)(l.validationErrors.RiskPriority),1)):(0,s.Q3)("",!0),t[81]||(t[81]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Set the priority level for risk treatment and response",-1))])]),(0,s.Lk)("div",kRe,[(0,s.Lk)("div",hRe,[t[82]||(t[82]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Reported By",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[16]||(t[16]=e=>l.editedRiskInstance.ReportedBy=e),class:"risk-scoring-form-input",readonly:l.isReadOnly},null,8,gRe),[[a.Jo,l.editedRiskInstance.ReportedBy]]),t[83]||(t[83]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Name or identifier of the person who reported this risk",-1))]),(0,s.Lk)("div",yRe,[t[85]||(t[85]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Origin",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[17]||(t[17]=e=>l.editedRiskInstance.Origin=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Origin}]),disabled:l.isReadOnly},[t[84]||(t[84]=(0,s.Lk)("option",{value:""},"Select Origin",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_ORIGIN,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,bRe))),128))],10,fRe),[[a.u1,l.editedRiskInstance.Origin]]),l.validationErrors.Origin?((0,s.uX)(),(0,s.CE)("span",CRe,(0,d.v_)(l.validationErrors.Origin),1)):(0,s.Q3)("",!0),t[86]||(t[86]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Source or method through which this risk was identified",-1))]),(0,s.Lk)("div",LRe,[t[87]||(t[87]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[18]||(t[18]=e=>l.editedRiskInstance.RiskDescription=e),class:"risk-scoring-form-textarea",readonly:l.isReadOnly},null,8,wRe),[[a.Jo,l.editedRiskInstance.RiskDescription]]),t[88]||(t[88]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Provide a detailed description of the risk, its context, and contributing factors",-1))])])]),(0,s.Lk)("div",ERe,[t[92]||(t[92]=(0,s.Lk)("h3",{class:"risk-scoring-section-title"},"Mapped Risks",-1)),(0,s.Lk)("div",RRe,[(0,s.Lk)("p",IRe,"Select risks from Risk Register with matching Compliance ID: "+(0,d.v_)(l.editedRiskInstance.ComplianceId||"None"),1),l.loadingMatchingRisks?((0,s.uX)(),(0,s.CE)("div",DRe,t[90]||(t[90]=[(0,s.Lk)("div",{class:"risk-scoring-spinner"},null,-1),(0,s.Lk)("span",null,"Loading matching risks...",-1)]))):l.matchingRisks.length>0?((0,s.uX)(),(0,s.CE)("div",PRe,[(0,s.Lk)("table",null,[t[91]||(t[91]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"Select"),(0,s.Lk)("th",null,"Risk ID"),(0,s.Lk)("th",null,"Compliance ID"),(0,s.Lk)("th",null,"Risk Title"),(0,s.Lk)("th",null,"Criticality"),(0,s.Lk)("th",null,"Category")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.matchingRisks,e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.RiskId},[(0,s.Lk)("td",null,[(0,s.bo)((0,s.Lk)("input",{type:"checkbox",id:"risk-"+e.RiskId,value:e.RiskId,"onUpdate:modelValue":t[19]||(t[19]=e=>l.selectedRisks=e),class:"risk-scoring-risk-checkbox"},null,8,_Re),[[a.lH,l.selectedRisks]])]),(0,s.Lk)("td",null,(0,d.v_)(e.RiskId),1),(0,s.Lk)("td",null,(0,d.v_)(e.ComplianceId),1),(0,s.Lk)("td",null,(0,d.v_)(e.RiskTitle),1),(0,s.Lk)("td",null,(0,d.v_)(e.Criticality),1),(0,s.Lk)("td",null,(0,d.v_)(e.Category),1)]))),128))])]),(0,s.Lk)("div",ARe,[(0,s.Lk)("div",SRe,[l.selectedRisks.length>0?((0,s.uX)(),(0,s.CE)("div",TRe,(0,d.v_)(l.selectedRisks.length)+" risk(s) selected ",1)):(0,s.Q3)("",!0),l.selectedRisks.length>0?((0,s.uX)(),(0,s.CE)("button",{key:1,type:"button",class:"risk-scoring-fill-scoring-button",onClick:t[20]||(t[20]=(...e)=>n.fillScoringFromSelectedRisk&&n.fillScoringFromSelectedRisk(...e))}," Fill Scoring ")):(0,s.Q3)("",!0)]),(0,s.Lk)("button",{type:"button",class:"risk-scoring-create-risk-btn",onClick:t[21]||(t[21]=(...e)=>n.createRisk&&n.createRisk(...e))},"Create Risk")])])):((0,s.uX)(),(0,s.CE)("div",xRe,[(0,s.Lk)("p",null,"No matching risks found with Compliance ID: "+(0,d.v_)(l.editedRiskInstance.ComplianceId||"None"),1),(0,s.Lk)("button",{type:"button",class:"risk-scoring-create-risk-btn",onClick:t[22]||(t[22]=(...e)=>n.createRisk&&n.createRisk(...e))},"Create Risk")]))])]),(0,s.Lk)("div",FRe,[t[118]||(t[118]=(0,s.Lk)("h3",{class:"risk-scoring-section-title"},"Risk Assessment",-1)),(0,s.Lk)("div",VRe,[(0,s.Lk)("div",URe,[t[93]||(t[93]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Id",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[23]||(t[23]=e=>l.editedRiskInstance.RiskId=e),class:"risk-scoring-form-input",readonly:l.isReadOnly},null,8,NRe),[[a.Jo,l.editedRiskInstance.RiskId]]),t[94]||(t[94]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Reference to the base risk template from the risk register",-1))]),(0,s.Lk)("div",MRe,[t[95]||(t[95]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Likelihood",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[24]||(t[24]=e=>l.editedRiskInstance.RiskLikelihood=e),class:(0,d.C4)(["risk-scoring-form-input",{invalid:l.validationErrors.RiskLikelihood}]),min:l.validationRules.RISK_LIKELIHOOD_RANGE.min,max:l.validationRules.RISK_LIKELIHOOD_RANGE.max,readonly:l.isReadOnly,onInput:t[25]||(t[25]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e))},null,42,XRe),[[a.Jo,l.editedRiskInstance.RiskLikelihood,void 0,{number:!0}]]),l.validationErrors.RiskLikelihood?((0,s.uX)(),(0,s.CE)("span",$Re,(0,d.v_)(l.validationErrors.RiskLikelihood),1)):(0,s.Q3)("",!0),t[96]||(t[96]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Rate how likely this risk is to occur (1=Very Unlikely, 10=Very Likely)",-1))]),(0,s.Lk)("div",ORe,[t[97]||(t[97]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Impact",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number","onUpdate:modelValue":t[26]||(t[26]=e=>l.editedRiskInstance.RiskImpact=e),class:(0,d.C4)(["risk-scoring-form-input",{invalid:l.validationErrors.RiskImpact}]),min:l.validationRules.RISK_IMPACT_RANGE.min,max:l.validationRules.RISK_IMPACT_RANGE.max,readonly:l.isReadOnly,onInput:t[27]||(t[27]=(...e)=>n.calculateRiskExposureRating&&n.calculateRiskExposureRating(...e))},null,42,jRe),[[a.Jo,l.editedRiskInstance.RiskImpact,void 0,{number:!0}]]),l.validationErrors.RiskImpact?((0,s.uX)(),(0,s.CE)("span",BRe,(0,d.v_)(l.validationErrors.RiskImpact),1)):(0,s.Q3)("",!0),t[98]||(t[98]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Rate the potential impact if this risk occurs (1=Minimal, 10=Severe)",-1))])]),(0,s.Lk)("div",WRe,[(0,s.Lk)("div",qRe,[t[99]||(t[99]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Exposure Rating (Likelihood × Impact)",-1)),(0,s.bo)((0,s.Lk)("input",{type:"number",readonly:"","onUpdate:modelValue":t[28]||(t[28]=e=>l.editedRiskInstance.RiskExposureRating=e),class:"risk-scoring-form-input risk-scoring-readonly-input"},null,512),[[a.Jo,l.editedRiskInstance.RiskExposureRating,void 0,{number:!0}]]),t[100]||(t[100]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Automatically calculated as Likelihood × Impact",-1))]),(0,s.Lk)("div",QRe,[t[101]||(t[101]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Type",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[29]||(t[29]=e=>l.editedRiskInstance.RiskType=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.RiskType}]),disabled:l.isReadOnly},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,JRe))),128))],10,KRe),[[a.u1,l.editedRiskInstance.RiskType]]),l.validationErrors.RiskType?((0,s.uX)(),(0,s.CE)("span",zRe,(0,d.v_)(l.validationErrors.RiskType),1)):(0,s.Q3)("",!0),t[102]||(t[102]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Classify the nature and timing of this risk",-1))]),(0,s.Lk)("div",HRe,[t[103]||(t[103]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Appetite",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[30]||(t[30]=e=>l.editedRiskInstance.Appetite=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.Appetite}]),disabled:l.isReadOnly,onChange:t[31]||(t[31]=(...e)=>n.onAppetiteChange&&n.onAppetiteChange(...e))},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_APPETITE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,YRe))),128))],42,GRe),[[a.u1,l.editedRiskInstance.Appetite]]),l.validationErrors.Appetite?((0,s.uX)(),(0,s.CE)("span",ZRe,(0,d.v_)(l.validationErrors.Appetite),1)):(0,s.Q3)("",!0),t[104]||(t[104]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Indicate if the organization accepts this risk level",-1))])]),(0,s.Lk)("div",eIe,[(0,s.Lk)("div",tIe,[t[107]||(t[107]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Impact")],-1)),(0,s.Lk)("div",{class:"risk-scoring-business-impact-dropdown-header",onClick:t[32]||(t[32]=(0,a.D$)((...e)=>n.toggleBusinessImpactDropdown&&n.toggleBusinessImpactDropdown(...e),["stop"]))},[0===l.selectedBusinessImpacts.length?((0,s.uX)(),(0,s.CE)("span",iIe,"Select Business Impacts")):((0,s.uX)(),(0,s.CE)("span",aIe,(0,d.v_)(l.selectedBusinessImpacts.length)+" impact(s) selected",1)),t[105]||(t[105]=(0,s.Lk)("i",{class:"fas fa-chevron-down"},null,-1))]),l.showBusinessImpactDropdown?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"risk-scoring-business-impact-dropdown",onClick:t[37]||(t[37]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",sIe,[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[33]||(t[33]=e=>l.businessImpactSearch=e),placeholder:"Search impacts...",class:"risk-scoring-dropdown-search",onClick:t[34]||(t[34]=(0,a.D$)(()=>{},["stop"]))},null,512),[[a.Jo,l.businessImpactSearch]]),(0,s.Lk)("button",{type:"button",class:"risk-scoring-add-impact-btn",onClick:t[35]||(t[35]=(0,a.D$)(e=>l.showAddImpactModal=!0,["stop","prevent"]))},t[106]||(t[106]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add New ")]))]),(0,s.Lk)("div",oIe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.filteredBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-scoring-dropdown-item",onClick:(0,a.D$)(t=>n.toggleBusinessImpact(e),["stop"])},[(0,s.Lk)("input",{type:"checkbox",id:"impact-"+e.id,checked:n.isBusinessImpactSelected(e),onClick:t[36]||(t[36]=(0,a.D$)(()=>{},["stop"]))},null,8,nIe),(0,s.Lk)("label",{for:"impact-"+e.id},(0,d.v_)(e.value),9,rIe)],8,lIe))),128))])])):(0,s.Q3)("",!0),(0,s.Lk)("div",cIe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.selectedBusinessImpacts,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"risk-scoring-selected-item"},[(0,s.eW)((0,d.v_)(l.sanitize.escapeHtml(e.value))+" ",1),(0,s.Lk)("i",{class:"fas fa-times",onClick:t=>n.toggleBusinessImpact(e)},null,8,dIe)]))),128))]),t[108]||(t[108]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Select the business areas that would be affected by this risk",-1))]),(0,s.Lk)("div",uIe,[t[109]||(t[109]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Response Type",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[38]||(t[38]=e=>l.editedRiskInstance.RiskResponseType=e),class:(0,d.C4)(["risk-scoring-form-select",{invalid:l.validationErrors.RiskResponseType}]),disabled:l.isReadOnly},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.validationRules.ALLOWED_RISK_RESPONSE_TYPE,e=>((0,s.uX)(),(0,s.CE)("option",{key:e,value:e},(0,d.v_)(e),9,mIe))),128))],10,pIe),[[a.u1,l.editedRiskInstance.RiskResponseType]]),l.validationErrors.RiskResponseType?((0,s.uX)(),(0,s.CE)("span",vIe,(0,d.v_)(l.validationErrors.RiskResponseType),1)):(0,s.Q3)("",!0),t[110]||(t[110]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Choose the strategy for addressing this risk",-1))])]),(0,s.Lk)("div",kIe,[(0,s.Lk)("div",hIe,[t[111]||(t[111]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Response Description",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[39]||(t[39]=e=>l.editedRiskInstance.RiskResponseDescription=e),class:"risk-scoring-form-textarea",readonly:l.isReadOnly},null,8,gIe),[[a.Jo,l.editedRiskInstance.RiskResponseDescription]]),t[112]||(t[112]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Provide details about the chosen risk response strategy",-1))]),(0,s.Lk)("div",yIe,[t[116]||(t[116]=(0,s.Lk)("div",{class:"risk-scoring-detail-label"},"Risk Mitigation",-1)),(0,s.Lk)("div",fIe,[(0,s.Lk)("div",bIe,[t[115]||(t[115]=(0,s.Lk)("label",null,"Actions",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationForm.actions,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"risk-scoring-action-item"},[(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":e=>l.mitigationForm.actions[i]=e,class:"risk-scoring-form-input",readonly:l.isReadOnly,onInput:e=>{l.mitigationForm.actions[i]=l.sanitize.escapeHtml(e.target.value),n.updateMitigationJson()}},null,40,CIe),[[a.Jo,l.mitigationForm.actions[i]]]),l.isReadOnly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",class:"risk-scoring-remove-action",onClick:e=>n.removeAction(i)},t[113]||(t[113]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,LIe))]))),128)),l.isReadOnly?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",class:"risk-scoring-add-action",onClick:t[40]||(t[40]=(...e)=>n.addAction&&n.addAction(...e))},t[114]||(t[114]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Action ")])))]),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[41]||(t[41]=e=>l.riskMitigationJson=e),style:{display:"none"}},null,512),[[a.Jo,l.riskMitigationJson]])]),t[117]||(t[117]=(0,s.Lk)("div",{class:"risk-scoring-helper-text"},"Describe the strategies and measures to reduce or eliminate this risk",-1))])])]),(0,s.Lk)("div",wIe,[(0,s.Lk)("button",{type:"submit",class:"risk-scoring-submit-button",disabled:l.submitting},[l.submitting?((0,s.uX)(),(0,s.CE)("span",RIe,"Saving...")):((0,s.uX)(),(0,s.CE)("span",IIe,"Save Changes"))],8,EIe),(0,s.Lk)("button",{type:"button",class:"risk-scoring-back-button",onClick:t[42]||(t[42]=(...e)=>n.goBack&&n.goBack(...e))},"Back to Risk Scoring")]),l.showAddImpactModal?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"risk-scoring-modal-overlay",onClick:t[48]||(t[48]=(0,a.D$)(e=>l.showAddImpactModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-scoring-modal-content",onClick:t[47]||(t[47]=(0,a.D$)(()=>{},["stop"]))},[t[120]||(t[120]=(0,s.Lk)("h3",null,"Add New Business Impact",-1)),(0,s.Lk)("form",{onSubmit:t[46]||(t[46]=(0,a.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"])),class:"risk-scoring-modal-form"},[(0,s.Lk)("div",DIe,[t[119]||(t[119]=(0,s.Lk)("label",null,"Impact Description",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[43]||(t[43]=e=>l.newBusinessImpact=e),placeholder:"Enter new business impact",onKeyup:t[44]||(t[44]=(0,a.jR)((0,a.D$)((...e)=>n.addNewBusinessImpact&&n.addNewBusinessImpact(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,l.newBusinessImpact]])]),(0,s.Lk)("div",PIe,[(0,s.Lk)("button",{type:"button",class:"risk-scoring-cancel-btn",onClick:t[45]||(t[45]=(0,a.D$)(e=>l.showAddImpactModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-scoring-add-btn",disabled:!l.newBusinessImpact.trim()}," Add Impact ",8,_Ie)])],32)])])):(0,s.Q3)("",!0),l.showAddCategoryModal?((0,s.uX)(),(0,s.CE)("div",{key:2,class:"risk-scoring-modal-overlay",onClick:t[54]||(t[54]=(0,a.D$)(e=>l.showAddCategoryModal=!1,["self"]))},[(0,s.Lk)("div",{class:"risk-scoring-modal-content",onClick:t[53]||(t[53]=(0,a.D$)(()=>{},["stop"]))},[t[122]||(t[122]=(0,s.Lk)("h3",null,"Add New Category",-1)),(0,s.Lk)("form",{onSubmit:t[52]||(t[52]=(0,a.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"])),class:"risk-scoring-modal-form"},[(0,s.Lk)("div",AIe,[t[121]||(t[121]=(0,s.Lk)("label",null,"Category Name",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[49]||(t[49]=e=>l.newCategory=e),placeholder:"Enter new category",onKeyup:t[50]||(t[50]=(0,a.jR)((0,a.D$)((...e)=>n.addNewCategory&&n.addNewCategory(...e),["prevent"]),["enter"])),autofocus:""},null,544),[[a.Jo,l.newCategory]])]),(0,s.Lk)("div",SIe,[(0,s.Lk)("button",{type:"button",class:"risk-scoring-cancel-btn",onClick:t[51]||(t[51]=(0,a.D$)(e=>l.showAddCategoryModal=!1,["prevent"]))},"Cancel"),(0,s.Lk)("button",{type:"submit",class:"risk-scoring-add-btn",disabled:!l.newCategory.trim()}," Add Category ",8,TIe)])],32)])])):(0,s.Q3)("",!0)],32)])):((0,s.uX)(),(0,s.CE)("div",_Ee,t[57]||(t[57]=[(0,s.Lk)("p",null,"No risk instance found.",-1)])))])}const FIe={escapeHtml(e){if(null===e||void 0===e)return"";const t=String(e);return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},escapeJs(e){return null===e||void 0===e?"":JSON.stringify(String(e)).slice(1,-1)},sanitizeHtml(e){if(null===e||void 0===e)return"";let t=this.escapeHtml(String(e));const i=["b","i","em","strong","a","p","br"];return i.forEach(e=>{const i=new RegExp(`&lt;${e}( .*?)?&gt;`,"g"),a=new RegExp(`&lt;/${e}&gt;`,"g");t=t.replace(i,`<${e}>`).replace(a,`</${e}>`)}),t},safeValue(e){return null===e||void 0===e?"":"number"===typeof e?e:this.escapeHtml(String(e))}};var VIe={name:"ScoringDetails",components:{PopupModal:Ck.wA},props:{riskId:{type:[String,Number],required:!0},action:{type:String,default:"view"}},data(){return{riskInstance:null,editedRiskInstance:{RiskLikelihood:null,RiskImpact:null},riskMitigationJson:"",loading:!0,error:null,submitting:!1,submitSuccess:!1,submitError:null,matchingRisks:[],selectedRisks:[],loadingMatchingRisks:!1,defaultAppetite:"No",isReadOnly:!1,businessImpacts:[],selectedBusinessImpacts:[],showBusinessImpactDropdown:!1,businessImpactSearch:"",showAddImpactModal:!1,newBusinessImpact:"",categories:[],selectedCategory:"",showCategoryDropdown:!1,categorySearch:"",showAddCategoryModal:!1,newCategory:"",mitigationForm:{actions:[]},validationRules:{ALLOWED_CRITICALITY:["Critical","High","Medium","Low"],ALLOWED_RISK_PRIORITY:["High","Medium","Low"],ALLOWED_ORIGIN:["Manual","SIEM","AuditFindings"],ALLOWED_RISK_TYPE:["Current","Residual","Inherent","Emerging","Accept"],ALLOWED_APPETITE:["Yes","No"],ALLOWED_RISK_RESPONSE_TYPE:["Mitigate","Avoid","Accept","Transfer"],RISK_LIKELIHOOD_RANGE:{min:1,max:10},RISK_IMPACT_RANGE:{min:1,max:10},TEXT_PATTERN:/^[A-Za-z0-9\s.,;:!?'"()\-_[\]]{0,}$/},validationErrors:{Criticality:"",RiskPriority:"",Origin:"",RiskType:"",Appetite:"",RiskResponseType:"",RiskLikelihood:"",RiskImpact:"",RiskTitle:"",RiskDescription:"",Category:"",BusinessImpact:"",RiskMitigation:""},sanitize:FIe}},computed:{isRejectedAction(){return"reject"===this.$route.query.action},isViewAction(){return"view"===this.$route.query.action},isCreateAction(){return"create"===this.$route.query.action},filteredBusinessImpacts(){if(!this.businessImpactSearch)return this.businessImpacts;const e=this.businessImpactSearch.toLowerCase();return this.businessImpacts.filter(t=>t.value.toLowerCase().includes(e))},filteredCategories(){if(!this.categorySearch)return this.categories;const e=this.categorySearch.toLowerCase();return this.categories.filter(t=>t.value.toLowerCase().includes(e))},activeValidationErrors(){return Object.entries(this.validationErrors).filter(([,e])=>e).map(([e,t])=>({field:e,error:t}))}},mounted(){if(this.fetchRiskInstance(),this.fetchBusinessImpacts(),this.fetchCategories(),!document.querySelector('link[href*="font-awesome"]')){const e=document.createElement("link");e.rel="stylesheet",e.href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css",document.head.appendChild(e)}const e=this.$route.query.action;e&&(console.log(`Risk ${this.riskId} action: ${e}`),"reject"===e&&(this.defaultAppetite="NO"),"view"===e&&this.setReadOnlyMode(),"create"===e&&console.log("Create action detected - will prepare for risk creation"))},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},setReadOnlyMode(){this.isReadOnly=!0,setTimeout(()=>{const e=document.querySelector(".risk-scoring-container");e&&e.classList.add("risk-scoring-read-only-mode")},100)},calculateRiskExposureRating(){if(this.editedRiskInstance){if(this.editedRiskInstance.RiskLikelihood&&this.editedRiskInstance.RiskImpact){const e=parseInt(this.editedRiskInstance.RiskLikelihood),t=parseInt(this.editedRiskInstance.RiskImpact);isNaN(e)||isNaN(t)||(this.editedRiskInstance.RiskExposureRating=e*t)}}else this.editedRiskInstance={RiskLikelihood:null,RiskImpact:null}},fetchRiskInstance(){if(this.isCreateAction)return this.editedRiskInstance=this.getDefaultInstance(),this.riskMitigationJson=JSON.stringify({},null,2),this.mitigationForm={actions:[]},void(this.loading=!1);const e=encodeURIComponent(this.riskId);He.A.get(`http://localhost:8000/api/risk-instances/${e}/`).then(e=>{const t={...e.data,RiskTitle:this.sanitize.safeValue(e.data.RiskTitle),RiskDescription:this.sanitize.safeValue(e.data.RiskDescription),Category:this.sanitize.safeValue(e.data.Category),ReportedBy:this.sanitize.safeValue(e.data.ReportedBy),RiskLikelihood:e.data.RiskLikelihood,RiskImpact:e.data.RiskImpact,RiskExposureRating:e.data.RiskExposureRating};if(this.riskInstance=t,this.editedRiskInstance={...this.getDefaultInstance(),...JSON.parse(JSON.stringify(t))},this.editedRiskInstance.RiskMitigation)try{const e="string"===typeof this.editedRiskInstance.RiskMitigation?JSON.parse(this.editedRiskInstance.RiskMitigation):this.editedRiskInstance.RiskMitigation;let t=[];if(e&&"object"===typeof e&&!Array.isArray(e)){const i=Object.keys(e).filter(e=>/^\d+$/.test(e));t=i.sort((e,t)=>parseInt(e)-parseInt(t)).map(t=>this.sanitize.safeValue(e[t]))}this.riskMitigationJson=JSON.stringify(e,null,2),this.mitigationForm={actions:t}}catch(i){this.riskMitigationJson=JSON.stringify({},null,2),this.mitigationForm={actions:[]}}this.loading=!1,this.editedRiskInstance.ComplianceId&&this.fetchMatchingRisks(this.editedRiskInstance.ComplianceId),this.businessImpacts.length>0&&this.editedRiskInstance.BusinessImpact&&this.parseBusinessImpacts();try{const e=JSON.parse(this.riskMitigationJson);this.mitigationForm={actions:Array.isArray(e.actions)?e.actions.map(e=>this.sanitize.safeValue(e)):[]}}catch(i){this.mitigationForm={actions:[]}}}).catch(e=>{console.error("Error fetching risk instance:",e),this.error=this.sanitize.safeValue(`Failed to fetch risk instance: ${e.message}`),this.loading=!1})},fetchMatchingRisks(e){e&&(this.loadingMatchingRisks=!0,He.A.get("http://localhost:8000/api/risks/").then(t=>{console.log("All risks data received:",t.data),this.matchingRisks=t.data.filter(t=>t.ComplianceId&&t.ComplianceId.toString()===e.toString()),console.log("Filtered matching risks:",this.matchingRisks),this.loadingMatchingRisks=!1}).catch(e=>{console.error("Error fetching matching risks:",e),this.loadingMatchingRisks=!1}))},submitForm(){if(!this.validateForm()){const e=Object.entries(this.validationErrors).filter(e=>e[1]).map(e=>this.sanitize.escapeHtml(e[1])).join("\n");return this.$popup.error("Please fix the following validation errors:\n"+e),void this.sendPushNotification({title:"Risk Instance Validation Failed",message:`Validation errors found in risk instance "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}". Please fix the errors and try again.`,category:"risk",priority:"medium",user_id:"default_user"})}this.submitting=!0;let e={};try{if(e=JSON.parse(this.riskMitigationJson),"object"!==typeof e||Array.isArray(e))throw new Error("Risk mitigation must be a valid numbered object");Object.keys(e).forEach(t=>{e[t]=this.sanitize.escapeHtml(e[t])})}catch(a){return this.$popup.error("Invalid Risk Mitigation JSON format. Please check the format and try again."),this.sendPushNotification({title:"Risk Mitigation JSON Error",message:`Invalid JSON format in risk mitigation for risk "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}". Please check the format and try again.`,category:"risk",priority:"medium",user_id:"default_user"}),void(this.submitting=!1)}const t={...this.editedRiskInstance,RiskTitle:this.sanitize.escapeHtml(this.editedRiskInstance.RiskTitle),RiskDescription:this.sanitize.escapeHtml(this.editedRiskInstance.RiskDescription),Category:this.sanitize.escapeHtml(this.editedRiskInstance.Category),RiskMitigation:e,BusinessImpact:this.selectedBusinessImpacts.map(e=>this.sanitize.escapeHtml(e.value)).join(", ")},i=encodeURIComponent(this.riskId);He.A.put(`http://localhost:8000/api/risk-instances/${i}/`,t).then(e=>{this.riskInstance=e.data,this.editedRiskInstance=JSON.parse(JSON.stringify(e.data)),e.data.RiskMitigation&&(this.riskMitigationJson=JSON.stringify(e.data.RiskMitigation,null,2)),this.submitting=!1,this.submitSuccess=!0,this.$popup.success("Risk instance updated successfully!"),this.sendPushNotification({title:"Risk Instance Updated Successfully",message:`Risk instance "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}" has been updated successfully in the Risk module.`,category:"risk",priority:"high",user_id:"default_user"})}).catch(e=>{console.error("Error updating risk instance:",e),this.submitting=!1,this.$popup.error("Failed to update risk instance: "+this.sanitize.escapeHtml(e.response?.data?.message||e.message)),this.sendPushNotification({title:"Risk Instance Update Failed",message:`Failed to update risk instance "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}": ${e.response?.data?.message||e.message}`,category:"risk",priority:"high",user_id:"default_user"})})},formatLabel(e){return e.replace(/([A-Z])/g," $1").trim()},onAppetiteChange(){const e=(this.editedRiskInstance.Appetite||"").toLowerCase();"no"===e?(this.editedRiskInstance.RiskStatus="Rejected",this.editedRiskInstance.Appetite="No",console.log("Appetite set to No: Updated RiskStatus to Rejected")):this.isRejectedAction&&"yes"===e&&(console.log("Warning: Appetite changed from No to Yes in a rejection action"),this.editedRiskInstance.Appetite="Yes")},goBack(){this.$router.push("/risk/scoring"),this.isRejectedAction&&console.log(`Returning to Risk Scoring after rejecting risk ${this.riskId}`)},createRisk(){console.log(`Navigating to Create Risk page from risk ${this.riskId}`),this.$router.push({path:"/risk/create-risk",query:{source_risk_id:this.riskId,return_to:"scoring-details",action:"accept"}})},mapScoringRisk(){console.log(`Mapping scoring risk for risk ${this.riskId}`),this.$popup.info("Mapping scoring risk functionality will be implemented here."),this.sendPushNotification({title:"Risk Mapping Feature",message:`Risk mapping functionality will be implemented for risk "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}".`,category:"risk",priority:"low",user_id:"default_user"})},fillScoringFromSelectedRisk(){if(this.selectedRisks.length>0){const e=this.selectedRisks[0],t=this.matchingRisks.find(t=>t.RiskId===e);t?(this.editedRiskInstance.RiskId=t.RiskId,this.editedRiskInstance.RiskLikelihood=t.RiskLikelihood&&parseInt(t.RiskLikelihood)||1,this.editedRiskInstance.RiskImpact=t.RiskImpact&&parseInt(t.RiskImpact)||1,this.calculateRiskExposureRating(),this.$popup.success("Risk scoring data has been filled from the selected risk."),this.sendPushNotification({title:"Risk Scoring Data Filled",message:`Risk scoring data has been filled from selected risk for "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}".`,category:"risk",priority:"medium",user_id:"default_user"})):(this.$popup.error("Could not find the selected risk data."),this.sendPushNotification({title:"Risk Data Not Found",message:`Could not find the selected risk data for risk "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}".`,category:"risk",priority:"medium",user_id:"default_user"}))}else this.$popup.warning("Please select a risk first."),this.sendPushNotification({title:"No Risk Selected",message:`Please select a risk first to fill scoring data for "${this.editedRiskInstance.RiskTitle||"Untitled Risk"}".`,category:"risk",priority:"low",user_id:"default_user"})},validateField(){return!0},validateAllFields(){return!0},validateResponseData(e){return Array.isArray(e)?e:(console.error("Expected array response, got:",typeof e),[])},async fetchBusinessImpacts(){try{const e=await He.A.get("http://localhost:8000/api/business-impacts/");"success"===e.data.status&&(this.businessImpacts=e.data.data,this.editedRiskInstance&&this.editedRiskInstance.BusinessImpact&&this.parseBusinessImpacts())}catch(e){console.error("Error fetching business impacts:",e)}},parseBusinessImpacts(){if(!this.editedRiskInstance.BusinessImpact)return;const e=this.editedRiskInstance.BusinessImpact.split(",").map(e=>e.trim());e.forEach(e=>{const t=this.businessImpacts.find(t=>t.value.toLowerCase()===e.toLowerCase());t&&!this.selectedBusinessImpacts.some(e=>e.id===t.id)&&this.selectedBusinessImpacts.push(t)})},toggleBusinessImpactDropdown(){this.showBusinessImpactDropdown=!this.showBusinessImpactDropdown,this.showBusinessImpactDropdown?(this.businessImpactSearch="",document.addEventListener("click",this.closeBusinessImpactDropdown)):document.removeEventListener("click",this.closeBusinessImpactDropdown)},closeBusinessImpactDropdown(e){const t=document.querySelector(".risk-scoring-business-impact-dropdown");t&&!t.contains(e.target)&&(this.showBusinessImpactDropdown=!1,document.removeEventListener("click",this.closeBusinessImpactDropdown))},toggleBusinessImpact(e){const t=this.selectedBusinessImpacts.findIndex(t=>t.id===e.id);-1===t?this.selectedBusinessImpacts.push(e):this.selectedBusinessImpacts.splice(t,1),this.editedRiskInstance.BusinessImpact=this.selectedBusinessImpacts.map(e=>e.value).join(", ")},isBusinessImpactSelected(e){return this.selectedBusinessImpacts.some(t=>t.id===e.id)},async addNewBusinessImpact(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newBusinessImpact.trim())try{console.log("Adding new business impact:",this.newBusinessImpact);const e=await He.A.post("http://localhost:8000/api/business-impacts/add/",{value:this.newBusinessImpact.trim()});if("success"!==e.data.status)throw new Error("Failed to add business impact: "+(e.data.message||"Unknown error"));console.log("Successfully added business impact:",e.data.data),this.businessImpacts.push(e.data.data),this.toggleBusinessImpact(e.data.data),this.showAddImpactModal=!1,this.newBusinessImpact=""}catch(t){console.error("Error adding new business impact:",t),this.$popup.error("Failed to add new business impact: "+(t.response?.data?.message||t.message)),this.sendPushNotification({title:"Business Impact Addition Failed",message:`Failed to add new business impact "${this.newBusinessImpact}": ${t.response?.data?.message||t.message}`,category:"risk",priority:"medium",user_id:"default_user"})}},async fetchCategories(){try{const e=await He.A.get("http://localhost:8000/api/risk-categories/");"success"===e.data.status&&(this.categories=e.data.data,this.editedRiskInstance&&this.editedRiskInstance.Category&&(this.selectedCategory=this.editedRiskInstance.Category))}catch(e){console.error("Error fetching categories:",e)}},toggleCategoryDropdown(){this.showCategoryDropdown=!this.showCategoryDropdown,this.showCategoryDropdown&&(this.categorySearch="")},selectCategory(e){this.selectedCategory=e.value,this.editedRiskInstance.Category=e.value,this.showCategoryDropdown=!1},async addNewCategory(e){if(e&&(e.preventDefault(),e.stopPropagation()),this.newCategory.trim())try{console.log("Adding new category:",this.newCategory);const e=await He.A.post("http://localhost:8000/api/risk-categories/add/",{value:this.newCategory.trim()});if("success"!==e.data.status)throw new Error("Failed to add category: "+(e.data.message||"Unknown error"));console.log("Successfully added category:",e.data.data),this.categories.push(e.data.data),this.selectCategory(e.data.data),this.showAddCategoryModal=!1,this.newCategory=""}catch(t){console.error("Error adding new category:",t),this.$popup.error("Failed to add new category: "+(t.response?.data?.message||t.message)),this.sendPushNotification({title:"Category Addition Failed",message:`Failed to add new category "${this.newCategory}": ${t.response?.data?.message||t.message}`,category:"risk",priority:"medium",user_id:"default_user"})}},updateMitigationJson(){const e={};this.mitigationForm.actions.forEach((t,i)=>{""!==t.trim()&&(e[(i+1).toString()]=t)}),this.riskMitigationJson=JSON.stringify(e,null,2)},addAction(){this.mitigationForm.actions.push(""),this.updateMitigationJson()},removeAction(e){this.mitigationForm.actions.splice(e,1),this.updateMitigationJson()},validateChoiceField(e,t,i){return e?i.includes(e)?"":`Invalid ${t}. Must be one of: ${i.join(", ")}`:`${t} is required`},validateNumericField(e,t,i,a){const s=parseInt(e);return isNaN(s)?`${t} must be a number`:s<i||s>a?`${t} must be between ${i} and ${a}`:""},validateTextField(e,t,i=!1){const a=this.sanitize.safeValue(e);return!a&&i?`${t} is required`:a&&!this.validationRules.TEXT_PATTERN.test(a)?`${t} contains invalid characters`:""},validateForm(){return Object.keys(this.validationErrors).forEach(e=>{this.validationErrors[e]=""}),this.validationErrors.Criticality=this.validateChoiceField(this.editedRiskInstance.Criticality,"Criticality",this.validationRules.ALLOWED_CRITICALITY),this.validationErrors.RiskPriority=this.validateChoiceField(this.editedRiskInstance.RiskPriority,"Risk Priority",this.validationRules.ALLOWED_RISK_PRIORITY),this.validationErrors.Origin=this.validateChoiceField(this.editedRiskInstance.Origin,"Origin",this.validationRules.ALLOWED_ORIGIN),this.validationErrors.RiskType=this.validateChoiceField(this.editedRiskInstance.RiskType,"Risk Type",this.validationRules.ALLOWED_RISK_TYPE),this.validationErrors.Appetite=this.validateChoiceField(this.editedRiskInstance.Appetite,"Appetite",this.validationRules.ALLOWED_APPETITE),this.validationErrors.RiskResponseType=this.validateChoiceField(this.editedRiskInstance.RiskResponseType,"Risk Response Type",this.validationRules.ALLOWED_RISK_RESPONSE_TYPE),this.validationErrors.RiskLikelihood=this.validateNumericField(this.editedRiskInstance.RiskLikelihood,"Risk Likelihood",this.validationRules.RISK_LIKELIHOOD_RANGE.min,this.validationRules.RISK_LIKELIHOOD_RANGE.max),this.validationErrors.RiskImpact=this.validateNumericField(this.editedRiskInstance.RiskImpact,"Risk Impact",this.validationRules.RISK_IMPACT_RANGE.min,this.validationRules.RISK_IMPACT_RANGE.max),this.validationErrors.RiskTitle=this.validateTextField(this.editedRiskInstance.RiskTitle,"Risk Title",!0),this.validationErrors.RiskDescription=this.validateTextField(this.editedRiskInstance.RiskDescription,"Risk Description",!0),this.validationErrors.Category=this.validateTextField(this.editedRiskInstance.Category,"Category",!0),!Object.values(this.validationErrors).some(e=>""!==e)},getDefaultInstance(){return{RiskLikelihood:null,RiskImpact:null,RiskStatus:"Not Assigned",RiskType:"Current",Appetite:this.isRejectedAction?"No":"Yes",RiskResponseType:"Mitigate",RiskMitigation:{},BusinessImpact:"",ComplianceId:null,RiskTitle:"",RiskDescription:"",Category:"",Criticality:"",RiskPriority:"",Origin:"",ReportedBy:null}}},watch:{"editedRiskInstance.ComplianceId":function(e){console.log("ComplianceId changed to:",e),this.selectedRisks=[],e?this.fetchMatchingRisks(e):this.matchingRisks=[]}}};const UIe=(0,le.A)(VIe,[["render",xIe]]);var NIe=UIe;const MIe={class:"risk-resolution-container"},XIe={class:"risk-resolution-toggle-buttons"},$Ie={class:"risk-resolution-filters-wrapper"},OIe={class:"risk-resolution-filter-dropdowns"},jIe={key:0,class:"risk-resolution-loading"},BIe={key:1,class:"risk-resolution-error-message"},WIe={key:2,class:"risk-resolution-no-data"},qIe={key:3,class:"risk-resolution-collapsible-container"},QIe={key:4,class:"risk-resolution-mitigation-workflow-section"},KIe={class:"risk-resolution-mitigation-header"},JIe={key:0},zIe={key:1},HIe={class:"risk-resolution-mitigation-body"},GIe={key:0,class:"risk-resolution-loading"},YIe={key:1},ZIe={class:"risk-resolution-risk-summary"},eDe={class:"risk-resolution-risk-details"},tDe={class:"risk-resolution-reviewer-info"},iDe={key:0,class:"risk-resolution-assignment-section"},aDe={class:"risk-resolution-assignment-fields"},sDe={class:"risk-resolution-assignment-field"},oDe=["value"],lDe={key:0,class:"risk-resolution-selected-user-info"},nDe={class:"risk-resolution-assignment-field"},rDe=["value"],cDe={key:0,class:"risk-resolution-selected-user-info"},dDe={class:"risk-resolution-assignment-field"},uDe=["readonly","min"],pDe={class:"risk-resolution-mitigation-workflow"},mDe={key:0,class:"risk-resolution-workflow-timeline"},vDe={class:"risk-resolution-step-number"},kDe={class:"risk-resolution-step-content"},hDe=["onUpdate:modelValue","readonly"],gDe={class:"risk-resolution-step-actions"},yDe=["onClick","disabled"],fDe={key:1,class:"risk-resolution-no-mitigations"},bDe={class:"risk-resolution-add-mitigation"},CDe=["readonly"],LDe=["disabled"],wDe={class:"risk-resolution-mitigation-actions"},EDe=["disabled"];function RDe(e,t,i,o,l,n){const r=(0,s.g2)("PopupModal"),c=(0,s.g2)("Dynamicalsearch"),u=(0,s.g2)("CustomDropdown"),p=(0,s.g2)("CollapsibleTable");return(0,s.uX)(),(0,s.CE)("div",MIe,[(0,s.bF)(r),(0,s.Lk)("div",XIe,[(0,s.Lk)("button",{class:"risk-resolution-toggle-button active",onClick:t[0]||(t[0]=e=>n.navigateTo("resolution"))}," Risk Resolution "),(0,s.Lk)("button",{class:"risk-resolution-toggle-button",onClick:t[1]||(t[1]=e=>n.navigateTo("workflow"))}," Risk Workflow ")]),(0,s.Lk)("div",$Ie,[(0,s.bF)(c,{modelValue:l.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=e=>l.searchQuery=e),placeholder:"Search risks...",onInput:n.filterRisks},null,8,["modelValue","onInput"]),(0,s.Lk)("div",OIe,[(0,s.bF)(u,{config:n.criticalityDropdownConfig,modelValue:l.criticalityFilter,"onUpdate:modelValue":t[3]||(t[3]=e=>l.criticalityFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"]),(0,s.bF)(u,{config:n.statusDropdownConfig,modelValue:l.statusFilter,"onUpdate:modelValue":t[4]||(t[4]=e=>l.statusFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"]),(0,s.bF)(u,{config:n.assignedToDropdownConfig,modelValue:l.assignedToFilter,"onUpdate:modelValue":t[5]||(t[5]=e=>l.assignedToFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"]),(0,s.bF)(u,{config:n.reviewerDropdownConfig,modelValue:l.reviewerFilter,"onUpdate:modelValue":t[6]||(t[6]=e=>l.reviewerFilter=e),onChange:n.filterRisks},null,8,["config","modelValue","onChange"])])]),l.loading?((0,s.uX)(),(0,s.CE)("div",jIe,t[14]||(t[14]=[(0,s.Lk)("div",{class:"risk-resolution-spinner"},null,-1),(0,s.Lk)("span",null,"Loading risk data...",-1)]))):l.error?((0,s.uX)(),(0,s.CE)("div",BIe,(0,d.v_)(l.error),1)):0===l.filteredRisks.length?((0,s.uX)(),(0,s.CE)("div",WIe,t[15]||(t[15]=[(0,s.Lk)("p",null,"No eligible risk instances found for resolution. Either there are no risks with completed scoring, or all scored risks have been rejected.",-1),(0,s.Lk)("p",{class:"risk-resolution-no-data-subtitle"},"Note: Rejected risks are not displayed in Risk Resolution as they don't require further processing.",-1)]))):l.showMitigationModal?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",qIe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.riskSections,(e,t)=>((0,s.uX)(),(0,s.Wv)(p,{key:e.name,"section-config":e,"table-headers":n.tableHeaders,"is-expanded":l.expandedSections[t],onToggle:e=>n.toggleSection(t),onTaskClick:n.openMitigationModal,onAddTask:n.addTaskToSection},null,8,["section-config","table-headers","is-expanded","onToggle","onTaskClick","onAddTask"]))),128))])),l.showMitigationModal?((0,s.uX)(),(0,s.CE)("div",QIe,[(0,s.Lk)("div",KIe,[l.viewOnlyMitigationModal?((0,s.uX)(),(0,s.CE)("h2",JIe,"Viewing Mitigation Steps")):((0,s.uX)(),(0,s.CE)("h2",zIe,"Assign Risk with Mitigation Steps")),(0,s.Lk)("button",{class:"risk-resolution-back-btn",onClick:t[7]||(t[7]=(...e)=>n.closeMitigationModal&&n.closeMitigationModal(...e))},t[16]||(t[16]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Risks ")]))]),(0,s.Lk)("div",HIe,[l.loadingMitigations?((0,s.uX)(),(0,s.CE)("div",GIe,t[17]||(t[17]=[(0,s.Lk)("div",{class:"risk-resolution-spinner"},null,-1),(0,s.Lk)("span",null,"Loading mitigation steps...",-1)]))):((0,s.uX)(),(0,s.CE)("div",YIe,[(0,s.Lk)("div",ZIe,[(0,s.Lk)("h3",null,(0,d.v_)(l.selectedRisk.RiskTitle||"Risk #"+l.selectedRisk.RiskInstanceId),1),(0,s.Lk)("div",eDe,[(0,s.Lk)("p",null,[t[18]||(t[18]=(0,s.Lk)("strong",null,"ID:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedRisk.RiskInstanceId),1)]),(0,s.Lk)("p",null,[t[19]||(t[19]=(0,s.Lk)("strong",null,"Category:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedRisk.Category),1)]),(0,s.Lk)("p",null,[t[20]||(t[20]=(0,s.Lk)("strong",null,"Criticality:",-1)),(0,s.eW)(" "+(0,d.v_)(l.selectedRisk.Criticality),1)]),(0,s.Lk)("p",null,[t[21]||(t[21]=(0,s.Lk)("strong",null,"Reviewer:",-1)),t[22]||(t[22]=(0,s.eW)()),(0,s.Lk)("span",tDe,(0,d.v_)(l.selectedRisk.Reviewer||l.selectedRisk.ReviewerName||"Not Assigned"),1)])])]),l.viewOnlyMitigationModal?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",iDe,[t[28]||(t[28]=(0,s.Lk)("h3",null,"Assign Risk",-1)),(0,s.Lk)("div",aDe,[(0,s.Lk)("div",sDe,[t[24]||(t[24]=(0,s.Lk)("label",null,"Assign To:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[8]||(t[8]=e=>l.selectedUsers[l.selectedRisk.RiskInstanceId]=e),class:"risk-resolution-assignment-dropdown"},[t[23]||(t[23]=(0,s.Lk)("option",{value:""},"Select User",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:n.getUserId(e),value:n.getUserId(e)},(0,d.v_)(n.getUserName(e))+" (ID: "+(0,d.v_)(n.getUserId(e))+") ",9,oDe))),128))],512),[[a.u1,l.selectedUsers[l.selectedRisk.RiskInstanceId]]]),l.selectedUsers[l.selectedRisk.RiskInstanceId]?((0,s.uX)(),(0,s.CE)("div",lDe," Selected User ID: "+(0,d.v_)(l.selectedUsers[l.selectedRisk.RiskInstanceId]),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",nDe,[t[26]||(t[26]=(0,s.Lk)("label",null,"Reviewer:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[9]||(t[9]=e=>l.selectedReviewers[l.selectedRisk.RiskInstanceId]=e),class:"risk-resolution-assignment-dropdown"},[t[25]||(t[25]=(0,s.Lk)("option",{value:""},"Select Reviewer",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.users,e=>((0,s.uX)(),(0,s.CE)("option",{key:n.getUserId(e),value:n.getUserId(e)},(0,d.v_)(n.getUserName(e))+" (ID: "+(0,d.v_)(n.getUserId(e))+") ",9,rDe))),128))],512),[[a.u1,l.selectedReviewers[l.selectedRisk.RiskInstanceId]]]),l.selectedReviewers[l.selectedRisk.RiskInstanceId]?((0,s.uX)(),(0,s.CE)("div",cDe," Selected Reviewer ID: "+(0,d.v_)(l.selectedReviewers[l.selectedRisk.RiskInstanceId]),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",dDe,[t[27]||(t[27]=(0,s.Lk)("label",null,"Due Date for Mitigation:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date","onUpdate:modelValue":t[10]||(t[10]=e=>l.mitigationDueDate=e),class:"risk-resolution-assignment-dropdown",readonly:l.viewOnlyMitigationModal,min:n.getTodayDate()},null,8,uDe),[[a.Jo,l.mitigationDueDate]])])])])),(0,s.Lk)("div",pDe,[t[33]||(t[33]=(0,s.Lk)("h3",null,"Mitigation Steps",-1)),l.mitigationSteps.length?((0,s.uX)(),(0,s.CE)("div",mDe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.mitigationSteps,(e,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"risk-resolution-workflow-step"},[(0,s.Lk)("div",vDe,(0,d.v_)(i+1),1),(0,s.Lk)("div",kDe,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t=>e.description=t,class:"risk-resolution-mitigation-textarea",readonly:l.viewOnlyMitigationModal,placeholder:"Enter mitigation step description"},null,8,hDe),[[a.Jo,e.description]]),(0,s.Lk)("div",gDe,[(0,s.Lk)("button",{onClick:e=>n.removeMitigationStep(i),class:"risk-resolution-remove-step-btn",disabled:l.viewOnlyMitigationModal},t[29]||(t[29]=[(0,s.Lk)("i",{class:"fas fa-trash"},null,-1),(0,s.eW)(" Remove ")]),8,yDe)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",fDe,t[30]||(t[30]=[(0,s.Lk)("p",null,"No mitigation steps defined for this risk. Add steps below.",-1)]))),(0,s.Lk)("div",bDe,[(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>l.newMitigationStep=e),class:"risk-resolution-mitigation-textarea",readonly:l.viewOnlyMitigationModal,placeholder:"Enter a new mitigation step description"},null,8,CDe),[[a.Jo,l.newMitigationStep]]),(0,s.Lk)("button",{onClick:t[12]||(t[12]=(...e)=>n.addMitigationStep&&n.addMitigationStep(...e)),class:"risk-resolution-add-step-btn",disabled:l.viewOnlyMitigationModal||!l.newMitigationStep.trim()},t[31]||(t[31]=[(0,s.Lk)("i",{class:"fas fa-plus"},null,-1),(0,s.eW)(" Add Mitigation Step ")]),8,LDe)]),(0,s.Lk)("div",wDe,[(0,s.Lk)("button",{onClick:t[13]||(t[13]=(...e)=>n.assignRiskWithMitigations&&n.assignRiskWithMitigations(...e)),class:"risk-resolution-submit-mitigations-btn",disabled:l.viewOnlyMitigationModal||0===l.mitigationSteps.length||!l.mitigationDueDate||!l.selectedUsers[l.selectedRisk.RiskInstanceId]||!l.selectedReviewers[l.selectedRisk.RiskInstanceId]},t[32]||(t[32]=[(0,s.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,s.eW)(" Assign with Mitigations ")]),8,EDe)])])]))])])):(0,s.Q3)("",!0)])}var IDe={name:"RiskResolution",components:{CustomDropdown:xa.A,Dynamicalsearch:VG.A,CollapsibleTable:zn,PopupModal:Ck.wA},data(){return{risks:[],filteredRisks:[],users:[],selectedUsers:{},selectedReviewers:{},loading:!0,error:null,showMitigationModal:!1,selectedRisk:{},mitigationSteps:[],newMitigationStep:"",loadingMitigations:!1,mitigationDueDate:"",viewOnlyMitigationModal:!1,searchQuery:"",criticalityFilter:"",statusFilter:"",assignedToFilter:"",reviewerFilter:"",expandedSections:[]}},computed:{uniqueCriticalities(){return[...new Set(this.risks.map(e=>e.Criticality).filter(Boolean))]},uniqueStatuses(){return[...new Set(this.risks.map(e=>e.RiskStatus).filter(Boolean))]},uniqueAssignedUsers(){return[...new Set(this.risks.map(e=>e.RiskOwner&&"System Owner"!==e.RiskOwner&&"System User"!==e.RiskOwner?e.RiskOwner:"Not Assigned"))]},uniqueReviewers(){return[...new Set(this.risks.map(e=>e.ReviewerName||"Not Assigned"))]},tableHeaders(){return[{key:"riskId",label:"RISK ID",width:"80px"},{key:"riskTitle",label:"Risk Title",width:"200px"},{key:"category",label:"Category",width:"120px"},{key:"criticality",label:"Criticality",width:"100px"},{key:"assignedTo",label:"Assigned To",width:"150px"},{key:"reviewer",label:"Reviewer",width:"150px"},{key:"reviewCount",label:"Review Count",width:"100px"},{key:"actions",label:"Action",width:"120px"}]},riskSections(){const e={};return this.filteredRisks.forEach(t=>{const i=t.RiskStatus||"Unknown";e[i]||(e[i]={name:i,statusClass:this.getStatusClass(i),tasks:[]});const a={incidentId:t.RiskInstanceId,riskId:t.RiskInstanceId,riskTitle:t.RiskTitle||"No title",category:t.Category||"N/A",criticality:t.Criticality||"N/A",assignedTo:t.RiskOwner&&"System Owner"!==t.RiskOwner&&"System User"!==t.RiskOwner?t.RiskOwner:"Not Assigned",reviewer:t.Reviewer||t.ReviewerName||"Not Assigned",reviewCount:t.ReviewerCount||0,actions:"assign",originalRisk:t};e[i].tasks.push(a)}),Object.values(e).sort((e,t)=>{const i={Assigned:1,"In Progress":2,Pending:3,Open:4,Completed:5,Closed:6,Rejected:7};return(i[e.name]||999)-(i[t.name]||999)})},criticalityDropdownConfig(){return{label:"Criticality",defaultValue:"All Criticality",values:[{value:"",label:"All Criticality"},...this.uniqueCriticalities.map(e=>({value:e,label:e}))]}},statusDropdownConfig(){return{label:"Status",defaultValue:"All Status",values:[{value:"",label:"All Status"},...this.uniqueStatuses.map(e=>({value:e,label:e}))]}},assignedToDropdownConfig(){return{label:"Assigned To",defaultValue:"All Assigned To",values:[{value:"",label:"All Assigned To"},...this.uniqueAssignedUsers.map(e=>({value:e,label:e}))]}},reviewerDropdownConfig(){return{label:"Reviewer",defaultValue:"All Reviewers",values:[{value:"",label:"All Reviewers"},...this.uniqueReviewers.map(e=>({value:e,label:e}))]}}},mounted(){this.searchQuery="",this.criticalityFilter="",this.statusFilter="",this.assignedToFilter="",this.reviewerFilter="",this.fetchRisks(),this.fetchUsers()},created(){this.filteredRisks=this.risks},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},fetchRisks(){He.A.get("http://localhost:8000/api/risk-instances/").then(e=>{console.log("Risk data received:",e.data),e.data&&e.data.length>0&&e.data.forEach(e=>{console.log(`Risk ID: ${e.RiskInstanceId}, Reviewer: ${e.Reviewer||e.ReviewerName||"None"}, ReviewerId: ${e.ReviewerId||"None"}`)});const t=e.data.filter(e=>{const t=this.hasCompletedScoring(e),i=!this.isRiskRejected(e);return t&&i});console.log(`Filtered ${e.data.length-t.length} risks without complete scoring or rejected status`),this.risks=t,this.filteredRisks=[...t],this.loading=!1,this.initializeExpandedSections()}).catch(e=>{console.error("Error fetching risks:",e),this.error=`Failed to fetch risks: ${e.message}`,this.loading=!1})},fetchUsers(){He.A.get("http://localhost:8000/api/custom-users/").then(e=>{console.log("User data received:",e.data),this.users=e.data,this.users&&this.users.length>0?(console.log(`Loaded ${this.users.length} users successfully`),console.log("Sample user data:",this.users[0]),this.users.forEach(e=>{const t=this.getUserId(e);console.log(`User: ${this.getUserName(e)}, ID: ${t}, Type: ${typeof t}`)})):console.warn("No users found or empty users array returned")}).catch(e=>{console.error("Error fetching users:",e),this.error="Failed to load user data. Please refresh the page or contact support."})},filterRisks(){this.filteredRisks=this.risks.filter(e=>{const t=this.searchQuery.toLowerCase(),i=!this.searchQuery||e.RiskInstanceId&&e.RiskInstanceId.toString().toLowerCase().includes(t)||e.RiskTitle&&e.RiskTitle.toLowerCase().includes(t)||e.Category&&e.Category.toLowerCase().includes(t)||e.Criticality&&e.Criticality.toLowerCase().includes(t)||e.RiskStatus&&e.RiskStatus.toLowerCase().includes(t)||e.RiskDescription&&e.RiskDescription.toLowerCase().includes(t),a=!this.criticalityFilter||e.Criticality===this.criticalityFilter,s=!this.statusFilter||e.RiskStatus===this.statusFilter,o=e.RiskOwner&&"System Owner"!==e.RiskOwner&&"System User"!==e.RiskOwner?e.RiskOwner:"Not Assigned",l=!this.assignedToFilter||o===this.assignedToFilter,n=e.ReviewerName||"Not Assigned",r=!this.reviewerFilter||n===this.reviewerFilter;return i&&a&&s&&l&&r}),console.log(`Applied filters: ${this.filteredRisks.length} risks displayed out of ${this.risks.length} total risks with completed scoring`)},initializeExpandedSections(){this.expandedSections=this.riskSections.map(()=>!0)},toggleSection(e){this.expandedSections[e]=!this.expandedSections[e]},addTaskToSection(e){console.log("Adding task to section:",e)},openMitigationModal(e){let t=e;"object"===typeof e&&null!==e&&(t=e.incidentId);let i=null;for(const a of this.riskSections){const e=a.tasks.find(e=>e.incidentId===t);if(e){i=e.originalRisk;break}}i?(this.selectedRisk=i,this.showMitigationModal=!0,this.loadingMitigations=!0,i.UserId&&(this.selectedUsers[i.RiskInstanceId]=i.UserId),i.ReviewerId&&(this.selectedReviewers[i.RiskInstanceId]=i.ReviewerId),He.A.get(`http://localhost:8000/api/risk-instances/${i.RiskInstanceId}/`).then(e=>{if(console.log("Risk instance data:",e.data),this.selectedRisk=e.data,e.data.RiskMitigation){let i=[];const a=e.data.RiskMitigation;if("string"===typeof a)try{const e=JSON.parse(a);"object"===typeof e&&Object.keys(e).forEach(t=>{i.push({description:e[t],status:"Not Started"})})}catch(t){i=[{description:a,status:"Not Started"}]}else"object"!==typeof a||Array.isArray(a)?Array.isArray(a)&&(i=a.map(e=>({description:"string"===typeof e?e:e.description,status:e.status||"Not Started"}))):Object.keys(a).forEach(e=>{i.push({description:a[e],status:"Not Started"})});this.mitigationSteps=i}else this.mitigationSteps=[];if(this.loadingMitigations=!1,e.data.MitigationDueDate)this.mitigationDueDate=e.data.MitigationDueDate;else{const e=new Date;e.setDate(e.getDate()+7);const t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");this.mitigationDueDate=`${t}-${i}-${a}`}}).catch(e=>{console.error("Error fetching risk instance:",e),this.mitigationSteps=[],this.loadingMitigations=!1;const t=new Date;t.setDate(t.getDate()+7);const i=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");this.mitigationDueDate=`${i}-${a}-${s}`})):console.error("Risk not found for incidentId:",t)},closeMitigationModal(){this.showMitigationModal=!1,this.selectedRisk={},this.mitigationSteps=[],this.newMitigationStep="",this.mitigationDueDate="",this.viewOnlyMitigationModal=!1},parseMitigations(e){if(!e||0===e.length)return[];if(Array.isArray(e)&&e[0]&&e[0].description)return e.map(e=>({description:e.description||e.title||"",status:e.status||"Not Started"}));if(Array.isArray(e))return e.map((e,t)=>({description:"string"===typeof e?e:e.description||e.title||`Step ${t+1}`,status:e.status||"Not Started"}));if("object"===typeof e&&!Array.isArray(e)){const t=[];return Object.keys(e).forEach(i=>{const a=e[i];t.push({description:"string"===typeof a?a:a.description||a.title||`Step ${i}`,status:a.status||"Not Started"})}),t}return"string"===typeof e?[{description:e,status:"Not Started"}]:[]},addMitigationStep(){this.newMitigationStep.trim()&&(this.mitigationSteps.push({description:this.newMitigationStep,status:"Not Started"}),this.newMitigationStep="")},removeMitigationStep(e){this.mitigationSteps.splice(e,1)},assignRiskWithMitigations(){const e=this.selectedRisk.RiskInstanceId,t=this.selectedUsers[e],i=this.selectedReviewers[e];if(!t)return this.$popup.warning("No user selected. Please select a user to assign this risk to."),this.sendPushNotification({title:"Risk Assignment Warning",message:"No user selected for risk assignment. Please select a user to assign this risk to.",category:"risk",priority:"medium",user_id:"default_user"}),void(this.loading=!1);const a=parseInt(t,10),s=parseInt(i,10);if(console.log("Assigning risk with following IDs:",{riskId:e,userId:a,reviewerId:s}),!a||!s||0===this.mitigationSteps.length||!this.mitigationDueDate)return a?s?0===this.mitigationSteps.length?(this.$popup.warning("Please add at least one mitigation step."),void this.sendPushNotification({title:"Risk Assignment Validation Error",message:"Please add at least one mitigation step for risk assignment.",category:"risk",priority:"medium",user_id:"default_user"})):this.mitigationDueDate?void 0:(this.$popup.warning("Please select a due date for mitigation completion."),void this.sendPushNotification({title:"Risk Assignment Validation Error",message:"Please select a due date for mitigation completion.",category:"risk",priority:"medium",user_id:"default_user"})):(this.$popup.warning("Please select a valid reviewer for this risk."),void this.sendPushNotification({title:"Risk Assignment Validation Error",message:"Please select a valid reviewer for this risk.",category:"risk",priority:"medium",user_id:"default_user"})):(this.$popup.warning("Please select a valid user to assign this risk to."),void this.sendPushNotification({title:"Risk Assignment Validation Error",message:"Please select a valid user to assign this risk to.",category:"risk",priority:"medium",user_id:"default_user"}));this.loading=!0;const o={};this.mitigationSteps.forEach((e,t)=>{o[t+1]=e.description}),console.log("Sending mitigation data:",o),console.log("User ID type:",typeof a,"value:",a),console.log("Reviewer ID type:",typeof s,"value:",s);const l={risk_id:parseInt(e,10),UserId:a,mitigations:o,due_date:this.mitigationDueDate,risk_form_details:{}};console.log("Exact payload being sent to risk-assign API:",JSON.stringify(l)),He.A.post("http://localhost:8000/api/risk-assign/",l,{headers:{"Content-Type":"application/json"}}).then(t=>{console.log("Assignment response:",t.data);const i={risk_id:parseInt(e,10),ReviewerId:s,UserId:a,mitigations:o,risk_form_details:{},create_approval_record:!1};return console.log("Exact payload being sent to assign-reviewer API:",JSON.stringify(i)),He.A.post("http://localhost:8000/api/assign-reviewer/",i,{headers:{"Content-Type":"application/json"}})}).then(a=>{console.log("Reviewer assignment response:",a.data);const s=this.risks.findIndex(t=>t.RiskInstanceId===e);if(-1!==s){const e=this.users.find(e=>this.getUserId(e)==t),a=this.users.find(e=>this.getUserId(e)==i);e&&a?(this.risks[s].RiskOwner=this.getUserName(e),this.risks[s].UserId=t,this.risks[s].ReviewerId=Number(i),this.risks[s].ReviewerName=this.getUserName(a),this.risks[s].Reviewer=this.getUserName(a),this.risks[s].RiskStatus="Assigned",this.risks[s].RiskMitigation=o,this.risks[s].MitigationDueDate=this.mitigationDueDate,this.risks[s].MitigationStatus="Yet to Start",this.risks[s].RiskFormDetails={}):console.error("Could not find assigned user or reviewer:",{userId:t,reviewerId:i})}this.loading=!1,this.closeMitigationModal(),this.$popup.success("Risk assigned successfully with mitigation steps and reviewer!"),this.sendPushNotification({title:"Risk Assignment Successful",message:`Risk "${this.selectedRisk.RiskTitle||"Risk #"+this.selectedRisk.RiskInstanceId}" has been successfully assigned with mitigation steps and reviewer.`,category:"risk",priority:"high",user_id:"default_user"})}).catch(e=>{console.error("Error assigning risk:",e),this.loading=!1;let t="Failed to assign risk. ";e.response?(t+=`Server error: ${e.response.status} - ${e.response.data.message||e.response.data||"Unknown error"}`,console.error("Error response data:",e.response.data)):e.request?t+="No response received from server. Please check your network connection.":t+=e.message||"Unknown error occurred",this.$popup.error(t),this.sendPushNotification({title:"Risk Assignment Failed",message:`Failed to assign risk "${this.selectedRisk.RiskTitle||"Risk #"+this.selectedRisk.RiskInstanceId}": ${t}`,category:"risk",priority:"high",user_id:"default_user"})})},getCriticalityClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("high")?"high":t.includes("medium")?"medium":t.includes("low")?"low":t.includes("critical")?"critical":""},getPriorityClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("high")?"high":t.includes("medium")?"medium":t.includes("low")?"low":""},getStatusClass(e){if(!e)return"pending";const t=e.toLowerCase();return t.includes("assigned")||t.includes("in progress")?"in-progress":t.includes("completed")||t.includes("closed")||t.includes("approved")?"completed":t.includes("rejected")?"rejected":(t.includes("pending")||t.includes("open"),"pending")},getRowClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("approved")?"row-approved":t.includes("review")?"row-review":""},getTodayDate(){const e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${a}`},isRiskRejected(e){if(!e)return!1;const t=(e.Appetite||"").toLowerCase(),i=(e.RiskStatus||"").toLowerCase();return"no"===t||"rejected"===i},hasCompletedScoring(e){return!!e&&(void 0!==e.RiskLikelihood&&null!==e.RiskLikelihood&&void 0!==e.RiskImpact&&null!==e.RiskImpact&&void 0!==e.RiskExposureRating&&null!==e.RiskExposureRating)},getUserId(e){if(!e)return"";if(void 0!==e.UserId)return parseInt(e.UserId,10);if(void 0!==e.user_id)return parseInt(e.user_id,10);if(void 0!==e.id)return parseInt(e.id,10);const t=e.id||e.UserId||e.user_id||"";return t?parseInt(t,10):""},getUserName(e){if(!e)return"Unknown User";if(e.UserName)return e.UserName+(e.email?` (${e.email})`:"");if(e.user_name){let t=e.user_name;return(e.department||e.designation)&&(t+=" (",e.department&&(t+=e.department),e.department&&e.designation&&(t+=", "),e.designation&&(t+=e.designation),t+=")"),t}return e.username?e.first_name&&e.last_name?`${e.first_name} ${e.last_name} (${e.username})`:e.username:e.UserName||e.user_name||e.username||e.email||"User "+this.getUserId(e)},navigateTo(e){const t=document.querySelectorAll(".risk-resolution-toggle-button");t.forEach(e=>e.classList.remove("active"));const i=Array.from(t).find(t=>t.textContent.trim().toLowerCase().includes(e));switch(i&&i.classList.add("active"),e){case"resolution":break;case"workflow":this.$router.push("/risk/workflow");break}}}};const DDe=(0,le.A)(IDe,[["render",RDe],["__scopeId","data-v-1ee14dd7"]]);var PDe=DDe;const _De={class:"risk-view-container"},ADe={class:"risk-view-header"},SDe={key:0,class:"risk-view-details-card"},TDe={class:"risk-view-details-top"},xDe={class:"risk-view-id-section"},FDe={class:"risk-view-id-value"},VDe={class:"risk-view-meta"},UDe={class:"risk-view-category"},NDe={class:"risk-view-title-section"},MDe={class:"risk-view-compliance-section"},XDe={class:"risk-view-compliance-value"},$De={class:"risk-view-content"},ODe={class:"risk-view-content-row"},jDe={class:"risk-view-content-column"},BDe={class:"risk-view-section-content"},WDe={class:"risk-view-content-column"},qDe={class:"risk-view-section-content"},QDe={class:"risk-view-content-row"},KDe={class:"risk-view-content-column"},JDe={class:"risk-view-section-content"},zDe={class:"risk-view-content-column"},HDe={class:"risk-view-section-content"},GDe={class:"risk-view-content-row"},YDe={class:"risk-view-content-column"},ZDe={class:"risk-view-section-content"},ePe={class:"risk-view-content-column"},tPe={class:"risk-view-section-content"},iPe={class:"risk-view-content-row"},aPe={class:"risk-view-content-column"},sPe={class:"risk-view-section-content"},oPe={class:"risk-view-content-column"},lPe={class:"risk-view-section-content"},nPe={class:"risk-view-content-row"},rPe={class:"risk-view-content-column"},cPe={class:"risk-view-section-content"},dPe={key:1,class:"risk-view-no-data"};function uPe(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",_De,[(0,s.bF)(n),(0,s.Lk)("div",ADe,[t[2]||(t[2]=(0,s.Lk)("h2",{class:"risk-view-title"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle risk-view-icon"}),(0,s.eW)(" Risk Details")],-1)),(0,s.Lk)("button",{class:"risk-view-back-button",onClick:t[0]||(t[0]=(...e)=>l.goBack&&l.goBack(...e))},t[1]||(t[1]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Risk Register ")]))]),o.risk?((0,s.uX)(),(0,s.CE)("div",SDe,[(0,s.Lk)("div",TDe,[(0,s.Lk)("div",xDe,[t[3]||(t[3]=(0,s.Lk)("span",{class:"risk-view-id-label"},"Risk ID:",-1)),(0,s.Lk)("span",FDe,(0,d.v_)(o.risk.RiskId),1)]),(0,s.Lk)("div",VDe,[(0,s.Lk)("div",UDe,(0,d.v_)(o.risk.Category),1),(0,s.Lk)("div",{class:(0,d.C4)(["risk-view-criticality",l.getCriticalityClass(o.risk.Criticality)])},(0,d.v_)(o.risk.Criticality),3)])]),(0,s.Lk)("div",NDe,[(0,s.Lk)("h3",null,(0,d.v_)(o.risk.RiskTitle),1),(0,s.Lk)("div",MDe,[t[4]||(t[4]=(0,s.Lk)("span",{class:"risk-view-compliance-label"},"Compliance ID:",-1)),(0,s.Lk)("span",XDe,(0,d.v_)(o.risk.ComplianceId||"N/A"),1)])]),(0,s.Lk)("div",$De,[(0,s.Lk)("div",ODe,[(0,s.Lk)("div",jDe,[t[5]||(t[5]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Description:",-1)),(0,s.Lk)("div",BDe,(0,d.v_)(o.risk.RiskDescription||"N/A"),1)]),(0,s.Lk)("div",WDe,[t[6]||(t[6]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Business Impact:",-1)),(0,s.Lk)("div",qDe,(0,d.v_)(o.risk.BusinessImpact||"N/A"),1)])]),(0,s.Lk)("div",QDe,[(0,s.Lk)("div",KDe,[t[7]||(t[7]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Possible Damage:",-1)),(0,s.Lk)("div",JDe,(0,d.v_)(o.risk.PossibleDamage||"N/A"),1)]),(0,s.Lk)("div",zDe,[t[8]||(t[8]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Likelihood:",-1)),(0,s.Lk)("div",HDe,(0,d.v_)(o.risk.RiskLikelihood||"N/A"),1)])]),(0,s.Lk)("div",GDe,[(0,s.Lk)("div",YDe,[t[9]||(t[9]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Impact:",-1)),(0,s.Lk)("div",ZDe,(0,d.v_)(o.risk.RiskImpact||"N/A"),1)]),(0,s.Lk)("div",ePe,[t[10]||(t[10]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Exposure Rating:",-1)),(0,s.Lk)("div",tPe,(0,d.v_)(o.risk.RiskExposureRating||"N/A"),1)])]),(0,s.Lk)("div",iPe,[(0,s.Lk)("div",aPe,[t[11]||(t[11]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Priority:",-1)),(0,s.Lk)("div",sPe,(0,d.v_)(o.risk.RiskPriority||"N/A"),1)]),(0,s.Lk)("div",oPe,[t[12]||(t[12]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Risk Mitigation:",-1)),(0,s.Lk)("div",lPe,(0,d.v_)(o.risk.RiskMitigation||"N/A"),1)])]),(0,s.Lk)("div",nPe,[(0,s.Lk)("div",rPe,[t[13]||(t[13]=(0,s.Lk)("h4",{class:"risk-view-section-title"},"Created At:",-1)),(0,s.Lk)("div",cPe,(0,d.v_)(l.formatDate(o.risk.CreatedAt)),1)]),t[14]||(t[14]=(0,s.Lk)("div",{class:"risk-view-content-column"},null,-1))])])])):((0,s.uX)(),(0,s.CE)("div",dPe," Loading risk details or no risk found... "))])}var pPe={name:"ViewRisk",components:{PopupModal:Ck.wA},data(){return{risk:null}},created(){this.fetchRiskDetails()},methods:{fetchRiskDetails(){const e=this.$route.params.id;e?He.A.get(`http://localhost:8000/api/risks/${e}/`).then(e=>{this.risk=e.data,this.sendPushNotification(this.risk)}).catch(e=>{console.error("Error fetching risk details:",e),this.sendPushNotification({RiskTitle:"Error Loading Risk",message:`Failed to load risk details: ${e.message}`})}):this.$router.push("/risk/riskregister-list")},async sendPushNotification(e){try{const t={title:"Risk Details Viewed",message:`Risk "${e.RiskTitle||"Untitled Risk"}" details have been viewed in the Risk module.`,category:"risk",priority:"medium",user_id:"default_user"},i=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});i.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},getCriticalityClass(e){return e?(e=e.toLowerCase(),"critical"===e?"risk-view-priority-critical":"high"===e?"risk-view-priority-high":"medium"===e?"risk-view-priority-medium":"low"===e?"risk-view-priority-low":""):""},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleDateString()},goBack(){this.$router.push("/risk/riskregister-list")}}};const mPe=(0,le.A)(pPe,[["render",uPe]]);var vPe=mPe;const kPe={class:"instance-view-container"},hPe={class:"instance-view-header"},gPe={key:0,class:"instance-view-details-card"},yPe={class:"instance-view-details-header"},fPe={class:"instance-view-id-section"},bPe={class:"instance-view-id-value"},CPe={class:"instance-view-id-value"},LPe={class:"instance-view-meta"},wPe={class:"instance-view-meta-item"},EPe={class:"instance-view-category-badge"},RPe={class:"instance-view-meta-item"},IPe={class:"instance-view-meta-item"},DPe={class:"instance-view-content"},PPe={class:"instance-view-content-row"},_Pe={class:"instance-view-content-column"},APe={class:"instance-view-section-content"},SPe={class:"instance-view-content-column"},TPe={class:"instance-view-section-content"},xPe={class:"instance-view-content-row"},FPe={class:"instance-view-content-column"},VPe={class:"instance-view-section-content"},UPe={class:"instance-view-content-column"},NPe={class:"instance-view-section-content"},MPe={class:"instance-view-content-row"},XPe={class:"instance-view-content-column"},$Pe={class:"instance-view-section-content"},OPe={class:"instance-view-content-column"},jPe={class:"instance-view-section-content"},BPe={class:"instance-view-content-row"},WPe={class:"instance-view-content-column"},qPe={class:"instance-view-section-content"},QPe={class:"instance-view-content-column"},KPe={class:"instance-view-section-content"},JPe={class:"instance-view-content-row"},zPe={class:"instance-view-content-column"},HPe={class:"instance-view-section-content"},GPe={class:"instance-view-content-column"},YPe={class:"instance-view-section-content"},ZPe={class:"instance-view-content-row"},e_e={class:"instance-view-content-column"},t_e={class:"instance-view-section-content"},i_e={class:"instance-view-content-column"},a_e={class:"instance-view-section-content"},s_e={class:"instance-view-content-row"},o_e={class:"instance-view-content-column"},l_e={class:"instance-view-section-content"},n_e={class:"instance-view-content-column"},r_e={class:"instance-view-section-content"},c_e={key:1,class:"instance-view-no-data"};function d_e(e,t,i,a,o,l){const n=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",kPe,[(0,s.bF)(n),(0,s.Lk)("div",hPe,[t[2]||(t[2]=(0,s.Lk)("h2",{class:"instance-view-title"},[(0,s.Lk)("i",{class:"fas fa-exclamation-triangle instance-view-icon"}),(0,s.eW)(" Risk Instance Details")],-1)),(0,s.Lk)("button",{class:"instance-view-back-button",onClick:t[0]||(t[0]=(...e)=>l.goBack&&l.goBack(...e))},t[1]||(t[1]=[(0,s.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,s.eW)(" Back to Risk Instances ")]))]),o.instance?((0,s.uX)(),(0,s.CE)("div",gPe,[(0,s.Lk)("div",yPe,[(0,s.Lk)("div",fPe,[t[3]||(t[3]=(0,s.Lk)("span",{class:"instance-view-id-label"},"Risk ID:",-1)),(0,s.Lk)("span",bPe,(0,d.v_)(o.instance.RiskId),1),t[4]||(t[4]=(0,s.Lk)("span",{class:"instance-view-id-label"},"Instance ID:",-1)),(0,s.Lk)("span",CPe,(0,d.v_)(o.instance.RiskInstanceId),1)]),(0,s.Lk)("div",LPe,[t[5]||(t[5]=(0,s.Lk)("div",{class:"instance-view-meta-item"},[(0,s.Lk)("span",{class:"instance-view-origin-badge"},"MANUAL")],-1)),(0,s.Lk)("div",wPe,[(0,s.Lk)("span",EPe,(0,d.v_)(o.instance.Category),1)]),(0,s.Lk)("div",RPe,[(0,s.Lk)("span",{class:(0,d.C4)("instance-view-priority-"+o.instance.Criticality.toLowerCase())},(0,d.v_)(o.instance.Criticality),3)]),(0,s.Lk)("div",IPe,[(0,s.Lk)("span",{class:(0,d.C4)("instance-view-status-"+(o.instance.RiskStatus?o.instance.RiskStatus.toLowerCase().replace(/\s+/g,"-"):"open"))},(0,d.v_)(o.instance.RiskStatus||"Open"),3)])])]),(0,s.Lk)("div",DPe,[(0,s.Lk)("div",PPe,[(0,s.Lk)("div",_Pe,[t[6]||(t[6]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Description:",-1)),(0,s.Lk)("div",APe,(0,d.v_)(o.instance.RiskDescription||"Not specified"),1)]),(0,s.Lk)("div",SPe,[t[7]||(t[7]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Category:",-1)),(0,s.Lk)("div",TPe,(0,d.v_)(o.instance.Category||"Not specified"),1)])]),(0,s.Lk)("div",xPe,[(0,s.Lk)("div",FPe,[t[8]||(t[8]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Criticality:",-1)),(0,s.Lk)("div",VPe,(0,d.v_)(o.instance.Criticality||"Not specified"),1)]),(0,s.Lk)("div",UPe,[t[9]||(t[9]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Status:",-1)),(0,s.Lk)("div",NPe,(0,d.v_)(o.instance.RiskStatus||"Open"),1)])]),(0,s.Lk)("div",MPe,[(0,s.Lk)("div",XPe,[t[10]||(t[10]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Possible Damage:",-1)),(0,s.Lk)("div",$Pe,(0,d.v_)(o.instance.PossibleDamage||"Not specified"),1)]),(0,s.Lk)("div",OPe,[t[11]||(t[11]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Risk Appetite:",-1)),(0,s.Lk)("div",jPe,(0,d.v_)(o.instance.Appetite||"Not specified"),1)])]),(0,s.Lk)("div",BPe,[(0,s.Lk)("div",WPe,[t[12]||(t[12]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Likelihood:",-1)),(0,s.Lk)("div",qPe,(0,d.v_)(o.instance.RiskLikelihood||"Not specified"),1)]),(0,s.Lk)("div",QPe,[t[13]||(t[13]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Impact:",-1)),(0,s.Lk)("div",KPe,(0,d.v_)(o.instance.RiskImpact||"Not specified"),1)])]),(0,s.Lk)("div",JPe,[(0,s.Lk)("div",zPe,[t[14]||(t[14]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Exposure Rating:",-1)),(0,s.Lk)("div",HPe,(0,d.v_)(o.instance.RiskExposureRating||"Not specified"),1)]),(0,s.Lk)("div",GPe,[t[15]||(t[15]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Priority:",-1)),(0,s.Lk)("div",YPe,(0,d.v_)(o.instance.RiskPriority||"Not specified"),1)])]),(0,s.Lk)("div",ZPe,[(0,s.Lk)("div",e_e,[t[16]||(t[16]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Response Type:",-1)),(0,s.Lk)("div",t_e,(0,d.v_)(o.instance.RiskResponseType||"Not specified"),1)]),(0,s.Lk)("div",i_e,[t[17]||(t[17]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Response Description:",-1)),(0,s.Lk)("div",a_e,(0,d.v_)(o.instance.RiskResponseDescription||"Not specified"),1)])]),(0,s.Lk)("div",s_e,[(0,s.Lk)("div",o_e,[t[18]||(t[18]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Mitigation:",-1)),(0,s.Lk)("div",l_e,(0,d.v_)(o.instance.RiskMitigation||"Not specified"),1)]),(0,s.Lk)("div",n_e,[t[19]||(t[19]=(0,s.Lk)("h4",{class:"instance-view-section-title"},"Risk Owner:",-1)),(0,s.Lk)("div",r_e,(0,d.v_)(o.instance.RiskOwner||"Not assigned"),1)])])])])):((0,s.uX)(),(0,s.CE)("div",c_e," Loading instance details or no instance found... "))])}var u_e={name:"ViewInstance",components:{PopupModal:Ck.wA},data(){return{instance:null}},created(){this.fetchInstanceDetails()},methods:{async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},fetchInstanceDetails(){const e=this.$route.params.id;e?He.A.get(`http://localhost:8000/api/risk-instances/${e}/`).then(e=>{this.instance=e.data,this.sendPushNotification({title:"Risk Instance Viewed",message:`Risk instance "${e.data.RiskId||"Unknown Risk"}" has been viewed in the Risk module.`,category:"risk",priority:"medium",user_id:"default_user"})}).catch(t=>{console.error("Error fetching risk instance details:",t),this.sendPushNotification({title:"Risk Instance View Failed",message:`Failed to load risk instance details: ${t.response?.data?.error||t.message}`,category:"risk",priority:"high",user_id:"default_user"}),this.tryAlternativeEndpoint(e)}):this.$router.push("/risk/riskinstances-list")},tryAlternativeEndpoint(e){He.A.get(`http://localhost:8000/risk-instances/${e}/`).then(e=>{this.instance=e.data,this.sendPushNotification({title:"Risk Instance Viewed",message:`Risk instance "${e.data.RiskId||"Unknown Risk"}" has been viewed via alternative endpoint.`,category:"risk",priority:"medium",user_id:"default_user"})}).catch(e=>{console.error("Error with alternative endpoint:",e),this.sendPushNotification({title:"Risk Instance View Failed",message:`Failed to load risk instance details via alternative endpoint: ${e.response?.data?.error||e.message}`,category:"risk",priority:"high",user_id:"default_user"})})},goBack(){this.$router.push("/risk/riskinstances-list")}}};const p_e=(0,le.A)(u_e,[["render",d_e]]);var m_e=p_e;const v_e={class:"login-page"},k_e={class:"login-panel"},h_e={class:"login-container"},g_e={class:"form-group"},y_e={class:"form-group"},f_e={class:"input-wrapper"},b_e=["type"],C_e={key:0,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye"},L_e={key:1,xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",class:"feather feather-eye-off"},w_e={key:0,class:"error-message"};var E_e={__name:"LoginView",setup(e){const t=(0,ie.KR)(""),i=(0,ie.KR)(""),o=(0,ie.KR)(""),l=(0,ae.rd)(),n=(0,ie.KR)("password"),r=async()=>{try{if(o.value="",!t.value||!i.value)return void(o.value="Username and password are required");localStorage.clear();const e=await He.A.post("/api/login/",{username:t.value,password:i.value});e.data&&e.data.user?(localStorage.setItem("isAuthenticated","true"),localStorage.setItem("user",JSON.stringify(e.data.user)),localStorage.setItem("user_id",e.data.user.id.toString()),localStorage.setItem("user_email",e.data.user.email),localStorage.setItem("user_name",e.data.user.username),localStorage.setItem("user_full_name",`${e.data.user.firstName} ${e.data.user.lastName}`),localStorage.setItem("is_logged_in","true"),console.log("🔐 Login successful! Session created:",{user_id:e.data.user.id,email:e.data.user.email,username:e.data.user.username}),window.dispatchEvent(new Event("authChanged")),l.push("/home")):o.value="Invalid response from server"}catch(e){e.response&&e.response.data?o.value=e.response.data.message||"Invalid credentials":o.value="Connection error. Please check if the server is running.",console.error("❌ Login error:",e)}},c=()=>{n.value="password"===n.value?"text":"password"};return(e,l)=>((0,s.uX)(),(0,s.CE)("div",v_e,[(0,s.Lk)("div",k_e,[(0,s.Lk)("div",h_e,[l[8]||(l[8]=(0,s.Lk)("h2",{class:"title"},"Login",-1)),l[9]||(l[9]=(0,s.Lk)("p",{class:"subtitle"},"Enter your account details",-1)),(0,s.Lk)("form",{onSubmit:(0,a.D$)(r,["prevent"])},[(0,s.Lk)("div",g_e,[l[2]||(l[2]=(0,s.Lk)("label",{for:"username"},"Username",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":l[0]||(l[0]=e=>t.value=e),required:""},null,512),[[a.Jo,t.value]])]),(0,s.Lk)("div",y_e,[l[5]||(l[5]=(0,s.Lk)("label",{for:"password"},"Password",-1)),(0,s.Lk)("div",f_e,[(0,s.bo)((0,s.Lk)("input",{type:n.value,id:"password","onUpdate:modelValue":l[1]||(l[1]=e=>i.value=e),required:""},null,8,b_e),[[a.hp,i.value]]),(0,s.Lk)("span",{onClick:c,class:"password-toggle"},["password"===n.value?((0,s.uX)(),(0,s.CE)("svg",C_e,l[3]||(l[3]=[(0,s.Lk)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"},null,-1),(0,s.Lk)("circle",{cx:"12",cy:"12",r:"3"},null,-1)]))):((0,s.uX)(),(0,s.CE)("svg",L_e,l[4]||(l[4]=[(0,s.Lk)("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"},null,-1),(0,s.Lk)("line",{x1:"1",y1:"1",x2:"23",y2:"23"},null,-1)])))])])]),l[6]||(l[6]=(0,s.Lk)("a",{href:"#",class:"forgot-password"},"Forgot Password?",-1)),l[7]||(l[7]=(0,s.Lk)("button",{type:"submit"},"Login",-1))],32),l[10]||(l[10]=(0,s.Lk)("div",{class:"signup-prompt"},[(0,s.Lk)("p",null,"Don't have an account?"),(0,s.Lk)("button",{class:"signup-button"},"Sign up")],-1)),o.value?((0,s.uX)(),(0,s.CE)("p",w_e,(0,d.v_)(o.value),1)):(0,s.Q3)("",!0)])]),l[11]||(l[11]=(0,s.Fv)('<div class="welcome-panel" data-v-12e52469><div class="welcome-content" data-v-12e52469><h2 data-v-12e52469>Welcome to the GRC Platform for XYZ Bank</h2><p data-v-12e52469>Streamlining Governance, Risk, and Compliance for XYZ Bank.</p><div class="features" data-v-12e52469><div class="feature-item" data-v-12e52469><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-12e52469><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" data-v-12e52469></path><path d="m9 12 2 2 4-4" data-v-12e52469></path></svg><span data-v-12e52469>Secure &amp; Compliant</span></div><div class="feature-item" data-v-12e52469><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-12e52469><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-12e52469></path><polyline points="14 2 14 8 20 8" data-v-12e52469></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-12e52469></line><line x1="16" y1="17" x2="8" y2="17" data-v-12e52469></line></svg><span data-v-12e52469>Insightful Reporting</span></div><div class="feature-item" data-v-12e52469><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-12e52469><line x1="12" y1="20" x2="12" y2="10" data-v-12e52469></line><line x1="18" y1="20" x2="18" y2="4" data-v-12e52469></line><line x1="6" y1="20" x2="6" y2="16" data-v-12e52469></line></svg><span data-v-12e52469>Risk Analytics</span></div><div class="feature-item" data-v-12e52469><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feature-icon" data-v-12e52469><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" data-v-12e52469></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1" data-v-12e52469></rect><line x1="9" y1="15" x2="15" y2="15" data-v-12e52469></line><line x1="9" y1="11" x2="15" y2="11" data-v-12e52469></line></svg><span data-v-12e52469>Audit Management</span></div></div></div></div>',1))]))}};const R_e=(0,le.A)(E_e,[["__scopeId","data-v-12e52469"]]);var I_e=R_e;const D_e={class:"home-container"},P_e={class:"main-header"},__e={class:"main-nav"},A_e={class:"main-content"},S_e={class:"hero-section"},T_e={class:"hero-text"},x_e={class:"card chart-card"},F_e={class:"card chart-card"};var V_e={__name:"HomeView",setup(e){Ze.t1.register(Ze.hE,Ze.m_,Ze.s$,Ze.E8,Ze.PP,Ze.kc,Ze.FN,Ze.No);const t=(0,ae.rd)(),i=(0,ie.KR)(null),a=(0,ie.KR)({totalPolicies:0,totalIncidents:0,totalRisks:0,totalCompliances:0}),o=()=>{a.value={totalPolicies:0,totalIncidents:0,totalRisks:0,totalCompliances:0}},l=(0,ie.KR)({labels:["January","February","March","April","May","June","July"],datasets:[{label:"Incidents",backgroundColor:"#6a5acd",borderColor:"#6a5acd",data:[40,39,10,40,39,80,40],tension:.4}]}),n=(0,ie.KR)({labels:["IT","Finance","HR","Operations","Marketing"],datasets:[{label:"Compliance Status",backgroundColor:["#6a5acd","#7b6bd2","#8c7cd7","#9d8ddc","#aea0e1"],data:[95,80,60,90,75]}]}),r={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0}}},c=async()=>{try{await He.A.post("/api/logout/"),localStorage.clear(),window.dispatchEvent(new Event("authChanged")),t.push("/login")}catch(e){console.error("Logout error:",e),localStorage.clear(),window.dispatchEvent(new Event("authChanged")),t.push("/login")}};return(0,s.sV)(()=>{const e=localStorage.getItem("user");e&&(i.value=JSON.parse(e)),o()}),(e,t)=>{const i=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("div",D_e,[(0,s.Lk)("header",P_e,[t[6]||(t[6]=(0,s.Lk)("div",{class:"logo"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,s.Lk)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})]),(0,s.Lk)("span",null,"GRC Platform")],-1)),(0,s.Lk)("nav",__e,[(0,s.bF)(i,{to:{name:"home"},class:"active"},{default:(0,s.k6)(()=>t[0]||(t[0]=[(0,s.eW)("Dashboard")])),_:1,__:[0]}),(0,s.bF)(i,{to:{name:"PolicyDashboard"}},{default:(0,s.k6)(()=>t[1]||(t[1]=[(0,s.eW)("Policies")])),_:1,__:[1]}),(0,s.bF)(i,{to:{name:"ComplianceDashboard"}},{default:(0,s.k6)(()=>t[2]||(t[2]=[(0,s.eW)("Compliance")])),_:1,__:[2]}),(0,s.bF)(i,{to:{name:"RiskDashboard"}},{default:(0,s.k6)(()=>t[3]||(t[3]=[(0,s.eW)("Risk")])),_:1,__:[3]}),(0,s.bF)(i,{to:{name:"AuditorDashboard"}},{default:(0,s.k6)(()=>t[4]||(t[4]=[(0,s.eW)("Audits")])),_:1,__:[4]}),(0,s.bF)(i,{to:{name:"IncidentDashboard"}},{default:(0,s.k6)(()=>t[5]||(t[5]=[(0,s.eW)("Incidents")])),_:1,__:[5]})]),(0,s.Lk)("button",{onClick:c,class:"logout-btn"},"Logout")]),(0,s.Lk)("main",A_e,[(0,s.Lk)("section",S_e,[(0,s.Lk)("div",T_e,[t[7]||(t[7]=(0,s.Lk)("h1",null,"Unified GRC at Your Fingertips",-1)),t[8]||(t[8]=(0,s.Lk)("p",null," Experience the future of Governance, Risk, and Compliance with a unified platform designed for agility, accuracy, and efficiency. Our GRC solution empowers XYZ Bank to seamlessly manage audits, assess risks, enforce compliance, and monitor policies — all from a single intuitive interface. ",-1)),t[9]||(t[9]=(0,s.Lk)("p",null," Secure. Scalable. Smart. Your unified GRC system is now just a login away. ",-1)),(0,s.Lk)("div",x_e,[(0,s.bF)((0,ie.R1)(et.yP),{data:n.value,options:r},null,8,["data"])])]),t[10]||(t[10]=(0,s.Lk)("div",{class:"card metrics-card"},[(0,s.Lk)("div",{class:"logo-title"},[(0,s.Lk)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[(0,s.Lk)("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"})]),(0,s.Lk)("span",null,"GRC Platform")]),(0,s.Lk)("h2",null,"42% decrease in compliance breaches"),(0,s.Lk)("p",null,"Public does not participate in payment for order flow as a source of revenue.")],-1)),(0,s.Lk)("div",F_e,[(0,s.bF)((0,ie.R1)(et.N1),{data:l.value,options:r},null,8,["data"])])]),t[11]||(t[11]=(0,s.Fv)('<footer class="stats-footer" data-v-808328e2><div class="stat-item" data-v-808328e2><div class="stat-header" data-v-808328e2><span class="stat-value" data-v-808328e2>39,000+</span><div class="stat-icon-wrapper" data-v-808328e2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stat-icon" data-v-808328e2><line x1="6" y1="3" x2="6" y2="15" data-v-808328e2></line><circle cx="18" cy="6" r="3" data-v-808328e2></circle><circle cx="6" cy="18" r="3" data-v-808328e2></circle><path d="M18 9a9 9 0 0 1-9 9" data-v-808328e2></path></svg></div></div><p data-v-808328e2>• Policies ready to be connected</p></div><div class="stat-item" data-v-808328e2><div class="stat-header" data-v-808328e2><span class="stat-value" data-v-808328e2>180M+</span><div class="stat-icon-wrapper" data-v-808328e2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stat-icon" data-v-808328e2><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" data-v-808328e2></path><circle cx="12" cy="7" r="4" data-v-808328e2></circle></svg></div></div><p data-v-808328e2>• Happy global client</p></div><div class="stat-item" data-v-808328e2><div class="stat-header" data-v-808328e2><span class="stat-value" data-v-808328e2>5.00</span><div class="stat-icon-wrapper" data-v-808328e2><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="stat-icon" data-v-808328e2><path d="M12 2 L14.5 9.5 L22 12 L14.5 14.5 L12 22 L9.5 14.5 L2 12 L9.5 9.5 Z" data-v-808328e2></path></svg></div></div><p data-v-808328e2>• 10k+ rating</p></div></footer>',1))])])}}};const U_e=(0,le.A)(V_e,[["__scopeId","data-v-808328e2"]]);var N_e=U_e;const M_e={class:"user-profile-container"},X_e={class:"tabs"},$_e=["onClick"],O_e={class:"tab-label"},j_e={class:"tab-content"},B_e={key:0,class:"account-section"},W_e={key:0,class:"message error-message"},q_e={key:1,class:"message success-message"},Q_e={class:"account-type-selector"},K_e={class:"account-container"},J_e={key:0,class:"account-section-content"},z_e={class:"form-group"},H_e=["disabled"],G_e={class:"form-group"},Y_e=["disabled"],Z_e={class:"form-group"},eAe=["disabled"],tAe={class:"form-group"},iAe=["disabled"],aAe={class:"form-row center"},sAe=["disabled"],oAe={key:0,class:"fas fa-spinner fa-spin"},lAe={key:1,class:"fas fa-save"},nAe={key:1,class:"account-section-content"},rAe={class:"form-group"},cAe={class:"form-group"},dAe=["value"],uAe={class:"form-group"},pAe=["value"],mAe={class:"form-group"},vAe={class:"form-group"},kAe={class:"permissions-section"},hAe={key:0,class:"user-role"},gAe={class:"role-badge"},yAe={key:1,class:"no-permissions"},fAe={key:2,class:"permissions-container"},bAe=["onClick"],CAe={class:"module-name"},LAe={key:0,class:"module-permissions"},wAe={class:"permission-name"},EAe={key:1},RAe={class:"profile-form"},IAe={class:"form-row"},DAe={key:2},PAe={key:0,class:"message error-message"},_Ae={key:1,class:"message success-message"},AAe={class:"form-row password-row"},SAe=["disabled"],TAe=["disabled"],xAe={class:"form-row password-row"},FAe=["disabled"],VAe={class:"form-row password-row"},UAe=["disabled"],NAe={class:"form-row password-row"},MAe=["disabled"],XAe={class:"form-row password-submit-row"},$Ae=["disabled"],OAe={key:0,class:"fas fa-spinner fa-spin"},jAe={key:1,class:"fas fa-paper-plane"},BAe={key:3},WAe={class:"notification-settings"},qAe={class:"notif-dropdown-section"},QAe={class:"notif-dropdown-arrow"},KAe={key:0,class:"notif-dropdown-content"},JAe={class:"notif-form-row"},zAe={class:"notif-dropdown-section"},HAe={class:"notif-dropdown-arrow"},GAe={key:0,class:"notif-dropdown-content"},YAe={class:"notif-form-row"};function ZAe(e,t,i,o,l,n){return(0,s.uX)(),(0,s.CE)("div",M_e,[(0,s.Lk)("div",X_e,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.tabs,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.key,class:(0,d.C4)(["tab-btn",{active:l.activeTab===e.key}]),onClick:t=>l.activeTab=e.key},[(0,s.Lk)("i",{class:(0,d.C4)([e.icon,"tab-icon"])},null,2),(0,s.Lk)("span",O_e,(0,d.v_)(e.label),1)],10,$_e))),128))]),(0,s.Lk)("div",j_e,["account"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",B_e,[l.error?((0,s.uX)(),(0,s.CE)("div",W_e,[t[28]||(t[28]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.error),1)])):(0,s.Q3)("",!0),l.success?((0,s.uX)(),(0,s.CE)("div",q_e,[t[29]||(t[29]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.success),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",Q_e,[(0,s.Lk)("button",{class:(0,d.C4)(["selector-btn",{active:"personal"===l.accountInfoType}]),onClick:t[0]||(t[0]=e=>l.accountInfoType="personal")},t[30]||(t[30]=[(0,s.Lk)("i",{class:"fas fa-user"},null,-1),(0,s.eW)(" Personal Information ")]),2),(0,s.Lk)("button",{class:(0,d.C4)(["selector-btn",{active:"business"===l.accountInfoType}]),onClick:t[1]||(t[1]=e=>l.accountInfoType="business")},t[31]||(t[31]=[(0,s.Lk)("i",{class:"fas fa-building"},null,-1),(0,s.eW)(" Business Information ")]),2)]),(0,s.Lk)("div",K_e,["personal"===l.accountInfoType?((0,s.uX)(),(0,s.CE)("div",J_e,[(0,s.Lk)("form",{class:"profile-form",onSubmit:t[6]||(t[6]=(0,a.D$)((...e)=>n.savePersonalInfo&&n.savePersonalInfo(...e),["prevent"]))},[t[36]||(t[36]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-user"}),(0,s.eW)(" Personal Information")],-1)),t[37]||(t[37]=(0,s.Lk)("p",{class:"section-helper"},"Update your personal details and contact information.",-1)),(0,s.Lk)("div",z_e,[t[32]||(t[32]=(0,s.Lk)("label",null,"First Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=e=>l.form.firstName=e),disabled:l.loading},null,8,H_e),[[a.Jo,l.form.firstName]])]),(0,s.Lk)("div",G_e,[t[33]||(t[33]=(0,s.Lk)("label",null,"Last Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=e=>l.form.lastName=e),disabled:l.loading},null,8,Y_e),[[a.Jo,l.form.lastName]])]),(0,s.Lk)("div",Z_e,[t[34]||(t[34]=(0,s.Lk)("label",null,"Email:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":t[4]||(t[4]=e=>l.form.email=e),disabled:l.loading},null,8,eAe),[[a.Jo,l.form.email]])]),(0,s.Lk)("div",tAe,[t[35]||(t[35]=(0,s.Lk)("label",null,"Phone Number:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=e=>l.form.phone=e),disabled:l.loading},null,8,iAe),[[a.Jo,l.form.phone]])]),(0,s.Lk)("div",aAe,[(0,s.Lk)("button",{class:"submit-btn",type:"submit",disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("i",oAe)):((0,s.uX)(),(0,s.CE)("i",lAe)),(0,s.eW)(" "+(0,d.v_)(l.loading?"Saving...":"Save Personal Info"),1)],8,sAe)])],32)])):(0,s.Q3)("",!0),"business"===l.accountInfoType?((0,s.uX)(),(0,s.CE)("div",nAe,[(0,s.Lk)("form",{class:"profile-form",onSubmit:t[10]||(t[10]=(0,a.D$)((...e)=>n.saveBusinessInfo&&n.saveBusinessInfo(...e),["prevent"]))},[t[45]||(t[45]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-building"}),(0,s.eW)(" Business Information")],-1)),t[46]||(t[46]=(0,s.Lk)("p",{class:"section-helper"},"View your organizational details and business unit information.",-1)),(0,s.Lk)("div",rAe,[t[38]||(t[38]=(0,s.Lk)("label",null,"Department:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=e=>l.businessInfo.departmentName=e),disabled:""},null,512),[[a.Jo,l.businessInfo.departmentName]])]),(0,s.Lk)("div",cAe,[t[39]||(t[39]=(0,s.Lk)("label",null,"Business Unit:",-1)),(0,s.Lk)("input",{type:"text",value:l.businessInfo.businessUnitName+" ("+l.businessInfo.businessUnitCode+")",disabled:""},null,8,dAe)]),(0,s.Lk)("div",uAe,[t[40]||(t[40]=(0,s.Lk)("label",null,"Entity:",-1)),(0,s.Lk)("input",{type:"text",value:l.businessInfo.entityName+" - "+l.businessInfo.entityType,disabled:""},null,8,pAe)]),(0,s.Lk)("div",mAe,[t[41]||(t[41]=(0,s.Lk)("label",null,"Location:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[8]||(t[8]=e=>l.businessInfo.location=e),disabled:""},null,512),[[a.Jo,l.businessInfo.location]])]),(0,s.Lk)("div",vAe,[t[42]||(t[42]=(0,s.Lk)("label",null,"Department Head:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=e=>l.businessInfo.departmentHead=e),disabled:""},null,512),[[a.Jo,l.businessInfo.departmentHead]])]),(0,s.Lk)("div",kAe,[t[44]||(t[44]=(0,s.Lk)("h3",{class:"section-subtitle"},[(0,s.Lk)("i",{class:"fas fa-user-shield"}),(0,s.eW)(" Role & Permissions")],-1)),l.userPermissions.role?((0,s.uX)(),(0,s.CE)("div",hAe,[(0,s.Lk)("span",gAe,(0,d.v_)(l.userPermissions.role),1)])):(0,s.Q3)("",!0),l.userPermissions.modules&&0!==Object.keys(l.userPermissions.modules).length?((0,s.uX)(),(0,s.CE)("div",fAe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(l.userPermissions.modules,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"permission-module"},[(0,s.Lk)("div",{class:"module-header",onClick:e=>n.toggleModulePermissions(t)},[(0,s.Lk)("span",CAe,[(0,s.Lk)("i",{class:(0,d.C4)(n.getModuleIcon(t))},null,2),(0,s.eW)(" "+(0,d.v_)(n.formatModuleName(t)),1)]),(0,s.Lk)("i",{class:(0,d.C4)(l.expandedModules.includes(t)?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)],8,bAe),(0,s.bF)(a.eB,{name:"fade"},{default:(0,s.k6)(()=>[l.expandedModules.includes(t)?((0,s.uX)(),(0,s.CE)("div",LAe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e,(e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"permission-item"},[(0,s.Lk)("span",wAe,(0,d.v_)(n.formatPermissionName(t)),1),(0,s.Lk)("span",{class:(0,d.C4)(["permission-value",e?"allowed":"denied"])},[(0,s.Lk)("i",{class:(0,d.C4)(e?"fas fa-check":"fas fa-times")},null,2)],2)]))),128))])):(0,s.Q3)("",!0)]),_:2},1024)]))),128))])):((0,s.uX)(),(0,s.CE)("div",yAe,t[43]||(t[43]=[(0,s.Lk)("p",null,"No permissions assigned.",-1)])))])],32)])):(0,s.Q3)("",!0)])])):"role"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",EAe,[(0,s.Lk)("form",RAe,[t[49]||(t[49]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-exchange-alt"}),(0,s.eW)(" Role Management")],-1)),t[50]||(t[50]=(0,s.Lk)("p",{class:"section-helper"},"View or request changes to your user role. Role changes may require approval from an administrator.",-1)),(0,s.Lk)("div",IAe,[t[47]||(t[47]=(0,s.Lk)("label",null,"User Name:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[11]||(t[11]=e=>l.form.username=e)},null,512),[[a.Jo,l.form.username]]),t[48]||(t[48]=(0,s.Lk)("label",null,"Role:",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[12]||(t[12]=e=>l.form.role=e)},null,512),[[a.Jo,l.form.role]])]),t[51]||(t[51]=(0,s.Lk)("div",{class:"form-row center"},[(0,s.Lk)("button",{class:"submit-btn",type:"button"},[(0,s.Lk)("i",{class:"fas fa-check"}),(0,s.eW)(" Request Role Change ")])],-1))])])):"password"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",DAe,[(0,s.Lk)("form",{class:"profile-form password-form",onSubmit:t[17]||(t[17]=(0,a.D$)((...e)=>n.updatePassword&&n.updatePassword(...e),["prevent"]))},[t[59]||(t[59]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-key"}),(0,s.eW)(" Change Your Password")],-1)),t[60]||(t[60]=(0,s.Lk)("p",{class:"section-helper"},"For your security, please enter your email and a new password. You will need to verify with an OTP sent to your registered email or phone.",-1)),l.error?((0,s.uX)(),(0,s.CE)("div",PAe,[t[52]||(t[52]=(0,s.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.error),1)])):(0,s.Q3)("",!0),l.success?((0,s.uX)(),(0,s.CE)("div",_Ae,[t[53]||(t[53]=(0,s.Lk)("i",{class:"fas fa-check-circle"},null,-1)),(0,s.eW)(" "+(0,d.v_)(l.success),1)])):(0,s.Q3)("",!0),(0,s.Lk)("div",AAe,[t[55]||(t[55]=(0,s.Lk)("label",null,"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":t[13]||(t[13]=e=>l.form.email=e),placeholder:"Enter your email address",disabled:l.loading},null,8,SAe),[[a.Jo,l.form.email]]),(0,s.Lk)("button",{class:"verify-btn",type:"button",disabled:l.loading},t[54]||(t[54]=[(0,s.Lk)("i",{class:"fas fa-shield-alt"},null,-1),(0,s.eW)(" Verify ")]),8,TAe)]),(0,s.Lk)("div",xAe,[t[56]||(t[56]=(0,s.Lk)("label",null,"Enter OTP",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[14]||(t[14]=e=>l.form.otp=e),placeholder:"Enter OTP",disabled:l.loading},null,8,FAe),[[a.Jo,l.form.otp]])]),(0,s.Lk)("div",VAe,[t[57]||(t[57]=(0,s.Lk)("label",null,"New Password",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password","onUpdate:modelValue":t[15]||(t[15]=e=>l.form.newPassword=e),placeholder:"Enter new password",disabled:l.loading},null,8,UAe),[[a.Jo,l.form.newPassword]])]),(0,s.Lk)("div",NAe,[t[58]||(t[58]=(0,s.Lk)("label",null,"Confirm Password",-1)),(0,s.bo)((0,s.Lk)("input",{type:"password","onUpdate:modelValue":t[16]||(t[16]=e=>l.form.confirmPassword=e),placeholder:"Re-enter new password",disabled:l.loading},null,8,MAe),[[a.Jo,l.form.confirmPassword]])]),(0,s.Lk)("div",XAe,[(0,s.Lk)("button",{class:"submit-btn",type:"submit",style:{width:"100%","max-width":"320px"},disabled:l.loading},[l.loading?((0,s.uX)(),(0,s.CE)("i",OAe)):((0,s.uX)(),(0,s.CE)("i",jAe)),(0,s.eW)(" "+(0,d.v_)(l.loading?"Updating...":"Update Password"),1)],8,$Ae)])],32)])):"notification"===l.activeTab?((0,s.uX)(),(0,s.CE)("div",BAe,[(0,s.Lk)("div",WAe,[t[69]||(t[69]=(0,s.Lk)("h2",{class:"section-title"},[(0,s.Lk)("i",{class:"fas fa-bell"}),(0,s.eW)(" Notification Preferences")],-1)),t[70]||(t[70]=(0,s.Lk)("p",{class:"section-helper"},"Manage how you receive notifications and update your contact details for alerts.",-1)),(0,s.Lk)("div",qAe,[(0,s.Lk)("div",{class:"notification-row notif-dropdown-toggle",onClick:t[20]||(t[20]=e=>l.notifDropdownOpen="email"===l.notifDropdownOpen?null:"email")},[t[62]||(t[62]=(0,s.Lk)("span",{style:{display:"flex","align-items":"center",gap:"10px"}},[(0,s.Lk)("i",{class:"fas fa-envelope"}),(0,s.eW)(" Email Notification updates ")],-1)),(0,s.Lk)("label",{class:"switch",onClick:t[19]||(t[19]=(0,a.D$)(()=>{},["stop"]))},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=e=>l.form.emailNotif=e)},null,512),[[a.lH,l.form.emailNotif]]),t[61]||(t[61]=(0,s.Lk)("span",{class:"slider"},null,-1))]),(0,s.Lk)("span",QAe,[(0,s.Lk)("i",{class:(0,d.C4)("email"===l.notifDropdownOpen?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)])]),(0,s.bF)(a.eB,{name:"fade"},{default:(0,s.k6)(()=>["email"===l.notifDropdownOpen?((0,s.uX)(),(0,s.CE)("div",KAe,[(0,s.Lk)("form",{class:"notif-change-form",onSubmit:t[22]||(t[22]=(0,a.D$)(()=>{},["prevent"]))},[(0,s.Lk)("div",JAe,[t[63]||(t[63]=(0,s.Lk)("label",null,"Email",-1)),(0,s.bo)((0,s.Lk)("input",{type:"email","onUpdate:modelValue":t[21]||(t[21]=e=>l.form.notifEmail=e),placeholder:"Enter new notification email"},null,512),[[a.Jo,l.form.notifEmail]])]),t[64]||(t[64]=(0,s.Lk)("div",{class:"notif-form-row center"},[(0,s.Lk)("button",{class:"submit-btn",type:"submit",style:{width:"100%","max-width":"320px"}},[(0,s.Lk)("i",{class:"fas fa-save"}),(0,s.eW)(" Save ")])],-1))],32)])):(0,s.Q3)("",!0)]),_:1})]),(0,s.Lk)("div",zAe,[(0,s.Lk)("div",{class:"notification-row notif-dropdown-toggle",onClick:t[25]||(t[25]=e=>l.notifDropdownOpen="whatsapp"===l.notifDropdownOpen?null:"whatsapp")},[t[66]||(t[66]=(0,s.Lk)("span",{style:{display:"flex","align-items":"center",gap:"10px"}},[(0,s.Lk)("i",{class:"fab fa-whatsapp"}),(0,s.eW)(" WhatsApp Notification updates ")],-1)),(0,s.Lk)("label",{class:"switch",onClick:t[24]||(t[24]=(0,a.D$)(()=>{},["stop"]))},[(0,s.bo)((0,s.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[23]||(t[23]=e=>l.form.whatsappNotif=e)},null,512),[[a.lH,l.form.whatsappNotif]]),t[65]||(t[65]=(0,s.Lk)("span",{class:"slider"},null,-1))]),(0,s.Lk)("span",HAe,[(0,s.Lk)("i",{class:(0,d.C4)("whatsapp"===l.notifDropdownOpen?"fas fa-chevron-up":"fas fa-chevron-down")},null,2)])]),(0,s.bF)(a.eB,{name:"fade"},{default:(0,s.k6)(()=>["whatsapp"===l.notifDropdownOpen?((0,s.uX)(),(0,s.CE)("div",GAe,[(0,s.Lk)("form",{class:"notif-change-form",onSubmit:t[27]||(t[27]=(0,a.D$)(()=>{},["prevent"]))},[(0,s.Lk)("div",YAe,[t[67]||(t[67]=(0,s.Lk)("label",null,"Mobile Number",-1)),(0,s.bo)((0,s.Lk)("input",{type:"text","onUpdate:modelValue":t[26]||(t[26]=e=>l.form.notifMobile=e),placeholder:"Enter new WhatsApp number"},null,512),[[a.Jo,l.form.notifMobile]])]),t[68]||(t[68]=(0,s.Lk)("div",{class:"notif-form-row center"},[(0,s.Lk)("button",{class:"submit-btn",type:"submit",style:{width:"100%","max-width":"320px"}},[(0,s.Lk)("i",{class:"fas fa-save"}),(0,s.eW)(" Save ")])],-1))],32)])):(0,s.Q3)("",!0)]),_:1})])])])):(0,s.Q3)("",!0)])])}var eSe={name:"UserProfile",data(){return{activeTab:"account",accountInfoType:"personal",tabs:[{key:"account",label:"Account",icon:"fas fa-user"},{key:"role",label:"Role",icon:"fas fa-exchange-alt"},{key:"password",label:"Password",icon:"fas fa-key"},{key:"notification",label:"Notification",icon:"fas fa-bell"}],form:{firstName:"",lastName:"",email:"",phone:"",newPassword:"",confirmPassword:"",otp:"",emailNotif:!1,whatsappNotif:!1,notifEmail:"",notifMobile:""},businessInfo:{departmentId:"",departmentName:"",businessUnitName:"",businessUnitCode:"",entityName:"",entityType:"",location:"",departmentHead:""},notifDropdownOpen:null,loading:!1,error:null,success:null,userPermissions:{role:"",modules:{}},expandedModules:[]}},mounted(){this.loadUserData(),window.addEventListener("userLoggedIn",this.handleUserLogin)},beforeUnmount(){window.removeEventListener("userLoggedIn",this.handleUserLogin)},methods:{handleUserLogin(e){if(e.detail&&e.detail.user){const t=e.detail.user.UserId;t&&(console.log("Storing user ID in session storage:",t),sessionStorage.setItem("userId",t),this.loadUserData())}},getCurrentUserId(){const e=new URLSearchParams(window.location.search);let t=e.get("userId");if(t)return console.log("Using userId from URL:",t),t;if(t=sessionStorage.getItem("userId"),t)return console.log("Using userId from sessionStorage:",t),t;const i=sessionStorage.getItem("user");if(i)try{const e=JSON.parse(i);if(t=e.UserId||e.userId,t)return console.log("Using userId from session user object:",t),t}catch(s){console.error("Error parsing session user:",s)}const a=localStorage.getItem("user");if(a)try{const e=JSON.parse(a);if(t=e.UserId||e.userId,t)return console.log("Using userId from localStorage:",t),t}catch(s){console.error("Error parsing local user:",s)}return console.log("No user ID found, using default: 1"),"1"},async loadUserData(){this.loading=!0,this.error=null;try{const e=this.getCurrentUserId();if(e){console.log("Fetching user profile for userId:",e);const t=await fetch(`http://localhost:8000/api/user-profile/${e}/`);if(t.ok){const i=await t.json();if(console.log("Profile data received:",i),"success"===i.status){const t=i.data;this.form.firstName=t.firstName,this.form.lastName=t.lastName,this.form.email=t.email,console.log("Fetching business info for userId:",e);const a=await fetch(`http://localhost:8000/api/user-business-info/${e}/`);if(a.ok){const e=await a.json();if(console.log("Business data received:",e),"success"===e.status){const t=e.data;this.businessInfo={departmentId:t.DepartmentId,departmentName:t.DepartmentName,businessUnitName:t.BusinessUnitName||"N/A",businessUnitCode:t.BusinessUnitCode||"N/A",entityName:t.EntityName||"N/A",entityType:t.EntityType||"N/A",location:t.Location||"N/A",departmentHead:t.DepartmentHead||"N/A"}}}else console.error("Failed to fetch business info:",await a.text()),this.error="Failed to load business information. Please try again.";console.log("Fetching user permissions for userId:",e);const s=await fetch(`http://localhost:8000/api/user-permissions/${e}/`);if(s.ok){const e=await s.json();console.log("Permissions data received:",e),"success"===e.status&&(this.userPermissions=e.data,this.initializeExpandedModules())}else console.error("Failed to fetch user permissions:",await s.text()),this.error="Failed to load user permissions. Please try again."}}else console.error("Failed to fetch profile:",await t.text()),this.error="Failed to load profile information. Please try again."}else console.error("No user ID found"),this.error="User ID not found. Please log in again."}catch(e){console.error("Error loading user data:",e),this.error="Failed to load user data. Please try again."}finally{this.loading=!1}},async savePersonalInfo(){this.loading=!0,this.error=null,this.success=null;try{const e=JSON.parse(localStorage.getItem("user")||"{}");e.firstName=this.form.firstName,e.lastName=this.form.lastName,e.email=this.form.email,e.phone=this.form.phone,localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("user_name",`${this.form.firstName} ${this.form.lastName}`),localStorage.setItem("user_email",this.form.email),this.success="Personal information updated successfully!",window.dispatchEvent(new Event("userDataUpdated"))}catch(e){console.error("Error saving personal info:",e),this.error="Failed to save personal info. Please try again."}finally{this.loading=!1}},async saveBusinessInfo(){this.loading=!0,this.error=null,this.success=null;try{const e=JSON.parse(localStorage.getItem("user")||"{}");e.departmentName=this.businessInfo.departmentName,e.businessUnitName=this.businessInfo.businessUnitName,e.entityName=this.businessInfo.entityName,e.location=this.businessInfo.location,e.departmentHead=this.businessInfo.departmentHead,localStorage.setItem("user",JSON.stringify(e)),localStorage.setItem("user_name",this.form.username),localStorage.setItem("user_email",this.form.email),this.success="Business information updated successfully!",window.dispatchEvent(new Event("userDataUpdated"))}catch(e){console.error("Error saving business info:",e),this.error="Failed to save business info. Please try again."}finally{this.loading=!1}},async updatePassword(){this.loading=!0,this.error=null,this.success=null;try{if(this.form.newPassword!==this.form.confirmPassword)return void(this.error="Passwords do not match.");if(this.form.newPassword.length<6)return void(this.error="Password must be at least 6 characters long.");this.success="Password updated successfully!",this.form.newPassword="",this.form.confirmPassword="",this.form.otp=""}catch(e){console.error("Error updating password:",e),this.error="Failed to update password. Please try again."}finally{this.loading=!1}},async saveNotificationSettings(){this.loading=!0,this.error=null,this.success=null;try{this.success="Notification settings updated successfully!"}catch(e){console.error("Error saving notification settings:",e),this.error="Failed to save notification settings. Please try again."}finally{this.loading=!1}},formatModuleName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},getModuleIcon(e){switch(e){case"compliance":return"fas fa-clipboard-check";case"policy":return"fas fa-file-contract";case"audit":return"fas fa-tasks";case"risk":return"fas fa-exclamation-triangle";case"incident":return"fas fa-shield-alt";default:return"fas fa-cog"}},formatPermissionName(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},toggleModulePermissions(e){const t=this.expandedModules.indexOf(e);t>-1?this.expandedModules.splice(t,1):this.expandedModules.push(e)},initializeExpandedModules(){this.userPermissions.modules&&Object.keys(this.userPermissions.modules).length>0&&(this.expandedModules=[Object.keys(this.userPermissions.modules)[0]])}}};const tSe=(0,le.A)(eSe,[["render",ZAe],["__scopeId","data-v-23db0ad8"]]);var iSe=tSe;const aSe=[{path:"/login",name:"login",component:I_e},{path:"/home",name:"home",component:N_e,meta:{requiresAuth:!0}},{path:"/",redirect:()=>{const e="true"===localStorage.getItem("isAuthenticated");return e?{name:"home"}:{name:"login"}}},{path:"/policy/dashboard",name:"PolicyDashboard",component:st,meta:{requiresAuth:!0}},{path:"/policy/performance",name:"PerformancePage",component:ks,meta:{requiresAuth:!0}},{path:"/policy/approver",name:"PolicyApprover",component:Ar,meta:{requiresAuth:!0}},{path:"/policies-list/all",name:"AllPolicies",component:tu,meta:{requiresAuth:!0}},{path:"/policies-list/active",name:"ActivePolicies",component:Iu,meta:{requiresAuth:!0}},{path:"/create-policy/upload-framework",name:"UploadFramework",component:RB},{path:"/create-policy/create",name:"CreatePolicy",component:Na,meta:{requiresAuth:!0}},{path:"/create-policy/framework",name:"Framework",component:Pp,meta:{requiresAuth:!0}},{path:"/create-policy/tailoring",name:"TT",component:BI,meta:{requiresAuth:!0}},{path:"/create-policy/versioning",name:"Versioning",component:Rk,meta:{requiresAuth:!0}},{path:"/tree-policies",name:"TreePolicies",component:mh,meta:{requiresAuth:!0}},{path:"/compliance/create",name:"CreateCompliance",component:A4},{path:"/incident/user-tasks",name:"IncidentUserTasks",component:Z0},{path:"/compliance/approver",name:"ComplianceApprover",component:q9},{path:"/auditor/dashboard",name:"AuditorDashboard",component:()=>Promise.resolve().then(i.bind(i,6216))},{path:"/auditor/assign",name:"AssignAudit",component:uA},{path:"/auditor/reviews",name:"ReviewAudits",component:TA},{path:"/auditor/reviewer",name:"AuditorReviewer",component:TA},{path:"/audit/:auditId/tasks",name:"TaskView",component:QT,props:!0},{path:"/reviewer/task/:auditId",name:"ReviewTaskView",component:EF,props:!0},{path:"/auditor/audits",name:"Audits",component:R2},{path:"/auditor/kpi",name:"AuditorKPI",component:()=>Promise.resolve().then(i.bind(i,6216))},{path:"/incident/create",name:"CreateIncident",component:xq},{path:"/incident/incident",name:"Incident",component:XJ["default"]},{path:"/incident/dashboard",name:"IncidentDashboard",component:MJ},{path:"/incident/:id",name:"IncidentDetails",component:LH,props:!0},{path:"/incident/audit-findings",name:"AuditFindings",component:MG},{path:"/incident/audit-finding-details/:id",name:"AuditFindingDetails",component:PY,props:!0},{path:"/compliance/approver",name:"ComplianceApprover",component:q9},{path:"/incident/incident",name:"IncidentManagement",component:()=>Promise.resolve().then(i.bind(i,9554))},{path:"/incident/performance/dashboard",name:"IncidentPerformanceDashboard",component:()=>i.e(551).then(i.bind(i,1551))},{path:"/risk/create",name:"CreateRisk",component:hue},{path:"/risk/riskregister",name:"RiskRegister",redirect:"/risk/riskregister-list"},{path:"/risk/riskregister-list",name:"RiskRegisterList",component:Due},{path:"/risk/create-risk",name:"CreateRiskForm",component:hue},{path:"/risk/riskdashboard",name:"RiskDashboard",component:Wpe},{path:"/risk/riskinstances",name:"RiskInstances",redirect:"/risk/riskinstances-list"},{path:"/risk/riskinstances-list",name:"RiskInstancesList",component:Zpe},{path:"/risk/create-instance",name:"CreateRiskInstance",component:Gve},{path:"/risk/resolution",name:"RiskResolution",component:PDe},{path:"/risk/workflow",name:"RiskWorkflow",component:Bye},{path:"/risk/scoring",name:"RiskScoring",component:REe},{path:"/risk/scoring-details/:riskId",name:"ScoringDetails",component:NIe,props:!0},{path:"/risk/tailoring",name:"RiskTailoring",component:Qfe},{path:"/risk/riskkpi",name:"RiskKPI",component:nEe},{path:"/view-risk/:id",name:"ViewRisk",component:vPe},{path:"/view-instance/:id",name:"ViewInstance",component:m_e},{path:"/framework-explorer/policies/:frameworkId",name:"FrameworkPolicies",component:Iy,props:!0},{path:"/policy/approval",name:"PolicyApproval",component:Ar},{path:"/framework-approval",name:"FrameworkApprover",component:GL},{path:"/framework-explorer",name:"FrameworkExplorer",component:bg},{path:"/policy/performance/dashboard",name:"PolicyPerformanceDashboard",component:st},{path:"/policy/performance/kpis",name:"KPIDashboard",component:Fb},{path:"/framework-status-changes",name:"StatusChangeRequests",component:sE},{path:"/reviewer/confirmation/:auditId",name:"ReviewConfirmation",component:YF,props:!0},{path:"/auditor/dashboard",name:"AuditorDashboard",component:pA["default"]},{path:"/auditor/reports",name:"AuditReports",component:yV},{path:"/auditor/performance",component:wV,children:[{path:"",redirect:"/auditor/performance/dashboard"},{path:"userdashboard",name:"PerformanceDashboard",component:FX},{path:"kpi",name:"KPIAnalysis",component:QM}]},{path:"/compliance/create",name:"CreateCompliance",component:A4},{path:"/compliance/approver",name:"ComplianceApprover",component:q9},{path:"/compliance/list",name:"AllCompliance",component:fie,alias:"/control-management"},{path:"/compliance/audit-status",name:"Compliances",component:zae},{path:"/compliance/view/:type/:id/:name",name:"ComplianceView",component:_se,props:!0},{path:"/compliance/audit/:type/:id/:name",name:"ComplianceAuditView",component:aoe,props:!0},{path:"/compliance/user-dashboard",name:"ComplianceDashboard",component:Boe},{path:"/compliance/kpi-dashboard",name:"ComplianceKPI",component:Fre},{path:"/compliance/tailoring",name:"ComplianceTailoring",component:lle},{path:"/compliance/versioning",name:"ComplianceVersioning",component:xle},{path:"/compliance/popup-demo",name:"PopupDemo",component:Hre},{path:"/compliance/edit/:id",name:"EditCompliance",component:J5},{path:"/compliance/copy/:id",name:"CopyCompliance",component:F7},{path:"/notifications",name:"Notifications",component:wce,meta:{requiresAuth:!0}},{path:"/user-profile",name:"UserProfile",component:iSe,meta:{requiresAuth:!0}}],sSe=(0,ae.aE)({history:(0,ae.LA)(),routes:aSe});sSe.beforeEach((e,t,i)=>{const a="true"===localStorage.getItem("isAuthenticated");e.meta.requiresAuth&&!a?i("/login"):"/login"===e.path&&a?i("/home"):i()});var oSe=sSe,lSe=i(5007),nSe=(i(4188),i(5524),i(5753)),rSe=i(5829),cSe=i(5806);let dSe=!1;function uSe(){console.log("[HTTP_INTERCEPTOR] Setting up HTTP interceptor for access control"),He.A.interceptors.response.use(e=>(dSe=!1,e),e=>{if(console.log("[HTTP_INTERCEPTOR] Response error intercepted:",{status:e?.response?.status,url:e?.config?.url,method:e?.config?.method?.toUpperCase(),showingPopup:dSe}),e.response&&[401,403].includes(e.response.status))if(console.log("[HTTP_INTERCEPTOR] Access denied error detected"),dSe)console.log("[HTTP_INTERCEPTOR] Popup already showing, skipping duplicate");else{dSe=!0,console.log("[HTTP_INTERCEPTOR] Showing access denied popup");const t=Tr.Ay.handleApiErrorByUrl(e,e.config.url);t?console.log("[HTTP_INTERCEPTOR] Access denied popup handled by URL pattern"):(console.log("[HTTP_INTERCEPTOR] Using fallback access denied popup"),Tr.Ay.showAccessDenied("this feature")),setTimeout(()=>{dSe=!1,console.log("[HTTP_INTERCEPTOR] Reset popup flag")},1e3)}return Promise.reject(e)}),He.A.interceptors.request.use(e=>(console.log("[HTTP_INTERCEPTOR] Request:",{method:e.method?.toUpperCase(),url:e.url}),e),e=>(console.error("[HTTP_INTERCEPTOR] Request error:",e),Promise.reject(e))),console.log("[HTTP_INTERCEPTOR] HTTP interceptor setup complete")}const pSe=(0,nSe.$N)({components:rSe,directives:cSe,icons:{defaultSet:"mdi"}});He.A.defaults.baseURL="http://localhost:8000",He.A.defaults.headers.common["Content-Type"]="application/json",He.A.defaults.withCredentials=!0,He.A.defaults.timeout=15e3,console.log("🔐 Axios configured with session credentials for RBAC authentication"),uSe(),console.log("🛡️ HTTP interceptor activated for automatic access denied handling");const mSe=(0,a.Ef)(pe);mSe.config.compilerOptions.isCustomElement=e=>e.includes("-"),mSe.config.performance=!0,mSe.config.warnHandler=()=>null,mSe.use(oSe),mSe.use(lSe.A),mSe.use(pSe),mSe.use(Ck.Ay),mSe.mount("#app")},2972:function(e,t,i){i.d(t,{OQ:function(){return a.O},Wo:function(){return a.A},wA:function(){return s.A}});var a=i(2351),s=i(16);const o={install(e){e.config.globalProperties.$popup=a.A}};t.Ay=o},4300:function(e,t,i){i.d(t,{Hi:function(){return l},UG:function(){return o},fv:function(){return n}});i(8111),i(7588),i(8237);var a=i(4373);const s=a.A.create({baseURL:"http://localhost:8000",headers:{"Content-Type":"application/json"},timeout:15e3,withCredentials:!0});s.interceptors.response.use(e=>e,e=>(console.error("API Error:",e),"ERR_NETWORK"===e.code&&console.error("Network error details:",{message:e.message,config:{url:e.config?.url,method:e.config?.method,timeout:e.config?.timeout}}),Promise.reject(e))),s.interceptors.request.use(e=>{const t=localStorage.getItem("token");t&&(e.headers.Authorization=`Bearer ${t}`);const i=localStorage.getItem("user_id");return i&&("get"===e.method?(e.params=e.params||{},e.params.user_id=i):"post"!==e.method&&"put"!==e.method||e.data&&"object"===typeof e.data&&(e.data.user_id=i)),console.log(`API Request: ${e.method?.toUpperCase()} ${e.url}`,{data:e.data,params:e.params}),e});const o={getIncidents:e=>s.get("api/incidents/",{params:e}),createIncident:e=>s.post("api/incidents/create/",e),updateIncidentStatus:(e,t)=>s.put(`api/incidents/${e}/status/`,t),getIncidentMetrics:e=>s.get("api/incidents/metrics/",{params:e}),getIncidentMTTD:e=>s.get("api/incidents/metrics/mttd/",{params:e}),getIncidentMTTR:e=>s.get("api/incidents/metrics/mttr/",{params:e}),getIncidentMTTC:e=>s.get("api/incidents/metrics/mttc/",{params:e}),getIncidentMTTRV:e=>s.get("api/incidents/metrics/mttrv/",{params:e}),getIncidentVolume:e=>s.get("api/incidents/metrics/volume/",{params:e}),getIncidentsBySeverity:e=>s.get("api/incidents/metrics/by-severity/",{params:e}),getIncidentRootCauses:e=>s.get("api/incidents/metrics/root-causes/",{params:e}),getIncidentTypes:e=>s.get("api/incidents/metrics/types/",{params:e}),getIncidentOrigins:e=>s.get("api/incidents/metrics/origins/",{params:e}),getIncidentCost:e=>s.get("api/incidents/metrics/cost/",{params:e}),getIncidentClosureRate:e=>s.get("api/incidents/metrics/closure-rate/",{params:e}),getIncidentReopenedCount:e=>s.get("api/incidents/metrics/reopened-count/",{params:e}),getIncidentCount:e=>s.get("api/incidents/metrics/count/",{params:e}),getIncidentDashboard:e=>s.get("api/incidents/dashboard/",{params:e}),getIncidentAnalytics:e=>s.post("api/incidents/dashboard/analytics/",e),getIncidentCountsByStatus:()=>s.get("api/incidents/counts-by-status/"),getRecentIncidents:(e=3)=>s.get("api/incidents/recent/",{params:{limit:e}})},l={getAuditFindings:e=>s.get("api/audit-findings/",{params:e}),getAuditFindingsDetail:e=>s.get(`api/audit-findings/${e}/details/`),getChecklistVerified:(e={})=>{const t=new URL(`${s.defaults.baseURL}/api/lastchecklistitemverified/`);return e.complied&&Array.isArray(e.complied)?e.complied.forEach(e=>{t.searchParams.append("complied[]",e)}):(t.searchParams.append("complied[]","0"),t.searchParams.append("complied[]","1")),s.get(t.toString())},getAuditDetail:e=>s.get(`api/audits/${e}/`),getAuditFindingsByCompliance:e=>s.get(`api/audit-findings/compliance/${e}/`),getUsers:()=>s.get("api/users/"),getOntimeMitigationPercentage:()=>s.get("api/compliance/kpi-dashboard/analytics/ontime-mitigation/"),getComplianceAuditInfo:e=>s.get(`api/compliance/compliance/${e}/audit-info/`)},n={getFrameworks:()=>s.get("/api/compliance/frameworks/"),getComplianceFrameworks:()=>s.get("/api/compliance/frameworks/"),getPolicies:e=>s.get(`/api/compliance/frameworks/${e}/policies/list/`),getCompliancePolicies:e=>s.get(`/api/compliance/frameworks/${e}/policies/list/`),getSubPolicies:e=>s.get(`/api/compliance/policies/${e}/subpolicies/`),getComplianceSubPolicies:e=>s.get(`/api/compliance/policies/${e}/subpolicies/`),getCompliancesByType:(e,t)=>s.get(`/api/compliance/view/${e}/${t}/`),getCategoryBusinessUnits:e=>s.get("/api/category-business-units/",{params:{source:e}}),getCategoryBusinessPolicies:e=>s.get("/api/category-business-units/",{params:{source:e}}),addCategoryBusinessUnit:e=>s.post("/api/category-business-units/add/",e),createCompliance:e=>{const t={ApprovalDueDate:new Date(Date.now()+6048e5).toISOString().split("T")[0],Status:"Under Review",ActiveInactive:"Active",ComplianceVersion:"1.0",...e},i={SubPolicy:t.SubPolicy,ComplianceTitle:t.ComplianceTitle||"",ComplianceItemDescription:t.ComplianceItemDescription||"",ComplianceType:t.ComplianceType||"",Scope:t.Scope||"",Objective:t.Objective||"",BusinessUnitsCovered:t.BusinessUnitsCovered||"",IsRisk:Boolean(t.IsRisk),PossibleDamage:t.PossibleDamage||"",mitigation:t.mitigation||"",PotentialRiskScenarios:t.PotentialRiskScenarios||"",RiskType:t.RiskType||"",RiskCategory:t.RiskCategory||"",RiskBusinessImpact:t.RiskBusinessImpact||"",Criticality:t.Criticality||"Medium",MandatoryOptional:t.MandatoryOptional||"Mandatory",ManualAutomatic:t.ManualAutomatic||"Manual",Impact:t.Impact||5,Probability:t.Probability||5,Status:t.Status,ComplianceVersion:t.ComplianceVersion,reviewer:t.reviewer_id||t.reviewer,CreatedByName:t.CreatedByName||(t.reviewer_id||t.reviewer).toString(),Applicability:t.Applicability||"",MaturityLevel:t.MaturityLevel||"Initial",ActiveInactive:t.ActiveInactive,PermanentTemporary:t.PermanentTemporary||"Permanent",ApprovalDueDate:t.ApprovalDueDate};return console.log("Sending compliance data:",i),s.post("/api/compliance-create/",i).then(e=>(console.log("Compliance create response:",e.data),{data:{success:e.data.success,ComplianceId:e.data.compliance_id,Identifier:e.data.Identifier,version:e.data.version}})).catch(e=>{throw console.error("Compliance create error:",e.response?.data),e})},updateCompliance:(e,t)=>{const i={ComplianceTitle:t.ComplianceTitle||"",ComplianceItemDescription:t.ComplianceItemDescription||"",ComplianceType:t.ComplianceType||"",Scope:t.Scope||"",Objective:t.Objective||"",BusinessUnitsCovered:t.BusinessUnitsCovered||"",IsRisk:Boolean(t.IsRisk),PossibleDamage:t.PossibleDamage||"",mitigation:t.mitigationSteps?t.mitigationSteps.reduce((e,t,i)=>(t.description.trim()&&(e[`step${i+1}`]=t.description.trim()),e),{}):{},PotentialRiskScenarios:t.PotentialRiskScenarios||"",RiskType:t.RiskType||"",RiskCategory:t.RiskCategory||"",RiskBusinessImpact:t.RiskBusinessImpact||"",Criticality:t.Criticality||"Medium",MandatoryOptional:t.MandatoryOptional||"Mandatory",ManualAutomatic:t.ManualAutomatic||"Manual",Impact:t.Impact||"5.0",Probability:t.Probability||"5.0",Status:"Under Review",ComplianceVersion:t.ComplianceVersion,reviewer:t.reviewer_id||t.reviewer,Applicability:t.Applicability||"",MaturityLevel:t.MaturityLevel||"Initial",ActiveInactive:"Active",PermanentTemporary:t.PermanentTemporary||"Permanent",versionType:"major"===t.versionType?"Major":"Minor",PreviousComplianceVersionId:t.PreviousComplianceVersionId};return console.log("Updating compliance data:",i),s.put(`/api/compliance_edit/${e}/edit/`,i).then(e=>(console.log("Compliance update response:",e.data),e)).catch(e=>{throw console.error("Compliance update error:",e.response?.data),e})},editCompliance:(e,t)=>s.put(`/api/compliance_edit/${e}/edit/`,t),cloneCompliance:(e,t)=>{console.log("Cloning compliance with ID:",e,"Data:",t);const i={...t};return i.target_subpolicy_id&&!i.SubPolicy&&(i.SubPolicy=i.target_subpolicy_id),s.post(`/api/clone-compliance/${e}/clone/`,i).then(e=>(console.log("Compliance clone response:",e.data),e)).catch(e=>{throw console.error("Compliance clone error:",e.response?.data),e})},getComplianceDashboard:e=>s.get("/api/compliance/user-dashboard/",{params:e}),getComplianceAnalytics:e=>s.post("/api/compliance/kpi-dashboard/analytics/",e),getCompliancesBySubPolicy:e=>s.get(`/api/subpolicies/${e}/compliances/`),getComplianceById:e=>s.get(`/api/compliance/${e}/`),toggleComplianceVersion:e=>s.post(`/api/compliance/${e}/toggle-version/`),deactivateCompliance:(e,t)=>s.post(`/api/compliance/${e}/deactivate/`,t),approveComplianceDeactivation:(e,t)=>s.post(`/api/compliance/deactivation/${e}/approve/`,t),rejectComplianceDeactivation:(e,t)=>s.post(`/api/compliance/deactivation/${e}/reject/`,t),getMaturityLevelKPI:()=>s.get("api/compliance/kpi-dashboard/analytics/maturity-level/"),getNonComplianceCount:()=>s.get("api/compliance/kpi-dashboard/analytics/non-compliance-count/"),getMitigatedRisksCount:()=>s.get("api/compliance/kpi-dashboard/analytics/mitigated-risks-count/"),getAutomatedControlsCount:()=>s.get("api/compliance/kpi-dashboard/analytics/automated-controls-count/"),getNonComplianceRepetitions:()=>s.get("api/compliance/kpi-dashboard/analytics/non-compliance-repetitions/"),getComplianceKPI:()=>s.get("api/compliance/kpi-dashboard/"),getComplianceStatusOverview:()=>s.get("api/compliance/kpi-dashboard/analytics/status-overview/"),getReputationalImpact:()=>s.get("api/compliance/kpi-dashboard/analytics/reputational-impact/"),getRemediationCost:()=>s.get("api/compliance/kpi-dashboard/analytics/remediation-cost/"),getNonCompliantIncidents:e=>s.get("api/compliance/kpi-dashboard/analytics/non-compliant-incidents/",{params:{period:e}}),getCompliancePolicyApprovals:e=>s.get("api/compliance/policy-approvals-compliance/reviewer/",{params:e}),getComplianceRejectedApprovals:e=>s.get(`api/compliance/policy-approvals-compliance/rejected/${e}/`),submitComplianceReview:(e,t)=>(console.log(`Submitting compliance review for approval ID ${e}:`,t),s.put(`/api/compliance/compliance-approvals/${e}/review/`,t,{timeout:2e4})),resubmitComplianceApproval:(e,t)=>s.put(`/api/compliance/compliance-approvals/resubmit/${e}/`,t),getUsers:()=>s.get("/api/compliance-users/"),getOntimeMitigationPercentage:()=>s.get("api/compliance/kpi-dashboard/analytics/ontime-mitigation/")}},6216:function(e,t,i){i.r(t),i.d(t,{default:function(){return ge}});var a=i(6768),s=i(4232),o=i(5130);const l={class:"auditor-dashboard-container"},n={key:0,class:"loading-indicator"},r={key:1,class:"error-message"},c={class:"action-buttons"},d={key:3,class:"no-data-message"},u={key:4,class:"reports-modal-overlay"},p={class:"reports-modal"},m={class:"reports-modal-header"},v={key:0,class:"loading-message"},k={key:1,class:"error-message"},h={key:2,class:"no-reports-message"},g={key:3,class:"reports-table-container"},y={class:"reports-table"},f={class:"report-url"},b=["title"],C={class:"actions-cell"},L=["onClick"],w=["onClick"],E={key:5,class:"audit-popup-overlay"},R={class:"audit-popup-modal"},I={class:"popup-header"},D={class:"popup-title"},P={class:"popup-content"},_={class:"popup-policy"},A={class:"popup-policy-name"},S={key:0,class:"popup-subpolicy"},T={key:1,class:"popup-loading"},x={key:2,class:"popup-error"},F={key:3,class:"popup-compliance-list"},V={class:"compliance-header"},U={class:"compliance-id"},N={class:"compliance-description"},M={class:"compliance-controls"},X={class:"compliance-check"},$=["checked","onChange"],O={class:"compliance-evidence"},j=["onUpdate:modelValue","onInput"],B={class:"compliance-comments"},W=["onUpdate:modelValue","onInput"],q={key:0,class:"compliance-major-minor"},Q=["onUpdate:modelValue","onChange"],K={class:"popup-actions"},J={key:6,class:"versions-modal-overlay"},z={class:"versions-modal"},H={class:"versions-modal-header"},G={key:0,class:"loading-message"},Y={key:1,class:"error-message"},Z={key:2,class:"no-versions-message"},ee={key:3,class:"versions-table-container"},te={class:"versions-table"},ie={class:"icon-cell"},ae=["onClick"],se={class:"icon-cell"},oe={key:0,class:"fas fa-spinner fa-spin",title:"Downloading..."},le=["onClick"],ne={key:1,class:"disabled-icon",title:"Download not available for rejected reports"};function re(e,t,i,re,ce,de){const ue=(0,a.g2)("CustomButton"),pe=(0,a.g2)("DynamicTable");return(0,a.uX)(),(0,a.CE)("div",l,[t[27]||(t[27]=(0,a.Lk)("div",{class:"dashboard-header-title"}," Audit Dashboard ",-1)),ce.loading?((0,a.uX)(),(0,a.CE)("div",n,"Loading audits...")):(0,a.Q3)("",!0),ce.error?((0,a.uX)(),(0,a.CE)("div",r,[(0,a.eW)((0,s.v_)(ce.error)+" ",1),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>de.retryLoading&&de.retryLoading(...e)),class:"retry-btn"},"Retry")])):(0,a.Q3)("",!0),!ce.loading&&ce.audits.length>0?((0,a.uX)(),(0,a.Wv)(pe,{key:2,title:"Audits",data:ce.audits,columns:de.tableColumns,filters:de.tableFilters,actionButtons:de.tableActionButtons,showActions:!0,showPagination:!0,defaultPageSize:10,onButtonClick:de.handleButtonClick,onFilterChange:de.handleFilterChange},{"cell-status":(0,a.k6)(({row:e})=>[(0,a.bF)(ue,{config:de.getStatusButtonConfig(e),onClick:t=>de.onStatusButtonClick(e)},null,8,["config","onClick"])]),actions:(0,a.k6)(({row:e})=>[(0,a.Lk)("div",c,[(0,a.bF)(ue,{config:{name:"Reports",icon:"PhFileText",className:"report-btn"},onClick:t=>de.showReports(e)},null,8,["onClick"]),"Completed"===e.status?((0,a.uX)(),(0,a.Wv)(ue,{key:0,config:{name:"Versions",icon:"PhClock",className:"view-versions-btn"},onClick:t=>de.viewAuditVersions(e)},null,8,["onClick"])):(0,a.Q3)("",!0)])]),_:1},8,["data","columns","filters","actionButtons","onButtonClick","onFilterChange"])):ce.loading||0!==ce.audits.length?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",d," No audits found. You don't have any audits assigned to you. ")),ce.showReportsModal?((0,a.uX)(),(0,a.CE)("div",u,[(0,a.Lk)("div",p,[(0,a.Lk)("div",m,[t[7]||(t[7]=(0,a.Lk)("h2",null,"Reports",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[1]||(t[1]=(...e)=>de.closeReportsModal&&de.closeReportsModal(...e))},"×")]),ce.loadingReports?((0,a.uX)(),(0,a.CE)("div",v,t[8]||(t[8]=[(0,a.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,a.eW)(" Loading reports... ")]))):ce.reportsError?((0,a.uX)(),(0,a.CE)("div",k,[t[9]||(t[9]=(0,a.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,a.eW)(" "+(0,s.v_)(ce.reportsError),1)])):0===ce.processedReports.length?((0,a.uX)(),(0,a.CE)("div",h,t[10]||(t[10]=[(0,a.Lk)("i",{class:"fas fa-folder-open"},null,-1),(0,a.eW)(" No reports available ")]))):((0,a.uX)(),(0,a.CE)("div",g,[(0,a.Lk)("table",y,[t[13]||(t[13]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Report Number"),(0,a.Lk)("th",null,"Report ID"),(0,a.Lk)("th",null,"Audit ID"),(0,a.Lk)("th",null,"Policy ID"),(0,a.Lk)("th",null,"SubPolicy ID"),(0,a.Lk)("th",null,"Framework ID"),(0,a.Lk)("th",null,"Document"),(0,a.Lk)("th",null,"Actions")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ce.processedReports,(e,i)=>((0,a.uX)(),(0,a.CE)("tr",{key:i},[(0,a.Lk)("td",null,(0,s.v_)(e.reportNumber),1),(0,a.Lk)("td",null,(0,s.v_)(e.ReportId),1),(0,a.Lk)("td",null,(0,s.v_)(e.AuditId),1),(0,a.Lk)("td",null,(0,s.v_)(e.PolicyId||"N/A"),1),(0,a.Lk)("td",null,(0,s.v_)(e.SubPolicyId||"N/A"),1),(0,a.Lk)("td",null,(0,s.v_)(e.FrameworkId||"N/A"),1),(0,a.Lk)("td",f,[(0,a.Lk)("span",{class:"file-name",title:e.Report},(0,s.v_)(de.getFileName(e.Report)),9,b)]),(0,a.Lk)("td",C,[(0,a.Lk)("button",{class:"action-btn view",onClick:t=>de.viewReport(e),title:"View Report"},t[11]||(t[11]=[(0,a.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,L),(0,a.Lk)("button",{class:"action-btn download",onClick:t=>de.downloadReport(e),title:"Download Report"},t[12]||(t[12]=[(0,a.Lk)("i",{class:"fas fa-download"},null,-1)]),8,w)])]))),128))])])]))])])):(0,a.Q3)("",!0),ce.showPopup?((0,a.uX)(),(0,a.CE)("div",E,[(0,a.Lk)("div",R,[(0,a.Lk)("button",{class:"popup-close",onClick:t[2]||(t[2]=(...e)=>de.closePopup&&de.closePopup(...e))},"×"),(0,a.Lk)("div",I,[(0,a.Lk)("h2",D,(0,s.v_)(ce.popupData.framework),1)]),(0,a.Lk)("div",P,[(0,a.Lk)("div",_,[(0,a.Lk)("h3",A,(0,s.v_)(ce.popupData.policy),1),ce.popupData.subpolicy?((0,a.uX)(),(0,a.CE)("div",S,[(0,a.Lk)("h4",null,"Subpolicy: "+(0,s.v_)(ce.popupData.subpolicy),1)])):(0,a.Q3)("",!0),ce.popupData.loadingCompliances?((0,a.uX)(),(0,a.CE)("div",T,t[14]||(t[14]=[(0,a.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,a.eW)(" Loading compliance data... ")]))):ce.popupData.complianceError?((0,a.uX)(),(0,a.CE)("div",x,[t[15]||(t[15]=(0,a.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,a.eW)(" "+(0,s.v_)(ce.popupData.complianceError)+" ",1),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>de.retryLoadingCompliances&&de.retryLoadingCompliances(...e)),class:"retry-btn"},"Retry")])):((0,a.uX)(),(0,a.CE)("div",F,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ce.popupData.compliances,e=>((0,a.uX)(),(0,a.CE)("div",{key:e.finding_id,class:"popup-compliance-item"},[(0,a.Lk)("div",V,[(0,a.Lk)("h4",null,(0,s.v_)(e.compliance_name),1),(0,a.Lk)("span",U,"ID: "+(0,s.v_)(e.compliance_id),1)]),(0,a.Lk)("div",N,(0,s.v_)(e.compliance_description),1),(0,a.Lk)("div",M,[(0,a.Lk)("div",X,[(0,a.Lk)("input",{type:"checkbox",checked:"1"===e.check,onChange:t=>de.updateComplianceCheck(e.finding_id,t)},null,40,$),t[16]||(t[16]=(0,a.Lk)("label",null,"Compliant",-1))]),(0,a.Lk)("div",O,[t[17]||(t[17]=(0,a.Lk)("label",null,"Evidence:",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t=>e.evidence=t,onInput:t=>de.updateComplianceEvidence(e.finding_id,t),placeholder:"Enter evidence here..."},null,40,j),[[o.Jo,e.evidence]])]),(0,a.Lk)("div",B,[t[18]||(t[18]=(0,a.Lk)("label",null,"Comments:",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t=>e.comments=t,onInput:t=>de.updateComplianceComments(e.finding_id,t),placeholder:"Enter comments here..."},null,40,W),[[o.Jo,e.comments]])]),e.check?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",q,[t[20]||(t[20]=(0,a.Lk)("label",null,"Finding Type:",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t=>e.major_minor=t,onChange:t=>de.updateComplianceMajorMinor(e.finding_id,t)},t[19]||(t[19]=[(0,a.Lk)("option",{value:""},"Select Type",-1),(0,a.Lk)("option",{value:"Major"},"Major",-1),(0,a.Lk)("option",{value:"Minor"},"Minor",-1)]),40,Q),[[o.u1,e.major_minor]])]))])]))),128))]))])]),(0,a.Lk)("div",K,[(0,a.Lk)("button",{class:"popup-save-btn",onClick:t[4]||(t[4]=(...e)=>de.saveCompliances&&de.saveCompliances(...e))},"Save Changes"),(0,a.Lk)("button",{class:"popup-cancel-btn",onClick:t[5]||(t[5]=(...e)=>de.closePopup&&de.closePopup(...e))},"Cancel")])])])):(0,a.Q3)("",!0),ce.showVersionsModal?((0,a.uX)(),(0,a.CE)("div",J,[(0,a.Lk)("div",z,[(0,a.Lk)("div",H,[t[21]||(t[21]=(0,a.Lk)("h2",null,"Audit Versions",-1)),(0,a.Lk)("button",{class:"close-btn",onClick:t[6]||(t[6]=(...e)=>de.closeVersionsModal&&de.closeVersionsModal(...e))},"×")]),ce.loadingVersions?((0,a.uX)(),(0,a.CE)("div",G,t[22]||(t[22]=[(0,a.Lk)("i",{class:"fas fa-spinner fa-spin"},null,-1),(0,a.eW)(" Loading versions... ")]))):ce.versionsError?((0,a.uX)(),(0,a.CE)("div",Y,[t[23]||(t[23]=(0,a.Lk)("i",{class:"fas fa-exclamation-circle"},null,-1)),(0,a.eW)(" "+(0,s.v_)(ce.versionsError),1)])):0===ce.auditVersions.length?((0,a.uX)(),(0,a.CE)("div",Z,t[24]||(t[24]=[(0,a.Lk)("i",{class:"fas fa-folder-open"},null,-1),(0,a.eW)(" No versions available for this audit. ")]))):((0,a.uX)(),(0,a.CE)("div",ee,[(0,a.Lk)("table",te,[t[26]||(t[26]=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"Version NO"),(0,a.Lk)("th",null,"Date"),(0,a.Lk)("th",null,"Report status"),(0,a.Lk)("th",{colspan:"3"},"Actions")])],-1)),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(ce.auditVersions,e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.Version},[(0,a.Lk)("td",null,(0,s.v_)(e.Version),1),(0,a.Lk)("td",null,(0,s.v_)(e.Date),1),(0,a.Lk)("td",null,[(0,a.Lk)("span",{class:(0,s.C4)(de.getStatusClass(e.ApprovedRejected))},(0,s.v_)(de.getStatusText(e)),3)]),(0,a.Lk)("td",ie,[(0,a.Lk)("i",{class:"fas fa-eye action-icon",onClick:t=>de.viewAuditVersion(ce.currentAudit.audit_id,e.Version),title:"View"},null,8,ae)]),(0,a.Lk)("td",se,[de.isRejected(e)?((0,a.uX)(),(0,a.CE)("span",ne,t[25]||(t[25]=[(0,a.Lk)("i",{class:"fas fa-download"},null,-1)]))):((0,a.uX)(),(0,a.CE)(a.FK,{key:0},[ce.downloadingVersion===e.Version?((0,a.uX)(),(0,a.CE)("i",oe)):((0,a.uX)(),(0,a.CE)("i",{key:1,class:"fas fa-download action-icon",onClick:t=>de.downloadAuditVersion(ce.currentAudit.audit_id,e.Version),title:"Download"},null,8,le))],64))])]))),128))])])]))])])):(0,a.Q3)("",!0)])}i(4114),i(8111),i(2489),i(116),i(7588),i(1701),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698);var ce=i(4373),de=i(6567),ue=i(7834),pe=i(9254);const me={getMyAudits:async()=>{try{const e=await ce.A.get("/api/my-audits/");return e}catch(e){if(console.error("Error fetching audits:",e),pe.wr.handleApiError(e,"audit dashboard access"))throw e;throw e}},updateAuditStatus:async(e,t)=>{try{console.log(`Attempting to update audit status for audit ${e} to ${t.status}`);try{console.log("Trying POST method...");const i=await ce.A.post(`/api/audits/${e}/status/`,t);return console.log("POST method successful:",i.data),i}catch(i){if(console.error("POST method failed:",i),i.response&&405===i.response.status){console.warn("POST method not allowed, falling back to PUT method");const i=await ce.A.put(`/api/audits/${e}/status/`,t);return console.log("PUT method successful (fallback):",i.data),i}throw i}}catch(a){if(console.error("Error updating audit status:",a),console.error("Status code:",a.response?.status),console.error("Error message:",a.response?.data||a.message),pe.wr.handleApiError(a,"audit status update"))throw a;throw a}},getAuditVersions:async e=>{try{const t=await ce.A.get(`/api/audit-reports/${e}/versions/`);return t}catch(t){if(console.error(`Error fetching versions for audit ${e}:`,t),pe.wr.handleApiError(t,"audit versions access"))throw t;throw t}},getAuditVersionS3Link:async(e,t)=>{try{const i=await ce.A.get(`/api/audit-reports/${e}/versions/${t}/s3-link/`);return i}catch(i){if(console.error(`Error getting S3 link for audit ${e}, version ${t}:`,i),pe.wr.handleApiError(i,"audit report download access"))throw i;throw i}}};var ve={name:"AuditorDashboard",components:{DynamicTable:de.A,CustomButton:ue.A},data(){return{auditStatuses:[],loading:!0,error:"",audits:[],showPopup:!1,popupData:{framework:"",policy:"",subpolicy:"",audit_id:null,compliances:[],loadingCompliances:!1,complianceError:null},frameworks:[],policies:[],statusUpdating:!1,showReportsModal:!1,loadingReports:!1,reportsError:null,processedReports:[],currentAudit:null,showVersionsModal:!1,loadingVersions:!1,versionsError:null,auditVersions:[],downloadingVersion:null}},computed:{tableColumns(){return[{key:"audit_id",label:"Audit ID",sortable:!0},{key:"framework",label:"Framework",sortable:!0},{key:"policy",label:"Policy",sortable:!0},{key:"subpolicy",label:"Subpolicy",sortable:!0},{key:"user",label:"Auditor",sortable:!0},{key:"date",label:"Due Date",sortable:!0},{key:"frequency",label:"Frequency",sortable:!0},{key:"reviewer",label:"Reviewer",sortable:!0},{key:"auditType",label:"Audit Type",sortable:!0},{key:"status",label:"Status",sortable:!0,slot:"cell-status"}]},tableFilters(){return[{name:"Framework",values:[{value:"all",label:"All Framework"},...this.frameworks.map(e=>({value:e,label:e}))],defaultValue:"all",filterFunction:(e,t)=>"all"===t||e.framework===t},{name:"Status",values:[{value:"all",label:"All Status"},{value:"Yet to Start",label:"Yet to Start"},{value:"Work In Progress",label:"Work In Progress"},{value:"Under review",label:"Under review"},{value:"Completed",label:"Completed"}],defaultValue:"all",filterFunction:(e,t)=>"all"===t||e.status===t}]},tableActionButtons(){return[]}},created(){this.fetchAudits()},methods:{retryLoading(){this.fetchAudits()},fetchAudits(){this.loading=!0,this.error="",me.getMyAudits().then(e=>{console.log("Audit data received:",e.data),e.data&&e.data.audits?(this.audits=e.data.audits.map(e=>{const t=e.Reports||e.reports;console.log(`Audit ${e.audit_id} raw reports field:`,e.Reports),console.log(`Audit ${e.audit_id} processed reports field:`,t);const i=Boolean(t&&"null"!==t&&"[]"!==t&&"{}"!==t);console.log(`Audit ${e.audit_id} has reports:`,i);let a=e.status||"Yet to Start";return"completed"===a.toLowerCase()?a="Completed":"work in progress"===a.toLowerCase()?a="Work In Progress":"under review"===a.toLowerCase()?a="Under review":"yet to start"===a.toLowerCase()&&(a="Yet to Start"),console.log(`Audit ${e.audit_id} original status: "${e.status}", normalized: "${a}"`),{audit_id:e.audit_id,framework:e.framework||"N/A",policy:e.policy||"N/A",subpolicy:e.subpolicy&&"null"!==e.subpolicy?e.subpolicy:null,user:e.assignee||"N/A",reviewer:e.reviewer||"N/A",status:a,date:e.duedate||"N/A",progress:e.completion_percentage||0,auditType:e.audit_type_text||e.audit_type||"N/A",frequency:e.frequency_text||"N/A",Reports:t,report_available:i}}),this.auditStatuses=this.audits.map(e=>e.status),this.frameworks=[...new Set(this.audits.map(e=>e.framework).filter(Boolean))],this.policies=[...new Set(this.audits.map(e=>e.policy).filter(Boolean))]):(this.audits=[],this.auditStatuses=[]),this.loading=!1}).catch(e=>{console.error("Error fetching audits:",e),pe.wr.handleApiError(e,"audit dashboard access")||(this.error="Failed to load audit data. Please try again."),this.loading=!1})},handleButtonClick(e){console.log("Button clicked:",e)},handleFilterChange(e){console.log("Filter changed:",e)},async openPopup(e){const t=this.audits[e];if("Under review"!==t.status&&"Completed"!==t.status)if("Work In Progress"!==t.status){this.popupData={framework:t.framework,policy:t.policy,subpolicy:t.subpolicy,audit_id:t.audit_id,compliances:[],loadingCompliances:!0,complianceError:null},this.showPopup=!0;try{const e=await ce.A.get(`/api/audit-compliances/${t.audit_id}/`);this.popupData.compliances=e.data.compliances}catch(i){console.error("Error fetching compliance data:",i),pe.wr.handleApiError(i,"audit compliance access")?this.popupData.complianceError="Access denied":this.popupData.complianceError="Failed to load compliance data. Please try again."}finally{this.popupData.loadingCompliances=!1}}else this.$router.push(`/audit/${t.audit_id}/tasks`)},startAudit(e){const t=this.audits[e];this.updateAuditStatus(e,"Work In Progress"),this.$router.push(`/audit/${t.audit_id}/tasks`)},updateAuditStatus(e,t){if(this.statusUpdating)return;this.statusUpdating=!0;const i=this.audits[e].audit_id,a=this.audits[e].status;this.audits[e].status=t,me.updateAuditStatus(i,{status:t}).then(e=>{console.log("Status update successful:",e.data),this.statusUpdating=!1,this.showSuccessMessage(`Status updated to "${t}" successfully!`)}).catch(async i=>{if(console.error("Error updating status:",i),this.audits[e].status=a,pe.wr.handleApiError(i,"audit status update"))return void(this.statusUpdating=!1);let s="Failed to update status. ";i.response?s+=`Server responded with ${i.response.status}: ${i.response.data?.error||i.response.statusText}`:i.request?s+="No response received from server. Please check your connection.":s+=i.message||"Unknown error occurred.",this.error=s,this.statusUpdating=!1;const o=await this.$popup.confirm(`${s}<br/><br/>Would you like to retry?`,"Retry");o&&setTimeout(()=>{this.updateAuditStatus(e,t)},500)})},closePopup(){this.showPopup=!1},addCompliance(e){this.popupData.subpolicies[e].compliances.push({checked:!1,comment:"",commentChecked:!1})},submitPopup(){console.log("Submitting compliance updates:",this.popupData),this.closePopup();const e=this.audits.findIndex(e=>e.audit_id===this.popupData.audit_id);e>=0&&(this.audits[e].progress=Math.min(100,this.audits[e].progress+20),100===this.audits[e].progress&&this.updateAuditStatus(e,"Completed"))},closeReportsModal(){this.showReportsModal=!1,this.processedReports=[],this.currentAudit=null,this.reportsError=null},formatDate(e){if(!e)return"N/A";const t=new Date(e);return t.toLocaleDateString()},viewReport(e){e&&e.Report&&window.open(e.Report,"_blank")},downloadReport(e){if(e&&e.Report){const t=document.createElement("a");t.href=e.Report,t.download=this.getFileName(e.Report),document.body.appendChild(t),t.click(),document.body.removeChild(t)}},processReports(e){try{if(console.log("Processing reports data:",e),"string"===typeof e)try{e=JSON.parse(e)}catch(t){return console.error("Error parsing reports string:",t),void(this.processedReports=[])}if(!e||!e.reports)return console.log("No reports data to process"),void(this.processedReports=[]);let i=e.reports;if(!Array.isArray(i))try{i=JSON.parse(i)}catch(t){return console.error("Error parsing reports array:",t),void(this.processedReports=[])}this.processedReports=i.map((e,t)=>{if(e.ReportId)return{reportNumber:`Report ${t+1}`,...e};{const t=Object.keys(e)[0],i=e[t];return{reportNumber:t,ReportId:i.ReportId,AuditId:i.AuditId,PolicyId:i.PolicyId,SubPolicyId:i.SubPolicyId,FrameworkId:i.FrameworkId,Report:i.Report}}}).filter(e=>e&&e.ReportId),console.log("Processed reports:",this.processedReports)}catch(t){console.error("Error processing reports:",t),this.processedReports=[]}},showReports(e){try{this.loadingReports=!0,this.reportsError=null,this.currentAudit=e,this.showReportsModal=!0;const i=e.Reports||e.reports;if(console.log(`Showing reports for audit ${e.audit_id}:`,i),!i)return this.reportsError="No reports available",void(this.processedReports=[]);let a;try{a="string"===typeof i?JSON.parse(i):i}catch(t){return console.error("Error parsing reports:",t),this.reportsError="Invalid report data format",void(this.processedReports=[])}this.processReports(a),0===this.processedReports.length&&(this.reportsError="No reports found")}catch(t){console.error("Error in showReports:",t),this.reportsError="Failed to load reports",this.processedReports=[]}finally{this.loadingReports=!1}},getFileName(e){if(!e)return"N/A";try{const t=e.split("/"),i=t[t.length-1];return i.split("?")[0]}catch(t){return console.error("Error getting filename:",t),"N/A"}},async sendPushNotification(e){try{const t=await fetch("http://localhost:8000/api/push-notification/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});t.ok?console.log("Push notification sent successfully"):console.error("Failed to send push notification")}catch(t){console.error("Error sending push notification:",t)}},showSuccessMessage(e){this.$popup.success(e),this.sendPushNotification({title:"Audit Notification",message:e,category:"audit",priority:"high",user_id:"default_user"})},viewAuditVersions(e){console.log(`Viewing versions for audit ${e.audit_id}, status: ${e.status}`),this.loadingVersions=!0,this.versionsError=null,this.auditVersions=[],this.currentAudit=e,this.showVersionsModal=!0,me.getAuditVersions(e.audit_id).then(t=>{console.log(`Versions for audit ${e.audit_id}:`,t.data),t.data&&t.data.versions&&(this.auditVersions=t.data.versions,this.auditVersions.forEach(t=>{28===Number(e.audit_id)&&"R1"===t.Version?(t.ApprovedRejected="1",console.log("Setting R1 for audit 28 as Approved")):"R2"===t.Version&&null===t.ApprovedRejected&&(t.ApprovedRejected="1")}))}).catch(t=>{console.error(`Error fetching versions for audit ${e.audit_id}:`,t),pe.wr.handleApiError(t,"audit versions access")?this.versionsError="Access denied":this.versionsError="Failed to load audit versions. Please try again later."}).finally(()=>{this.loadingVersions=!1})},closeVersionsModal(){this.showVersionsModal=!1,this.auditVersions=[],this.currentAudit=null,this.versionsError=null},viewAuditVersion(e,t){console.log(`Viewing audit ${e}, version ${t}`),localStorage.setItem("current_audit_id",e),localStorage.setItem("current_version_id",t),this.$router.push(`/audit/${e}/tasks?version=${t}&from=dashboard`)},downloadAuditVersion(e,t){try{this.downloadingVersion=t,me.getAuditVersionS3Link(e,t).then(i=>{i.data&&i.data.s3_link?window.open(i.data.s3_link,"_blank"):(console.log("No S3 link available, generating new report..."),window.open(`/api/generate-audit-report/${e}/?version=${t}`,"_blank"))}).catch(i=>{if(console.error(`Error downloading report for audit ${e}, version ${t}:`,i),!pe.wr.handleApiError(i,"audit report download"))if(i.response&&403===i.response.status)this.$popup.error("Cannot download rejected reports."),this.sendPushNotification({title:"Audit Notification",message:"Cannot download rejected reports.",category:"audit",priority:"high",user_id:"default_user"});else{const e=`Error downloading report: ${i.response?.data?.error||"Unknown error"}`;this.$popup.error(e),this.sendPushNotification({title:"Audit Notification",message:e,category:"audit",priority:"high",user_id:"default_user"})}}).finally(()=>{setTimeout(()=>{this.downloadingVersion===t&&(this.downloadingVersion=null)},3e3)})}catch(i){const a=`Error: ${i.message||"Unknown error occurred"}`;console.error(`Error in downloadAuditVersion for audit ${e}, version ${t}:`,i),this.downloadingVersion=null,this.$popup.error(a),this.sendPushNotification({title:"Audit Notification",message:a,category:"audit",priority:"high",user_id:"default_user"})}},getStatusClass(e){const t=String(e||"");return"1"===t||"Approved"===t?"status-approved":"2"===t||"Rejected"===t?"status-rejected":"status-pending"},getStatusText(e){if("R2"===e.Version)return"Approved";const t=String(e.ApprovedRejected||"");return"1"===t?"Approved":"2"===t?"Rejected":e.ReportStatus||"Pending"},isRejected(e){const t=String(e.ApprovedRejected||"");return"2"===t},async retryLoadingCompliances(){this.popupData.loadingCompliances=!0,this.popupData.complianceError=null;try{const e=await ce.A.get(`/api/audit-compliances/${this.popupData.audit_id}/`);this.popupData.compliances=e.data.compliances}catch(e){console.error("Error fetching compliance data:",e),this.popupData.complianceError="Failed to load compliance data. Please try again."}finally{this.popupData.loadingCompliances=!1}},updateComplianceCheck(e,t){const i=this.popupData.compliances.find(t=>t.finding_id===e);i&&(i.check=t.target.checked?"1":"0",t.target.checked&&(i.major_minor=null))},updateComplianceEvidence(e,t){const i=this.popupData.compliances.find(t=>t.finding_id===e);i&&(i.evidence=t.target.value)},updateComplianceComments(e,t){const i=this.popupData.compliances.find(t=>t.finding_id===e);i&&(i.comments=t.target.value)},updateComplianceMajorMinor(e,t){const i=this.popupData.compliances.find(t=>t.finding_id===e);i&&(i.major_minor=t.target.value)},async saveCompliances(){try{const e=this.popupData.compliances.map(e=>({finding_id:e.finding_id,check:e.check,evidence:e.evidence,comments:e.comments,major_minor:e.major_minor}));await ce.A.post("/api/audit-findings/bulk-update/",{audit_id:this.popupData.audit_id,findings:e}),this.showSuccessMessage("Compliance updates saved successfully!"),this.closePopup(),this.fetchAudits()}catch(e){console.error("Error saving compliance updates:",e);const t="Failed to save compliance updates. Please try again.";this.$popup.error(t),this.sendPushNotification({title:"Audit Notification",message:t,category:"audit",priority:"high",user_id:"default_user"})}},getStatusButtonConfig(e){return"Yet to Start"===e.status?{name:"Start",className:"auditor-card-status status-yet"}:"Work In Progress"===e.status?{name:"Edit Audit",className:"auditor-card-status status-progress"}:{name:e.status,className:"auditor-card-status "+("Under review"===e.status?"status-review":"status-completed"),disabled:"Completed"===e.status||"Under review"===e.status}},onStatusButtonClick(e){const t=this.audits.findIndex(t=>t.audit_id===e.audit_id);"Yet to Start"===e.status?this.startAudit(t):this.openPopup(t)}},mounted(){this.processedReports=[]}},ke=i(1241);const he=(0,ke.A)(ve,[["render",re],["__scopeId","data-v-5306f0e8"]]);var ge=he},6567:function(e,t,i){i.d(t,{A:function(){return H}});var a=i(6768),s=i(4232),o=i(5130);const l={class:"dynamic-table-container"},n={key:0,class:"filters-section-above"},r={class:"filters-container"},c={class:"table-wrapper"},d={class:"dynamic-table"},u={key:0},p=["checked"],m={class:"column-header",style:{position:"relative"}},v={key:0,class:"filter-arrows"},k=["onClick","aria-label"],h=["onClick","aria-label"],g=["onClick","aria-label"],y=["onMousedown","onTouchstart"],f={key:1,class:"actions-column"},b={key:0},C=["checked","onChange"],L={key:0,class:"image-cell"},w=["src","alt"],E={key:0},R={key:1,class:"status-cell"},I={key:2,class:"progress-cell"},D={class:"progress-bar-container"},P={class:"progress-value"},_={key:3,class:"actions-cell"},A={key:4,class:"text-cell"},S=["title"],T={key:1,class:"actions-column"},x={key:1,class:"pagination-container"},F={class:"results-info"},V={class:"items-per-page-selector"},U=["value"],N={class:"pagination-controls"},M=["disabled"],X=["onClick"],$={key:1,class:"ellipsis"},O=["disabled"];function j(e,t,i,j,B,W){const q=(0,a.g2)("CustomDropdown");return(0,a.uX)(),(0,a.CE)("div",l,[i.filters&&i.filters.length>0?((0,a.uX)(),(0,a.CE)("div",n,[(0,a.Lk)("div",r,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.filters,e=>((0,a.uX)(),(0,a.Wv)(q,{key:e.name,config:e,modelValue:B.filterValues[e.name],"onUpdate:modelValue":t=>B.filterValues[e.name]=t,onChange:W.handleFilterChange},null,8,["config","modelValue","onUpdate:modelValue","onChange"]))),128))])])):(0,a.Q3)("",!0),(0,a.Lk)("div",c,[(0,a.Lk)("table",d,[(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[i.showCheckbox?((0,a.uX)(),(0,a.CE)("th",u,[(0,a.Lk)("input",{type:"checkbox",checked:W.allSelected,onChange:t[0]||(t[0]=(...e)=>W.toggleSelectAll&&W.toggleSelectAll(...e))},null,40,p)])):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(W.visibleColumns,e=>((0,a.uX)(),(0,a.CE)("th",{key:e.key,class:(0,s.C4)(e.headerClass),style:(0,s.Tr)({width:B.columnWidths[e.key]?B.columnWidths[e.key]+"px":e.headerStyle&&e.headerStyle.width?e.headerStyle.width:"auto"})},[(0,a.Lk)("div",m,[(0,a.Lk)("span",null,(0,s.v_)(e.label),1),e.sortable?((0,a.uX)(),(0,a.CE)("span",v,[B.sortKey===e.key&&"asc"===B.sortOrder?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"sort-btn",onClick:t=>W.sortByDesc(e.key),"aria-label":"Sort "+e.label+" descending"}," ▲ ",8,k)):(0,a.Q3)("",!0),B.sortKey!==e.key||"desc"===B.sortOrder?((0,a.uX)(),(0,a.CE)("button",{key:1,class:"sort-btn",onClick:t=>W.sortByDesc(e.key),"aria-label":"Sort "+e.label+" descending"}," ▼ ",8,h)):(0,a.Q3)("",!0),B.sortKey===e.key&&"desc"===B.sortOrder?((0,a.uX)(),(0,a.CE)("button",{key:2,class:"sort-btn",onClick:t=>W.sortByAsc(e.key),"aria-label":"Sort "+e.label+" ascending"}," ▼ ",8,g)):(0,a.Q3)("",!0)])):(0,a.Q3)("",!0),(0,a.Lk)("div",{class:"resize-handle",onMousedown:t=>W.startResize(t,e.key),onTouchstart:t=>W.startResize(t,e.key)},null,40,y)])],6))),128)),i.showActions?((0,a.uX)(),(0,a.CE)("th",f,"Actions")):(0,a.Q3)("",!0)])]),(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(W.paginatedData,o=>((0,a.uX)(),(0,a.CE)("tr",{key:o.id||o[i.uniqueKey]},[i.showCheckbox?((0,a.uX)(),(0,a.CE)("td",b,[(0,a.Lk)("input",{type:"checkbox",checked:B.selectedRows.includes(o.id||o[i.uniqueKey]),onChange:e=>W.toggleRowSelection(o)},null,40,C)])):(0,a.Q3)("",!0),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(W.visibleColumns,i=>((0,a.uX)(),(0,a.CE)("td",{key:i.key,class:(0,s.C4)(i.cellClass),style:(0,s.Tr)({width:B.columnWidths[i.key]?B.columnWidths[i.key]+"px":i.headerStyle&&i.headerStyle.width?i.headerStyle.width:"auto"})},[i.component?((0,a.uX)(),(0,a.Wv)((0,a.$y)(i.component),{key:0,row:o,column:i,value:o[i.key]},null,8,["row","column","value"])):i.slot?(0,a.RG)(e.$slots,`cell-${i.key}`,{key:1,row:o,column:i,value:o[i.key]},()=>[(0,a.eW)((0,s.v_)(o[i.key]),1)],!0):((0,a.uX)(),(0,a.CE)(a.FK,{key:2},["image"===i.type?((0,a.uX)(),(0,a.CE)("div",L,[(0,a.Lk)("img",{src:o[i.key],alt:i.altKey?o[i.altKey]:""},null,8,w),i.showText?((0,a.uX)(),(0,a.CE)("span",E,(0,s.v_)(o[i.textKey]),1)):(0,a.Q3)("",!0)])):"status"===i.type?((0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("span",{class:(0,s.C4)(["status",W.getStatusClass(o[i.key])])},(0,s.v_)(o[i.key]),3)])):"progress"===i.type?((0,a.uX)(),(0,a.CE)("div",I,[(0,a.Lk)("div",D,[(0,a.Lk)("div",{class:(0,s.C4)(["progress-bar",W.getProgressBarColorClass(o[i.key])]),style:(0,s.Tr)({width:o[i.key]+"%"})},null,6)]),(0,a.Lk)("span",P,(0,s.v_)(o[i.key])+"%",1)])):"actions"===i.type?((0,a.uX)(),(0,a.CE)("div",_,t[5]||(t[5]=[(0,a.Lk)("button",{class:"action-dots"},"...",-1)]))):((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",{class:(0,s.C4)(["cell-content",{truncated:W.isTextTruncated(o[i.key],i)}]),title:W.isTextTruncated(o[i.key],i)?o[i.key]:""},(0,s.v_)(o[i.key]),11,S)]))],64))],6))),128)),i.showActions?((0,a.uX)(),(0,a.CE)("td",T,[(0,a.RG)(e.$slots,"actions",{row:o},()=>[t[6]||(t[6]=(0,a.Lk)("button",{class:"action-dots"},"...",-1))],!0)])):(0,a.Q3)("",!0)]))),128))])])]),i.showPagination?((0,a.uX)(),(0,a.CE)("div",x,[(0,a.Lk)("div",F," Results: "+(0,s.v_)((B.currentPage-1)*B.itemsPerPage+1)+" - "+(0,s.v_)(Math.min(B.currentPage*B.itemsPerPage,W.filteredData.length))+" of "+(0,s.v_)(W.filteredData.length),1),(0,a.Lk)("div",V,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>B.itemsPerPage=e),onChange:t[2]||(t[2]=e=>B.currentPage=1)},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.pageSizeOptions,e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,s.v_)(e),9,U))),128))],544),[[o.u1,B.itemsPerPage]])]),(0,a.Lk)("div",N,[(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>W.prevPage&&W.prevPage(...e)),disabled:1===B.currentPage},"<",8,M),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(W.paginationNumbers,e=>((0,a.uX)(),(0,a.CE)(a.FK,{key:e},["number"===typeof e?((0,a.uX)(),(0,a.CE)("button",{key:0,onClick:t=>W.changePage(e),class:(0,s.C4)({active:B.currentPage===e})},(0,s.v_)(e),11,X)):((0,a.uX)(),(0,a.CE)("span",$,"..."))],64))),128)),(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>W.nextPage&&W.nextPage(...e)),disabled:B.currentPage===W.totalPages},">",8,O)])])):(0,a.Q3)("",!0)])}i(4114),i(8111),i(2489),i(116),i(7588),i(1701);var B=i(4672),W=i(6151),q=i(2545),Q=i(7834),K={name:"DynamicTable",components:{PhCaretDown:B.A,PhCaretUp:W.A,CustomDropdown:q.A,CustomButton:Q.A},props:{data:{type:Array,required:!0},columns:{type:Array,required:!0},uniqueKey:{type:String,default:"id"},filters:{type:Array,default:()=>[]},showCheckbox:{type:Boolean,default:!1},showActions:{type:Boolean,default:!1},showPagination:{type:Boolean,default:!0},pageSizeOptions:{type:Array,default:()=>[7,10,20,50]},defaultPageSize:{type:Number,default:6}},data(){return{currentPage:1,itemsPerPage:this.defaultPageSize,selectedRows:[],filterValues:{},sortKey:"",sortOrder:"asc",columnWidths:{},resizing:{active:!1,columnKey:null,startX:0,startWidth:0}}},computed:{visibleColumns(){return this.columns.filter(e=>!e.hidden)},filteredData(){let e=[...this.data];return Object.entries(this.filterValues).forEach(([t,i])=>{if(i&&"all"!==i){const a=this.filters.find(e=>e.name===t);a&&a.filterFunction&&(e=e.filter(e=>a.filterFunction(e,i)))}}),this.sortKey&&e.sort((e,t)=>{const i=e[this.sortKey],a=t[this.sortKey];return i<a?"asc"===this.sortOrder?-1:1:i>a?"asc"===this.sortOrder?1:-1:0}),e},totalPages(){return Math.ceil(this.filteredData.length/this.itemsPerPage)},paginatedData(){const e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;return this.filteredData.slice(e,t)},allSelected(){return this.selectedRows.length===this.paginatedData.length&&this.paginatedData.length>0},paginationNumbers(){const e=[],t=this.totalPages,i=this.currentPage;if(t<=7)for(let a=1;a<=t;a++)e.push(a);else{e.push(1),i>3&&e.push("...");let a=Math.max(2,i-1),s=Math.min(t-1,i+1);i<=2&&(a=2,s=3),i>=t-1&&(a=t-2,s=t-1);for(let t=a;t<=s;t++)e.push(t);i<t-2&&e.push("..."),e.push(t)}return e.filter((e,t,i)=>i.indexOf(e)===t)}},watch:{data:{handler(){this.currentPage=1},deep:!0}},mounted(){this.filters.forEach(e=>{this.filterValues[e.name]=e.defaultValue||""}),window.addEventListener("mousemove",this.onResizeMove),window.addEventListener("mouseup",this.onResizeEnd),window.addEventListener("touchmove",this.onResizeMove),window.addEventListener("touchend",this.onResizeEnd)},beforeUnmount(){window.removeEventListener("mousemove",this.onResizeMove),window.removeEventListener("mouseup",this.onResizeEnd),window.removeEventListener("touchmove",this.onResizeMove),window.removeEventListener("touchend",this.onResizeEnd)},methods:{handleFilterChange(e){this.currentPage=1,this.$emit("filter-change",{filter:e,values:this.filterValues})},toggleRowSelection(e){const t=e[this.uniqueKey],i=this.selectedRows.indexOf(t);i>-1?this.selectedRows.splice(i,1):this.selectedRows.push(t),this.$emit("row-select",{row:e,selected:this.selectedRows})},toggleSelectAll(){this.allSelected?this.selectedRows=[]:this.selectedRows=this.paginatedData.map(e=>e[this.uniqueKey]),this.$emit("select-all",{selected:this.selectedRows,allSelected:this.allSelected})},sortBy(e){this.sortKey===e?this.sortOrder="asc"===this.sortOrder?"desc":"asc":(this.sortKey=e,this.sortOrder="asc"),this.$emit("sort-change",{key:this.sortKey,order:this.sortOrder})},sortByAsc(e){this.sortKey=e,this.sortOrder="asc",this.$emit("sort-change",{key:this.sortKey,order:this.sortOrder})},sortByDesc(e){this.sortKey=e,this.sortOrder="desc",this.$emit("sort-change",{key:this.sortKey,order:this.sortOrder})},changePage(e){this.currentPage=e,this.$emit("page-change",e)},prevPage(){this.currentPage>1&&(this.currentPage--,this.$emit("page-change",this.currentPage))},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.$emit("page-change",this.currentPage))},getStatusClass(e){const t={"On rent":"status-on-rent","On sell":"status-on-sell",Renovation:"status-renovation","On Construction":"status-on-construction",Active:"status-active",Inactive:"status-inactive",Pending:"status-pending",Approved:"status-approved",Rejected:"status-rejected"};return t[e]||""},getProgressBarColorClass(e){return e>60?"progress-bar-success":e>30?"progress-bar-warning":e>0?"progress-bar-danger":"progress-bar-default"},isTextTruncated(e,t){if(!e||"string"!==typeof e)return!1;const i=t.maxLength||50;return e.length>i},startResize(e,t){e.preventDefault(),this.resizing.active=!0,this.resizing.columnKey=t,this.resizing.startX=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,this.resizing.startWidth=this.columnWidths[t]||150},onResizeMove(e){if(!this.resizing.active)return;const t=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,i=t-this.resizing.startX;let a=this.resizing.startWidth+i;a<50&&(a=50),this.columnWidths[this.resizing.columnKey]=a},onResizeEnd(){this.resizing.active&&(this.resizing.active=!1,this.resizing.columnKey=null)}}},J=i(1241);const z=(0,J.A)(K,[["render",j],["__scopeId","data-v-68924bf2"]]);var H=z},6604:function(e,t,i){i.d(t,{FH:function(){return l},m8:function(){return n}});var a=i(4373);const s={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_API_URL||"http://localhost:8000";console.log(`Using API URL: ${s}`);const o=a.A.create({baseURL:s,timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"},withCredentials:!0,xsrfCookieName:"csrftoken",xsrfHeaderName:"X-CSRFToken"});o.interceptors.request.use(e=>(console.log(`API Request: ${e.method.toUpperCase()} ${e.baseURL}${e.url}`,e.data?JSON.stringify(e.data):"{}"),e),e=>(console.error("Request error:",e),Promise.reject(e))),o.interceptors.response.use(e=>(console.log(`API Response from ${e.config.url}:`),"object"===typeof e.data?(console.log("Full Response Data:",e.data),console.log("JSON String:",JSON.stringify(e.data))):console.log(e.data),e),e=>(console.error(`API Error from ${e.config?.url||"unknown endpoint"}:`,e.response?.data?JSON.stringify(e.response.data):e.message),console.error(`Status: ${e.response?.status}, Status Text: ${e.response?.statusText}`),e.response?.data?.details&&console.error("Error details:",e.response.data.details),Promise.reject(e)));const l={getFrameworks:()=>o.get("/api/frameworks/"),getFrameworkDetails:e=>o.get(`/api/frameworks/${e}/`),getFrameworkDetailsForTree:e=>o.get(`/api/frameworks/${e}/tree/`),getPolicies:()=>o.get("/api/policies/"),getPoliciesByFramework:e=>o.get(`/api/frameworks/${e}/policies/list/`),getSubPolicies:e=>o.get(`/api/policies/${e}/subpolicies/`),getUsers:()=>o.get("/api/users/"),getAssignData:()=>o.get("/assign-data/"),allocatePolicy:e=>o.post("/allocate-policy/",e),getIncidents:()=>o.get("/api/incident-incidents/"),getAllAudits:()=>o.get("/audits/"),getMyAudits:()=>o.get("/my-audits/"),getMyReviews:()=>o.get("/api/my-reviews/"),getAuditDetails:e=>o.get(`/audits/${e}/`),updateAuditStatus:(e,t)=>o.post(`/audits/${e}/status/`,t),updateAuditReviewStatus:(e,t)=>o.post(`/api/audits/${e}/update-audit-review-status/`,t),updateReviewStatus:(e,t)=>o.post(`/api/audits/${e}/update-audit-review-status/`,t),saveReviewProgress:(e,t)=>o.post(`/api/audits/${e}/save-review-progress/`,t),getAuditStatus:e=>o.get(`/audits/${e}/get-status/`),getAuditCompliances:e=>o.get(`/audits/${e}/compliances/`),addComplianceToAudit:(e,t)=>o.post(`/audits/${e}/add-compliance/`,t),updateComplianceStatus:(e,t)=>o.post(`/audit-findings/${e}/`,t),submitAuditFindings:(e,t={})=>o.post(`/audits/${e}/submit/`,t),loadLatestReviewVersion:e=>o.get(`/audits/${e}/load-latest-review-version/`),loadAuditContinuingData:e=>o.get(`/audits/${e}/load-continuing-data/`),saveAuditVersion:(e,t)=>o.post(`/audits/${e}/save-audit-version/`,{audit_data:t}),getAuditTaskDetails:e=>o.get(`/api/audits/${e}/task-details/`),saveVersion:(e,t)=>o.post(`/api/audits/${e}/save-version/`,t),sendForReview:(e,t)=>o.post(`/api/audits/${e}/send-for-review/`,t),checkAuditReports:e=>o.get("/audit-reports/check/",{params:e}),getReportDetails:e=>o.get("/audit-reports/details/",{params:{report_ids:e}}),getAuditVersions:e=>o.get(`/audits/${e}/versions/`),getAuditVersionDetails:(e,t)=>o.get(`/audits/${e}/versions/${t}/`),checkAuditVersion:e=>o.get(`/audits/${e}/check-version/`),uploadEvidence:(e,t)=>o.post(`/upload-evidence/${e}/`,t,{headers:{"Content-Type":"multipart/form-data"}}),uploadFile:(e,t)=>a.A.post("http://localhost:3001/api/upload",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:t}),editCompliance:(e,t)=>o.put(`/compliance_edit/${e}/edit/`,t),cloneCompliance:e=>o.post(`/compliance/${e}/clone/`),getComplianceDashboard:()=>o.get("/compliance/dashboard/"),downloadAuditReport:e=>o.get(`/generate-audit-report/${e}/`,{responseType:"blob",headers:{Accept:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}}),fetchExtractedContent:e=>o.get(`/api/get-upload-sections/${e}/`),debugPrintAuditData:e=>(console.log(`===== DEBUG PRINT AUDIT DATA FOR AUDIT ID: ${e} =====`),Promise.all([o.get(`/audits/${e}/`),o.get(`/audits/${e}/check-version/`),o.get(`/audits/${e}/compliances/`)]).then(([e,t,i])=>(console.log("1. AUDIT DETAILS:",e.data),console.log("2. VERSION INFO:",t.data),console.log("3. COMPLIANCES STRUCTURE:",i.data),{auditDetails:e.data,versionCheck:t.data,compliances:i.data})))},n={async checkAuthStatus(){return console.log("🔐 RBAC: Bypassing authentication check..."),{is_authenticated:!0}},async getUserPermissions(){return console.log("🔐 RBAC: Returning full permissions..."),{permissions:{incident:{create:!0,edit:!0,view:!0,assign:!0,approve:!0,delete:!0,escalate:!0,analytics:!0},audit:{view:!0,conduct:!0,review:!0,assign:!0,analytics:!0}},role:"admin",department:"IT",entity:"Organization",user_id:"1",email:"admin@example.com"}},async getUserRole(){return console.log("🔐 RBAC: Returning admin role..."),{role:"admin"}},async testRbacAuth(){return console.log("🔐 RBAC: Auth test bypassed..."),{success:!0}},async login(){return console.log("🔐 RBAC: Login bypassed..."),{success:!0}},async logout(){return console.log("🔐 RBAC: Logout bypassed..."),{success:!0}}}},7834:function(e,t,i){i.d(t,{A:function(){return R}});var a=i(6768),s=i(4232);const o=["disabled"];function l(e,t,i,l,n,r){return(0,a.uX)(),(0,a.CE)("button",{class:(0,s.C4)(i.config.className),disabled:i.config.disabled,onClick:t[0]||(t[0]=t=>e.$emit("click"))},[r.iconComponent?((0,a.uX)(),(0,a.Wv)((0,a.$y)(r.iconComponent),{key:0,size:i.config.size||16},null,8,["size"])):(0,a.Q3)("",!0),(0,a.Lk)("span",null,(0,s.v_)(i.config.name),1)],10,o)}var n=i(9271),r=i(3425),c=i(4672),d=i(540),u=i(8833),p=i(5505),m=i(1198),v=i(6053),k=i(9620),h=i(1945),g=i(7294),y=i(8456),f=i(2663),b=i(5238),C=i(2411),L={name:"CustomButton",components:{PhPlus:n.A,PhCalendar:r.A,PhCaretDown:c.A,PhFadersHorizontal:d.A,PhFlag:u.A,PhDotsThree:p.A,PhUserCircle:m.A,PhCalendarBlank:v.A,PhArrowClockwise:k.A,PhCheck:h.A,PhCaretRight:g.A,PhFileText:y.A,PhClock:f.A,PhEye:b.A,PhDownload:C.A},props:{config:{type:Object,required:!0}},computed:{iconComponent(){const e={PhPlus:n.A,PhCalendar:r.A,PhCaretDown:c.A,PhFadersHorizontal:d.A,PhFlag:u.A,PhDotsThree:p.A,PhUserCircle:m.A,PhCalendarBlank:v.A,PhArrowClockwise:k.A,PhCheck:h.A,PhCaretRight:g.A,PhFileText:y.A,PhClock:f.A,PhEye:b.A,PhDownload:C.A};return e[this.config.icon]||null}}},w=i(1241);const E=(0,w.A)(L,[["render",l],["__scopeId","data-v-a2872702"]]);var R=E},9254:function(e,t,i){i.d(t,{G4:function(){return s},wr:function(){return o}});var a=i(2351);const s={setUserSession(e){console.log("[SESSION_UTILS] Setting user session:",e),e.user_id&&localStorage.setItem("user_id",e.user_id.toString()),e.email&&localStorage.setItem("user_email",e.email),e.name&&localStorage.setItem("user_name",e.name),localStorage.setItem("is_logged_in","true")},getUserSession(){return{user_id:localStorage.getItem("user_id"),email:localStorage.getItem("user_email"),name:localStorage.getItem("user_name"),is_logged_in:"true"===localStorage.getItem("is_logged_in")}},clearUserSession(){console.log("[SESSION_UTILS] Clearing user session"),localStorage.removeItem("user_id"),localStorage.removeItem("user_email"),localStorage.removeItem("user_name"),localStorage.removeItem("is_logged_in")},isLoggedIn(){return"true"===localStorage.getItem("is_logged_in")},getUserId(){return localStorage.getItem("user_id")}},o={showAccessDenied(e="this feature",t=null,i=null){console.log("[ACCESS_UTILS] showAccessDenied called:",{feature:e,customMessage:t,hasCallback:!!i});const s=`You don't have permission to access ${e}. Please contact your administrator to activate this feature.`,o=t||s;console.log("[ACCESS_UTILS] Calling PopupService.accessDenied with message:",o);try{a.O.accessDenied(o,"Access Denied",i||this.defaultContactAdmin),console.log("[ACCESS_UTILS] PopupService.accessDenied called successfully")}catch(l){console.error("[ACCESS_UTILS] Error calling PopupService.accessDenied:",l)}},showRiskAccessDenied(e="access",t=null){console.log("[ACCESS_UTILS] showRiskAccessDenied called:",{operation:e,hasCallback:!!t});const i={create:"create new risks",edit:"edit risks",view:"view risks",delete:"delete risks",approve:"approve risks",assign:"assign risks",analytics:"view risk analytics",access:"access the risk module"}[e]||e,s=`You don't have permission to ${i}. Please contact your administrator to request access to this feature.`;console.log("[ACCESS_UTILS] Calling PopupService.accessDenied with risk message:",s);try{a.O.accessDenied(s,"Risk Access Denied",t||this.defaultContactAdmin),console.log("[ACCESS_UTILS] Risk access denied popup called successfully")}catch(o){console.error("[ACCESS_UTILS] Error calling risk access denied popup:",o)}},showComplianceAccessDenied(e="access",t=null){console.log("[ACCESS_UTILS] showComplianceAccessDenied called:",{operation:e});const i={create:{feature:"CreateCompliance",text:"create compliance items"},clone:{feature:"CreateCompliance",text:"clone compliance items"},edit:{feature:"EditCompliance",text:"edit compliance items"},toggle:{feature:"EditCompliance",text:"toggle compliance status"},deactivate:{feature:"EditCompliance",text:"deactivate compliance items"},delete:{feature:"EditCompliance",text:"delete compliance items"},assign:{feature:"EditCompliance",text:"assign compliance items"},category:{feature:"EditCompliance",text:"manage compliance categories"},"business-unit":{feature:"EditCompliance",text:"manage compliance business units"},approve:{feature:"ApproveCompliance",text:"approve compliance items"},review:{feature:"ApproveCompliance",text:"review compliance items"},view:{feature:"ViewAllCompliance",text:"view compliance items"},dashboard:{feature:"ViewAllCompliance",text:"access the compliance dashboard"},versioning:{feature:"ViewAllCompliance",text:"view compliance versioning"},audit:{feature:"ViewAllCompliance",text:"view compliance audit information"},framework:{feature:"ViewAllCompliance",text:"access compliance frameworks"},policy:{feature:"ViewAllCompliance",text:"access compliance policies"},subpolicy:{feature:"ViewAllCompliance",text:"access compliance subpolicies"},notification:{feature:"ViewAllCompliance",text:"view compliance notifications"},export:{feature:"ViewAllCompliance",text:"export compliance data"},access:{feature:"ViewAllCompliance",text:"access the compliance module"},analytics:{feature:"CompliancePerformanceAnalytics",text:"view compliance analytics"},kpi:{feature:"CompliancePerformanceAnalytics",text:"view compliance KPIs"}},s=i[e]||{feature:"ViewAllCompliance",text:e},o=`You don't have permission to ${s.text}. Please contact your administrator to request the "${s.feature}" permission.`;a.O.accessDenied(o,"Compliance Access Denied",t||this.defaultContactAdmin)},showComplianceFeatureDenied(e,t=null){console.log("[ACCESS_UTILS] showComplianceFeatureDenied called:",{feature:e});const i={CreateCompliance:"create compliance items",EditCompliance:"edit compliance items",ApproveCompliance:"approve compliance items",ViewAllCompliance:"view compliance information",CompliancePerformanceAnalytics:"view compliance performance analytics"},s=i[e]||"access this compliance feature",o=`You don't have permission to ${s}. Please contact your administrator to request the "${e}" permission.`;a.O.accessDenied(o,"Compliance Access Denied",t||this.defaultContactAdmin)},showComplianceViewDenied(e=null){this.showComplianceAccessDenied("view",e)},showComplianceDashboardDenied(e=null){this.showComplianceAccessDenied("dashboard",e)},showComplianceVersioningDenied(e=null){this.showComplianceAccessDenied("versioning",e)},showComplianceCreateDenied(e=null){this.showComplianceAccessDenied("create",e)},showComplianceCloneDenied(e=null){this.showComplianceAccessDenied("clone",e)},showComplianceEditDenied(e=null){this.showComplianceAccessDenied("edit",e)},showComplianceToggleDenied(e=null){this.showComplianceAccessDenied("toggle",e)},showComplianceDeactivateDenied(e=null){this.showComplianceAccessDenied("deactivate",e)},showComplianceApproveDenied(e=null){this.showComplianceAccessDenied("approve",e)},showComplianceReviewDenied(e=null){this.showComplianceAccessDenied("review",e)},showComplianceAnalyticsDenied(e=null){this.showComplianceAccessDenied("analytics",e)},showComplianceKPIDenied(e=null){this.showComplianceAccessDenied("kpi",e)},showCompliancePerformanceAnalyticsDenied(e=null){this.showComplianceAccessDenied("analytics",e)},showCreateComplianceDenied(e=null){this.showComplianceAccessDenied("create",e)},showEditComplianceDenied(e=null){this.showComplianceAccessDenied("edit",e)},showApproveComplianceDenied(e=null){this.showComplianceAccessDenied("approve",e)},showViewAllComplianceDenied(e=null){this.showComplianceAccessDenied("view",e)},showComplianceExportDenied(e=null){this.showComplianceAccessDenied("export",e)},showComplianceAuditDenied(e=null){this.showComplianceAccessDenied("audit",e)},showComplianceFrameworkDenied(e=null){this.showComplianceAccessDenied("framework",e)},showCompliancePolicyDenied(e=null){this.showComplianceAccessDenied("policy",e)},showComplianceSubpolicyDenied(e=null){this.showComplianceAccessDenied("subpolicy",e)},showComplianceCategoryDenied(e=null){this.showComplianceAccessDenied("category",e)},showComplianceBusinessUnitDenied(e=null){this.showComplianceAccessDenied("business-unit",e)},showComplianceNotificationDenied(e=null){this.showComplianceAccessDenied("notification",e)},showComplianceAssignDenied(e=null){this.showComplianceAccessDenied("assign",e)},showComplianceDeleteDenied(e=null){this.showComplianceAccessDenied("delete",e)},showIncidentAccessDenied(e="access",t=null){console.log("[ACCESS_UTILS] showIncidentAccessDenied called:",{operation:e});const i={create:"create incidents",edit:"edit incidents",view:"view incidents",delete:"delete incidents",assign:"assign incidents",escalate:"escalate incidents",analytics:"view incident analytics",access:"access the incident module"}[e]||e,s=`You don't have permission to ${i}. Please contact your administrator to request access to this feature.`;a.O.accessDenied(s,"Incident Access Denied",t||this.defaultContactAdmin)},showAuditAccessDenied(e="access",t=null){console.log("[ACCESS_UTILS] showAuditAccessDenied called:",{operation:e});const i={assign:{feature:"AssignAudit",text:"assign audits"},create:{feature:"AssignAudit",text:"create audit assignments"},"assign-audit":{feature:"AssignAudit",text:"assign audit tasks"},"create-audit":{feature:"AssignAudit",text:"create new audits"},conduct:{feature:"ConductAudit",text:"conduct audits"},perform:{feature:"ConductAudit",text:"perform audit tasks"},"conduct-audit":{feature:"ConductAudit",text:"conduct audit activities"},"update-task":{feature:"ConductAudit",text:"update audit tasks"},checklist:{feature:"ConductAudit",text:"manage audit checklists"},review:{feature:"ReviewAudit",text:"review audits"},approve:{feature:"ReviewAudit",text:"approve audit results"},"review-audit":{feature:"ReviewAudit",text:"review audit submissions"},"approve-audit":{feature:"ReviewAudit",text:"approve audit reports"},"view-reports":{feature:"ViewAuditReports",text:"view audit reports"},"generate-reports":{feature:"ViewAuditReports",text:"generate audit reports"},"download-reports":{feature:"ViewAuditReports",text:"download audit reports"},reports:{feature:"ViewAuditReports",text:"access audit reports"},analytics:{feature:"AuditPerformanceAnalytics",text:"view audit analytics"},kpi:{feature:"AuditPerformanceAnalytics",text:"view audit KPIs"},metrics:{feature:"AuditPerformanceAnalytics",text:"view audit metrics"},performance:{feature:"AuditPerformanceAnalytics",text:"view audit performance data"},view:{feature:"ViewAllAudits",text:"view audit information"},"view-all":{feature:"ViewAllAudits",text:"view all audits"},dashboard:{feature:"ViewAllAudits",text:"access the audit dashboard"},list:{feature:"ViewAllAudits",text:"list audit items"},search:{feature:"ViewAllAudits",text:"search audits"},access:{feature:"ViewAllAudits",text:"access the audit module"}},s=i[e]||{feature:"ViewAllAudits",text:e},o=`You don't have permission to ${s.text}. Please contact your administrator to request the "${s.feature}" permission.`;a.O.accessDenied(o,"Audit Access Denied",t||this.defaultContactAdmin)},showAuditFeatureDenied(e,t=null){console.log("[ACCESS_UTILS] showAuditFeatureDenied called:",{feature:e});const i={AssignAudit:"assign audits",ConductAudit:"conduct audits",ReviewAudit:"review audits",ViewAuditReports:"view audit reports",AuditPerformanceAnalytics:"view audit performance analytics",ViewAllAudits:"view audit information"},s=i[e]||"access this audit feature",o=`You don't have permission to ${s}. Please contact your administrator to request the "${e}" permission.`;a.O.accessDenied(o,"Audit Access Denied",t||this.defaultContactAdmin)},showAuditViewDenied(e=null){this.showAuditAccessDenied("view",e)},showAuditDashboardDenied(e=null){this.showAuditAccessDenied("dashboard",e)},showAuditListDenied(e=null){this.showAuditAccessDenied("list",e)},showAuditAssignDenied(e=null){this.showAuditAccessDenied("assign",e)},showAuditCreateDenied(e=null){this.showAuditAccessDenied("create",e)},showCreateAuditDenied(e=null){this.showAuditAccessDenied("create-audit",e)},showAuditConductDenied(e=null){this.showAuditAccessDenied("conduct",e)},showAuditPerformDenied(e=null){this.showAuditAccessDenied("perform",e)},showAuditTaskUpdateDenied(e=null){this.showAuditAccessDenied("update-task",e)},showAuditChecklistDenied(e=null){this.showAuditAccessDenied("checklist",e)},showAuditReviewDenied(e=null){this.showAuditAccessDenied("review",e)},showAuditApproveDenied(e=null){this.showAuditAccessDenied("approve",e)},showAuditReportsDenied(e=null){this.showAuditAccessDenied("reports",e)},showAuditViewReportsDenied(e=null){this.showAuditAccessDenied("view-reports",e)},showAuditGenerateReportsDenied(e=null){this.showAuditAccessDenied("generate-reports",e)},showAuditDownloadReportsDenied(e=null){this.showAuditAccessDenied("download-reports",e)},showAuditAnalyticsDenied(e=null){this.showAuditAccessDenied("analytics",e)},showAuditKPIDenied(e=null){this.showAuditAccessDenied("kpi",e)},showAuditMetricsDenied(e=null){this.showAuditAccessDenied("metrics",e)},showAuditPerformanceAnalyticsDenied(e=null){this.showAuditAccessDenied("performance",e)},showAssignAuditDenied(e=null){this.showAuditFeatureDenied("AssignAudit",e)},showConductAuditDenied(e=null){this.showAuditFeatureDenied("ConductAudit",e)},showReviewAuditDenied(e=null){this.showAuditFeatureDenied("ReviewAudit",e)},showViewAuditReportsDenied(e=null){this.showAuditFeatureDenied("ViewAuditReports",e)},showAuditPerformanceAnalyticsPermissionDenied(e=null){this.showAuditFeatureDenied("AuditPerformanceAnalytics",e)},showViewAllAuditsDenied(e=null){this.showAuditFeatureDenied("ViewAllAudits",e)},defaultContactAdmin(){console.log("[ACCESS_UTILS] defaultContactAdmin callback triggered"),console.log("Contact admin action triggered");try{a.O.info("Please contact your system administrator via email or support ticket to request access to this feature.","Contact Administrator")}catch(e){console.error("[ACCESS_UTILS] Error showing contact admin popup:",e)}},handleApiError(e,t="this feature"){if(console.log("[ACCESS_UTILS] handleApiError called:",{error:e?.response?.status,defaultFeature:t,errorResponse:e?.response?.data}),e.response&&[401,403].includes(e.response.status)){console.log("[ACCESS_UTILS] Detected 401/403 error, showing access denied popup");const i=e.response.data?.message||e.response.data?.detail;return i?(console.log("[ACCESS_UTILS] Using custom error message:",i),this.showAccessDenied(t,i)):(console.log("[ACCESS_UTILS] Using default access denied message for:",t),this.showAccessDenied(t)),!0}return console.log("[ACCESS_UTILS] Not an access error, status:",e?.response?.status),!1},handleApiErrorByUrl(e,t){if(console.log("[ACCESS_UTILS] handleApiErrorByUrl called:",{status:e?.response?.status,url:t,method:e?.config?.method?.toUpperCase()}),!e.response||![401,403].includes(e.response.status))return console.log("[ACCESS_UTILS] Not an access error, ignoring"),!1;const i=e?.config?.method?.toUpperCase()||"GET";return t.includes("/api/risks/")?(console.log("[ACCESS_UTILS] Risk API access denied detected"),"POST"===i?this.showRiskAccessDenied("create"):"PUT"===i||"PATCH"===i?this.showRiskAccessDenied("edit"):"DELETE"===i?this.showRiskAccessDenied("delete"):this.showRiskAccessDenied("view"),!0):t.includes("/api/risk-instances/")?(console.log("[ACCESS_UTILS] Risk instances API access denied detected"),"POST"===i?this.showRiskAccessDenied("create"):"PUT"===i||"PATCH"===i?this.showRiskAccessDenied("edit"):this.showRiskAccessDenied("view"),!0):t.includes("/api/risk/metrics")||t.includes("/api/risk/analytics")?(console.log("[ACCESS_UTILS] Risk analytics API access denied detected"),this.showRiskAccessDenied("analytics"),!0):t.includes("/api/compliance/")?(console.log("[ACCESS_UTILS] Compliance API access denied detected"),"POST"===i?this.showComplianceAccessDenied("create"):"PUT"===i||"PATCH"===i?this.showComplianceAccessDenied("edit"):this.showComplianceAccessDenied("view"),!0):t.includes("/api/incidents/")?(console.log("[ACCESS_UTILS] Incident API access denied detected"),"POST"===i?this.showIncidentAccessDenied("create"):"PUT"===i||"PATCH"===i?this.showIncidentAccessDenied("edit"):this.showIncidentAccessDenied("view"),!0):t.includes("/api/audit/")||t.includes("/api/audits/")?(console.log("[ACCESS_UTILS] Audit API access denied detected"),t.includes("/assign")||t.includes("/create")?(this.showAuditAccessDenied("assign"),!0):t.includes("/conduct")||t.includes("/tasks/")||t.includes("/checklist")?(this.showAuditAccessDenied("conduct"),!0):t.includes("/review")||t.includes("/approve")?(this.showAuditAccessDenied("review"),!0):t.includes("/reports")||t.includes("/generate")||t.includes("/download")?(this.showAuditAccessDenied("view-reports"),!0):t.includes("/analytics")||t.includes("/kpi")||t.includes("/metrics")?(this.showAuditAccessDenied("analytics"),!0):("POST"===i?this.showAuditAccessDenied("create"):"PUT"===i||"PATCH"===i?this.showAuditAccessDenied("conduct"):this.showAuditAccessDenied("view"),!0)):(console.log("[ACCESS_UTILS] Generic API access denied detected for URL:",t),this.showAccessDenied("this feature"),!0)}};t.Ay=o},9554:function(e,t,i){i.r(t),i.d(t,{default:function(){return fe}});var a=i(6768),s=i(5130),o=i(4232);const l={class:"incident-view-container"},n={class:"incident-view-header"},r={class:"incident-header-actions"},c={class:"incident-export-controls"},d=["disabled"],u={key:0},p={key:1},m={class:"incident-list-wrapper"},v={class:"incident-search-section"},k={key:0},h={key:1},g={key:2},y={key:3},f={key:4},b={key:5},C={key:6},L={key:7},w={key:8},E={class:"incident-actions-container"},R=["onClick"],I=["onClick"],D=["onClick"],P={key:3,class:"no-permission-text"},_={key:9},A={class:"incident-modal-content"},S={key:0,class:"incident-solve-container"},T={class:"incident-modal-footer"},x={key:1,class:"incident-rejected-container"},F={class:"incident-modal-footer"},V={key:2,class:"incident-rejected-container"},U={class:"incident-modal-footer"},N={key:1,class:"incident-assignment-workflow-section"},M={class:"incident-assignment-header"},X={class:"assignment-body"},$={class:"incident-summary"},O={class:"incident-details"},j={class:"incident-user-selection"},B={class:"incident-user-form"},W={class:"incident-form-group"},q=["value"],Q={class:"incident-form-group"},K=["value"],J={class:"incident-mitigation-workflow"},z={key:0,class:"incident-workflow-timeline"},H={class:"incident-step-number"},G={class:"incident-step-content"},Y=["onUpdate:modelValue"],Z={class:"incident-step-actions"},ee=["onClick"],te={key:1,class:"incident-no-mitigations"},ie={class:"incident-add-mitigation"},ae=["disabled"],se={class:"incident-due-date-section"},oe=["min"],le={class:"incident-assignment-notes-section"},ne={class:"incident-assignment-actions"},re=["disabled"];function ce(e,t,i,ce,de,ue){const pe=(0,a.g2)("DynamicSearchBar"),me=(0,a.g2)("router-link"),ve=(0,a.g2)("DynamicTable");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",n,[t[21]||(t[21]=(0,a.Lk)("h2",{class:"incident-view-title"},"Incident Management",-1)),(0,a.Lk)("div",r,[(0,a.Lk)("div",c,[(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>de.exportFormat=e),class:"incident-export-format-select"},t[20]||(t[20]=[(0,a.Fv)('<option value="xlsx">Excel (.xlsx)</option><option value="csv">CSV (.csv)</option><option value="pdf">PDF (.pdf)</option><option value="json">JSON (.json)</option><option value="xml">XML (.xml)</option><option value="txt">Text (.txt)</option>',6)]),512),[[s.u1,de.exportFormat]]),(0,a.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>ue.exportIncidents&&ue.exportIncidents(...e)),class:"incident-export-btn",disabled:de.isExporting},[de.isExporting?((0,a.uX)(),(0,a.CE)("span",u,"Exporting...")):((0,a.uX)(),(0,a.CE)("span",p,"Export"))],8,d)])])]),(0,a.Lk)("div",m,[(0,a.Lk)("div",v,[(0,a.bF)(pe,{modelValue:de.searchQuery,"onUpdate:modelValue":t[2]||(t[2]=e=>de.searchQuery=e),placeholder:"Search by ID, title, origin, priority, category, or status...",onInput:ue.filterIncidents,onSearch:ue.performSearch},null,8,["modelValue","onInput","onSearch"])]),(0,a.bF)(ve,{data:de.incidents,columns:de.tableColumns,uniqueKey:"IncidentId",showActions:!0,showPagination:!0,pageSizeOptions:[10,20,50],defaultPageSize:10},{"cell-IncidentTitle":(0,a.k6)(({row:e})=>[(0,a.bF)(me,{to:`/incident/${e.IncidentId}`,class:"incident-title-link"},{default:(0,a.k6)(()=>[(0,a.eW)((0,o.v_)(e.IncidentTitle),1)]),_:2},1032,["to"])]),"cell-Origin":(0,a.k6)(({row:e})=>[(0,a.eW)((0,o.v_)(e.Origin),1)]),"cell-RiskPriority":(0,a.k6)(({row:e})=>[(0,a.eW)((0,o.v_)(e.RiskPriority),1)]),"cell-Date":(0,a.k6)(({row:e})=>[(0,a.eW)((0,o.v_)(ue.formatDate(e.Date)),1)]),actions:(0,a.k6)(({row:i})=>["Scheduled"===i.Status?((0,a.uX)(),(0,a.CE)("div",k," Mitigated to Risk ")):"Rejected"===i.Status?((0,a.uX)(),(0,a.CE)("div",h,(0,o.v_)("RISK"===i.RejectionSource?"Rejected from Risk":"Rejected as Incident"),1)):"Assigned"===i.Status?((0,a.uX)(),(0,a.CE)("div",g," Assigned ")):"Approved"===i.Status?((0,a.uX)(),(0,a.CE)("div",y," Approved ")):"Active"===i.Status?((0,a.uX)(),(0,a.CE)("div",f," Active ")):"Under Review"===i.Status||"PENDING REVIEW"===i.Status?((0,a.uX)(),(0,a.CE)("div",b," Pending Review ")):"Completed"===i.Status?((0,a.uX)(),(0,a.CE)("div",C," Completed ")):"Closed"===i.Status?((0,a.uX)(),(0,a.CE)("div",L," Closed ")):"Open"!==i.Status&&i.Status&&""!==i.Status.trim()?i.Status&&""!==i.Status.trim()?((0,a.uX)(),(0,a.CE)("div",_,(0,o.v_)(i.Status),1)):(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("div",w,[(0,a.Lk)("div",E,[e.canAssignIncident()?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"incident-action-icon",onClick:e=>ue.handleDropdownAction("assign",i),title:"Assign as Incident"},t[22]||(t[22]=[(0,a.Lk)("i",{class:"fas fa-user-plus"},null,-1)]),8,R)):(0,a.Q3)("",!0),e.canEscalateIncident()?((0,a.uX)(),(0,a.CE)("button",{key:1,class:"incident-action-icon",onClick:e=>ue.handleDropdownAction("escalate",i),title:"Escalate to Risk"},t[23]||(t[23]=[(0,a.Lk)("i",{class:"fas fa-arrow-up"},null,-1)]),8,I)):(0,a.Q3)("",!0),e.canEditIncident()?((0,a.uX)(),(0,a.CE)("button",{key:2,class:"incident-action-icon",onClick:e=>ue.handleDropdownAction("close",i),title:"Close Incident"},t[24]||(t[24]=[(0,a.Lk)("i",{class:"fas fa-times"},null,-1)]),8,D)):(0,a.Q3)("",!0),e.canAssignIncident()||e.canEscalateIncident()||e.canEditIncident()?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("span",P,t[25]||(t[25]=[(0,a.Lk)("i",{class:"fas fa-lock"},null,-1)])))])]))]),_:1},8,["data","columns"])]),de.showModal&&"assign"!==de.modalAction?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"incident-modal-overlay",onClick:t[11]||(t[11]=(...e)=>ue.closeModal&&ue.closeModal(...e))},[(0,a.Lk)("div",{class:"incident-modal-container",onClick:t[10]||(t[10]=(0,s.D$)(()=>{},["stop"]))},[(0,a.Lk)("button",{class:"incident-modal-close-btn",onClick:t[3]||(t[3]=(...e)=>ue.closeModal&&ue.closeModal(...e))},"✕"),(0,a.Lk)("div",A,["solve"===de.modalAction?((0,a.uX)(),(0,a.CE)("div",S,[t[26]||(t[26]=(0,a.Lk)("div",{class:"incident-solve-icon"},"🔄",-1)),t[27]||(t[27]=(0,a.Lk)("h3",{class:"incident-modal-title incident-solve"},"Forwarded to Risk",-1)),t[28]||(t[28]=(0,a.Lk)("p",{class:"incident-modal-subtitle"},"You will be directed to the Risk module",-1)),(0,a.Lk)("div",T,[(0,a.Lk)("button",{onClick:t[4]||(t[4]=(...e)=>ue.confirmSolve&&ue.confirmSolve(...e)),class:"incident-modal-btn incident-confirm-btn"},"Confirm Forward"),(0,a.Lk)("button",{onClick:t[5]||(t[5]=(...e)=>ue.closeModal&&ue.closeModal(...e)),class:"incident-modal-btn incident-cancel-btn"},"Cancel")])])):"reject"===de.modalAction?((0,a.uX)(),(0,a.CE)("div",x,[t[29]||(t[29]=(0,a.Lk)("div",{class:"incident-rejected-icon"},"✕",-1)),t[30]||(t[30]=(0,a.Lk)("h3",{class:"incident-modal-title incident-rejected"},"REJECTED",-1)),(0,a.Lk)("div",F,[(0,a.Lk)("button",{onClick:t[6]||(t[6]=(...e)=>ue.confirmReject&&ue.confirmReject(...e)),class:"incident-modal-btn incident-reject-btn"},"Confirm Reject"),(0,a.Lk)("button",{onClick:t[7]||(t[7]=(...e)=>ue.closeModal&&ue.closeModal(...e)),class:"incident-modal-btn incident-cancel-btn"},"Cancel")])])):"close"===de.modalAction?((0,a.uX)(),(0,a.CE)("div",V,[t[31]||(t[31]=(0,a.Lk)("div",{class:"incident-rejected-icon"},"✕",-1)),t[32]||(t[32]=(0,a.Lk)("h3",{class:"incident-modal-title incident-rejected"},"CLOSED",-1)),(0,a.Lk)("div",U,[(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>ue.confirmClose&&ue.confirmClose(...e)),class:"incident-modal-btn incident-reject-btn"},"Confirm Close"),(0,a.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>ue.closeModal&&ue.closeModal(...e)),class:"incident-modal-btn incident-cancel-btn"},"Cancel")])])):(0,a.Q3)("",!0)])])])):(0,a.Q3)("",!0),de.showAssignmentWorkflow?((0,a.uX)(),(0,a.CE)("div",N,[(0,a.Lk)("div",M,[(0,a.Lk)("button",{class:"incident-back-btn",onClick:t[12]||(t[12]=(...e)=>ue.closeAssignmentWorkflow&&ue.closeAssignmentWorkflow(...e))},t[33]||(t[33]=[(0,a.Lk)("i",{class:"fas fa-arrow-left"},null,-1),(0,a.eW)(" Back to Incidents ")]))]),(0,a.Lk)("div",X,[(0,a.Lk)("div",$,[(0,a.Lk)("h3",null,(0,o.v_)(de.selectedIncident.IncidentTitle||"Incident #"+de.selectedIncident.IncidentId),1),(0,a.Lk)("div",O,[(0,a.Lk)("p",null,[t[34]||(t[34]=(0,a.Lk)("strong",null,"ID:",-1)),(0,a.eW)(" "+(0,o.v_)(de.selectedIncident.IncidentId),1)]),(0,a.Lk)("p",null,[t[35]||(t[35]=(0,a.Lk)("strong",null,"Category:",-1)),(0,a.eW)(" "+(0,o.v_)(de.selectedIncident.RiskCategory),1)]),(0,a.Lk)("p",null,[t[36]||(t[36]=(0,a.Lk)("strong",null,"Priority:",-1)),(0,a.eW)(" "+(0,o.v_)(de.selectedIncident.RiskPriority),1)]),(0,a.Lk)("p",null,[t[37]||(t[37]=(0,a.Lk)("strong",null,"Origin:",-1)),(0,a.eW)(" "+(0,o.v_)(de.selectedIncident.Origin),1)])])]),(0,a.Lk)("div",j,[t[42]||(t[42]=(0,a.Lk)("h3",null,"Assignment Details",-1)),(0,a.Lk)("div",B,[(0,a.Lk)("div",W,[t[39]||(t[39]=(0,a.Lk)("label",{for:"assigner"},"Assigner:",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>de.selectedAssigner=e),id:"assigner",class:"incident-assign-select",required:""},[t[38]||(t[38]=(0,a.Lk)("option",{value:""},"Select Assigner",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(de.availableUsers,e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name)+" ("+(0,o.v_)(e.role)+") ",9,q))),128))],512),[[s.u1,de.selectedAssigner]])]),(0,a.Lk)("div",Q,[t[41]||(t[41]=(0,a.Lk)("label",{for:"reviewer"},"Reviewer:",-1)),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":t[14]||(t[14]=e=>de.selectedReviewer=e),id:"reviewer",class:"incident-assign-select",required:""},[t[40]||(t[40]=(0,a.Lk)("option",{value:""},"Select Reviewer",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(de.availableUsers,e=>((0,a.uX)(),(0,a.CE)("option",{key:e.id,value:e.id},(0,o.v_)(e.name)+" ("+(0,o.v_)(e.role)+") ",9,K))),128))],512),[[s.u1,de.selectedReviewer]])])])]),(0,a.Lk)("div",J,[t[49]||(t[49]=(0,a.Lk)("h3",null,"Mitigation Steps",-1)),de.mitigationSteps.length?((0,a.uX)(),(0,a.CE)("div",z,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(de.mitigationSteps,(e,i)=>((0,a.uX)(),(0,a.CE)("div",{key:i,class:"incident-workflow-step"},[(0,a.Lk)("div",H,(0,o.v_)(i+1),1),(0,a.Lk)("div",G,[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t=>e.description=t,class:"incident-mitigation-textarea",placeholder:"Enter mitigation step description"},null,8,Y),[[s.Jo,e.description]]),(0,a.Lk)("div",Z,[(0,a.Lk)("button",{onClick:e=>ue.removeMitigationStep(i),class:"incident-remove-step-btn"},t[43]||(t[43]=[(0,a.Lk)("i",{class:"fas fa-trash"},null,-1),(0,a.eW)(" Remove ")]),8,ee)])])]))),128))])):((0,a.uX)(),(0,a.CE)("div",te,t[44]||(t[44]=[(0,a.Lk)("p",null,"No mitigation steps found for this incident. Add steps below.",-1)]))),(0,a.Lk)("div",ie,[(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[15]||(t[15]=e=>de.newMitigationStep=e),class:"incident-mitigation-textarea",placeholder:"Enter mitigation step(s). Use commas to separate multiple steps (e.g., 'Step 1, Step 2, Step 3')"},null,512),[[s.Jo,de.newMitigationStep]]),(0,a.Lk)("button",{onClick:t[16]||(t[16]=(...e)=>ue.addMitigationStep&&ue.addMitigationStep(...e)),class:"incident-add-step-btn",disabled:!de.newMitigationStep.trim()},t[45]||(t[45]=[(0,a.Lk)("i",{class:"fas fa-plus"},null,-1),(0,a.eW)(" Add Mitigation Step ")]),8,ae)]),(0,a.Lk)("div",se,[t[46]||(t[46]=(0,a.Lk)("h4",null,"Due Date for Mitigation Completion",-1)),(0,a.bo)((0,a.Lk)("input",{type:"date","onUpdate:modelValue":t[17]||(t[17]=e=>de.mitigationDueDate=e),class:"incident-due-date-input",min:ue.getTodayDate()},null,8,oe),[[s.Jo,de.mitigationDueDate]])]),(0,a.Lk)("div",le,[t[47]||(t[47]=(0,a.Lk)("h4",null,"Assignment Notes (Optional)",-1)),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":t[18]||(t[18]=e=>de.assignmentNotes=e),class:"incident-assignment-notes-textarea",placeholder:"Add any specific instructions or notes for the assignees...",rows:"3"},null,512),[[s.Jo,de.assignmentNotes]])]),(0,a.Lk)("div",ne,[(0,a.Lk)("button",{onClick:t[19]||(t[19]=(...e)=>ue.confirmAssignmentWorkflow&&ue.confirmAssignmentWorkflow(...e)),class:"incident-submit-assignment-btn",disabled:!de.selectedAssigner||!de.selectedReviewer||0===de.mitigationSteps.length||!de.mitigationDueDate},t[48]||(t[48]=[(0,a.Lk)("i",{class:"fas fa-user-plus"},null,-1),(0,a.eW)(" Assign Incident with Mitigations ")]),8,re)])])])])):(0,a.Q3)("",!0)])}i(4114),i(8111),i(2489),i(116),i(7588),i(1701),i(7642),i(8004),i(3853),i(5876),i(2475),i(5024),i(1698);var de=i(4373),ue=i(2972),pe=i(766),me=i(9254),ve=i(6567),ke=i(2018),he={name:"IncidentManagement",components:{DynamicTable:ve.A,DynamicSearchBar:ke.A},mixins:[pe.r],data(){return{incidents:[],filteredIncidents:[],searchQuery:"",sortField:"",sortOrder:"asc",searchTimeout:null,isLoadingIncidents:!1,currentPage:1,incidentsPerPage:10,showModal:!1,modalAction:"",selectedIncident:null,exportFormat:"xlsx",isExporting:!1,selectedAssigner:"",selectedReviewer:"",assignmentNotes:"",availableUsers:[],showAssignmentWorkflow:!1,mitigationSteps:[],newMitigationStep:"",mitigationDueDate:"",dropdownOpenFor:null,tableColumns:[{key:"IncidentId",label:"ID",sortable:!0,headerClass:"incident-header-cell id-header",cellClass:"incident-table-cell incident-id-cell",width:"50px"},{key:"IncidentTitle",label:"Title",sortable:!0,headerClass:"incident-header-cell title-header",cellClass:"incident-table-cell incident-title-cell",slot:!0,width:"auto"},{key:"Origin",label:"Origin",sortable:!0,headerClass:"incident-header-cell origin-header",cellClass:"incident-table-cell incident-origin-cell",slot:!0,width:"100px"},{key:"RiskPriority",label:"Priority",sortable:!0,headerClass:"incident-header-cell priority-header",cellClass:"incident-table-cell incident-priority-cell",slot:!0,width:"90px"},{key:"Date",label:"Date",sortable:!0,headerClass:"incident-header-cell date-header",cellClass:"incident-table-cell incident-date-cell",slot:!0,width:"90px"}]}},computed:{totalPages(){return Math.ceil(this.filteredIncidents.length/this.incidentsPerPage)},paginatedIncidents(){const e=(this.currentPage-1)*this.incidentsPerPage,t=e+this.incidentsPerPage;return this.filteredIncidents.slice(e,t)},pageNumbers(){const e=[];let t=Math.max(1,this.currentPage-2),i=Math.min(this.totalPages,t+4);i-t<4&&this.totalPages>5&&(t=Math.max(1,i-4));for(let a=t;a<=i;a++)e.push(a);return e}},watch:{incidents:{handler(e){console.log("Incidents array updated. Current statuses:",e.slice(0,5).map(e=>({id:e.IncidentId,status:e.Status})))},deep:!0}},mounted(){console.log("Incident component mounted - fetching incidents from database..."),this.fetchIncidents(),this.fetchUsers(),document.documentElement.style.overflow="auto",document.body.style.overflow="auto",window.addEventListener("resize",this.handleResize),document.addEventListener("click",this.closeAllDropdowns)},beforeUnmount(){window.removeEventListener("resize",this.handleResize),document.removeEventListener("click",this.closeAllDropdowns)},methods:{toggleActionDropdown(e){console.log("Toggle dropdown for incident:",e),console.log("Current dropdownOpenFor:",this.dropdownOpenFor),this.dropdownOpenFor===e?this.dropdownOpenFor=null:this.dropdownOpenFor=e,console.log("New dropdownOpenFor:",this.dropdownOpenFor)},closeAllDropdowns(e){if(e&&e.target){const t=e.target.closest(".action-dropdown-container");if(t)return}console.log("Closing all dropdowns"),this.dropdownOpenFor=null},handleDropdownAction(e,t){console.log("Dropdown action:",e,"for incident:",t.IncidentId),this.logUserAction(`INCIDENT_${e.toUpperCase()}`,"incident",t.IncidentId);let i=!1;switch(e){case"assign":i=this.canAssignIncident();break;case"escalate":i=this.canEscalateIncident();break;case"close":i=this.canEditIncident();break}if(i)switch(console.log(`✅ Permission granted for action: ${e}`),this.dropdownOpenFor=null,e){case"assign":this.openAssignModal(t);break;case"escalate":ue.OQ.confirm(`Are you sure you want to escalate Incident #${t.IncidentId} to Risk? This will forward the incident to the Risk module for further evaluation and mitigation.`,"Escalate to Risk",()=>this.confirmSolve(t));break;case"close":ue.OQ.confirm(`Are you sure you want to close Incident #${t.IncidentId}? This action cannot be undone.`,"Close Incident",()=>this.confirmClose(t));break}else{switch(console.warn(`❌ Permission denied for action: ${e}`),e){case"assign":me.wr.showIncidentAccessDenied("assign");break;case"escalate":me.wr.showIncidentAccessDenied("escalate");break;case"close":me.wr.showIncidentAccessDenied("edit");break;default:me.wr.showIncidentAccessDenied("access")}this.dropdownOpenFor=null}},openSolveModal(e){this.selectedIncident=e,this.modalAction="solve",this.showModal=!0},openRejectModal(e){this.selectedIncident=e,this.modalAction="reject",this.showModal=!0},openAssignModal(e){this.selectedIncident=e,this.showAssignmentWorkflow=!0,this.selectedAssigner="",this.selectedReviewer="",this.assignmentNotes="",this.newMitigationStep="",this.mitigationDueDate="",console.log("Selected incident:",e),console.log("Incident Mitigation field:",e.Mitigation),this.loadExistingMitigations(e)},openCloseModal(e){this.selectedIncident=e,this.modalAction="close",this.showModal=!0},closeModal(){this.showModal=!1,this.selectedIncident=null,this.selectedAssigner="",this.selectedReviewer="",this.assignmentNotes=""},closeAssignmentWorkflow(){this.showAssignmentWorkflow=!1,this.selectedIncident=null,this.selectedAssigner="",this.selectedReviewer="",this.assignmentNotes="",this.mitigationSteps=[],this.newMitigationStep="",this.mitigationDueDate=""},addMitigationStep(){if(!this.newMitigationStep.trim())return;const e=this.newMitigationStep.split(",").filter(e=>e.trim());e.length>1?e.forEach(e=>{this.mitigationSteps.push({description:e.trim(),status:"Not Started"})}):this.mitigationSteps.push({description:this.newMitigationStep.trim(),status:"Not Started"}),this.newMitigationStep=""},removeMitigationStep(e){this.mitigationSteps.splice(e,1)},getTodayDate(){const e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),a=String(e.getDate()).padStart(2,"0");return`${t}-${i}-${a}`},loadExistingMitigations(e){if(this.mitigationSteps=[],e.Mitigation)try{let i=e.Mitigation;if("string"===typeof i&&(i.trim().startsWith("{")||i.trim().startsWith("[")))try{i=JSON.parse(i)}catch(t){console.log("Mitigation data is not JSON, treating as plain text")}if("string"===typeof i){let e=[];const t=i.split("\n").filter(e=>e.trim());if(t.length>1)e=t;else{const t=i.split(",").filter(e=>e.trim());e=t.length>1?t:[i]}this.mitigationSteps=e.map(e=>({description:e.trim(),status:"Not Started"}))}else Array.isArray(i)?this.mitigationSteps=i.map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})):"object"===typeof i&&(this.mitigationSteps=Object.values(i).map(e=>({description:"string"===typeof e?e:e.description||e.title||"Mitigation step",status:e.status||"Not Started"})));console.log("Loaded existing mitigation steps:",this.mitigationSteps)}catch(i){console.error("Error parsing mitigation data:",i),this.mitigationSteps=[{description:e.Mitigation,status:"Not Started"}]}0===this.mitigationSteps.length&&console.log("No existing mitigation steps found")},confirmAssignmentWorkflow(){if(!this.selectedAssigner||!this.selectedReviewer)return void ue.OQ.warning("Please select both assigner and reviewer");if(this.selectedAssigner===this.selectedReviewer)return void ue.OQ.warning("Assigner and reviewer cannot be the same person");if(0===this.mitigationSteps.length)return void ue.OQ.warning("Please add at least one mitigation step");if(!this.mitigationDueDate)return void ue.OQ.warning("Please select a due date");console.log("Assigning incident:",this.selectedIncident.IncidentId);const e=this.availableUsers.find(e=>e.id===this.selectedAssigner),t=this.availableUsers.find(e=>e.id===this.selectedReviewer),i={};this.mitigationSteps.forEach((e,t)=>{i[t+1]=e.description}),de.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/assign/`,{status:"Assigned",assigner_id:this.selectedAssigner,assigner_name:e.name,reviewer_id:this.selectedReviewer,reviewer_name:t.name,assignment_notes:this.assignmentNotes,assigned_date:(new Date).toISOString(),mitigations:i,due_date:this.mitigationDueDate}).then(e=>{console.log("Incident assigned successfully - API response:",e.data);const t=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Assigned",t.AssignerId=this.selectedAssigner,t.ReviewerId=this.selectedReviewer,console.log("Updated local incident status to Assigned"));const i=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);i&&(i.Status="Assigned",i.AssignerId=this.selectedAssigner,i.ReviewerId=this.selectedReviewer),this.fetchIncidents(),ue.OQ.success("Incident assigned successfully with mitigation steps!"),this.closeAssignmentWorkflow()}).catch(e=>{console.error("Error assigning incident:",e),me.wr.handleApiError(e,"assign incidents")||ue.OQ.error("Failed to assign incident. Please try again.")})},confirmSolve(e){console.log("Escalating incident to risk:",e.IncidentId),de.A.put(`http://localhost:8000/api/incidents/${e.IncidentId}/status/`,{status:"Scheduled"}).then(e=>{console.log("Incident escalated to risk - API response:",e.data),ue.OQ.success(`Incident #${t.IncidentId} has been successfully escalated to Risk Management for further evaluation and mitigation.`,"Escalated to Risk");const t=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Scheduled",console.log("Updated local incident status to Scheduled"));const i=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);i&&(i.Status="Scheduled"),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},2e3)}).catch(e=>{console.error("Error updating incident status:",e),me.wr.handleApiError(e,"escalate incidents")||ue.OQ.error("Failed to escalate incident. Please try again.")})},confirmReject(){console.log("Rejecting incident:",this.selectedIncident.IncidentId),de.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/status/`,{status:"Rejected",rejection_source:"INCIDENT"}).then(e=>{console.log("Incident rejected - API response:",e.data);const t=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Rejected",t.RejectionSource="INCIDENT",console.log("Updated local incident status to Rejected"));const i=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);i&&(i.Status="Rejected",i.RejectionSource="INCIDENT"),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},2e3)}).catch(e=>{console.error("Error updating incident status:",e),me.wr.handleApiError(e,"reject incidents")||ue.OQ.error("Failed to reject incident. Please try again.")})},confirmClose(e){console.log("Closing incident:",e.IncidentId),de.A.put(`http://localhost:8000/api/incidents/${e.IncidentId}/status/`,{status:"Closed"}).then(e=>{console.log("Incident closed - API response:",e.data);const t=this.incidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);t&&(t.Status="Closed",console.log("Updated local incident status to Closed"));const i=this.filteredIncidents.find(e=>e.IncidentId===this.selectedIncident.IncidentId);i&&(i.Status="Closed"),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},2e3)}).catch(e=>{console.error("Error updating incident status:",e),me.wr.handleApiError(e,"close incidents")||ue.OQ.error("Failed to close incident. Please try again.")})},confirmAssign(){if(!this.selectedAssigner||!this.selectedReviewer)return void ue.OQ.warning("Please select both assigner and reviewer");if(this.selectedAssigner===this.selectedReviewer)return void ue.OQ.warning("Assigner and reviewer cannot be the same person");const e=this.availableUsers.find(e=>e.id===this.selectedAssigner),t=this.availableUsers.find(e=>e.id===this.selectedReviewer);de.A.put(`http://localhost:8000/api/incidents/${this.selectedIncident.IncidentId}/assign/`,{status:"Assigned",assigner_id:this.selectedAssigner,assigner_name:e.name,reviewer_id:this.selectedReviewer,reviewer_name:t.name,assignment_notes:this.assignmentNotes,assigned_date:(new Date).toISOString()}).then(e=>{console.log("Incident assigned successfully:",e.data),this.fetchIncidents(),setTimeout(()=>{this.closeModal()},1500)}).catch(e=>{console.error("Error assigning incident:",e),me.wr.handleApiError(e,"assign incidents")||ue.OQ.error("Failed to assign incident. Please try again.")})},getRiskCategoryClass(e){if(!e)return"";const t=e.toLowerCase();return t.includes("security")?"category-security":t.includes("compliance")?"category-compliance":t.includes("operational")?"category-operational":t.includes("financial")?"category-financial":t.includes("strategic")?"category-strategic":"category-other"},changePage(e){if(e>=1&&e<=this.totalPages){this.currentPage=e;const t=document.querySelector(".incident-list-wrapper");t&&(t.scrollTop=0,window.scrollTo({top:t.offsetTop,behavior:"smooth"}))}},getStatusClass(e){const t=e?.toLowerCase()||"";return"high"===t?"status-active":"medium"===t?"status-medium":"low"===t?"status-inactive":"status-default"},getOriginClass(e){const t=e?.toLowerCase()||"";return t.includes("manual")?"incident-origin-manual":t.includes("audit")?"incident-origin-audit":t.includes("siem")?"incident-origin-siem":"incident-origin-other"},async fetchIncidents(){try{this.isLoadingIncidents=!0;const e={};this.searchQuery.trim()&&(e.search=this.searchQuery.trim(),console.log("Adding search parameter:",e.search)),this.sortField&&(e.sort_field=this.sortField,e.sort_order=this.sortOrder,console.log("Adding sort parameters:",e.sort_field,e.sort_order)),console.log("Fetching incidents with params:",e),console.log("API URL:","http://localhost:8000/api/incident-incidents/");const t=await de.A.get("http://localhost:8000/api/incident-incidents/",{params:e});console.log("Response received:",t),console.log("Response data length:",t.data.length),this.incidents=t.data,this.filteredIncidents=[...this.incidents],console.log("Fetched incidents:",this.incidents),console.log("Sample incident statuses:",this.incidents.slice(0,3).map(e=>({id:e.IncidentId,status:e.Status})));const i=[...new Set(this.incidents.map(e=>e.Status).filter(e=>e))];console.log("All unique status values found:",i),this.currentPage=1,this.$nextTick(()=>{this.handleResize()})}catch(e){console.error("Failed to fetch incidents:",e),console.error("Error details:",e.response),me.wr.handleApiError(e,"view incidents")||ue.OQ.error("Failed to load incidents. Please try again.")}finally{this.isLoadingIncidents=!1}},async fetchUsers(){try{const e=await de.A.get("http://localhost:8000/api/incidents-users/");this.availableUsers=e.data.map(e=>({id:e.UserId,name:e.UserName,role:e.role})),console.log("Fetched users:",this.availableUsers)}catch(e){console.error("Failed to fetch users:",e),me.wr.handleApiError(e,"view users")||ue.OQ.error("Failed to load users. Please try again."),this.availableUsers=[]}},filterIncidents(){console.log("filterIncidents called with searchQuery:",this.searchQuery),this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{console.log("Debounce timeout reached, calling performSearch"),this.performSearch()},300)},performSearch(){console.log("performSearch called"),this.fetchIncidents()},clearSearch(){console.log("Clear search clicked"),this.searchQuery="",this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.fetchIncidents()},setSortField(e){this.sortField===e?this.toggleSortOrder():(this.sortField=e,this.sortOrder="asc"),this.fetchIncidents()},sortIncidents(){this.fetchIncidents()},toggleSortOrder(){this.sortOrder="asc"===this.sortOrder?"desc":"asc",this.fetchIncidents()},handleResize(){const e=document.querySelector(".incident-list-wrapper");e&&(e.style.maxWidth="100%")},getPriorityClass(e){switch(e?.toLowerCase()){case"high":return"incident-priority-high";case"medium":return"incident-priority-medium";case"low":return"incident-priority-low";default:return""}},formatDate(e){if(!e)return"";const[t,i,a]=e.split("-");return`${i}/${a}/${t}`},closeIncidentDetails(){this.selectedIncident=null,this.showIncidentDetails=!1},exportIncidents(){console.log("Exporting incidents..."),this.isExporting=!0;const e=this.searchQuery?this.filteredIncidents:this.incidents,t=e.map(e=>({IncidentId:e.IncidentId,IncidentTitle:e.IncidentTitle,Date:e.Date,RiskPriority:e.RiskPriority,Origin:e.Origin,Status:e.Status}));de.A.post("http://localhost:8000/api/incidents/export/",{file_format:this.exportFormat,data:JSON.stringify(t),options:JSON.stringify({filters:{searchQuery:this.searchQuery,sortField:this.sortField,sortOrder:this.sortOrder}})}).then(e=>{if(console.log("Export successful:",e.data),e.data&&e.data.file_url){const t=document.createElement("a");t.href=e.data.file_url,t.setAttribute("download",e.data.file_name||`incidents.${this.exportFormat}`),document.body.appendChild(t),t.click(),document.body.removeChild(t)}this.isExporting=!1,ue.OQ.success("Export completed successfully")}).catch(e=>{console.error("Export failed:",e),me.wr.handleApiError(e,"export incidents")||ue.OQ.error("Export failed. Please try again."),this.isExporting=!1})}}},ge=i(1241);const ye=(0,ge.A)(he,[["render",ce]]);var fe=ye}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var o=t[a]={exports:{}};return e[a].call(o.exports,o,o.exports,i),o.exports}i.m=e,function(){var e=[];i.O=function(t,a,s,o){if(!a){var l=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],o=e[d][2];for(var n=!0,r=0;r<a.length;r++)(!1&o||l>=o)&&Object.keys(i.O).every(function(e){return i.O[e](a[r])})?a.splice(r--,1):(n=!1,o<l&&(l=o));if(n){e.splice(d--,1);var c=s();void 0!==c&&(t=c)}}return t}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[a,s,o]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){i.f={},i.e=function(e){return Promise.all(Object.keys(i.f).reduce(function(t,a){return i.f[a](e,t),t},[]))}}(),function(){i.u=function(e){return"js/"+e+".9aa78c0c.js"}}(),function(){i.miniCssF=function(e){return"css/"+e+".cb4498de.css"}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="frontend:";i.l=function(a,s,o,l){if(e[a])e[a].push(s);else{var n,r;if(void 0!==o)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var u=c[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==t+o){n=u;break}}n||(r=!0,n=document.createElement("script"),n.charset="utf-8",n.timeout=120,i.nc&&n.setAttribute("nonce",i.nc),n.setAttribute("data-webpack",t+o),n.src=a),e[a]=[s];var p=function(t,i){n.onerror=n.onload=null,clearTimeout(m);var s=e[a];if(delete e[a],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach(function(e){return e(i)}),t)return t(i)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=p.bind(null,n.onerror),n.onload=p.bind(null,n.onload),r&&document.head.appendChild(n)}}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.p="/"}(),function(){if("undefined"!==typeof document){var e=function(e,t,a,s,o){var l=document.createElement("link");l.rel="stylesheet",l.type="text/css",i.nc&&(l.nonce=i.nc);var n=function(i){if(l.onerror=l.onload=null,"load"===i.type)s();else{var a=i&&i.type,n=i&&i.target&&i.target.href||t,r=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+n+")");r.name="ChunkLoadError",r.code="CSS_CHUNK_LOAD_FAILED",r.type=a,r.request=n,l.parentNode&&l.parentNode.removeChild(l),o(r)}};return l.onerror=l.onload=n,l.href=t,a?a.parentNode.insertBefore(l,a.nextSibling):document.head.appendChild(l),l},t=function(e,t){for(var i=document.getElementsByTagName("link"),a=0;a<i.length;a++){var s=i[a],o=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(o===e||o===t))return s}var l=document.getElementsByTagName("style");for(a=0;a<l.length;a++){s=l[a],o=s.getAttribute("data-href");if(o===e||o===t)return s}},a=function(a){return new Promise(function(s,o){var l=i.miniCssF(a),n=i.p+l;if(t(l,n))return s();e(a,n,null,s,o)})},s={524:0};i.f.miniCss=function(e,t){var i={551:1};s[e]?t.push(s[e]):0!==s[e]&&i[e]&&t.push(s[e]=a(e).then(function(){s[e]=0},function(t){throw delete s[e],t}))}}}(),function(){var e={524:0};i.f.j=function(t,a){var s=i.o(e,t)?e[t]:void 0;if(0!==s)if(s)a.push(s[2]);else{var o=new Promise(function(i,a){s=e[t]=[i,a]});a.push(s[2]=o);var l=i.p+i.u(t),n=new Error,r=function(a){if(i.o(e,t)&&(s=e[t],0!==s&&(e[t]=void 0),s)){var o=a&&("load"===a.type?"missing":a.type),l=a&&a.target&&a.target.src;n.message="Loading chunk "+t+" failed.\n("+o+": "+l+")",n.name="ChunkLoadError",n.type=o,n.request=l,s[1](n)}};i.l(l,r,"chunk-"+t,t)}},i.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,o,l=a[0],n=a[1],r=a[2],c=0;if(l.some(function(t){return 0!==e[t]})){for(s in n)i.o(n,s)&&(i.m[s]=n[s]);if(r)var d=r(i)}for(t&&t(a);c<l.length;c++)o=l[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(d)},a=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=i.O(void 0,[504],function(){return i(2625)});a=i.O(a)})();
//# sourceMappingURL=app.b5058b57.js.map
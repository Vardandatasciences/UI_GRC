"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[551],{1551:function(t,a,e){e.r(a),e.d(a,{default:function(){return z}});var s=e(6768),r=e(4232),i=e(5130);const c={class:"dashboard-container"},o={class:"dashboard-header"},n={class:"header-actions"},l={class:"metrics-grid"},d={class:"metric-card"},h={class:"metric-content"},u={class:"metric-value"},p={class:"number"},g={class:"metric-change"},b={class:"metric-card"},k={class:"metric-content"},C={class:"metric-value"},v={class:"number"},y={class:"metric-card"},f={class:"metric-content"},L={class:"metric-value"},m={class:"number"},D={class:"metric-card"},A={class:"metric-content"},w={class:"metric-value"},F={class:"number"},x={class:"dashboard-content"},I={class:"performance-chart"},_={class:"chart-header"},R={class:"chart-controls"},E={class:"chart-type-icons"},S={class:"axis-controls"},T={class:"axis-select"},B={class:"axis-select"},P={class:"recent-activity"},M={class:"activity-list"},Y={class:"activity-details"},O={class:"activity-meta"},$={class:"activity-tag origin-tag"},N={class:"activity-time"};function X(t,a,e,X,j,U){const H=(0,s.g2)("PopupModal");return(0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",o,[a[11]||(a[11]=(0,s.Lk)("h1",null,"Incident Dashboard",-1)),(0,s.Lk)("div",n,[(0,s.Lk)("button",{class:"refresh-btn",onClick:a[0]||(a[0]=(...t)=>U.refreshData&&U.refreshData(...t))},a[9]||(a[9]=[(0,s.Lk)("i",{class:"fas fa-sync"},null,-1)])),a[10]||(a[10]=(0,s.Lk)("button",{class:"download-btn"},[(0,s.Lk)("i",{class:"fas fa-download"})],-1))])]),(0,s.Lk)("div",l,[(0,s.Lk)("div",d,[a[13]||(a[13]=(0,s.Lk)("div",{class:"metric-icon incident-icon"},[(0,s.Lk)("i",{class:"fas fa-exclamation-circle"})],-1)),(0,s.Lk)("div",h,[a[12]||(a[12]=(0,s.Lk)("h3",null,"Total Incidents",-1)),(0,s.Lk)("div",u,[(0,s.Lk)("span",p,(0,r.v_)(j.dashboardData.total_count||0),1)]),(0,s.Lk)("div",g,(0,r.v_)(j.dashboardData.change_percentage>0?"+":"")+(0,r.v_)(j.dashboardData.change_percentage)+"% from last period ",1)])]),(0,s.Lk)("div",b,[a[16]||(a[16]=(0,s.Lk)("div",{class:"metric-icon open-icon"},[(0,s.Lk)("i",{class:"fas fa-clipboard-list"})],-1)),(0,s.Lk)("div",k,[a[14]||(a[14]=(0,s.Lk)("h3",null,"Open Incidents",-1)),(0,s.Lk)("div",C,[(0,s.Lk)("span",v,(0,r.v_)(j.dashboardData.status_counts.scheduled||0),1)]),a[15]||(a[15]=(0,s.Lk)("div",{class:"metric-change"}," Awaiting resolution ",-1))])]),(0,s.Lk)("div",y,[a[19]||(a[19]=(0,s.Lk)("div",{class:"metric-icon rejected-icon"},[(0,s.Lk)("i",{class:"fas fa-ban"})],-1)),(0,s.Lk)("div",f,[a[17]||(a[17]=(0,s.Lk)("h3",null,"Rejected",-1)),(0,s.Lk)("div",L,[(0,s.Lk)("span",m,(0,r.v_)(j.dashboardData.status_counts.rejected||0),1)]),a[18]||(a[18]=(0,s.Lk)("div",{class:"metric-change"}," Rejected incidents ",-1))])]),(0,s.Lk)("div",D,[a[22]||(a[22]=(0,s.Lk)("div",{class:"metric-icon approved-icon"},[(0,s.Lk)("i",{class:"fas fa-check-circle"})],-1)),(0,s.Lk)("div",A,[a[20]||(a[20]=(0,s.Lk)("h3",null,"Approved",-1)),(0,s.Lk)("div",w,[(0,s.Lk)("span",F,(0,r.v_)(j.dashboardData.status_counts.approved||0),1)]),a[21]||(a[21]=(0,s.Lk)("div",{class:"metric-change"}," Approved incidents ",-1))])])]),(0,s.Lk)("div",x,[(0,s.Lk)("div",I,[(0,s.Lk)("div",_,[a[31]||(a[31]=(0,s.Lk)("h2",null,"Incident Analytics",-1)),(0,s.Lk)("div",R,[(0,s.Lk)("div",E,[(0,s.Lk)("button",{class:(0,r.C4)(["chart-type-btn",{active:"bar"===j.selectedChartType}]),onClick:a[1]||(a[1]=t=>U.changeChartType("bar")),title:"Bar Chart"},a[23]||(a[23]=[(0,s.Lk)("i",{class:"fas fa-chart-bar"},null,-1)]),2),(0,s.Lk)("button",{class:(0,r.C4)(["chart-type-btn",{active:"line"===j.selectedChartType}]),onClick:a[2]||(a[2]=t=>U.changeChartType("line")),title:"Line Chart"},a[24]||(a[24]=[(0,s.Lk)("i",{class:"fas fa-chart-line"},null,-1)]),2),(0,s.Lk)("button",{class:(0,r.C4)(["chart-type-btn",{active:"pie"===j.selectedChartType}]),onClick:a[3]||(a[3]=t=>U.changeChartType("pie")),title:"Pie Chart"},a[25]||(a[25]=[(0,s.Lk)("i",{class:"fas fa-chart-pie"},null,-1)]),2),(0,s.Lk)("button",{class:(0,r.C4)(["chart-type-btn",{active:"doughnut"===j.selectedChartType}]),onClick:a[4]||(a[4]=t=>U.changeChartType("doughnut")),title:"Doughnut Chart"},a[26]||(a[26]=[(0,s.Lk)("i",{class:"fas fa-circle-notch"},null,-1)]),2)]),(0,s.Lk)("div",S,[(0,s.Lk)("div",T,[a[28]||(a[28]=(0,s.Lk)("label",null,"X Axis:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>j.selectedXAxis=t),onChange:a[6]||(a[6]=(...t)=>U.fetchDashboardData&&U.fetchDashboardData(...t))},a[27]||(a[27]=[(0,s.Lk)("option",{value:"Time"},"Incidents",-1)]),544),[[i.u1,j.selectedXAxis]])]),(0,s.Lk)("div",B,[a[30]||(a[30]=(0,s.Lk)("label",null,"Y Axis:",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[7]||(a[7]=t=>j.selectedYAxis=t),onChange:a[8]||(a[8]=(...t)=>U.fetchDashboardData&&U.fetchDashboardData(...t))},a[29]||(a[29]=[(0,s.Fv)('<option value="Status">By Status</option><option value="Origin">By Origin</option><option value="RiskCategory">By Risk Category</option><option value="RiskPriority">By Risk Priority</option><option value="Repeated">By Repeated Status</option><option value="CostImpact">By Cost (â‚¹)</option>',6)]),544),[[i.u1,j.selectedYAxis]])])])])]),a[32]||(a[32]=(0,s.Lk)("div",{class:"chart-container"},[(0,s.Lk)("canvas",{id:"myChart"})],-1))]),(0,s.Lk)("div",P,[a[33]||(a[33]=(0,s.Lk)("div",{class:"activity-header"},[(0,s.Lk)("h2",null,"Recent Incidents"),(0,s.Lk)("button",{class:"more-options"},[(0,s.Lk)("i",{class:"fas fa-ellipsis-v"})])],-1)),(0,s.Lk)("div",M,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(j.recentIncidents,(t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"activity-item"},[(0,s.Lk)("div",{class:(0,r.C4)(["activity-icon",t.priority_class])},[(0,s.Lk)("i",{class:(0,r.C4)(t.icon)},null,2)],2),(0,s.Lk)("div",Y,[(0,s.Lk)("h4",null,(0,r.v_)(t.IncidentTitle),1),(0,s.Lk)("p",null,(0,r.v_)(U.truncateDescription(t.Description,100)),1),(0,s.Lk)("div",O,[(0,s.Lk)("span",$,(0,r.v_)(t.origin_text),1),t.status_class?((0,s.uX)(),(0,s.CE)("span",{key:0,class:(0,r.C4)(["activity-tag status-tag",t.status_class])},(0,r.v_)(t.Status),3)):(0,s.Q3)("",!0),(0,s.Lk)("span",N,(0,r.v_)(U.formatDate(t.CreatedAt)),1)])])]))),128))])])]),(0,s.bF)(H)])}e(8111),e(1701),e(8237),e(3579);var j=e(9064),U=e(4300),H=e(2972),W=e(9254);j.t1.register(j.PP,j.kc,j.E8,j.FN,j.No,j.Bs,j.pr,j.hE,j.m_,j.s$);var Q={name:"IncidentPerformanceDashboard",components:{PopupModal:H.wA},data(){return{selectedChartType:"bar",selectedXAxis:"Time",selectedYAxis:"Severity",chart:null,chartId:"myChart",api:{incidentService:U.UG},dashboardData:{status_counts:{scheduled:0,approved:0,resolved:0,rejected:0},total_count:0,change_percentage:0,resolution_rate:0},chartData:null,recentIncidents:[]}},mounted(){this.fetchDashboardData(),this.fetchRecentIncidents()},beforeUnmount(){this.destroyChart()},beforeRouteLeave(t,a,e){this.destroyChart(),e()},methods:{destroyChart(){this.chart&&(this.chart.destroy(),this.chart=null)},async fetchRecentIncidents(){try{const t=await this.api.incidentService.getRecentIncidents(3);t.data&&t.data.success?this.recentIncidents=t.data.incidents.map(t=>{let a="medium",e="fas fa-exclamation-triangle";if(t.RiskPriority){const s=t.RiskPriority.toLowerCase();s.includes("high")?(a="high",e="fas fa-radiation"):s.includes("low")&&(a="low",e="fas fa-info-circle")}let s="";if(t.Status){const a=t.Status.toLowerCase();a.includes("rejected")?s="rejected":a.includes("approved")?s="approved":a.includes("scheduled")&&(s="scheduled")}let r=t.Origin||"Unknown";return{...t,priority_class:a,status_class:s,icon:e,origin_text:r}}):(console.error("Failed to fetch recent incidents"),this.recentIncidents=[])}catch(t){if(console.error("Error fetching recent incidents:",t),W.wr.handleApiError(t))return;this.recentIncidents=[]}},async fetchDashboardData(){try{let a,e;console.log("Starting fetchDashboardData for incidents..."),console.log("Request payload:",{xAxis:this.selectedXAxis,yAxis:this.selectedYAxis});try{a=await this.api.incidentService.getIncidentDashboard(),console.log("Incident Dashboard API Response:",a.data)}catch(t){if(console.error("Error fetching dashboard data:",t),W.wr.handleApiError(t))return;throw new Error(`Dashboard fetch failed: ${t.message}`)}try{e=await this.api.incidentService.getIncidentAnalytics({xAxis:this.selectedXAxis,yAxis:this.selectedYAxis}),console.log("Incident Analytics API Response:",e.data)}catch(t){if(console.error("Error fetching analytics data:",t),W.wr.handleApiError(t))return;throw new Error(`Analytics fetch failed: ${t.message}`)}if(!a.data)throw console.error("Dashboard response data is null or undefined"),new Error("Invalid dashboard response");if(!e.data)throw console.error("Analytics response data is null or undefined"),new Error("Invalid analytics response");if(!a.data.success||!e.data.success){const t=a.data.message||e.data.message||"API request failed";throw console.error("API Error:",t),new Error(t)}{if(!a.data.data||!a.data.data.summary)throw console.error("Dashboard response does not contain expected data structure",a.data),new Error("Invalid dashboard data structure");if(!e.data.chartData)throw console.error("Analytics response does not contain expected chartData",e.data),new Error("Invalid analytics data structure");const t=a.data.data.summary;console.log("Dashboard summary data:",t),this.dashboardData={status_counts:t.status_counts||{},total_count:t.total_count||0,change_percentage:t.change_percentage||0,resolution_rate:t.resolution_rate||0},console.log("Updated dashboard data:",this.dashboardData),this.chartData=e.data.chartData,console.log("Updated chart data:",this.chartData),await this.$nextTick(),this.updateChart()}}catch(a){if(console.error("Error in fetchDashboardData:",a),W.wr.handleApiError(a))return;this.dashboardData={status_counts:{scheduled:0,approved:0,rejected:0},total_count:0,change_percentage:0,resolution_rate:0},this.chartData={labels:[],datasets:[{label:"Error Loading Data",data:[],backgroundColor:"rgba(244, 67, 54, 0.6)",borderColor:"#F44336",borderWidth:1}]},await this.$nextTick(),this.updateChart()}},updateChart(){try{this.destroyChart();const t=document.getElementById(this.chartId);if(!t)return void console.error("Chart canvas not found");const a=this.createChartConfig();this.chart=new j.t1(t,a)}catch(t){console.error("Error in updateChart:",t),this.chart=null}},createChartConfig(){if(!this.chartData)return{type:this.selectedChartType,data:{labels:[],datasets:[{label:"No Data",data:[],backgroundColor:"rgba(200, 200, 200, 0.5)",borderColor:"#ccc",borderWidth:1}]},options:this.getChartOptions()};const t=Array.isArray(this.chartData.datasets)&&this.chartData.datasets.length>1;let a;if(t)a=this.chartData.datasets.map((t,a)=>{const e=this.getColorForIndex(a);return{...t,backgroundColor:e.backgroundColor,borderColor:e.borderColor,borderWidth:1,tension:"line"===this.selectedChartType?.1:void 0,fill:"line"!==this.selectedChartType&&void 0}});else{const t={...this.chartData.datasets[0],backgroundColor:this.getBackgroundColors(),borderColor:this.getBorderColors(),borderWidth:1};"line"===this.selectedChartType&&(t.tension=.1,t.fill=!1),a=[t]}return{type:this.selectedChartType,data:{labels:this.chartData.labels,datasets:a},options:this.getChartOptions()}},getColorForIndex(t){const a=[{backgroundColor:"rgba(255, 99, 132, 0.6)",borderColor:"rgb(255, 99, 132)"},{backgroundColor:"rgba(54, 162, 235, 0.6)",borderColor:"rgb(54, 162, 235)"},{backgroundColor:"rgba(255, 206, 86, 0.6)",borderColor:"rgb(255, 206, 86)"},{backgroundColor:"rgba(75, 192, 192, 0.6)",borderColor:"rgb(75, 192, 192)"},{backgroundColor:"rgba(153, 102, 255, 0.6)",borderColor:"rgb(153, 102, 255)"},{backgroundColor:"rgba(255, 159, 64, 0.6)",borderColor:"rgb(255, 159, 64)"},{backgroundColor:"rgba(199, 199, 199, 0.6)",borderColor:"rgb(199, 199, 199)"}];return a[t%a.length]},getChartOptions(){const t=this.chartData&&this.chartData.datasets&&this.chartData.datasets.length>1,a={responsive:!0,maintainAspectRatio:!1,animation:{duration:500,easing:"easeInOutQuad"},plugins:{legend:{display:["pie","doughnut"].includes(this.selectedChartType)||t,position:"top"},tooltip:{enabled:!0,callbacks:{label:a=>{if("CostImpact"===this.selectedYAxis&&!isNaN(parseFloat(a.label))){const t="Cost: â‚¹"+a.label,e=a.raw||0;return`${t} - ${e} incidents`}if(["pie","doughnut"].includes(this.selectedChartType)){const t=a.label||"",e=a.raw||0,s=a.chart.data.datasets[0].data.reduce((t,a)=>t+a,0),r=(e/s*100).toFixed(1);return`${t}: ${e} (${r}%)`}if(t){const t=a.dataset.label||"",e=a.raw||0;return`${t}: ${e}`}return`Count: ${a.raw}`}}}}};if(["bar","line"].includes(this.selectedChartType)){if(a.scales={y:{beginAtZero:!0,ticks:{stepSize:1,precision:0}}},"CostImpact"===this.selectedYAxis&&this.chartData&&this.chartData.labels){const t=this.chartData.labels.some(t=>!isNaN(parseFloat(t)));t&&(a.scales.x={ticks:{callback:function(t){return"â‚¹"+this.getLabelForValue(t)}}})}"bar"===this.selectedChartType&&t&&["Date","Month","Quarter"].includes(this.selectedXAxis)&&(a.scales.x={stacked:!0,...a.scales.x||{}},a.scales.y.stacked=!0)}return a},changeChartType(t){this.selectedChartType!==t&&(this.selectedChartType=t,this.$nextTick(()=>{this.updateChart()}))},getBackgroundColors(){const t={Severity:{High:"rgba(244, 67, 54, 0.6)",Medium:"rgba(255, 152, 0, 0.6)",Low:"rgba(76, 175, 80, 0.6)"},Status:{Scheduled:"rgba(255, 152, 0, 0.6)",Approved:"rgba(76, 175, 80, 0.6)",Rejected:"rgba(244, 67, 54, 0.6)"},Origin:{Manual:"rgba(33, 150, 243, 0.6)",SIEM:"rgba(156, 39, 176, 0.6)","Audit Finding":"rgba(255, 193, 7, 0.6)",Other:"rgba(121, 85, 72, 0.6)"},RiskCategory:{Security:"rgba(244, 67, 54, 0.6)",Compliance:"rgba(156, 39, 176, 0.6)",Operational:"rgba(255, 152, 0, 0.6)",Financial:"rgba(33, 150, 243, 0.6)",Strategic:"rgba(76, 175, 80, 0.6)",Reputational:"rgba(121, 85, 72, 0.6)"},RiskPriority:{High:"rgba(244, 67, 54, 0.6)",Medium:"rgba(255, 152, 0, 0.6)",Low:"rgba(76, 175, 80, 0.6)"},Repeated:{Repeated:"rgba(244, 67, 54, 0.6)","Not Repeated":"rgba(76, 175, 80, 0.6)"},CostImpact:{Low:"rgba(76, 175, 80, 0.6)",Medium:"rgba(255, 152, 0, 0.6)",High:"rgba(244, 67, 54, 0.6)",Unknown:"rgba(158, 158, 158, 0.6)"}};if("CostImpact"===this.selectedYAxis&&this.chartData&&this.chartData.labels){const t=this.chartData.labels.some(t=>!isNaN(parseFloat(t)));if(t)return this.chartData.labels.map(t=>{const a=parseFloat(t);return a<500?"rgba(76, 175, 80, 0.6)":a<2e3?"rgba(255, 152, 0, 0.6)":"rgba(244, 67, 54, 0.6)"})}return this.chartData?.labels?.map(a=>t[this.selectedYAxis.replace("By ","")]&&t[this.selectedYAxis.replace("By ","")][a]||"rgba(158, 158, 158, 0.6)")||[]},getBorderColors(){const t={Severity:{High:"#F44336",Medium:"#FF9800",Low:"#4CAF50"},Status:{Scheduled:"#FF9800",Approved:"#4CAF50",Rejected:"#F44336"},Origin:{Manual:"#2196F3",SIEM:"#9C27B0","Audit Finding":"#FFC107",Other:"#795548"},RiskCategory:{Security:"#F44336",Compliance:"#9C27B0",Operational:"#FF9800",Financial:"#2196F3",Strategic:"#4CAF50",Reputational:"#795548"},RiskPriority:{High:"#F44336",Medium:"#FF9800",Low:"#4CAF50"},Repeated:{Repeated:"#F44336","Not Repeated":"#4CAF50"},CostImpact:{Low:"#4CAF50",Medium:"#FF9800",High:"#F44336",Unknown:"#9E9E9E"}};if("CostImpact"===this.selectedYAxis&&this.chartData&&this.chartData.labels){const t=this.chartData.labels.some(t=>!isNaN(parseFloat(t)));if(t)return this.chartData.labels.map(t=>{const a=parseFloat(t);return a<500?"#4CAF50":a<2e3?"#FF9800":"#F44336"})}return this.chartData?.labels?.map(a=>t[this.selectedYAxis.replace("By ","")]&&t[this.selectedYAxis.replace("By ","")][a]||"#9E9E9E")||[]},refreshData(){this.fetchDashboardData(),this.fetchRecentIncidents()},truncateDescription(t,a){return t?t.length>a?t.substring(0,a)+"...":t:""},formatDate(t){if(!t)return"";const a=new Date(t),e=new Date;if(a.toDateString()===e.toDateString())return"Today, "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const s=new Date;if(s.setDate(s.getDate()-1),a.toDateString()===s.toDateString())return"Yesterday, "+a.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});const r=Math.abs(e-a),i=Math.ceil(r/864e5);return i<7?i+" days ago":a.toLocaleDateString()}}},V=e(1241);const q=(0,V.A)(Q,[["render",X]]);var z=q}}]);
//# sourceMappingURL=551.9aa78c0c.js.map